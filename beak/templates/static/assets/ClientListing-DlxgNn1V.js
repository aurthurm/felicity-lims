const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/BeakDataTable--KDatWv7.js","assets/index-B3ZheI5m.js","assets/index-C_1sfwqa.css"])))=>i.map(i=>d[i]);
import{a0 as X,f as Y,a7 as r,aq as L,g as V,h as Z,a1 as $,a6 as ee,a8 as te,ar as ne,_ as oe,r as w,c as d,o as a,a as P,A as l,C as le,E as ie,N as b,F as m,P as se,H as ae,a2 as F,J as C,K as D,L as p,a9 as M,D as re}from"./index-B3ZheI5m.js";import{A as de,E as ce}from"./clients.mutations-bDvdJtaL.js";import{u as ue}from"./client-CXQzvEEi.js";import{u as me}from"./location-D4s7i66G.js";import{s as fe}from"./index-C7zlg90Q.js";const be=X({__name:"ClientListing",setup(O,{expose:e}){e();const T=$(()=>ee(()=>import("./BeakDataTable--KDatWv7.js"),__vite__mapDeps([0,1,2]))),t=ue(),c=me(),{withClientMutation:g}=Y(),y=r([{name:"UID",value:"uid",sortable:!0,sortBy:"asc",defaultSort:!0,showInToggler:!1,hidden:!0},{name:"Client Name",value:"",sortable:!1,sortBy:"asc",hidden:!1,customRender:function(n,u){return te(ne,{to:{name:"client-detail",query:{clientUid:n?.uid}},class:"px-2 py-1 font-semibold rounded-md hover:underline transition-colors duration-200",innerHTML:n?.name})}},{name:"Client ID",value:"code",sortable:!1,sortBy:"asc",hidden:!1},{name:"District",value:"district.name",sortable:!1,sortBy:"asc",hidden:!1},{name:"Province",value:"district.province.name",sortable:!1,sortBy:"asc",hidden:!1},{name:"Mobile Number",value:"mobilePhone",sortable:!1,sortBy:"asc",hidden:!1},{name:"Email Address",value:"email",sortable:!1,sortBy:"asc",hidden:!1}]),{countries:h,provinces:k,districts:o}=L(c),{clients:N,clientPageInfo:B,fetchingClients:R}=L(t);let v=r(!1),f=r(!1),U=r(""),s=V({});const I=r(""),j=()=>Object.assign(s,{});let i=V({first:50,after:"",text:"",sortBy:["uid"],filterAction:!1}),x=r(),_=r();t.fetchClients(i),c.fetchCountries();function A(){g(de,{payload:{name:s.name,code:s.code,districtUid:s.districtUid}},"createClient").then(n=>t.addClient(n))}function E(){g(ce,{uid:s.uid,payload:{name:s.name,code:s.code,districtUid:s.districtUid}},"updateClient").then(n=>t.updateClient(n))}function q(n){c.filterProvincesByCountry(x.value)}function H(n){c.filterDistrictsByProvince(_.value)}function K(n){i.first=100,i.after="",i.text=n.filterText,i.filterAction=!0,t.fetchClients(i)}function J(n){i.first=n.fetchCount,i.after=B?.value?.endCursor,i.text=n.filterText,i.filterAction=!1,t.fetchClients(i)}function z(n,u,W={}){f.value=n,U.value=u,I.value=(n?"CREATE":"EDIT")+" "+u.toUpperCase(),u=="client"&&(v.value=!0),n?u=="client"&&Object.assign(s,{}):u=="client"&&Object.assign(s,{...W})}function G(){f.value&&A(),f.value||E(),v.value=!1}const Q=Z(()=>N?.value?.length+" of "+t.getClientCount+" clients"),S={DataTable:T,clientStore:t,locationStore:c,withClientMutation:g,tableColumns:y,countries:h,provinces:k,districts:o,clients:N,clientPageInfo:B,fetchingClients:R,get showClientModal(){return v},set showClientModal(n){v=n},get createItem(){return f},set createItem(n){f=n},get targetItem(){return U},set targetItem(n){U=n},get client(){return s},set client(n){s=n},formTitle:I,resetClient:j,get clientParams(){return i},set clientParams(n){i=n},get countryUid(){return x},set countryUid(n){x=n},get provinceUid(){return _},set provinceUid(n){_=n},addClient:A,editClient:E,getProvinces:q,getDistricts:H,searchClients:K,showMoreClients:J,FormManager:z,saveForm:G,countNone:Q,get shield(){return fe}};return Object.defineProperty(S,"__isScriptSetup",{enumerable:!1,value:!0}),S}}),ge={class:"rounded-lg border border-border bg-card shadow-sm p-6"},ve={action:"post",class:"p-1"},Ce={class:"grid grid-cols-2 gap-x-4 mb-4"},pe={class:"block col-span-1 mb-2"},ye={class:"block col-span-1 mb-2"},he={class:"grid grid-cols-3 gap-x-4 mb-4"},ke={class:"block col-span-1 mb-2"},Ue=["value"],xe={class:"block col-span-1 mb-2"},_e=["value"],we={class:"block col-span-1 mb-2"},Pe=["value"];function De(O,e,T,t,c,g){const y=w("beak-button"),h=w("beak-heading"),k=w("beak-modal");return a(),d(C,null,[P(h,{title:"Clients"},{default:b(()=>[m(P(y,{onClick:e[0]||(e[0]=o=>t.FormManager(!0,"client"))},{default:b(()=>[...e[10]||(e[10]=[se(" Add client ",-1)])]),_:1},512),[[ae,t.shield.hasRights(t.shield.actions.CREATE,t.shield.objects.CLIENT)]])]),_:1}),l("div",ge,[P(t.DataTable,{columns:t.tableColumns,data:t.clients,toggleColumns:!0,loading:t.fetchingClients,paginable:!0,pageMeta:{fetchCount:t.clientParams.first,hasNextPage:t.clientPageInfo?.hasNextPage,countNone:t.countNone},searchable:!0,filterable:!1,onOnSearchKeyUp:t.searchClients,onOnSearchFocus:t.resetClient,onOnPaginate:t.showMoreClients,selectable:!1},{footer:b(()=>[...e[11]||(e[11]=[])]),_:1},8,["columns","data","loading","pageMeta"])]),t.showClientModal?(a(),le(k,{key:0,onClose:e[9]||(e[9]=o=>t.showClientModal=!1)},{header:b(()=>[l("h3",null,p(t.formTitle),1)]),body:b(()=>[l("form",ve,[l("div",Ce,[l("label",pe,[e[12]||(e[12]=l("span",{class:"text-foreground"},"Name",-1)),m(l("input",{class:"form-input mt-1 block w-full","onUpdate:modelValue":e[1]||(e[1]=o=>t.client.name=o),placeholder:"Name ..."},null,512),[[F,t.client.name]])]),l("label",ye,[e[13]||(e[13]=l("span",{class:"text-foreground"},"Code",-1)),m(l("input",{class:"form-input mt-1 block w-full","onUpdate:modelValue":e[2]||(e[2]=o=>t.client.code=o),placeholder:"Code ..."},null,512),[[F,t.client.code]])])]),l("div",he,[l("label",ke,[e[15]||(e[15]=l("span",{class:"text-foreground"},"Country",-1)),m(l("select",{class:"form-select block w-full mt-1","onUpdate:modelValue":e[3]||(e[3]=o=>t.countryUid=o),onChange:e[4]||(e[4]=o=>t.getProvinces(o))},[e[14]||(e[14]=l("option",null,null,-1)),(a(!0),d(C,null,D(t.countries,o=>(a(),d("option",{key:o.uid,value:o.uid},p(o.name),9,Ue))),128))],544),[[M,t.countryUid]])]),l("label",xe,[e[17]||(e[17]=l("span",{class:"text-foreground"},"Province",-1)),m(l("select",{class:"form-select block w-full mt-1","onUpdate:modelValue":e[5]||(e[5]=o=>t.provinceUid=o),onChange:e[6]||(e[6]=o=>t.getDistricts(o))},[e[16]||(e[16]=l("option",null,null,-1)),(a(!0),d(C,null,D(t.provinces,o=>(a(),d("option",{key:o.uid,value:o.uid},p(o.name),9,_e))),128))],544),[[M,t.provinceUid]])]),l("label",we,[e[19]||(e[19]=l("span",{class:"text-foreground"},"District",-1)),m(l("select",{class:"form-select block w-full mt-1","onUpdate:modelValue":e[7]||(e[7]=o=>t.client.districtUid=o)},[e[18]||(e[18]=l("option",null,null,-1)),(a(!0),d(C,null,D(t.districts,o=>(a(),d("option",{key:o.uid,value:o.uid},p(o.name),9,Pe))),128))],512),[[M,t.client.districtUid]])])]),e[20]||(e[20]=l("hr",null,null,-1)),l("button",{type:"button",onClick:e[8]||(e[8]=re(o=>t.saveForm(),["prevent"])),class:"m-2 -mb-4 w-full rounded-sm border border-primary bg-primary px-4 py-2 text-primary-foreground transition-colors duration-500 ease select-none hover:bg-primary focus:outline-none focus:shadow-outline"}," Save Form ")])]),_:1})):ie("",!0)],64)}const Ae=oe(be,[["render",De],["__file","/home/administrator/Documents/Development/beak-insights/felicity/felicity-lims/webapp/views/client/ClientListing.vue"]]);export{Ae as default};
