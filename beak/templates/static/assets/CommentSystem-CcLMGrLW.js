import{a0 as R,f as A,a7 as p,_ as k,c as r,o as i,F as q,A as o,a2 as N,Q as x,E as f,P as F,L as v,ad as L,r as S,a as C,J as b,K as j,C as T}from"./index-DCVfsbos.js";import{q as P,r as O,s as G}from"./grind.queries-CepHqusz.js";const I=R({__name:"CommentForm",props:{errandUid:{type:String,required:!0},parentDiscussion:{type:Object,required:!1,default:void 0},isReply:{type:Boolean,required:!1,default:!1}},emits:["commentAdded","cancelReply"],setup(y,{expose:d,emit:n}){d();const e=y,s=n,{withClientMutation:a}=A(),t=p("");function c(){t.value.trim()&&a(P,{payload:{comment:t.value,errandUid:e.errandUid,parentUid:e.parentDiscussion?.uid}},"createGrindErrandDiscussion").then(()=>{t.value="",s("commentAdded")})}function l(){s("cancelReply")}const m={props:e,emit:s,withClientMutation:a,comment:t,addDiscussion:c,cancelReply:l};return Object.defineProperty(m,"__isScriptSetup",{enumerable:!1,value:!0}),m}}),M=["aria-label"],V=["rows","placeholder","aria-label"],z={class:"flex items-center justify-end mt-2 gap-2"},H=["aria-label"],Q={key:0,class:"flex items-center gap-2"};function J(y,d,n,e,s,a){return i(),r("div",{class:"mb-4",role:"form","aria-label":n.isReply?"Reply form":"Comment form"},[q(o("textarea",{"onUpdate:modelValue":d[0]||(d[0]=t=>e.comment=t),rows:n.isReply?2:3,class:x(["w-full px-3 py-2 border border-input bg-background rounded-md shadow-sm text-foreground placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:border-primary transition-colors",{"text-sm":n.isReply}]),placeholder:n.isReply?"Write a reply...":"Add a comment...","aria-label":n.isReply?"Reply text":"Comment text"},null,10,V),[[N,e.comment]]),o("div",z,[n.isReply?(i(),r("button",{key:0,onClick:e.cancelReply,class:"px-2 py-1 border border-input bg-background text-foreground rounded-md hover:bg-accent hover:text-accent-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 transition-colors text-sm","aria-label":"Cancel reply"}," Cancel ")):f("v-if",!0),o("button",{onClick:e.addDiscussion,class:x(["inline-flex items-center justify-center rounded-md text-sm font-medium transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:opacity-50 disabled:pointer-events-none border border-input bg-accent text-accent-foreground hover:bg-primary hover:text-primary-foreground h-9 px-4 py-2",{"text-sm px-2 py-1":n.isReply}]),"aria-label":n.isReply?"Submit reply":"Submit comment"},[n.isReply?f("v-if",!0):(i(),r("div",Q,[...d[1]||(d[1]=[o("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-5 w-5",viewBox:"0 0 20 20",fill:"currentColor","aria-hidden":"true"},[o("path",{"fill-rule":"evenodd",d:"M7.707 3.293a1 1 0 010 1.414L5.414 7H11a7 7 0 017 7v2a1 1 0 11-2 0v-2a5 5 0 00-5-5H5.414l2.293 2.293a1 1 0 11-1.414 1.414l-4-4a1 1 0 010-1.414l4-4a1 1 0 011.414 0z","clip-rule":"evenodd"})],-1)])])),F(" "+v(n.isReply?"Reply":"Comment"),1)],10,H)])],8,M)}const B=k(I,[["render",J],["__file","/home/administrator/Documents/Development/beak-insights/beak/beak-lims/webapp/components/grind/CommentForm.vue"]]),K=R({__name:"CommentItem",props:{discussion:{type:Object,required:!0},errandUid:{type:String,required:!0}},emits:["reply","edit"],setup(y,{expose:d,emit:n}){d();const e=y,s=n,{withClientQuery:a}=A(),t=p([]),c=p(!1),l=p(!1),m=p(!1);L(()=>{e.discussion.subdiscussions?.length&&g()});function g(){c.value=!0,a(O,{parentUid:e.discussion.uid},"grindErrandDiscussionsByParent").then(u=>{u&&typeof u=="object"&&"grindErrandDiscussionsByParent"in u&&(t.value=u.grindErrandDiscussionsByParent),c.value=!1})}function w(){l.value=!l.value,l.value&&t.value.length===0&&g()}function E(){s("reply",e.discussion)}function D(){s("edit",e.discussion)}function U(){m.value=!1,g()}const h={props:e,emit:s,withClientQuery:a,replies:t,isLoading:c,showReplies:l,showReplyForm:m,fetchReplies:g,toggleReplies:w,handleReply:E,handleEdit:D,handleCommentAdded:U,CommentForm:B};return Object.defineProperty(h,"__isScriptSetup",{enumerable:!1,value:!0}),h}}),W=["aria-label"],X={class:"flex items-start gap-3"},Y={class:"shrink-0"},Z={class:"w-10 h-10 rounded-full bg-muted flex items-center justify-center text-muted-foreground"},$={class:"grow"},ee={class:"flex items-center justify-between mb-1"},ne={class:"flex items-center gap-2"},te={class:"font-medium text-foreground"},ie={class:"text-sm text-muted-foreground"},se={class:"flex items-center gap-2"},oe={class:"text-foreground whitespace-pre-wrap"},re={key:0,class:"mt-2"},de=["aria-expanded","aria-label"],le={key:0,class:"mt-4 ml-8"},ae={key:0,class:"flex items-center justify-center py-4"},ce={key:0,class:"text-sm text-muted-foreground py-2"},me={key:1,class:"mt-4 ml-8"};function ue(y,d,n,e,s,a){const t=S("beak-loader"),c=S("CommentItem",!0);return i(),r("div",{class:"mb-4 p-4 border border-input bg-background rounded-lg shadow-sm",role:"article","aria-label":`Comment by ${n.discussion.createdBy?.firstName||"User"}`},[o("div",X,[o("div",Y,[o("div",Z,v(n.discussion.createdBy?.firstName?.[0]||"U"),1)]),o("div",$,[o("div",ee,[o("div",ne,[o("span",te,v(n.discussion.createdBy?.firstName)+" "+v(n.discussion.createdBy?.lastName),1),o("span",ie,v(n.discussion.createdAt?new Date(n.discussion.createdAt).toLocaleString():""),1)]),o("div",se,[o("button",{onClick:e.handleReply,class:"text-sm text-muted-foreground hover:text-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 rounded-md px-2 py-1 transition-colors","aria-label":"Reply to comment"}," Reply "),n.discussion.canEdit?(i(),r("button",{key:0,onClick:e.handleEdit,class:"text-sm text-muted-foreground hover:text-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 rounded-md px-2 py-1 transition-colors","aria-label":"Edit comment"}," Edit ")):f("v-if",!0)])]),o("p",oe,v(n.discussion.comment),1),n.discussion.subdiscussions?.length?(i(),r("div",re,[o("button",{onClick:e.toggleReplies,class:"text-sm text-muted-foreground hover:text-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 rounded-md px-2 py-1 transition-colors","aria-expanded":e.showReplies,"aria-label":`${e.showReplies?"Hide":"Show"} ${n.discussion.subdiscussions.length} ${n.discussion.subdiscussions.length===1?"reply":"replies"}`},v(n.discussion.subdiscussions.length)+" "+v(n.discussion.subdiscussions.length===1?"reply":"replies"),9,de)])):f("v-if",!0)])]),e.showReplies?(i(),r("div",le,[e.isLoading?(i(),r("div",ae,[C(t,{message:"Loading replies...",variant:"muted",size:"sm"})])):(i(),r(b,{key:1},[e.replies.length===0?(i(),r("div",ce," No replies yet ")):(i(!0),r(b,{key:1},j(e.replies,l=>(i(),T(c,{key:l.uid,discussion:l,"errand-uid":n.errandUid,onReply:e.handleReply,onEdit:e.handleEdit},null,8,["discussion","errand-uid"]))),128))],64))])):f("v-if",!0),e.showReplyForm?(i(),r("div",me,[C(e.CommentForm,{"errand-uid":n.errandUid,"parent-discussion":n.discussion,"is-reply":!0,onCommentAdded:e.handleCommentAdded,onCancelReply:d[0]||(d[0]=l=>e.showReplyForm=!1)},null,8,["errand-uid","parent-discussion"])])):f("v-if",!0)],8,W)}const fe=k(K,[["render",ue],["__file","/home/administrator/Documents/Development/beak-insights/beak/beak-lims/webapp/components/grind/CommentItem.vue"]]),ye=R({__name:"CommentList",props:{comments:{type:Array,required:!0},replyingTo:{type:[Object,null],required:!0,default:null},editingComment:{type:[Object,null],required:!0,default:null},level:{type:Number,required:!0,default:0},errandUid:{type:String,required:!0}},emits:["setReplyingTo","setEditingComment","commentAdded","commentUpdated"],setup(y,{expose:d,emit:n}){d();const e=y,s=n;function a(g){s("setReplyingTo",g)}function t(g){s("setEditingComment",g)}function c(){s("commentAdded")}function l(){s("commentUpdated")}const m={props:e,emit:s,handleSetReplyingTo:a,handleSetEditingComment:t,handleCommentAdded:c,handleCommentUpdated:l,CommentItem:fe};return Object.defineProperty(m,"__isScriptSetup",{enumerable:!1,value:!0}),m}}),ge=["aria-label"];function pe(y,d,n,e,s,a){return i(),r("div",{class:x(`space-y-${n.level===0?"6":"4"}`),role:"list","aria-label":`${n.level===0?"Top-level comments":"Nested comments"}`},[(i(!0),r(b,null,j(n.comments,t=>(i(),r("div",{key:t.uid,class:x(n.level===0?"border-b border-border pb-4":""),role:"listitem"},[C(e.CommentItem,{discussion:t,"errand-uid":n.errandUid,onReply:e.handleSetReplyingTo,onEdit:e.handleSetEditingComment,onCommentAdded:e.handleCommentAdded,onCommentUpdated:e.handleCommentUpdated},null,8,["discussion","errand-uid"])],2))),128))],10,ge)}const ve=k(ye,[["render",pe],["__file","/home/administrator/Documents/Development/beak-insights/beak/beak-lims/webapp/components/grind/CommentList.vue"]]),_e=R({__name:"CommentSystem",props:{errandUid:{type:String,required:!0}},setup(y,{expose:d}){d();const n=y,{withClientQuery:e}=A(),s=p([]),a=p(null),t=p(null),c=p(!1),l=p(null);L(()=>{m()});async function m(u="cache-first"){c.value=!0,l.value=null;try{const _=await e(G,{errandUid:n.errandUid},"grindErrandDiscussions",u);_&&typeof _=="object"&&"grindErrandDiscussions"in _?s.value=_.grindErrandDiscussions:l.value="Failed to load discussions"}catch(_){l.value=_ instanceof Error?_.message:"An error occurred while loading discussions"}finally{c.value=!1}}function g(){return s.value.filter(u=>!u.parentUid)}function w(){m("network-only"),a.value=null}function E(){m("network-only"),t.value=null}function D(u){a.value=u}function U(u){t.value=u}const h={props:n,withClientQuery:e,discussions:s,replyingTo:a,editingComment:t,isLoading:c,error:l,getDiscussions:m,getTopLevelComments:g,handleCommentAdded:w,handleCommentUpdated:E,setReplyingTo:D,setEditingComment:U,CommentForm:B,CommentList:ve};return Object.defineProperty(h,"__isScriptSetup",{enumerable:!1,value:!0}),h}}),be={role:"region","aria-label":"Comments section"},he={key:0,class:"flex items-center justify-center py-4"},Ce={class:"p-4 border border-destructive bg-destructive/10 text-destructive rounded-md",role:"alert"};function xe(y,d,n,e,s,a){const t=S("beak-loader");return i(),r("div",be,[f(" Loading state "),e.isLoading?(i(),r("div",he,[C(t,{message:"Loading comments...",variant:"muted",size:"sm"})])):e.error?(i(),r(b,{key:1},[f(" Error state "),o("div",Ce,v(e.error),1)],2112)):(i(),r(b,{key:2},[f(" Content "),o("div",null,[f(" Main comment input "),C(e.CommentForm,{"errand-uid":n.errandUid,onCommentAdded:e.handleCommentAdded},null,8,["errand-uid"]),f(" Comments and replies "),e.getTopLevelComments().length>0?(i(),T(e.CommentList,{key:0,comments:e.getTopLevelComments(),"replying-to":e.replyingTo,"editing-comment":e.editingComment,"errand-uid":n.errandUid,level:0,onSetReplyingTo:e.setReplyingTo,onSetEditingComment:e.setEditingComment,onCommentAdded:e.handleCommentAdded,onCommentUpdated:e.handleCommentUpdated},null,8,["comments","replying-to","editing-comment","errand-uid"])):(i(),r(b,{key:1},[f(" Empty state "),d[0]||(d[0]=o("div",{class:"text-center py-8 text-muted-foreground"},[o("p",null,"No comments yet. Be the first to comment!")],-1))],2112))])],2112))])}const we=k(_e,[["render",xe],["__file","/home/administrator/Documents/Development/beak-insights/beak/beak-lims/webapp/components/grind/CommentSystem.vue"]]);export{we as default};
