import{a0 as Y,f as Z,a7 as Q,_ as $,r as ee,c as s,o as i,E as a,A as r,J as x,K as k,L as d,F as n,a9 as R,a as L,a2 as m,H as M,D as te}from"./index-DCVfsbos.js";import{Multiselect as re}from"./vue-multiselect.esm-CQe58Q7H.js";import{c as C,g as A,a as b,d as v,u as oe,b as l}from"./index.esm-89YX2EbQ.js";import{g as se}from"./inventory.queries-BnLcsjsr.js";import{u as ie,R as de}from"./inventory-HFpdvBbS.js";import{a as ae}from"./storage-C2DMRCPv.js";import{u as ne}from"./setup-DMRnqeyP.js";import{u as le}from"./user-C8Z2RT46.js";const ue=Y({__name:"StockReceiveForm",emits:["close"],setup(E,{expose:e,emit:_}){e();const t=_,V=ie(),D=ne(),S=ae(),o=le(),{withClientMutation:y,withClientQuery:q}=Z(),F=Q([]),U=Q(!1),P=C({stockItemVariant:C().required("StockItem is required"),supplierUid:b().required(),unitUid:b().required(),lotNumber:b().required(),unitPrice:v().nullable().default(0),totalPrice:v().nullable().default(0),singlesReceived:v().required().default(0),packagesReceived:v().required().default(0),packageFactor:v().required().default(1),quantityReceived:v().default(0),receiptType:b().required().default("purchase"),receiptDate:A().required("Date received is required"),receiptByUid:b().required("Receiver is required"),expiryDate:A().required("Date expiring is required")}),{handleSubmit:I,errors:K}=oe({validationSchema:P,initialValues:{singlesReceived:0,packagesReceived:0,packageFactor:1,quantityReceived:0}}),{value:h}=l("stockItemVariant"),{value:j}=l("supplierUid"),{value:O}=l("unitUid"),{value:G}=l("lotNumber"),{value:p}=l("totalPrice"),{value:c}=l("packagesReceived"),{value:w}=l("packageFactor"),{value:f}=l("quantityReceived"),{value:H}=l("receiptType"),{value:J}=l("receiptDate"),{value:z}=l("receiptByUid"),{value:W}=l("expiryDate"),X=I(u=>N(u));function N(u){U.value=!0;const g={...u,productUid:h?.value?.uid,unitPrice:0,totalPrice:0};delete g.stockItemVariant,y(de,{payload:g},"createStockReceipt").then(T=>{}).finally(()=>{U.value=!1,t("close")})}const B={emit:t,inventoryStore:V,setupStore:D,storageStore:S,userStore:o,withClientMutation:y,withClientQuery:q,stockItems:F,addingProduct:U,stockSchema:P,handleSubmit:I,errors:K,stockItemVariant:h,supplierUid:j,unitUid:O,lotNumber:G,singlesReceived:p,packagesReceived:c,packageFactor:w,quantityReceived:f,receiptType:H,receiptDate:J,receiptByUid:z,expiryDate:W,submitStockForm:X,receiveStockProduct:N,findProduct:async u=>{u.length>3&&q(se,{first:50,after:"",text:u,sortBy:["name"]},"stockProductAll").then(T=>{F.value=T?.items})},customLabel:(u,g)=>`${u.stockItem?.name} - ${u.name}`,updateQuantityReceived:()=>{!p.value&&!c.value&&(f.value=0),!p.value&&c.value&&(f.value=c.value*w.value),p.value&&!c.value&&(f.value=p.value),c.value||(c.value=0),f.value=p.value+c.value*w.value},get VueMultiselect(){return re}};return Object.defineProperty(B,"__isScriptSetup",{enumerable:!1,value:!0}),B}}),ce=["inert"],me={key:0,class:"p-3 bg-destructive/10 text-destructive rounded-md mb-4"},pe={class:"mt-2 list-disc list-inside text-sm"},ve={class:"space-y-2"},fe={key:0,class:"text-sm text-destructive"},be={class:"space-y-2"},ye={class:"w-full"},ge={key:0,class:"text-sm text-destructive"},xe={class:"space-y-2"},ke=["value"],Re={key:0,class:"text-sm text-destructive"},Se={class:"space-y-2"},Ue=["value"],we={key:0,class:"text-sm text-destructive"},_e={class:"space-y-2"},Ve={class:"w-full"},De={key:0,class:"text-sm text-destructive"},qe={class:"space-y-2"},Fe={class:"w-full"},Pe={key:0,class:"text-sm text-destructive"},Ie={class:"space-y-2"},he={class:"w-full"},Ne={key:0,class:"text-sm text-destructive"},Be={class:"space-y-2"},Te={class:"w-full"},Qe={key:0,class:"text-sm text-destructive"},Le={class:"space-y-2"},Me={class:"w-full"},Ce={key:0,class:"text-sm text-destructive"},Ae={class:"space-y-2"},Ee={class:"w-full"},Ke={key:0,class:"text-sm text-destructive"},je={class:"space-y-2"},Oe={class:"w-full"},Ge={key:0,class:"text-sm text-destructive"},He={class:"space-y-2"},Je=["value"],ze={key:0,class:"text-sm text-destructive"},We={class:"flex justify-end"},Xe={type:"submit",class:"px-4 py-2 text-sm font-medium text-primary-foreground bg-primary border border-transparent rounded-md shadow-sm hover:bg-primary/90 focus:outline-none focus:ring-2 focus:ring-primary focus:ring-offset-2 transition-colors duration-200"};function Ye(E,e,_,t,V,D){const S=ee("beak-loader");return i(),s("form",{onSubmit:e[15]||(e[15]=te((...o)=>t.submitStockForm&&t.submitStockForm(...o),["prevent"])),class:"rounded-md py-4 space-y-4",autocomplete:"off",inert:t.addingProduct},[Object.keys(t.errors).length>0?(i(),s("div",me,[e[16]||(e[16]=r("p",{class:"text-sm font-medium"},"Please correct the following errors:",-1)),r("ul",pe,[(i(!0),s(x,null,k(t.errors,(o,y)=>(i(),s("li",{key:y},d(o),1))),128))])])):a("v-if",!0),r("div",ve,[e[18]||(e[18]=r("label",{class:"block text-sm font-medium text-foreground"},"Receipt Type",-1)),n(r("select",{class:"w-full px-3 py-2 text-foreground bg-background border border-border rounded-md shadow-sm focus:outline-none focus:ring-2 focus:ring-primary focus:border-primary transition-colors duration-200","onUpdate:modelValue":e[0]||(e[0]=o=>t.receiptType=o),"aria-label":"Receipt Type"},[...e[17]||(e[17]=[r("option",{value:"null"},null,-1),r("option",{value:"purchase"},"Purchased",-1),r("option",{value:"pushed"},"Pushed",-1),r("option",{value:"transfer_in"},"Transfer In",-1)])],512),[[R,t.receiptType]]),t.errors.receiptType?(i(),s("div",fe,d(t.errors.receiptType),1)):a("v-if",!0)]),r("div",be,[e[19]||(e[19]=r("label",{class:"block text-sm font-medium text-foreground"},"Stock Item",-1)),r("div",ye,[L(t.VueMultiselect,{placeholder:"Select a Stock Item",modelValue:t.stockItemVariant,"onUpdate:modelValue":e[1]||(e[1]=o=>t.stockItemVariant=o),options:t.stockItems,searchable:!0,"track-by":"uid",customLabel:t.customLabel,onSearchChange:t.findProduct,class:"multiselect-primary"},null,8,["modelValue","options"]),t.errors.stockItemVariantUid?(i(),s("div",ge,d(t.errors.stockItemVariantUid),1)):a("v-if",!0)])]),r("div",xe,[e[21]||(e[21]=r("label",{class:"block text-sm font-medium text-foreground"},"Supplier",-1)),n(r("select",{class:"w-full px-3 py-2 text-foreground bg-background border border-border rounded-md shadow-sm focus:outline-none focus:ring-2 focus:ring-primary focus:border-primary transition-colors duration-200","onUpdate:modelValue":e[2]||(e[2]=o=>t.supplierUid=o),"aria-label":"Supplier"},[e[20]||(e[20]=r("option",{value:"null"},null,-1)),(i(!0),s(x,null,k(t.setupStore.suppliers,o=>(i(),s("option",{key:o.uid,value:o.uid},d(o.name),9,ke))),128))],512),[[R,t.supplierUid]]),t.errors.supplierUid?(i(),s("div",Re,d(t.errors.supplierUid),1)):a("v-if",!0)]),r("div",Se,[e[23]||(e[23]=r("label",{class:"block text-sm font-medium text-foreground"},"Unit (Single)",-1)),n(r("select",{class:"w-full px-3 py-2 text-foreground bg-background border border-border rounded-md shadow-sm focus:outline-none focus:ring-2 focus:ring-primary focus:border-primary transition-colors duration-200","onUpdate:modelValue":e[3]||(e[3]=o=>t.unitUid=o),"aria-label":"Unit"},[e[22]||(e[22]=r("option",{value:"null"},null,-1)),(i(!0),s(x,null,k(t.inventoryStore.units,o=>(i(),s("option",{key:o.uid,value:o.uid},d(o.name),9,Ue))),128))],512),[[R,t.unitUid]]),t.errors.unitUid?(i(),s("div",we,d(t.errors.unitUid),1)):a("v-if",!0)]),r("div",_e,[e[24]||(e[24]=r("label",{class:"block text-sm font-medium text-foreground"},"Lot Number",-1)),r("div",Ve,[n(r("input",{class:"w-full px-3 py-2 text-foreground bg-background border border-border rounded-md shadow-sm focus:outline-none focus:ring-2 focus:ring-primary focus:border-primary transition-colors duration-200","onUpdate:modelValue":e[4]||(e[4]=o=>t.lotNumber=o),placeholder:"Lot Number..."},null,512),[[m,t.lotNumber]]),t.errors.lotNumber?(i(),s("div",De,d(t.errors.lotNumber),1)):a("v-if",!0)])]),r("div",qe,[e[25]||(e[25]=r("label",{class:"block text-sm font-medium text-foreground"},"Packages Received",-1)),r("div",Fe,[n(r("input",{class:"w-full px-3 py-2 text-foreground bg-background border border-border rounded-md shadow-sm focus:outline-none focus:ring-2 focus:ring-primary focus:border-primary transition-colors duration-200",type:"number","onUpdate:modelValue":e[5]||(e[5]=o=>t.packagesReceived=o),placeholder:"Quantity Received...",onKeyup:t.updateQuantityReceived,onFocus:e[6]||(e[6]=o=>o.target.select())},null,544),[[m,t.packagesReceived]]),t.errors.packagesReceived?(i(),s("div",Pe,d(t.errors.packagesReceived),1)):a("v-if",!0)])]),r("div",Ie,[e[26]||(e[26]=r("label",{class:"block text-sm font-medium text-foreground"},"Package Factor",-1)),r("div",he,[n(r("input",{class:"w-full px-3 py-2 text-foreground bg-background border border-border rounded-md shadow-sm focus:outline-none focus:ring-2 focus:ring-primary focus:border-primary transition-colors duration-200",type:"number","onUpdate:modelValue":e[7]||(e[7]=o=>t.packageFactor=o),placeholder:"Package Factor...",onKeyup:t.updateQuantityReceived,onFocus:e[8]||(e[8]=o=>o.target.select())},null,544),[[m,t.packageFactor]]),t.errors.packageFactor?(i(),s("div",Ne,d(t.errors.packageFactor),1)):a("v-if",!0)])]),r("div",Be,[e[27]||(e[27]=r("label",{class:"block text-sm font-medium text-foreground"},"Singles Received",-1)),r("div",Te,[n(r("input",{class:"w-full px-3 py-2 text-foreground bg-background border border-border rounded-md shadow-sm focus:outline-none focus:ring-2 focus:ring-primary focus:border-primary transition-colors duration-200",type:"number","onUpdate:modelValue":e[9]||(e[9]=o=>t.singlesReceived=o),placeholder:"Quantity Received...",onKeyup:t.updateQuantityReceived,onFocus:e[10]||(e[10]=o=>o.target.select())},null,544),[[m,t.singlesReceived]]),t.errors.singlesReceived?(i(),s("div",Qe,d(t.errors.singlesReceived),1)):a("v-if",!0)])]),r("div",Le,[e[28]||(e[28]=r("label",{class:"block text-sm font-medium text-foreground"},"Quantity Received",-1)),r("div",Me,[n(r("input",{class:"w-full px-3 py-2 text-foreground bg-muted border border-border rounded-md shadow-sm focus:outline-none focus:ring-2 focus:ring-primary focus:border-primary transition-colors duration-200",type:"number","onUpdate:modelValue":e[11]||(e[11]=o=>t.quantityReceived=o),disabled:""},null,512),[[m,t.quantityReceived]]),t.errors.quantityReceived?(i(),s("div",Ce,d(t.errors.quantityReceived),1)):a("v-if",!0)])]),r("div",Ae,[e[29]||(e[29]=r("label",{class:"block text-sm font-medium text-foreground"},"Expiry Date",-1)),r("div",Ee,[n(r("input",{class:"w-full px-3 py-2 text-foreground bg-background border border-border rounded-md shadow-sm focus:outline-none focus:ring-2 focus:ring-primary focus:border-primary transition-colors duration-200",type:"date","onUpdate:modelValue":e[12]||(e[12]=o=>t.expiryDate=o),placeholder:"Expiry Date"},null,512),[[m,t.expiryDate]]),t.errors.expiryDate?(i(),s("div",Ke,d(t.errors.expiryDate),1)):a("v-if",!0)])]),r("div",je,[e[30]||(e[30]=r("label",{class:"block text-sm font-medium text-foreground"},"Received Date",-1)),r("div",Oe,[n(r("input",{class:"w-full px-3 py-2 text-foreground bg-background border border-border rounded-md shadow-sm focus:outline-none focus:ring-2 focus:ring-primary focus:border-primary transition-colors duration-200",type:"date","onUpdate:modelValue":e[13]||(e[13]=o=>t.receiptDate=o),placeholder:"Received Date"},null,512),[[m,t.receiptDate]]),t.errors.receiptDate?(i(),s("div",Ge,d(t.errors.receiptDate),1)):a("v-if",!0)])]),r("div",He,[e[32]||(e[32]=r("label",{class:"block text-sm font-medium text-foreground"},"Received By",-1)),n(r("select",{class:"w-full px-3 py-2 text-foreground bg-background border border-border rounded-md shadow-sm focus:outline-none focus:ring-2 focus:ring-primary focus:border-primary transition-colors duration-200","onUpdate:modelValue":e[14]||(e[14]=o=>t.receiptByUid=o),"aria-label":"Received By"},[e[31]||(e[31]=r("option",{value:"null"},null,-1)),(i(!0),s(x,null,k(t.userStore.users,o=>(i(),s("option",{key:o.uid,value:o.uid},d(o.firstName)+" "+d(o.lastName),9,Je))),128))],512),[[R,t.receiptByUid]]),t.errors.receiptByUid?(i(),s("div",ze,d(t.errors.receiptByUid),1)):a("v-if",!0)]),e[33]||(e[33]=r("div",{class:"border-t border-border my-6"},null,-1)),r("div",We,[n(r("button",Xe," Save ",512),[[M,!t.addingProduct]]),n(L(S,{message:"Adding Inventory ..."},null,512),[[M,t.addingProduct]])])],40,ce)}const lt=$(ue,[["render",Ye],["__scopeId","data-v-65664c55"],["__file","/home/administrator/Documents/Development/beak-insights/beak/beak-lims/webapp/views/inventory/StockReceiveForm.vue"]]);export{lt as default};
