import{a0 as V,aq as N,g as L,a7 as j,ad as E,a5 as w,e as k,_ as P,r as _,c,o as i,A as r,E as C,C as S,F as v,H as R,J as F,K as M,N as g,Q as U,L as b,P as A,a as H,b as z,a2 as D,D as I}from"./index-B3ZheI5m.js";import{C as W}from"./index-PkMzhajl.js";import{u as q}from"./dashboard-BWageVZl.js";import{S as J}from"./StatCard-DeboA2UX.js";import"./index-1-FQjRgF.js";import"./index-BkD7Hj8s.js";import"./ticks-yQcwDFE8.js";import"./arc-DghFiuMI.js";import"./timer-DChf79OC.js";import"./math-CyDA0WRY.js";import"./index-DaJBD5B5.js";import"./defaultLocale-D2nGpDRe.js";import"./Tableau10-1LCcg9PS.js";import"./rgb-BP_F0UyK.js";import"./range-OtVwhkKS.js";const K=V({__name:"Resource",setup(B,{expose:e}){e();const d=q(),{dashboard:t}=N(d),m=L({range:{from:"",to:""}}),h=j(!1),y=()=>{d.setFilterRange(k(m.range.from),k(m.range.to)),h.value=!1};E(async()=>{o(),d.setShowFilters(!0),d.getResourceStats()}),w(()=>t.value.filterRange.from,()=>{o(),d.getResourceStats()}),w(()=>t.value.resourceStats?.samples,a=>{a?.forEach(n=>{const u=[],l=n.counts?.reduce((s,T)=>s+T.count,0)||0;n.counts?.forEach(s=>{u.push({item:s.group,count:s.count,percent:s.count/l})}),p(u,n.group,n.group)})});const x=a=>{const n=t.value.resourceStats?.instruments?.reduce((l,s)=>l+s.count,0)||0;return`${(a/n*100).toFixed(2)}%`},p=(a,n,u)=>{const l=new W({container:n,autoFit:!0,height:250,width:500});l.options({type:"view",data:a,coordinate:{type:"theta",innerRadius:.5,outerRadius:.75},scale:{color:{type:"ordinal"}},legend:!1,tooltip:{title:!1,items:[s=>({name:s.item,value:`${(s.percent*100).toFixed(2)}%`})]},interaction:{elementHighlight:!0},children:[{type:"interval",encode:{y:"percent",color:"item"},transform:[{type:"stackY"}],labels:[{text:s=>`${s.item} (${s.count})`,position:"spider",connectorDistance:8,connectorLineWidth:.5}]},{type:"text",style:{text:u,x:"50%",y:"50%",textAlign:"center",fontSize:14,fill:"hsl(var(--foreground))"}}]}),l.render()},o=()=>{const a=document.getElementById("user-matrix");a&&(a.innerHTML=`
      <div>
        <div id="registration"></div>
      </div>
      <div>
        <div id="submission"></div>
      </div>
      <div>
        <div id="verification"></div>
      </div>
      <div>
        <div id="publication"></div>
      </div>
    `)},f={dashBoardStore:d,dashboard:t,localState:m,showModal:h,setCustomRange:y,instrumentPerf:x,plotUserMatrix:p,resetUserMatrix:o,StatCard:J};return Object.defineProperty(f,"__isScriptSetup",{enumerable:!1,value:!0}),f}}),O={class:"mt-4"},Q={class:"flex justify-between mb-8"},Y={class:"flex justify-end items-center"},G=["onClick"],X={key:0,class:"text-start my-4"},Z={class:"mb-8"},$={key:0,class:"text-muted-foreground"},tt={key:1,class:"grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-4"},et={action:"post",class:"p-1"},ot={class:"grid grid-cols-2 gap-x-4 mb-4"},rt={class:"block col-span-2 mb-2"},st={class:"block col-span-2 mb-2"};function at(B,e,d,t,m,h){const y=_("VTooltip"),x=_("beak-loader"),p=_("beak-modal");return i(),c("div",O,[r("section",Q,[v(r("div",Y,[(i(!0),c(F,null,M(t.dashboard.filters,(o,f)=>v((i(),S(y,{key:f,placements:["right-start"]},{popper:g(()=>[A(b(t.dashBoardStore.filterToolTip(o)),1)]),default:g(()=>[r("button",{onClick:a=>t.dashBoardStore.setCurrentFilter(o),type:"button",class:U(["px-2 py-1 mr-2 border border-foreground text-foreground rounded-sm transition duration-300 hover:bg-primary hover:text-primary-foreground focus:outline-none",{"bg-primary text-primary-foreground":t.dashboard.currentFilter===o}])},b(o),11,G)]),_:2},1024)),[[R,o!==t.dashboard.filters[t.dashboard.filters.length]]])),128)),r("button",{onClick:e[0]||(e[0]=o=>t.showModal=!0),class:"ml-4 mr-1 px-2 py-1 border border-border text-muted-foreground rounded-sm transition duration-300 hover:bg-muted hover:text-primary-foreground focus:outline-none"},b(t.dashboard.filterRange.from)+" - "+b(t.dashboard.filterRange.to),1)],512),[[R,t.dashboard.showFilters]])]),t.dashboard.fetchingResourceStats?(i(),c("div",X,[H(x,{message:"Fetching resource stats..."})])):C("",!0),r("section",null,[r("div",Z,[e[5]||(e[5]=r("h1",{class:"text-xl text-foreground font-semibold"},"Instrument Matrix / Load",-1)),e[6]||(e[6]=r("hr",{class:"my-2"},null,-1)),t.dashboard.resourceStats?.instruments?.length?(i(),c("div",tt,[(i(!0),c(F,null,M(t.dashboard.resourceStats?.instruments,o=>(i(),S(t.StatCard,{key:o.group,title:o.group,value:t.instrumentPerf(o?.count),variant:"primary",tooltip:"Percentage of total analyses run on this instrument within the selected date range"},null,8,["title","value"]))),128))])):(i(),c("div",$," No instrument data available "))]),e[7]||(e[7]=z('<div class="mb-8"><h1 class="text-xl text-foreground font-semibold">User Matrix / Load</h1><hr class="my-2"><div class="flex flex-wrap justify-start" id="user-matrix"><div><div id="registration"></div></div><div><div id="submission"></div></div><div><div id="verification"></div></div><div><div id="publication"></div></div></div></div>',1))]),t.showModal?(i(),S(p,{key:1,onClose:e[4]||(e[4]=o=>t.showModal=!1),contentWidth:"w-1/4"},{header:g(()=>[...e[8]||(e[8]=[r("h3",null,"Custom Filter Date Range",-1)])]),body:g(()=>[r("form",et,[r("div",ot,[r("label",rt,[e[9]||(e[9]=r("span",{class:"text-foreground"},"Date From",-1)),v(r("input",{type:"datetime-local",class:"form-input mt-1 block w-full",autocomplete:"off","onUpdate:modelValue":e[1]||(e[1]=o=>t.localState.range.from=o),placeholder:"Select start date..."},null,512),[[D,t.localState.range.from]])]),r("label",st,[e[10]||(e[10]=r("span",{class:"text-foreground"},"Date To",-1)),v(r("input",{type:"datetime-local",class:"form-input mt-1 block w-full",autocomplete:"off","onUpdate:modelValue":e[2]||(e[2]=o=>t.localState.range.to=o),placeholder:"Select end date..."},null,512),[[D,t.localState.range.to]])])]),e[11]||(e[11]=r("hr",null,null,-1)),r("button",{type:"button",onClick:e[3]||(e[3]=I(o=>t.setCustomRange(),["prevent"])),class:"m-2 -mb-4 w-full rounded-sm border border-primary bg-primary px-4 py-2 text-primary-foreground transition-colors duration-500 ease select-none hover:bg-primary focus:outline-none focus:shadow-outline"}," Apply Filter ")])]),_:1})):C("",!0)])}const _t=P(K,[["render",at],["__file","/home/administrator/Documents/Development/beak-insights/felicity/felicity-lims/webapp/views/dashboard/Resource.vue"]]);export{_t as default};
