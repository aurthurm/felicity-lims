import{a0 as V,aq as L,g as N,a7 as U,ad as j,a5 as k,e as C,_ as E,r as _,c as u,o as i,E as d,A as r,C as w,F as g,H as R,J as M,K as F,N as b,Q as P,L as h,P as A,a as H,b as I,a2 as D,D as z}from"./index-DCVfsbos.js";import{C as W}from"./index-CcKktpKM.js";import{u as q}from"./dashboard-9Vqu8ukc.js";import{S as J}from"./StatCard-BABHqh4M.js";import"./index-DA5qReeD.js";import"./index-BkD7Hj8s.js";import"./ticks-yQcwDFE8.js";import"./arc-DghFiuMI.js";import"./timer-DChf79OC.js";import"./math-CyDA0WRY.js";import"./index-DaJBD5B5.js";import"./defaultLocale-D2nGpDRe.js";import"./Tableau10-1LCcg9PS.js";import"./rgb-BP_F0UyK.js";import"./range-OtVwhkKS.js";const K=V({__name:"Resource",setup(B,{expose:e}){e();const l=q(),{dashboard:t}=L(l),p=N({range:{from:"",to:""}}),y=U(!1),x=()=>{l.setFilterRange(C(p.range.from),C(p.range.to)),y.value=!1};j(async()=>{o(),l.setShowFilters(!0),l.getResourceStats()}),k(()=>t.value.filterRange.from,()=>{o(),l.getResourceStats()}),k(()=>t.value.resourceStats?.samples,a=>{a?.forEach(n=>{const m=[],c=n.counts?.reduce((s,T)=>s+T.count,0)||0;n.counts?.forEach(s=>{m.push({item:s.group,count:s.count,percent:s.count/c})}),f(m,n.group,n.group)})});const S=a=>{const n=t.value.resourceStats?.instruments?.reduce((c,s)=>c+s.count,0)||0;return`${(a/n*100).toFixed(2)}%`},f=(a,n,m)=>{const c=new W({container:n,autoFit:!0,height:250,width:500});c.options({type:"view",data:a,coordinate:{type:"theta",innerRadius:.5,outerRadius:.75},scale:{color:{type:"ordinal"}},legend:!1,tooltip:{title:!1,items:[s=>({name:s.item,value:`${(s.percent*100).toFixed(2)}%`})]},interaction:{elementHighlight:!0},children:[{type:"interval",encode:{y:"percent",color:"item"},transform:[{type:"stackY"}],labels:[{text:s=>`${s.item} (${s.count})`,position:"spider",connectorDistance:8,connectorLineWidth:.5}]},{type:"text",style:{text:m,x:"50%",y:"50%",textAlign:"center",fontSize:14,fill:"hsl(var(--foreground))"}}]}),c.render()},o=()=>{const a=document.getElementById("user-matrix");a&&(a.innerHTML=`
      <div>
        <div id="registration"></div>
      </div>
      <div>
        <div id="submission"></div>
      </div>
      <div>
        <div id="verification"></div>
      </div>
      <div>
        <div id="publication"></div>
      </div>
    `)},v={dashBoardStore:l,dashboard:t,localState:p,showModal:y,setCustomRange:x,instrumentPerf:S,plotUserMatrix:f,resetUserMatrix:o,StatCard:J};return Object.defineProperty(v,"__isScriptSetup",{enumerable:!1,value:!0}),v}}),O={class:"mt-4"},Q={class:"flex justify-between mb-8"},Y={class:"flex justify-end items-center"},G=["onClick"],X={key:0,class:"text-start my-4"},Z={class:"mb-8"},$={key:0,class:"text-muted-foreground"},tt={key:1,class:"grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-4"},et={action:"post",class:"p-1"},ot={class:"grid grid-cols-2 gap-x-4 mb-4"},rt={class:"block col-span-2 mb-2"},st={class:"block col-span-2 mb-2"};function at(B,e,l,t,p,y){const x=_("VTooltip"),S=_("beak-loader"),f=_("beak-modal");return i(),u("div",O,[d(" Filters Section "),r("section",Q,[g(r("div",Y,[(i(!0),u(M,null,F(t.dashboard.filters,(o,v)=>g((i(),w(x,{key:v,placements:["right-start"]},{popper:b(()=>[A(h(t.dashBoardStore.filterToolTip(o)),1)]),default:b(()=>[r("button",{onClick:a=>t.dashBoardStore.setCurrentFilter(o),type:"button",class:P(["px-2 py-1 mr-2 border border-foreground text-foreground rounded-sm transition duration-300 hover:bg-primary hover:text-primary-foreground focus:outline-none",{"bg-primary text-primary-foreground":t.dashboard.currentFilter===o}])},h(o),11,G)]),_:2},1024)),[[R,o!==t.dashboard.filters[t.dashboard.filters.length]]])),128)),r("button",{onClick:e[0]||(e[0]=o=>t.showModal=!0),class:"ml-4 mr-1 px-2 py-1 border border-border text-muted-foreground rounded-sm transition duration-300 hover:bg-muted hover:text-primary-foreground focus:outline-none"},h(t.dashboard.filterRange.from)+" - "+h(t.dashboard.filterRange.to),1)],512),[[R,t.dashboard.showFilters]])]),d(" Loading State "),t.dashboard.fetchingResourceStats?(i(),u("div",X,[H(S,{message:"Fetching resource stats..."})])):d("v-if",!0),d(" Content Section "),r("section",null,[d(" Instrument Matrix "),r("div",Z,[e[5]||(e[5]=r("h1",{class:"text-xl text-foreground font-semibold"},"Instrument Matrix / Load",-1)),e[6]||(e[6]=r("hr",{class:"my-2"},null,-1)),t.dashboard.resourceStats?.instruments?.length?(i(),u("div",tt,[(i(!0),u(M,null,F(t.dashboard.resourceStats?.instruments,o=>(i(),w(t.StatCard,{key:o.group,title:o.group,value:t.instrumentPerf(o?.count),variant:"primary",tooltip:"Percentage of total analyses run on this instrument within the selected date range"},null,8,["title","value"]))),128))])):(i(),u("div",$," No instrument data available "))]),d(" User Matrix "),e[7]||(e[7]=I('<div class="mb-8"><h1 class="text-xl text-foreground font-semibold">User Matrix / Load</h1><hr class="my-2"><div class="flex flex-wrap justify-start" id="user-matrix"><div><div id="registration"></div></div><div><div id="submission"></div></div><div><div id="verification"></div></div><div><div id="publication"></div></div></div></div>',1))]),d(" Custom Date Range Modal "),t.showModal?(i(),w(f,{key:1,onClose:e[4]||(e[4]=o=>t.showModal=!1),contentWidth:"w-1/4"},{header:b(()=>[...e[8]||(e[8]=[r("h3",null,"Custom Filter Date Range",-1)])]),body:b(()=>[r("form",et,[r("div",ot,[r("label",rt,[e[9]||(e[9]=r("span",{class:"text-foreground"},"Date From",-1)),g(r("input",{type:"datetime-local",class:"form-input mt-1 block w-full",autocomplete:"off","onUpdate:modelValue":e[1]||(e[1]=o=>t.localState.range.from=o),placeholder:"Select start date..."},null,512),[[D,t.localState.range.from]])]),r("label",st,[e[10]||(e[10]=r("span",{class:"text-foreground"},"Date To",-1)),g(r("input",{type:"datetime-local",class:"form-input mt-1 block w-full",autocomplete:"off","onUpdate:modelValue":e[2]||(e[2]=o=>t.localState.range.to=o),placeholder:"Select end date..."},null,512),[[D,t.localState.range.to]])])]),e[11]||(e[11]=r("hr",null,null,-1)),r("button",{type:"button",onClick:e[3]||(e[3]=z(o=>t.setCustomRange(),["prevent"])),class:"m-2 -mb-4 w-full rounded-sm border border-primary bg-primary px-4 py-2 text-primary-foreground transition-colors duration-500 ease select-none hover:bg-primary focus:outline-none focus:shadow-outline"}," Apply Filter ")])]),_:1})):d("v-if",!0)])}const St=E(K,[["render",at],["__file","/home/administrator/Documents/Development/beak-insights/beak/beak-lims/webapp/views/dashboard/Resource.vue"]]);export{St as default};
