const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/vue-multiselect.esm-CzQaAJqu.js","assets/index-B3ZheI5m.js","assets/index-C_1sfwqa.css"])))=>i.map(i=>d[i]);
import{a0 as z,a7 as h,a5 as me,b4 as pe,_ as H,c as l,o as i,Q as k,A as r,E as v,L as d,J as U,K as L,ad as fe,h as q,f as be,a1 as ve,a6 as ge,bh as ye,bi as ke,r as he,C as we,N as xe,D as _e,F as _,a2 as E,a as K,a9 as O}from"./index-B3ZheI5m.js";import{c as Ue,a as g,e as Ne,f as R,h as Ee,u as Le,b as m}from"./index.esm-C1wdlr_y.js";import{u as Ae}from"./user-BHZZlXLC.js";import{u as Ce}from"./setup-DpgcXA6u.js";const Be=z({__name:"BeakProtectedInput",props:{modelValue:{type:String,required:!0},disabled:{type:Boolean,required:!1,default:!1},placeholder:{type:String,required:!1,default:""},requiredClicks:{type:Number,required:!1,default:3},type:{type:String,required:!1,default:"text"},id:{type:String,required:!1,default:""},class:{type:String,required:!1,default:""}},emits:["update:modelValue"],setup(A,{expose:s,emit:n}){s();const e=A,p=n,y=h(!0),f=h(e.modelValue),o=h(),u=h(0),c=h();me(()=>e.modelValue,b=>{f.value=b});const C=b=>{if(!(e.disabled||!y.value)){if(b.preventDefault(),b.stopPropagation(),u.value++,c.value&&clearTimeout(c.value),u.value>=e.requiredClicks){N();return}c.value=setTimeout(()=>{u.value=0},1500)}},N=async()=>{y.value=!1,u.value=0,c.value&&clearTimeout(c.value),await pe(),o.value?.focus(),o.value?.select()},w=()=>{y.value=!0,u.value=0,c.value&&clearTimeout(c.value)},B={props:e,emit:p,isProtected:y,inputValue:f,inputRef:o,clickCount:u,clickTimeout:c,handleProtectedClick:C,unlockInput:N,lockInput:w,handleInput:b=>{const V=b.target;f.value=V.value,p("update:modelValue",V.value)},handleKeydown:b=>{b.key==="Enter"?(w(),o.value?.blur()):b.key==="Escape"&&(f.value=e.modelValue,p("update:modelValue",e.modelValue),w(),o.value?.blur())},handleBlur:()=>{setTimeout(()=>{w()},200)}};return Object.defineProperty(B,"__isScriptSetup",{enumerable:!1,value:!0}),B}}),Ve={class:"relative"},qe=["title"],Se={key:0,class:"text-foreground"},Me={key:1,class:"text-muted-foreground"},Pe={key:0,class:"absolute inset-y-0 right-0 flex items-center pr-3 pointer-events-none"},Fe={key:0,class:"flex items-center space-x-1 bg-background/95 backdrop-blur-sm px-2 py-1 rounded-md shadow-sm border border-border"},Ie={class:"flex space-x-1"},Te={class:"text-xs text-muted-foreground ml-1"},De={key:1,class:"text-muted-foreground bg-background/80 backdrop-blur-sm p-1 rounded transition-colors duration-200 group-hover:text-primary"},Ge={key:1,class:"relative"},Ke=["id","value","type","placeholder","disabled"];function Oe(A,s,n,e,p,y){return i(),l("div",Ve,[e.isProtected?(i(),l("div",{key:0,onClick:e.handleProtectedClick,class:k(["relative cursor-pointer transition-all duration-200 group select-none",n.disabled?"cursor-not-allowed opacity-50":"hover:ring-2 hover:ring-primary/20 hover:bg-primary/5",e.clickCount>0&&!n.disabled&&"ring-2 ring-primary/30 bg-primary/10"]),title:n.disabled?"Input is disabled":`Click ${n.requiredClicks} times quickly to unlock for editing (${e.clickCount}/${n.requiredClicks})`},[r("div",{class:k(["w-full px-3 py-2 bg-background border border-border rounded-md text-sm transition-colors duration-200",n.disabled?"bg-muted text-muted-foreground cursor-not-allowed":e.clickCount>0?"border-primary bg-primary/5 text-foreground":"text-foreground group-hover:border-primary/50"])},[e.inputValue?(i(),l("span",Se,d(e.inputValue),1)):(i(),l("span",Me,d(n.placeholder),1))],2),n.disabled?v("",!0):(i(),l("div",Pe,[e.clickCount>0?(i(),l("div",Fe,[r("div",Ie,[(i(!0),l(U,null,L(n.requiredClicks,f=>(i(),l("div",{key:f,class:k(["w-1.5 h-1.5 rounded-full transition-all duration-200",f<=e.clickCount?"bg-primary":"bg-muted"])},null,2))),128))]),r("span",Te,d(n.requiredClicks-e.clickCount)+" more ",1)])):(i(),l("div",De,[...s[0]||(s[0]=[r("svg",{class:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[r("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M12 15v2m-6 4h12a2 2 0 002-2v-6a2 2 0 00-2-2H6a2 2 0 00-2 2v6a2 2 0 002 2zm10-10V7a4 4 0 00-8 0v4h8z"})],-1)])]))]))],10,qe)):(i(),l("div",Ge,[r("input",{ref:"inputRef",id:n.id,value:e.inputValue,type:n.type,placeholder:n.placeholder,disabled:n.disabled,onInput:e.handleInput,onKeydown:e.handleKeydown,onBlur:e.handleBlur,class:"w-full px-3 py-2 bg-background border-2 border-primary text-foreground rounded-md text-sm placeholder:text-muted-foreground transition-colors duration-200 focus:border-primary focus:outline-none focus:ring-2 focus:ring-primary/20"},null,40,Ke),s[1]||(s[1]=r("div",{class:"absolute inset-y-0 right-0 flex items-center pr-3 pointer-events-none"},[r("div",{class:"text-primary bg-background/90 backdrop-blur-sm p-1 rounded"},[r("svg",{class:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[r("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M8 11V7a4 4 0 118 0m-4 8v2m-6 4h12a2 2 0 002-2v-6a2 2 0 00-2 2v6a2 2 0 002 2z"})])])],-1))]))])}const Re=H(Be,[["render",Oe],["__file","/home/administrator/Documents/Development/beak-insights/felicity/felicity-lims/webapp/components/ui/form/BeakProtectedInput.vue"]]),ze=z({__name:"UsersListing",setup(A,{expose:s}){s();const n=ve(()=>ge(()=>import("./vue-multiselect.esm-CzQaAJqu.js"),__vite__mapDeps([0,1,2]))),e=Ae(),p=Ce();fe(()=>{e.fetchUsers({}),e.fetchGroupsAndPermissions(),p.fetchLaboratories()});let y=q(()=>e.getUsers);const f=q(()=>e.getGroups);let o=h(!1),u=h("");const c=h(!0),C=Ue({userUid:g().nullable(),firstName:g().trim().required("First name is required"),lastName:g().trim().required("Last name is required"),email:g().trim().email("Enter a valid email").required("Email is required"),groupUid:g().trim().required("Group is required"),userName:g().trim().required("Username is required"),password:g().when("userUid",{is:t=>!t,then:t=>t.required("Password is required"),otherwise:t=>t.nullable()}),passwordc:g().when("password",{is:t=>!!t,then:t=>t.oneOf([Ee("password")],"Passwords must match").required("Confirm your password"),otherwise:t=>t.nullable()}),isActive:R().default(!0),isBlocked:R().default(!1),laboratoryUids:Ne().of(g()).default([]),activeLaboratoryUid:g().trim().nullable()}),{handleSubmit:N,resetForm:w,setValues:S}=Le({validationSchema:C,initialValues:{userUid:"",firstName:"",lastName:"",email:"",groupUid:"",userName:"",password:"",passwordc:"",isActive:!0,isBlocked:!1,laboratoryUids:[],activeLaboratoryUid:""}}),{value:F}=m("userUid"),{value:I,errorMessage:B}=m("firstName"),{value:b,errorMessage:V}=m("lastName"),{value:J,errorMessage:Q}=m("email"),{value:W,errorMessage:X}=m("groupUid"),{value:Y,errorMessage:Z}=m("userName"),{value:j,errorMessage:$}=m("password"),{value:ee,errorMessage:re}=m("passwordc"),{value:se}=m("isActive"),{value:te}=m("isBlocked"),{value:M}=m("laboratoryUids"),{value:oe,errorMessage:ae}=m("activeLaboratoryUid"),ie=q(()=>p.getLaboratories.map(t=>({...t,displayLabel:t.code?`${t.name} (${t.code})`:t.name}))),le=q({get:()=>M.value.map(t=>p.getLaboratories.find(a=>a.uid===t)).filter(Boolean).map(t=>({...t,displayLabel:t?.code?`${t.name} (${t.code})`:t?.name??""})),set:t=>{M.value=(t||[]).map(a=>a.uid)}}),{withClientMutation:P}=be();function T(t){P(ye,t,"createUser").then(a=>e.addUser(a))}function D(t){P(ke,t,"updateUser").then(a=>e.updateUser(a))}function de(t){let a=[];return t?.groups?.forEach(x=>a.push(x?.name)),a.join(", ")}const ne=t=>{const a=p.getLaboratories.find(x=>x.uid===t);return a?a?.name||"Unknown Laboratory":"-- Not Assigned --"};function ue(t,a={}){c.value=t,o.value=!0,u.value=(t?"CREATE":"EDIT")+" USER",t?w({values:{userUid:"",firstName:"",lastName:"",email:"",groupUid:"",userName:"",password:"",passwordc:"",isActive:!0,isBlocked:!1,laboratoryUids:[],activeLaboratoryUid:""}}):S({userUid:a?.uid||"",firstName:a?.firstName??"",lastName:a?.lastName??"",email:a?.email??"",groupUid:a?.groups&&a.groups[0]?a.groups[0].uid:"",userName:a?.userName??"",password:"",passwordc:"",isActive:a?.isActive??!0,isBlocked:a?.isBlocked??!1,laboratoryUids:Array.isArray(a?.laboratories)?a.laboratories.map(x=>typeof x=="string"?x:x.uid):[],activeLaboratoryUid:a?.activeLaboratoryUid||""})}const ce=N(t=>{const a={firstName:t.firstName,lastName:t.lastName,email:t.email,groupUid:t.groupUid,activeLaboratoryUid:t.activeLaboratoryUid||null,laboratoryUids:t.laboratoryUids||[],userName:t.userName};if(c.value)T({...a,password:t.password||"",passwordc:t.passwordc||""});else{if(!t.userUid)return;D({userUid:t.userUid,...a,isActive:t.isActive,isBlocked:t.isBlocked,password:t.password||void 0,passwordc:t.passwordc||void 0})}o.value=!1}),G={VueMultiselect:n,userStore:e,setupStore:p,get users(){return y},set users(t){y=t},groups:f,get showUserModal(){return o},set showUserModal(t){o=t},get formTitle(){return u},set formTitle(t){u=t},formAction:c,userSchema:C,handleSubmit:N,resetForm:w,setValues:S,userUid:F,firstName:I,firstNameError:B,lastName:b,lastNameError:V,email:J,emailError:Q,groupUid:W,groupUidError:X,userName:Y,userNameError:Z,password:j,passwordError:$,passwordc:ee,passwordcError:re,isActive:se,isBlocked:te,laboratoryUids:M,activeLaboratoryUid:oe,activeLaboratoryUidError:ae,laboratoriesForSelect:ie,selectedLaboratories:le,withClientMutation:P,addUser:T,editUser:D,userGroupsName:de,getLaboratoryName:ne,FormManager:ue,saveUserForm:ce,headers:["Full Name","Email","Active","Group","Username","Blocked","Active Laboratory","Assigned Labs","Actions"],BeakProtectedInput:Re};return Object.defineProperty(G,"__isScriptSetup",{enumerable:!1,value:!0}),G}}),He={class:"space-y-6"},Je={class:"flex justify-between items-center"},Qe={class:"bg-card rounded-lg shadow-sm"},We={class:"min-w-full divide-y divide-border beak-table"},Xe={class:"bg-background divide-y divide-border"},Ye={class:"whitespace-nowrap"},Ze={class:"whitespace-nowrap"},je={class:"whitespace-nowrap"},$e={class:"whitespace-nowrap"},er={class:"whitespace-nowrap"},rr={class:"whitespace-nowrap"},sr={class:"whitespace-nowrap"},tr={class:"whitespace-nowrap"},or={class:"whitespace-nowrap text-right"},ar=["onClick"],ir={class:"grid grid-cols-2 gap-6"},lr={class:"space-y-2"},dr={key:0,class:"text-sm text-destructive"},nr={class:"space-y-2"},ur={key:0,class:"text-sm text-destructive"},cr={class:"space-y-2"},mr={key:0,class:"text-sm text-destructive"},pr={class:"space-y-2"},fr={key:0,class:"text-sm text-destructive"},br={class:"space-y-2"},vr={key:0,class:"text-sm text-destructive"},gr={class:"space-y-2"},yr={key:0,class:"text-sm text-destructive"},kr={class:"col-span-2 space-y-2"},hr=["value"],wr={key:0,class:"text-sm text-destructive"},xr={class:"col-span-2 space-y-4 border-t border-border pt-6"},_r={class:"space-y-2"},Ur={key:0,class:"space-y-2"},Nr=["value"],Er={key:0,class:"text-sm text-destructive"},Lr={class:"flex items-center space-x-4"},Ar={class:"flex items-center space-x-2"},Cr=["aria-checked"],Br={class:"flex items-center space-x-4"},Vr={class:"flex items-center space-x-2"},qr=["aria-checked"],Sr={class:"flex justify-end pt-6"},Mr={type:"submit",class:"inline-flex justify-center rounded-md border border-transparent bg-primary px-4 py-2 text-sm font-medium text-primary-foreground hover:bg-primary/90 focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 transition-colors duration-200"};function Pr(A,s,n,e,p,y){const f=he("beak-modal");return i(),l(U,null,[r("div",He,[r("div",Je,[s[14]||(s[14]=r("h1",{class:"text-2xl font-bold text-card-foreground"},"Users",-1)),r("button",{onClick:s[0]||(s[0]=o=>e.FormManager(!0)),class:"inline-flex items-center px-4 py-2 bg-primary text-primary-foreground rounded-md hover:bg-primary/90 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-primary","aria-label":"Add new user"}," Add User ")]),r("div",Qe,[r("table",We,[r("thead",null,[r("tr",null,[(i(),l(U,null,L(e.headers,o=>r("th",{key:o,class:"text-left"},d(o),1)),64))])]),r("tbody",Xe,[(i(!0),l(U,null,L(e.users,o=>(i(),l("tr",{key:o.uid,class:"hover:bg-muted/50"},[r("td",Ye,d(o.firstName)+" "+d(o.lastName),1),r("td",Ze,d(o.email),1),r("td",je,[r("span",{class:k(["inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium",o.isActive?"bg-success/20 text-success":"bg-destructive/20 text-destructive"])},d(o.isActive?"Active":"Inactive"),3)]),r("td",$e,d(o.groups?.map(u=>u?.name).join(", ")),1),r("td",er,d(o.userName),1),r("td",rr,[r("span",{class:k(["inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium",o.isBlocked?"bg-destructive/20 text-destructive":"bg-success/20 text-success"])},d(o.isBlocked?"Blocked":"Active"),3)]),r("td",sr,d(e.getLaboratoryName(o.activeLaboratoryUid||"")),1),r("td",tr,d(o.laboratories?.length)+" Labs",1),r("td",or,[r("button",{onClick:u=>e.FormManager(!1,o),class:"text-primary hover:text-primary/80 focus:outline-none focus:underline","aria-label":"Edit user"}," Edit ",8,ar)])]))),128))])])])]),e.showUserModal?(i(),we(f,{key:0,onClose:s[13]||(s[13]=o=>e.showUserModal=!1),title:e.userUid?"Edit User":"Add User"},{body:xe(()=>[r("form",{onSubmit:s[12]||(s[12]=_e((...o)=>e.saveUserForm&&e.saveUserForm(...o),["prevent"])),class:"space-y-6"},[r("div",ir,[r("div",lr,[s[15]||(s[15]=r("label",{for:"firstName",class:"beak-label"}," First Name ",-1)),_(r("input",{id:"firstName","onUpdate:modelValue":s[1]||(s[1]=o=>e.firstName=o),type:"text",class:"beak-input",placeholder:"Enter first name"},null,512),[[E,e.firstName]]),e.firstNameError?(i(),l("p",dr,d(e.firstNameError),1)):v("",!0)]),r("div",nr,[s[16]||(s[16]=r("label",{for:"lastName",class:"beak-label"}," Last Name ",-1)),_(r("input",{id:"lastName","onUpdate:modelValue":s[2]||(s[2]=o=>e.lastName=o),type:"text",class:"beak-input",placeholder:"Enter last name"},null,512),[[E,e.lastName]]),e.lastNameError?(i(),l("p",ur,d(e.lastNameError),1)):v("",!0)]),r("div",cr,[s[17]||(s[17]=r("label",{for:"email",class:"beak-label"}," Email ",-1)),_(r("input",{id:"email","onUpdate:modelValue":s[3]||(s[3]=o=>e.email=o),type:"email",class:"beak-input",placeholder:"Enter email address"},null,512),[[E,e.email]]),e.emailError?(i(),l("p",mr,d(e.emailError),1)):v("",!0)]),r("div",pr,[s[18]||(s[18]=r("label",{for:"userName",class:"beak-label"}," Username ",-1)),K(e.BeakProtectedInput,{id:"userName",modelValue:e.userName,"onUpdate:modelValue":s[4]||(s[4]=o=>e.userName=o),type:"text","required-clicks":5,placeholder:"Enter username"},null,8,["modelValue"]),e.userNameError?(i(),l("p",fr,d(e.userNameError),1)):v("",!0)]),r("div",br,[s[19]||(s[19]=r("label",{for:"password",class:"beak-label"}," Password ",-1)),_(r("input",{id:"password","onUpdate:modelValue":s[5]||(s[5]=o=>e.password=o),type:"password",class:"beak-input",placeholder:"Enter password"},null,512),[[E,e.password]]),e.passwordError?(i(),l("p",vr,d(e.passwordError),1)):v("",!0)]),r("div",gr,[s[20]||(s[20]=r("label",{for:"passwordc",class:"beak-label"}," Confirm Password ",-1)),_(r("input",{id:"passwordc","onUpdate:modelValue":s[6]||(s[6]=o=>e.passwordc=o),type:"password",class:"beak-input",placeholder:"Confirm password"},null,512),[[E,e.passwordc]]),e.passwordcError?(i(),l("p",yr,d(e.passwordcError),1)):v("",!0)]),r("div",kr,[s[22]||(s[22]=r("label",{for:"groupUid",class:"beak-label"}," Group ",-1)),_(r("select",{id:"groupUid","onUpdate:modelValue":s[7]||(s[7]=o=>e.groupUid=o),class:"beak-select"},[s[21]||(s[21]=r("option",{value:"",class:"text-muted-foreground"},"Select a group",-1)),(i(!0),l(U,null,L(e.groups,o=>(i(),l("option",{key:o.uid,value:o.uid,class:"text-foreground"},d(o?.name),9,hr))),128))],512),[[O,e.groupUid]]),e.groupUidError?(i(),l("p",wr,d(e.groupUidError),1)):v("",!0)]),r("div",xr,[s[26]||(s[26]=r("h4",{class:"text-base font-medium text-foreground"},"Laboratory Access (Optional)",-1)),r("div",_r,[s[23]||(s[23]=r("label",{class:"beak-label"},"Assigned Laboratories",-1)),K(e.VueMultiselect,{modelValue:e.selectedLaboratories,"onUpdate:modelValue":s[8]||(s[8]=o=>e.selectedLaboratories=o),options:e.laboratoriesForSelect,multiple:!0,"close-on-select":!1,"use-teleport":!0,label:"displayLabel","track-by":"uid",placeholder:"Select laboratories",class:"multiselect-primary"},null,8,["modelValue","options"])]),e.laboratoryUids&&e.laboratoryUids.length>0?(i(),l("div",Ur,[s[25]||(s[25]=r("label",{class:"beak-label"},"Default Active Laboratory",-1)),_(r("select",{"onUpdate:modelValue":s[9]||(s[9]=o=>e.activeLaboratoryUid=o),class:"beak-select"},[s[24]||(s[24]=r("option",{value:""},"Select default laboratory...",-1)),(i(!0),l(U,null,L(e.laboratoryUids,o=>(i(),l("option",{key:o,value:o,class:"text-foreground"},d(e.getLaboratoryName(o)),9,Nr))),128))],512),[[O,e.activeLaboratoryUid]]),e.activeLaboratoryUidError?(i(),l("p",Er,d(e.activeLaboratoryUidError),1)):v("",!0)])):v("",!0)]),r("div",Lr,[r("label",Ar,[s[27]||(s[27]=r("span",{class:"text-sm font-medium text-foreground"},"Blocked",-1)),r("button",{type:"button",role:"switch","aria-checked":e.isBlocked,onClick:s[10]||(s[10]=o=>e.isBlocked=!e.isBlocked),class:k(["relative inline-flex h-6 w-11 shrink-0 cursor-pointer rounded-full border-2 border-transparent transition-colors duration-200 ease-in-out focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 shadow-sm",[e.isBlocked?"bg-destructive":"bg-success"]])},[r("span",{"aria-hidden":"true",class:k(["pointer-events-none inline-block h-5 w-5 transform rounded-full bg-background shadow ring-0 transition duration-200 ease-in-out",[e.isBlocked?"translate-x-5":"translate-x-0"]])},null,2)],10,Cr)])]),r("div",Br,[r("label",Vr,[s[28]||(s[28]=r("span",{class:"text-sm font-medium text-foreground"},"Active",-1)),r("button",{type:"button",role:"switch","aria-checked":e.isActive,onClick:s[11]||(s[11]=o=>e.isActive=!e.isActive),class:k(["relative inline-flex h-6 w-11 shrink-0 cursor-pointer rounded-full border-2 border-transparent transition-colors duration-200 ease-in-out focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 shadow-sm",[e.isActive?"bg-success":"bg-destructive"]])},[r("span",{"aria-hidden":"true",class:k(["pointer-events-none inline-block h-5 w-5 transform rounded-full bg-background shadow ring-0 transition duration-200 ease-in-out",[e.isActive?"translate-x-5":"translate-x-0"]])},null,2)],10,qr)])])]),r("div",Sr,[r("button",Mr,d(e.userUid?"Update":"Create")+" User ",1)])],32)]),_:1},8,["title"])):v("",!0)],64)}const Kr=H(ze,[["render",Pr],["__scopeId","data-v-0b494f3a"],["__file","/home/administrator/Documents/Development/beak-insights/felicity/felicity-lims/webapp/views/admin/users/UsersListing.vue"]]);export{Kr as default};
