import{a0 as h,ax as F,a7 as v,g as S,ad as R,ay as V,_ as Y,r as _,c as d,o as s,A as e,C as M,E as g,a as B,J as w,K as k,L as n,Q as P,N as L,D as E,F as a,a9 as p,a2 as D}from"./index-DCVfsbos.js";import{u as U}from"./analysis-BI7XPyQA.js";import{f as A}from"./index-Cw3weLtk.js";const H=h({__name:"LineListing",setup(C,{expose:t}){t();const m=U(),{reports:r,fetchReports:b,generateReport:f,deleteReport:c}=F(),l=v(!1),o=v(!1),u=S({listingForm:{report_type:"",analyses_uids:[],sample_states:[],date_column:"",period_start:"",period_end:""}});R(async()=>{l.value=!0,m.fetchAnalysesServices({first:void 0,after:"",text:"",sortBy:["name"]}),await b().finally(()=>{l.value=!1})});const x={analysisStore:m,reports:r,fetchReports:b,generateReport:f,deleteReport:c,isLoading:l,showForm:o,state:u,saveListingForm:()=>{f({...u.listingForm}),o.value=!1},downloadReport:y=>{const i=document.createElement("a");i.download=y.report_type+"-"+y.crated_at,i.href=V+"/"+y.location,document.body.appendChild(i),i.click(),document.body.removeChild(i)},get formatDate(){return A}};return Object.defineProperty(x,"__isScriptSetup",{enumerable:!1,value:!0}),x}}),T={class:"mt-4"},j={class:"flex justify-between items-center mb-4"},G={key:0,class:"text-center py-4"},N={key:1,class:"text-center py-4 text-muted-foreground"},q={key:2,class:"overflow-x-auto"},I={class:"min-w-full bg-background shadow rounded-sm border border-foreground beak-table"},O={class:"px-4 py-2 border-b border-foreground text-primary"},z={class:"px-4 py-2 border-b border-foreground text-primary"},J={class:"px-4 py-2 border-b border-foreground text-primary"},K={class:"px-4 py-2 border-b border-foreground text-primary"},Q={class:"px-4 py-2 border-b border-foreground text-primary"},W={class:"px-4 py-2 border-b border-foreground"},X={class:"px-4 py-2 border-b border-foreground text-right space-x-2"},Z=["onClick"],$=["onClick"],ee={class:"grid grid-cols-3 gap-4"},te=["value"],oe={class:"grid grid-cols-3 gap-4"},re={class:"flex justify-end space-x-2"},se=["disabled"];function de(C,t,m,r,b,f){const c=_("beak-loader"),l=_("beak-modal");return s(),d("div",T,[e("div",j,[t[9]||(t[9]=e("h1",{class:"text-xl text-foreground font-semibold"},"Line Listing Reports",-1)),e("button",{class:"bg-primary text-primary-foreground px-4 py-2 rounded-md hover:bg-primary/90",onClick:t[0]||(t[0]=o=>r.showForm=!0)}," Generate Report ")]),r.isLoading?(s(),d("div",G,[B(c,{message:"Loading reports..."})])):r.reports?.length?(s(),d("div",q,[e("table",I,[t[12]||(t[12]=e("thead",null,[e("tr",null,[e("th",{class:"px-4 py-2 border-b border-foreground text-left text-foreground"},[e("input",{type:"checkbox"})]),e("th",{class:"px-4 py-2 border-b border-foreground text-left text-foreground"}," Report Type "),e("th",{class:"px-4 py-2 border-b border-foreground text-left text-foreground"}," Generated By "),e("th",{class:"px-4 py-2 border-b border-foreground text-left text-foreground"}," Date Generated "),e("th",{class:"px-4 py-2 border-b border-foreground text-left text-foreground"}," Period Start "),e("th",{class:"px-4 py-2 border-b border-foreground text-left text-foreground"}," Period End "),e("th",{class:"px-4 py-2 border-b border-foreground text-left text-foreground"}," Status "),e("th",{class:"px-4 py-2 border-b border-foreground"})])],-1)),e("tbody",null,[(s(!0),d(w,null,k(r.reports,o=>(s(),d("tr",{key:o.uid,class:"hover:bg-accent/50"},[t[11]||(t[11]=e("td",{class:"px-4 py-2 border-b border-foreground"},[e("input",{type:"checkbox"})],-1)),e("td",O,n(o.report_type),1),e("td",z,n(o?.created_by?.first_name)+" "+n(o?.created_by?.last_name),1),e("td",J,n(r.formatDate(o?.created_at,"YYYY-MM-DD HH:mm")),1),e("td",K,n(r.formatDate(o?.period_start,"YYYY-MM-DD HH:mm")),1),e("td",Q,n(r.formatDate(o?.period_end,"YYYY-MM-DD HH:mm")),1),e("td",W,[e("span",{class:P([{"bg-success/10 text-success":o?.status?.toLocaleLowerCase()==="ready","bg-warning/10 text-warning":o?.status?.toLocaleLowerCase()==="processing","bg-destructive/10 text-destructive":o?.status?.toLocaleLowerCase()==="failed"},"px-2 py-1 rounded-full text-sm"])},n(o?.status),3)]),e("td",X,[o.status?.toLowerCase()==="ready"?(s(),d("button",{key:0,class:"px-3 py-1 border border-primary text-primary rounded-md hover:bg-primary hover:text-primary-foreground",onClick:u=>r.downloadReport(o)}," Download ",8,Z)):g("v-if",!0),["ready","failed","pending"].includes(o.status?.toLowerCase()??"")?(s(),d("button",{key:1,class:"px-3 py-1 border border-destructive text-destructive rounded-md hover:bg-destructive hover:text-destructive-foreground",onClick:u=>r.deleteReport(o)}," Delete ",8,$)):g("v-if",!0)])]))),128))])])])):(s(),d("div",N,[...t[10]||(t[10]=[e("p",{class:"text-destructive"},"There are no downloaded reports yet",-1),e("hr",{class:"my-2"},null,-1),e("p",{class:"italic"}," Once a download request has been made, your reports will appear here ",-1)])])),r.showForm?(s(),M(l,{key:3,onClose:t[8]||(t[8]=o=>r.showForm=!1),"content-width":"w-3/4"},{header:L(()=>[...t[13]||(t[13]=[e("h3",{class:"text-lg font-semibold text-foreground"},"Generate Line Listing Report",-1)])]),body:L(()=>[e("form",{onSubmit:E(r.saveListingForm,["prevent"]),class:"space-y-4"},[e("div",ee,[e("div",null,[t[15]||(t[15]=e("label",{class:"block text-sm font-medium text-foreground mb-1"},"Report Type",-1)),a(e("select",{"onUpdate:modelValue":t[1]||(t[1]=o=>r.state.listingForm.report_type=o),class:"w-full px-3 py-2 border border-input rounded-md"},[...t[14]||(t[14]=[e("option",{value:"line_listing"},"Line Listing",-1)])],512),[[p,r.state.listingForm.report_type]])]),e("div",null,[t[16]||(t[16]=e("label",{class:"block text-sm font-medium text-foreground mb-1"},"Analyses",-1)),a(e("select",{"onUpdate:modelValue":t[2]||(t[2]=o=>r.state.listingForm.analyses_uids=o),class:"w-full px-3 py-2 border border-input rounded-md",multiple:""},[(s(!0),d(w,null,k(r.analysisStore.analysesServices,o=>(s(),d("option",{key:o.uid,value:o.uid},n(o.name),9,te))),128))],512),[[p,r.state.listingForm.analyses_uids]])]),e("div",null,[t[18]||(t[18]=e("label",{class:"block text-sm font-medium text-foreground mb-1"},"States",-1)),a(e("select",{"onUpdate:modelValue":t[3]||(t[3]=o=>r.state.listingForm.sample_states=o),class:"w-full px-3 py-2 border border-input rounded-md",multiple:""},[...t[17]||(t[17]=[e("option",{value:"published"},"Published",-1),e("option",{value:"verified"},"Verified",-1),e("option",{value:"to_be_verified"},"To Be Verified",-1),e("option",{value:"received"},"Received",-1),e("option",{value:"cancelled"},"Cancelled",-1),e("option",{value:"rejected"},"Rejected",-1),e("option",{value:"invalidated"},"Invalidated",-1),e("option",{value:"due"},"Due",-1)])],512),[[p,r.state.listingForm.sample_states]])])]),e("div",oe,[e("div",null,[t[20]||(t[20]=e("label",{class:"block text-sm font-medium text-foreground mb-1"},"Period Date Criteria",-1)),a(e("select",{"onUpdate:modelValue":t[4]||(t[4]=o=>r.state.listingForm.date_column=o),class:"w-full px-3 py-2 border border-input rounded-md"},[...t[19]||(t[19]=[e("option",{value:"created_at"},"Created Date",-1),e("option",{value:"date_published"},"Published Date",-1),e("option",{value:"date_submitted"},"Submission Date",-1),e("option",{value:"date_verified"},"Verified Date",-1),e("option",{value:"date_cancelled"},"Cancellation Date",-1),e("option",{value:"date_invalidated"},"Invalidation Date",-1)])],512),[[p,r.state.listingForm.date_column]])]),e("div",null,[t[21]||(t[21]=e("label",{class:"block text-sm font-medium text-foreground mb-1"},"Period Start",-1)),a(e("input",{"onUpdate:modelValue":t[5]||(t[5]=o=>r.state.listingForm.period_start=o),type:"datetime-local",class:"w-full px-3 py-2 border border-input rounded-md",required:""},null,512),[[D,r.state.listingForm.period_start]])]),e("div",null,[t[22]||(t[22]=e("label",{class:"block text-sm font-medium text-foreground mb-1"},"Period End",-1)),a(e("input",{"onUpdate:modelValue":t[6]||(t[6]=o=>r.state.listingForm.period_end=o),type:"datetime-local",class:"w-full px-3 py-2 border border-input rounded-md",required:""},null,512),[[D,r.state.listingForm.period_end]])])]),e("div",re,[e("button",{type:"button",class:"px-4 py-2 border border-input rounded-md hover:bg-accent",onClick:t[7]||(t[7]=o=>r.showForm=!1)}," Cancel "),e("button",{type:"submit",class:"px-4 py-2 bg-primary text-primary-foreground rounded-md hover:bg-primary/90",disabled:r.isLoading}," Generate ",8,se)])],32)]),_:1})):g("v-if",!0)])}const pe=Y(H,[["render",de],["__file","/home/administrator/Documents/Development/beak-insights/beak/beak-lims/webapp/views/dashboard/LineListing.vue"]]);export{pe as default};
