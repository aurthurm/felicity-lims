import{a0 as Z,f as $,t as ee,a5 as f,a7 as B,_ as te,c as p,o as m,A as t,D as M,F as a,a2 as g,L as d,a9 as P,J as h,K as A,H as oe,a3 as se}from"./index-B3ZheI5m.js";import{c as j,d as T,u as C,b as c,f as ne,a as v}from"./index.esm-C1wdlr_y.js";import{E as ie,a as re,b as ue,c as le}from"./billing.mutations-DdDRIHbu.js";import{u as ae}from"./billing-CgiyGpDP.js";import"./billing.queries-BnMgH4Vz.js";const de=Z({__name:"Billing",props:{target:{type:String,required:!0},targetUid:{type:String,required:!0}},setup(V,{expose:e}){e();const i=ae(),{withClientMutation:s}=$(),y=V,{target:u,targetUid:o}=ee(y),b=()=>{i.clear(),u?.value==="profile"&&(i.fetchProfilePrice(o.value),i.fetchProfileDiscount(o.value)),u?.value==="analysis"&&(i.fetchAnalysisPrice(o.value),i.fetchAnalysisDiscount(o.value)),i.fetchVouchers()};b(),f(()=>u.value,(n,l)=>b()),f(()=>o.value,(n,l)=>b());const U=j({amount:T().min(0,"Amount must be 0 or greater").required("Amount is required")}),{handleSubmit:_,errors:I,setFieldValue:x}=C({validationSchema:U,initialValues:{amount:0}}),{value:z}=c("amount");f(()=>i.fetchingPrice,(n,l)=>{n||(u?.value==="profile"&&x("amount",i.profilePrice?.amount??0),u?.value==="analysis"&&x("amount",i.analysisPrice?.amount??0))});const L=_(n=>{const l={amount:n.amount};let r=u.value=="profile"?i.profilePrice:i.analysisPrice;u?.value==="profile"?s(ie,{uid:r.uid,payload:l},"updateProfilePrice").then():s(re,{uid:r.uid,payload:l},"updateAnalysisPrice").then()}),w=j({discountType:v().required("Discount type is required"),valueType:v().required("Value type is required"),startDate:v().nullable(),endDate:v().nullable(),voucherUid:v().nullable().when("discountType",{is:"voucher",then:n=>n.required("Voucher is required")}),valuePercent:T().min(0,"Value percent must be 0 or greater").max(100,"Value percent must be 100 or less").nullable().when("valueType",{is:"percentage",then:n=>n.required("Value percent is required")}),valueAmount:T().min(0,"Value amount must be 0 or greater").nullable().when("valueType",{is:"amount",then:n=>n.required("Value amount is required")}),isActive:ne().nullable()}),{handleSubmit:S,errors:H,setValues:k,setFieldValue:E}=C({validationSchema:w,initialValues:{discountType:"",valueType:"",startDate:"",endDate:"",voucherUid:null,valuePercent:0,valueAmount:0,isActive:!0}}),{value:q}=c("discountType"),{value:J}=c("valueType"),{value:K}=c("startDate"),{value:N}=c("endDate"),{value:O}=c("voucherUid"),{value:R}=c("valuePercent"),{value:G}=c("valueAmount"),{value:Q}=c("isActive");f(()=>i.fetchingDiscount,(n,l)=>{if(!n){let r={};u?.value==="profile"&&(r={...i.profileDiscount}),u?.value==="analysis"&&(r={...i.analysisDiscount}),k({discountType:r.discountType??"",valueType:r.valueType??"",startDate:D(r.startDate)||"",endDate:D(r.endDate)||"",voucherUid:r.voucherUid??null,valuePercent:r.valuePercent??0,valueAmount:r.valueAmount??0,isActive:r.isActive??!0})}});const W=B(["sale","voucher"]),X=B(["percentage","amount"]),D=n=>n?n.split("T")[0]??"":"",Y=S(n=>{const l={...n};let r=u.value=="profile"?i.profileDiscount:i.analysisDiscount;u.value=="profile"?s(ue,{uid:r.uid,payload:l},"updateProfileDiscount").then():s(le,{uid:r.uid,payload:l},"updateAnalysisDiscount").then()});f(()=>q.value,(n,l)=>{n!=="voucher"&&E("voucherUid",null)});const F={billingStore:i,withClientMutation:s,props:y,target:u,targetUid:o,getProfileAndPrices:b,pricingSchema:U,handlePricingSubmit:_,pricingErrors:I,setPricingFieldValue:x,amount:z,updatePricing:L,discountSchema:w,handleDiscountSubmit:S,discountErrors:H,setDiscountValues:k,setDiscountFieldValue:E,discountType:q,valueType:J,startDate:K,endDate:N,voucherUid:O,valuePercent:R,valueAmount:G,isActive:Q,discountTypes:W,valueTypes:X,toDateInputFormat:D,updateDiscounting:Y};return Object.defineProperty(F,"__isScriptSetup",{enumerable:!1,value:!0}),F}}),ce={class:"grid grid-cols-12 gap-4 p-4"},pe={class:"col-span-6"},me={class:"space-y-3"},fe={class:"rounded-lg border border-border bg-card p-4"},ge={class:"space-y-4"},ve={class:"space-y-2"},be={class:"relative"},ye={class:"text-sm text-destructive"},xe={class:"col-span-6"},De={class:"space-y-3"},Pe={class:"rounded-lg border border-border bg-card p-4"},he={class:"grid grid-cols-2 gap-4"},Ae={class:"space-y-2"},Te=["value"],Ve={class:"text-sm text-destructive"},Ue={class:"space-y-2"},_e=["value"],we={class:"text-sm text-destructive"},Se={class:"grid grid-cols-2 gap-4"},ke={class:"space-y-2"},Ee={class:"space-y-2"},qe={class:"space-y-2"},Fe=["value"],Be={class:"text-sm text-destructive"},Me={class:"grid grid-cols-2 gap-4"},je={class:"space-y-2"},Ce={class:"text-sm text-destructive"},Ie={class:"space-y-2"},ze={class:"relative"},Le={class:"text-sm text-destructive"},He={class:"flex items-center space-x-2"};function Je(V,e,i,s,y,u){return m(),p("div",ce,[t("section",pe,[t("div",me,[e[14]||(e[14]=t("div",{class:"flex items-center justify-between"},[t("h3",{class:"text-lg font-semibold text-foreground"},"Pricing Information")],-1)),t("div",fe,[t("form",{class:"space-y-4",onSubmit:e[1]||(e[1]=M((...o)=>s.updatePricing&&s.updatePricing(...o),["prevent"]))},[t("div",ge,[t("label",ve,[e[12]||(e[12]=t("span",{class:"text-sm font-medium text-muted-foreground"},"Amount ($)",-1)),t("div",be,[e[11]||(e[11]=t("span",{class:"absolute left-3 top-1/2 -translate-y-1/2 text-muted-foreground"},"$",-1)),a(t("input",{class:"w-full pl-8 px-3 py-2 border border-input bg-background text-foreground rounded-lg focus:outline-none focus:ring-2 focus:ring-ring placeholder:text-muted-foreground","onUpdate:modelValue":e[0]||(e[0]=o=>s.amount=o),type:"number",min:"0.0",step:"0.1",placeholder:"0.00"},null,512),[[g,s.amount]])]),t("div",ye,d(s.pricingErrors.amount),1)])]),e[13]||(e[13]=t("button",{type:"submit",class:"w-full bg-primary text-primary-foreground hover:bg-primary/90 rounded-lg px-4 py-2 text-sm font-medium transition-colors duration-200 focus:outline-none focus:ring-2 focus:ring-ring"}," Update Pricing ",-1))],32)])])]),t("section",xe,[t("div",De,[e[28]||(e[28]=t("div",{class:"flex items-center justify-between"},[t("h3",{class:"text-lg font-semibold text-foreground"},"Discounts Information")],-1)),t("div",Pe,[t("form",{class:"space-y-4",onSubmit:e[10]||(e[10]=M((...o)=>s.updateDiscounting&&s.updateDiscounting(...o),["prevent"]))},[t("div",he,[t("label",Ae,[e[16]||(e[16]=t("span",{class:"text-sm font-medium text-muted-foreground"},"Discount Type",-1)),a(t("select",{class:"w-full px-3 py-2 border border-input bg-background text-foreground rounded-lg focus:outline-none focus:ring-2 focus:ring-ring","onUpdate:modelValue":e[2]||(e[2]=o=>s.discountType=o)},[e[15]||(e[15]=t("option",{value:""},"Select type",-1)),(m(!0),p(h,null,A(s.discountTypes,o=>(m(),p("option",{key:o,value:o,class:"capitalize"},d(o),9,Te))),128))],512),[[P,s.discountType]]),t("div",Ve,d(s.discountErrors.discountType),1)]),t("label",Ue,[e[18]||(e[18]=t("span",{class:"text-sm font-medium text-muted-foreground"},"Value Type",-1)),a(t("select",{class:"w-full px-3 py-2 border border-input bg-background text-foreground rounded-lg focus:outline-none focus:ring-2 focus:ring-ring","onUpdate:modelValue":e[3]||(e[3]=o=>s.valueType=o)},[e[17]||(e[17]=t("option",{value:""},"Select type",-1)),(m(!0),p(h,null,A(s.valueTypes,o=>(m(),p("option",{key:o,value:o,class:"capitalize"},d(o),9,_e))),128))],512),[[P,s.valueType]]),t("div",we,d(s.discountErrors.valueType),1)])]),t("div",Se,[t("label",ke,[e[19]||(e[19]=t("span",{class:"text-sm font-medium text-muted-foreground"},"Start Date",-1)),a(t("input",{class:"w-full px-3 py-2 border border-input bg-background text-foreground rounded-lg focus:outline-none focus:ring-2 focus:ring-ring","onUpdate:modelValue":e[4]||(e[4]=o=>s.startDate=o),type:"date"},null,512),[[g,s.startDate]])]),t("label",Ee,[e[20]||(e[20]=t("span",{class:"text-sm font-medium text-muted-foreground"},"End Date",-1)),a(t("input",{class:"w-full px-3 py-2 border border-input bg-background text-foreground rounded-lg focus:outline-none focus:ring-2 focus:ring-ring","onUpdate:modelValue":e[5]||(e[5]=o=>s.endDate=o),type:"date"},null,512),[[g,s.endDate]])])]),a(t("div",qe,[t("label",null,[e[22]||(e[22]=t("span",{class:"text-sm font-medium text-muted-foreground"},"Voucher",-1)),a(t("select",{class:"w-full px-3 py-2 border border-input bg-background text-foreground rounded-lg focus:outline-none focus:ring-2 focus:ring-ring mt-2","onUpdate:modelValue":e[6]||(e[6]=o=>s.voucherUid=o)},[e[21]||(e[21]=t("option",{value:""},"Select voucher",-1)),(m(!0),p(h,null,A(s.billingStore.vouchers,o=>(m(),p("option",{key:o.uid,value:o.uid},d(o.code),9,Fe))),128))],512),[[P,s.voucherUid]]),t("div",Be,d(s.discountErrors.voucherUid),1)])],512),[[oe,s.discountType==="voucher"]]),t("div",Me,[t("label",je,[e[23]||(e[23]=t("span",{class:"text-sm font-medium text-muted-foreground"},"Value Percentage (%)",-1)),a(t("input",{class:"w-full px-3 py-2 border border-input bg-background text-foreground rounded-lg focus:outline-none focus:ring-2 focus:ring-ring","onUpdate:modelValue":e[7]||(e[7]=o=>s.valuePercent=o),type:"number",min:"0",max:"100",step:"0.1",placeholder:"0.00"},null,512),[[g,s.valuePercent]]),t("div",Ce,d(s.discountErrors.valuePercent),1)]),t("label",Ie,[e[25]||(e[25]=t("span",{class:"text-sm font-medium text-muted-foreground"},"Value Amount ($)",-1)),t("div",ze,[e[24]||(e[24]=t("span",{class:"absolute left-3 top-1/2 -translate-y-1/2 text-muted-foreground"},"$",-1)),a(t("input",{class:"w-full pl-8 px-3 py-2 border border-input bg-background text-foreground rounded-lg focus:outline-none focus:ring-2 focus:ring-ring","onUpdate:modelValue":e[8]||(e[8]=o=>s.valueAmount=o),type:"number",min:"0",step:"0.1",placeholder:"0.00"},null,512),[[g,s.valueAmount]])]),t("div",Le,d(s.discountErrors.valueAmount),1)])]),t("div",He,[a(t("input",{type:"checkbox",id:"isActive","onUpdate:modelValue":e[9]||(e[9]=o=>s.isActive=o),class:"h-4 w-4 rounded border-input bg-background text-primary focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2"},null,512),[[se,s.isActive]]),e[26]||(e[26]=t("label",{for:"isActive",class:"text-sm font-medium text-muted-foreground"},"Active",-1))]),e[27]||(e[27]=t("button",{type:"submit",class:"w-full bg-primary text-primary-foreground hover:bg-primary/90 rounded-lg px-4 py-2 text-sm font-medium transition-colors duration-200 focus:outline-none focus:ring-2 focus:ring-ring"}," Update Discount ",-1))],32)])])])])}const Qe=te(de,[["render",Je],["__file","/home/administrator/Documents/Development/beak-insights/felicity/felicity-lims/webapp/views/admin/analyses/Billing.vue"]]);export{Qe as default};
