import{a0 as se,f as oe,a7 as v,g as ne,h as V,i as ae,_ as re,r as w,c as r,o as a,A as e,E as l,C as ie,a as h,N as y,P as D,J as b,K as S,Q as le,D as A,L as u,F as U,a3 as de,b as ce,a2 as q,a9 as me}from"./index-DCVfsbos.js";import{c as ue,f as pe,a as F,u as fe,b as E}from"./index.esm-89YX2EbQ.js";import{m as ge,n as ye}from"./analyses.mutations-BEU63HnJ.js";import{u as ve}from"./setup-DMRnqeyP.js";import{u as be}from"./analysis-BI7XPyQA.js";const xe=se({__name:"AnalysesTemplates",setup(O,{expose:t}){t();const p=be(),s=ve(),{withClientMutation:k}=oe(),{toastSuccess:T}=ae();let f=v(!1),x=v("");const _=v(!0),g=v(null),o=v(!1),d=v(!1);let c=ne({});const H=V(()=>s.getDepartments);p.fetchAnalysesServices({}),p.fetchAnalysesTemplates();const C=V(()=>p.getAnalysesServices),I=V(()=>p.getAnalysesTemplates),N=ue({name:F().trim().required("Template name is required"),description:F().trim().nullable(),departmentUid:F().trim().nullable(),active:pe().default(!0)}),{handleSubmit:j,resetForm:L,setValues:B}=fe({validationSchema:N,initialValues:{name:"",description:"",departmentUid:"",active:!0}}),{value:J,errorMessage:K}=E("name"),{value:Q,errorMessage:R}=E("description"),{value:Y,errorMessage:G}=E("departmentUid"),{value:W}=E("active");function z(n){return k(ge,{payload:{name:n.name,description:n.description,departmentUid:n.departmentUid}},"createAnalysisTemplate").then(m=>{p.addAnalysisTemplate(m),T("Template created successfully")})}function M(n){if(!g.value)return Promise.resolve();const m=c.analyses?.map(i=>i.uid)??[];return k(ye,{uid:g.value,payload:{name:n.name,description:n.description,departmentUid:n.departmentUid,services:m}},"updateAnalysisTemplate").then(i=>{p.updateAnalysesTemplate(i),T("Template updated successfully")})}function X(n){Object.assign(c,{...n}),g.value=n.uid??null,C.value?.forEach(m=>{m[1].forEach(i=>{i.checked=!1,n.analyses?.some(te=>te.uid===i.uid)&&(i.checked=!0)})})}async function Z(){const n=[];C.value?.forEach(m=>{m[1].forEach(i=>{i.checked&&n.push(i)})}),c.analyses=n,d.value=!0;try{await M({name:c.name??"",description:c.description??null,departmentUid:c.departmentUid??null})}finally{d.value=!1}}function $(n,m){if(_.value=n,f.value=!0,x.value=(n?"CREATE":"EDIT")+" ANALYSES TEMPLATE",n)g.value=null,L({values:{name:"",description:"",departmentUid:"",active:!0}});else{const i=m??c;g.value=i?.uid??null,B({name:i?.name??"",description:i?.description??"",departmentUid:i?.departmentUid??"",active:i?.active??!0})}}const ee=j(async n=>{const m={name:n.name,description:n.description??null,departmentUid:n.departmentUid?n.departmentUid:null};o.value=!0;try{_.value===!0?await z(m):await M(m),f.value=!1}finally{o.value=!1}}),P={analysisStore:p,setupStore:s,withClientMutation:k,toastSuccess:T,get showModal(){return f},set showModal(n){f=n},get formTitle(){return x},set formTitle(n){x=n},formAction:_,currentUid:g,formSaving:o,templateUpdating:d,get analysisTemplate(){return c},set analysisTemplate(n){c=n},departments:H,analysesServices:C,analysesTemplates:I,templateSchema:N,handleSubmit:j,resetForm:L,setValues:B,name:J,nameError:K,description:Q,descriptionError:R,departmentUid:Y,departmentError:G,active:W,addAnalysisTemplate:z,editAnalysisTemplate:M,select:X,updateTemplate:Z,FormManager:$,saveForm:ee};return Object.defineProperty(P,"__isScriptSetup",{enumerable:!1,value:!0}),P}}),_e={class:"space-y-6"},he={class:"grid grid-cols-12 gap-6"},ke={class:"col-span-3"},Te={class:"rounded-lg border border-border bg-card"},we={class:"overflow-y-auto max-h-[540px] p-2"},Se={class:"space-y-1"},Ae=["onClick"],Ue={class:"flex items-center justify-between"},Ee={class:"text-sm font-medium"},Ce={key:0,class:"text-xs text-muted-foreground"},Me={key:0,class:"text-xs text-muted-foreground mt-1 line-clamp-2"},Ve={key:0,class:"col-span-9"},De={class:"space-y-6"},Fe={class:"rounded-lg border border-border bg-card p-6"},Ne={class:"flex items-center justify-between"},je={class:"space-y-1"},Le={class:"text-xl font-semibold text-foreground"},Be={key:0,class:"text-sm text-muted-foreground"},ze={class:"flex items-center space-x-2"},Pe={class:"rounded-lg border border-border bg-card flex flex-col min-h-0"},qe={class:"flex items-center justify-between gap-4 px-4 py-3 border-b border-border bg-muted/30 shrink-0"},Oe={class:"overflow-y-auto overscroll-contain flex-1 min-h-[200px] max-h-[420px] p-4"},He={class:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-3"},Ie={class:"text-sm truncate"},Je={class:"space-y-0.5 py-1"},Ke=["onClick"],Qe=["id","onUpdate:modelValue"],Re=["for"],Ye={class:"text-xl font-semibold text-foreground"},Ge={class:"space-y-4"},We={class:"space-y-2"},Xe={key:0,class:"text-sm text-destructive"},Ze={class:"space-y-2"},$e=["value"],et={key:0,class:"text-sm text-destructive"},tt={class:"space-y-2"},st={key:0,class:"text-sm text-destructive"},ot={class:"pt-4"};function nt(O,t,p,s,k,T){const f=w("beak-button"),x=w("beak-heading"),_=w("beak-accordion"),g=w("beak-modal");return a(),r(b,null,[e("div",_e,[h(x,{title:"Analyses Templates"},{default:y(()=>[h(f,{onClick:t[0]||(t[0]=o=>s.FormManager(!0))},{default:y(()=>[...t[10]||(t[10]=[D("Add Analyses Template",-1)])]),_:1})]),_:1}),e("div",he,[l(" Templates List "),e("section",ke,[e("div",Te,[t[11]||(t[11]=e("div",{class:"p-4 border-b border-border"},[e("h3",{class:"text-sm font-medium text-muted-foreground"},"Templates")],-1)),e("div",we,[e("ul",Se,[(a(!0),r(b,null,S(s.analysesTemplates,o=>(a(),r("li",{key:o.uid,onClick:A(d=>s.select(o),["prevent","stop"]),class:le(["rounded-md p-2 cursor-pointer transition-colors duration-200 border-l-4",o?.uid===s.analysisTemplate?.uid?"border-l-primary bg-primary/10 text-primary font-medium":"border-l-transparent hover:bg-accent/50 hover:border-l-primary/30"])},[e("div",Ue,[e("span",Ee,u(o?.name),1),o?.department?.name?(a(),r("span",Ce,u(o?.department?.name),1)):l("v-if",!0)]),o?.description?(a(),r("p",Me,u(o?.description),1)):l("v-if",!0)],10,Ae))),128))])])])]),l(" Template Details "),s.analysisTemplate?.uid!==void 0?(a(),r("section",Ve,[e("div",De,[l(" Header "),e("div",Fe,[e("div",Ne,[e("div",je,[e("h2",Le,u(s.analysisTemplate?.name),1),s.analysisTemplate?.description?(a(),r("p",Be,u(s.analysisTemplate?.description),1)):l("v-if",!0)]),e("div",ze,[e("button",{onClick:t[1]||(t[1]=o=>s.FormManager(!1,s.analysisTemplate)),class:"inline-flex items-center justify-center h-9 w-9 rounded-md border border-input bg-background text-foreground hover:bg-accent hover:text-accent-foreground transition-colors focus:outline-none focus:ring-2 focus:ring-ring"},[...t[12]||(t[12]=[e("svg",{class:"w-4 h-4",viewBox:"0 0 20 20"},[e("path",{d:"M13.586 3.586a2 2 0 112.828 2.828l-.793.793-2.828-2.828.793-.793zM11.379 5.793L3 14.172V17h2.828l8.38-8.379-2.83-2.828z"})],-1)])])])])]),l(" Analyses Content "),e("div",Pe,[l(" Sticky header + action bar "),e("div",qe,[t[14]||(t[14]=e("h3",{class:"text-sm font-medium text-foreground"},"Analyses in template",-1)),h(f,{type:"button",loading:s.templateUpdating,onClick:t[2]||(t[2]=o=>s.updateTemplate())},{default:y(()=>[...t[13]||(t[13]=[e("span",{class:"inline-flex items-center gap-2"},[e("svg",{class:"w-4 h-4 shrink-0",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M5 13l4 4L19 7"})]),D(" Update Template ")],-1)])]),_:1},8,["loading"])]),l(" Scrollable category grid "),e("div",Oe,[e("div",He,[(a(!0),r(b,null,S(s.analysesServices,o=>(a(),r("div",{key:o[0],class:"min-w-0"},[h(_,{compact:""},{title:y(()=>[e("span",Ie,u(o[0]),1)]),body:y(()=>[e("ul",Je,[(a(!0),r(b,null,S(o[1],d=>(a(),r("li",{key:d?.uid,class:"flex items-center gap-2 py-1.5 px-2 rounded-md hover:bg-accent/50 transition-colors cursor-pointer",onClick:c=>d.checked=!d.checked},[U(e("input",{type:"checkbox",id:`toggle-${d?.uid}`,class:"h-4 w-4 rounded border-input text-primary focus:ring-ring shrink-0 cursor-pointer","onUpdate:modelValue":c=>d.checked=c,onClick:t[3]||(t[3]=A(()=>{},["stop"]))},null,8,Qe),[[de,d.checked]]),e("label",{for:`toggle-${d?.uid}`,class:"text-sm text-foreground cursor-pointer truncate flex-1 min-w-0",onClick:t[4]||(t[4]=A(()=>{},["stop"]))},u(d?.name),9,Re)],8,Ke))),128))])]),_:2},1024)]))),128))])])])])])):(a(),r(b,{key:1},[l(" Empty State "),t[15]||(t[15]=ce('<section class="col-span-9"><div class="rounded-lg border border-border bg-card p-6 flex flex-col items-center justify-center space-y-4 min-h-[400px]"><div class="text-4xl text-muted-foreground">ðŸ“‹</div><h3 class="text-lg font-medium text-foreground">No Template Selected</h3><p class="text-sm text-muted-foreground">Select a template from the list to view its details</p></div></section>',1))],2112))])]),l(" Template Form Modal "),s.showModal?(a(),ie(g,{key:0,onClose:t[9]||(t[9]=o=>s.showModal=!1)},{header:y(()=>[e("h3",Ye,u(s.formTitle),1)]),body:y(()=>[e("form",{onSubmit:t[8]||(t[8]=A((...o)=>s.saveForm&&s.saveForm(...o),["prevent"])),class:"p-6 space-y-6"},[e("div",Ge,[e("label",We,[t[16]||(t[16]=e("span",{class:"text-sm font-medium text-muted-foreground"},"Template Name",-1)),U(e("input",{"onUpdate:modelValue":t[5]||(t[5]=o=>s.name=o),type:"text",class:"w-full px-3 py-2 border border-input bg-background text-foreground rounded-lg focus:outline-none focus:ring-2 focus:ring-ring placeholder:text-muted-foreground",placeholder:"Enter template name"},null,512),[[q,s.name]]),s.nameError?(a(),r("p",Xe,u(s.nameError),1)):l("v-if",!0)]),e("label",Ze,[t[18]||(t[18]=e("span",{class:"text-sm font-medium text-muted-foreground"},"Department",-1)),U(e("select",{"onUpdate:modelValue":t[6]||(t[6]=o=>s.departmentUid=o),class:"w-full px-3 py-2 border border-input bg-background text-foreground rounded-lg focus:outline-none focus:ring-2 focus:ring-ring"},[t[17]||(t[17]=e("option",{value:""},"Select department",-1)),(a(!0),r(b,null,S(s.departments,o=>(a(),r("option",{key:o.uid,value:o.uid},u(o.name),9,$e))),128))],512),[[me,s.departmentUid]]),s.departmentError?(a(),r("p",et,u(s.departmentError),1)):l("v-if",!0)]),e("label",tt,[t[19]||(t[19]=e("span",{class:"text-sm font-medium text-muted-foreground"},"Description",-1)),U(e("textarea",{"onUpdate:modelValue":t[7]||(t[7]=o=>s.description=o),rows:"3",class:"w-full px-3 py-2 border border-input bg-background text-foreground rounded-lg focus:outline-none focus:ring-2 focus:ring-ring placeholder:text-muted-foreground resize-none",placeholder:"Enter template description"},null,512),[[q,s.description]]),s.descriptionError?(a(),r("p",st,u(s.descriptionError),1)):l("v-if",!0)])]),e("div",ot,[h(f,{type:"submit",class:"w-full",loading:s.formSaving},{default:y(()=>[...t[20]||(t[20]=[D(" Save Changes ",-1)])]),_:1},8,["loading"])])],32)]),_:1})):l("v-if",!0)],64)}const ct=re(xe,[["render",nt],["__file","/home/administrator/Documents/Development/beak-insights/beak/beak-lims/webapp/views/admin/analyses/AnalysesTemplates.vue"]]);export{ct as default};
