import{a0 as q,f as H,a7 as c,ad as J,b7 as z,h as X,_ as Y,r as k,c as l,o as i,E as n,A as r,L as p,J as Z,K as $,C as ee,aA as te,a as C,Q as oe,P as re}from"./index-DCVfsbos.js";import{g as ne,h as se,D as ae,i as ie}from"./grind.queries-CepHqusz.js";const le=q({__name:"ErrandFile",props:{errandUid:{type:String,required:!0}},setup(w,{expose:u}){u();const b=w,{withClientMutation:t,withClientQuery:x}=H(),y=c(null),v=c(null);J(()=>{E()});const f=c(!1),d=c(null),s=c(null),h=c(!1),g=c(null),F=c(!1),m=c([]),E=()=>{x(ne,{target:z.Errand,targetUid:b.errandUid},"grindMediaByTarget").then(e=>{e&&(m.value=e)})},M=e=>{t(se,{payload:e},"createGrindMedia").then(o=>{o&&(m.value=[o,...m.value])})},I=e=>{y.value=e,v.value=null,t(ae,{uid:e},"deleteGrindMedia").then(o=>{o&&(m.value=m.value.filter(a=>a.uid!==e))}).catch(o=>{v.value=o?.message||"Failed to delete file"}).finally(()=>{y.value=null})},P=e=>{const o=parseInt(e);return o<1024?`${o} B`:o<1024*1024?`${(o/1024).toFixed(1)} KB`:`${(o/(1024*1024)).toFixed(1)} MB`},T=e=>{const{mimetype:o,filename:a}=e;return o?.startsWith("image/")?"image":o?.includes("pdf")||a.endsWith(".pdf")?"pdf":o?.includes("word")||a.endsWith(".doc")||a.endsWith(".docx")?"doc":o?.includes("sheet")||a.endsWith(".xls")||a.endsWith(".xlsx")?"excel":"file"},G=e=>{try{x(ie,{uid:e.uid},"downloadGrindMediaFile").then(o=>{const a=atob(o.content),L=new Uint8Array(a.length);for(let D=0;D<a.length;D++)L[D]=a.charCodeAt(D);const Q=new Blob([L],{type:o.mimetype}),S=URL.createObjectURL(Q),_=document.createElement("a");_.href=S,_.download=o.filename,document.body.appendChild(_),_.click(),setTimeout(()=>{document.body.removeChild(_),URL.revokeObjectURL(S)},0)})}catch{}},U=e=>{if(g.value=null,d.value=e,e.type.startsWith("image/")){const o=new FileReader;o.onload=a=>{s.value=a.target?.result},o.readAsDataURL(e)}else s.value=null},A=async()=>{if(d.value){h.value=!0,g.value=null;try{const e=await M({file:d.value,target:z.Errand,targetUid:b.errandUid});e?.error?g.value=e.error.message:F.value=!0}catch(e){g.value=e instanceof Error?e.message:"Upload failed"}finally{h.value=!1}}},W=e=>{const o=e.target;o.files&&o.files.length>0&&U(o.files[0])},j=e=>{e.preventDefault(),e.stopPropagation(),f.value=!0},R=e=>{e.preventDefault(),e.stopPropagation(),f.value=!1},N=e=>{e.preventDefault(),e.stopPropagation(),f.value=!0},O=e=>{e.preventDefault(),e.stopPropagation(),f.value=!1,e.dataTransfer&&e.dataTransfer.files.length>0&&U(e.dataTransfer.files[0])},V=()=>{d.value=null,s.value=null,F.value=!1,g.value=null},K=X(()=>{if(!d.value)return"";const e=d.value.size;return e<1024?`${e} B`:e<1024*1024?`${(e/1024).toFixed(1)} KB`:`${(e/(1024*1024)).toFixed(1)} MB`}),B={props:b,withClientMutation:t,withClientQuery:x,isDeleting:y,deleteError:v,isDragging:f,file:d,filePreview:s,isUploading:h,uploadError:g,uploadSuccess:F,errandFiles:m,getFiles:E,uploadFile:M,deleteFile:I,formatFileSize:P,getFileIcon:T,downloadFile:G,handleFileSelect:U,handleUpload:A,onFileInputChange:W,onDragEnter:j,onDragLeave:R,onDragOver:N,onDrop:O,resetUpload:V,fileSize:K};return Object.defineProperty(B,"__isScriptSetup",{enumerable:!1,value:!0}),B}}),de={class:"bg-background rounded-lg shadow-sm border border-border p-6 space-y-6"},ce={class:"flex justify-between items-start"},ue={class:"w-3/4 pr-4 space-y-4"},fe={key:0,class:"py-6 text-center text-muted-foreground bg-background rounded-lg border border-dashed border-border"},pe={key:1,class:"p-3 bg-destructive/10 text-destructive rounded-md"},ge={key:2,class:"space-y-2"},me={class:"flex items-center space-x-3"},ve={class:"text-muted-foreground"},he={class:"text-sm font-medium text-foreground"},_e={class:"text-xs text-muted-foreground"},be={class:"flex items-center space-x-2"},xe=["onClick"],ye=["onClick","disabled"],De={class:"w-1/4 pl-4"},we={key:0,class:"space-y-2"},Fe={class:"text-sm text-muted-foreground"},Ue={key:1,class:"space-y-3"},ke=["src"],Ce={class:"text-sm"},Ee={class:"font-medium text-foreground"},Me={class:"text-muted-foreground"},Be={class:"flex justify-center space-x-2"},Le=["disabled"],Se={key:1,class:"text-sm text-destructive"};function ze(w,u,b,t,x,y){const v=k("DownloadIcon"),f=k("TrashIcon"),d=k("UploadIcon");return i(),l("div",de,[n(" Header "),r("div",ce,[r("div",ue,[u[1]||(u[1]=r("h3",{class:"text-lg font-medium text-foreground"},"Uploaded Files",-1)),n(" Loading or empty state "),t.errandFiles.length===0?(i(),l("div",fe," No files uploaded yet ")):n("v-if",!0),n(" Error message "),t.deleteError?(i(),l("div",pe,p(t.deleteError),1)):n("v-if",!0),n(" File list "),t.errandFiles.length>0?(i(),l("ul",ge,[(i(!0),l(Z,null,$(t.errandFiles,s=>(i(),l("li",{key:s.uid,class:"flex items-center justify-between p-3 bg-muted rounded-md hover:bg-muted/80 transition-colors duration-200"},[r("div",me,[r("span",ve,[(i(),ee(te(t.getFileIcon(s)),{class:"w-5 h-5"}))]),r("div",null,[r("p",he,p(s.filename),1),r("p",_e,p(t.formatFileSize(s.size)),1)])]),r("div",be,[r("button",{onClick:h=>t.downloadFile(s),class:"p-1 text-muted-foreground hover:text-foreground transition-colors duration-200",title:"Download file"},[C(v,{class:"w-5 h-5"})],8,xe),r("button",{onClick:h=>t.deleteFile(s.uid),class:"p-1 text-muted-foreground hover:text-destructive transition-colors duration-200",disabled:t.isDeleting===s.uid,title:"Delete file"},[C(f,{class:"w-5 h-5"})],8,ye)])]))),128))])):n("v-if",!0)]),n(" Upload section "),r("div",De,[r("div",{class:oe(["border-2 border-dashed border-border rounded-lg p-6 text-center",{"border-primary bg-primary/5":t.isDragging}]),onDragenter:t.onDragEnter,onDragleave:t.onDragLeave,onDragover:t.onDragOver,onDrop:t.onDrop},[r("input",{type:"file",class:"hidden",ref:"fileInput",onChange:t.onFileInputChange},null,544),t.file?(i(),l("div",Ue,[n(" Image preview "),t.filePreview?(i(),l("img",{key:0,src:t.filePreview,class:"max-h-32 mx-auto rounded-md",alt:"File preview"},null,8,ke)):n("v-if",!0),n(" File info "),r("div",Ce,[r("p",Ee,p(t.file.name),1),r("p",Me,p(t.fileSize),1)]),n(" Upload actions "),r("div",Be,[r("button",{onClick:t.resetUpload,class:"px-3 py-1 text-sm font-medium text-foreground bg-background border border-border rounded-md shadow-sm hover:bg-muted focus:outline-none focus:ring-2 focus:ring-primary focus:ring-offset-2 transition-colors duration-200"}," Cancel "),r("button",{onClick:t.handleUpload,disabled:t.isUploading,class:"px-3 py-1 text-sm font-medium text-primary-foreground bg-primary border border-transparent rounded-md shadow-sm hover:bg-primary/90 focus:outline-none focus:ring-2 focus:ring-primary focus:ring-offset-2 transition-colors duration-200"},p(t.isUploading?"Uploading...":"Upload"),9,Le)]),n(" Upload error "),t.uploadError?(i(),l("p",Se,p(t.uploadError),1)):n("v-if",!0)])):(i(),l("div",we,[C(d,{class:"w-8 h-8 mx-auto text-muted-foreground"}),r("p",Fe,[u[2]||(u[2]=re(" Drag and drop a file here, or ",-1)),r("button",{onClick:u[0]||(u[0]=s=>w.$refs.fileInput.click()),class:"text-primary hover:text-primary/80 transition-colors duration-200"}," browse ")])]))],34)])])])}const Te=Y(le,[["render",ze],["__scopeId","data-v-334d1478"],["__file","/home/administrator/Documents/Development/beak-insights/beak/beak-lims/webapp/views/grind/_id/ErrandFile.vue"]]);export{Te as default};
