const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/BeakDataTable-CSqXb4Dl.js","assets/index-DCVfsbos.js","assets/index-C_1sfwqa.css","assets/DeriveSamplesModal-BOUD-Jqd.js","assets/analysis-BI7XPyQA.js","assets/analyses.mutations-BEU63HnJ.js","assets/DeriveSamplesModal-DuNb9Bt-.css"])))=>i.map(i=>d[i]);
import{a0 as ge,u as Se,aq as Ce,ac as _e,a4 as Re,g as T,h as K,a7 as D,aT as ke,a1 as Q,a6 as X,a8 as o,ar as Pe,_ as Ae,r as De,c as Le,o as Me,a as u,N as f,A as xe,F as v,D as p,P as h,H as y}from"./index-DCVfsbos.js";import{p as R}from"./index-Cw3weLtk.js";import{u as Be}from"./analysis-BI7XPyQA.js";import{u as Ee}from"./samples-BrAyCdA1.js";import{s as we}from"./index-BaPnjn4Y.js";import"./analyses.mutations-BEU63HnJ.js";import"./storage.mutations-CYc-ciRc.js";const Te=ge({__name:"BeakSampleListing",setup(Y,{expose:s}){s();const N=Q(()=>X(()=>import("./BeakDataTable-CSqXb4Dl.js"),__vite__mapDeps([0,1,2]))),a=Q(()=>X(()=>import("./DeriveSamplesModal-BOUD-Jqd.js"),__vite__mapDeps([3,1,2,4,5,6]))),m=Se(),L=Be(),{samplePageInfo:c,fetchingSamples:b}=Ce(m);let M=_e(),P=Re();const r=T({barcodes:!1,can_cancel:!1,can_receive:!1,can_reinstate:!1,can_reject:!1,can_copy_to:!1,can_download:!1,can_print:!1,can_publish:!1,can_store:!1,can_recover:!1,can_derive:!1}),g=K(()=>m.getSamples),$=D([{name:"All",value:""},{name:"Expected",value:"expected"},{name:"Received",value:"received"},{name:"Awaiting",value:"awaiting"},{name:"Approved",value:"approved"},{name:"Published",value:"published"},{name:"Invalidated",value:"invalidated"},{name:"Cancelled",value:"cancelled"},{name:"Rejected",value:"rejected"},{name:"Stored",value:"stored"},{name:"Referred",value:"referred"},{name:"Paired",value:"paired"}]),ee=D([{name:"UID",value:"uid",sortable:!0,sortBy:"asc",defaultSort:!0,showInToggler:!1,hidden:!0},{name:"",value:"",sortable:!1,showInToggler:!1,hidden:!1,customRender:function(e,t){return o("div",{class:"flex items-center gap-2"},[e.priority>1?o("span",{class:"text-destructive"},o("i",{class:"fa fa-star"})):"",e.status==="stored"?o("span",{class:"text-muted-foreground"},o("i",{class:"fa-briefcase"})):""])}},{name:"Sample ID",value:"sampleId",sortable:!0,sortBy:"asc",hidden:!1,customRender:function(e,t){const n=j(e?.relationshipType);return o("div",{class:"flex items-center gap-2"},[o(Pe,{to:{name:"sample-detail",params:{patientUid:e?.analysisRequest?.patient?.uid,sampleUid:e?.uid}},class:"text-primary hover:underline",innerHTML:e?.sampleId}),n?o("span",{class:"inline-flex items-center justify-center w-4 h-4 rounded-full text-[9px] italic font-semibold bg-muted text-foreground"},n):null])}},{name:"Sample Type",value:"sampleType.name",sortable:!1,sortBy:"asc",hidden:!0},{name:"Test(s)",value:"",sortable:!1,sortBy:"asc",hidden:!1,customRender:function(e,t){return o("span",{innerHTML:I(e.profiles,e.analyses)},[])}},{name:"Patient",value:"",sortable:!1,sortBy:"asc",hidden:!1,customRender:function(e,t){const n="analysisRequest.patient.firstName".split(".").reduce((i,w)=>i?.[w],e),l="analysisRequest.patient.lastName".split(".").reduce((i,w)=>i?.[w],e);return o("span",{innerHTML:`${n} ${l}`},[])}},{name:"Gender",value:"analysisRequest.patient.gender",sortable:!1,sortBy:"asc",hidden:!0},{name:"Age",value:"analysisRequest.patient.age",sortable:!1,sortBy:"asc",hidden:!0},{name:"Client Patient ID",value:"analysisRequest.patient.clientPatientId",sortable:!1,sortBy:"asc",hidden:!1},{name:"Client",value:"analysisRequest.client.name",sortable:!1,sortBy:"asc",hidden:!1},{name:"Client Code",value:"analysisRequest.client.code",sortable:!1,sortBy:"asc",hidden:!0},{name:"Province",value:"analysisRequest.client.district.province.name",sortable:!1,sortBy:"asc",hidden:!0},{name:"District",value:"analysisRequest.client.district.name",sortable:!1,sortBy:"asc",hidden:!0},{name:"Client Request Id",value:"analysisRequest.clientRequestId",sortable:!1,sortBy:"asc",hidden:!1},{name:"Date Collected",value:"dateCollected",sortable:!1,sortBy:"asc",hidden:!0,customRender:function(e,t){const n=t.value.split(".").reduce((l,i)=>l?.[i],e);return o("span",{innerHTML:R(n)},[])}},{name:"Date Created",value:"createdAt",sortable:!1,sortBy:"asc",hidden:!0,customRender:function(e,t){const n=t.value.split(".").reduce((l,i)=>l?.[i],e);return o("span",{innerHTML:R(n)},[])}},{name:"Creator",value:"createdBy.firstName",sortable:!1,sortBy:"asc",hidden:!1},{name:"Date Received",value:"dateReceived",sortable:!1,sortBy:"asc",hidden:!0,customRender:function(e,t){const n=t.value.split(".").reduce((l,i)=>l?.[i],e);return o("span",{innerHTML:R(n)},[])}},{name:"Date Submitted",value:"dateSubmitted",sortable:!1,sortBy:"asc",hidden:!0,customRender:function(e,t){const n=t.value.split(".").reduce((l,i)=>l?.[i],e);return o("span",{innerHTML:R(n)},[])}},{name:"Date Verified",value:"dateVerified",sortable:!1,sortBy:"asc",hidden:!0,customRender:function(e,t){const n=t.value.split(".").reduce((l,i)=>l?.[i],e);return o("span",{innerHTML:R(n)},[])}},{name:"Date Published",value:"datePublished",sortable:!1,sortBy:"asc",hidden:!0,customRender:function(e,t){const n=t.value.split(".").reduce((l,i)=>l?.[i],e);return o("span",{innerHTML:R(n)},[])}},{name:"Date Printed",value:"datePrinted",sortable:!1,sortBy:"asc",hidden:!0,customRender:function(e,t){const n=t.value.split(".").reduce((l,i)=>l?.[i],e);return o("span",{innerHTML:R(n)},[])}},{name:"Printed",value:"printed",sortable:!1,sortBy:"asc",hidden:!0},{name:"Status",value:"status",sortable:!1,sortBy:"asc",hidden:!1,customRender:function(e,t){const n=t.value.split(".").reduce((l,i)=>l?.[i],e);return o("button",{type:"button",class:"bg-primary text-primary-foreground py-1 px-2 rounded-sm leading-none",innerHTML:n},[])}}]);M?.query?.clientUid&&m.resetSamples(),m.fetchSampleTypes();let x=T({first:void 0,after:"",text:"",sortBy:["name"]});L.fetchAnalysesServices(x),L.fetchAnalysesProfiles();function I(e,t){let n=[];return e.forEach(l=>n.push(l.name)),t.forEach(l=>n.push(l.name)),n.join(", ")}function j(e){if(!e)return null;const t=e.toLowerCase();return t.startsWith("der")?"D":t.startsWith("ali")?"A":t.startsWith("poo")?"P":e.charAt(0).toUpperCase()}let d=T({first:50,before:"",status:"received",text:"",sortBy:["-uid"],clientUid:ke(M?.query?.clientUid),filterAction:!1});m.fetchSamples(d);function ae(e){d.first=e.fetchCount,d.before=c?.value?.endCursor??"",d.text=e.filterText,d.status=e.filterStatus,d.filterAction=!1,m.fetchSamples(d)}function te(e){d.first=50,d.before="",d.text=e.filterText,d.status=e.filterStatus,d.filterAction=!0,m.fetchSamples(d)}const se=e=>{const t=e?.storageContainer,n=t?.storageSection,l=n?.storageLocation;return`${l?.storeRoom?.name} > ${l?.name} > ${n?.name} > ${t?.name} > ${e?.storageSlot}`},k=D(!1);function ne(e){g.value?.forEach(t=>t.checked=e.checked),k.value=e.checked,A()}function le(e){const t=g.value.findIndex(n=>n.uid===e.uid);g.value[t].checked=e.checked,q()?k.value=!0:k.value=!1,A()}function re(e){const t=g.value.findIndex(n=>n.uid===e.uid);g.value[t].checked=!1,k.value=!1,A()}async function S(){g.value?.forEach(e=>e.checked=!1),k.value=!1,A()}function q(){return g.value?.every(e=>e.checked===!0)}function _(){let e=[];return g.value?.forEach(t=>{t.checked&&e.push(t)}),e}function A(){r.can_cancel=!1,r.can_receive=!1,r.can_reinstate=!1,r.can_download=!1,r.can_publish=!1,r.can_print=!1,r.can_reject=!1,r.can_store=!1,r.can_recover=!1,r.can_copy_to=!1,r.can_derive=!1,r.barcodes=!1;const e=_();e.length!==0&&(r.barcodes=!0,r.can_derive=!0,e.every(t=>t.status==="expected")&&(r.can_receive=!0),e.every(t=>["received","expected"].includes(t.status))&&(r.can_cancel=!0,r.can_reject=!0),e.every(t=>["received"].includes(t.status))&&(r.can_store=!0,r.can_copy_to=!0),e.every(t=>["stored"].includes(t.status))&&(r.can_recover=!0),e.every(t=>t.status==="cancelled")&&(r.can_reinstate=!0),e.every(t=>["approved","published"].includes(t.status))&&(r.can_copy_to=!0),e.every(t=>t.status==="approved")&&(r.can_publish=!0),e.every(t=>t.status==="published")&&(r.can_print=!0,r.can_download=!0))}function C(){const e=_();let t=[];return e?.forEach(n=>t.push(n.uid)),t}function H(){const e=_();let t=[];return e?.forEach(n=>t.push(n.sampleId)),t}const{cancelSamples:O,reInstateSamples:U,receiveSamples:V,printSamples:J,downloadSamplesImpress:W,publishSamples:F,recoverSamples:G,cloneSamples:Z}=Ee(),ie=K(()=>m.getSamples?.length+" of "+m.getSampleCount+" samples"),oe=async()=>Z(C()).finally(()=>S()),ce=async()=>O(C()).finally(()=>S()),de=async()=>U(C()).finally(()=>S()),ue=async()=>V(C()).finally(()=>S()),fe=async()=>{const e=C().map(t=>({uid:t,action:"publish"}));await F(e).finally(()=>S())},me=async()=>await J(C()).finally(()=>S()),ve=async()=>await W(H()).finally(()=>S()),pe=async()=>{const e=_();P.push({name:"reject-samples",state:{samples:JSON.stringify(e)}})},he=async()=>{const e=_();P.push({name:"store-samples",state:{samples:JSON.stringify(e)}})},ye=async()=>G(C()).finally(()=>S()),be=async()=>P.push({name:"print-barcodes",state:{sampleUids:JSON.stringify(C())}}),B=D(!1),E=D([]),z={DataTable:N,DeriveSamplesModal:a,sampleStore:m,analysisStore:L,samplePageInfo:c,fetchingSamples:b,get route(){return M},set route(e){M=e},get router(){return P},set router(e){P=e},state:r,samples:g,filterOptions:$,tableColumns:ee,get analysesParams(){return x},set analysesParams(e){x=e},profileAnalysesText:I,relationshipBadge:j,get sampleParams(){return d},set sampleParams(e){d=e},showMoreSamples:ae,filterSamples:te,sampleToolTip:se,allChecked:k,toggleCheckAll:ne,toggleCheck:le,unCheck:re,unCheckAll:S,areAllChecked:q,getSamplesChecked:_,checkUserActionPermissios:A,getSampleUids:C,getSampleIds:H,cancelSamples:O,reInstateSamples:U,receiveSamples:V,printSamples:J,downloadSamplesImpress:W,publishSamples:F,recoverSamples:G,cloneSamples:Z,countNone:ie,cloneSamples_:oe,cancelSamples_:ce,reInstateSamples_:de,receiveSamples_:ue,publishReports_:fe,printReports_:me,impressDownload_:ve,prepareRejections:pe,prepareStorages:he,recoverSamples_:ye,printBarCodes:be,showDeriveModal:B,deriveSelection:E,openDeriveModal:()=>{const e=_();e.length!==0&&(E.value=e,B.value=!0)},closeDeriveModal:()=>{B.value=!1,E.value=[]},handleDerived:async e=>{if(e?.length){const t=new Set(g.value.map(l=>l.uid)),n=e.filter(l=>!t.has(l.uid));n.length&&m.addSampleClones(n)}await S()},get shield(){return we}};return Object.defineProperty(z,"__isScriptSetup",{enumerable:!1,value:!0}),z}}),Ne={class:"rounded-lg border border-border bg-card shadow-sm p-6"};function Ie(Y,s,N,a,m,L){const c=De("beak-button");return Me(),Le("div",Ne,[u(a.DataTable,{columns:a.tableColumns,data:a.samples,toggleColumns:!0,loading:a.fetchingSamples,paginable:!0,pageMeta:{fetchCount:a.sampleParams.first,hasNextPage:a.samplePageInfo?.hasNextPage,countNone:a.countNone},searchable:!0,filterable:!0,filterMeta:{defaultFilter:a.sampleParams.status,filters:a.filterOptions},selectable:!0,allChecked:a.allChecked,onOnSearch:a.filterSamples,onOnPaginate:a.showMoreSamples,onOnCheck:a.toggleCheck,onOnCheckAll:a.toggleCheckAll},{footer:f(()=>[xe("div",null,[v(u(c,{onClick:s[0]||(s[0]=p(b=>a.cancelSamples_(),["prevent"]))},{default:f(()=>[...s[10]||(s[10]=[h(" Cancel ",-1)])]),_:1},512),[[y,a.shield.hasRights(a.shield.actions.CANCEL,a.shield.objects.SAMPLE)&&a.state.can_cancel]]),v(u(c,{onClick:s[1]||(s[1]=p(b=>a.reInstateSamples_(),["prevent"]))},{default:f(()=>[...s[11]||(s[11]=[h(" ReInstate ",-1)])]),_:1},512),[[y,a.shield.hasRights(a.shield.actions.CANCEL,a.shield.objects.SAMPLE)&&a.state.can_reinstate]]),v(u(c,{onClick:s[2]||(s[2]=p(b=>a.receiveSamples_(),["prevent"]))},{default:f(()=>[...s[12]||(s[12]=[h(" Reveive ",-1)])]),_:1},512),[[y,a.shield.hasRights(a.shield.actions.CANCEL,a.shield.objects.SAMPLE)&&a.state.can_receive]]),v(u(c,{onClick:s[3]||(s[3]=p(b=>a.prepareStorages(),["prevent"]))},{default:f(()=>[...s[13]||(s[13]=[h(" Store ",-1)])]),_:1},512),[[y,a.shield.hasRights(a.shield.actions.CANCEL,a.shield.objects.SAMPLE)&&a.state.can_store]]),v(u(c,{onClick:s[4]||(s[4]=p(b=>a.recoverSamples_(),["prevent"]))},{default:f(()=>[...s[14]||(s[14]=[h(" Recover ",-1)])]),_:1},512),[[y,a.shield.hasRights(a.shield.actions.CANCEL,a.shield.objects.SAMPLE)&&a.state.can_recover]]),v(u(c,{onClick:s[5]||(s[5]=p(b=>a.prepareRejections(),["prevent"]))},{default:f(()=>[...s[15]||(s[15]=[h(" Reject ",-1)])]),_:1},512),[[y,a.shield.hasRights(a.shield.actions.CANCEL,a.shield.objects.SAMPLE)&&a.state.can_reject]]),v(u(c,{onClick:s[6]||(s[6]=p(b=>a.cloneSamples_(),["prevent"]))},{default:f(()=>[...s[16]||(s[16]=[h(" Copy to New ",-1)])]),_:1},512),[[y,a.shield.hasRights(a.shield.actions.CANCEL,a.shield.objects.SAMPLE)&&a.state.can_copy_to]]),v(u(c,{onClick:s[7]||(s[7]=p(b=>a.impressDownload_(),["prevent"]))},{default:f(()=>[...s[17]||(s[17]=[h(" Download ",-1)])]),_:1},512),[[y,a.shield.hasRights(a.shield.actions.CANCEL,a.shield.objects.SAMPLE)&&a.state.can_download]]),v(u(c,{onClick:s[8]||(s[8]=p(b=>a.publishReports_(),["prevent"]))},{default:f(()=>[...s[18]||(s[18]=[h(" Publish ",-1)])]),_:1},512),[[y,a.shield.hasRights(a.shield.actions.CANCEL,a.shield.objects.SAMPLE)&&a.state.can_publish]]),v(u(c,{onClick:s[9]||(s[9]=p(b=>a.printReports_(),["prevent"]))},{default:f(()=>[...s[19]||(s[19]=[h(" Print ",-1)])]),_:1},512),[[y,a.shield.hasRights(a.shield.actions.CANCEL,a.shield.objects.SAMPLE)&&a.state.can_print]]),v(u(c,{onClick:p(a.printBarCodes,["prevent"])},{default:f(()=>[...s[20]||(s[20]=[h(" Print Barcodes ",-1)])]),_:1},512),[[y,a.state.barcodes]]),v(u(c,{onClick:p(a.openDeriveModal,["prevent"])},{default:f(()=>[...s[21]||(s[21]=[h(" Derive ",-1)])]),_:1},512),[[y,a.state.can_derive]])])]),_:1},8,["columns","data","loading","pageMeta","filterMeta","allChecked"]),u(a.DeriveSamplesModal,{show:a.showDeriveModal,samples:a.deriveSelection,onClose:a.closeDeriveModal,onDerived:a.handleDerived},null,8,["show","samples"])])}const Ze=Ae(Te,[["render",Ie],["__file","/home/administrator/Documents/Development/beak-insights/beak/beak-lims/webapp/components/sample/BeakSampleListing.vue"]]);export{Ze as default};
