import{k as C,a0 as ue,f as ce,t as me,a7 as _,bj as w,bk as d,a5 as pe,ad as ge,_ as be,r as N,c as l,o as s,a as K,A as e,C as fe,E as v,N as M,P as ve,J as T,K as k,L as i,Q as ye,D as xe,F as h,a2 as F,a9 as I}from"./index-B3ZheI5m.js";import{c as _e,a as y,f as Te,u as he,b as p}from"./index.esm-C1wdlr_y.js";const Se=C`
    mutation AddSmsTemplate($payload: SmsTemplateInputType!) {
  createSmsTemplate(payload: $payload) {
    ... on SmsTemplateType {
      __typename
      uid
      name
      description
      specificationTrigger
      audience
      template
      createdAt
      updatedAt
      isActive
    }
    ... on OperationError {
      __typename
      error
      suggestion
    }
  }
}
    `,Ae=C`
    mutation EditSmsTemplate($uid: String!, $payload: SmsTemplateInputType!) {
  updateSmsTemplate(uid: $uid, payload: $payload) {
    ... on SmsTemplateType {
      __typename
      uid
      name
      description
      specificationTrigger
      audience
      template
      createdAt
      updatedAt
      isActive
    }
    ... on OperationError {
      __typename
      error
      suggestion
    }
  }
}
    `,we=C`
    mutation DeleteSmsTemplate($uid: String!) {
  deleteSmsTemplate(uid: $uid) {
    ... on DeletedItem {
      __typename
      uid
    }
    ... on OperationError {
      __typename
      error
      suggestion
    }
  }
}
    `,ke=C`
    query getSmsTemplatesByTarget($targetType: String!, $targetUid: String!) {
  smsTemplatesByTarget(targetType: $targetType, targetUid: $targetUid) {
    uid
    name
    description
    specificationTrigger
    audience
    template
    createdAt
    updatedAt
    isActive
  }
}
    `,Ee=ue({__name:"SmsTemplate",props:{targetType:{type:String,required:!0,default:null},targetUid:{type:String,required:!0,default:null}},setup(W,{expose:t}){t();const{withClientMutation:S,withClientQuery:r}=ce(),E=W,{targetType:g,targetUid:m}=me(E);let x=_(!1),A=_("");const o=_(!0),u=_(null),D=_(!1),q=_e({name:y().trim().required("Template name is required"),description:y().trim().nullable(),template:y().trim().required("Template body is required"),specificationTrigger:y().trim().required("Trigger is required"),audience:y().trim().required("Audience is required"),isActive:Te().default(!0),targetType:y().trim().required(),targetUid:y().trim().required()}),{handleSubmit:B,resetForm:L,setValues:P}=he({validationSchema:q,initialValues:{name:"",description:"",template:"",specificationTrigger:d.AnyAbnormal,audience:w.Patient,isActive:!0,targetType:g.value,targetUid:m.value}}),{value:X,errorMessage:Y}=p("name"),{value:Z,errorMessage:j}=p("description"),{value:b,errorMessage:$}=p("template"),{value:ee,errorMessage:te}=p("specificationTrigger"),{value:re,errorMessage:oe}=p("audience"),{value:ae}=p("isActive"),{value:R}=p("targetType"),{value:O}=p("targetUid"),H=[{value:d.Normal,label:"Normal Results"},{value:d.BelowNormal,label:"Below Normal (Not Warning)"},{value:d.AboveNormal,label:"Above Normal (Not Warning)"},{value:d.BelowWarning,label:"Below Warning Threshold"},{value:d.AboveWarning,label:"Above Warning Threshold"},{value:d.AnyAbnormal,label:"Any Abnormal Results"},{value:d.AnyWarning,label:"Any Warning Results"},{value:d.AnyResult,label:"Any Result"},{value:d.TextualNormal,label:"Textual Normal Results"},{value:d.TextualWarning,label:"Textual Warning Results"}],Q=[{value:w.Patient,label:"Patient"},{value:w.Client,label:"Client"}],ne=[{category:"Lab Information",variables:["{lab_name}","{lab_email}","{lab_phone}"]},{category:"Sample Information",variables:["{sample_id}","{client_sample_id}","{date_collected}"]},{category:"Patient Information",variables:["{patient_name}","{patient_id}","{gender}","{client_patient_id}","{age}"]},{category:"Analysis Information",variables:["{analysis_keyword}","{analysis_name}"]},{category:"Result Information",variables:["{result}","{unit}"]},{category:"Client Information",variables:["{client_id}","{client_name}"]},{category:"Other",variables:["Patient identification names (dynamic)"]}],f=_([]);pe(()=>E.targetUid,()=>{R.value=g.value,O.value=m.value,U()}),ge(()=>{U()});function U(){r(ke,{targetType:g.value,targetUid:m.value},"smsTemplatesByTarget").then(a=>f.value=a||[])}function z(a){S(Se,{payload:a},"createSmsTemplate").then(n=>f.value.push(n))}function G(a){u.value&&S(Ae,{uid:u.value,payload:a},"updateSmsTemplate").then(n=>{const c=f.value.findIndex(V=>V.uid===u.value);c!==-1&&(f.value[c]=n)})}function ie(a){confirm("Are you sure you want to delete this SMS template?")&&S(we,{uid:a},"deleteSmsTemplate").then(()=>{const n=f.value.findIndex(c=>c.uid===a);n!==-1&&f.value.splice(n,1)})}function se(a,n={}){o.value=a,x.value=!0,A.value=(a?"CREATE":"EDIT")+" SMS TEMPLATE",a?(u.value=null,L({values:{name:"",template:"",description:"",targetType:g.value,targetUid:m.value,specificationTrigger:d.AnyAbnormal,audience:w.Patient,isActive:!0}})):(u.value=n.uid??null,P({name:n.name??"",template:n.template??"",description:n.description??"",targetType:g.value,targetUid:m.value,specificationTrigger:n.specificationTrigger??d.AnyAbnormal,audience:n.audience??w.Patient,isActive:n.isActive??!0}))}const le=B(a=>{const n={name:a.name,template:a.template,description:a.description??null,targetType:a.targetType,targetUid:a.targetUid,specificationTrigger:a.specificationTrigger,audience:a.audience,isActive:a.isActive};o.value===!0&&z(n),o.value===!1&&G(n),x.value=!1});function de(a){const n=document.getElementById("template-input");if(typeof b.value!="string"&&(b.value=""),n){const c=n.selectionStart,V=n.selectionEnd;b.value=b.value.substring(0,c)+a+b.value.substring(V),setTimeout(()=>{n.focus(),n.selectionStart=n.selectionEnd=c+a.length},0)}else b.value+=a}const J={withClientMutation:S,withClientQuery:r,props:E,targetType:g,targetUid:m,get showModal(){return x},set showModal(a){x=a},get formTitle(){return A},set formTitle(a){A=a},formAction:o,currentUid:u,showWildcards:D,templateSchema:q,handleSubmit:B,resetForm:L,setValues:P,name:X,nameError:Y,description:Z,descriptionError:j,templateField:b,templateError:$,specificationTrigger:ee,triggerError:te,audience:re,audienceError:oe,isActive:ae,targetTypeField:R,targetUidField:O,triggerOptions:H,audienceOptions:Q,supportedVariables:ne,templates:f,getSmsTemplates:U,addSmsTemplate:z,editSmsTemplate:G,deleteSmsTemplate:ie,FormManager:se,saveForm:le,insertVariable:de,triggerLabel:a=>H.find(c=>c.value===a)?.label||a,audienceLabel:a=>Q.find(c=>c.value===a)?.label||a};return Object.defineProperty(J,"__isScriptSetup",{enumerable:!1,value:!0}),J}}),Me={class:"overflow-x-auto mt-4"},Ce={class:"align-middle inline-block min-w-full shadow overflow-hidden bg-card text-card-foreground rounded-lg border border-border"},Ue={class:"min-w-full beak-table"},Ve={class:"bg-card"},Ne={class:"px-4 py-2 whitespace-nowrap border-b border-border"},Fe={class:"text-sm text-foreground"},Ie={class:"text-xs text-muted-foreground"},We={class:"px-4 py-2 whitespace-nowrap border-b border-border"},De={class:"text-sm text-foreground"},qe={class:"px-4 py-2 whitespace-nowrap border-b border-border"},Be={class:"text-sm text-foreground"},Le={class:"px-4 py-2 border-b border-border"},Pe={class:"text-sm text-foreground max-w-xs"},Re={class:"px-4 py-2 whitespace-nowrap border-b border-border"},Oe={class:"px-4 py-2 whitespace-nowrap text-right border-b border-border"},He=["onClick"],Qe=["onClick"],ze={class:"text-lg font-bold text-foreground"},Ge={class:"space-y-4"},Je={class:"grid grid-cols-2 gap-4"},Ke={class:"space-y-2"},Xe={key:0,class:"text-sm text-destructive"},Ye={class:"space-y-2"},Ze={key:0,class:"text-sm text-destructive"},je={class:"grid grid-cols-3 gap-4"},$e={class:"space-y-2"},et=["value"],tt={key:0,class:"text-sm text-destructive"},rt={class:"space-y-2"},ot=["value"],at={key:0,class:"text-sm text-destructive"},nt={class:"space-y-2"},it={class:"space-y-2"},st={class:"flex justify-between items-center"},lt={key:0,class:"text-sm text-destructive"},dt={key:0,class:"border border-border rounded-lg p-4 bg-accent/5"},ut={class:"grid grid-cols-2 gap-4"},ct={class:"text-xs font-medium text-muted-foreground uppercase"},mt={class:"flex flex-wrap gap-1"},pt=["onClick"],gt={class:"pt-4 flex gap-2"};function bt(W,t,S,r,E,g){const m=N("beak-button"),x=N("beak-heading"),A=N("beak-modal");return s(),l(T,null,[K(x,{title:"SMS Templates"},{default:M(()=>[K(m,{onClick:t[0]||(t[0]=o=>r.FormManager(!0))},{default:M(()=>[...t[11]||(t[11]=[ve("Add SMS Template",-1)])]),_:1})]),_:1}),e("div",Me,[e("div",Ce,[e("table",Ue,[t[12]||(t[12]=e("thead",null,[e("tr",null,[e("th",{class:"px-4 py-2 border-b border-border text-left text-sm font-medium text-muted-foreground"},"Name"),e("th",{class:"px-4 py-2 border-b border-border text-left text-sm font-medium text-muted-foreground"},"Specification Trigger"),e("th",{class:"px-4 py-2 border-b border-border text-left text-sm font-medium text-muted-foreground"},"Audience"),e("th",{class:"px-4 py-2 border-b border-border text-left text-sm font-medium text-muted-foreground"},"Template"),e("th",{class:"px-4 py-2 border-b border-border text-left text-sm font-medium text-muted-foreground"},"Status"),e("th",{class:"px-4 py-2 border-b border-border"})])],-1)),e("tbody",Ve,[(s(!0),l(T,null,k(r.templates,o=>(s(),l("tr",{key:o?.uid,class:"hover:bg-accent/50"},[e("td",Ne,[e("div",Fe,i(o.name),1),e("div",Ie,i(o.description),1)]),e("td",We,[e("div",De,i(r.triggerLabel(o.specificationTrigger||"")),1)]),e("td",qe,[e("div",Be,i(r.audienceLabel(o.audience||"")),1)]),e("td",Le,[e("div",Pe,i(o.template),1)]),e("td",Re,[e("span",{class:ye([o.isActive?"bg-success/15 text-success":"bg-destructive/15 text-destructive","px-2 py-1 text-xs font-medium rounded-full"])},i(o.isActive?"Active":"Inactive"),3)]),e("td",Oe,[e("button",{onClick:u=>r.FormManager(!1,o),class:"px-2 py-1 mr-2 border border-border bg-background text-foreground transition-colors duration-200 rounded-lg focus:outline-none focus:ring-2 focus:ring-ring hover:bg-accent hover:text-accent-foreground"},"Edit",8,He),e("button",{onClick:u=>r.deleteSmsTemplate(o.uid),class:"px-2 py-1 border border-destructive bg-background text-destructive transition-colors duration-200 rounded-lg focus:outline-none focus:ring-2 focus:ring-ring hover:bg-destructive/10"},"Delete",8,Qe)])]))),128))])])])]),r.showModal?(s(),fe(A,{key:0,onClose:t[10]||(t[10]=o=>r.showModal=!1),contentWidth:"w-3/4"},{header:M(()=>[e("h3",ze,i(r.formTitle),1)]),body:M(()=>[e("form",{onSubmit:t[9]||(t[9]=xe((...o)=>r.saveForm&&r.saveForm(...o),["prevent"])),class:"p-6 space-y-6"},[e("div",Ge,[e("div",Je,[e("label",Ke,[t[13]||(t[13]=e("span",{class:"text-sm font-medium text-muted-foreground"},"Template Name",-1)),h(e("input",{type:"text",class:"w-full px-3 py-2 border border-input bg-background text-foreground rounded-lg focus:outline-none focus:ring-2 focus:ring-ring","onUpdate:modelValue":t[1]||(t[1]=o=>r.name=o),placeholder:"Enter template name..."},null,512),[[F,r.name]]),r.nameError?(s(),l("p",Xe,i(r.nameError),1)):v("",!0)]),e("label",Ye,[t[14]||(t[14]=e("span",{class:"text-sm font-medium text-muted-foreground"},"Description",-1)),h(e("input",{type:"text",class:"w-full px-3 py-2 border border-input bg-background text-foreground rounded-lg focus:outline-none focus:ring-2 focus:ring-ring","onUpdate:modelValue":t[2]||(t[2]=o=>r.description=o),placeholder:"Enter description..."},null,512),[[F,r.description]]),r.descriptionError?(s(),l("p",Ze,i(r.descriptionError),1)):v("",!0)])]),e("div",je,[e("label",$e,[t[15]||(t[15]=e("span",{class:"text-sm font-medium text-muted-foreground"},"Trigger Condition",-1)),h(e("select",{class:"w-full px-3 py-2 border border-input bg-background text-foreground rounded-lg focus:outline-none focus:ring-2 focus:ring-ring","onUpdate:modelValue":t[3]||(t[3]=o=>r.specificationTrigger=o)},[(s(),l(T,null,k(r.triggerOptions,o=>e("option",{key:o.value,value:o.value},i(o.label),9,et)),64))],512),[[I,r.specificationTrigger]]),r.triggerError?(s(),l("p",tt,i(r.triggerError),1)):v("",!0)]),e("label",rt,[t[16]||(t[16]=e("span",{class:"text-sm font-medium text-muted-foreground"},"Audience",-1)),h(e("select",{class:"w-full px-3 py-2 border border-input bg-background text-foreground rounded-lg focus:outline-none focus:ring-2 focus:ring-ring","onUpdate:modelValue":t[4]||(t[4]=o=>r.audience=o)},[(s(),l(T,null,k(r.audienceOptions,o=>e("option",{key:o.value,value:o.value},i(o.label),9,ot)),64))],512),[[I,r.audience]]),r.audienceError?(s(),l("p",at,i(r.audienceError),1)):v("",!0)]),e("label",nt,[t[18]||(t[18]=e("span",{class:"text-sm font-medium text-muted-foreground"},"Status",-1)),h(e("select",{class:"w-full px-3 py-2 border border-input bg-background text-foreground rounded-lg focus:outline-none focus:ring-2 focus:ring-ring","onUpdate:modelValue":t[5]||(t[5]=o=>r.isActive=o)},[...t[17]||(t[17]=[e("option",{value:!0},"Active",-1),e("option",{value:!1},"Inactive",-1)])],512),[[I,r.isActive]])])]),e("div",it,[e("div",st,[t[19]||(t[19]=e("span",{class:"text-sm font-medium text-muted-foreground"},"SMS Template",-1)),e("button",{type:"button",onClick:t[6]||(t[6]=o=>r.showWildcards=!r.showWildcards),class:"text-xs text-primary hover:text-primary/80"},i(r.showWildcards?"Hide":"Show")+" Available Variables ",1)]),h(e("textarea",{id:"template-input",class:"w-full px-3 py-2 border border-input bg-background text-foreground rounded-lg focus:outline-none focus:ring-2 focus:ring-ring min-h-[100px]","onUpdate:modelValue":t[7]||(t[7]=o=>r.templateField=o),placeholder:"Enter SMS template with variables e.g., Hello {patient_name}, your {analysis_name} result is {result}..."},null,512),[[F,r.templateField]]),r.templateError?(s(),l("p",lt,i(r.templateError),1)):v("",!0)]),r.showWildcards?(s(),l("div",dt,[t[20]||(t[20]=e("h4",{class:"text-sm font-medium text-foreground mb-3"},"Available Variables:",-1)),e("div",ut,[(s(),l(T,null,k(r.supportedVariables,o=>e("div",{key:o.category,class:"space-y-1"},[e("h5",ct,i(o.category),1),e("div",mt,[(s(!0),l(T,null,k(o.variables,u=>(s(),l("button",{key:u,type:"button",onClick:D=>r.insertVariable(u),class:"text-xs px-2 py-1 bg-primary/10 text-primary hover:bg-primary/20 rounded border border-primary/20 transition-colors duration-200"},i(u),9,pt))),128))])])),64))])])):v("",!0)]),e("div",gt,[t[21]||(t[21]=e("button",{type:"submit",class:"flex-1 bg-primary text-primary-foreground hover:bg-primary/90 rounded-lg px-4 py-2 transition-colors duration-200 focus:outline-none focus:ring-2 focus:ring-ring"}," Save Template ",-1)),e("button",{type:"button",onClick:t[8]||(t[8]=o=>r.showModal=!1),class:"px-4 py-2 border border-border bg-background text-foreground transition-colors duration-200 rounded-lg focus:outline-none focus:ring-2 focus:ring-ring hover:bg-accent hover:text-accent-foreground"}," Cancel ")])],32)]),_:1})):v("",!0)],64)}const _t=be(Ee,[["render",bt],["__scopeId","data-v-ea0c084b"],["__file","/home/administrator/Documents/Development/beak-insights/felicity/felicity-lims/webapp/views/admin/analyses/services/SmsTemplate.vue"]]);export{_t as default};
