const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/vue-multiselect.esm-CzQaAJqu.js","assets/index-B3ZheI5m.js","assets/index-C_1sfwqa.css","assets/BeakSwitch-DTeAYq0B.js"])))=>i.map(i=>d[i]);
import{a0 as X,ae as n,f as Z,h as I,a7 as m,g as $,aE as ee,aF as se,a1 as _,a6 as h,aG as te,_ as oe,r as re,c as p,o as d,A as s,C as ie,E,J as F,K as ne,L as f,N as O,D as ae,F as le,a2 as de,a as ue}from"./index-B3ZheI5m.js";import{c as ce,e as me,a as V,u as pe,b as R}from"./index.esm-C1wdlr_y.js";import{u as fe}from"./user-BHZZlXLC.js";const ge=X({__name:"Groups",setup(L,{expose:t}){t();const A=_(()=>h(()=>import("./vue-multiselect.esm-CzQaAJqu.js"),__vite__mapDeps([0,1,2]))),r=_(()=>h(()=>import("./BeakSwitch-DTeAYq0B.js"),__vite__mapDeps([3,1,2]))),G=_(()=>h(()=>import("./index-B3ZheI5m.js").then(e=>e.cl),__vite__mapDeps([1,2]))),S=_(()=>h(()=>import("./index-B3ZheI5m.js").then(e=>e.co),__vite__mapDeps([1,2]))),x=[n.ADMINISTRATION,n.DASHBOARD,n.CLIENTS,n.PATIENTS,n.PATIENTS_COMPACT,n.SAMPLES,n.QC_SAMPLES,n.WORKSHEETS,n.NOTICE_MANAGER,n.BIO_BANKING,n.INVENTORY,n.REFERRAL,n.SCHEMES,n.DOCUMENT,n.BILLING];let o=fe();const{withClientMutation:u}=Z();o.fetchGroupsAndPermissions();const B=I(()=>o.getGroups);let T=m("permissions");const U=["permissions"];let g=m(!1),y=m("");const b=m(!0);let v=$({});const c=m(null),k=ce({name:V().trim().required("Group name is required"),pages:me().of(V()).nullable()}),{handleSubmit:M,resetForm:w,setValues:C}=pe({validationSchema:k,initialValues:{name:"",pages:[]}}),{value:j,errorMessage:H}=R("name"),{value:K,errorMessage:q}=R("pages");function J(e){const i=e.pages;Object.assign(v,{...e,pages:i?.split(",")||[]}),N.value?.forEach(a=>{a[1].forEach(l=>{l.checked=!1,v.permissions?.some(z=>z?.uid==l?.uid||!1)&&(l.checked=!0)})})}function Q(e,i={}){if(b.value=e,g.value=!0,y.value=(e?"CREATE":"EDIT")+" USER GROUP",e)c.value=null,w({values:{name:"",pages:[]}});else{c.value=i.uid??null;const a=Array.isArray(i.pages)?i.pages:typeof i.pages=="string"?i.pages.split(",").map(l=>l.trim()).filter(Boolean):[];C({name:i.name??"",pages:a})}}const W=M(e=>{const i={name:e.name,pages:(e.pages??[]).join(",")};if(b.value===!0&&u(ee,{payload:i},"createGroup").then(a=>o.addGroup(a)),b.value===!1){if(!c.value)return;u(se,{uid:c.value,payload:{name:i.name,pages:i.pages}},"updateGroup").then(a=>o.updateGroup(a))}g.value=!1}),P=(e,i)=>e?.reduce(function(a,l){return(a[l[i]]=a[l[i]]||[]).push(l),a},{}),N=I(()=>Array.from(Object.entries(P(o.getPermissions,"target"))));function Y(e,i){u(te,{groupUid:e?.uid,permissionUid:i?.uid},"updateGroupPermissions").then(a=>o.updateGroupsAndPermissions(a))}const D={VueMultiselect:A,BeakSwitch:r,modal:G,accordion:S,pages:x,get userStore(){return o},set userStore(e){o=e},withClientMutation:u,groups:B,get currentTab(){return T},set currentTab(e){T=e},tabs:U,get showModal(){return g},set showModal(e){g=e},get formTitle(){return y},set formTitle(e){y=e},formAction:b,get userGroup(){return v},set userGroup(e){v=e},currentUid:c,groupSchema:k,handleSubmit:M,resetForm:w,setValues:C,name:j,nameError:H,pagesField:K,pagesError:q,selectGroup:J,FormManager:Q,saveForm:W,groupBy:P,permissions:N,updateGroupPerms:Y};return Object.defineProperty(D,"__isScriptSetup",{enumerable:!1,value:!0}),D}}),be={class:"space-y-6"},ve={class:"flex items-center justify-between"},_e={class:"border border-border bg-card rounded-lg shadow-sm"},he={class:"relative w-full overflow-auto"},xe={class:"w-full caption-bottom text-sm beak-table"},ye={class:"[&_tr:last-child]:border-0"},Ee={class:"px-4 py-2 align-middle"},Ae={class:"px-4 py-2 align-middle text-primary"},Ge={class:"px-4 py-2 align-middle text-right"},Se=["onClick"],Te={class:"text-xl font-semibold text-foreground"},ke={class:"space-y-4"},Me={class:"space-y-2"},we={key:0,class:"text-sm text-destructive"},Ce={class:"space-y-2"},Pe={key:0,class:"text-sm text-destructive"};function Ne(L,t,A,r,G,S){const x=re("beak-modal");return d(),p(F,null,[s("div",be,[s("div",ve,[t[5]||(t[5]=s("h1",{class:"text-2xl font-bold text-card-foreground"},"Groups",-1)),s("button",{onClick:t[0]||(t[0]=o=>r.FormManager(!0)),class:"inline-flex items-center justify-center rounded-md text-sm font-medium ring-offset-background transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 bg-primary text-primary-foreground hover:bg-primary/90 h-10 px-4 py-2"}," Add Group ")]),s("div",_e,[s("div",he,[s("table",xe,[t[6]||(t[6]=s("thead",{class:"[&_tr]:border-b"},[s("tr",{class:"border-b transition-colors hover:bg-muted/50 data-[state=selected]:bg-muted"},[s("th",{class:"h-12 px-4 text-left align-middle font-medium text-muted-foreground"},"Group Name"),s("th",{class:"h-12 px-4 text-left align-middle font-medium text-muted-foreground"},"Access Pages"),s("th",{class:"h-12 px-4 text-right align-middle font-medium text-muted-foreground"},"Actions")])],-1)),s("tbody",ye,[(d(!0),p(F,null,ne(r.groups,o=>(d(),p("tr",{key:o.uid,class:"border-b transition-colors hover:bg-muted/50 data-[state=selected]:bg-muted"},[s("td",Ee,f(o.name),1),s("td",Ae,f(o.pages),1),s("td",Ge,[s("button",{onClick:u=>r.FormManager(!1,o),class:"inline-flex items-center justify-center rounded-md text-sm font-medium ring-offset-background transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 border border-input bg-background hover:bg-accent hover:text-accent-foreground h-9 px-3"}," Edit ",8,Se)])]))),128))])])])])]),r.showModal?(d(),ie(x,{key:0,onClose:t[4]||(t[4]=o=>r.showModal=!1)},{header:O(()=>[s("h2",Te,f(r.formTitle),1)]),body:O(()=>[s("form",{onSubmit:t[3]||(t[3]=ae((...o)=>r.saveForm&&r.saveForm(...o),["prevent"])),class:"space-y-4"},[s("div",ke,[s("div",Me,[t[7]||(t[7]=s("label",{class:"text-sm font-medium leading-none peer-disabled:cursor-not-allowed peer-disabled:opacity-70"}," Group Name ",-1)),le(s("input",{"onUpdate:modelValue":t[1]||(t[1]=o=>r.name=o),class:"flex h-10 w-full rounded-md border border-input bg-background px-3 py-2 text-sm ring-offset-background file:border-0 file:bg-transparent file:text-sm file:font-medium placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50",placeholder:"Enter group name..."},null,512),[[de,r.name]]),r.nameError?(d(),p("p",we,f(r.nameError),1)):E("",!0)]),s("div",Ce,[t[8]||(t[8]=s("label",{class:"text-sm font-medium leading-none peer-disabled:cursor-not-allowed peer-disabled:opacity-70"}," Pages ",-1)),ue(r.VueMultiselect,{modelValue:r.pagesField,"onUpdate:modelValue":t[2]||(t[2]=o=>r.pagesField=o),options:r.pages,multiple:!0,"close-on-select":!1,"use-teleport":!0,placeholder:"Select access pages",class:"multiselect-primary"},null,8,["modelValue"]),r.pagesError?(d(),p("p",Pe,f(r.pagesError),1)):E("",!0)])]),t[9]||(t[9]=s("div",{class:"flex justify-end"},[s("button",{type:"submit",class:"inline-flex items-center justify-center rounded-md text-sm font-medium ring-offset-background transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 bg-primary text-primary-foreground hover:bg-primary/90 h-10 px-4 py-2"}," Save Changes ")],-1))],32)]),_:1})):E("",!0)],64)}const Oe=oe(ge,[["render",Ne],["__file","/home/administrator/Documents/Development/beak-insights/felicity/felicity-lims/webapp/views/admin/users/Groups.vue"]]);export{Oe as default};
