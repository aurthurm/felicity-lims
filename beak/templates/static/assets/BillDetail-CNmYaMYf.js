const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/BeakDataTable-CSqXb4Dl.js","assets/index-DCVfsbos.js","assets/index-C_1sfwqa.css"])))=>i.map(i=>d[i]);
import{f as Z,i as $,a0 as ue,aq as fe,a7 as f,ad as me,a5 as ge,a1 as pe,a6 as be,a8 as J,_ as ye,r as X,aa as N,c as m,o as l,A as e,E as x,C as P,F as c,H as E,L as a,D as _,J as B,K as q,P as V,a as A,N as u,Q as C,a9 as ve,a2 as M}from"./index-DCVfsbos.js";import{u as xe}from"./billing-DgtkDXhi.js";import{g as _e,C as he,h as we}from"./billing.mutations-xeFsMwi-.js";import{I as Ce,l as Te}from"./billing.queries-C5-RkHZH.js";import{c as ke,a as L,d as Be,u as Ve,b as O}from"./index.esm-89YX2EbQ.js";function Ae(){const{withClientQuery:T}=Z(),{swalConfirm:o,toastSuccess:i,toastError:s}=$();return{downloadInvoice:async p=>{try{if((await o("You want to download this invoice","Are you sure?")).isConfirmed){const r=await T(Ce,{billUid:p},"billInvoiceCreate","network-only");if(r){const b=document.createElement("a");b.href=`data:application/pdf;base64,${r}`,b.setAttribute("download","invoice-report.pdf"),b.click(),i("Invoice downloaded successfully")}}}catch(d){s(`Failed to download invoice: ${d instanceof Error?d.message:"Unknown error"}`)}}}}const Me=ue({__name:"BillDetail",props:{customerUid:{type:String,required:!0},testBill:{type:Object,required:!0}},setup(T,{expose:o}){o();const i=pe(()=>be(()=>import("./BeakDataTable-CSqXb4Dl.js"),__vite__mapDeps([0,1,2]))),s=T,{toastSuccess:h}=$(),{withClientMutation:p,withClientQuery:d}=Z(),r=xe(),{transactions:b,fetchingTransactions:F}=fe(r),D=f(["cash","medical-aid","e-payment"]),t=f(!1);me(()=>{g(s.testBill)}),ge(()=>s.testBill,n=>{n?.uid&&g(n)},{deep:!0});const g=n=>{S.value=[],r.fetchBillTransactions(n.uid),R(n.uid)},S=f([]),R=async n=>{const v=await d(Te,{uid:n},"ordersByBillUid");S.value=v};function ee(n,v){let I=[];return n.forEach(j=>I.push(j.name)),v.forEach(j=>I.push(j.name)),I.join(", ")}const Y=ke({testBillUid:L().required(),kind:L().required(),amount:Be().required(),notes:L()}),{handleSubmit:K,errors:oe,setFieldValue:w}=Ve({validationSchema:Y,initialValues:{testBillUid:s.testBill?.uid}}),{value:se}=O("kind"),{value:te}=O("amount"),{value:ne}=O("notes"),y=f(!1),ie=K(n=>{y.value=!0,Q(n)}),ae=()=>{s.testBill?.uid&&(w("testBillUid",s.testBill?.uid),w("kind","cash"),w("amount",Math.ceil(Number((s.testBill?.totalCharged-s.testBill?.totalPaid).toFixed(2)))),w("notes",""),t.value=!0)},Q=n=>{p(_e,{payload:n},"createTestBillTransaction").then(v=>{r.addTransaction(v),y.value=!1,t.value=!1,h("Transaction added.")})},U=f(!1),k=f({}),re=()=>{y.value=!0,p(he,{uid:k.value.uid,notes:k.value.notes},"confirmTestBillTransaction").then(n=>{r.updateTransaction(n),y.value=!1,U.value=!1,h("Transaction confirmed.")})},le=f([{name:"Kind",value:"kind",sortable:!0,sortBy:"asc",defaultSort:!0,showInToggler:!1,hidden:!1},{name:"Amount",value:"amount",sortable:!1,sortBy:"asc",hidden:!1},{name:"Success",value:"isSuccess",sortable:!1,sortBy:"asc",hidden:!1},{name:"Notes",value:"notes",sortable:!1,sortBy:"asc",hidden:!1},{name:"Message",value:"message",sortable:!1,sortBy:"asc",hidden:!1},{name:"Processed",value:"processed",sortable:!1,sortBy:"asc",hidden:!1,customRender:function(n,v){return J("span",{innerHTML:n.processed?"Yes":"Pending confirmation"},[])}},{name:"Action",sortable:!1,hidden:!1,customRender:(n,v)=>{if(!n.processed)return J("button",{onClick(){U.value=!0,k.value=n},type:"button",class:"bg-primary text-primary-foreground py-1 px-2 rounded-sm leading-none"},"confirm")}}]),W=f(!1),H=f({code:""}),de=()=>{W.value=!0},ce=()=>{y.value=!0,p(we,{payload:{voucherCode:H.value?.code,testBillUid:s.testBill?.uid,customerUid:s.customerUid}},"applyVoucher").then(n=>y.value=!1)},{downloadInvoice:z}=Ae(),G={DataTable:i,props:s,toastSuccess:h,withClientMutation:p,withClientQuery:d,billingStore:r,transactions:b,fetchingTransactions:F,kinds:D,showTransactionModal:t,selectTestBill:g,orders:S,getOrders:R,profileAnalysesText:ee,transactionSchema:Y,handleSubmit:K,errors:oe,setFieldValue:w,kind:se,amount:te,notes:ne,processing:y,submitTransactionForm:ie,newTransaction:ae,addTransaction:Q,showConfirmTransactionModal:U,confirmTransaction:k,submitConfirmTransaction:re,tableColumns:le,showVoucherModal:W,voucherCodeForm:H,applyVoucher:de,submitVoucherCodeForm:ce,downloadInvoice:z,invoice:async n=>await z(n.uid)};return Object.defineProperty(G,"__isScriptSetup",{enumerable:!1,value:!0}),G}}),Fe={class:"space-y-6"},De={initial:{opacity:0,y:-100},enter:{opacity:1,y:0,scale:1},variants:{custom:{scale:2}},delay:400,class:"col-span-9 space-y-6"},Se={class:"bg-background rounded-lg shadow-sm p-6 space-y-4"},Ue={class:"flex justify-between items-center"},Ie={class:"text-lg font-semibold text-foreground"},je={class:"grid grid-cols-3 gap-8"},Ne={class:"space-y-4"},Pe={class:"flex justify-between items-center"},Ee={class:"text-sm text-foreground"},qe={class:"flex justify-between items-center"},Le={class:"text-sm text-foreground"},Oe={class:"space-y-4"},Re={class:"flex justify-between items-center"},Ye={class:"text-sm text-foreground"},Ke={class:"flex justify-between items-center"},Qe={class:"text-sm text-foreground"},We={class:"space-y-4"},He={class:"flex justify-between items-center"},ze={class:"text-sm text-foreground"},Ge={class:"space-y-4"},Je={class:"flex justify-between items-center"},Xe={class:"bg-background rounded-lg shadow-sm p-6 space-y-4"},Ze={class:"font-semibold text-foreground"},$e={class:"text-muted-foreground"},eo={class:"ml-2 text-primary"},oo={class:"space-y-4"},so={class:"flex justify-between items-center"},to={class:"space-x-4"},no={class:"bg-background rounded-lg shadow-sm p-6"},io={class:"space-y-6 p-6"},ao={class:"grid grid-cols-2 gap-6"},ro={class:"space-y-2"},lo=["disabled"],co=["value"],uo={class:"text-sm text-destructive"},fo={class:"space-y-2"},mo=["disabled"],go={class:"space-y-2"},po=["disabled"],bo={class:"flex justify-end"},yo={class:"space-y-6 p-6"},vo={class:"text-lg font-medium text-foreground"},xo={class:"space-y-2"},_o=["disabled"],ho={class:"flex justify-end"},wo={class:"space-y-6 p-6"},Co={class:"space-y-2"},To=["disabled"],ko={class:"flex justify-end"};function Bo(T,o,i,s,h,p){const d=X("beak-button"),r=X("beak-modal"),b=N("motion-slide-top"),F=N("motion-slide-right"),D=N("motion");return l(),m(B,null,[e("div",Fe,[c((l(),m("section",De,[c((l(),m("div",Se,[e("div",Ue,[e("h4",Ie,a(i.testBill.billId?.toLocaleUpperCase()),1)]),e("div",je,[e("div",Ne,[e("div",Pe,[o[9]||(o[9]=e("span",{class:"text-sm font-medium text-foreground"},"Active:",-1)),e("span",Ee,a(i.testBill.isActive?"Yes":"No"),1)]),e("div",qe,[o[10]||(o[10]=e("span",{class:"text-sm font-medium text-foreground"},"Confirmed:",-1)),e("span",Le,a(i.testBill?.toConfirm?"No":"Yes"),1)])]),e("div",Oe,[e("div",Re,[o[11]||(o[11]=e("span",{class:"text-sm font-medium text-foreground"},"Total Charged:",-1)),e("span",Ye,a(i.testBill?.totalCharged),1)]),e("div",Ke,[o[12]||(o[12]=e("span",{class:"text-sm font-medium text-foreground"},"Total Paid:",-1)),e("span",Qe,a(i.testBill?.totalPaid),1)])]),e("div",We,[e("div",He,[o[13]||(o[13]=e("span",{class:"text-sm font-medium text-foreground"},"Partial:",-1)),e("span",ze,a(i.testBill?.totalPaid<i.testBill?.totalCharged?"Yes":"No"),1)])])])])),[[b]]),e("div",Ge,[e("div",Je,[o[14]||(o[14]=e("h4",{class:"text-lg font-semibold text-foreground"},"Order Items",-1)),e("button",{class:"px-4 py-2 bg-primary text-primary-foreground rounded-md hover:bg-primary/90 transition-colors duration-200 focus:outline-none focus:ring-2 focus:ring-primary/50",onClick:o[0]||(o[0]=_(t=>s.invoice(i.testBill),["prevent"]))}," Invoice ")]),e("ul",Xe,[(l(!0),m(B,null,q(s.orders,t=>(l(),m("li",{class:"space-y-2",key:t.uid},[e("div",Ze,a(t?.requestId)+" ("+a(t?.clientRequestId)+")",1),(l(!0),m(B,null,q(t.samples,g=>c((l(),m("div",{class:"space-y-1 pl-4",key:g.uid},[e("span",$e,a(g.sampleId),1),o[15]||(o[15]=V(" â‡’ ",-1)),e("span",eo,a(s.profileAnalysesText(g.profiles??[],g.analyses??[])),1)])),[[F]])),128))]))),128))])]),e("div",oo,[e("div",so,[o[16]||(o[16]=e("h4",{class:"text-lg font-semibold text-foreground"},"Transactions",-1)),e("div",to,[c(e("button",{class:"px-4 py-2 bg-primary text-primary-foreground rounded-md hover:bg-primary/90 transition-colors duration-200 focus:outline-none focus:ring-2 focus:ring-primary/50",onClick:_(s.newTransaction,["prevent"])}," Add Transaction ",512),[[E,i.testBill.isActive]]),c(e("button",{class:"px-4 py-2 bg-primary text-primary-foreground rounded-md hover:bg-primary/90 transition-colors duration-200 focus:outline-none focus:ring-2 focus:ring-primary/50",onClick:_(s.applyVoucher,["prevent"])}," Apply Voucher ",512),[[E,i.testBill.isActive]])])]),e("div",no,[A(s.DataTable,{columns:s.tableColumns,data:s.transactions,toggleColumns:!1,loading:s.fetchingTransactions,paginable:!1,searchable:!1,filterable:!1,selectable:!1},{footer:u(()=>[...o[17]||(o[17]=[])]),_:1},8,["columns","data","loading"])])])])),[[E,i.testBill.uid],[D]])]),x(" New Transaction Form Modal "),s.showTransactionModal?(l(),P(r,{key:0,onClose:o[4]||(o[4]=t=>s.showTransactionModal=!1),contentWidth:"w-3/6",class:"bg-background"},{header:u(()=>[...o[18]||(o[18]=[e("h3",{class:"text-xl font-semibold text-foreground"},"Transaction Form",-1)])]),body:u(()=>[e("form",io,[e("div",ao,[e("label",ro,[o[20]||(o[20]=e("span",{class:"text-sm font-medium text-foreground"},"Kind of payment",-1)),c(e("select",{class:C(["w-full rounded-md border border-input bg-background px-3 py-2 text-sm ring-offset-background focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2",{"border-destructive":s.errors.kind}]),"onUpdate:modelValue":o[1]||(o[1]=t=>s.kind=t),disabled:s.processing},[o[19]||(o[19]=e("option",null,null,-1)),(l(!0),m(B,null,q(s.kinds,t=>(l(),m("option",{key:t,value:t},a(t),9,co))),128))],10,lo),[[ve,s.kind]]),e("div",uo,a(s.errors.gender),1)]),e("label",fo,[o[21]||(o[21]=e("span",{class:"text-sm font-medium text-foreground"},"Amount",-1)),c(e("input",{class:C(["w-full rounded-md border border-input bg-background px-3 py-2 text-sm ring-offset-background focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2",{"border-destructive":s.errors.amount}]),type:"number","onUpdate:modelValue":o[2]||(o[2]=t=>s.amount=t),disabled:s.processing},null,10,mo),[[M,s.amount]])])]),e("label",go,[o[22]||(o[22]=e("span",{class:"text-sm font-medium text-foreground"},"Notes",-1)),c(e("input",{class:C(["w-full rounded-md border border-input bg-background px-3 py-2 text-sm ring-offset-background focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2",{"border-destructive":s.errors.notes}]),"onUpdate:modelValue":o[3]||(o[3]=t=>s.notes=t),disabled:s.processing},null,10,po),[[M,s.notes]])]),e("div",bo,[A(d,{color:"primary",type:"submit",loading:s.processing,onClick:_(s.submitTransactionForm,["prevent"])},{default:u(()=>[...o[23]||(o[23]=[V(" Save Transaction ",-1)])]),_:1},8,["loading","onClick"])])])]),_:1})):x("v-if",!0),x(" Confirm Transaction Form Modal "),s.showConfirmTransactionModal?(l(),P(r,{key:1,onClose:o[6]||(o[6]=t=>s.showConfirmTransactionModal=!1),contentWidth:"w-3/6",class:"bg-background"},{header:u(()=>[...o[24]||(o[24]=[e("h3",{class:"text-xl font-semibold text-foreground"},"Confirm Transaction",-1)])]),body:u(()=>[e("form",yo,[e("h4",vo,a(s.kind)+" Transaction",1),e("label",xo,[o[25]||(o[25]=e("span",{class:"text-sm font-medium text-foreground"},"Notes",-1)),c(e("input",{class:C(["w-full rounded-md border border-input bg-background px-3 py-2 text-sm ring-offset-background focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2",{"border-destructive":s.errors.notes}]),"onUpdate:modelValue":o[5]||(o[5]=t=>s.confirmTransaction.notes=t),disabled:s.processing},null,10,_o),[[M,s.confirmTransaction.notes]])]),e("div",ho,[A(d,{color:"primary",type:"submit",loading:s.processing,onClick:_(s.submitConfirmTransaction,["prevent"])},{default:u(()=>[...o[26]||(o[26]=[V(" Confirm Transaction ",-1)])]),_:1},8,["loading"])])])]),_:1})):x("v-if",!0),x(" Voucher Code Form Modal "),s.showVoucherModal?(l(),P(r,{key:2,onClose:o[8]||(o[8]=t=>s.showVoucherModal=!1),contentWidth:"w-1/5",class:"bg-background"},{header:u(()=>[...o[27]||(o[27]=[e("h3",{class:"text-xl font-semibold text-foreground"},"Apply Voucher Code",-1)])]),body:u(()=>[e("form",wo,[e("label",Co,[o[28]||(o[28]=e("span",{class:"text-sm font-medium text-foreground"},"Voucher Code",-1)),c(e("input",{class:C(["w-full rounded-md border border-input bg-background px-3 py-2 text-sm ring-offset-background focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2",{"border-destructive":!s.voucherCodeForm.code}]),type:"text","onUpdate:modelValue":o[7]||(o[7]=t=>s.voucherCodeForm.code=t),disabled:s.processing},null,10,To),[[M,s.voucherCodeForm.code]])]),e("div",ko,[A(d,{color:"primary",type:"submit",loading:s.processing,onClick:_(s.submitVoucherCodeForm,["prevent"])},{default:u(()=>[...o[29]||(o[29]=[V(" Apply Voucher ",-1)])]),_:1},8,["loading"])])])]),_:1})):x("v-if",!0)],64)}const Uo=ye(Me,[["render",Bo],["__scopeId","data-v-3a43e177"],["__file","/home/administrator/Documents/Development/beak-insights/beak/beak-lims/webapp/components/billing/BillDetail.vue"]]);export{Uo as default};
