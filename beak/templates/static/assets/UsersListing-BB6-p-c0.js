const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/vue-multiselect.esm-CQe58Q7H.js","assets/index-DCVfsbos.js","assets/index-C_1sfwqa.css"])))=>i.map(i=>d[i]);
import{a0 as z,a7 as h,a5 as me,b4 as pe,_ as H,c as l,o as i,E as d,Q as k,A as r,L as n,J as w,K as L,ad as fe,h as S,f as be,a1 as ve,a6 as ge,bh as ye,bi as ke,r as he,C as we,N as xe,D as Ue,F as _,a2 as E,a as G,a9 as K}from"./index-DCVfsbos.js";import{c as _e,a as g,e as Ne,f as R,h as Ee,u as Le,b as p}from"./index.esm-89YX2EbQ.js";import{u as Ae}from"./user-C8Z2RT46.js";import{u as Ce}from"./setup-DMRnqeyP.js";const Be=z({__name:"BeakProtectedInput",props:{modelValue:{type:String,required:!0},disabled:{type:Boolean,required:!1,default:!1},placeholder:{type:String,required:!1,default:""},requiredClicks:{type:Number,required:!1,default:3},type:{type:String,required:!1,default:"text"},id:{type:String,required:!1,default:""},class:{type:String,required:!1,default:""}},emits:["update:modelValue"],setup(A,{expose:t,emit:c}){t();const e=A,f=c,y=h(!0),b=h(e.modelValue),o=h(),u=h(0),m=h();me(()=>e.modelValue,v=>{b.value=v});const C=v=>{if(!(e.disabled||!y.value)){if(v.preventDefault(),v.stopPropagation(),u.value++,m.value&&clearTimeout(m.value),u.value>=e.requiredClicks){N();return}m.value=setTimeout(()=>{u.value=0},1500)}},N=async()=>{y.value=!1,u.value=0,m.value&&clearTimeout(m.value),await pe(),o.value?.focus(),o.value?.select()},x=()=>{y.value=!0,u.value=0,m.value&&clearTimeout(m.value)},B={props:e,emit:f,isProtected:y,inputValue:b,inputRef:o,clickCount:u,clickTimeout:m,handleProtectedClick:C,unlockInput:N,lockInput:x,handleInput:v=>{const V=v.target;b.value=V.value,f("update:modelValue",V.value)},handleKeydown:v=>{v.key==="Enter"?(x(),o.value?.blur()):v.key==="Escape"&&(b.value=e.modelValue,f("update:modelValue",e.modelValue),x(),o.value?.blur())},handleBlur:()=>{setTimeout(()=>{x()},200)}};return Object.defineProperty(B,"__isScriptSetup",{enumerable:!1,value:!0}),B}}),Ve={class:"relative"},Se=["title"],qe={key:0,class:"text-foreground"},Me={key:1,class:"text-muted-foreground"},Pe={key:0,class:"absolute inset-y-0 right-0 flex items-center pr-3 pointer-events-none"},Ie={key:0,class:"flex items-center space-x-1 bg-background/95 backdrop-blur-sm px-2 py-1 rounded-md shadow-sm border border-border"},Fe={class:"flex space-x-1"},Te={class:"text-xs text-muted-foreground ml-1"},De={class:"relative"},Oe=["id","value","type","placeholder","disabled"];function Ge(A,t,c,e,f,y){return i(),l("div",Ve,[d(" Protected State "),e.isProtected?(i(),l("div",{key:0,onClick:e.handleProtectedClick,class:k(["relative cursor-pointer transition-all duration-200 group select-none",c.disabled?"cursor-not-allowed opacity-50":"hover:ring-2 hover:ring-primary/20 hover:bg-primary/5",e.clickCount>0&&!c.disabled&&"ring-2 ring-primary/30 bg-primary/10"]),title:c.disabled?"Input is disabled":`Click ${c.requiredClicks} times quickly to unlock for editing (${e.clickCount}/${c.requiredClicks})`},[d(" Input Display "),r("div",{class:k(["w-full px-3 py-2 bg-background border border-border rounded-md text-sm transition-colors duration-200",c.disabled?"bg-muted text-muted-foreground cursor-not-allowed":e.clickCount>0?"border-primary bg-primary/5 text-foreground":"text-foreground group-hover:border-primary/50"])},[e.inputValue?(i(),l("span",qe,n(e.inputValue),1)):(i(),l("span",Me,n(c.placeholder),1))],2),d(" Lock/Progress Indicator "),c.disabled?d("v-if",!0):(i(),l("div",Pe,[d(" Click Progress "),e.clickCount>0?(i(),l("div",Ie,[r("div",Fe,[(i(!0),l(w,null,L(c.requiredClicks,b=>(i(),l("div",{key:b,class:k(["w-1.5 h-1.5 rounded-full transition-all duration-200",b<=e.clickCount?"bg-primary":"bg-muted"])},null,2))),128))]),r("span",Te,n(c.requiredClicks-e.clickCount)+" more ",1)])):(i(),l(w,{key:1},[d(" Lock Icon "),t[0]||(t[0]=r("div",{class:"text-muted-foreground bg-background/80 backdrop-blur-sm p-1 rounded transition-colors duration-200 group-hover:text-primary"},[r("svg",{class:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[r("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M12 15v2m-6 4h12a2 2 0 002-2v-6a2 2 0 00-2-2H6a2 2 0 00-2 2v6a2 2 0 002 2zm10-10V7a4 4 0 00-8 0v4h8z"})])],-1))],2112))]))],10,Se)):(i(),l(w,{key:1},[d(" Unlocked State "),r("div",De,[r("input",{ref:"inputRef",id:c.id,value:e.inputValue,type:c.type,placeholder:c.placeholder,disabled:c.disabled,onInput:e.handleInput,onKeydown:e.handleKeydown,onBlur:e.handleBlur,class:"w-full px-3 py-2 bg-background border-2 border-primary text-foreground rounded-md text-sm placeholder:text-muted-foreground transition-colors duration-200 focus:border-primary focus:outline-none focus:ring-2 focus:ring-primary/20"},null,40,Oe),d(" Unlocked Icon "),t[1]||(t[1]=r("div",{class:"absolute inset-y-0 right-0 flex items-center pr-3 pointer-events-none"},[r("div",{class:"text-primary bg-background/90 backdrop-blur-sm p-1 rounded"},[r("svg",{class:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[r("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M8 11V7a4 4 0 118 0m-4 8v2m-6 4h12a2 2 0 002-2v-6a2 2 0 00-2 2v6a2 2 0 002 2z"})])])],-1))])],2112))])}const Ke=H(Be,[["render",Ge],["__file","/home/administrator/Documents/Development/beak-insights/beak/beak-lims/webapp/components/ui/form/BeakProtectedInput.vue"]]),Re=z({__name:"UsersListing",setup(A,{expose:t}){t();const c=ve(()=>ge(()=>import("./vue-multiselect.esm-CQe58Q7H.js"),__vite__mapDeps([0,1,2]))),e=Ae(),f=Ce();fe(()=>{e.fetchUsers({}),e.fetchGroupsAndPermissions(),f.fetchLaboratories()});let y=S(()=>e.getUsers);const b=S(()=>e.getGroups);let o=h(!1),u=h("");const m=h(!0),C=_e({userUid:g().nullable(),firstName:g().trim().required("First name is required"),lastName:g().trim().required("Last name is required"),email:g().trim().email("Enter a valid email").required("Email is required"),groupUid:g().trim().required("Group is required"),userName:g().trim().required("Username is required"),password:g().when("userUid",{is:s=>!s,then:s=>s.required("Password is required"),otherwise:s=>s.nullable()}),passwordc:g().when("password",{is:s=>!!s,then:s=>s.oneOf([Ee("password")],"Passwords must match").required("Confirm your password"),otherwise:s=>s.nullable()}),isActive:R().default(!0),isBlocked:R().default(!1),laboratoryUids:Ne().of(g()).default([]),activeLaboratoryUid:g().trim().nullable()}),{handleSubmit:N,resetForm:x,setValues:q}=Le({validationSchema:C,initialValues:{userUid:"",firstName:"",lastName:"",email:"",groupUid:"",userName:"",password:"",passwordc:"",isActive:!0,isBlocked:!1,laboratoryUids:[],activeLaboratoryUid:""}}),{value:I}=p("userUid"),{value:F,errorMessage:B}=p("firstName"),{value:v,errorMessage:V}=p("lastName"),{value:J,errorMessage:Q}=p("email"),{value:W,errorMessage:X}=p("groupUid"),{value:Y,errorMessage:Z}=p("userName"),{value:j,errorMessage:$}=p("password"),{value:ee,errorMessage:re}=p("passwordc"),{value:te}=p("isActive"),{value:se}=p("isBlocked"),{value:M}=p("laboratoryUids"),{value:oe,errorMessage:ae}=p("activeLaboratoryUid"),ie=S(()=>f.getLaboratories.map(s=>({...s,displayLabel:s.code?`${s.name} (${s.code})`:s.name}))),le=S({get:()=>M.value.map(s=>f.getLaboratories.find(a=>a.uid===s)).filter(Boolean).map(s=>({...s,displayLabel:s?.code?`${s.name} (${s.code})`:s?.name??""})),set:s=>{M.value=(s||[]).map(a=>a.uid)}}),{withClientMutation:P}=be();function T(s){P(ye,s,"createUser").then(a=>e.addUser(a))}function D(s){P(ke,s,"updateUser").then(a=>e.updateUser(a))}function ne(s){let a=[];return s?.groups?.forEach(U=>a.push(U?.name)),a.join(", ")}const de=s=>{const a=f.getLaboratories.find(U=>U.uid===s);return a?a?.name||"Unknown Laboratory":"-- Not Assigned --"};function ce(s,a={}){m.value=s,o.value=!0,u.value=(s?"CREATE":"EDIT")+" USER",s?x({values:{userUid:"",firstName:"",lastName:"",email:"",groupUid:"",userName:"",password:"",passwordc:"",isActive:!0,isBlocked:!1,laboratoryUids:[],activeLaboratoryUid:""}}):q({userUid:a?.uid||"",firstName:a?.firstName??"",lastName:a?.lastName??"",email:a?.email??"",groupUid:a?.groups&&a.groups[0]?a.groups[0].uid:"",userName:a?.userName??"",password:"",passwordc:"",isActive:a?.isActive??!0,isBlocked:a?.isBlocked??!1,laboratoryUids:Array.isArray(a?.laboratories)?a.laboratories.map(U=>typeof U=="string"?U:U.uid):[],activeLaboratoryUid:a?.activeLaboratoryUid||""})}const ue=N(s=>{const a={firstName:s.firstName,lastName:s.lastName,email:s.email,groupUid:s.groupUid,activeLaboratoryUid:s.activeLaboratoryUid||null,laboratoryUids:s.laboratoryUids||[],userName:s.userName};if(m.value)T({...a,password:s.password||"",passwordc:s.passwordc||""});else{if(!s.userUid)return;D({userUid:s.userUid,...a,isActive:s.isActive,isBlocked:s.isBlocked,password:s.password||void 0,passwordc:s.passwordc||void 0})}o.value=!1}),O={VueMultiselect:c,userStore:e,setupStore:f,get users(){return y},set users(s){y=s},groups:b,get showUserModal(){return o},set showUserModal(s){o=s},get formTitle(){return u},set formTitle(s){u=s},formAction:m,userSchema:C,handleSubmit:N,resetForm:x,setValues:q,userUid:I,firstName:F,firstNameError:B,lastName:v,lastNameError:V,email:J,emailError:Q,groupUid:W,groupUidError:X,userName:Y,userNameError:Z,password:j,passwordError:$,passwordc:ee,passwordcError:re,isActive:te,isBlocked:se,laboratoryUids:M,activeLaboratoryUid:oe,activeLaboratoryUidError:ae,laboratoriesForSelect:ie,selectedLaboratories:le,withClientMutation:P,addUser:T,editUser:D,userGroupsName:ne,getLaboratoryName:de,FormManager:ce,saveUserForm:ue,headers:["Full Name","Email","Active","Group","Username","Blocked","Active Laboratory","Assigned Labs","Actions"],BeakProtectedInput:Ke};return Object.defineProperty(O,"__isScriptSetup",{enumerable:!1,value:!0}),O}}),ze={class:"space-y-6"},He={class:"flex justify-between items-center"},Je={class:"bg-card rounded-lg shadow-sm"},Qe={class:"min-w-full divide-y divide-border beak-table"},We={class:"bg-background divide-y divide-border"},Xe={class:"whitespace-nowrap"},Ye={class:"whitespace-nowrap"},Ze={class:"whitespace-nowrap"},je={class:"whitespace-nowrap"},$e={class:"whitespace-nowrap"},er={class:"whitespace-nowrap"},rr={class:"whitespace-nowrap"},tr={class:"whitespace-nowrap"},sr={class:"whitespace-nowrap text-right"},or=["onClick"],ar={class:"grid grid-cols-2 gap-6"},ir={class:"space-y-2"},lr={key:0,class:"text-sm text-destructive"},nr={class:"space-y-2"},dr={key:0,class:"text-sm text-destructive"},cr={class:"space-y-2"},ur={key:0,class:"text-sm text-destructive"},mr={class:"space-y-2"},pr={key:0,class:"text-sm text-destructive"},fr={class:"space-y-2"},br={key:0,class:"text-sm text-destructive"},vr={class:"space-y-2"},gr={key:0,class:"text-sm text-destructive"},yr={class:"col-span-2 space-y-2"},kr=["value"],hr={key:0,class:"text-sm text-destructive"},wr={class:"col-span-2 space-y-4 border-t border-border pt-6"},xr={class:"space-y-2"},Ur={key:0,class:"space-y-2"},_r=["value"],Nr={key:0,class:"text-sm text-destructive"},Er={class:"flex items-center space-x-4"},Lr={class:"flex items-center space-x-2"},Ar=["aria-checked"],Cr={class:"flex items-center space-x-4"},Br={class:"flex items-center space-x-2"},Vr=["aria-checked"],Sr={class:"flex justify-end pt-6"},qr={type:"submit",class:"inline-flex justify-center rounded-md border border-transparent bg-primary px-4 py-2 text-sm font-medium text-primary-foreground hover:bg-primary/90 focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 transition-colors duration-200"};function Mr(A,t,c,e,f,y){const b=he("beak-modal");return i(),l(w,null,[r("div",ze,[r("div",He,[t[14]||(t[14]=r("h1",{class:"text-2xl font-bold text-card-foreground"},"Users",-1)),r("button",{onClick:t[0]||(t[0]=o=>e.FormManager(!0)),class:"inline-flex items-center px-4 py-2 bg-primary text-primary-foreground rounded-md hover:bg-primary/90 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-primary","aria-label":"Add new user"}," Add User ")]),r("div",Je,[r("table",Qe,[r("thead",null,[r("tr",null,[(i(),l(w,null,L(e.headers,o=>r("th",{key:o,class:"text-left"},n(o),1)),64))])]),r("tbody",We,[(i(!0),l(w,null,L(e.users,o=>(i(),l("tr",{key:o.uid,class:"hover:bg-muted/50"},[r("td",Xe,n(o.firstName)+" "+n(o.lastName),1),r("td",Ye,n(o.email),1),r("td",Ze,[r("span",{class:k(["inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium",o.isActive?"bg-success/20 text-success":"bg-destructive/20 text-destructive"])},n(o.isActive?"Active":"Inactive"),3)]),r("td",je,n(o.groups?.map(u=>u?.name).join(", ")),1),r("td",$e,n(o.userName),1),r("td",er,[r("span",{class:k(["inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium",o.isBlocked?"bg-destructive/20 text-destructive":"bg-success/20 text-success"])},n(o.isBlocked?"Blocked":"Active"),3)]),r("td",rr,n(e.getLaboratoryName(o.activeLaboratoryUid||"")),1),r("td",tr,n(o.laboratories?.length)+" Labs",1),r("td",sr,[r("button",{onClick:u=>e.FormManager(!1,o),class:"text-primary hover:text-primary/80 focus:outline-none focus:underline","aria-label":"Edit user"}," Edit ",8,or)])]))),128))])])])]),e.showUserModal?(i(),we(b,{key:0,onClose:t[13]||(t[13]=o=>e.showUserModal=!1),title:e.userUid?"Edit User":"Add User"},{body:xe(()=>[r("form",{onSubmit:t[12]||(t[12]=Ue((...o)=>e.saveUserForm&&e.saveUserForm(...o),["prevent"])),class:"space-y-6"},[r("div",ar,[d(" OPTION 1: Enhanced visibility with explicit colors "),r("div",ir,[t[15]||(t[15]=r("label",{for:"firstName",class:"beak-label"}," First Name ",-1)),_(r("input",{id:"firstName","onUpdate:modelValue":t[1]||(t[1]=o=>e.firstName=o),type:"text",class:"beak-input",placeholder:"Enter first name"},null,512),[[E,e.firstName]]),e.firstNameError?(i(),l("p",lr,n(e.firstNameError),1)):d("v-if",!0)]),r("div",nr,[t[16]||(t[16]=r("label",{for:"lastName",class:"beak-label"}," Last Name ",-1)),_(r("input",{id:"lastName","onUpdate:modelValue":t[2]||(t[2]=o=>e.lastName=o),type:"text",class:"beak-input",placeholder:"Enter last name"},null,512),[[E,e.lastName]]),e.lastNameError?(i(),l("p",dr,n(e.lastNameError),1)):d("v-if",!0)]),r("div",cr,[t[17]||(t[17]=r("label",{for:"email",class:"beak-label"}," Email ",-1)),_(r("input",{id:"email","onUpdate:modelValue":t[3]||(t[3]=o=>e.email=o),type:"email",class:"beak-input",placeholder:"Enter email address"},null,512),[[E,e.email]]),e.emailError?(i(),l("p",ur,n(e.emailError),1)):d("v-if",!0)]),r("div",mr,[t[18]||(t[18]=r("label",{for:"userName",class:"beak-label"}," Username ",-1)),d(` <input
              id="userName"
              v-model="form.userName"
              type="text"
              :disabled="form.userUid != ''"
              class="beak-input"
              placeholder="Enter username"
            /> `),G(e.BeakProtectedInput,{id:"userName",modelValue:e.userName,"onUpdate:modelValue":t[4]||(t[4]=o=>e.userName=o),type:"text","required-clicks":5,placeholder:"Enter username"},null,8,["modelValue"]),e.userNameError?(i(),l("p",pr,n(e.userNameError),1)):d("v-if",!0)]),r("div",fr,[t[19]||(t[19]=r("label",{for:"password",class:"beak-label"}," Password ",-1)),_(r("input",{id:"password","onUpdate:modelValue":t[5]||(t[5]=o=>e.password=o),type:"password",class:"beak-input",placeholder:"Enter password"},null,512),[[E,e.password]]),e.passwordError?(i(),l("p",br,n(e.passwordError),1)):d("v-if",!0)]),r("div",vr,[t[20]||(t[20]=r("label",{for:"passwordc",class:"beak-label"}," Confirm Password ",-1)),_(r("input",{id:"passwordc","onUpdate:modelValue":t[6]||(t[6]=o=>e.passwordc=o),type:"password",class:"beak-input",placeholder:"Confirm password"},null,512),[[E,e.passwordc]]),e.passwordcError?(i(),l("p",gr,n(e.passwordcError),1)):d("v-if",!0)]),r("div",yr,[t[22]||(t[22]=r("label",{for:"groupUid",class:"beak-label"}," Group ",-1)),_(r("select",{id:"groupUid","onUpdate:modelValue":t[7]||(t[7]=o=>e.groupUid=o),class:"beak-select"},[t[21]||(t[21]=r("option",{value:"",class:"text-muted-foreground"},"Select a group",-1)),(i(!0),l(w,null,L(e.groups,o=>(i(),l("option",{key:o.uid,value:o.uid,class:"text-foreground"},n(o?.name),9,kr))),128))],512),[[K,e.groupUid]]),e.groupUidError?(i(),l("p",hr,n(e.groupUidError),1)):d("v-if",!0)]),d(" Laboratory Assignment Section "),r("div",wr,[t[26]||(t[26]=r("h4",{class:"text-base font-medium text-foreground"},"Laboratory Access (Optional)",-1)),d(" Laboratory Multi-Select "),r("div",xr,[t[23]||(t[23]=r("label",{class:"beak-label"},"Assigned Laboratories",-1)),G(e.VueMultiselect,{modelValue:e.selectedLaboratories,"onUpdate:modelValue":t[8]||(t[8]=o=>e.selectedLaboratories=o),options:e.laboratoriesForSelect,multiple:!0,"close-on-select":!1,"use-teleport":!0,label:"displayLabel","track-by":"uid",placeholder:"Select laboratories",class:"multiselect-primary"},null,8,["modelValue","options"])]),d(" Active Laboratory Selection "),e.laboratoryUids&&e.laboratoryUids.length>0?(i(),l("div",Ur,[t[25]||(t[25]=r("label",{class:"beak-label"},"Default Active Laboratory",-1)),_(r("select",{"onUpdate:modelValue":t[9]||(t[9]=o=>e.activeLaboratoryUid=o),class:"beak-select"},[t[24]||(t[24]=r("option",{value:""},"Select default laboratory...",-1)),(i(!0),l(w,null,L(e.laboratoryUids,o=>(i(),l("option",{key:o,value:o,class:"text-foreground"},n(e.getLaboratoryName(o)),9,_r))),128))],512),[[K,e.activeLaboratoryUid]]),e.activeLaboratoryUidError?(i(),l("p",Nr,n(e.activeLaboratoryUidError),1)):d("v-if",!0)])):d("v-if",!0)]),r("div",Er,[r("label",Lr,[t[27]||(t[27]=r("span",{class:"text-sm font-medium text-foreground"},"Blocked",-1)),r("button",{type:"button",role:"switch","aria-checked":e.isBlocked,onClick:t[10]||(t[10]=o=>e.isBlocked=!e.isBlocked),class:k(["relative inline-flex h-6 w-11 shrink-0 cursor-pointer rounded-full border-2 border-transparent transition-colors duration-200 ease-in-out focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 shadow-sm",[e.isBlocked?"bg-destructive":"bg-success"]])},[r("span",{"aria-hidden":"true",class:k(["pointer-events-none inline-block h-5 w-5 transform rounded-full bg-background shadow ring-0 transition duration-200 ease-in-out",[e.isBlocked?"translate-x-5":"translate-x-0"]])},null,2)],10,Ar)])]),r("div",Cr,[r("label",Br,[t[28]||(t[28]=r("span",{class:"text-sm font-medium text-foreground"},"Active",-1)),r("button",{type:"button",role:"switch","aria-checked":e.isActive,onClick:t[11]||(t[11]=o=>e.isActive=!e.isActive),class:k(["relative inline-flex h-6 w-11 shrink-0 cursor-pointer rounded-full border-2 border-transparent transition-colors duration-200 ease-in-out focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 shadow-sm",[e.isActive?"bg-success":"bg-destructive"]])},[r("span",{"aria-hidden":"true",class:k(["pointer-events-none inline-block h-5 w-5 transform rounded-full bg-background shadow ring-0 transition duration-200 ease-in-out",[e.isActive?"translate-x-5":"translate-x-0"]])},null,2)],10,Vr)])])]),r("div",Sr,[r("button",qr,n(e.userUid?"Update":"Create")+" User ",1)])],32)]),_:1},8,["title"])):d("v-if",!0)],64)}const Or=H(Re,[["render",Mr],["__scopeId","data-v-0b494f3a"],["__file","/home/administrator/Documents/Development/beak-insights/beak/beak-lims/webapp/views/admin/users/UsersListing.vue"]]);export{Or as default};
