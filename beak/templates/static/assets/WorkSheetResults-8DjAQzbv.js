const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/index-DCVfsbos.js","assets/index-C_1sfwqa.css","assets/BeakSelect-BUgj-MLc.js","assets/BeakSwitch-6dLMxGgA.js"])))=>i.map(i=>d[i]);
import{a0 as ce,S as me,ac as pe,a4 as fe,a7 as i,h as ge,g as he,a1 as D,a6 as N,av as L,_ as ve,c as y,o as x,E as ee,A as o,F as u,H as w,a as l,N as f,P as g,a3 as te,J as be,K as ke,Q as se,L as _,a2 as ye}from"./index-DCVfsbos.js";import{u as xe}from"./worksheet-CWPxSiuQ.js";import{u as we}from"./analysis-CsALefh6.js";import{u as _e}from"./user-C8Z2RT46.js";import{u as Se}from"./setup-DMRnqeyP.js";import{s as Re}from"./index-BaPnjn4Y.js";import"./analyses.mutations-BEU63HnJ.js";const Ce=ce({__name:"WorkSheetResults",setup(m,{expose:s}){s();const T=D(()=>N(()=>import("./index-DCVfsbos.js").then(t=>t.cm),__vite__mapDeps([0,1]))),e=D(()=>N(()=>import("./BeakSelect-BUgj-MLc.js"),__vite__mapDeps([2,0,1]))),j=D(()=>N(()=>import("./BeakSwitch-6dLMxGgA.js"),__vite__mapDeps([3,0,1]))),h=me(),a=Se(),c=_e(),I=pe(),F=fe();let S=i(!1),R=i(!1),C=i(!1),U=i(!1),A=i(!1),V=i(!1),v=i(!1),W=i(!1),d=ge(()=>h.getWorkSheet);const P=()=>{h.fetchWorksheetByUid(I.params.workSheetUid)};c.fetchUsers({}),a.fetchLaboratoryInstruments(),a.fetchMethods();const z=he({analystUid:null,instrumentUid:null,methodUid:null}),E=i(!1),ae=()=>{E.value=!0,h.updateWorksheet({worksheetUid:I.params.workSheetUid,...z}).then(()=>{E.value=!1,P()})};function M(){return d.value?.analysisResults?.every(t=>t.checked===!0)}function b(){let t=[];return d.value?.analysisResults?.forEach(n=>{n.checked&&t.push(n)}),t}function oe(){M()?v.value=!0:v.value=!1,p()}function O(t){if(Y(t)){B(t);return}t.checked=!0,p()}function Y(t){return["retracted","approved"].includes(t.status)}function B(t){t.checked=!1,p()}function ne(){d?.value?.analysisResults?.forEach(t=>v.value?O(t):B(t)),p()}function le(){d?.value?.analysisResults?.forEach(t=>B(t)),p()}function re(t){let n=[];return t?.forEach(r=>n.push(r.name)),n.join(", ")}function J(t){t.editable=!0}function ie(t){return t.status!=="pending"?!1:t?.editable||L(t?.result)?(J(t),!0):!1}function q(){let t=b(),n=[];return t?.forEach(r=>n.push({uid:r.uid,result:r.result,laboratoryInstrumentUid:r.laboratoryInstrumentUid,methodUid:r.methodUid})),n}function k(){const t=b();let n=[];return t?.forEach(r=>n.push(r.uid)),n}function G(){const t=b();let n=[];return t?.forEach(r=>n.push(r.sample?.uid)),n}function de(t){switch(t?.status){case"retracted":return"bg-muted text-sm italic text-muted-foreground";default:return"text-sm leading-5 text-primary"}}function ue(t){switch(t?.status){case"retracted":return!0;case"approved":return t?.reportable===!1;default:return!1}}function p(){S.value=!1,A.value=!1,R.value=!1,C.value=!1,U.value=!1,V.value=!1;const t=b();t.length!==0&&(V.value=!0,t.every(n=>n.status==="pending"&&!L(n.methodUid)&&!L(n.laboratoryInstrumentUid))&&(S.value=!0,A.value=!0),t.every(n=>n.status==="resulted")&&(R.value=!0,C.value=!0,U.value=!0))}const{submitResults:H,approveResults:K,retractResults:Q,retestResults:X}=we(),{unAssignSamples:Z}=xe(),$={FButton:T,BeakSelect:e,BeakSwitch:j,worksheetStore:h,setupStore:a,userStore:c,route:I,router:F,get can_submit(){return S},set can_submit(t){S=t},get can_retract(){return R},set can_retract(t){R=t},get can_approve(){return C},set can_approve(t){C=t},get can_retest(){return U},set can_retest(t){U=t},get can_unassign(){return A},set can_unassign(t){A=t},get barcodes(){return V},set barcodes(t){V=t},get allChecked(){return v},set allChecked(t){v=t},get viewDetail(){return W},set viewDetail(t){W=t},get worksheet(){return d},set worksheet(t){d=t},refresh:P,form:z,applying:E,applyChanges:ae,areAllChecked:M,getResultsChecked:b,checkCheck:oe,check:O,checkDisabled:Y,unCheck:B,toggleCheckAll:ne,unCheckAll:le,analysesText:re,editResult:J,isEditable:ie,prepareResults:q,getResultsUids:k,getSampleUids:G,getResultRowColor:de,isDisabledRowCheckBox:ue,checkUserActionPermissios:p,submitter_:H,approver_:K,retracter_:Q,retester_:X,unassinger_:Z,unAssignSamples:()=>Z(k()),submitResults:()=>H(q(),"worksheet",d.value?.uid),approveResults:()=>K(k(),"worksheet",d.value?.uid),retractResults:()=>Q(k()),retestResults:()=>X(k()),printBarCodes:async()=>{window.open(F.resolve({name:"print-barcodes",query:{sampleUids:JSON.stringify(G().join(","))}}).href,"_blank")},get shield(){return Re}};return Object.defineProperty($,"__isScriptSetup",{enumerable:!1,value:!0}),$}}),Ue={class:"space-y-6"},Ae={class:"flex items-center justify-between bg-background rounded-lg shadow-sm p-4"},Ve={class:"flex items-center space-x-4"},Be={class:"flex items-center space-x-4"},Ie={class:"bg-background rounded-lg shadow-sm overflow-hidden"},Ee={class:"p-4 border-b border-border"},De={class:"grid grid-cols-3 gap-4"},Ne={class:"block space-y-2"},Le={class:"block space-y-2"},Te={class:"block space-y-2"},je={class:"mt-4 flex justify-end"},Fe={class:"overflow-x-auto"},We={class:"w-full beak-table"},Pe={class:"bg-muted"},ze={class:"px-4 py-3 text-left text-xs font-medium text-muted-foreground uppercase tracking-wider"},Me={class:"divide-y divide-border"},Oe={class:"px-4 py-3 whitespace-nowrap"},Ye=["onUpdate:modelValue","disabled"],Je={class:"px-4 py-3 whitespace-nowrap"},qe={class:"px-4 py-3 whitespace-nowrap"},Ge={class:"px-4 py-3 whitespace-nowrap"},He={class:"px-4 py-3 whitespace-nowrap"},Ke=["onUpdate:modelValue"],Qe={key:1},Xe={class:"px-4 py-3 whitespace-nowrap"};function Ze(m,s,T,e,j,h){return x(),y("div",Ue,[ee(" Actions Bar "),o("div",Ae,[o("div",Ve,[u(l(e.FButton,{onClick:s[0]||(s[0]=a=>e.submitResults()),loading:m.submitting,variant:"primary",size:"sm"},{default:f(()=>[...s[14]||(s[14]=[g(" Submit Results ",-1)])]),_:1},8,["loading"]),[[w,e.can_submit&&e.shield.hasRights(e.shield.actions.SUBMIT,e.shield.objects.ANALYSIS)]]),u(l(e.FButton,{onClick:s[1]||(s[1]=a=>e.approveResults()),loading:m.approving,variant:"primary",size:"sm"},{default:f(()=>[...s[15]||(s[15]=[g(" Approve Results ",-1)])]),_:1},8,["loading"]),[[w,e.can_approve&&e.shield.hasRights(e.shield.actions.VERIFY,e.shield.objects.ANALYSIS)]]),u(l(e.FButton,{onClick:s[2]||(s[2]=a=>e.retractResults()),loading:m.retracting,variant:"destructive",size:"sm"},{default:f(()=>[...s[16]||(s[16]=[g(" Retract Results ",-1)])]),_:1},8,["loading"]),[[w,e.can_retract&&e.shield.hasRights(e.shield.actions.RETRACT,e.shield.objects.ANALYSIS)]]),u(l(e.FButton,{onClick:s[3]||(s[3]=a=>e.retestResults()),loading:m.retesting,variant:"secondary",size:"sm"},{default:f(()=>[...s[17]||(s[17]=[g(" Retest ",-1)])]),_:1},8,["loading"]),[[w,e.can_retest&&e.shield.hasRights(e.shield.actions.RETEST,e.shield.objects.ANALYSIS)]]),u(l(e.FButton,{onClick:s[4]||(s[4]=a=>e.unAssignSamples()),loading:m.unassigning,variant:"secondary",size:"sm"},{default:f(()=>[...s[18]||(s[18]=[g(" Unassign ",-1)])]),_:1},8,["loading"]),[[w,e.can_unassign&&e.shield.hasRights(e.shield.actions.UNASSIGN,e.shield.objects.ANALYSIS)]])]),o("div",Be,[l(e.BeakSwitch,{modelValue:e.viewDetail,"onUpdate:modelValue":s[5]||(s[5]=a=>e.viewDetail=a),label:"View Detail"},null,8,["modelValue"]),l(e.BeakSwitch,{modelValue:e.barcodes,"onUpdate:modelValue":s[6]||(s[6]=a=>e.barcodes=a),label:"Print Barcodes"},null,8,["modelValue"])])]),ee(" Results Table "),o("div",Ie,[o("div",Ee,[o("div",De,[o("label",Ne,[s[19]||(s[19]=o("span",{class:"text-sm font-medium text-foreground"},"Analyst",-1)),l(e.BeakSelect,{modelValue:e.form.analystUid,"onUpdate:modelValue":s[7]||(s[7]=a=>e.form.analystUid=a),options:e.userStore.getUsers,"option-label":"firstName","option-value":"uid",placeholder:"Select Analyst",class:"w-full"},null,8,["modelValue","options"])]),o("label",Le,[s[20]||(s[20]=o("span",{class:"text-sm font-medium text-foreground"},"Instrument",-1)),l(e.BeakSelect,{modelValue:e.form.instrumentUid,"onUpdate:modelValue":s[8]||(s[8]=a=>e.form.instrumentUid=a),options:e.setupStore.getLaboratoryInstruments,"option-label":"name","option-value":"uid",placeholder:"Select Instrument",class:"w-full"},null,8,["modelValue","options"])]),o("label",Te,[s[21]||(s[21]=o("span",{class:"text-sm font-medium text-foreground"},"Method",-1)),l(e.BeakSelect,{modelValue:e.form.methodUid,"onUpdate:modelValue":s[9]||(s[9]=a=>e.form.methodUid=a),options:e.setupStore.getMethods,"option-label":"name","option-value":"uid",placeholder:"Select Method",class:"w-full"},null,8,["modelValue","options"])])]),o("div",je,[l(e.FButton,{onClick:s[10]||(s[10]=a=>e.applyChanges()),loading:e.applying,variant:"primary",size:"sm"},{default:f(()=>[...s[22]||(s[22]=[g(" Apply Changes ",-1)])]),_:1},8,["loading"])])]),o("div",Fe,[o("table",We,[o("thead",Pe,[o("tr",null,[o("th",ze,[u(o("input",{type:"checkbox","onUpdate:modelValue":s[11]||(s[11]=a=>e.allChecked=a),onClick:s[12]||(s[12]=a=>e.toggleCheckAll()),class:"rounded border-input text-primary focus:ring-primary"},null,512),[[te,e.allChecked]])]),s[23]||(s[23]=o("th",{class:"px-4 py-3 text-left text-xs font-medium text-muted-foreground uppercase tracking-wider"},"Sample ID",-1)),s[24]||(s[24]=o("th",{class:"px-4 py-3 text-left text-xs font-medium text-muted-foreground uppercase tracking-wider"},"Client Sample ID",-1)),s[25]||(s[25]=o("th",{class:"px-4 py-3 text-left text-xs font-medium text-muted-foreground uppercase tracking-wider"},"Analysis",-1)),s[26]||(s[26]=o("th",{class:"px-4 py-3 text-left text-xs font-medium text-muted-foreground uppercase tracking-wider"},"Result",-1)),s[27]||(s[27]=o("th",{class:"px-4 py-3 text-left text-xs font-medium text-muted-foreground uppercase tracking-wider"},"Status",-1))])]),o("tbody",Me,[(x(!0),y(be,null,ke(e.worksheet?.analysisResults,a=>(x(),y("tr",{key:a.uid,class:se(e.getResultRowColor(a))},[o("td",Oe,[u(o("input",{type:"checkbox","onUpdate:modelValue":c=>a.checked=c,onClick:s[13]||(s[13]=c=>e.checkCheck()),disabled:e.isDisabledRowCheckBox(a),class:"rounded border-input text-primary focus:ring-primary"},null,8,Ye),[[te,a.checked]])]),o("td",Je,_(a.sample?.sampleId),1),o("td",qe,_(a.sample?.clientSampleId),1),o("td",Ge,_(a.analysis?.name),1),o("td",He,[e.isEditable(a)?u((x(),y("input",{key:0,type:"text","onUpdate:modelValue":c=>a.result=c,class:"w-full px-2 py-1 border border-input rounded-md bg-background text-foreground focus:outline-none focus:ring-2 focus:ring-primary"},null,8,Ke)),[[ye,a.result]]):(x(),y("span",Qe,_(a.result),1))]),o("td",Xe,[o("span",{class:se(["inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium",{"bg-primary/10 text-primary":a.status==="pending","bg-warning/10 text-warning":a.status==="awaiting","bg-success/10 text-success":a.status==="approved","bg-destructive/10 text-destructive":a.status==="retracted"}])},_(a.status),3)])],2))),128))])])])])])}const mt=ve(Ce,[["render",Ze],["__file","/home/administrator/Documents/Development/beak-insights/beak/beak-lims/webapp/views/worksheet/_id/WorkSheetResults.vue"]]);export{mt as default};
