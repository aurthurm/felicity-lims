"""remodelled user preferences

Revision ID: 9d42a09f0754
Revises: c03167691623
Create Date: 2024-10-27 06:28:17.903319

"""
import sqlalchemy as sa
from alembic import op

# revision identifiers, used by Alembic.
revision = '9d42a09f0754'
down_revision = 'c03167691623'
branch_labels = None
depends_on = None


def upgrade():
    # ### commands auto generated by Alembic - please adjust! ###
    op.drop_index('ix_analysis_result_level', table_name='analysis_result')
    op.drop_index('ix_analysis_result_lft', table_name='analysis_result')
    op.drop_index('ix_analysis_result_rgt', table_name='analysis_result')
    op.create_index('analysis_result_level_idx', 'analysis_result', ['level'], unique=False)
    op.create_index('analysis_result_lft_idx', 'analysis_result', ['lft'], unique=False)
    op.create_index('analysis_result_rgt_idx', 'analysis_result', ['rgt'], unique=False)
    op.drop_index('ix_message_level', table_name='message')
    op.drop_index('ix_message_lft', table_name='message')
    op.drop_index('ix_message_rgt', table_name='message')
    op.create_index('message_level_idx', 'message', ['level'], unique=False)
    op.create_index('message_lft_idx', 'message', ['lft'], unique=False)
    op.create_index('message_rgt_idx', 'message', ['rgt'], unique=False)
    op.drop_index('ix_sample_level', table_name='sample')
    op.drop_index('ix_sample_lft', table_name='sample')
    op.drop_index('ix_sample_rgt', table_name='sample')
    op.create_index('sample_level_idx', 'sample', ['level'], unique=False)
    op.create_index('sample_lft_idx', 'sample', ['lft'], unique=False)
    op.create_index('sample_rgt_idx', 'sample', ['rgt'], unique=False)
    op.drop_constraint('user_preference_uid_fkey', 'user', type_='foreignkey')
    op.drop_column('user', 'preference_uid')
    op.add_column('user_preference', sa.Column('user_uid', sa.String(), nullable=True))
    op.create_unique_constraint(None, 'user_preference', ['user_uid'])
    op.create_foreign_key(None, 'user_preference', 'user', ['user_uid'], ['uid'], ondelete='CASCADE')
    op.add_column("user_preference", sa.Column("default_route", sa.String(), nullable=True))
    # ### end Alembic commands ###


def downgrade():
    # ### commands auto generated by Alembic - please adjust! ###
    op.drop_constraint(None, 'user_preference', type_='foreignkey')
    op.drop_constraint(None, 'user_preference', type_='unique')
    op.drop_column('user_preference', 'user_uid')
    op.add_column('user', sa.Column('preference_uid', sa.VARCHAR(), autoincrement=False, nullable=True))
    op.create_foreign_key('user_preference_uid_fkey', 'user', 'user_preference', ['preference_uid'], ['uid'])
    op.drop_index('sample_rgt_idx', table_name='sample')
    op.drop_index('sample_lft_idx', table_name='sample')
    op.drop_index('sample_level_idx', table_name='sample')
    op.create_index('ix_sample_rgt', 'sample', ['rgt'], unique=False)
    op.create_index('ix_sample_lft', 'sample', ['lft'], unique=False)
    op.create_index('ix_sample_level', 'sample', ['level'], unique=False)
    op.drop_index('message_rgt_idx', table_name='message')
    op.drop_index('message_lft_idx', table_name='message')
    op.drop_index('message_level_idx', table_name='message')
    op.create_index('ix_message_rgt', 'message', ['rgt'], unique=False)
    op.create_index('ix_message_lft', 'message', ['lft'], unique=False)
    op.create_index('ix_message_level', 'message', ['level'], unique=False)
    op.drop_index('analysis_result_rgt_idx', table_name='analysis_result')
    op.drop_index('analysis_result_lft_idx', table_name='analysis_result')
    op.drop_index('analysis_result_level_idx', table_name='analysis_result')
    op.create_index('ix_analysis_result_rgt', 'analysis_result', ['rgt'], unique=False)
    op.create_index('ix_analysis_result_lft', 'analysis_result', ['lft'], unique=False)
    op.create_index('ix_analysis_result_level', 'analysis_result', ['level'], unique=False)
    op.drop_column("user_preference", "default_route")
    # ### end Alembic commands ###
