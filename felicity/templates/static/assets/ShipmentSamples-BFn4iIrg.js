import{Y as z,ag as L,a0 as B,a7 as q,av as G,a3 as K,_ as O,r as m,aF as E,c as b,o as u,D as a,z as n,E as f,F as H,H as N,I as v,aG as Y,al as J,a as l,K as i,M as g,A as j,C as Q,N as W}from"./index-OdhKCqIc.js";import{u as X}from"./shipment-BZXEcwwZ.js";import{u as Z}from"./shipment-DcKVexkp.js";const $=z({__name:"ShipmentSamples",setup(F,{expose:e}){e();const k=Z(),o=L();let _=B(!1),c=q(()=>k.getShipment);const y=()=>{k.fetchShipmentByUid(o.params.shipmentUid)},r=G({laboratoryUid:void 0,comment:void 0,courier:void 0}),x=B(!1),D=()=>{x.value=!0,k.updateShipment({uid:o.params.shipmentUid,payload:r}).then(()=>{x.value=!1,y()})};function d(){return c.value?.samples?.every(s=>s.checked===!0)}function C(){let s=[];return c.value?.shippedSamples?.forEach(p=>{p?.checked&&s.push(p.sample)}),s}function M(){d()?_.value=!0:_.value=!1,w()}function U(s){if(T(s)||c.value?.state!=="preperation"){S(s);return}s.checked=!0,w()}function T(s){return["retracted","approved"].includes(s.status)}function S(s){s.checked=!1,w()}function I(){c?.value?.samples?.forEach(s=>_.value?U(s):S(s)),w()}function t(){return C().map(s=>({sampleUid:s.uid,shipedSampleUid:void 0,analyses:[]}))}let h=B(!1),R=B(!1);function w(){h.value=!1,R.value=!1;const s=C();s.length!==0&&(s.every(p=>["referred","paired"].includes(p.status??""))&&(h.value=!0),s.every(p=>p.status==="referred")&&(R.value=!0))}const P=q(()=>!["cancelled","dispatched"].includes(c.value?.state??"")),{manageSamples:A}=X(),V={shipmentStore:k,route:o,get allChecked(){return _},set allChecked(s){_=s},get shipment(){return c},set shipment(s){c=s},refresh:y,form:r,applying:x,applyChanges:D,areAllChecked:d,getSamplesChecked:C,checkCheck:M,check:U,checkDisabled:T,unCheck:S,toggleCheckAll:I,getSelectedMetadata:t,get can_recover(){return h},set can_recover(s){h=s},get can_recall(){return R},set can_recall(s){R=s},checkUserActionPermissios:w,viewShipmentModifier:P,manageSamples:A,sampleManager:s=>{const p=t();A(c?.value?.uid,p,s)},get Button(){return K}};return Object.defineProperty(V,"__isScriptSetup",{enumerable:!1,value:!0}),V}}),ee={class:"space-y-6"},te={class:"space-y-4"},se={action:"post",class:"space-y-4"},oe={class:"flex flex-wrap gap-4 items-end"},ne={class:"flex-1 min-w-[200px]"},le={class:"block space-y-1.5"},ie=["value"],ae={class:"flex-1 min-w-[200px]"},re={class:"block space-y-1.5"},de={class:"text-sm text-muted-foreground"},ce={class:"border border-border bg-card rounded-lg shadow-md"},me={class:"relative w-full overflow-auto"},ue={class:"text-sm font-medium"},fe={key:1},pe={class:"text-sm"},ge={class:"text-sm"},be={class:"text-sm"},ve={class:"inline-flex items-center rounded-md bg-primary/10 px-2 py-1 text-xs font-medium text-primary"},_e={class:"flex gap-2"};function xe(F,e,k,o,_,c){const y=m("Checkbox"),r=m("TableHead"),x=m("TableRow"),D=m("TableHeader"),d=m("TableCell"),C=m("font-awesome-icon"),M=m("router-link"),U=m("TableBody"),T=m("Table"),S=E("motion-slide-left"),I=E("motion-slide-right");return u(),b("div",ee,[a((u(),b("div",te,[a(n("form",se,[n("div",oe,[n("div",ne,[n("label",le,[e[7]||(e[7]=n("span",{class:"text-sm font-medium leading-none peer-disabled:cursor-not-allowed peer-disabled:opacity-70"},"Reference Laboratory",-1)),a(n("select",{name:"laboratory_uid","onUpdate:modelValue":e[0]||(e[0]=t=>o.form.laboratoryUid=t),class:"flex h-10 w-full rounded-md border border-input bg-background px-3 py-2 text-sm ring-offset-background file:border-0 file:bg-transparent file:text-sm file:font-medium placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50"},[(u(!0),b(H,null,N(o.shipmentStore.laboratories,t=>(u(),b("option",{key:t.uid,value:t.uid},v(t.name),9,ie))),128))],512),[[Y,o.form.laboratoryUid]])])]),n("div",ae,[n("label",re,[e[8]||(e[8]=n("span",{class:"text-sm font-medium leading-none peer-disabled:cursor-not-allowed peer-disabled:opacity-70"},"Courier",-1)),a(n("input",{type:"text",class:"flex h-10 w-full rounded-md border border-input bg-background px-3 py-2 text-sm ring-offset-background file:border-0 file:bg-transparent file:text-sm file:font-medium placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50","onUpdate:modelValue":e[1]||(e[1]=t=>o.form.courier=t)},null,512),[[J,o.form.courier]])])]),n("div",null,[l(o.Button,{onClick:e[2]||(e[2]=t=>o.applyChanges()),color:"sky-800",class:"h-10 px-4"},{default:i(()=>[...e[9]||(e[9]=[g(" Apply ",-1)])]),_:1})])])],512),[[f,!o.applying&&!o.shipmentStore.shipment?.incoming]]),a(n("p",de,"Updating...",512),[[f,o.applying]]),n("div",null,[n("button",{onClick:e[3]||(e[3]=t=>o.refresh()),class:"inline-flex items-center justify-center rounded-md text-sm font-medium transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:opacity-50 disabled:pointer-events-none ring-offset-background border border-input hover:bg-accent hover:text-accent-foreground h-9 px-4"}," Refresh ")])])),[[f,o.viewShipmentModifier],[S]]),n("div",ce,[n("div",me,[l(T,{class:"w-full caption-bottom text-sm"},{default:i(()=>[l(D,{class:"[&_tr]:border-b"},{default:i(()=>[l(x,{class:"border-b transition-colors hover:bg-muted/50 data-[state=selected]:bg-muted"},{default:i(()=>[a(l(r,{class:"h-10 px-4 text-left align-middle font-medium text-muted-foreground"},{default:i(()=>[l(y,{checked:o.allChecked,"onUpdate:checked":e[4]||(e[4]=t=>{o.allChecked=t,o.toggleCheckAll()})},null,8,["checked"])]),_:1},512),[[f,o.shipment?.state==="preperation"]]),l(r,{class:"h-10 px-4 text-left align-middle font-medium text-muted-foreground"}),l(r,{class:"h-10 px-4 text-left align-middle font-medium text-muted-foreground"},{default:i(()=>[...e[10]||(e[10]=[g("Sample ID",-1)])]),_:1}),a(l(r,{class:"h-10 px-4 text-left align-middle font-medium text-muted-foreground"},{default:i(()=>[...e[11]||(e[11]=[g(" External SID ",-1)])]),_:1},512),[[f,o.shipment?.incoming]]),l(r,{class:"h-10 px-4 text-left align-middle font-medium text-muted-foreground"},{default:i(()=>[...e[12]||(e[12]=[g("Client Request Id",-1)])]),_:1}),l(r,{class:"h-10 px-4 text-left align-middle font-medium text-muted-foreground"},{default:i(()=>[...e[13]||(e[13]=[g("Date Collected",-1)])]),_:1}),l(r,{class:"h-10 px-4 text-left align-middle font-medium text-muted-foreground"},{default:i(()=>[...e[14]||(e[14]=[g("Analysis",-1)])]),_:1}),l(r,{class:"h-10 px-4 text-left align-middle font-medium text-muted-foreground"},{default:i(()=>[...e[15]||(e[15]=[g("Status",-1)])]),_:1})]),_:1})]),_:1}),l(U,{class:"[&_tr:last-child]:border-0"},{default:i(()=>[(u(!0),b(H,null,N(o.shipment?.shippedSamples,t=>a((u(),j(x,{key:t.sampleUid,class:"border-b transition-colors hover:bg-muted/50 data-[state=selected]:bg-muted"},{default:i(()=>[a(l(d,{class:"p-4 align-middle"},{default:i(()=>[l(y,{checked:t.checked,"onUpdate:checked":h=>{t.checked=h,o.checkCheck()}},null,8,["checked","onUpdate:checked"])]),_:2},1536),[[f,o.shipment?.state==="preperation"]]),l(d,{class:"p-4 align-middle"},{default:i(()=>[t.sample?.priority??!1?(u(),b("span",{key:0,class:W(["text-sm",{"text-destructive":t.sample?.priority??!1}])},[l(C,{icon:"fa-star"})],2)):Q("",!0)]),_:2},1024),l(d,{class:"p-4 align-middle"},{default:i(()=>[n("div",ue,[t.sample?.analysisRequest?.patient?.uid?(u(),j(M,{key:0,to:{name:"sample-detail",params:{patientUid:t.sample?.analysisRequest?.patient?.uid,sampleUid:t.sample?.uid}},class:"text-primary hover:underline"},{default:i(()=>[g(v(t.sample?.sampleId),1)]),_:2},1032,["to"])):(u(),b("div",fe,v(t.sample?.sampleId),1))])]),_:2},1024),a(l(d,{class:"p-4 align-middle"},{default:i(()=>[n("div",pe,v(t.extSampleId),1)]),_:2},1536),[[f,o.shipment?.incoming]]),l(d,{class:"p-4 align-middle"},{default:i(()=>[n("div",ge,v(t.sample?.analysisRequest?.clientRequestId),1)]),_:2},1024),l(d,{class:"p-4 align-middle"},{default:i(()=>[n("div",be,v(t.sample?.dateCollected),1)]),_:2},1024),l(d,{class:"p-4 align-middle"},{default:i(()=>[...e[16]||(e[16]=[n("div",{class:"text-sm"},"tests",-1)])]),_:1}),l(d,{class:"p-4 align-middle"},{default:i(()=>[n("span",ve,v(t.sample?.status||"unknown"),1)]),_:2},1024)]),_:2},1024)),[[I]])),128))]),_:1})]),_:1})])]),n("section",_e,[a(n("button",{onClick:e[5]||(e[5]=t=>o.sampleManager("recover")),class:"inline-flex items-center justify-center rounded-md text-sm font-medium transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:opacity-50 disabled:pointer-events-none ring-offset-background border border-input hover:bg-accent hover:text-accent-foreground h-9 px-4"}," Remove ",512),[[f,o.can_recover]]),a(n("button",{onClick:e[6]||(e[6]=t=>o.sampleManager("recall")),class:"inline-flex items-center justify-center rounded-md text-sm font-medium transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:opacity-50 disabled:pointer-events-none ring-offset-background border border-input hover:bg-accent hover:text-accent-foreground h-9 px-4"}," Pair ",512),[[f,o.can_recall]])])])}const Se=O($,[["render",xe],["__file","/home/administrator/Documents/Development/beak-insights/felicity/felicity-lims/webapp/views/shipment/_id/ShipmentSamples.vue"]]);export{Se as default};
