import{W as ge,u as ve,h as _e,a2 as G,r as T,am as he,o as r,c as a,O as t,a as c,D as i,$ as K,F as f,H as y,a5 as q,z as p,L as N,J as d,a4 as $,Z as ke,a7 as D,E as k,M as b,N as R,C,a0 as z,a1 as W,ao as H,Q as Re,i as Ce,_ as Ue}from"./index-93739211.js";import{u as we}from"./analysis-cdcc3ff0.js";import{p as O}from"./index-0f6f1926.js";import{h as U,o as w,a as E}from"./constants-c5e2e8e5.js";import"./analyses.mutations-e3a0ff1f.js";const Ee={class:"space-y-6"},Se={class:"rounded-lg border border-border bg-background shadow-sm"},Ve={key:0,class:"p-6 text-center"},Ae={key:1,class:"overflow-x-auto"},De={class:"w-full"},Ie={class:"border-b border-border bg-muted/50"},Te={class:"px-4 py-3 text-left text-sm font-medium text-muted-foreground"},Ne={class:"px-4 py-3 border-b border-border"},$e={class:"flex items-center space-x-2"},Le=["onUpdate:modelValue","onChange","disabled"],Pe={class:"px-4 py-3 border-b border-border"},Be={class:"flex items-center space-x-2"},Oe=["onClick"],Me={class:"font-medium"},je={class:"px-4 py-3 border-b border-border"},Fe={key:0,class:"text-sm text-foreground"},Ge=["onUpdate:modelValue","onChange"],Ke=["value"],qe={class:"px-4 py-3 border-b border-border"},ze={key:0,class:"text-sm text-foreground"},We=["onUpdate:modelValue","onChange"],He=["value"],Je={class:"px-4 py-3 border-b border-border"},Qe={class:"text-sm text-foreground"},Ze={class:"px-4 py-3 border-b border-border"},Xe={class:"text-sm text-foreground space-x-1"},Ye={class:"px-4 py-3 border-b border-border"},et={key:0,class:"text-sm text-foreground"},tt=["onUpdate:modelValue","onChange"],st=["value"],ot={class:"px-4 py-3 border-b border-border"},nt={key:0,class:"text-sm text-foreground"},rt=["onUpdate:modelValue","onKeyup"],at=["onUpdate:modelValue","onChange"],lt=["value"],dt={class:"px-4 py-3 border-b border-border"},it={class:"text-sm"},ut={class:"px-4 py-3 border-b border-border"},ct={class:"text-sm text-foreground"},ft={class:"px-4 py-3 border-b border-border"},mt={class:"text-sm text-foreground"},pt={class:"px-4 py-3 border-b border-border"},bt={class:"text-sm text-foreground"},xt={class:"px-4 py-3 border-b border-border"},yt={class:"px-4 py-3 border-b border-border"},gt={class:"text-sm"},vt={class:"flex items-center space-x-4 pt-4"},_t={class:"space-y-6"},ht=ge({__name:"GenericResults",props:{sample:Object,analysisResults:Object,fetchingResults:Boolean},setup(u){const J=z(()=>W(()=>import("./AnalysisSneak-1d046397.js"),["assets/AnalysisSneak-1d046397.js","assets/index-93739211.js","assets/index-0f090789.css"])),Q=z(()=>W(()=>import("./ResultDetail-c8e5a48b.js"),["assets/ResultDetail-c8e5a48b.js","assets/index-93739211.js","assets/index-0f090789.css"])),M=ve(),l=_e({can_submit:!1,can_cancel:!1,can_retract:!1,can_approve:!1,can_retest:!1,can_reinstate:!1,allChecked:!1});function L(){let o=[];return u.analysisResults?.forEach(e=>{e.checked&&o.push(e)}),o}function Z(){let o=L(),e=[];return o?.forEach(m=>e.push({uid:m.uid,result:m.result,methodUid:m.methodUid,laboratoryInstrumentUid:m.laboratoryInstrumentUid})),e}function S(){const o=L();let e=[];return o?.forEach(m=>e.push(m.uid)),e}function X(o){ee()?l.allChecked=!0:l.allChecked=!1,V()}function g(o){F(o)||(o.checked=!0,V())}function j(o){o.checked=!1,V()}async function Y(){await u.analysisResults?.forEach(o=>l.allChecked?g(o):j(o)),V()}async function v(){await u.analysisResults?.forEach(o=>j(o)),V()}function ee(){return u.analysisResults?.every(o=>o.checked===!0)||!1}function F(o){switch(o?.status){case"retracted":return!0;case"approved":return!0;case"cancelled":return u.sample?.status!=="received";default:return!1}}function te(o){o.editable=!0}function I(o){return!["received","paired"].includes(u.sample?.status??"")||o.status!=="pending"?!1:o?.editable||H(o?.result)?(te(o),!0):!1}function se(o){switch(o?.status){case"retracted":return"bg-muted";case"aproved":return o?.reportable===!1?"bg-destructive":"";default:return""}}function V(){l.can_cancel=!1,l.can_submit=!1,l.can_retract=!1,l.can_approve=!1,l.can_retest=!1,l.can_reinstate=!1;const o=L();o.length!==0&&(o.every(e=>e.status==="cancelled")&&(l.can_reinstate=!0),o.every(e=>e.status==="pending")&&(l.can_cancel=!0),o.every(e=>["pending"].includes(e.status??"")&&!H(e.result))&&(l.can_submit=!0),o.every(e=>e.status==="resulted")&&(l.can_retract=!0,l.can_approve=!0,l.can_retest=!0))}const _=async()=>{const o=Ce(()=>M.getSample);o.value&&M.fetchSampleStatus(o.value.uid)},P=G(!1),A=G(void 0),oe=o=>{P.value=!0,A.value=o};let{submitResults:ne,cancelResults:re,reInstateResults:ae,approveResults:le,retractResults:de,retestResults:ie}=we();const ue=()=>ne(Z(),Re.Sample,u.sample?.uid).then(()=>_()).finally(()=>v()),ce=()=>re(S()).then(()=>_()).finally(()=>v()),fe=()=>ae(S()).then(()=>_()).finally(()=>v()),me=()=>le(S(),"sample",u.sample?.uid).then(()=>_()).finally(()=>v()),pe=()=>de(S()).then(()=>_()).finally(()=>v()),be=()=>ie(S()).then(()=>_()).finally(()=>v());return(o,e)=>{const m=T("fel-loader"),x=T("font-awesome-icon"),h=T("fel-button"),xe=T("fel-drawer"),ye=he("motion-slide-right");return r(),a(f,null,[t("div",Ee,[e[29]||(e[29]=t("div",{class:"border-t border-border my-4"},null,-1)),e[30]||(e[30]=t("h3",{class:"text-lg font-semibold text-foreground"},"Analyses/Results",-1)),e[31]||(e[31]=t("div",{class:"border-t border-border my-4"},null,-1)),t("div",Se,[u.fetchingResults?(r(),a("div",Ve,[c(m,{message:"Fetching analytes ..."})])):(r(),a("div",Ae,[t("table",De,[t("thead",null,[t("tr",Ie,[t("th",Te,[i(t("input",{type:"checkbox",onChange:Y,"onUpdate:modelValue":e[0]||(e[0]=s=>l.allChecked=s),class:"rounded border-input text-primary focus:ring-primary"},null,544),[[K,l.allChecked]])]),e[2]||(e[2]=t("th",{class:"px-4 py-3 text-left text-sm font-medium text-muted-foreground"},null,-1)),e[3]||(e[3]=t("th",{class:"px-4 py-3 text-left text-sm font-medium text-muted-foreground"},"Analysis",-1)),e[4]||(e[4]=t("th",{class:"px-4 py-3 text-left text-sm font-medium text-muted-foreground"},"Instrument",-1)),e[5]||(e[5]=t("th",{class:"px-4 py-3 text-left text-sm font-medium text-muted-foreground"},"Method",-1)),e[6]||(e[6]=t("th",{class:"px-4 py-3 text-left text-sm font-medium text-muted-foreground"},"Analyst",-1)),e[7]||(e[7]=t("th",{class:"px-4 py-3 text-left text-sm font-medium text-muted-foreground"},"Reviewer(s)",-1)),e[8]||(e[8]=t("th",{class:"px-4 py-3 text-left text-sm font-medium text-muted-foreground"},"Interim",-1)),e[9]||(e[9]=t("th",{class:"px-4 py-3 text-left text-sm font-medium text-muted-foreground"},"Result",-1)),e[10]||(e[10]=t("th",{class:"px-4 py-3 text-left text-sm font-medium text-muted-foreground"},"Retest",-1)),e[11]||(e[11]=t("th",{class:"px-4 py-3 text-left text-sm font-medium text-muted-foreground"},"Due Date",-1)),e[12]||(e[12]=t("th",{class:"px-4 py-3 text-left text-sm font-medium text-muted-foreground"},"Submitted",-1)),e[13]||(e[13]=t("th",{class:"px-4 py-3 text-left text-sm font-medium text-muted-foreground"},"Approved",-1)),e[14]||(e[14]=t("th",{class:"px-4 py-3 text-left text-sm font-medium text-muted-foreground"},"Status",-1)),e[15]||(e[15]=t("th",{class:"px-4 py-3 text-left text-sm font-medium text-muted-foreground"},"Reportable",-1)),e[16]||(e[16]=t("th",{class:"px-4 py-3"},null,-1))])]),t("tbody",null,[(r(!0),a(f,null,y(u.analysisResults,s=>i((r(),a("tr",{key:s.uid,class:q([se(s),"hover:bg-muted/50 transition-colors duration-200"])},[t("td",Ne,[t("div",$e,[i(t("input",{type:"checkbox","onUpdate:modelValue":n=>s.checked=n,onChange:n=>X(),disabled:F(s),class:"rounded border-input text-primary focus:ring-primary"},null,40,Le),[[K,s.checked]]),s.status==="pending"?(r(),p(x,{key:0,icon:"fa-question",class:"text-xs text-muted-foreground"})):N("",!0),s.status==="resulted"?(r(),p(x,{key:1,icon:"fa-question",class:"text-xs text-warning"})):N("",!0)])]),e[21]||(e[21]=t("td",{class:"px-4 py-3 border-b border-border"},null,-1)),t("td",Pe,[t("div",Be,[t("button",{type:"button",onClick:n=>oe(s),class:"text-primary hover:text-primary/80 transition-colors"},[c(x,{icon:"fa-info-circle"})],8,Oe),t("span",Me,d(s.analysis?.name),1)])]),t("td",je,[I(s)?i((r(),a("select",{key:1,"onUpdate:modelValue":n=>s.laboratoryInstrumentUid=n,onChange:n=>g(s),class:"w-full rounded-md border border-input bg-background px-3 py-2 text-sm ring-offset-background focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2"},[e[17]||(e[17]=t("option",{value:""},null,-1)),(r(!0),a(f,null,y(s.analysis?.instruments,n=>(r(),a(f,{key:n.uid},[(r(!0),a(f,null,y(n.laboratoryInstruments,B=>(r(),a("option",{key:B.uid,value:B.uid},d(B.labName)+" â†’ ("+d(n?.name)+") ",9,Ke))),128))],64))),128))],40,Ge)),[[$,s.laboratoryInstrumentUid]]):(r(),a("div",Fe,d(s.laboratoryInstrument?.labName||"---"),1))]),t("td",qe,[I(s)?i((r(),a("select",{key:1,"onUpdate:modelValue":n=>s.methodUid=n,onChange:n=>g(s),class:"w-full rounded-md border border-input bg-background px-3 py-2 text-sm ring-offset-background focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2"},[e[18]||(e[18]=t("option",{value:""},null,-1)),(r(!0),a(f,null,y(s.analysis?.methods,n=>(r(),a("option",{key:n.uid,value:n.uid},d(n.name),9,He))),128))],40,We)),[[$,s.methodUid]]):(r(),a("div",ze,d(s.method?.name||"---"),1))]),t("td",Je,[t("span",Qe,d(`${s.submittedBy?.firstName??"--"} ${s.submittedBy?.lastName??"--"}`),1)]),t("td",Ze,[t("div",Xe,[(r(!0),a(f,null,y(s.verifiedBy,n=>(r(),a("span",{key:n.uid},d(`${n?.firstName??"--"} ${n?.lastName??"--"},`),1))),128))])]),t("td",Ye,[!I(s)||s?.analysis?.interims?.length===0?(r(),a("div",et," --- ")):i((r(),a("select",{key:1,"onUpdate:modelValue":n=>s.result=n,onChange:n=>g(s),class:"w-full rounded-md border border-input bg-background px-3 py-2 text-sm ring-offset-background focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2"},[e[19]||(e[19]=t("option",{value:""},null,-1)),(r(!0),a(f,null,y(s?.analysis?.interims,n=>(r(),a("option",{key:n.key,value:n.value},d(n.value),9,st))),128))],40,tt)),[[$,s.result]])]),t("td",ot,[I(s)?s?.analysis?.resultOptions?.length===0?i((r(),a("input",{key:1,"onUpdate:modelValue":n=>s.result=n,onKeyup:n=>g(s),class:"w-full rounded-md border border-input bg-background px-3 py-2 text-sm ring-offset-background focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2"},null,40,rt)),[[ke,s.result]]):i((r(),a("select",{key:2,"onUpdate:modelValue":n=>s.result=n,onChange:n=>g(s),class:"w-full rounded-md border border-input bg-background px-3 py-2 text-sm ring-offset-background focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2"},[e[20]||(e[20]=t("option",{value:""},null,-1)),(r(!0),a(f,null,y(s?.analysis?.resultOptions,n=>(r(),a("option",{key:n.optionKey,value:n.value},d(n.value),9,lt))),128))],40,at)),[[$,s.result]]):(r(),a("div",nt,d(s?.result),1))]),t("td",dt,[t("div",it,[s?.retest?(r(),p(x,{key:0,icon:"fa-check-circle",class:"text-success"})):(r(),p(x,{key:1,icon:"fa-times-circle",class:"text-destructive"}))])]),t("td",ut,[t("span",ct,d(D(O)(s?.dueDate)),1)]),t("td",ft,[t("span",mt,d(D(O)(s?.dateSubmitted)),1)]),t("td",pt,[t("span",bt,d(D(O)(s?.dateVerified)),1)]),t("td",xt,[t("span",{class:q(["inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium",{"bg-primary/10 text-primary":s.status==="pending","bg-warning/10 text-warning":s.status==="resulted","bg-success/10 text-success":s.status==="approved","bg-destructive/10 text-destructive":s.status==="cancelled"||s.status==="retracted"}])},d(s.status),3)]),t("td",yt,[t("div",gt,[s?.reportable?(r(),p(x,{key:0,icon:"fa-thumbs-up",class:"text-success","aria-label":"Reportable"})):(r(),p(x,{key:1,icon:"fa-thumbs-down",class:"text-destructive","aria-label":"Not reportable"}))])]),e[22]||(e[22]=t("td",{class:"px-4 py-3 border-b border-border"},null,-1))],2)),[[ye]])),128))])])]))]),t("div",vt,[i(c(h,{key:"cancel",onClick:C(ce,["prevent"]),color:"destructive"},{default:b(()=>e[23]||(e[23]=[R(" Cancel ")])),_:1},512),[[k,U(E.UPDATE,w.RESULT)&&l.can_cancel]]),i(c(h,{key:"reinstate",onClick:C(fe,["prevent"]),color:"warning"},{default:b(()=>e[24]||(e[24]=[R(" Re-Instate ")])),_:1},512),[[k,U(E.UPDATE,w.RESULT)&&l.can_reinstate]]),i(c(h,{key:"submit",onClick:C(ue,["prevent"]),color:"primary"},{default:b(()=>e[25]||(e[25]=[R(" Submit ")])),_:1},512),[[k,U(E.UPDATE,w.RESULT)&&l.can_submit]]),i(c(h,{key:"retract",onClick:C(pe,["prevent"]),color:"warning"},{default:b(()=>e[26]||(e[26]=[R(" Retract ")])),_:1},512),[[k,U(E.UPDATE,w.RESULT)&&l.can_retract]]),i(c(h,{key:"verify",onClick:C(me,["prevent"]),color:"success"},{default:b(()=>e[27]||(e[27]=[R(" Verify ")])),_:1},512),[[k,U(E.UPDATE,w.RESULT)&&l.can_approve]]),i(c(h,{key:"retest",onClick:C(be,["prevent"]),color:"warning"},{default:b(()=>e[28]||(e[28]=[R(" Retest ")])),_:1},512),[[k,U(E.UPDATE,w.RESULT)&&l.can_retest]])])]),c(xe,{show:P.value,onClose:e[1]||(e[1]=s=>P.value=!1),"content-width":"w-2/4"},{header:b(()=>e[32]||(e[32]=[t("h3",{class:"text-lg font-semibold text-foreground"},"Result Information",-1)])),body:b(()=>[t("div",_t,[A.value?.analysisUid?(r(),p(D(J),{key:0,analysisUid:A.value?.analysisUid},null,8,["analysisUid"])):N("",!0),A.value?.uid?(r(),p(D(Q),{key:1,analysisResultesultUid:A.value?.uid},null,8,["analysisResultesultUid"])):N("",!0)])]),_:1},8,["show"])],64)}}}),Et=Ue(ht,[["__file","/home/aurthurm/Documents/Development/felicity/felicity-lims/webapp/views/sample/_id/results/GenericResults.vue"]]);export{Et as default};
