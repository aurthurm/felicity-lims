import{P as Ve,M as Se,a9 as Ee,Q as Ae,Z as m,h as $e,f as De,r as J,$ as Q,o as a,c as l,b as s,A as i,a as g,a2 as r,a7 as X,K as Y,L as Z,z as c,C as y,W as G,F as f,D as x,a1 as ee,J as te,x as Te,E as d,a4 as D,V as Ie,X as B,Y as q,ap as We,_ as Ne}from"./index-f86d8273.js";import{u as Oe}from"./worksheet-3642d2fa.js";import{u as Pe}from"./analysis-fe501c80.js";import{u as Ke}from"./user-ccef6161.js";import{u as Me}from"./setup-dcd94d2b.js";import{h as w,o as U,a as R}from"./constants-bd793a40.js";import"./analyses.mutations-0a79566e.js";import"./_queries-4c7a9cfd.js";const Be={class:""},qe={class:"flex justify-between items-center"},Le={action:"post",class:"p-1"},Fe={class:"flex justify-start items-center gap-x-4 mb-4"},He={class:"ml-6 mt-2"},je={class:"overflow-x-auto"},ze={class:"align-middle inline-block min-w-full shadow overflow-hidden bg-white shadow-dashboard px-2 pt-1 rounded-bl-lg rounded-br-lg"},Je={class:"min-w-full"},Qe={class:"px-1 py-1 border-b-2 border-gray-300 text-left leading-4 text-gray-800 tracking-wider"},Xe={class:"bg-white"},Ye=["onUpdate:modelValue","disabled"],Ze={class:"px-1 py-1 whitespace-no-wrap border-b border-gray-500"},Ge={class:"px-1 py-1 whitespace-no-wrap border-b border-gray-500"},et={class:"text-sm leading-5 text-gray-800 font-semibold"},tt={key:1},st={key:0},ot={class:"px-1 py-1 whitespace-no-wrap border-b border-gray-500"},nt={class:"px-1 py-1 whitespace-no-wrap border-b border-gray-500"},at={key:0,class:"text-sm leading-5 text-sky-800"},lt={key:1,class:"block col-span-2 mb-2"},rt=["onUpdate:modelValue","onChange"],it=["value"],dt={class:"px-1 py-1 whitespace-no-wrap border-b border-gray-500"},ut={key:0,class:"text-sm leading-5 text-sky-800"},pt={key:1,class:"block col-span-2 mb-2"},mt=["onUpdate:modelValue","onChange"],ct=["value"],yt={class:"px-1 py-1 whitespace-no-wrap border-b border-gray-500"},bt={key:0,class:"text-sm leading-5 text-sky-800"},vt={key:1,class:"block col-span-2 mb-2"},ht=["onUpdate:modelValue","onChange"],ft=["value"],kt={class:"px-1 py-1 whitespace-no-wrap border-b border-gray-500"},gt={key:0},xt={key:1,class:"block"},_t=["onUpdate:modelValue","onKeyup"],wt={key:2,class:"block col-span-2 mb-2"},Ut=["onUpdate:modelValue","onChange"],Rt=["value"],Ct={class:"px-1 py-1 whitespace-no-wrap border-b border-gray-500"},Vt={class:"px-1 py-1 whitespace-no-wrap border-b border-gray-500"},St={type:"button",class:"bg-sky-800 text-white py-1 px-2 rounded-sm leading-none"},Et={class:"my-4"},At=Ve({__name:"WorkSheetResults",setup($t){const se=B(()=>q(()=>import("./FelButton-e12f0980.js"),["assets/FelButton-e12f0980.js","assets/index-f86d8273.js","assets/index-ba19faea.css"])),T=B(()=>q(()=>import("./FelSelect-7a551144.js"),["assets/FelSelect-7a551144.js","assets/index-f86d8273.js","assets/index-ba19faea.css"])),oe=B(()=>q(()=>import("./FelSwitch-fe92b7d8.js"),["assets/FelSwitch-fe92b7d8.js","assets/index-f86d8273.js","assets/index-ba19faea.css"])),I=Se(),C=Me(),L=Ke(),F=Ee(),ne=Ae();let W=m(!1),N=m(!1),O=m(!1),P=m(!1),K=m(!1),M=m(!1),b=m(!1),_=m(!1),u=$e(()=>I.getWorkSheet);const H=()=>{I.fetchWorksheetByUid(F.params.workSheetUid)};L.fetchUsers({}),C.fetchLaboratoryInstruments(),C.fetchMethods();const v=De({analystUid:null,instrumentUid:null,methodUid:null}),V=m(!1),ae=()=>{V.value=!0,I.updateWorksheet({worksheetUid:F.params.workSheetUid,...v}).then(()=>{V.value=!1,H()})};function le(){return u.value?.analysisResults?.every(o=>o.checked===!0)}function S(){let o=[];return u.value?.analysisResults?.forEach(t=>{t.checked&&o.push(t)}),o}function re(){le()?b.value=!0:b.value=!1,$()}function k(o){if(j(o)){z(o);return}o.checked=!0,$()}function j(o){return["retracted","approved"].includes(o.status)}function z(o){o.checked=!1,$()}function ie(){u?.value?.analysisResults?.forEach(o=>b.value?k(o):z(o)),$()}function de(o){o.editable=!0}function E(o){return o.status!=="pending"?!1:o?.editable||We(o?.result)?(de(o),!0):!1}function ue(){let o=S(),t=[];return o?.forEach(p=>t.push({uid:p.uid,result:p.result,laboratoryInstrumentUid:p.laboratoryInstrumentUid,methodUid:p.methodUid})),t}function A(){const o=S();let t=[];return o?.forEach(p=>t.push(p.uid)),t}function pe(){const o=S();let t=[];return o?.forEach(p=>t.push(p.sample?.uid)),t}function me(o){switch(o?.status){case"retracted":return"bg-gray-300 text-sm italic text-gray-500";default:return"text-sm leading-5 text-sky-800"}}function $(){W.value=!1,K.value=!1,N.value=!1,O.value=!1,P.value=!1,M.value=!1;const o=S();o.length!==0&&(M.value=!0,o.every(t=>t.status==="pending")&&(W.value=!0,K.value=!0),o.every(t=>t.status==="resulted")&&(N.value=!0,O.value=!0,P.value=!0))}const{submitResults:ce,approveResults:ye,retractResults:be,retestResults:ve}=Pe(),{unAssignSamples:he}=Oe(),fe=()=>he(A()),ke=()=>ce(ue(),"worksheet",u.value?.uid),ge=()=>ye(A(),"worksheet",u.value?.uid),xe=()=>be(A()),_e=()=>ve(A()),we=async()=>{window.open(ne.resolve({name:"print-barcodes",query:{sampleUids:JSON.stringify(pe().join(","))}}).href,"_blank")};return(o,t)=>{const p=J("font-awesome-icon"),Ue=J("router-link"),Re=Q("motion-slide-left"),Ce=Q("motion-slide-right");return a(),l("div",Be,[t[28]||(t[28]=s("hr",{class:"mt-4"},null,-1)),i((a(),l("div",qe,[g(r(oe),{modelValue:r(_),"onUpdate:modelValue":t[0]||(t[0]=e=>X(_)?_.value=e:_=e),label:"More Sample Detail"},null,8,["modelValue"]),i(s("form",Le,[s("div",Fe,[g(r(T),{label:"Analyst",name:"analyst_uid",modelValue:v.analystUid,"onUpdate:modelValue":t[1]||(t[1]=e=>v.analystUid=e),options:r(L).users.map(e=>({value:e.uid,label:`${e.firstName} ${e.lastName}`})),disabled:r(u)?.state!=="pending"},null,8,["modelValue","options","disabled"]),g(r(T),{label:"Instrument",name:"instrument_uid",modelValue:v.instrumentUid,"onUpdate:modelValue":t[2]||(t[2]=e=>v.instrumentUid=e),options:r(C).laboratoryInstruments.map(e=>({value:e.uid,label:`${e?.instrument.name} (${e?.labName})`})),disabled:r(u)?.state!=="pending"},null,8,["modelValue","options","disabled"]),g(r(T),{label:"Method",name:"method_uid",modelValue:v.methodUid,"onUpdate:modelValue":t[3]||(t[3]=e=>v.methodUid=e),options:r(C).methods.map(e=>({value:e.uid,label:`${e.name}`})),disabled:r(u)?.state!=="pending"},null,8,["modelValue","options","disabled"]),s("div",He,[g(r(se),{onClick:t[4]||(t[4]=c(e=>ae(),["prevent"])),color:"sky-800",class:"p-1",disabled:!0},{default:Y(()=>t[14]||(t[14]=[Z("Apply")])),_:1})])])],512),[[y,!V.value]]),i(s("p",null,"updating ...",512),[[y,V.value]]),s("div",null,[s("button",{onClick:t[5]||(t[5]=c(e=>H(),["prevent"])),class:"px-1 py-1 mr-2 border-sky-800 border text-sky-800 rounded-sm transition duration-300 hover:bg-sky-800 hover:text-white focus:outline-none"}," Refresh ")])])),[[Re]]),t[29]||(t[29]=s("hr",{class:"mb-4"},null,-1)),s("div",je,[s("div",ze,[s("table",Je,[s("thead",null,[s("tr",null,[s("th",Qe,[i(s("input",{type:"checkbox",class:"",onChange:t[6]||(t[6]=e=>ie()),"onUpdate:modelValue":t[7]||(t[7]=e=>X(b)?b.value=e:b=e)},null,544),[[G,r(b)]])]),t[15]||(t[15]=s("th",{class:"px-1 py-1 border-b-2 border-gray-300 text-left leading-4 text-gray-800 tracking-wider"},null,-1)),t[16]||(t[16]=s("th",{class:"px-1 py-1 border-b-2 border-gray-300 text-left leading-4 text-gray-800 tracking-wider"}," Sample ID ",-1)),t[17]||(t[17]=s("th",{class:"px-1 py-1 border-b-2 border-gray-300 text-left text-sm leading-4 text-gray-800 tracking-wider"}," Analysis/Test ",-1)),t[18]||(t[18]=s("th",{class:"px-1 py-1 border-b-2 border-gray-300 text-left text-sm leading-4 text-gray-800 tracking-wider"}," Instrument ",-1)),t[19]||(t[19]=s("th",{class:"px-1 py-1 border-b-2 border-gray-300 text-left text-sm leading-4 text-gray-800 tracking-wider"}," Method ",-1)),t[20]||(t[20]=s("th",{class:"px-1 py-1 border-b-2 border-gray-300 text-left text-sm leading-4 text-gray-800 tracking-wider"}," Interim ",-1)),t[21]||(t[21]=s("th",{class:"px-1 py-1 border-b-2 border-gray-300 text-left text-sm leading-4 text-gray-800 tracking-wider"}," Result ",-1)),t[22]||(t[22]=s("th",{class:"px-1 py-1 border-b-2 border-gray-300 text-left text-sm leading-4 text-gray-800 tracking-wider"}," Unit ",-1)),t[23]||(t[23]=s("th",{class:"px-1 py-1 border-b-2 border-gray-300 text-left text-sm leading-4 text-gray-800 tracking-wider"}," Status ",-1))])]),s("tbody",Xe,[(a(!0),l(f,null,x(r(u)?.analysisResults,e=>i((a(),l("tr",{key:e.uid,class:ee([me(e)])},[s("td",null,[i(s("input",{type:"checkbox",class:"","onUpdate:modelValue":n=>e.checked=n,onChange:t[8]||(t[8]=n=>re()),disabled:j(e)},null,40,Ye),[[G,e.checked]])]),s("td",Ze,[(e?.sample?.priority??0)>0?(a(),l("span",{key:0,class:ee(["font-small",{"text-orange-600":(r(u)?.priority??0)>1}])},[g(p,{icon:"fa-star"})],2)):te("",!0)]),s("td",Ge,[s("div",et,[e?.sample?.analysisRequest?.patient?.uid?(a(),Te(Ue,{key:0,to:{name:"sample-detail",params:{patientUid:e?.sample?.analysisRequest?.patient?.uid,sampleUid:e?.sample?.uid}}},{default:Y(()=>[Z(d(e?.sample?.sampleId),1)]),_:2},1032,["to"])):(a(),l("div",tt,d(e?.sample?.sampleId),1))]),r(_)?(a(),l("span",st,[s("span",null,d(e?.sample?.qcLevel?.level),1),s("div",null,d(e?.sample?.analysisRequest?.patient?.firstName)+" "+d(e?.sample?.analysisRequest?.patient?.lastName),1),s("div",null,d(e?.sample?.analysisRequest?.client?.name),1)])):te("",!0)]),s("td",ot,[s("div",null,d(e?.analysis?.name),1)]),s("td",nt,[E(e)?(a(),l("label",lt,[i(s("select",{class:"form-input mt-1 block w-full","onUpdate:modelValue":n=>e.laboratoryInstrumentUid=n,onChange:n=>k(e)},[t[24]||(t[24]=s("option",{value:""},null,-1)),(a(!0),l(f,null,x(e.analysis?.instruments,n=>(a(),l(f,{key:n.uid},[(a(!0),l(f,null,x(n.laboratoryInstruments,h=>(a(),l("option",{key:h.uid,value:h.uid},d(h.labName)+" â†’ ("+d(n?.name)+") ",9,it))),128))],64))),128))],40,rt),[[D,e.laboratoryInstrumentUid]])])):(a(),l("div",at,d(e.laboratoryInstrument?.labName||"---"),1))]),s("td",dt,[E(e)?(a(),l("label",pt,[i(s("select",{class:"form-input mt-1 block w-full","onUpdate:modelValue":n=>e.methodUid=n,onChange:n=>k(e)},[t[25]||(t[25]=s("option",{value:""},null,-1)),(a(!0),l(f,null,x(e.analysis?.methods,n=>(a(),l("option",{key:n.uid,value:n.uid},d(n.name),9,ct))),128))],40,mt),[[D,e.methodUid]])])):(a(),l("div",ut,d(e.method?.name||"---"),1))]),s("td",yt,[!E(e)||(e?.analysis?.interims?.length??0)===0?(a(),l("div",bt," --- ")):(a(),l("label",vt,[i(s("select",{class:"form-input mt-1 block w-full","onUpdate:modelValue":n=>e.result=n,onChange:n=>k(e)},[t[26]||(t[26]=s("option",{value:""},null,-1)),(a(!0),l(f,null,x(e?.analysis?.interims,(n,h)=>(a(),l("option",{key:n.key||h,value:n.value},d(n.value),9,ft))),128))],40,ht),[[D,e.result]])]))]),s("td",kt,[E(e)?e?.analysis?.resultOptions?.length===0?(a(),l("label",xt,[i(s("input",{class:"form-input mt-1 block w-full","onUpdate:modelValue":n=>e.result=n,onKeyup:n=>k(e)},null,40,_t),[[Ie,e.result]])])):(a(),l("label",wt,[i(s("select",{class:"form-input mt-1 block w-full","onUpdate:modelValue":n=>e.result=n,onChange:n=>k(e)},[t[27]||(t[27]=s("option",{value:""},null,-1)),(a(!0),l(f,null,x(e?.analysis?.resultOptions,(n,h)=>(a(),l("option",{key:n.optionKey||h,value:n.value},d(n.value),9,Rt))),128))],40,Ut),[[D,e.result]])])):(a(),l("div",gt,d(e?.result),1))]),s("td",Ct,[s("div",null,d(e?.analysis?.unit?.name||"---"),1)]),s("td",Vt,[s("button",St,d(e?.status||"unknown"),1)])],2)),[[Ce]])),128))])])])]),s("section",Et,[i(s("button",{onClick:t[9]||(t[9]=c(e=>fe(),["prevent"])),class:"px-2 py-1 mr-2 border-sky-800 border text-sky-800 rounded-sm transition duration-300 hover:bg-sky-800 hover:text-white focus:outline-none"}," Un Assign ",512),[[y,w(R.CREATE,U.WORKSHEET)&&r(K)]]),i(s("button",{onClick:t[10]||(t[10]=c(e=>ke(),["prevent"])),class:"px-2 py-1 mr-2 border-sky-800 border text-sky-800 rounded-sm transition duration-300 hover:bg-sky-800 hover:text-white focus:outline-none"}," Submit ",512),[[y,w(R.UPDATE,U.WORKSHEET)&&r(W)]]),i(s("button",{onClick:t[11]||(t[11]=c(e=>xe(),["prevent"])),class:"px-2 py-1 mr-2 border-sky-800 border text-sky-800 rounded-sm transition duration-300 hover:bg-sky-800 hover:text-white focus:outline-none"}," Retract ",512),[[y,w(R.UPDATE,U.WORKSHEET)&&r(N)]]),i(s("button",{onClick:t[12]||(t[12]=c(e=>ge(),["prevent"])),class:"px-2 py-1 mr-2 border-sky-800 border text-sky-800 rounded-sm transition duration-300 hover:bg-sky-800 hover:text-white focus:outline-none"}," Approve ",512),[[y,w(R.UPDATE,U.WORKSHEET)&&r(O)]]),i(s("button",{onClick:t[13]||(t[13]=c(e=>_e(),["prevent"])),class:"px-2 py-1 mr-2 border-sky-800 border text-sky-800 rounded-sm transition duration-300 hover:bg-sky-800 hover:text-white focus:outline-none"}," Retest ",512),[[y,w(R.UPDATE,U.WORKSHEET)&&r(P)]]),i(s("button",{onClick:c(we,["prevent"]),class:"px-2 py-1 mr-2 border-sky-800 border text-sky-800 rounded-sm transition duration-300 hover:bg-sky-800 hover:text-white focus:outline-none"}," Print Barcodes ",512),[[y,r(M)]])])])}}}),Mt=Ne(At,[["__file","/home/aurthurm/Documents/Development/felicity/felicity-lims/webapp/views/worksheet/_id/WorkSheetResults.vue"]]);export{Mt as default};
