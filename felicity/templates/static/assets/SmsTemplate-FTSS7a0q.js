import{g as I,Y as ee,u as te,aw as ae,a0 as y,bU as A,bV as u,an as le,ah as re,bb as ne,aN as ie,a9 as oe,aa as de,ab as se,ad as me,ae as ue,af as ce,aZ as ge,a3 as fe,_ as pe,c as f,o as g,a as t,z as d,A as q,C as O,K as a,M as s,F as _,H as w,I as c,N as be,B as Te,a4 as U,aK as z,aL as K}from"./index-OdhKCqIc.js";import{c as ve,a as b,f as ye,u as _e,F as Se}from"./index.esm-BfHj8iGm.js";import{I as xe}from"./Input-BEm5S0CJ.js";import{T as Fe}from"./Textarea-T3VcJTEo.js";import{F as Ae,a as we,b as he}from"./FormMessage-CgXFMXx9.js";import{F as Ce}from"./FormLabel-DxP9wnWS.js";import{S as Ie,a as Me,b as ke,c as Be,d as Ue}from"./SelectValue-Ds0cfAgl.js";import{P as Ve}from"./PageHeading-Czi_4opS.js";import"./Label-CS46LzLb.js";import"./useNonce-B4v0IDPb.js";import"./chevron-down-Dqf-ptA3.js";import"./useFocusGuards-Bjb6OG0k.js";import"./PopperContent-BfyCnGUj.js";const Ee=I`
    mutation AddSmsTemplate($payload: SmsTemplateInputType!) {
  createSmsTemplate(payload: $payload) {
    ... on SmsTemplateType {
      __typename
      uid
      name
      description
      specificationTrigger
      audience
      template
      createdAt
      updatedAt
      isActive
    }
    ... on OperationError {
      __typename
      error
      suggestion
    }
  }
}
    `,Le=I`
    mutation EditSmsTemplate($uid: String!, $payload: SmsTemplateInputType!) {
  updateSmsTemplate(uid: $uid, payload: $payload) {
    ... on SmsTemplateType {
      __typename
      uid
      name
      description
      specificationTrigger
      audience
      template
      createdAt
      updatedAt
      isActive
    }
    ... on OperationError {
      __typename
      error
      suggestion
    }
  }
}
    `,Ne=I`
    mutation DeleteSmsTemplate($uid: String!) {
  deleteSmsTemplate(uid: $uid) {
    ... on DeletedItem {
      __typename
      uid
    }
    ... on OperationError {
      __typename
      error
      suggestion
    }
  }
}
    `,De=I`
    query getSmsTemplatesByTarget($targetType: String!, $targetUid: String!) {
  smsTemplatesByTarget(targetType: $targetType, targetUid: $targetUid) {
    uid
    name
    description
    specificationTrigger
    audience
    template
    createdAt
    updatedAt
    isActive
  }
}
    `,He=ee({__name:"SmsTemplate",props:{targetType:{type:String,required:!0,default:null},targetUid:{type:String,required:!0,default:null}},setup(V,{expose:l}){l();const{withClientMutation:S,withClientQuery:e}=te(),{confirm:M}=ie(),h=V,{targetType:r,targetUid:o}=ae(h);let x=y(!1),k=y("");const C=y(!0),T=y(null),G=y(!1),E=ve({name:b().trim().required("Template name is required"),description:b().trim().nullable(),template:b().trim().required("Template body is required"),specificationTrigger:b().trim().required("Trigger is required"),audience:b().trim().required("Audience is required"),isActive:ye().default(!0),targetType:b().trim().required(),targetUid:b().trim().required()}),{handleSubmit:L,resetForm:N,setValues:F}=_e({validationSchema:E,initialValues:{name:"",description:"",template:"",specificationTrigger:u.AnyAbnormal,audience:A.Patient,isActive:!0,targetType:r.value,targetUid:o.value}}),D=[{value:u.Normal,label:"Normal Results"},{value:u.BelowNormal,label:"Below Normal (Not Warning)"},{value:u.AboveNormal,label:"Above Normal (Not Warning)"},{value:u.BelowWarning,label:"Below Warning Threshold"},{value:u.AboveWarning,label:"Above Warning Threshold"},{value:u.AnyAbnormal,label:"Any Abnormal Results"},{value:u.AnyWarning,label:"Any Warning Results"},{value:u.AnyResult,label:"Any Result"},{value:u.TextualNormal,label:"Textual Normal Results"},{value:u.TextualWarning,label:"Textual Warning Results"}],H=[{value:A.Patient,label:"Patient"},{value:A.Client,label:"Client"}],Q=[{category:"Lab Information",variables:["{lab_name}","{lab_email}","{lab_phone}"]},{category:"Sample Information",variables:["{sample_id}","{client_sample_id}","{date_collected}"]},{category:"Patient Information",variables:["{patient_name}","{patient_id}","{gender}","{client_patient_id}","{age}"]},{category:"Analysis Information",variables:["{analysis_keyword}","{analysis_name}"]},{category:"Result Information",variables:["{result}","{unit}"]},{category:"Client Information",variables:["{client_id}","{client_name}"]},{category:"Other",variables:["Patient identification names (dynamic)"]}],p=y([]);le(()=>h.targetUid,()=>{F({targetType:r.value,targetUid:o.value}),B()}),re(()=>{B()});function B(){e(De,{targetType:r.value,targetUid:o.value},"smsTemplatesByTarget").then(n=>p.value=n||[])}function W(n){S(Ee,{payload:n},"createSmsTemplate").then(i=>p.value.push(i))}function P(n){T.value&&S(Le,{uid:T.value,payload:n},"updateSmsTemplate").then(i=>{const m=p.value.findIndex(v=>v.uid===T.value);m!==-1&&(p.value[m]=i)})}function Y(n){M({title:"Delete SMS Template?",description:"Are you sure you want to delete this SMS template?",confirmText:"Delete",cancelText:"Cancel",variant:"destructive"}).then(i=>{i&&S(Ne,{uid:n},"deleteSmsTemplate").then(()=>{const m=p.value.findIndex(v=>v.uid===n);m!==-1&&p.value.splice(m,1)})})}function Z(n,i={}){C.value=n,x.value=!0,k.value=(n?"CREATE":"EDIT")+" SMS TEMPLATE",n?(T.value=null,N({values:{name:"",template:"",description:"",targetType:r.value,targetUid:o.value,specificationTrigger:u.AnyAbnormal,audience:A.Patient,isActive:!0}})):(T.value=i.uid??null,F({name:i.name??"",template:i.template??"",description:i.description??"",targetType:r.value,targetUid:o.value,specificationTrigger:i.specificationTrigger??u.AnyAbnormal,audience:i.audience??A.Patient,isActive:i.isActive??!0}))}const J=L(n=>{const i={name:n.name,template:n.template,description:n.description??null,targetType:n.targetType,targetUid:n.targetUid,specificationTrigger:n.specificationTrigger,audience:n.audience,isActive:n.isActive};C.value===!0&&W(i),C.value===!1&&P(i),x.value=!1});function X(n){const i=document.getElementById("template-input"),m=i?.value??"";if(i){const v=i.selectionStart,j=i.selectionEnd,$=m.substring(0,v)+n+m.substring(j);F({template:$}),setTimeout(()=>{i.focus(),i.selectionStart=i.selectionEnd=v+n.length},0)}else F({template:m+n})}const R={withClientMutation:S,withClientQuery:e,confirm:M,props:h,targetType:r,targetUid:o,get showModal(){return x},set showModal(n){x=n},get formTitle(){return k},set formTitle(n){k=n},formAction:C,currentUid:T,showWildcards:G,templateSchema:E,handleSubmit:L,resetForm:N,setValues:F,triggerOptions:D,audienceOptions:H,supportedVariables:Q,templates:p,getSmsTemplates:B,addSmsTemplate:W,editSmsTemplate:P,deleteSmsTemplate:Y,FormManager:Z,saveForm:J,insertVariable:X,triggerLabel:n=>D.find(m=>m.value===n)?.label||n,audienceLabel:n=>H.find(m=>m.value===n)?.label||n,get Button(){return fe},get Input(){return xe},get Textarea(){return Fe},get FormControl(){return he},get FormField(){return Se},get FormItem(){return we},get FormLabel(){return Ce},get FormMessage(){return Ae},get Select(){return Ue},get SelectContent(){return Be},get SelectItem(){return ke},get SelectTrigger(){return Me},get SelectValue(){return Ie},get Switch(){return ge},get Table(){return ce},get TableBody(){return ue},get TableCell(){return me},get TableHead(){return se},get TableHeader(){return de},get TableRow(){return oe},Modal:ne,PageHeading:Ve};return Object.defineProperty(R,"__isScriptSetup",{enumerable:!1,value:!0}),R}}),We={class:"mt-4"},Pe={class:"border border-border bg-card rounded-lg shadow-md"},Re={class:"relative w-full overflow-auto"},qe={class:"text-sm text-foreground"},Oe={class:"text-xs text-muted-foreground"},ze={class:"text-sm text-foreground"},Ke={class:"text-sm text-foreground"},Ge={class:"text-sm text-foreground max-w-xs"},Qe={class:"text-lg font-bold text-foreground"},Ye={class:"space-y-4"},Ze={class:"grid grid-cols-2 gap-4"},Je={class:"grid grid-cols-3 gap-4"},Xe={class:"flex justify-between items-center"},je={key:0,class:"border border-border rounded-lg p-4 bg-accent/5"},$e={class:"grid grid-cols-2 gap-4"},et={class:"text-xs font-medium text-muted-foreground uppercase"},tt={class:"flex flex-wrap gap-1"},at=["onClick"],lt={class:"pt-4 flex gap-2"};function rt(V,l,S,e,M,h){return g(),f(_,null,[t(e.PageHeading,{title:"SMS Templates"},{default:a(()=>[t(e.Button,{onClick:l[0]||(l[0]=r=>e.FormManager(!0))},{default:a(()=>[...l[5]||(l[5]=[s("Add SMS Template",-1)])]),_:1})]),_:1}),d("div",We,[d("div",Pe,[d("div",Re,[t(e.Table,{class:"w-full caption-bottom text-sm"},{default:a(()=>[t(e.TableHeader,{class:"[&_tr]:border-b"},{default:a(()=>[t(e.TableRow,{class:"border-b transition-colors hover:bg-muted/50 data-[state=selected]:bg-muted"},{default:a(()=>[t(e.TableHead,{class:"h-12 px-4 text-left align-middle font-medium text-muted-foreground"},{default:a(()=>[...l[6]||(l[6]=[s("Name",-1)])]),_:1}),t(e.TableHead,{class:"h-12 px-4 text-left align-middle font-medium text-muted-foreground"},{default:a(()=>[...l[7]||(l[7]=[s("Specification Trigger",-1)])]),_:1}),t(e.TableHead,{class:"h-12 px-4 text-left align-middle font-medium text-muted-foreground"},{default:a(()=>[...l[8]||(l[8]=[s("Audience",-1)])]),_:1}),t(e.TableHead,{class:"h-12 px-4 text-left align-middle font-medium text-muted-foreground"},{default:a(()=>[...l[9]||(l[9]=[s("Template",-1)])]),_:1}),t(e.TableHead,{class:"h-12 px-4 text-left align-middle font-medium text-muted-foreground"},{default:a(()=>[...l[10]||(l[10]=[s("Status",-1)])]),_:1}),t(e.TableHead,{class:"h-12 px-4 text-right align-middle font-medium text-muted-foreground"},{default:a(()=>[...l[11]||(l[11]=[s("Actions",-1)])]),_:1})]),_:1})]),_:1}),t(e.TableBody,{class:"[&_tr:last-child]:border-0"},{default:a(()=>[(g(!0),f(_,null,w(e.templates,r=>(g(),q(e.TableRow,{key:r?.uid,class:"border-b transition-colors hover:bg-muted/50 data-[state=selected]:bg-muted"},{default:a(()=>[t(e.TableCell,{class:"px-4 py-3 align-middle whitespace-nowrap text-sm"},{default:a(()=>[d("div",qe,c(r.name),1),d("div",Oe,c(r.description),1)]),_:2},1024),t(e.TableCell,{class:"px-4 py-3 align-middle whitespace-nowrap text-sm"},{default:a(()=>[d("div",ze,c(e.triggerLabel(r.specificationTrigger||"")),1)]),_:2},1024),t(e.TableCell,{class:"px-4 py-3 align-middle whitespace-nowrap text-sm"},{default:a(()=>[d("div",Ke,c(e.audienceLabel(r.audience||"")),1)]),_:2},1024),t(e.TableCell,{class:"px-4 py-3 align-middle text-sm"},{default:a(()=>[d("div",Ge,c(r.template),1)]),_:2},1024),t(e.TableCell,{class:"px-4 py-3 align-middle whitespace-nowrap text-sm"},{default:a(()=>[d("span",{class:be([r.isActive?"bg-green-100 text-green-800":"bg-red-100 text-red-800","px-2 py-1 text-xs font-medium rounded-full"])},c(r.isActive?"Active":"Inactive"),3)]),_:2},1024),t(e.TableCell,{class:"px-4 py-3 align-middle text-right"},{default:a(()=>[t(e.Button,{variant:"outline",size:"sm",onClick:o=>e.FormManager(!1,r)},{default:a(()=>[...l[12]||(l[12]=[s("Edit",-1)])]),_:1},8,["onClick"]),t(e.Button,{variant:"destructive",size:"sm",class:"ml-2",onClick:o=>e.deleteSmsTemplate(r.uid)},{default:a(()=>[...l[13]||(l[13]=[s(" Delete ",-1)])]),_:1},8,["onClick"])]),_:2},1024)]),_:2},1024))),128))]),_:1})]),_:1})])])]),e.showModal?(g(),q(e.Modal,{key:0,onClose:l[4]||(l[4]=r=>e.showModal=!1),contentWidth:"w-3/4"},{header:a(()=>[d("h3",Qe,c(e.formTitle),1)]),body:a(()=>[d("form",{onSubmit:l[3]||(l[3]=Te((...r)=>e.saveForm&&e.saveForm(...r),["prevent"])),class:"p-6 space-y-6"},[d("div",Ye,[d("div",Ze,[t(e.FormField,{name:"name"},{default:a(({componentField:r})=>[t(e.FormItem,null,{default:a(()=>[t(e.FormLabel,null,{default:a(()=>[...l[14]||(l[14]=[s("Template Name",-1)])]),_:1}),t(e.FormControl,null,{default:a(()=>[t(e.Input,U(r,{placeholder:"Enter template name..."}),null,16)]),_:2},1024),t(e.FormMessage)]),_:2},1024)]),_:1}),t(e.FormField,{name:"description"},{default:a(({componentField:r})=>[t(e.FormItem,null,{default:a(()=>[t(e.FormLabel,null,{default:a(()=>[...l[15]||(l[15]=[s("Description",-1)])]),_:1}),t(e.FormControl,null,{default:a(()=>[t(e.Input,U(r,{placeholder:"Enter description..."}),null,16)]),_:2},1024),t(e.FormMessage)]),_:2},1024)]),_:1})]),d("div",Je,[t(e.FormField,{name:"specificationTrigger"},{default:a(({componentField:r})=>[t(e.FormItem,null,{default:a(()=>[t(e.FormLabel,null,{default:a(()=>[...l[16]||(l[16]=[s("Trigger Condition",-1)])]),_:1}),t(e.FormControl,null,{default:a(()=>[t(e.Select,z(K(r)),{default:a(()=>[t(e.SelectTrigger,null,{default:a(()=>[t(e.SelectValue,{placeholder:"Select trigger"})]),_:1}),t(e.SelectContent,null,{default:a(()=>[(g(),f(_,null,w(e.triggerOptions,o=>t(e.SelectItem,{key:o.value,value:o.value},{default:a(()=>[s(c(o.label),1)]),_:2},1032,["value"])),64))]),_:1})]),_:1},16)]),_:2},1024),t(e.FormMessage)]),_:2},1024)]),_:1}),t(e.FormField,{name:"audience"},{default:a(({componentField:r})=>[t(e.FormItem,null,{default:a(()=>[t(e.FormLabel,null,{default:a(()=>[...l[17]||(l[17]=[s("Audience",-1)])]),_:1}),t(e.FormControl,null,{default:a(()=>[t(e.Select,z(K(r)),{default:a(()=>[t(e.SelectTrigger,null,{default:a(()=>[t(e.SelectValue,{placeholder:"Select audience"})]),_:1}),t(e.SelectContent,null,{default:a(()=>[(g(),f(_,null,w(e.audienceOptions,o=>t(e.SelectItem,{key:o.value,value:o.value},{default:a(()=>[s(c(o.label),1)]),_:2},1032,["value"])),64))]),_:1})]),_:1},16)]),_:2},1024),t(e.FormMessage)]),_:2},1024)]),_:1}),t(e.FormField,{name:"isActive"},{default:a(({value:r,handleChange:o})=>[t(e.FormItem,{class:"flex items-center gap-2"},{default:a(()=>[t(e.FormControl,null,{default:a(()=>[t(e.Switch,{checked:r,"onUpdate:checked":o},null,8,["checked","onUpdate:checked"])]),_:2},1024),t(e.FormLabel,null,{default:a(()=>[...l[18]||(l[18]=[s("Status",-1)])]),_:1}),t(e.FormMessage)]),_:2},1024)]),_:1})]),t(e.FormField,{name:"template"},{default:a(({componentField:r})=>[t(e.FormItem,null,{default:a(()=>[d("div",Xe,[t(e.FormLabel,null,{default:a(()=>[...l[19]||(l[19]=[s("SMS Template",-1)])]),_:1}),t(e.Button,{type:"button",variant:"link",size:"sm",onClick:l[1]||(l[1]=o=>e.showWildcards=!e.showWildcards)},{default:a(()=>[s(c(e.showWildcards?"Hide":"Show")+" Available Variables ",1)]),_:1})]),t(e.FormControl,null,{default:a(()=>[t(e.Textarea,U({id:"template-input"},r,{class:"min-h-[100px]",placeholder:"Enter SMS template with variables e.g., Hello {patient_name}, your {analysis_name} result is {result}..."}),null,16)]),_:2},1024),t(e.FormMessage)]),_:2},1024)]),_:1}),e.showWildcards?(g(),f("div",je,[l[20]||(l[20]=d("h4",{class:"text-sm font-medium text-foreground mb-3"},"Available Variables:",-1)),d("div",$e,[(g(),f(_,null,w(e.supportedVariables,r=>d("div",{key:r.category,class:"space-y-1"},[d("h5",et,c(r.category),1),d("div",tt,[(g(!0),f(_,null,w(r.variables,o=>(g(),f("button",{key:o,type:"button",onClick:x=>e.insertVariable(o),class:"text-xs px-2 py-1 bg-primary/10 text-primary hover:bg-primary/20 rounded border border-primary/20 transition-colors duration-200"},c(o),9,at))),128))])])),64))])])):O("",!0)]),d("div",lt,[t(e.Button,{type:"submit",class:"flex-1"},{default:a(()=>[...l[21]||(l[21]=[s("Save Template",-1)])]),_:1}),t(e.Button,{type:"button",variant:"outline",onClick:l[2]||(l[2]=r=>e.showModal=!1)},{default:a(()=>[...l[22]||(l[22]=[s("Cancel",-1)])]),_:1})])],32)]),_:1})):O("",!0)],64)}const _t=pe(He,[["render",rt],["__scopeId","data-v-ea0c084b"],["__file","/home/administrator/Documents/Development/beak-insights/felicity/felicity-lims/webapp/views/admin/analyses/services/SmsTemplate.vue"]]);export{_t as default};
