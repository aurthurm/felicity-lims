import{S as K,f as O,a0 as i,a7 as H,i as q,r as w,o as a,c as l,K as n,N as o,H as p,F as Q,E as J,y as X,aD as Y,a as D,a3 as Z,M as ee,_ as te}from"./index-0c222abb.js";import{i as oe,D as re,j as ne,k as se}from"./grind.queries-bf760337.js";import{M}from"./schema-378e3777.js";const ae={class:"bg-background rounded-lg shadow-sm border border-border p-6 space-y-6"},le={class:"flex justify-between items-start"},ie={class:"w-3/4 pr-4 space-y-4"},de={key:0,class:"py-6 text-center text-muted-foreground bg-background rounded-lg border border-dashed border-border"},ue={key:1,class:"p-3 bg-destructive/10 text-destructive rounded-md"},ce={key:2,class:"space-y-2"},fe={class:"flex items-center space-x-3"},pe={class:"text-muted-foreground"},me={class:"text-sm font-medium text-foreground"},ve={class:"text-xs text-muted-foreground"},ge={class:"flex items-center space-x-2"},he=["onClick"],_e=["onClick","disabled"],xe={class:"w-1/4 pl-4"},ye={key:0,class:"space-y-2"},be={class:"text-sm text-muted-foreground"},we={key:1,class:"space-y-3"},De=["src"],ke={class:"text-sm"},Fe={class:"font-medium text-foreground"},Ue={class:"text-muted-foreground"},Ce={class:"flex justify-center space-x-2"},Ee=["disabled"],Me={key:1,class:"text-sm text-destructive"},Be=K({__name:"ErrandFile",props:{errandUid:{type:String,required:!0}},setup(B){const k=B,{withClientMutation:F,withClientQuery:U}=O(),y=i(null),g=i(null);H(()=>{$()});const m=i(!1),d=i(null),v=i(null),h=i(!1),c=i(null),C=i(!1),u=i([]),$=()=>{U(oe,{target:M.Errand,targetUid:k.errandUid},"grindMediaByTarget").then(e=>{e&&(u.value=e)})},T=e=>{F(se,{payload:e},"createGrindMedia").then(t=>{t&&(u.value=[t,...u.value])})},G=e=>{y.value=e,g.value=null,F(re,{uid:e},"deleteGrindMedia").then(t=>{t&&(u.value=u.value.filter(r=>r.uid!==e))}).catch(t=>{g.value=t?.message||"Failed to delete file"}).finally(()=>{y.value=null})},L=e=>{const t=parseInt(e);return t<1024?`${t} B`:t<1024*1024?`${(t/1024).toFixed(1)} KB`:`${(t/(1024*1024)).toFixed(1)} MB`},z=e=>{const{mimetype:t,filename:r}=e;return t?.startsWith("image/")?"image":t?.includes("pdf")||r.endsWith(".pdf")?"pdf":t?.includes("word")||r.endsWith(".doc")||r.endsWith(".docx")?"doc":t?.includes("sheet")||r.endsWith(".xls")||r.endsWith(".xlsx")?"excel":"file"},I=e=>{try{U(ne,{uid:e.uid},"downloadGrindMediaFile").then(t=>{const r=atob(t.content),_=new Uint8Array(r.length);for(let x=0;x<r.length;x++)_[x]=r.charCodeAt(x);const b=new Blob([_],{type:t.mimetype}),s=URL.createObjectURL(b),f=document.createElement("a");f.href=s,f.download=t.filename,document.body.appendChild(f),f.click(),setTimeout(()=>{document.body.removeChild(f),URL.revokeObjectURL(s)},0)})}catch(t){console.error("Error downloading file:",t)}},E=e=>{if(c.value=null,d.value=e,e.type.startsWith("image/")){const t=new FileReader;t.onload=r=>{v.value=r.target?.result},t.readAsDataURL(e)}else v.value=null},S=async()=>{if(d.value){h.value=!0,c.value=null;try{const e=await T({file:d.value,target:M.Errand,targetUid:k.errandUid});e?.error?c.value=e.error.message:C.value=!0}catch(e){c.value=e instanceof Error?e.message:"Upload failed"}finally{h.value=!1}}},W=e=>{const t=e.target;t.files&&t.files.length>0&&E(t.files[0])},j=e=>{e.preventDefault(),e.stopPropagation(),m.value=!0},N=e=>{e.preventDefault(),e.stopPropagation(),m.value=!1},R=e=>{e.preventDefault(),e.stopPropagation(),m.value=!0},A=e=>{e.preventDefault(),e.stopPropagation(),m.value=!1,e.dataTransfer&&e.dataTransfer.files.length>0&&E(e.dataTransfer.files[0])},P=()=>{d.value=null,v.value=null,C.value=!1,c.value=null},V=q(()=>{if(!d.value)return"";const e=d.value.size;return e<1024?`${e} B`:e<1024*1024?`${(e/1024).toFixed(1)} KB`:`${(e/(1024*1024)).toFixed(1)} MB`});return(e,t)=>{const r=w("DownloadIcon"),_=w("TrashIcon"),b=w("UploadIcon");return a(),l("div",ae,[n(" Header "),o("div",le,[o("div",ie,[t[1]||(t[1]=o("h3",{class:"text-lg font-medium text-foreground"},"Uploaded Files",-1)),n(" Loading or empty state "),u.value.length===0?(a(),l("div",de," No files uploaded yet ")):n("v-if",!0),n(" Error message "),g.value?(a(),l("div",ue,p(g.value),1)):n("v-if",!0),n(" File list "),u.value.length>0?(a(),l("ul",ce,[(a(!0),l(Q,null,J(u.value,s=>(a(),l("li",{key:s.uid,class:"flex items-center justify-between p-3 bg-muted rounded-md hover:bg-muted/80 transition-colors duration-200"},[o("div",fe,[o("span",pe,[(a(),X(Y(z(s)),{class:"w-5 h-5"}))]),o("div",null,[o("p",me,p(s.filename),1),o("p",ve,p(L(s.size)),1)])]),o("div",ge,[o("button",{onClick:f=>I(s),class:"p-1 text-muted-foreground hover:text-foreground transition-colors duration-200",title:"Download file"},[D(r,{class:"w-5 h-5"})],8,he),o("button",{onClick:f=>G(s.uid),class:"p-1 text-muted-foreground hover:text-destructive transition-colors duration-200",disabled:y.value===s.uid,title:"Delete file"},[D(_,{class:"w-5 h-5"})],8,_e)])]))),128))])):n("v-if",!0)]),n(" Upload section "),o("div",xe,[o("div",{class:Z(["border-2 border-dashed border-border rounded-lg p-6 text-center",{"border-primary bg-primary/5":m.value}]),onDragenter:j,onDragleave:N,onDragover:R,onDrop:A},[o("input",{type:"file",class:"hidden",ref:"fileInput",onChange:W},null,544),d.value?(a(),l("div",we,[n(" Image preview "),v.value?(a(),l("img",{key:0,src:v.value,class:"max-h-32 mx-auto rounded-md",alt:"File preview"},null,8,De)):n("v-if",!0),n(" File info "),o("div",ke,[o("p",Fe,p(d.value.name),1),o("p",Ue,p(V.value),1)]),n(" Upload actions "),o("div",Ce,[o("button",{onClick:P,class:"px-3 py-1 text-sm font-medium text-foreground bg-background border border-border rounded-md shadow-sm hover:bg-muted focus:outline-none focus:ring-2 focus:ring-primary focus:ring-offset-2 transition-colors duration-200"}," Cancel "),o("button",{onClick:S,disabled:h.value,class:"px-3 py-1 text-sm font-medium text-primary-foreground bg-primary border border-transparent rounded-md shadow-sm hover:bg-primary/90 focus:outline-none focus:ring-2 focus:ring-primary focus:ring-offset-2 transition-colors duration-200"},p(h.value?"Uploading...":"Upload"),9,Ee)]),n(" Upload error "),c.value?(a(),l("p",Me,p(c.value),1)):n("v-if",!0)])):(a(),l("div",ye,[D(b,{class:"w-8 h-8 mx-auto text-muted-foreground"}),o("p",be,[t[2]||(t[2]=ee(" Drag and drop a file here, or ")),o("button",{onClick:t[0]||(t[0]=s=>e.$refs.fileInput.click()),class:"text-primary hover:text-primary/80 transition-colors duration-200"}," browse ")])]))],34)])])])}}});const Le=te(Be,[["__scopeId","data-v-334d1478"],["__file","/home/aurthurm/Documents/Development/felicity/felicity-lims/webapp/views/grind/_id/ErrandFile.vue"]]);export{Le as default};
