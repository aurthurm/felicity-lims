import{S as Y,c1 as xe,O as we,d as Ue,ar as Re,L as Ce,aL as Se,P as Ee,u as Ae,r as u,D as Te,C as Ve,z as De,n as G,o as n,c as a,e as i,b as t,H as I,i as J,au as K,f as d,F as f,p as g,t as r,at as x,g as We,G as Q,w as p,E as m,x as D,y as X,q as Ne,v as Be,j as Oe,_ as Pe,aS as $e,k as Ie}from"./index-a40c2365.js";import{u as Ke}from"./analysis-0b59fb20.js";import{h as w,o as U,a as R}from"./constants-d621fd80.js";function Me(){const{withClientMutation:M}=we();return{unAssignSamples:async v=>{try{Y.fire({title:"Are you sure?",text:"You want to Un-Assign these analyses",icon:"warning",showCancelButton:!0,confirmButtonColor:"#3085d6",cancelButtonColor:"#d33",confirmButtonText:"Yes, Un-Assign now!",cancelButtonText:"No, cancel UnAssign!"}).then(async h=>{h.isConfirmed&&(await M(xe,v,"updateWorksheet").then(C=>{}),Y.fire("Its Happening!","Selected analyses have been UnAssigned.","success").then(C=>location.reload()))})}catch{}}}}const je={class:""},qe=t("hr",{class:"mt-4"},null,-1),He={class:"flex justify-between items-center"},Le={for:"toggle",class:"text-medium text-gray-700 my-4"},Fe={class:"relative inline-block w-10 mr-2 align-middle select-none transition duration-200 ease-in"},ze=t("label",{for:"toggle",class:"toggle-label block overflow-hidden h-6 rounded-full bg-gray-300 cursor-pointer"},null,-1),Ye={action:"post",class:"p-1"},Ge={class:"flex justify-start items-center mb-4"},Je={class:"flex justify-between items-center"},Qe=t("span",{class:"text-gray-700 mr-2"},"Analyst",-1),Xe=["value"],Ze={class:"flex justify-between items-center ml-4"},et=t("span",{class:"text-gray-700 mr-2"},"Instrument",-1),tt=["value"],st={class:"flex justify-between items-center ml-4"},ot=t("span",{class:"text-gray-700 mr-2"},"Method",-1),nt=["value"],at={class:"ml-6 mt-2"},rt=t("hr",{class:"mb-4"},null,-1),lt={class:"overflow-x-auto"},it={class:"align-middle inline-block min-w-full shadow overflow-hidden bg-white shadow-dashboard px-2 pt-1 rounded-bl-lg rounded-br-lg"},dt={class:"min-w-full"},ut={class:"px-1 py-1 border-b-2 border-gray-300 text-left leading-4 text-gray-800 tracking-wider"},ct=t("th",{class:"px-1 py-1 border-b-2 border-gray-300 text-left leading-4 text-gray-800 tracking-wider"},null,-1),pt=t("th",{class:"px-1 py-1 border-b-2 border-gray-300 text-left leading-4 text-gray-800 tracking-wider"}," Sample ID ",-1),mt=t("th",{class:"px-1 py-1 border-b-2 border-gray-300 text-left text-sm leading-4 text-gray-800 tracking-wider"}," Analysis/Test ",-1),ht=t("th",{class:"px-1 py-1 border-b-2 border-gray-300 text-left text-sm leading-4 text-gray-800 tracking-wider"}," Instrument ",-1),yt=t("th",{class:"px-1 py-1 border-b-2 border-gray-300 text-left text-sm leading-4 text-gray-800 tracking-wider"}," Method ",-1),bt=t("th",{class:"px-1 py-1 border-b-2 border-gray-300 text-left text-sm leading-4 text-gray-800 tracking-wider"}," Interim ",-1),_t=t("th",{class:"px-1 py-1 border-b-2 border-gray-300 text-left text-sm leading-4 text-gray-800 tracking-wider"}," Result ",-1),ft=t("th",{class:"px-1 py-1 border-b-2 border-gray-300 text-left text-sm leading-4 text-gray-800 tracking-wider"}," Unit ",-1),gt=t("th",{class:"px-1 py-1 border-b-2 border-gray-300 text-left text-sm leading-4 text-gray-800 tracking-wider"}," Status ",-1),vt={class:"bg-white"},kt=["onUpdate:modelValue","disabled"],xt={class:"px-1 py-1 whitespace-no-wrap border-b border-gray-500"},wt=t("i",{class:"fa fa-star"},null,-1),Ut=[wt],Rt={class:"px-1 py-1 whitespace-no-wrap border-b border-gray-500"},Ct={class:"text-sm leading-5 text-gray-800 font-semibold"},St={key:1},Et={key:0},At={class:"px-1 py-1 whitespace-no-wrap border-b border-gray-500"},Tt={class:"px-1 py-1 whitespace-no-wrap border-b border-gray-500"},Vt={class:"px-1 py-1 whitespace-no-wrap border-b border-gray-500"},Dt={class:"px-1 py-1 whitespace-no-wrap border-b border-gray-500"},Wt={key:0,class:"text-sm leading-5 text-sky-800"},Nt={key:1,class:"block col-span-2 mb-2"},Bt=["onUpdate:modelValue","onChange"],Ot=t("option",{value:""},null,-1),Pt=["value"],$t={class:"px-1 py-1 whitespace-no-wrap border-b border-gray-500"},It={key:0},Kt={key:1,class:"block"},Mt=["onUpdate:modelValue","onKeyup"],jt={key:2,class:"block col-span-2 mb-2"},qt=["onUpdate:modelValue","onChange"],Ht=t("option",{value:""},null,-1),Lt=["value"],Ft={class:"px-1 py-1 whitespace-no-wrap border-b border-gray-500"},zt={class:"px-1 py-1 whitespace-no-wrap border-b border-gray-500"},Yt={type:"button",class:"bg-sky-800 text-white py-1 px-2 rounded-sm leading-none"},Gt={class:"my-4"},Jt=Ue({__name:"WorkSheetResults",setup(M){const j=Oe(()=>Pe(()=>import("./FelButton-3269ca5f.js"),["assets/FelButton-3269ca5f.js","assets/index-a40c2365.js","assets/index-12195ca3.css"])),v=Re(),h=Ce(),C=Se(),q=Ee(),Z=Ae();let W=u(!1),N=u(!1),B=u(!1),O=u(!1),P=u(!1),$=u(!1),y=u(!1),k=u(!1),b=Te(()=>v.getWorkSheet);const H=()=>{v.fetchWorksheetByUid(q.params.workSheetUid)};C.fetchUsers({}),h.fetchLaboratoryInstruments(),h.fetchMethods();const _=Ve({analystUid:void 0,instrumentUid:void 0,methodUid:void 0}),S=u(!1),ee=()=>{S.value=!0,v.updateWorksheet({worksheetUid:q.params.workSheetUid,..._}).then(()=>{S.value=!1,H()})};function te(){return b.value?.analysisResults?.every(o=>o.checked===!0)}function E(){let o=[];return b.value?.analysisResults?.forEach(s=>{s.checked&&o.push(s)}),o}function se(){te()?y.value=!0:y.value=!1,V()}function A(o){if(L(o)){F(o);return}o.checked=!0,V()}function L(o){return["retracted","approved"].includes(o.status)}function F(o){o.checked=!1,V()}function oe(){b?.value?.analysisResults?.forEach(o=>y.value?A(o):F(o)),V()}function ne(o){o.editable=!0}function z(o){return o.status!=="pending"?!1:o?.editable||$e(o?.result)?(ne(o),!0):!1}function ae(){let o=E(),s=[];return o?.forEach(c=>s.push({uid:c.uid,result:c.result})),s}function T(){const o=E();let s=[];return o?.forEach(c=>s.push(c.uid)),s}function re(){const o=E();console.log(o);let s=[];return o?.forEach(c=>s.push(c.sample?.uid)),console.log(s),s}function le(o){switch(o?.status){case"retracted":return"bg-gray-300 text-sm italic text-gray-500";case"pending":return o?.retest===!0?"bg-sky-800 text-sm leading-5 text-sky-800":"";case"resulted":return o?.retest===!0?"bg-sky-800 text-sm leading-5 text-sky-800":"";case"approved":return o?.retest===!0?"bg-sky-800 text-sm leading-5 text-sky-800":"";default:return"text-sm leading-5 text-sky-800"}}function V(){W.value=!1,P.value=!1,N.value=!1,B.value=!1,O.value=!1,$.value=!1;const o=E();o.length!==0&&($.value=!0,o.every(s=>s.status==="pending")&&(W.value=!0,P.value=!0),o.every(s=>s.status==="resulted")&&(N.value=!0,B.value=!0,O.value=!0))}const{submitResults:ie,approveResults:de,retractResults:ue,retestResults:ce}=Ke(),{unAssignSamples:pe}=Me(),me=()=>pe(T()),he=()=>ie(ae(),"worksheet",b.value?.uid),ye=()=>de(T(),"worksheet",b.value?.uid),be=()=>ue(T()),_e=()=>ce(T()),fe=async()=>{window.open(Z.resolve({name:"print-barcodes",query:{sampleUids:JSON.stringify(re().join(","))}}).href,"_blank")};return(o,s)=>{const c=De("router-link"),ge=G("motion-slide-left"),ve=G("motion-slide-right");return n(),a("div",je,[qe,i((n(),a("div",He,[t("label",Le,[I("More Sample Detail "),t("div",Fe,[i(t("input",{type:"checkbox",name:"toggle",id:"toggle","onUpdate:modelValue":s[0]||(s[0]=e=>J(k)?k.value=e:k=e),class:"toggle-checkbox absolute block w-6 h-6 rounded-full bg-white border-4 appearance-none cursor-pointer outline-none"},null,512),[[K,d(k)]]),ze])]),i(t("form",Ye,[t("div",Ge,[t("label",Je,[Qe,i(t("select",{name:"instrument_uid","onUpdate:modelValue":s[1]||(s[1]=e=>_.analystUid=e),class:"form-input mt-1 block w-full py-1"},[(n(!0),a(f,null,g(d(C).users,e=>(n(),a("option",{key:e.uid,value:e.uid},r(e.firstName)+" "+r(e.lastName),9,Xe))),128))],512),[[x,_.analystUid]])]),t("label",Ze,[et,i(t("select",{name:"instrument_uid","onUpdate:modelValue":s[2]||(s[2]=e=>_.instrumentUid=e),class:"form-input mt-1 block w-full py-1"},[(n(!0),a(f,null,g(d(h).laboratoryInstruments,e=>(n(),a("option",{key:e.uid,value:e.uid},r(e?.instrument.name)+": ("+r(e?.labName)+") ",9,tt))),128))],512),[[x,_.instrumentUid]])]),t("label",st,[ot,i(t("select",{name:"method_uid","onUpdate:modelValue":s[3]||(s[3]=e=>_.methodUid=e),class:"form-input mt-1 block w-full py-1"},[(n(!0),a(f,null,g(d(h).methods,e=>(n(),a("option",{key:e.uid,value:e.uid},r(e.name),9,nt))),128))],512),[[x,_.methodUid]])]),t("div",at,[We(d(j),{onClick:s[4]||(s[4]=p(e=>ee(),["prevent"])),color:"sky-800",class:"p-1"},{default:Q(()=>[I("Apply")]),_:1})])])],512),[[m,!S.value]]),i(t("p",null,"updating ...",512),[[m,S.value]]),t("div",null,[t("button",{onClick:s[5]||(s[5]=p(e=>H(),["prevent"])),class:"px-1 py-1 mr-2 border-sky-800 border text-sky-800 rounded-sm transition duration-300 hover:bg-sky-800 hover:text-white focus:outline-none"}," Refresh ")])])),[[ge]]),rt,D(" Sampe Table View "),t("div",lt,[t("div",it,[t("table",dt,[t("thead",null,[t("tr",null,[t("th",ut,[i(t("input",{type:"checkbox",class:"",onChange:s[6]||(s[6]=e=>oe()),"onUpdate:modelValue":s[7]||(s[7]=e=>J(y)?y.value=e:y=e)},null,544),[[K,d(y)]])]),ct,pt,mt,ht,yt,bt,_t,ft,gt,D(' <th class="px-1 py-1 border-b-2 border-gray-300"></th> ')])]),t("tbody",vt,[(n(!0),a(f,null,g(d(b)?.analysisResults,e=>i((n(),a("tr",{key:e.uid,class:X([le(e)])},[t("td",null,[i(t("input",{type:"checkbox",class:"","onUpdate:modelValue":l=>e.checked=l,onChange:s[8]||(s[8]=l=>se()),disabled:L(e)},null,40,kt),[[K,e.checked]])]),t("td",xt,[e?.sample?.priority>0?(n(),a("span",{key:0,class:X(["font-small",{"text-orange-600":d(b)?.priority>1}])},[...Ut],2)):D("v-if",!0)]),t("td",Rt,[t("div",Ct,[e?.sample?.analysisRequest?.patient?.uid?(n(),Ne(c,{key:0,to:{name:"sample-detail",params:{patientUid:e?.sample?.analysisRequest?.patient?.uid,sampleUid:e?.sample?.uid}}},{default:Q(()=>[I(r(e?.sample?.sampleId),1)]),_:2},1032,["to"])):(n(),a("div",St,r(e?.sample?.sampleId),1))]),d(k)?(n(),a("span",Et,[t("span",null,r(e?.sample?.qcLevel?.level),1),t("div",null,r(e?.sample?.analysisRequest?.patient?.firstName)+" "+r(e?.sample?.analysisRequest?.patient?.lastName),1),t("div",null,r(e?.sample?.analysisRequest?.client?.name),1)])):D("v-if",!0)]),t("td",At,[t("div",null,r(e?.analysis?.name),1)]),t("td",Tt,[t("div",null,r(e?.laboratoryInstrument?.instrument?.name)+": "+r(e?.laboratoryInstrument?.labName),1)]),t("td",Vt,[t("div",null,r(e?.method?.name||"None"),1)]),t("td",Dt,[!z(e)||(e?.analysis?.interims?.length??0)===0?(n(),a("div",Wt," --- ")):(n(),a("label",Nt,[i(t("select",{class:"form-input mt-1 block w-full","onUpdate:modelValue":l=>e.result=l,onChange:l=>A(e)},[Ot,(n(!0),a(f,null,g(e?.analysis?.interims,(l,ke)=>(n(),a("option",{key:l.key,value:l.value},r(l.value),9,Pt))),128))],40,Bt),[[x,e.result]])]))]),t("td",$t,[z(e)?e?.analysis?.resultOptions?.length===0?(n(),a("label",Kt,[i(t("input",{class:"form-input mt-1 block w-full","onUpdate:modelValue":l=>e.result=l,onKeyup:l=>A(e)},null,40,Mt),[[Be,e.result]])])):(n(),a("label",jt,[i(t("select",{class:"form-input mt-1 block w-full","onUpdate:modelValue":l=>e.result=l,onChange:l=>A(e)},[Ht,(n(!0),a(f,null,g(e?.analysis?.resultOptions,(l,ke)=>(n(),a("option",{key:l.optionKey,value:l.value},r(l.value),9,Lt))),128))],40,qt),[[x,e.result]])])):(n(),a("div",It,r(e?.result),1))]),t("td",Ft,[t("div",null,r(e?.analysis?.unit?.name||"---"),1)]),t("td",zt,[t("button",Yt,r(e?.status||"unknown"),1)])],2)),[[ve]])),128))])])])]),t("section",Gt,[i(t("button",{onClick:s[9]||(s[9]=p(e=>me(),["prevent"])),class:"px-2 py-1 mr-2 border-sky-800 border text-sky-800 rounded-sm transition duration-300 hover:bg-sky-800 hover:text-white focus:outline-none"}," Un Assign ",512),[[m,w(R.CREATE,U.WORKSHEET)&&d(P)]]),i(t("button",{onClick:s[10]||(s[10]=p(e=>he(),["prevent"])),class:"px-2 py-1 mr-2 border-sky-800 border text-sky-800 rounded-sm transition duration-300 hover:bg-sky-800 hover:text-white focus:outline-none"}," Submit ",512),[[m,w(R.UPDATE,U.WORKSHEET)&&d(W)]]),i(t("button",{onClick:s[11]||(s[11]=p(e=>be(),["prevent"])),class:"px-2 py-1 mr-2 border-sky-800 border text-sky-800 rounded-sm transition duration-300 hover:bg-sky-800 hover:text-white focus:outline-none"}," Retract ",512),[[m,w(R.UPDATE,U.WORKSHEET)&&d(N)]]),i(t("button",{onClick:s[12]||(s[12]=p(e=>ye(),["prevent"])),class:"px-2 py-1 mr-2 border-sky-800 border text-sky-800 rounded-sm transition duration-300 hover:bg-sky-800 hover:text-white focus:outline-none"}," Approve ",512),[[m,w(R.UPDATE,U.WORKSHEET)&&d(B)]]),i(t("button",{onClick:s[13]||(s[13]=p(e=>_e(),["prevent"])),class:"px-2 py-1 mr-2 border-sky-800 border text-sky-800 rounded-sm transition duration-300 hover:bg-sky-800 hover:text-white focus:outline-none"}," Retest ",512),[[m,w(R.UPDATE,U.WORKSHEET)&&d(O)]]),i(t("button",{onClick:p(fe,["prevent"]),class:"px-2 py-1 mr-2 border-sky-800 border text-sky-800 rounded-sm transition duration-300 hover:bg-sky-800 hover:text-white focus:outline-none"}," Print Barcodes ",512),[[m,d($)]])])])}}}),es=Ie(Jt,[["__file","/home/aurthurm/Documents/Development/felicity/felicity-lims/webapp/views/worksheet/_id/WorkSheetResults.vue"]]);export{es as default};
