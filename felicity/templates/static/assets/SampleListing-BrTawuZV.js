const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/DataTable-DLBrhw2Z.js","assets/index-OdhKCqIc.js","assets/index-DD18L2yL.css","assets/TooltipTrigger-BWIYwmnQ.js","assets/PopperContent-BfyCnGUj.js","assets/Input-BEm5S0CJ.js","assets/SelectValue-Ds0cfAgl.js","assets/useNonce-B4v0IDPb.js","assets/chevron-down-Dqf-ptA3.js","assets/useFocusGuards-Bjb6OG0k.js","assets/Spinner-Bl8RfjFA.js","assets/DeriveSamplesModal-C5WhmsJK.js","assets/analysis-PB9AMevg.js","assets/analyses.mutations-DUxQZn1r.js","assets/DeriveSamplesModal-B_WXTbde.css"])))=>i.map(i=>d[i]);
import{Y as ge,P as be,aB as Se,ag as Ce,$ as _e,av as x,a7 as G,a0 as P,b8 as Re,a5 as K,a6 as Y,a3 as Be,aD as o,aC as Pe,_ as Ae,c as ke,o as De,a as d,K as u,z as Le,D as v,M as h,E as p}from"./index-OdhKCqIc.js";import{B as Me}from"./index-Dj97WNKd.js";import{p as C}from"./index-CXV6PIcj.js";import{u as Ee}from"./analysis-PB9AMevg.js";import{u as xe}from"./samples-BGCTZScT.js";import{s as we}from"./index-DJJ2wcNX.js";import"./analyses.mutations-DUxQZn1r.js";const Te=ge({__name:"SampleListing",setup(Z,{expose:s}){s();const w=K(()=>Y(()=>import("./DataTable-DLBrhw2Z.js"),__vite__mapDeps([0,1,2,3,4,5,6,7,8,9,10]))),a=K(()=>Y(()=>import("./DeriveSamplesModal-C5WhmsJK.js"),__vite__mapDeps([11,1,2,12,13,14]))),f=be(),A=Ee(),{samplePageInfo:m,fetchingSamples:Q}=Se(f);let k=Ce(),R=_e();const r=x({barcodes:!1,can_cancel:!1,can_receive:!1,can_reinstate:!1,can_reject:!1,can_copy_to:!1,can_download:!1,can_print:!1,can_publish:!1,can_store:!1,can_recover:!1,can_derive:!1}),y=G(()=>f.getSamples),X=P([{name:"All",value:""},{name:"Expected",value:"expected"},{name:"Received",value:"received"},{name:"Awaiting",value:"awaiting"},{name:"Approved",value:"approved"},{name:"Published",value:"published"},{name:"Invalidated",value:"invalidated"},{name:"Cancelled",value:"cancelled"},{name:"Rejected",value:"rejected"},{name:"Stored",value:"stored"},{name:"Referred",value:"referred"},{name:"Paired",value:"paired"}]),$=P([{name:"UID",value:"uid",sortable:!0,sortBy:"asc",defaultSort:!0,showInToggler:!1,hidden:!0},{name:"",value:"",sortable:!1,showInToggler:!1,hidden:!1,customRender:function(e,t){return o("div",{class:"flex items-center gap-2"},[e.priority>1?o("span",{class:"text-destructive"},o("i",{class:"fa fa-star"})):"",e.status==="stored"?o("span",{class:"text-muted-foreground"},o("i",{class:"fa-briefcase"})):""])}},{name:"Sample ID",value:"sampleId",sortable:!0,sortBy:"asc",hidden:!1,customRender:function(e,t){const n=N(e?.relationshipType);return o("div",{class:"flex items-center gap-2"},[o(Pe,{to:{name:"sample-detail",params:{patientUid:e?.analysisRequest?.patient?.uid,sampleUid:e?.uid}},class:"text-primary hover:underline",innerHTML:e?.sampleId}),n?o("span",{class:"inline-flex items-center justify-center w-4 h-4 rounded-full text-[9px] italic font-semibold bg-muted text-foreground"},n):null])}},{name:"Sample Type",value:"sampleType.name",sortable:!1,sortBy:"asc",hidden:!0},{name:"Test(s)",value:"",sortable:!1,sortBy:"asc",hidden:!1,customRender:function(e,t){return o("span",{innerHTML:T(e.profiles,e.analyses)},[])}},{name:"Patient",value:"",sortable:!1,sortBy:"asc",hidden:!1,customRender:function(e,t){const n="analysisRequest.patient.firstName".split(".").reduce((i,E)=>i?.[E],e),l="analysisRequest.patient.lastName".split(".").reduce((i,E)=>i?.[E],e);return o("span",{innerHTML:`${n} ${l}`},[])}},{name:"Gender",value:"analysisRequest.patient.gender",sortable:!1,sortBy:"asc",hidden:!0},{name:"Age",value:"analysisRequest.patient.age",sortable:!1,sortBy:"asc",hidden:!0},{name:"Client Patient ID",value:"analysisRequest.patient.clientPatientId",sortable:!1,sortBy:"asc",hidden:!1},{name:"Client",value:"analysisRequest.client.name",sortable:!1,sortBy:"asc",hidden:!1},{name:"Client Code",value:"analysisRequest.client.code",sortable:!1,sortBy:"asc",hidden:!0},{name:"Province",value:"analysisRequest.client.district.province.name",sortable:!1,sortBy:"asc",hidden:!0},{name:"District",value:"analysisRequest.client.district.name",sortable:!1,sortBy:"asc",hidden:!0},{name:"Client Request Id",value:"analysisRequest.clientRequestId",sortable:!1,sortBy:"asc",hidden:!1},{name:"Date Collected",value:"dateCollected",sortable:!1,sortBy:"asc",hidden:!0,customRender:function(e,t){const n=t.value.split(".").reduce((l,i)=>l?.[i],e);return o("span",{innerHTML:C(n)},[])}},{name:"Date Created",value:"createdAt",sortable:!1,sortBy:"asc",hidden:!0,customRender:function(e,t){const n=t.value.split(".").reduce((l,i)=>l?.[i],e);return o("span",{innerHTML:C(n)},[])}},{name:"Creator",value:"createdBy.firstName",sortable:!1,sortBy:"asc",hidden:!1},{name:"Date Received",value:"dateReceived",sortable:!1,sortBy:"asc",hidden:!0,customRender:function(e,t){const n=t.value.split(".").reduce((l,i)=>l?.[i],e);return o("span",{innerHTML:C(n)},[])}},{name:"Date Submitted",value:"dateSubmitted",sortable:!1,sortBy:"asc",hidden:!0,customRender:function(e,t){const n=t.value.split(".").reduce((l,i)=>l?.[i],e);return o("span",{innerHTML:C(n)},[])}},{name:"Date Verified",value:"dateVerified",sortable:!1,sortBy:"asc",hidden:!0,customRender:function(e,t){const n=t.value.split(".").reduce((l,i)=>l?.[i],e);return o("span",{innerHTML:C(n)},[])}},{name:"Date Published",value:"datePublished",sortable:!1,sortBy:"asc",hidden:!0,customRender:function(e,t){const n=t.value.split(".").reduce((l,i)=>l?.[i],e);return o("span",{innerHTML:C(n)},[])}},{name:"Date Printed",value:"datePrinted",sortable:!1,sortBy:"asc",hidden:!0,customRender:function(e,t){const n=t.value.split(".").reduce((l,i)=>l?.[i],e);return o("span",{innerHTML:C(n)},[])}},{name:"Printed",value:"printed",sortable:!1,sortBy:"asc",hidden:!0},{name:"Status",value:"status",sortable:!1,sortBy:"asc",hidden:!1,customRender:function(e,t){const n=t.value.split(".").reduce((l,i)=>l?.[i],e);return o(Me,{variant:"secondary",class:"capitalize"},()=>n)}}]);k?.query?.clientUid&&f.resetSamples(),f.fetchSampleTypes();let D=x({first:void 0,after:"",text:"",sortBy:["name"]});A.fetchAnalysesServices(D),A.fetchAnalysesProfiles();function T(e,t){let n=[];return e.forEach(l=>n.push(l.name)),t.forEach(l=>n.push(l.name)),n.join(", ")}function N(e){if(!e)return null;const t=e.toLowerCase();return t.startsWith("der")?"D":t.startsWith("ali")?"A":t.startsWith("poo")?"P":e.charAt(0).toUpperCase()}let c=x({first:50,before:"",status:"received",text:"",sortBy:["-uid"],clientUid:Re(k?.query?.clientUid),filterAction:!1});f.fetchSamples(c);function ee(e){c.first=e.fetchCount,c.before=m?.value?.endCursor??"",c.text=e.filterText,c.status=e.filterStatus,c.filterAction=!1,f.fetchSamples(c)}function ae(e){c.first=50,c.before="",c.text=e.filterText,c.status=e.filterStatus,c.filterAction=!0,f.fetchSamples(c)}const te=e=>{const t=e?.storageContainer,n=t?.storageSection,l=n?.storageLocation;return`${l?.storeRoom?.name} > ${l?.name} > ${n?.name} > ${t?.name} > ${e?.storageSlot}`},_=P(!1);function se(e){y.value?.forEach(t=>t.checked=e.checked),_.value=e.checked,B()}function ne(e){const t=y.value.findIndex(n=>n.uid===e.uid);y.value[t].checked=e.checked,I()?_.value=!0:_.value=!1,B()}function le(e){const t=y.value.findIndex(n=>n.uid===e.uid);y.value[t].checked=!1,_.value=!1,B()}async function g(){y.value?.forEach(e=>e.checked=!1),_.value=!1,B()}function I(){return y.value?.every(e=>e.checked===!0)}function S(){let e=[];return y.value?.forEach(t=>{t.checked&&e.push(t)}),e}function B(){r.can_cancel=!1,r.can_receive=!1,r.can_reinstate=!1,r.can_download=!1,r.can_publish=!1,r.can_print=!1,r.can_reject=!1,r.can_store=!1,r.can_recover=!1,r.can_copy_to=!1,r.can_derive=!1,r.barcodes=!1;const e=S();e.length!==0&&(r.barcodes=!0,r.can_derive=!0,e.every(t=>t.status==="expected")&&(r.can_receive=!0),e.every(t=>["received","expected"].includes(t.status))&&(r.can_cancel=!0,r.can_reject=!0),e.every(t=>["received"].includes(t.status))&&(r.can_store=!0,r.can_copy_to=!0),e.every(t=>["stored"].includes(t.status))&&(r.can_recover=!0),e.every(t=>t.status==="cancelled")&&(r.can_reinstate=!0),e.every(t=>["approved","published"].includes(t.status))&&(r.can_copy_to=!0),e.every(t=>t.status==="approved")&&(r.can_publish=!0),e.every(t=>t.status==="published")&&(r.can_print=!0,r.can_download=!0))}function b(){const e=S();let t=[];return e?.forEach(n=>t.push(n.uid)),t}function j(){const e=S();let t=[];return e?.forEach(n=>t.push(n.sampleId)),t}const{cancelSamples:q,reInstateSamples:O,receiveSamples:H,printSamples:U,downloadSamplesImpress:V,publishSamples:J,recoverSamples:W,cloneSamples:z}=xe(),re=G(()=>f.getSamples?.length+" of "+f.getSampleCount+" samples"),ie=async()=>z(b()).finally(()=>g()),oe=async()=>q(b()).finally(()=>g()),ce=async()=>O(b()).finally(()=>g()),de=async()=>H(b()).finally(()=>g()),ue=async()=>{const e=b().map(t=>({uid:t,action:"publish"}));await J(e).finally(()=>g())},fe=async()=>await U(b()).finally(()=>g()),me=async()=>await V(j()).finally(()=>g()),ve=async()=>{const e=S();R.push({name:"reject-samples",state:{samples:JSON.stringify(e)}})},he=async()=>{const e=S();R.push({name:"store-samples",state:{samples:JSON.stringify(e)}})},pe=async()=>W(b()).finally(()=>g()),ye=async()=>R.push({name:"print-barcodes",state:{sampleUids:JSON.stringify(b())}}),L=P(!1),M=P([]),F={DataTable:w,DeriveSamplesModal:a,sampleStore:f,analysisStore:A,samplePageInfo:m,fetchingSamples:Q,get route(){return k},set route(e){k=e},get router(){return R},set router(e){R=e},state:r,samples:y,filterOptions:X,tableColumns:$,get analysesParams(){return D},set analysesParams(e){D=e},profileAnalysesText:T,relationshipBadge:N,get sampleParams(){return c},set sampleParams(e){c=e},showMoreSamples:ee,filterSamples:ae,sampleToolTip:te,allChecked:_,toggleCheckAll:se,toggleCheck:ne,unCheck:le,unCheckAll:g,areAllChecked:I,getSamplesChecked:S,checkUserActionPermissios:B,getSampleUids:b,getSampleIds:j,cancelSamples:q,reInstateSamples:O,receiveSamples:H,printSamples:U,downloadSamplesImpress:V,publishSamples:J,recoverSamples:W,cloneSamples:z,countNone:re,cloneSamples_:ie,cancelSamples_:oe,reInstateSamples_:ce,receiveSamples_:de,publishReports_:ue,printReports_:fe,impressDownload_:me,prepareRejections:ve,prepareStorages:he,recoverSamples_:pe,printBarCodes:ye,showDeriveModal:L,deriveSelection:M,openDeriveModal:()=>{const e=S();e.length!==0&&(M.value=e,L.value=!0)},closeDeriveModal:()=>{L.value=!1,M.value=[]},handleDerived:async e=>{if(e?.length){const t=new Set(y.value.map(l=>l.uid)),n=e.filter(l=>!t.has(l.uid));n.length&&f.addSampleClones(n)}await g()},get Button(){return Be},get shield(){return we}};return Object.defineProperty(F,"__isScriptSetup",{enumerable:!1,value:!0}),F}}),Ne={class:"rounded-lg border border-border bg-card shadow-sm p-6"};function Ie(Z,s,w,a,f,A){return De(),ke("div",Ne,[d(a.DataTable,{columns:a.tableColumns,data:a.samples,toggleColumns:!0,loading:a.fetchingSamples,paginable:!0,pageMeta:{fetchCount:a.sampleParams.first,hasNextPage:a.samplePageInfo?.hasNextPage,countNone:a.countNone},searchable:!0,filterable:!0,filterMeta:{defaultFilter:a.sampleParams.status,filters:a.filterOptions},selectable:!0,allChecked:a.allChecked,onOnSearch:a.filterSamples,onOnPaginate:a.showMoreSamples,onOnCheck:a.toggleCheck,onOnCheckAll:a.toggleCheckAll},{footer:u(()=>[Le("div",null,[v(d(a.Button,{onClick:s[0]||(s[0]=m=>a.cancelSamples_())},{default:u(()=>[...s[10]||(s[10]=[h(" Cancel ",-1)])]),_:1},512),[[p,a.shield.hasRights(a.shield.actions.CANCEL,a.shield.objects.SAMPLE)&&a.state.can_cancel]]),v(d(a.Button,{onClick:s[1]||(s[1]=m=>a.reInstateSamples_())},{default:u(()=>[...s[11]||(s[11]=[h(" ReInstate ",-1)])]),_:1},512),[[p,a.shield.hasRights(a.shield.actions.CANCEL,a.shield.objects.SAMPLE)&&a.state.can_reinstate]]),v(d(a.Button,{onClick:s[2]||(s[2]=m=>a.receiveSamples_())},{default:u(()=>[...s[12]||(s[12]=[h(" Reveive ",-1)])]),_:1},512),[[p,a.shield.hasRights(a.shield.actions.CANCEL,a.shield.objects.SAMPLE)&&a.state.can_receive]]),v(d(a.Button,{onClick:s[3]||(s[3]=m=>a.prepareStorages())},{default:u(()=>[...s[13]||(s[13]=[h(" Store ",-1)])]),_:1},512),[[p,a.shield.hasRights(a.shield.actions.CANCEL,a.shield.objects.SAMPLE)&&a.state.can_store]]),v(d(a.Button,{onClick:s[4]||(s[4]=m=>a.recoverSamples_())},{default:u(()=>[...s[14]||(s[14]=[h(" Recover ",-1)])]),_:1},512),[[p,a.shield.hasRights(a.shield.actions.CANCEL,a.shield.objects.SAMPLE)&&a.state.can_recover]]),v(d(a.Button,{onClick:s[5]||(s[5]=m=>a.prepareRejections())},{default:u(()=>[...s[15]||(s[15]=[h(" Reject ",-1)])]),_:1},512),[[p,a.shield.hasRights(a.shield.actions.CANCEL,a.shield.objects.SAMPLE)&&a.state.can_reject]]),v(d(a.Button,{onClick:s[6]||(s[6]=m=>a.cloneSamples_())},{default:u(()=>[...s[16]||(s[16]=[h(" Copy to New ",-1)])]),_:1},512),[[p,a.shield.hasRights(a.shield.actions.CANCEL,a.shield.objects.SAMPLE)&&a.state.can_copy_to]]),v(d(a.Button,{onClick:s[7]||(s[7]=m=>a.impressDownload_())},{default:u(()=>[...s[17]||(s[17]=[h(" Download ",-1)])]),_:1},512),[[p,a.shield.hasRights(a.shield.actions.CANCEL,a.shield.objects.SAMPLE)&&a.state.can_download]]),v(d(a.Button,{onClick:s[8]||(s[8]=m=>a.publishReports_())},{default:u(()=>[...s[18]||(s[18]=[h(" Publish ",-1)])]),_:1},512),[[p,a.shield.hasRights(a.shield.actions.CANCEL,a.shield.objects.SAMPLE)&&a.state.can_publish]]),v(d(a.Button,{onClick:s[9]||(s[9]=m=>a.printReports_())},{default:u(()=>[...s[19]||(s[19]=[h(" Print ",-1)])]),_:1},512),[[p,a.shield.hasRights(a.shield.actions.CANCEL,a.shield.objects.SAMPLE)&&a.state.can_print]]),v(d(a.Button,{onClick:a.printBarCodes},{default:u(()=>[...s[20]||(s[20]=[h(" Print Barcodes ",-1)])]),_:1},512),[[p,a.state.barcodes]]),v(d(a.Button,{onClick:a.openDeriveModal},{default:u(()=>[...s[21]||(s[21]=[h(" Derive ",-1)])]),_:1},512),[[p,a.state.can_derive]])])]),_:1},8,["columns","data","loading","pageMeta","filterMeta","allChecked"]),d(a.DeriveSamplesModal,{show:a.showDeriveModal,samples:a.deriveSelection,onClose:a.closeDeriveModal,onDerived:a.handleDerived},null,8,["show","samples"])])}const Ge=Ae(Te,[["render",Ie],["__file","/home/administrator/Documents/Development/beak-insights/felicity/felicity-lims/webapp/components/sample/SampleListing.vue"]]);export{Ge as default};
