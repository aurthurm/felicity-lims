import{a0 as I,a7 as v,a5 as F,b4 as T,_ as P,c as l,o as i,Q as b,A as e,E as L,L as d,J as k,K as w,ad as D,h as M,g as O,f as G,bg as K,bh as z,r as R,C as j,N as H,D as J,F as x,a2 as N,a as Q,a9 as q,a3 as W}from"./index-Cdc6vSVw.js";import{u as X}from"./user-DvEjaZsO.js";import{u as Y}from"./setup-CYxvLUvq.js";const Z=I({__name:"FelProtectedInput",props:{modelValue:{type:String,required:!0},disabled:{type:Boolean,required:!1,default:!1},placeholder:{type:String,required:!1,default:""},requiredClicks:{type:Number,required:!1,default:3},type:{type:String,required:!1,default:"text"},id:{type:String,required:!1,default:""},class:{type:String,required:!1,default:""}},emits:["update:modelValue"],setup(A,{expose:o,emit:s}){o();const t=A,g=s,y=v(!0),c=v(t.modelValue),r=v(),a=v(0),m=v();F(()=>t.modelValue,p=>{c.value=p});const _=p=>{if(!(t.disabled||!y.value)){if(p.preventDefault(),p.stopPropagation(),a.value++,m.value&&clearTimeout(m.value),a.value>=t.requiredClicks){U();return}m.value=setTimeout(()=>{a.value=0},1500)}},U=async()=>{y.value=!1,a.value=0,m.value&&clearTimeout(m.value),await T(),r.value?.focus(),r.value?.select()},h=()=>{y.value=!0,a.value=0,m.value&&clearTimeout(m.value)},V={props:t,emit:g,isProtected:y,inputValue:c,inputRef:r,clickCount:a,clickTimeout:m,handleProtectedClick:_,unlockInput:U,lockInput:h,handleInput:p=>{const C=p.target;c.value=C.value,g("update:modelValue",C.value)},handleKeydown:p=>{p.key==="Enter"?(h(),r.value?.blur()):p.key==="Escape"&&(c.value=t.modelValue,g("update:modelValue",t.modelValue),h(),r.value?.blur())},handleBlur:()=>{setTimeout(()=>{h()},200)}};return Object.defineProperty(V,"__isScriptSetup",{enumerable:!1,value:!0}),V}}),$={class:"relative"},ee=["title"],te={key:0,class:"text-foreground"},oe={key:1,class:"text-muted-foreground"},re={key:0,class:"absolute inset-y-0 right-0 flex items-center pr-3 pointer-events-none"},se={key:0,class:"flex items-center space-x-1 bg-background/95 backdrop-blur-sm px-2 py-1 rounded-md shadow-sm border border-border"},ae={class:"flex space-x-1"},ie={class:"text-xs text-muted-foreground ml-1"},le={key:1,class:"text-muted-foreground bg-background/80 backdrop-blur-sm p-1 rounded transition-colors duration-200 group-hover:text-primary"},ne={key:1,class:"relative"},de=["id","value","type","placeholder","disabled"];function ue(A,o,s,t,g,y){return i(),l("div",$,[t.isProtected?(i(),l("div",{key:0,onClick:t.handleProtectedClick,class:b(["relative cursor-pointer transition-all duration-200 group select-none",s.disabled?"cursor-not-allowed opacity-50":"hover:ring-2 hover:ring-primary/20 hover:bg-primary/5",t.clickCount>0&&!s.disabled&&"ring-2 ring-primary/30 bg-primary/10"]),title:s.disabled?"Input is disabled":`Click ${s.requiredClicks} times quickly to unlock for editing (${t.clickCount}/${s.requiredClicks})`},[e("div",{class:b(["w-full px-3 py-2 bg-background border border-border rounded-md text-sm transition-colors duration-200",s.disabled?"bg-muted text-muted-foreground cursor-not-allowed":t.clickCount>0?"border-primary bg-primary/5 text-foreground":"text-foreground group-hover:border-primary/50"])},[t.inputValue?(i(),l("span",te,d(t.inputValue),1)):(i(),l("span",oe,d(s.placeholder),1))],2),s.disabled?L("",!0):(i(),l("div",re,[t.clickCount>0?(i(),l("div",se,[e("div",ae,[(i(!0),l(k,null,w(s.requiredClicks,c=>(i(),l("div",{key:c,class:b(["w-1.5 h-1.5 rounded-full transition-all duration-200",c<=t.clickCount?"bg-primary":"bg-muted"])},null,2))),128))]),e("span",ie,d(s.requiredClicks-t.clickCount)+" more ",1)])):(i(),l("div",le,[...o[0]||(o[0]=[e("svg",{class:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M12 15v2m-6 4h12a2 2 0 002-2v-6a2 2 0 00-2-2H6a2 2 0 00-2 2v6a2 2 0 002 2zm10-10V7a4 4 0 00-8 0v4h8z"})],-1)])]))]))],10,ee)):(i(),l("div",ne,[e("input",{ref:"inputRef",id:s.id,value:t.inputValue,type:s.type,placeholder:s.placeholder,disabled:s.disabled,onInput:t.handleInput,onKeydown:t.handleKeydown,onBlur:t.handleBlur,class:"w-full px-3 py-2 bg-background border-2 border-primary text-foreground rounded-md text-sm placeholder:text-muted-foreground transition-colors duration-200 focus:border-primary focus:outline-none focus:ring-2 focus:ring-primary/20"},null,40,de),o[1]||(o[1]=e("div",{class:"absolute inset-y-0 right-0 flex items-center pr-3 pointer-events-none"},[e("div",{class:"text-primary bg-background/90 backdrop-blur-sm p-1 rounded"},[e("svg",{class:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M8 11V7a4 4 0 118 0m-4 8v2m-6 4h12a2 2 0 002-2v-6a2 2 0 00-2 2v6a2 2 0 002 2z"})])])],-1))]))])}const ce=P(Z,[["render",ue],["__file","/home/aurthurm/Documents/Development/felicity/felicity-lims/webapp/components/ui/form/FelProtectedInput.vue"]]),me=I({__name:"UsersListing",setup(A,{expose:o}){o();const s=X(),t=Y();D(()=>{s.fetchUsers({}),s.fetchGroupsAndPermissions(),t.fetchLaboratories()});let g=M(()=>s.getUsers);const y=M(()=>s.getGroups);let c=v(!1),r=v(""),a=O({userUid:"",firstName:"",lastName:"",email:"",groupUid:"",userName:"",password:"",passwordc:"",isActive:!0,isBlocked:!1,laboratoryUids:[],activeLaboratoryUid:""});const m=v(!0),{withClientMutation:_}=G();function U(){_(K,a,"createUser").then(n=>s.addUser(n))}function h(){_(z,a,"updateUser").then(n=>s.updateUser(n))}function B(n){let u=[];return n?.groups?.forEach(f=>u.push(f?.name)),u.join(", ")}const S=n=>{const u=t.getLaboratories.find(f=>f.uid===n);return u?u?.name||"Unknown Laboratory":"-- Not Assigned --"};function E(n,u={}){if(m.value=n,c.value=!0,r.value=(n?"CREATE":"EDIT")+" USER",n){let f=new Object;f.firstName="",f.lastName="",f.email="",f.isActive=!0,f.userName="",f.isBlocked=!1,Object.assign(a,{...f,groupUid:"",userUid:"",laboratoryUids:[],activeLaboratoryUid:""})}else a.userUid=u?.uid||"",a.groupUid=u?.groups&&u.groups[0]?u.groups[0].uid:"",a.isActive=u.isActive??!0,a.isBlocked=u.isBlocked??!1,a.userName=u.userName??"",a.laboratoryUids=u.laboratories||[],a.activeLaboratoryUid=u.activeLaboratoryUid||"",Object.assign(a,{...u})}function V(){m.value?U():h(),c.value=!1}const C={userStore:s,setupStore:t,get users(){return g},set users(n){g=n},groups:y,get showUserModal(){return c},set showUserModal(n){c=n},get formTitle(){return r},set formTitle(n){r=n},get form(){return a},set form(n){a=n},formAction:m,withClientMutation:_,addUser:U,editUser:h,userGroupsName:B,getLaboratoryName:S,FormManager:E,saveUserForm:V,headers:["Full Name","Email","Active","Group","Username","Blocked","Active Laboratory","Assigned Labs","Actions"],FelProtectedInput:ce};return Object.defineProperty(C,"__isScriptSetup",{enumerable:!1,value:!0}),C}}),fe={class:"space-y-6"},pe={class:"flex justify-between items-center"},be={class:"bg-card rounded-lg shadow-sm"},ge={class:"min-w-full divide-y divide-border"},ye={class:"bg-background divide-y divide-border"},xe={class:"px-6 py-4 whitespace-nowrap text-sm"},ve={class:"px-6 py-4 whitespace-nowrap text-sm"},he={class:"px-6 py-4 whitespace-nowrap text-sm"},ke={class:"px-6 py-4 whitespace-nowrap text-sm"},we={class:"px-6 py-4 whitespace-nowrap text-sm"},_e={class:"px-6 py-4 whitespace-nowrap text-sm"},Ue={class:"px-6 py-4 whitespace-nowrap text-sm"},Ce={class:"px-6 py-4 whitespace-nowrap text-sm"},Ne={class:"px-6 py-4 whitespace-nowrap text-sm text-right"},Ae=["onClick"],Ve={class:"grid grid-cols-2 gap-6"},Le={class:"space-y-2"},Be={class:"space-y-2"},Se={class:"space-y-2"},Ee={class:"space-y-2"},Me={class:"space-y-2"},qe={class:"space-y-2"},Ie={class:"col-span-2 space-y-2"},Pe=["value"],Fe={class:"col-span-2 space-y-4 border-t border-gray-200 pt-6"},Te={class:"space-y-2"},De={class:"border-2 border-gray-300 rounded-md p-3 space-y-2 max-h-32 overflow-y-auto"},Oe=["id","value"],Ge=["for"],Ke={key:0,class:"space-y-2"},ze=["value"],Re={class:"flex items-center space-x-4"},je={class:"flex items-center space-x-2"},He=["aria-checked"],Je={class:"flex items-center space-x-4"},Qe={class:"flex items-center space-x-2"},We=["aria-checked"],Xe={class:"flex justify-end pt-6"},Ye={type:"submit",class:"inline-flex justify-center rounded-md border border-transparent bg-blue-600 px-4 py-2 text-sm font-medium text-white hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:ring-offset-2 transition-colors duration-200"};function Ze(A,o,s,t,g,y){const c=R("fel-modal");return i(),l(k,null,[e("div",fe,[e("div",pe,[o[14]||(o[14]=e("h1",{class:"text-2xl font-semibold"},"Users",-1)),e("button",{onClick:o[0]||(o[0]=r=>t.FormManager(!0)),class:"inline-flex items-center px-4 py-2 bg-primary text-primary-foreground rounded-md hover:bg-primary/90 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-primary","aria-label":"Add new user"}," Add User ")]),e("div",be,[e("table",ge,[e("thead",null,[e("tr",null,[(i(),l(k,null,w(t.headers,r=>e("th",{key:r,class:"px-6 py-3 text-left text-sm font-medium text-muted-foreground tracking-wider"},d(r),1)),64))])]),e("tbody",ye,[(i(!0),l(k,null,w(t.users,r=>(i(),l("tr",{key:r.uid,class:"hover:bg-muted/50"},[e("td",xe,d(r.firstName)+" "+d(r.lastName),1),e("td",ve,d(r.email),1),e("td",he,[e("span",{class:b(["inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium",r.isActive?"bg-success/20 text-success":"bg-destructive/20 text-destructive"])},d(r.isActive?"Active":"Inactive"),3)]),e("td",ke,d(r.groups?.map(a=>a?.name).join(", ")),1),e("td",we,d(r.userName),1),e("td",_e,[e("span",{class:b(["inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium",r.isBlocked?"bg-destructive/20 text-destructive":"bg-success/20 text-success"])},d(r.isBlocked?"Blocked":"Active"),3)]),e("td",Ue,d(t.getLaboratoryName(r.activeLaboratoryUid||"")),1),e("td",Ce,d(r.laboratories?.length)+" Labs",1),e("td",Ne,[e("button",{onClick:a=>t.FormManager(!1,r),class:"text-primary hover:text-primary/80 focus:outline-none focus:underline","aria-label":"Edit user"}," Edit ",8,Ae)])]))),128))])])])]),t.showUserModal?(i(),j(c,{key:0,onClose:o[13]||(o[13]=r=>t.showUserModal=!1),title:t.form.userUid?"Edit User":"Add User"},{body:H(()=>[e("form",{onSubmit:o[12]||(o[12]=J(r=>t.saveUserForm(),["prevent"])),class:"space-y-6"},[e("div",Ve,[e("div",Le,[o[15]||(o[15]=e("label",{for:"firstName",class:"block text-sm font-medium text-gray-700"}," First Name ",-1)),x(e("input",{id:"firstName","onUpdate:modelValue":o[1]||(o[1]=r=>t.form.firstName=r),type:"text",class:"mt-1 block w-full rounded-md border-2 border-gray-300 bg-white px-3 py-2 text-sm text-gray-900 placeholder:text-gray-400 transition-colors duration-200 focus:border-blue-500 focus:outline-none focus:ring-2 focus:ring-blue-200 hover:border-gray-400",placeholder:"Enter first name"},null,512),[[N,t.form.firstName]])]),e("div",Be,[o[16]||(o[16]=e("label",{for:"lastName",class:"block text-sm font-medium text-gray-700"}," Last Name ",-1)),x(e("input",{id:"lastName","onUpdate:modelValue":o[2]||(o[2]=r=>t.form.lastName=r),type:"text",class:"mt-1 block w-full rounded-md border-2 border-gray-300 bg-white px-3 py-2 text-sm text-gray-900 placeholder:text-gray-400 transition-colors duration-200 focus:border-blue-500 focus:outline-none focus:ring-2 focus:ring-blue-200 hover:border-gray-400",placeholder:"Enter last name"},null,512),[[N,t.form.lastName]])]),e("div",Se,[o[17]||(o[17]=e("label",{for:"email",class:"block text-sm font-medium text-gray-700"}," Email ",-1)),x(e("input",{id:"email","onUpdate:modelValue":o[3]||(o[3]=r=>t.form.email=r),type:"email",class:"mt-1 block w-full rounded-md border-2 border-gray-300 bg-white px-3 py-2 text-sm text-gray-900 placeholder:text-gray-400 transition-colors duration-200 focus:border-blue-500 focus:outline-none focus:ring-2 focus:ring-blue-200 hover:border-gray-400",placeholder:"Enter email address"},null,512),[[N,t.form.email]])]),e("div",Ee,[o[18]||(o[18]=e("label",{for:"userName",class:"block text-sm font-medium text-gray-700"}," Username ",-1)),Q(t.FelProtectedInput,{id:"userName",modelValue:t.form.userName,"onUpdate:modelValue":o[4]||(o[4]=r=>t.form.userName=r),type:"text","required-clicks":5,placeholder:"Enter username"},null,8,["modelValue"])]),e("div",Me,[o[19]||(o[19]=e("label",{for:"password",class:"block text-sm font-medium text-gray-700"}," Password ",-1)),x(e("input",{id:"password","onUpdate:modelValue":o[5]||(o[5]=r=>t.form.password=r),type:"password",class:"mt-1 block w-full rounded-md border-2 border-gray-300 bg-white px-3 py-2 text-sm text-gray-900 placeholder:text-gray-400 transition-colors duration-200 focus:border-blue-500 focus:outline-none focus:ring-2 focus:ring-blue-200 hover:border-gray-400",placeholder:"Enter password"},null,512),[[N,t.form.password]])]),e("div",qe,[o[20]||(o[20]=e("label",{for:"passwordc",class:"block text-sm font-medium text-gray-700"}," Confirm Password ",-1)),x(e("input",{id:"passwordc","onUpdate:modelValue":o[6]||(o[6]=r=>t.form.passwordc=r),type:"password",class:"mt-1 block w-full rounded-md border-2 border-gray-300 bg-white px-3 py-2 text-sm text-gray-900 placeholder:text-gray-400 transition-colors duration-200 focus:border-blue-500 focus:outline-none focus:ring-2 focus:ring-blue-200 hover:border-gray-400",placeholder:"Confirm password"},null,512),[[N,t.form.passwordc]])]),e("div",Ie,[o[22]||(o[22]=e("label",{for:"groupUid",class:"block text-sm font-medium text-gray-700"}," Group ",-1)),x(e("select",{id:"groupUid","onUpdate:modelValue":o[7]||(o[7]=r=>t.form.groupUid=r),class:"mt-1 block w-full rounded-md border-2 border-gray-300 bg-white px-3 py-2 text-sm text-gray-900 transition-colors duration-200 focus:border-blue-500 focus:outline-none focus:ring-2 focus:ring-blue-200 hover:border-gray-400"},[o[21]||(o[21]=e("option",{value:"",class:"text-gray-400"},"Select a group",-1)),(i(!0),l(k,null,w(t.groups,r=>(i(),l("option",{key:r.uid,value:r.uid,class:"text-gray-900"},d(r?.name),9,Pe))),128))],512),[[q,t.form.groupUid]])]),e("div",Fe,[o[26]||(o[26]=e("h4",{class:"text-md font-medium text-gray-700"},"Laboratory Access (Optional)",-1)),e("div",Te,[o[23]||(o[23]=e("label",{class:"block text-sm font-medium text-gray-700"},"Assigned Laboratories",-1)),e("div",De,[(i(!0),l(k,null,w(t.setupStore.getLaboratories,r=>(i(),l("div",{key:r.uid,class:"flex items-center space-x-3"},[x(e("input",{id:`lab-${r.uid}`,"onUpdate:modelValue":o[8]||(o[8]=a=>t.form.laboratoryUids=a),value:r.uid,type:"checkbox",class:"h-4 w-4 text-blue-600 focus:ring-blue-500 border-gray-300 rounded"},null,8,Oe),[[W,t.form.laboratoryUids]]),e("label",{for:`lab-${r.uid}`,class:"flex-1 cursor-pointer text-sm"},d(r.name)+" ("+d(r.code)+") ",9,Ge)]))),128))])]),t.form.laboratoryUids&&t.form.laboratoryUids.length>0?(i(),l("div",Ke,[o[25]||(o[25]=e("label",{class:"block text-sm font-medium text-gray-700"},"Default Active Laboratory",-1)),x(e("select",{"onUpdate:modelValue":o[9]||(o[9]=r=>t.form.activeLaboratoryUid=r),class:"mt-1 block w-full rounded-md border-2 border-gray-300 bg-white px-3 py-2 text-sm text-gray-900 transition-colors duration-200 focus:border-blue-500 focus:outline-none focus:ring-2 focus:ring-blue-200 hover:border-gray-400"},[o[24]||(o[24]=e("option",{value:""},"Select default laboratory...",-1)),(i(!0),l(k,null,w(t.form.laboratoryUids,r=>(i(),l("option",{key:r,value:r,class:"text-gray-900"},d(t.getLaboratoryName(r)),9,ze))),128))],512),[[q,t.form.activeLaboratoryUid]])])):L("",!0)]),e("div",Re,[e("label",je,[o[27]||(o[27]=e("span",{class:"text-sm font-medium text-gray-700"},"Blocked",-1)),e("button",{type:"button",role:"switch","aria-checked":t.form.isBlocked,onClick:o[10]||(o[10]=r=>t.form.isBlocked=!t.form.isBlocked),class:b(["relative inline-flex h-6 w-11 shrink-0 cursor-pointer rounded-full border-2 border-transparent transition-colors duration-200 ease-in-out focus:outline-none focus:ring-2 focus:ring-blue-500 focus:ring-offset-2 shadow-sm",[t.form.isBlocked?"bg-red-500":"bg-green-500"]])},[e("span",{"aria-hidden":"true",class:b(["pointer-events-none inline-block h-5 w-5 transform rounded-full bg-white shadow ring-0 transition duration-200 ease-in-out",[t.form.isBlocked?"translate-x-5":"translate-x-0"]])},null,2)],10,He)])]),e("div",Je,[e("label",Qe,[o[28]||(o[28]=e("span",{class:"text-sm font-medium text-gray-700"},"Active",-1)),e("button",{type:"button",role:"switch","aria-checked":t.form.isActive,onClick:o[11]||(o[11]=r=>t.form.isActive=!t.form.isActive),class:b(["relative inline-flex h-6 w-11 shrink-0 cursor-pointer rounded-full border-2 border-transparent transition-colors duration-200 ease-in-out focus:outline-none focus:ring-2 focus:ring-blue-500 focus:ring-offset-2 shadow-sm",[t.form.isActive?"bg-green-500":"bg-red-500"]])},[e("span",{"aria-hidden":"true",class:b(["pointer-events-none inline-block h-5 w-5 transform rounded-full bg-white shadow ring-0 transition duration-200 ease-in-out",[t.form.isActive?"translate-x-5":"translate-x-0"]])},null,2)],10,We)])])]),e("div",Xe,[e("button",Ye,d(t.form.userUid?"Update":"Create")+" User ",1)])],32)]),_:1},8,["title"])):L("",!0)],64)}const ot=P(me,[["render",Ze],["__scopeId","data-v-0b494f3a"],["__file","/home/aurthurm/Documents/Development/felicity/felicity-lims/webapp/views/admin/users/UsersListing.vue"]]);export{ot as default};
