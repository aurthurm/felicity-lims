import{d as _e,R as be,J as me,r as b,p as F,m as fe,o as a,c as n,b as e,G,f as u,w as f,g as A,F as c,C as y,t as d,e as p,ae as Q,ad as U,v as J,i as ge,az as W,B as R,aE as xe,k as ve}from"./index-52cc981d.js";import{u as ke}from"./analysis-b22715e2.js";import{h as S,o as V,a as E}from"./constants-1ec6e6e6.js";import"./analyses.mutations-5012548d.js";const we=e("hr",null,null,-1),Ue={class:"flex justify-end"},Ce={key:0,class:"overflow-x-auto mt-4"},Re={class:"align-middle inline-block min-w-full shadow overflow-hidden bg-white shadow-dashboard px-2 pt-1 rounded-bl-lg rounded-br-lg"},Se={class:"min-w-full"},Ve=e("th",{class:"px-1 py-1 border-b-2 border-gray-300 text-left leading-4 text-gray-800 tracking-wider"},null,-1),Ee=e("th",{class:"px-1 py-1 border-b-2 border-gray-300 text-left leading-4 text-gray-800 tracking-wider"}," Analysis ",-1),$e=e("th",{class:"px-1 py-1 border-b-2 border-gray-300"},null,-1),Ie={class:"bg-white"},Ae=e("td",{class:"px-1 py-1 whitespace-no-wrap border-b border-gray-500"},null,-1),De={class:"px-1 py-1 whitespace-no-wrap border-b border-gray-500"},Ne={class:"text-sm leading-5 text-gray-800"},Te={class:"flex items-center gap-x-4"},qe={class:"text-md font-semibold italics text-sky-800"},Le={class:"text-sm italics text-sky-400"},Be=["onUpdate:modelValue","disabled"],Pe={class:"w-3/5"},Ke={class:"flex justify-start items-center gap-x-4 px-1 py-1"},Me=e("h4",{class:"w-28"},"Instrument",-1),Qe={key:0,class:"text-sm leading-5 text-sky-800"},je={key:1,class:"mb-2 w-full"},Oe=["onUpdate:modelValue","onChange"],ze=e("option",{value:""},null,-1),Fe=["value"],Ge={class:"flex justify-start items-center gap-x-4 px-1 py-1"},Je=e("h4",{class:"w-28"},"Method",-1),We={key:0,class:"text-sm leading-5 text-sky-800"},He={key:1,class:"mb-2 w-full"},Xe=["onUpdate:modelValue","onChange"],Ye=e("option",{value:""},null,-1),Ze=["value"],et={class:"flex justify-start items-center gap-x-4 px-1 py-1"},tt=e("h4",{class:"w-28"},"Result",-1),st={key:0,class:"text-sm leading-5 text-sky-800"},ot={key:1,class:"block w-full"},at=["onUpdate:modelValue","onKeyup"],nt={key:2,class:"block col-span-2 w-full"},lt=["onUpdate:modelValue","onChange"],rt=e("option",{value:""},null,-1),it=["value"],dt={key:1,class:"overflow-x-auto"},ct={class:"align-middle inline-block min-w-full shadow overflow-hidden bg-white shadow-dashboard px-2 pt-1 rounded-bl-lg rounded-br-lg"},ut={class:"min-w-full"},yt={class:"px-1 py-1 border-b-2 border-gray-300 text-left leading-4 text-gray-800 tracking-wider"},pt=e("th",{class:"px-1 py-1 border-b-2 border-gray-300 text-left leading-4 text-gray-800 tracking-wider"},null,-1),ht=e("th",{class:"px-1 py-1 border-b-2 border-gray-300 text-left leading-4 text-gray-800 tracking-wider"},"Analysis",-1),_t=e("th",{class:"px-1 py-1 border-b-2 border-gray-300 text-left text-sm leading-4 text-gray-800 tracking-wider"},"Methods",-1),bt=e("th",{class:"px-1 py-1 border-b-2 border-gray-300 text-left text-sm leading-4 text-gray-800 tracking-wider"},"Instrument ",-1),mt=e("th",{class:"px-1 py-1 border-b-2 border-gray-300 text-left text-sm leading-4 text-gray-800 tracking-wider"},"Analyst",-1),ft=e("th",{class:"px-1 py-1 border-b-2 border-gray-300 text-left text-sm leading-4 text-gray-800 tracking-wider"},"Reviewer",-1),gt=e("th",{class:"px-1 py-1 border-b-2 border-gray-300 text-left text-sm leading-4 text-gray-800 tracking-wider"},"Interims ",-1),xt=e("th",{class:"px-1 py-1 border-b-2 border-gray-300 text-left text-sm leading-4 text-gray-800 tracking-wider"},"Result",-1),vt=e("th",{class:"px-1 py-1 border-b-2 border-gray-300 text-left text-sm leading-4 text-gray-800 tracking-wider"},"Retest",-1),kt=e("th",{class:"px-1 py-1 border-b-2 border-gray-300 text-left text-sm leading-4 text-gray-800 tracking-wider"},"Submitted",-1),wt=e("th",{class:"px-1 py-1 border-b-2 border-gray-300 text-left text-sm leading-4 text-gray-800 tracking-wider"},"Reviewed",-1),Ut=e("th",{class:"px-1 py-1 border-b-2 border-gray-300 text-left text-sm leading-4 text-gray-800 tracking-wider"},"Status",-1),Ct=e("th",{class:"px-1 py-1 border-b-2 border-gray-300"},null,-1),Rt={class:"bg-white"},St=["onUpdate:modelValue","disabled"],Vt=e("td",{class:"px-1 py-1 whitespace-no-wrap border-b border-gray-500"},null,-1),Et={class:"px-1 py-1 whitespace-no-wrap border-b border-gray-500"},$t={class:"text-sm leading-5 text-sky-800"},It={class:"italic text-sm text-gray-400"},At={class:"px-1 py-1 whitespace-no-wrap border-b border-gray-500"},Dt={key:0,class:"text-sm leading-5 text-sky-800"},Nt={key:1,class:"block col-span-2 mb-2"},Tt=["onUpdate:modelValue","onChange"],qt=e("option",{value:""},null,-1),Lt=["value"],Bt={class:"px-1 py-1 whitespace-no-wrap border-b border-gray-500"},Pt={key:0,class:"text-sm leading-5 text-sky-800"},Kt={key:1,class:"block col-span-2 mb-2"},Mt=["onUpdate:modelValue","onChange"],Qt=e("option",{value:""},null,-1),jt=["value"],Ot={class:"px-1 py-1 whitespace-no-wrap border-b border-gray-500"},zt={class:"text-sm leading-5 text-sky-800"},Ft={class:"px-1 py-1 whitespace-no-wrap border-b border-gray-500"},Gt={class:"text-sm leading-5 text-sky-800"},Jt={class:"px-1 py-1 whitespace-no-wrap border-b border-gray-500"},Wt={key:0,class:"text-sm leading-5 text-sky-800"},Ht={key:1,class:"block col-span-2 mb-2"},Xt=["onUpdate:modelValue","onChange"],Yt=e("option",{value:""},null,-1),Zt=["value"],es={class:"px-1 py-1 whitespace-no-wrap border-b border-gray-500"},ts={key:0,class:"text-sm leading-5 text-sky-800"},ss={key:1,class:"block"},os=["onUpdate:modelValue","onKeyup"],as={key:2,class:"block col-span-2 mb-2"},ns=["onUpdate:modelValue","onChange"],ls=e("option",{value:""},null,-1),rs=["value"],is={class:"px-1 py-1 whitespace-no-wrap border-b border-gray-500"},ds={class:"text-sm leading-5 text-sky-800"},cs={key:0,class:"text-sky-800"},us={key:1,class:"text-orange-600"},ys={class:"px-1 py-1 whitespace-no-wrap border-b border-gray-500"},ps={class:"text-sm leading-5 text-sky-800"},hs={class:"px-1 py-1 whitespace-no-wrap border-b border-gray-500"},_s={class:"text-sm leading-5 text-sky-800"},bs={class:"px-1 py-1 whitespace-no-wrap border-b border-gray-500"},ms={type:"button",class:"p-1 bg-sky-800 text-white rounded-sm leading-none"},fs=e("td",{class:"px-1 py-1 whitespace-no-wrap text-right border-b border-gray-500 text-sm leading-5"},null,-1),gs={class:"my-4"},xs=_e({__name:"QCSet",setup(vs){let g=be(),H=me(),I=b(!1),D=b(!1),N=b(!1),T=b(!1),q=b(!1),x=b(!1);g.fetchQCSetByUid(H.params.qcSetUid);let v=F(()=>{let l=g.getQCSet;if(!l)return;let o={levels:[],analytes:[]};return l?.samples?.forEach(i=>{i.assigned||(o.levels.some(s=>s.uid==i?.qcLevel?.uid)||o.levels.push(i?.qcLevel),i?.analysisResults?.forEach(s=>{o.analytes.some(r=>r.uid==s?.analysis?.uid)||o.analytes.push(s?.analysis);const t=o.analytes.findIndex(r=>r.uid==s?.analysis?.uid);o.analytes[t].items?o.analytes[t].items?.some(r=>r.sampleUid===s.sampleUid)||o.analytes[t].items.push({...s,sample:i}):o.analytes[t].items=[{...s,sample:i}]}))}),K("list"),{levels:o.levels,analytes:o.analytes}});function j(){let l=[];return v?.value.analytes?.forEach(o=>o.items.forEach(i=>l.push(i))),l}function X(){let l=[];return v?.value.analytes?(v?.value.analytes?.forEach(o=>{o?.items?.forEach(i=>l.push(i))}),l):[]}function L(){let l=[];return v?.value.analytes?(v?.value.analytes?.forEach(o=>{o?.items?.forEach(i=>{i.checked&&l.push(i)})}),l):[]}function $(){const l=L();let o=[];return l?.forEach(i=>o.push(i.uid)),o}function h(){I.value=!1,D.value=!1,N.value=!1,T.value=!1,q.value=!1;const l=L();l.length!==0&&(l.every(o=>o.status==="cancelled")&&(q.value=!0),l.every(o=>o.status==="pending")&&(I.value=!0),l.every(o=>o.status==="resulted")&&(D.value=!0,N.value=!0,T.value=!0))}function Y(){return X()?.every(o=>o.checked===!0)}function _(l){l.checked=!0,h()}function Z(l){l.checked=!1,h()}function ee(){j()?.forEach(o=>x.value?_(o):Z(o)),h()}function O(){Y()?x.value=!0:x.value=!1,h()}function te(l){l.editable=!0}function k(l){return l?.editable||xe(l?.result)?["cancelled","verified","retracted","to_be_verified"].includes(l.status)?(l.editable=!1,!1):(te(l),!0):!1}function z(l){switch(l?.status){case"retracted":return!0;case"verified":return l?.reportable===!1;default:return!1}}function se(){let l=L(),o=[];return l?.forEach(i=>o.push({uid:i.uid,result:i.result,laboratoryInstrumentUid:i.laboratoryInstrumentUid,methodUid:i.methodUid})),o}const C=async()=>{const l=F(()=>g.getSample);l.value&&g.fetchSampleStatus(l?.value?.uid)};let{submitResults:oe,cancelResults:ae,reInstateResults:ne,approveResults:le,retractResults:re,retestResults:ie}=ke();const de=()=>oe(se(),"qcset",g.qcSet?.uid).then(l=>(C(),h())),ce=()=>ae($()).then(l=>(C(),h())),ue=()=>ne($()).then(l=>(C(),h())),ye=()=>le($(),"qcset",g.qcSet?.uid).then(l=>(C(),h())),pe=()=>re($()).then(l=>(C(),h())),he=()=>ie($()).then(l=>(C(),h()));let m=b(!0),B=b("grid"),P=b(!1);function K(l){let o=[],i=[];g.getQCSet?.samples?.forEach(t=>{i.push(t),t.assigned||t?.analysisResults?.forEach(r=>o.push(r))});for(let t of i){const r=o.filter(M=>M.sampleUid===t.uid);let w=[];if(r?.forEach(M=>w.push(M.analysisUid)),P.value=new Set(w).size!==w.length,P.value===!0)break}P.value?(m.value=!1,B.value="list"):l==="grid"?(m.value=!0,B.value="grid"):(m.value=!1,B.value="list")}return(l,o)=>{const i=fe("font-awesome-icon");return a(),n(c,null,[we,e("div",Ue,[e("button",{class:G(["focus:outline-none",{"fill-current text-gray-900":u(m)===!0},{"fill-current text-gray-200":u(m)===!1}]),onClick:o[0]||(o[0]=f(s=>K("grid"),["prevent"]))},[A(i,{icon:"th"})],2),e("button",{class:G(["focus:outline-none ml-2",{"fill-current text-gray-900":u(m)===!1},{"fill-current text-gray-200":u(m)===!0}]),onClick:o[1]||(o[1]=f(s=>K("list"),["prevent"]))},[A(i,{icon:"th-list"})],2)]),u(m)?(a(),n("section",Ce,[e("div",Re,[e("table",Se,[e("thead",null,[e("tr",null,[Ve,Ee,(a(!0),n(c,null,y(u(v)?.levels,s=>(a(),n("th",{key:s.uid,class:"px-1 py-1 border-b-2 border-gray-300 text-left leading-4 text-gray-800 tracking-wider"},d(s?.level),1))),128)),$e])]),e("tbody",Ie,[(a(!0),n(c,null,y(u(v)?.analytes,s=>(a(),n("tr",{key:s.uid},[Ae,e("td",De,[e("div",Ne,d(s?.name),1)]),(a(!0),n(c,null,y(s?.items,t=>(a(),n("td",{key:t.uid,class:"px-1 py-1 whitespace-no-wrap border-b border-gray-500"},[e("div",Te,[e("div",null,[e("div",qe,d(t?.sample?.qcLevel?.level),1),e("div",Le,"("+d(t?.status)+")",1),p(e("input",{type:"checkbox",class:"mr-2","onUpdate:modelValue":r=>t.checked=r,onChange:o[2]||(o[2]=r=>O()),disabled:z(t)},null,40,Be),[[Q,t.checked]])]),e("div",Pe,[e("div",Ke,[Me,k(t)?(a(),n("label",je,[p(e("select",{class:"form-input mt-1 block w-full","onUpdate:modelValue":r=>t.laboratoryInstrumentUid=r,onChange:r=>_(t)},[ze,(a(!0),n(c,null,y(t.analysis?.instruments,r=>(a(),n(c,{key:r.uid},[(a(!0),n(c,null,y(r.laboratoryInstruments,w=>(a(),n("option",{key:w.uid,value:w.uid},d(w.labName)+" → ("+d(r?.name)+") ",9,Fe))),128))],64))),128))],40,Oe),[[U,t.laboratoryInstrumentUid]])])):(a(),n("div",Qe,d(t.laboratoryInstrument?.labName),1))]),e("div",Ge,[Je,k(t)?(a(),n("label",He,[p(e("select",{class:"form-input mt-1 block w-full","onUpdate:modelValue":r=>t.methodUid=r,onChange:r=>_(t)},[Ye,(a(!0),n(c,null,y(t.analysis?.methods,r=>(a(),n("option",{key:r.uid,value:r.uid},d(r.name),9,Ze))),128))],40,Xe),[[U,t.methodUid]])])):(a(),n("div",We,d(t.method?.name),1))]),e("div",et,[tt,k(t)?t?.analysis?.resultOptions?.length>0?(a(),n("label",ot,[p(e("input",{class:"form-input mt-1 block w-full","onUpdate:modelValue":r=>t.result=r,onKeyup:r=>_(t)},null,40,at),[[J,t.result]])])):(a(),n("label",nt,[p(e("select",{class:"form-input mt-1 block w-full","onUpdate:modelValue":r=>t.result=r,onChange:r=>_(t)},[rt,(a(!0),n(c,null,y(t?.analysis?.resultOptions,r=>(a(),n("option",{key:r.optionKey,value:r.value},d(r.value),9,it))),128))],40,lt),[[U,t.result]])])):(a(),n("div",st,d(t?.result),1))])])])]))),128))]))),128))])])])])):(a(),n("section",dt,[e("div",ct,[e("table",ut,[e("thead",null,[e("tr",null,[e("th",yt,[p(e("input",{type:"checkbox",onChange:o[3]||(o[3]=s=>ee()),"onUpdate:modelValue":o[4]||(o[4]=s=>ge(x)?x.value=s:x=s)},null,544),[[Q,u(x)]])]),pt,ht,_t,bt,mt,ft,gt,xt,vt,kt,wt,Ut,Ct])]),e("tbody",Rt,[(a(!0),n(c,null,y(j(),s=>(a(),n("tr",{key:s.uid},[e("td",null,[p(e("input",{type:"checkbox",class:"","onUpdate:modelValue":t=>s.checked=t,onChange:o[5]||(o[5]=t=>O()),disabled:z(s)},null,40,St),[[Q,s.checked]])]),Vt,e("td",Et,[e("div",$t,d(s.analysis?.name),1),e("div",It,"("+d(s?.sample?.qcLevel?.level)+")",1)]),e("td",At,[k(s)?(a(),n("label",Nt,[p(e("select",{class:"form-input mt-1 block w-full","onUpdate:modelValue":t=>s.laboratoryInstrumentUid=t,onChange:t=>_(s)},[qt,(a(!0),n(c,null,y(s.analysis?.instruments,t=>(a(),n(c,{key:t.uid},[(a(!0),n(c,null,y(t.laboratoryInstruments,r=>(a(),n("option",{key:r.uid,value:r.uid},d(r.labName)+" → ("+d(t?.name)+") ",9,Lt))),128))],64))),128))],40,Tt),[[U,s.laboratoryInstrumentUid]])])):(a(),n("div",Dt,d(s.laboratoryInstrument?.labName||"---"),1))]),e("td",Bt,[k(s)?(a(),n("label",Kt,[p(e("select",{class:"form-input mt-1 block w-full","onUpdate:modelValue":t=>s.methodUid=t,onChange:t=>_(s)},[Qt,(a(!0),n(c,null,y(s.analysis?.methods,t=>(a(),n("option",{key:t.uid,value:t.uid},d(t.name),9,jt))),128))],40,Mt),[[U,s.methodUid]])])):(a(),n("div",Pt,d(s.method?.name),1))]),e("td",Ot,[e("div",zt,d(`${s.submittedBy?.firstName??"--"} ${s.submittedBy?.lastName??"--"}`),1)]),e("td",Ft,[e("div",Gt,[(a(!0),n(c,null,y(s.verifiedBy,t=>(a(),n("span",{key:t.firstName,class:"ml-1"},d(`${t?.firstName??"--"} ${t?.lastName??"--"},`),1))),128))])]),e("td",Jt,[!k(s)||s?.analysis?.interims?.length===0?(a(),n("div",Wt," --- ")):(a(),n("label",Ht,[p(e("select",{class:"form-input mt-1 block w-full","onUpdate:modelValue":t=>s.result=t,onChange:t=>_(s)},[Yt,(a(!0),n(c,null,y(s?.analysis?.interims,t=>(a(),n("option",{key:t.key,value:t.value},d(t.value),9,Zt))),128))],40,Xt),[[U,s.result]])]))]),e("td",es,[k(s)?s?.analysis?.resultOptions?.length===0?(a(),n("label",ss,[p(e("input",{class:"form-input mt-1 block w-full","onUpdate:modelValue":t=>s.result=t,onKeyup:t=>_(s)},null,40,os),[[J,s.result]])])):(a(),n("label",as,[p(e("select",{class:"form-input mt-1 block w-full","onUpdate:modelValue":t=>s.result=t,onChange:t=>_(s)},[ls,(a(!0),n(c,null,y(s?.analysis?.resultOptions,t=>(a(),n("option",{key:t.optionKey,value:t.value},d(t.value),9,rs))),128))],40,ns),[[U,s.result]])])):(a(),n("div",ts,d(s?.result),1))]),e("td",is,[e("div",ds,[s?.retest?(a(),n("span",cs,[A(i,{icon:"fa-check-circle"})])):(a(),n("span",us,[A(i,{icon:"fa-times-circle"})]))])]),e("td",ys,[e("div",ps,d(u(W)(s?.dateSubmitted)),1)]),e("td",hs,[e("div",_s,d(u(W)(s?.dateVerified)),1)]),e("td",bs,[e("button",ms,d(s.status),1)]),fs]))),128))])])])])),e("section",gs,[S(E.UPDATE,V.RESULT)&&u(I)?(a(),n("button",{key:0,onClick:o[6]||(o[6]=f(s=>ce(),["prevent"])),class:"px-2 py-1 mr-2 border-sky-800 border text-sky-800 rounded-sm transition duration-300 hover:bg-sky-800 hover:text-white focus:outline-none"}," Cancel ")):R("",!0),S(E.UPDATE,V.RESULT)&&u(q)?(a(),n("button",{key:1,onClick:o[7]||(o[7]=f(s=>ue(),["prevent"])),class:"px-2 py-1 mr-2 border-sky-800 border text-sky-800 rounded-sm transition duration-300 hover:bg-sky-800 hover:text-white focus:outline-none"}," Re-Instate ")):R("",!0),S(E.UPDATE,V.RESULT)&&u(I)?(a(),n("button",{key:2,onClick:o[8]||(o[8]=f(s=>de(),["prevent"])),class:"px-2 py-1 mr-2 border-sky-800 border text-sky-800 rounded-sm transition duration-300 hover:bg-sky-800 hover:text-white focus:outline-none"}," Submit ")):R("",!0),S(E.UPDATE,V.RESULT)&&u(D)?(a(),n("button",{key:3,onClick:o[9]||(o[9]=f(s=>pe(),["prevent"])),class:"px-2 py-1 mr-2 border-sky-800 border text-sky-800 rounded-sm transition duration-300 hover:bg-sky-800 hover:text-white focus:outline-none"}," Retract ")):R("",!0),S(E.UPDATE,V.RESULT)&&u(N)?(a(),n("button",{key:4,onClick:o[10]||(o[10]=f(s=>ye(),["prevent"])),class:"px-2 py-1 mr-2 border-sky-800 border text-sky-800 rounded-sm transition duration-300 hover:bg-sky-800 hover:text-white focus:outline-none"}," Verify ")):R("",!0),S(E.UPDATE,V.RESULT)&&u(T)?(a(),n("button",{key:5,onClick:o[11]||(o[11]=f(s=>he(),["prevent"])),class:"px-2 py-1 mr-2 border-sky-800 border text-sky-800 rounded-sm transition duration-300 hover:bg-sky-800 hover:text-white focus:outline-none"}," Retest ")):R("",!0)])],64)}}}),Rs=ve(xs,[["__file","/home/aurthurm/Documents/Development/felicity/felicity-lims/webapp/views/qcontrol/_id/QCSet.vue"]]);export{Rs as default};
