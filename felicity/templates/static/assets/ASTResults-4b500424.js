import{d as ye,R as _e,I as he,p as ve,r,q as fe,P as xe,o as u,c as d,F as i,C as c,b as a,t as m,A as x,e as p,L as S,ad as E,v as q,G as be,ae as Re,g as Y,z as b,w,f as C,y as Ae,B,j as z,_ as Q,S as ge,k as Ue}from"./index-52cc981d.js";import{u as Se}from"./analysis-b22715e2.js";import{h as k,o as F,a as G}from"./constants-1ec6e6e6.js";import{a9 as we,ad as Ce,ae as Ve,Y as Te,af as Pe,ag as Me,ah as je}from"./microbiology.mutations-5efa76ee.js";import"./analyses.mutations-5012548d.js";const De=a("h3",{class:"flex justify-between items-center"},[a("span",{class:"font-bold"},"AST Panel")],-1),Ee=a("hr",{class:"mt-1"},null,-1),Ye={class:"flex justify-between items-center"},Be={class:"font-bold"},ke={class:"italic"},Fe=["onClick"],Ge={class:"overflow-x-auto"},Le={class:"min-w-full divide-y divide-gray-200"},Ie={class:"bg-gray-50"},Ne=a("th",{class:"px-4 py-2 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"},"Parameter",-1),$e={class:"bg-white divide-y divide-gray-200"},qe=a("td",{class:"px-4 py-2 text-sm font-medium text-gray-900"},"Guideline",-1),ze=["onUpdate:modelValue","onChange","disabled"],Qe=["value"],We=a("td",{class:"px-4 py-2 text-sm font-medium text-gray-900"},"AST Method",-1),He=["onUpdate:modelValue","onChange","disabled"],Je=["value"],Ke=a("td",{class:"px-4 py-2 text-sm font-medium text-gray-900"},"AST Value",-1),Xe=["onUpdate:modelValue","onChange","disabled"],Ze={class:"ml-2 text-xs text-gray-400"},Oe=a("td",{class:"px-4 py-2 text-sm font-medium text-gray-900"},"Result",-1),et=["onUpdate:modelValue","onChange","disabled"],tt=a("option",{value:"S"},"S",-1),st=a("option",{value:"I"},"I",-1),lt=a("option",{value:"R"},"R",-1),at=[tt,st,lt],nt=a("td",{class:"px-4 py-2 text-sm font-medium text-gray-900"},"Reportable",-1),ot=["onUpdate:modelValue","onChange","disabled"],ut={class:"mt-2"},dt={class:"italic font-semibold"},it={class:"w-full"},rt={class:"block mb-4"},ct={class:"border p-2 h-64 overflow-y-auto"},pt={class:"w-full"},mt={class:"px-1 py-1 whitespace-no-wrap border-b border-gray-500"},yt={class:"text-sm leading-5 text-gray-800 font-bold"},_t={class:"px-1 py-1 whitespace-no-wrap border-b border-gray-500"},ht={class:"text-sm leading-5 text-gray-800"},vt={class:"px-1 py-1 whitespace-no-wrap text-right border-b border-gray-500 text-sm leading-5"},ft=["onClick"],xt={key:0},bt=a("td",{colspan:"3",class:"px-4 py-3 text-center text-sm text-gray-500"}," Loading panels... ",-1),Rt=[bt],At={key:1},gt=a("td",{colspan:"3",class:"px-4 py-3 text-center text-sm text-gray-500"}," No panels found ",-1),Ut=[gt],St=ye({__name:"ASTResults",props:{sample:{type:Object,required:!0},astAnalysisResults:{type:Object,required:!0},organismAnalysisResults:{type:Object,required:!0}},setup(W){const H=z(()=>Q(()=>import("./FelModal-2b9d991a.js"),["assets/FelModal-2b9d991a.js","assets/index-52cc981d.js","assets/index-8ef91573.css","assets/FelModal-780aeea9.css"])),V=z(()=>Q(()=>import("./FelButton-77125fa9.js"),["assets/FelButton-77125fa9.js","assets/index-52cc981d.js","assets/index-8ef91573.css"])),{sample:y,astAnalysisResults:J,organismAnalysisResults:K}=W,R=_e(),{withClientMutation:L,withClientQuery:h}=he(),X=ve(()=>K[0]),T=r([]),A=r([]),I=r([]),N=r([]);fe(()=>{h(we,{analysisResultUid:X.value.uid},"abxOrganismResultAll").then(l=>{l&&(A.value=l||[])}).finally(()=>j()),h(Ce,{sampleUid:y.uid},"abxAstResultAll").then(l=>{l&&(T.value=l||[])}).finally(()=>j()),h(Ve,{},"abxGuidelineYearAll").then(l=>{l&&(I.value=l||[])}),h(Te,{},"abxTestMethodAll").then(l=>{l&&(N.value=l||[])})});const g=r(!1),U=r(!1),P=r(""),M=r([]),v=r();function Z(l){v.value=l,g.value=!0}function O(l){const n=o.value[l.uid];return Object.values(n).every(t=>t.analResulState=="pending")}function ee(){U.value=!0,h(Pe,{organismUid:v.value?.uid,text:P.value},"abxAstPanelFilter").then(l=>{l&&(M.value=l||[])}).finally(()=>{U.value=!1})}function te(l){g.value=!1,ge.fire({title:"Are you sure?",text:"You want to apply panel: "+l.name+" to organism: "+v.value?.organism?.name,icon:"warning",showCancelButton:!0,confirmButtonColor:"#3085d6",cancelButtonColor:"#d33",confirmButtonText:"Yes, apply now!",cancelButtonText:"No, do not apply!"}).then(async n=>{n.isConfirmed&&L(Me,{payload:{organismResultUid:v.value?.uid,panelUid:l.uid,sampleUid:y.uid}},"applyAbxAstPanel").then(t=>{t&&R.fetchAnalysisResultsForSample(y.uid)})})}const o=r({});function j(){const l={};A.value.forEach(n=>{l[n.uid]={},T.value.filter(e=>e.organismResultUid===n.uid).forEach(e=>{const s=J.find(D=>D.uid===e.analysisResultUid);e.antibiotic?.name&&s?.uid&&(l[n.uid][e.antibiotic.name+" "+e.antibiotic.potency]={uid:e.uid,analResultUid:s.uid,analResulState:s.status,astMethodUid:e.astMethodUid,guidelineYearUid:e.guidelineYearUid,breakpointUid:e.breakpointUid,astValue:e.astValue,result:s.result,reportable:s.reportable,dirty:!1})})}),o.value=l}xe([A,T],()=>{j()});const _=l=>Object.keys(o.value[l]||{});let{submitResults:se,approveResults:le}=Se();function ae(l){const n=o.value[l],t=Object.values(n).some(s=>s.dirty&&s.analResulState=="pending"),e=Object.values(n).some(s=>s.guidelineYearUid&&s.astMethodUid&&s.astValue);return t&&e}function ne(l){const n=o.value[l];return Object.values(n).filter(s=>s.dirty&&s.analResulState=="pending").filter(s=>s.guidelineYearUid&&s.astMethodUid&&s.astValue).map(({dirty:s,breakpointUid:D,analResultUid:$,analResulState:wt,...me})=>me)}function oe(l){const n=ne(l);L(je,{payload:{results:n}},"updateAbxAstResults").then(t=>{t&&R.fetchAnalysisResultsForSample(y.uid)})}function ue(l){const n=o.value[l],t=Object.values(n).some(s=>s.dirty),e=Object.values(n).some(s=>s.guidelineYearUid&&s.astMethodUid&&s.astValue&&s.result&&s.analResulState=="pending");return!t&&e}function de(l){const n=o.value[l];return Object.values(n).filter(s=>!s.dirty).filter(s=>s.guidelineYearUid&&s.astMethodUid&&s.astValue&&s.result&&s.analResulState=="pending").map(({dirty:s,breakpointUid:D,...$})=>$)}function ie(l){const t=de(l).map(e=>({uid:e.analResultUid,result:e.result,reportable:e.reportable,methodUid:"felicity_ast",laboratoryInstrumentUid:"felicity_ast"}));se(t,"sample",y?.uid).then(()=>{R.fetchAnalysisResultsForSample(y.uid)})}function re(l){const n=o.value[l],t=Object.values(n).some(s=>s.dirty),e=Object.values(n).some(s=>s.analResulState=="resulted");return!t&&e}function ce(l){const n=o.value[l];return Object.values(n).filter(e=>!e.dirty).filter(e=>e.analResulState=="resulted")}function pe(l){const t=ce(l).map(e=>e.analResultUid);le(t,"sample",y?.uid).then(()=>{R.fetchAnalysisResultsForSample(y.uid)})}async function f(l,n,t,e){o.value[l][n],o.value[l][n].dirty=!0,o.value[l][n]={...o.value[l][n],[t]:e}}return(l,n)=>(u(),d(i,null,[De,Ee,(u(!0),d(i,null,c(A.value,t=>(u(),d("div",{key:t.uid,class:"mb-4"},[a("h3",Ye,[a("span",null,[a("span",Be,"Organism #"+m(t?.isolateNumber),1),x(": "),a("span",ke,m(t?.organism?.name),1)]),p(a("button",{onClick:e=>Z(t),class:"ml-2 px-2 py-1 border-sky-800 border text-sky-800 rounded-sm transition duration-300 hover:bg-sky-800 hover:text-white focus:outline-none"}," choose panel ",8,Fe),[[S,O(t)]])]),a("div",Ge,[a("table",Le,[a("thead",null,[a("tr",Ie,[Ne,(u(!0),d(i,null,c(_(t.uid),e=>(u(),d("th",{key:e,class:"px-4 py-2 text-left text-xs font-medium text-gray-500 tracking-wider"},m(e),1))),128))])]),a("tbody",$e,[a("tr",null,[qe,(u(!0),d(i,null,c(_(t.uid),e=>(u(),d("td",{key:e,class:"px-4 py-2 text-sm text-gray-500"},[p(a("select",{"onUpdate:modelValue":s=>o.value[t.uid][e].guidelineYearUid=s,onChange:s=>f(t.uid,e,"guidelineYearUid",s.target.value),class:"w-32 px-2 py-1 border rounded",disabled:o.value[t.uid][e].analResulState!=="pending"},[(u(!0),d(i,null,c(I.value,s=>(u(),d("option",{key:s.uid,value:s.uid},m(s.code),9,Qe))),128))],40,ze),[[E,o.value[t.uid][e].guidelineYearUid]])]))),128))]),a("tr",null,[We,(u(!0),d(i,null,c(_(t.uid),e=>(u(),d("td",{key:e,class:"px-4 py-2 text-sm text-gray-500"},[p(a("select",{"onUpdate:modelValue":s=>o.value[t.uid][e].astMethodUid=s,onChange:s=>f(t.uid,e,"astMethodUid",s.target.value),class:"w-32 px-2 py-1 border rounded",disabled:o.value[t.uid][e].analResulState!=="pending"},[(u(!0),d(i,null,c(N.value,s=>(u(),d("option",{key:s.uid,value:s.uid},m(s.name),9,Je))),128))],40,He),[[E,o.value[t.uid][e].astMethodUid]])]))),128))]),a("tr",null,[Ke,(u(!0),d(i,null,c(_(t.uid),e=>(u(),d("td",{key:e,class:"px-4 py-2 text-sm text-gray-500"},[p(a("input",{type:"number","onUpdate:modelValue":s=>o.value[t.uid][e].astValue=s,onChange:s=>f(t.uid,e,"astValue",s.target.value),class:"w-32 px-2 py-1 border rounded",step:"0.1",disabled:o.value[t.uid][e].analResulState!=="pending"},null,40,Xe),[[q,o.value[t.uid][e].astValue]]),a("span",Ze,m(o.value[t.uid][e].astValue==="mic"?"mg/L":"mm"),1)]))),128))]),a("tr",null,[Oe,(u(!0),d(i,null,c(_(t.uid),e=>(u(),d("td",{key:e,class:"px-4 py-2 text-sm"},[p(a("select",{"onUpdate:modelValue":s=>o.value[t.uid][e].result=s,onChange:s=>f(t.uid,e,"result",s.target.value),class:be(["w-32 px-2 py-1 border rounded",{"text-green-600":o.value[t.uid][e].result?.toUpperCase()==="S","text-yellow-600":o.value[t.uid][e].result?.toUpperCase()==="I","text-red-600":o.value[t.uid][e].result?.toUpperCase()==="R"}]),disabled:o.value[t.uid][e].analResulState!=="pending"},[...at],42,et),[[E,o.value[t.uid][e].result]])]))),128))]),a("tr",null,[nt,(u(!0),d(i,null,c(_(t.uid),e=>(u(),d("td",{key:e,class:"px-4 py-2 text-sm"},[p(a("input",{type:"checkbox","onUpdate:modelValue":s=>o.value[t.uid][e].reportable=s,onChange:s=>f(t.uid,e,"reportable",s.target.checked),class:"form-checkbox h-4 w-4 text-sky-600",disabled:o.value[t.uid][e].analResulState!=="pending"},null,40,ot),[[Re,o.value[t.uid][e].reportable]])]))),128))])])]),a("div",ut,[p(Y(C(V),{key:"button",onClick:w(e=>oe(t.uid),["prevent"]),color:"orange-600"},{default:b(()=>[x("Save Antibiotics")]),_:2},1032,["onClick"]),[[S,k(G.UPDATE,F.RESULT)&&ae(t.uid)]]),p(Y(C(V),{key:"button",onClick:w(e=>ie(t.uid),["prevent"]),color:"orange-600"},{default:b(()=>[x("Submit Antibiotics")]),_:2},1032,["onClick"]),[[S,k(G.UPDATE,F.RESULT)&&ue(t.uid)]]),p(Y(C(V),{key:"button",onClick:w(e=>pe(t.uid),["prevent"]),color:"orange-600"},{default:b(()=>[x("Approve Antibiotics")]),_:2},1032,["onClick"]),[[S,k(G.UPDATE,F.RESULT)&&re(t.uid)]])])])]))),128)),g.value?(u(),Ae(C(H),{key:0,onClose:n[1]||(n[1]=t=>g.value=!1),contentWidth:"w-1/2"},{header:b(()=>[a("h3",null,[x("Search Panel for "),a("span",dt,m(v.value?.organism?.name),1)])]),body:b(()=>[a("form",{class:"",onSubmit:w(t=>({}),["prevent"])},[a("div",it,[a("label",rt,[p(a("input",{"onUpdate:modelValue":n[0]||(n[0]=t=>P.value=t),onInput:ee,class:"form-input mt-1 block w-full",placeholder:"Begin typing..."},null,544),[[q,P.value]])]),a("div",ct,[a("table",pt,[(u(!0),d(i,null,c(M.value,t=>(u(),d("tr",{key:t.uid},[a("td",mt,[a("div",yt,m(t.name),1)]),a("td",_t,[a("div",ht,m(t.antibiotics?.map(e=>e.name)?.join(", ")),1)]),a("td",vt,[a("button",{type:"button",onClick:e=>te(t),class:"px-2 py-1 border-sky-800 border text-sky-800 rounded-sm transition duration-300 hover:bg-sky-800 hover:text-white focus:outline-none"}," Appy Panel ",8,ft)])]))),128)),U.value?(u(),d("tr",xt,[...Rt])):B("",!0),!U.value&&M.value.length===0?(u(),d("tr",At,[...Ut])):B("",!0)])])])],32)]),_:1})):B("",!0)],64))}}),jt=Ue(St,[["__file","/home/aurthurm/Documents/Development/felicity/felicity-lims/webapp/views/sample/_id/results/ASTResults.vue"]]);export{jt as default};
