import{Y as V,a0 as C,a7 as _,aQ as A,ah as I,an as w,a3 as O,_ as H,c as d,o as i,z as l,a as o,C as Y,F as c,H as m,K as s,M as u,I as n,A as L,N as p}from"./index-OdhKCqIc.js";import{k as q}from"./billing.queries-CxKPIhZs.js";import{C as U,a as j}from"./CardContent-Ds7WIX9a.js";import{S as E,C as N,a as Q}from"./CardTitle-DfVaHrEr.js";import{I as W}from"./Input-BEm5S0CJ.js";import{L as G}from"./Label-CS46LzLb.js";import{T as K,a as J,b as X}from"./TooltipTrigger-BWIYwmnQ.js";import"./PopperContent-BfyCnGUj.js";const Z=V({__name:"BillingOverview",setup(M,{expose:r}){r();const k=C(null),e=C("this-month"),v=C(""),f=C(""),a=[{id:"this-month",label:"This Month"},{id:"last-month",label:"Last Month"},{id:"this-quarter",label:"This Quarter"},{id:"this-year",label:"This Year"},{id:"all-time",label:"All Time"},{id:"custom",label:"Custom Range"}],x=_(()=>{if(e.value==="custom"){const y=v.value?new Date(v.value):null,F=f.value?new Date(f.value):null;return{startDate:y,endDate:F}}const t=new Date;let g,b=new Date(t);switch(e.value){case"this-month":g=new Date(t.getFullYear(),t.getMonth(),1),b=new Date(t.getFullYear(),t.getMonth()+1,0);break;case"last-month":g=new Date(t.getFullYear(),t.getMonth()-1,1),b=new Date(t.getFullYear(),t.getMonth(),0);break;case"this-quarter":{const y=Math.floor(t.getMonth()/3);g=new Date(t.getFullYear(),y*3,1),b=new Date(t.getFullYear(),(y+1)*3,0);break}case"this-year":g=new Date(t.getFullYear(),0,1),b=new Date(t.getFullYear(),11,31);break;default:return{startDate:null,endDate:null}}return{startDate:g,endDate:b}}),B=_(()=>[{key:"totalCharged",label:"Total Charged",borderClass:"border-l-primary",valueClass:"text-foreground",tooltip:"Sum of all amounts billed to customers across all bills",formatter:t=>`$${(t?.keyMetrics?.totalCharged??0).toFixed(2)}`},{key:"totalPaid",label:"Total Paid",borderClass:"border-l-emerald-500",valueClass:"text-emerald-600 dark:text-emerald-400",tooltip:"Total amount received from customers in successful transactions",formatter:t=>`$${(t?.keyMetrics?.totalPaid??0).toFixed(2)}`},{key:"outstandingBalance",label:"Outstanding Balance",borderClass:"border-l-amber-500",valueClass:"text-amber-600 dark:text-amber-400",tooltip:"Amount still owed by customers (Total Charged - Total Paid)",formatter:t=>`$${(t?.keyMetrics?.outstandingBalance??0).toFixed(2)}`},{key:"collectionRate",label:"Collection Rate",borderClass:"border-l-violet-500",valueClass:"text-violet-600 dark:text-violet-400",tooltip:"Percentage of billed amounts that have been paid (Total Paid / Total Charged)",formatter:t=>`${(t?.keyMetrics?.collectionRate??0).toFixed(1)}%`}]),z=[{key:"activeBills",label:"Active Bills",tooltip:"Bills currently in use and being processed",valueClass:"text-primary",value:t=>t?.volumeMetrics?.activeBills??0},{key:"inactiveBills",label:"Inactive Bills",tooltip:"Bills that have been deactivated or archived",valueClass:"text-muted-foreground",value:t=>t?.volumeMetrics?.inactiveBills??0},{key:"pendingConfirmation",label:"Pending Confirmation",tooltip:"Bills awaiting confirmation before final processing",valueClass:"text-orange-600 dark:text-orange-400",value:t=>t?.volumeMetrics?.pendingConfirmation??0},{key:"partialBills",label:"Partial Bills",tooltip:"Bills with partial payments or incomplete transactions",valueClass:"text-destructive",value:t=>t?.volumeMetrics?.partialBills??0},{key:"completeBills",label:"Complete Bills",tooltip:"Bills that are fully processed and not partial",valueClass:"text-emerald-600 dark:text-emerald-400",value:t=>t?.volumeMetrics?.completeBills??0}],R=[{key:"successful",label:"Successful",tooltip:"Payment transactions that completed successfully",valueClass:"text-emerald-600 dark:text-emerald-400",value:t=>t?.transactionMetrics?.successfulTransactions??0},{key:"failed",label:"Failed",tooltip:"Transactions that failed to process successfully",valueClass:"text-destructive",value:t=>t?.transactionMetrics?.failedTransactions??0},{key:"pending",label:"Pending",tooltip:"Transactions waiting to be processed",valueClass:"text-orange-600 dark:text-orange-400",value:t=>t?.transactionMetrics?.pendingTransactions??0},{key:"totalAmount",label:"Total Amount",tooltip:"Sum of all successful transaction amounts",valueClass:"text-primary",value:t=>`$${(t?.transactionMetrics?.totalTransactionAmount??0).toFixed(2)}`}],S=[{key:"totalDiscountAmount",label:"Total Discount Amount",tooltip:"Sum of all active discount amounts from analysis and profile discounts",valueClass:"text-primary",value:t=>`$${(t?.discountMetrics?.totalDiscountAmount??0).toFixed(2)}`},{key:"activeVouchers",label:"Active Vouchers",tooltip:"Vouchers that still have usage limit remaining or unlimited usage",valueClass:"text-emerald-600 dark:text-emerald-400",value:t=>t?.discountMetrics?.activeVouchers??0},{key:"totalVouchers",label:"Total Vouchers",tooltip:"Total number of vouchers created in the system",valueClass:"text-violet-600 dark:text-violet-400",value:t=>t?.discountMetrics?.totalVouchers??0},{key:"voucherRedemptionRate",label:"Redemption Rate",tooltip:"Percentage of voucher usage limit that has been redeemed",valueClass:"text-orange-600 dark:text-orange-400",value:t=>`${(t?.discountMetrics?.voucherRedemptionRate??0).toFixed(1)}%`},{key:"vouchersWithAvailableUsage",label:"Available Usage",tooltip:"Count of vouchers with remaining usage availability",valueClass:"text-primary",value:t=>t?.discountMetrics?.vouchersWithAvailableUsage??0}],{data:D,fetching:P,executeQuery:h}=A({query:q,variables:_(()=>e.value==="all-time"?{startDate:null,endDate:null}:{startDate:x.value.startDate?.toISOString(),endDate:x.value.endDate?.toISOString()})});I(()=>{h({requestPolicy:"network-only"})}),w(()=>e.value,()=>{h({requestPolicy:"network-only"})}),w(()=>D.value?.billingOverviewMetrics,t=>{t&&(k.value=t)},{deep:!0});const T={metricsData:k,selectedPeriod:e,customStartDate:v,customEndDate:f,periodOptions:a,dateRange:x,keyMetrics:B,volumeRows:z,transactionRows:R,discountRows:S,data:D,fetching:P,executeQuery:h,formatDate:t=>t?t.toLocaleDateString("en-US",{year:"numeric",month:"short",day:"numeric"}):"",selectPeriod:t=>{e.value=t},applyCustomRange:()=>{v.value&&f.value&&h({requestPolicy:"network-only"})},get Card(){return j},get CardContent(){return U},get CardHeader(){return Q},get CardTitle(){return N},get Button(){return O},get Input(){return W},get Label(){return G},get Skeleton(){return E},get Tooltip(){return X},get TooltipContent(){return J},get TooltipTrigger(){return K}};return Object.defineProperty(T,"__isScriptSetup",{enumerable:!1,value:!0}),T}}),$={class:"space-y-4"},ee={class:"flex flex-col gap-2"},te={class:"flex flex-wrap gap-2"},ae={key:0,class:"flex flex-col gap-4 border-t border-border pt-4 sm:flex-row"},le={class:"flex-1 space-y-2"},oe={class:"flex-1 space-y-2"},se={class:"text-xs text-muted-foreground"},re={key:0,class:"grid grid-cols-1 gap-4 md:grid-cols-4"},ne={key:1,class:"grid grid-cols-1 gap-4 md:grid-cols-4"},ie={class:"flex items-center justify-between gap-2"},de={class:"text-sm font-medium text-muted-foreground"},ue={class:"grid grid-cols-1 gap-4 lg:grid-cols-2"},ce={class:"space-y-3"},me={class:"flex items-center gap-2"},ve={class:"text-sm text-muted-foreground"},fe={class:"space-y-3"},ge={class:"flex items-center gap-2"},be={class:"text-sm text-muted-foreground"},pe={class:"grid grid-cols-1 gap-4 md:grid-cols-5"},xe={class:"flex items-center gap-1.5"},he={class:"text-sm text-muted-foreground"};function ye(M,r,k,e,v,f){return i(),d("div",$,[l("div",ee,[l("div",te,[(i(),d(c,null,m(e.periodOptions,a=>o(e.Button,{key:a.id,variant:e.selectedPeriod===a.id?"default":"outline",size:"sm",onClick:x=>e.selectPeriod(a.id)},{default:s(()=>[u(n(a.label),1)]),_:2},1032,["variant","onClick"])),64))]),e.selectedPeriod==="custom"?(i(),d("div",ae,[l("div",le,[o(e.Label,{for:"custom-start"},{default:s(()=>[...r[2]||(r[2]=[u("Start Date",-1)])]),_:1}),o(e.Input,{id:"custom-start",modelValue:e.customStartDate,"onUpdate:modelValue":r[0]||(r[0]=a=>e.customStartDate=a),type:"date",onChange:e.applyCustomRange},null,8,["modelValue"])]),l("div",oe,[o(e.Label,{for:"custom-end"},{default:s(()=>[...r[3]||(r[3]=[u("End Date",-1)])]),_:1}),o(e.Input,{id:"custom-end",modelValue:e.customEndDate,"onUpdate:modelValue":r[1]||(r[1]=a=>e.customEndDate=a),type:"date",onChange:e.applyCustomRange},null,8,["modelValue"])])])):Y("",!0),l("p",se,[e.selectedPeriod==="all-time"?(i(),d(c,{key:0},[u("Showing metrics for all time")],64)):(i(),d(c,{key:1},[u("From "+n(e.formatDate(e.dateRange.startDate))+" to "+n(e.formatDate(e.dateRange.endDate)),1)],64))])]),r[11]||(r[11]=l("hr",{class:"border-border"},null,-1)),e.fetching?(i(),d("div",re,[(i(),d(c,null,m(4,a=>o(e.Card,{key:a,class:"p-4"},{default:s(()=>[o(e.Skeleton,{class:"mb-2 h-4 w-3/4"}),o(e.Skeleton,{class:"h-8 w-1/2"})]),_:1})),64))])):(i(),d("div",ne,[(i(!0),d(c,null,m(e.keyMetrics,a=>(i(),L(e.Card,{key:a.key,class:p(["border-l-4 p-4",a.borderClass])},{default:s(()=>[l("div",ie,[l("span",de,n(a.label),1),o(e.Tooltip,null,{default:s(()=>[o(e.TooltipTrigger,{"as-child":""},{default:s(()=>[...r[4]||(r[4]=[l("button",{type:"button",class:"inline-flex size-4 shrink-0 items-center justify-center rounded-full text-muted-foreground hover:text-foreground focus:outline-none focus-visible:ring-2 focus-visible:ring-ring","aria-label":"Info"},[l("svg",{class:"size-4",fill:"currentColor",viewBox:"0 0 20 20","aria-hidden":"true"},[l("path",{"fill-rule":"evenodd",d:"M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7-4a1 1 0 11-2 0 1 1 0 012 0zM9 9a1 1 0 000 2v3a1 1 0 001 1h1a1 1 0 100-2v-3a1 1 0 00-1-1H9z","clip-rule":"evenodd"})])],-1)])]),_:1}),o(e.TooltipContent,{side:"top",class:"max-w-[14rem]"},{default:s(()=>[u(n(a.tooltip),1)]),_:2},1024)]),_:2},1024)]),l("p",{class:p(["mt-1 text-2xl font-bold tabular-nums",a.valueClass])},n(a.formatter(e.metricsData)),3)]),_:2},1032,["class"]))),128))])),l("div",ue,[o(e.Card,null,{default:s(()=>[o(e.CardHeader,null,{default:s(()=>[o(e.CardTitle,{class:"text-base"},{default:s(()=>[...r[5]||(r[5]=[u("Bill Volume",-1)])]),_:1})]),_:1}),o(e.CardContent,null,{default:s(()=>[l("div",ce,[(i(),d(c,null,m(e.volumeRows,a=>l("div",{key:a.key,class:"flex items-center justify-between rounded-lg bg-muted/50 px-3 py-2"},[l("div",me,[l("span",ve,n(a.label),1),o(e.Tooltip,null,{default:s(()=>[o(e.TooltipTrigger,{"as-child":""},{default:s(()=>[...r[6]||(r[6]=[l("button",{type:"button",class:"inline-flex size-3.5 shrink-0 text-muted-foreground hover:text-foreground focus:outline-none","aria-label":"Info"},[l("svg",{class:"size-3.5",fill:"currentColor",viewBox:"0 0 20 20"},[l("path",{"fill-rule":"evenodd",d:"M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7-4a1 1 0 11-2 0 1 1 0 012 0zM9 9a1 1 0 000 2v3a1 1 0 001 1h1a1 1 0 100-2v-3a1 1 0 00-1-1H9z","clip-rule":"evenodd"})])],-1)])]),_:1}),o(e.TooltipContent,{side:"top",class:"max-w-[14rem]"},{default:s(()=>[u(n(a.tooltip),1)]),_:2},1024)]),_:2},1024)]),l("span",{class:p(["text-sm font-semibold tabular-nums",a.valueClass])},n(a.value(e.metricsData)),3)])),64))])]),_:1})]),_:1}),o(e.Card,null,{default:s(()=>[o(e.CardHeader,null,{default:s(()=>[o(e.CardTitle,{class:"text-base"},{default:s(()=>[...r[7]||(r[7]=[u("Transactions",-1)])]),_:1})]),_:1}),o(e.CardContent,null,{default:s(()=>[l("div",fe,[(i(),d(c,null,m(e.transactionRows,a=>l("div",{key:a.key,class:"flex items-center justify-between rounded-lg bg-muted/50 px-3 py-2"},[l("div",ge,[l("span",be,n(a.label),1),o(e.Tooltip,null,{default:s(()=>[o(e.TooltipTrigger,{"as-child":""},{default:s(()=>[...r[8]||(r[8]=[l("button",{type:"button",class:"inline-flex size-3.5 shrink-0 text-muted-foreground hover:text-foreground focus:outline-none","aria-label":"Info"},[l("svg",{class:"size-3.5",fill:"currentColor",viewBox:"0 0 20 20"},[l("path",{"fill-rule":"evenodd",d:"M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7-4a1 1 0 11-2 0 1 1 0 012 0zM9 9a1 1 0 000 2v3a1 1 0 001 1h1a1 1 0 100-2v-3a1 1 0 00-1-1H9z","clip-rule":"evenodd"})])],-1)])]),_:1}),o(e.TooltipContent,{side:"top",class:"max-w-[14rem]"},{default:s(()=>[u(n(a.tooltip),1)]),_:2},1024)]),_:2},1024)]),l("span",{class:p(["text-sm font-semibold tabular-nums",a.valueClass])},n(a.value(e.metricsData)),3)])),64))])]),_:1})]),_:1})]),o(e.Card,null,{default:s(()=>[o(e.CardHeader,null,{default:s(()=>[o(e.CardTitle,{class:"text-base"},{default:s(()=>[...r[9]||(r[9]=[u("Discounts & Vouchers",-1)])]),_:1})]),_:1}),o(e.CardContent,null,{default:s(()=>[l("div",pe,[(i(),d(c,null,m(e.discountRows,a=>l("div",{key:a.key,class:"rounded-lg bg-muted/50 p-3"},[l("div",xe,[l("span",he,n(a.label),1),o(e.Tooltip,null,{default:s(()=>[o(e.TooltipTrigger,{"as-child":""},{default:s(()=>[...r[10]||(r[10]=[l("button",{type:"button",class:"inline-flex size-3.5 shrink-0 text-muted-foreground hover:text-foreground focus:outline-none","aria-label":"Info"},[l("svg",{class:"size-3.5",fill:"currentColor",viewBox:"0 0 20 20"},[l("path",{"fill-rule":"evenodd",d:"M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7-4a1 1 0 11-2 0 1 1 0 012 0zM9 9a1 1 0 000 2v3a1 1 0 001 1h1a1 1 0 100-2v-3a1 1 0 00-1-1H9z","clip-rule":"evenodd"})])],-1)])]),_:1}),o(e.TooltipContent,{side:"top",class:"max-w-[14rem]"},{default:s(()=>[u(n(a.tooltip),1)]),_:2},1024)]),_:2},1024)]),l("p",{class:p(["mt-1 text-lg font-bold tabular-nums",a.valueClass])},n(a.value(e.metricsData)),3)])),64))])]),_:1})]),_:1})])}const Pe=H(Z,[["render",ye],["__file","/home/administrator/Documents/Development/beak-insights/felicity/felicity-lims/webapp/views/billing/BillingOverview.vue"]]);export{Pe as default};
