import{Y as Q,u as W,aw as X,an as F,a0 as B,a3 as Z,_ as $,r as ee,c as _,o as g,z as i,B as M,a as l,K as t,M as s,a4 as v,aK as L,aL as k,F as h,H as V,A as P,I,D as le,E as te}from"./index-OdhKCqIc.js";import{c as N,d as C,u as O,f as ae,a as p,F as ne}from"./index.esm-BfHj8iGm.js";import{E as re,a as oe,b as ie,c as ue}from"./billing.mutations-BKsnFCTJ.js";import{u as se}from"./billing-COaJ61t1.js";import{I as de}from"./Input-BEm5S0CJ.js";import{F as ce,a as me,b as fe}from"./FormMessage-CgXFMXx9.js";import{F as ge}from"./FormLabel-DxP9wnWS.js";import{S as ve,a as Fe,b as pe,c as _e,d as ye}from"./SelectValue-Ds0cfAgl.js";import"./billing.queries-CxKPIhZs.js";import"./Label-CS46LzLb.js";import"./useNonce-B4v0IDPb.js";import"./chevron-down-Dqf-ptA3.js";import"./useFocusGuards-Bjb6OG0k.js";import"./PopperContent-BfyCnGUj.js";const R="__none__",Se=Q({name:"BillingView",__name:"Billing",props:{target:{type:String,required:!0},targetUid:{type:String,required:!0}},setup(T,{expose:a}){a();const o=se(),{withClientMutation:e}=W(),y=T,{target:c,targetUid:f}=X(y),n=()=>{o.clear(),c?.value==="profile"&&(o.fetchProfilePrice(f.value),o.fetchProfileDiscount(f.value)),c?.value==="analysis"&&(o.fetchAnalysisPrice(f.value),o.fetchAnalysisDiscount(f.value)),o.fetchVouchers()};n(),F(()=>c.value,(r,m)=>n()),F(()=>f.value,(r,m)=>n());const d=N({amount:C().min(0,"Amount must be 0 or greater").required("Amount is required")}),{handleSubmit:A,errors:z,setFieldValue:S}=O({validationSchema:d,initialValues:{amount:0}});F(()=>o.fetchingPrice,(r,m)=>{r||(c?.value==="profile"&&S("amount",o.profilePrice?.amount??0),c?.value==="analysis"&&S("amount",o.analysisPrice?.amount??0))});const H=A(r=>{const m={amount:r.amount};let u=c.value=="profile"?o.profilePrice:o.analysisPrice;c?.value==="profile"?e(re,{uid:u.uid,payload:m},"updateProfilePrice").then():e(oe,{uid:u.uid,payload:m},"updateAnalysisPrice").then()}),x=N({discountType:p().required("Discount type is required"),valueType:p().required("Value type is required"),startDate:p().nullable(),endDate:p().nullable(),voucherUid:p().nullable().when("discountType",{is:"voucher",then:r=>r.required("Voucher is required")}),valuePercent:C().min(0,"Value percent must be 0 or greater").max(100,"Value percent must be 100 or less").nullable().when("valueType",{is:"percentage",then:r=>r.required("Value percent is required")}),valueAmount:C().min(0,"Value amount must be 0 or greater").nullable().when("valueType",{is:"amount",then:r=>r.required("Value amount is required")}),isActive:ae().nullable()}),{handleSubmit:w,errors:j,setValues:E,setFieldValue:b,values:U}=O({validationSchema:x,initialValues:{discountType:"",valueType:"",startDate:"",endDate:"",voucherUid:null,valuePercent:0,valueAmount:0,isActive:!0}});F(()=>o.fetchingDiscount,(r,m)=>{if(!r){let u={};c?.value==="profile"&&(u={...o.profileDiscount}),c?.value==="analysis"&&(u={...o.analyisDiscount}),E({discountType:u.discountType??"",valueType:u.valueType??"",startDate:D(u.startDate)??"",endDate:D(u.endDate)??"",voucherUid:u.voucherUid??null,valuePercent:u.valuePercent??0,valueAmount:u.valueAmount??0,isActive:u.isActive??!0})}});const K=B(["sale","voucher"]),Y=B(["percentage","amount"]),G=w(r=>{const m={...r};let u=c.value=="profile"?o.profileDiscount:o.analyisDiscount;c.value=="profile"?e(ie,{uid:u.uid,payload:m},"updateProfileDiscount").then():e(ue,{uid:u.uid,payload:m},"updateAnalysisDiscount").then()});F(()=>U.discountType,(r,m)=>{r!=="voucher"&&b("voucherUid",null)});function J(r){b("voucherUid",r===R?null:r)}function D(r){if(r==null||r==="")return"";const m=r.slice(0,10);return/^\d{4}-\d{2}-\d{2}$/.test(m)?m:r}const q={VOUCHER_NONE:R,billingStore:o,withClientMutation:e,props:y,target:c,targetUid:f,getProfileAndPrices:n,pricingSchema:d,handlePricingSubmit:A,pricingErrors:z,setPricingFieldValue:S,updatePricing:H,discountSchema:x,handleDiscountSubmit:w,discountErrors:j,setDiscountValues:E,setDiscountFieldValue:b,discountValues:U,discountTypes:K,valueTypes:Y,updateDiscounting:G,onVoucherChange:J,toDateOnly:D,get Button(){return Z},get Input(){return de},get FormControl(){return fe},get FormField(){return ne},get FormItem(){return me},get FormLabel(){return ge},get FormMessage(){return ce},get Select(){return ye},get SelectContent(){return _e},get SelectItem(){return pe},get SelectTrigger(){return Fe},get SelectValue(){return ve}};return Object.defineProperty(q,"__isScriptSetup",{enumerable:!1,value:!0}),q}}),be={class:"grid grid-cols-12 gap-8"},De={class:"col-span-6"},he={class:"space-y-6"},Ve={class:"space-y-4"},Pe={class:"relative"},Ie={class:"col-span-6"},Ce={class:"space-y-6"},Te={class:"grid grid-cols-2 gap-4"},Ae={class:"grid grid-cols-2 gap-4"},xe={class:"grid grid-cols-2 gap-4"},we={class:"relative"};function Ee(T,a,o,e,y,c){const f=ee("Checkbox");return g(),_("div",be,[i("section",De,[i("div",he,[a[5]||(a[5]=i("div",{class:"flex items-center justify-between"},[i("h3",{class:"text-lg font-semibold text-foreground"},"Pricing Information")],-1)),i("form",{class:"space-y-6",onSubmit:a[0]||(a[0]=M((...n)=>e.updatePricing&&e.updatePricing(...n),["prevent"]))},[i("div",Ve,[l(e.FormField,{name:"amount"},{default:t(({componentField:n})=>[l(e.FormItem,null,{default:t(()=>[l(e.FormLabel,null,{default:t(()=>[...a[2]||(a[2]=[s("Amount ($)",-1)])]),_:1}),l(e.FormControl,null,{default:t(()=>[i("div",Pe,[a[3]||(a[3]=i("span",{class:"absolute left-3 top-1/2 -translate-y-1/2 text-muted-foreground"},"$",-1)),l(e.Input,v(n,{class:"pl-8",type:"number",min:"0.0",step:"0.1",placeholder:"0.00"}),null,16)])]),_:2},1024),l(e.FormMessage)]),_:2},1024)]),_:1})]),l(e.Button,{type:"submit",class:"w-full"},{default:t(()=>[...a[4]||(a[4]=[s(" Update Pricing ",-1)])]),_:1})],32)])]),i("section",Ie,[i("div",Ce,[a[17]||(a[17]=i("div",{class:"flex items-center justify-between"},[i("h3",{class:"text-lg font-semibold text-foreground"},"Discounts Information")],-1)),i("form",{class:"space-y-6",onSubmit:a[1]||(a[1]=M((...n)=>e.updateDiscounting&&e.updateDiscounting(...n),["prevent"]))},[i("div",Te,[l(e.FormField,{name:"discountType"},{default:t(({componentField:n})=>[l(e.FormItem,null,{default:t(()=>[l(e.FormLabel,null,{default:t(()=>[...a[6]||(a[6]=[s("Discount Type",-1)])]),_:1}),l(e.FormControl,null,{default:t(()=>[l(e.Select,L(k(n)),{default:t(()=>[l(e.SelectTrigger,null,{default:t(()=>[l(e.SelectValue,{placeholder:"Select type"})]),_:1}),l(e.SelectContent,null,{default:t(()=>[(g(!0),_(h,null,V(e.discountTypes,d=>(g(),P(e.SelectItem,{key:d,value:d,class:"capitalize"},{default:t(()=>[s(I(d),1)]),_:2},1032,["value"]))),128))]),_:1})]),_:1},16)]),_:2},1024),l(e.FormMessage)]),_:2},1024)]),_:1}),l(e.FormField,{name:"valueType"},{default:t(({componentField:n})=>[l(e.FormItem,null,{default:t(()=>[l(e.FormLabel,null,{default:t(()=>[...a[7]||(a[7]=[s("Value Type",-1)])]),_:1}),l(e.FormControl,null,{default:t(()=>[l(e.Select,L(k(n)),{default:t(()=>[l(e.SelectTrigger,null,{default:t(()=>[l(e.SelectValue,{placeholder:"Select type"})]),_:1}),l(e.SelectContent,null,{default:t(()=>[(g(!0),_(h,null,V(e.valueTypes,d=>(g(),P(e.SelectItem,{key:d,value:d,class:"capitalize"},{default:t(()=>[s(I(d),1)]),_:2},1032,["value"]))),128))]),_:1})]),_:1},16)]),_:2},1024),l(e.FormMessage)]),_:2},1024)]),_:1})]),i("div",Ae,[l(e.FormField,{name:"startDate"},{default:t(({componentField:n})=>[l(e.FormItem,null,{default:t(()=>[l(e.FormLabel,null,{default:t(()=>[...a[8]||(a[8]=[s("Start Date",-1)])]),_:1}),l(e.FormControl,null,{default:t(()=>[l(e.Input,v(n,{type:"date"}),null,16)]),_:2},1024),l(e.FormMessage)]),_:2},1024)]),_:1}),l(e.FormField,{name:"endDate"},{default:t(({componentField:n})=>[l(e.FormItem,null,{default:t(()=>[l(e.FormLabel,null,{default:t(()=>[...a[9]||(a[9]=[s("End Date",-1)])]),_:1}),l(e.FormControl,null,{default:t(()=>[l(e.Input,v(n,{type:"date"}),null,16)]),_:2},1024),l(e.FormMessage)]),_:2},1024)]),_:1})]),l(e.FormField,{name:"voucherUid"},{default:t(({componentField:n})=>[le(l(e.FormItem,null,{default:t(()=>[l(e.FormLabel,null,{default:t(()=>[...a[10]||(a[10]=[s("Voucher",-1)])]),_:1}),l(e.FormControl,null,{default:t(()=>[l(e.Select,{"model-value":n.modelValue??e.VOUCHER_NONE,"onUpdate:modelValue":e.onVoucherChange},{default:t(()=>[l(e.SelectTrigger,null,{default:t(()=>[l(e.SelectValue,{placeholder:"Select voucher"})]),_:1}),l(e.SelectContent,null,{default:t(()=>[l(e.SelectItem,{value:e.VOUCHER_NONE},{default:t(()=>[...a[11]||(a[11]=[s("Select voucher",-1)])]),_:1}),(g(!0),_(h,null,V(e.billingStore.vouchers,d=>(g(),P(e.SelectItem,{key:d.uid,value:d.uid},{default:t(()=>[s(I(d.code),1)]),_:2},1032,["value"]))),128))]),_:1})]),_:1},8,["model-value"])]),_:2},1024),l(e.FormMessage)]),_:2},1536),[[te,e.discountValues.discountType==="voucher"]])]),_:1}),i("div",xe,[l(e.FormField,{name:"valuePercent"},{default:t(({componentField:n})=>[l(e.FormItem,null,{default:t(()=>[l(e.FormLabel,null,{default:t(()=>[...a[12]||(a[12]=[s("Value Percentage (%)",-1)])]),_:1}),l(e.FormControl,null,{default:t(()=>[l(e.Input,v(n,{type:"number",min:"0",max:"100",step:"0.1",placeholder:"0.00"}),null,16)]),_:2},1024),l(e.FormMessage)]),_:2},1024)]),_:1}),l(e.FormField,{name:"valueAmount"},{default:t(({componentField:n})=>[l(e.FormItem,null,{default:t(()=>[l(e.FormLabel,null,{default:t(()=>[...a[13]||(a[13]=[s("Value Amount ($)",-1)])]),_:1}),l(e.FormControl,null,{default:t(()=>[i("div",we,[a[14]||(a[14]=i("span",{class:"absolute left-3 top-1/2 -translate-y-1/2 text-muted-foreground"},"$",-1)),l(e.Input,v(n,{class:"pl-8",type:"number",min:"0",step:"0.1",placeholder:"0.00"}),null,16)])]),_:2},1024),l(e.FormMessage)]),_:2},1024)]),_:1})]),l(e.FormField,{name:"isActive",type:"checkbox","checked-value":!0,"unchecked-value":!1},{default:t(({componentField:n})=>[l(e.FormItem,{class:"flex items-center space-x-2"},{default:t(()=>[l(e.FormControl,null,{default:t(()=>[l(f,v({id:"isActive"},n),null,16)]),_:2},1024),l(e.FormLabel,null,{default:t(()=>[...a[15]||(a[15]=[s("Active",-1)])]),_:1}),l(e.FormMessage)]),_:2},1024)]),_:1}),l(e.Button,{type:"submit",class:"w-full"},{default:t(()=>[...a[16]||(a[16]=[s(" Update Discount ",-1)])]),_:1})],32)])])])}const Ge=$(Se,[["render",Ee],["__file","/home/administrator/Documents/Development/beak-insights/felicity/felicity-lims/webapp/views/admin/analyses/Billing.vue"]]);export{Ge as default};
