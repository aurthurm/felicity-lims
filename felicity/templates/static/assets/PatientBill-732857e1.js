import{e as se,S as G,P as Ce,u as Te,ai as ee,Z as _,h as Be,a3 as te,$ as q,o as i,c as r,b as e,A as u,a2 as o,a as B,F as V,D as F,a1 as b,E as d,a5 as Ve,C as O,z as y,L as N,K as m,x as K,a7 as W,a4 as Ae,V as E,J as z,X as L,Y as M,i as Ie,aT as Se,aU as Pe,_ as Ue}from"./index-fa13e788.js";import{I as De,u as Fe,g as Ne,C as Ee,h as Le}from"./billing-92650e42.js";import{c as Me,a as H,d as Re,u as je,b as J}from"./array-5698c257.js";function $e(){const{withClientQuery:h}=se();return{downloadInvoice:async x=>{try{await G.fire({title:"Are you sure?",text:"You want to download this invoice",icon:"warning",showCancelButton:!0,confirmButtonColor:"#3085d6",cancelButtonColor:"#d33",confirmButtonText:"Yes, download now!",cancelButtonText:"No, do not download!"}).then(async p=>{p.isConfirmed&&(h(De,{billUid:x},"billInvoiceCreate","network-only").then(A=>{const v=document.createElement("a");v.href=`data:application/pdf;base64,${A}`,v.setAttribute("download","invoice-report.pdf"),v.click()}),await G.fire("Its Happening!","Downloading .....","success").then(A=>{}))})}catch{}}}}const a=h=>(Se("data-v-afb0e1b5"),h=h(),Pe(),h),Ye={class:"mt-4"},qe=a(()=>e("h4",{class:"text-sm text-gray-800 font-bold"},"Patient's Order Bills",-1)),Oe=a(()=>e("hr",null,null,-1)),Ke={class:"grid grid-cols-12 gap-4 mt-2"},We={initial:{opacity:0,y:100},enter:{opacity:1,y:0,scale:1},variants:{custom:{scale:2}},delay:400,class:"col-span-3 overflow-y-scroll overscroll-contain billing-scroll"},ze={key:0,class:"py-4 text-center bg-white w-full mb-1 rounded-sm shadow border"},He={key:1},Je=["onClick"],Qe={class:"flex-grow p-1"},Xe={class:"font-semibold text-gray-800"},Ze={class:"text-sm text-gray-400"},Ge={initial:{opacity:0,y:-100},enter:{opacity:1,y:0,scale:1},variants:{custom:{scale:2}},delay:400,class:"col-span-9"},et={class:"bg-white rounded-sm shadow-sm hover:shadow-xs duration-500 px-4 sm:px-6 md:px-2 py-4"},tt={class:"flex justify-between items-center"},st={class:"text-gray-800 text-l font-bold"},ot=a(()=>e("hr",null,null,-1)),at={class:"grid grid-cols-3 gap-x-8"},nt={class:"col-span-1"},lt={class:"flex justify-between items-center mt-2"},it=a(()=>e("span",{class:"text-gray-800 text-sm font-semibold"},"Active:",-1)),dt={class:"text-gray-600 text-sm md:text-md"},ct={class:"flex justify-between items-center mt-2"},rt=a(()=>e("span",{class:"text-gray-800 text-sm font-semibold"},"Confirmed:",-1)),ut={class:"text-gray-600 text-sm md:text-md"},mt={class:"col-span-1"},_t={class:"flex justify-between items-center mt-2"},ht=a(()=>e("span",{class:"text-gray-800 text-sm font-semibold"},"Total Charged:",-1)),pt={class:"text-gray-600 text-sm md:text-md"},vt={class:"flex justify-between items-center mt-2"},ft=a(()=>e("span",{class:"text-gray-800 text-sm font-semibold"},"Total Paid:",-1)),bt={class:"text-gray-600 text-sm md:text-md"},yt={class:"col-span-1"},xt={class:"flex justify-between items-center mt-2"},gt=a(()=>e("span",{class:"text-gray-800 text-sm font-semibold"},"Partial:",-1)),wt={class:"text-gray-600 text-sm md:text-md"},kt={class:"mt-4"},Ct={class:"flex justify-between items-center"},Tt=a(()=>e("h4",{class:"text-gray-800 text-l font-semibold"},"Order Items",-1)),Bt=a(()=>e("hr",null,null,-1)),Vt={class:"mt-4 bg-white rounded-sm shadow-sm hover:shadow-xs duration-500 px-4 sm:px-6 md:px-2 py-4"},At={class:"text-gray-400"},It={class:"ml-2 text-md leading-5 text-sky-600"},St={class:"mt-4"},Pt={class:"flex justify-between items-center"},Ut=a(()=>e("h4",{class:"text-gray-800 text-l font-semibold"},"Transactions",-1)),Dt=a(()=>e("hr",null,null,-1)),Ft={class:"mt-4 bg-white rounded-sm shadow-sm hover:shadow-xs duration-500 px-4 sm:px-6 md:px-2 py-4"},Nt=a(()=>e("h3",null,"Transaction Form",-1)),Et={class:"grid grid-cols-2 gap-x-4 mb-4"},Lt={class:"whitespace-nowrap mb-2 w-full"},Mt=a(()=>e("span",{class:"text-gray-700 w-4/12"},"Kind of payment",-1)),Rt={class:"w-full"},jt=["disabled"],$t=a(()=>e("option",null,null,-1)),Yt=["value"],qt={class:"text-orange-600 w-4/12"},Ot={class:"block col-span-1 mb-2"},Kt=a(()=>e("span",{class:"text-gray-700"},"Amount",-1)),Wt=["disabled"],zt={class:"grid grid-cols-4 gap-x-4 mb-4"},Ht={class:"block col-span-4 mb-2"},Jt=a(()=>e("span",{class:"text-gray-700"},"Notes",-1)),Qt=["disabled"],Xt=a(()=>e("hr",{class:"mb-4"},null,-1)),Zt=a(()=>e("h3",null,"Confirm Tranaction",-1)),Gt={class:"grid grid-cols-4 gap-x-4 mb-4"},es={class:"block col-span-4 mb-2"},ts=a(()=>e("span",{class:"text-gray-700"},"Notes",-1)),ss=["disabled"],os=a(()=>e("hr",{class:"mb-4"},null,-1)),as=a(()=>e("h3",null,"Apply Voucher Code Form",-1)),ns={class:"grid grid-cols-2 gap-x-4 mb-4"},ls={class:"block col-span-2 mb-2"},is=a(()=>e("span",{class:"text-gray-700"},"Voucher Code:",-1)),ds=["disabled"],cs=a(()=>e("hr",{class:"mb-4"},null,-1)),rs=Ce({__name:"PatientBill",props:{patientUid:String},setup(h){const Q=L(()=>M(()=>import("./FelLoadingMessage-c4848162.js"),["assets/FelLoadingMessage-c4848162.js","assets/index-fa13e788.js","assets/index-ccc6a521.css"])),x=L(()=>M(()=>import("./index-fa13e788.js").then(n=>n.cN),["assets/index-fa13e788.js","assets/index-ccc6a521.css"])),p=L(()=>M(()=>import("./FelButton-1d1ff19a.js"),["assets/FelButton-1d1ff19a.js","assets/index-fa13e788.js","assets/index-ccc6a521.css"])),A=L(()=>M(()=>import("./FelDataTable-76696623.js"),["assets/FelDataTable-76696623.js","assets/index-fa13e788.js","assets/index-ccc6a521.css"])),v=h,{toastSuccess:X}=Ie(),{withClientMutation:R}=se(),g=Fe(),oe=Te(),{bills:Z,fetchingBills:ae,transactions:ne,fetchingTransactions:le}=ee(g),{analysisRequests:ie}=ee(oe);g.fetchBillsForPatient(v?.patientUid);const de=_(["cash","medical-aid","e-payment"]),I=_(!1),l=_({}),ce=n=>{l.value={...n},g.fetchBillTransactions(n.uid)},re=Be(()=>{const n=l?.value?.orders?.map(t=>t.uid)??[];return ie?.value?.filter(t=>n.includes(t.uid))});function ue(n,t){let f=[];return n.forEach(C=>f.push(C.name)),t.forEach(C=>f.push(C.name)),f.join(", ")}const me=Me({testBillUid:H().required(),kind:H().required(),amount:Re().required(),notes:H()}),{handleSubmit:_e,errors:w,setFieldValue:S}=je({validationSchema:me,initialValues:{testBillUid:l.value?.uid}}),{value:P}=J("kind"),{value:j}=J("amount"),{value:$}=J("notes"),c=_(!1),he=_e(n=>{c.value=!0,ve(n)}),pe=()=>{S("testBillUid",l.value?.uid),S("kind","cash"),S("amount",Math.ceil(Number((l?.value?.totalCharged-l?.value?.totalPaid).toFixed(2)))),S("notes",""),I.value=!0},ve=n=>{R(Ne,{payload:n},"createTestBillTransaction").then(t=>{g.addTransaction(t),c.value=!1,I.value=!1,X("Transaction added.")})},U=_(!1),k=_({}),fe=()=>{c.value=!0,R(Ee,{uid:k.value.uid,notes:k.value.notes},"confirmTestBillTransaction").then(n=>{g.updateTransaction(n),c.value=!1,U.value=!1,X("Transaction confirmed.")})},be=_([{name:"Kind",value:"kind",sortable:!0,sortBy:"asc",defaultSort:!0,showInToggler:!1,hidden:!1},{name:"Amount",value:"amount",sortable:!1,sortBy:"asc",hidden:!1},{name:"Success",value:"isSuccess",sortable:!1,sortBy:"asc",hidden:!1},{name:"Notes",value:"notes",sortable:!1,sortBy:"asc",hidden:!1},{name:"Message",value:"message",sortable:!1,sortBy:"asc",hidden:!1},{name:"Processed",value:"processed",sortable:!1,sortBy:"asc",hidden:!1,customRender:function(n,t){return te("span",{innerHTML:n.processed?"Yes":"Pending confirmation"},[])}},{name:"Action",sortable:!1,hidden:!1,customRender:(n,t)=>{if(!n.processed)return te("button",{onClick(){U.value=!0,k.value=n},type:"button",class:"bg-sky-800 text-white py-1 px-2 rounded-sm leading-none"},"confirm")}}]),Y=_(!1),D=_({code:""}),ye=()=>{Y.value=!0},xe=()=>{c.value=!0,R(Le,{payload:{voucherCode:D.value?.code,testBillUid:l.value?.uid,customerUid:v.patientUid}},"applyVoucher").then(n=>c.value=!1)},{downloadInvoice:ge}=$e(),we=async n=>await ge(n.uid);return(n,t)=>{const f=q("motion"),C=q("motion-slide-top"),ke=q("motion-slide-right");return i(),r(V,null,[e("div",Ye,[qe,Oe,e("div",Ke,[u((i(),r("section",We,[o(ae)?(i(),r("div",ze,[B(o(Q),{message:"Fetching bills ..."})])):(i(),r("div",He,[e("ul",null,[(i(!0),r(V,null,F(o(Z),s=>(i(),r("li",{key:s.uid,class:b(["bg-white w-full flex items-center p-1 mb-1 rounded-sm shadow border",{"border-sky-800 bg-emerald-200":s.uid===l.value.uid}]),onClick:T=>ce(s)},[e("div",Qe,[e("div",Xe,[e("div",null,d(s.billId?.toLocaleUpperCase()),1),e("div",Ze,d(o(Ve)(s.createdAt)),1)])])],10,Je))),128))])]))])),[[f]]),u((i(),r("section",Ge,[u((i(),r("div",et,[e("div",tt,[e("h4",st,d(l.value.billId?.toLocaleUpperCase()),1)]),ot,e("section",at,[e("div",nt,[e("div",lt,[it,e("span",dt,d(l.value.isActive?"Yes":"No"),1)]),e("div",ct,[rt,e("span",ut,d(l.value?.toConfirm?"No":"Yes"),1)])]),e("div",mt,[e("div",_t,[ht,e("span",pt,d(l.value?.totalCharged),1)]),e("div",vt,[ft,e("span",bt,d(l.value?.totalPaid),1)])]),e("div",yt,[e("div",xt,[gt,e("span",wt,d(l.value?.totalPaid<l.value?.totalCharged?"Yes":"No"),1)])])])])),[[C]]),e("div",kt,[e("div",Ct,[Tt,e("button",{class:"ml-4 px-2 py-1 mr-2 border-sky-800 border text-sky-800 rounded-sm transition duration-300 hover:bg-sky-800 hover:text-white focus:outline-none",onClick:t[0]||(t[0]=y(s=>we(l.value),["prevent"]))}," Invoice ")]),Bt,e("ul",Vt,[(i(!0),r(V,null,F(re.value,s=>(i(),r("li",{class:"font-semibold",key:s.uid},[e("div",null,d(s?.requestId)+" ("+d(s?.clientRequestId)+")",1),(i(!0),r(V,null,F(s.samples,T=>u((i(),r("div",{class:"ml-4 text-sm",key:T.uid},[e("span",At,d(T.sampleId),1),N(" â‡’ "),e("span",It,d(ue(T.profiles??[],T.analyses??[])),1)])),[[ke]])),128))]))),128))])]),e("div",St,[e("div",Pt,[Ut,e("div",null,[u(e("button",{class:"px-2 py-1 mr-2 border-sky-800 border text-sky-800 rounded-sm transition duration-300 hover:bg-sky-800 hover:text-white focus:outline-none",onClick:y(pe,["prevent"])}," Add Transaction ",512),[[O,l.value.isActive]]),u(e("button",{class:"ml-4 px-2 py-1 mr-2 border-sky-800 border text-sky-800 rounded-sm transition duration-300 hover:bg-sky-800 hover:text-white focus:outline-none",onClick:y(ye,["prevent"])}," Apply Voucher ",512),[[O,l.value.isActive]])])]),Dt,e("div",Ft,[B(o(A),{columns:be.value,data:o(ne),toggleColumns:!1,loading:o(le),paginable:!1,searchable:!1,filterable:!1,selectable:!1},{footer:m(()=>[]),_:1},8,["columns","data","loading"])])])])),[[O,o(Z)?.length>0&&l.value.uid],[f]])])]),I.value?(i(),K(o(x),{key:0,onClose:t[4]||(t[4]=s=>I.value=!1),contentWidth:"w-3/6"},{header:m(()=>[Nt]),body:m(()=>[e("form",null,[e("div",Et,[e("label",Lt,[Mt,e("div",Rt,[u(e("select",{class:b(["form-select mt-1 w-full",{"border-red-500 animate-pulse":o(w).kind}]),"onUpdate:modelValue":t[1]||(t[1]=s=>W(P)?P.value=s:null),disabled:c.value},[$t,(i(!0),r(V,null,F(de.value,s=>(i(),r("option",{key:s,value:s},d(s),9,Yt))),128))],10,jt),[[Ae,o(P)]]),e("div",qt,d(o(w).gender),1)])]),e("label",Ot,[Kt,u(e("input",{class:b(["form-input mt-1 block w-full",{"border-red-500 animate-pulse":o(w).amount}]),type:"number","onUpdate:modelValue":t[2]||(t[2]=s=>W(j)?j.value=s:null),disabled:c.value},null,10,Wt),[[E,o(j)]])])]),e("div",zt,[e("label",Ht,[Jt,u(e("input",{class:b(["form-input mt-1 block w-full",{"border-red-500 animate-pulse":o(w).notes}]),"onUpdate:modelValue":t[3]||(t[3]=s=>W($)?$.value=s:null),disabled:c.value},null,10,Qt),[[E,o($)]])])]),Xt,B(o(p),{color:"sky-800",type:"submit",loading:c.value,onClick:y(o(he),["prevent"])},{default:m(()=>[N(" Save Transaction ")]),_:1},8,["loading","onClick"])])]),_:1})):z("",!0),U.value?(i(),K(o(x),{key:1,onClose:t[6]||(t[6]=s=>U.value=!1),contentWidth:"w-3/6"},{header:m(()=>[Zt]),body:m(()=>[e("form",null,[e("h4",null,d(o(P))+" Transaction ",1),e("div",Gt,[e("label",es,[ts,u(e("input",{class:b(["form-input mt-1 block w-full",{"border-red-500 animate-pulse":o(w).notes}]),"onUpdate:modelValue":t[5]||(t[5]=s=>k.value.notes=s),disabled:c.value},null,10,ss),[[E,k.value.notes]])])]),os,B(o(p),{color:"sky-800",type:"submit",loading:c.value,onClick:y(fe,["prevent"])},{default:m(()=>[N(" Confirm Transaction ")]),_:1},8,["loading"])])]),_:1})):z("",!0),Y.value?(i(),K(o(x),{key:2,onClose:t[8]||(t[8]=s=>Y.value=!1),contentWidth:"w-1/5"},{header:m(()=>[as]),body:m(()=>[e("form",null,[e("div",ns,[e("label",ls,[is,u(e("input",{class:b(["form-input mt-1 block w-full",{"border-red-500 animate-pulse":!D.value.code}]),type:"text","onUpdate:modelValue":t[7]||(t[7]=s=>D.value.code=s),disabled:c.value},null,10,ds),[[E,D.value.code]])])]),cs,B(o(p),{color:"sky-800",type:"submit",loading:c.value,onClick:y(xe,["prevent"])},{default:m(()=>[N(" Apply Voucher ")]),_:1},8,["loading"])])]),_:1})):z("",!0)],64)}}});const hs=Ue(rs,[["__scopeId","data-v-afb0e1b5"],["__file","/home/aurthurm/Documents/Development/felicity/felicity-lims/webapp/views/patient/_id/PatientBill.vue"]]);export{hs as default};
