const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/DeriveSamplesModal-CLdvWbke.js","assets/index-v7Q387fb.js","assets/index-c4lX_LAY.css","assets/analysis-xHaHOXP2.js","assets/analyses.mutations-DwO9qbHD.js","assets/DeriveSamplesModal-DuNb9Bt-.css"])))=>i.map(i=>d[i]);
import{a0 as xe,u as ye,ac as he,a4 as be,f as _e,g as we,aq as Se,a5 as q,h as f,a7 as h,a1 as Ce,a6 as ke,at as De,_ as Re,r as S,aa as je,c as i,o as l,A as t,F as u,C as N,E as g,a as v,P as j,N as L,L as a,H as c,J as F,K as W,O as Le}from"./index-v7Q387fb.js";import{u as Te}from"./samples-CDlnlGbl.js";import{p as Me}from"./index-Cd7XCJEF.js";import"./analyses.mutations-DwO9qbHD.js";import"./storage.mutations-Blkqas25.js";const Pe=xe({__name:"Sample",setup(J,{expose:s}){s();const m=ye(),e=he(),b=be(),{withClientQuery:T}=_e(),x=Ce(()=>ke(()=>import("./DeriveSamplesModal-CLdvWbke.js"),__vite__mapDeps([0,1,2,3,4,5])));m.resetSample();const{cancelSamples:_,reInstateSamples:w,receiveSamples:C,invalidateSamples:k,publishSamples:D,verifySamples:r,recoverSamples:O}=Te(),E=we({dropdownOpen:!1}),{sample:n,fetchingSample:z,repeatSample:H}=Se(m);m.fetchSampleByUid(e.params.sampleUid),q(()=>n?.value?.status,(o,d)=>{if(o)if(o!=="invalidated"){m.resetRepeatSample();return}else m.fetchRepeatSampleByParentId(e.params.sampleUid)}),q(()=>e.params.sampleUid,(o,d)=>{m.fetchSampleByUid(o)});function K(o,d){let p=[];return o?.forEach(y=>p.push(y.name)),d?.forEach(y=>p.push(y.name)),p.join(", ")}function Q(o){if(!o)return null;const d=o.toLowerCase();return d.startsWith("der")?"D":d.startsWith("ali")?"A":d.startsWith("poo")?"P":o.charAt(0).toUpperCase()}const X=f(()=>!!["expected"].includes(n?.value?.status?.toLowerCase())),Y=async()=>C([n?.value?.uid]),Z=f(()=>!!["received","expected"].includes(n?.value?.status?.toLowerCase())),$=async()=>_([n?.value?.uid]),ee=f(()=>!!["cancelled"].includes(n?.value?.status?.toLowerCase())),te=async()=>w([n?.value?.uid]),se=f(()=>n?.value?.status?.toLowerCase()==="awaiting"),oe=async()=>r([n?.value?.uid]),ne=f(()=>n?.value?.status?.toLowerCase()==="published"),M=f(()=>["approved"].includes(n?.value?.status?.toLowerCase())?"Publish":["published"].includes(n?.value?.status?.toLowerCase())?"Re publish":"Pre publish"),ae=f(()=>{if(["awaiting","approved","published"].includes(n?.value?.status?.toLowerCase()))return!0;const o=m.analysisResults;return!!(["received","paired"].includes(n?.value?.status?.toLowerCase()??"")&&o?.some(d=>["approved"].includes(d.status?.toLowerCase()??"")))}),re=async()=>{const o=M.value.startsWith("Pre")?"pre-publish":M.value.startsWith("Re")?"re-publish":"publish";D([{uid:n?.value?.uid,action:o}])},le=async()=>k([n?.value?.uid]).then(o=>{let d=o?.filter(p=>p.uid!==n?.value?.uid);d.length>0&&m.setRepeatSample(d[0])}),ie=async()=>b.push({name:"print-barcodes",state:{sampleUids:JSON.stringify([n?.value?.uid])}}),de=f(()=>!!["received","expected"].includes(n?.value?.status?.toLowerCase())),ue=async()=>{b.push({name:"reject-samples",state:{samples:JSON.stringify([n?.value])}})},ce=f(()=>!!["stored"].includes(n?.value?.status?.toLowerCase())),me=async()=>O([n?.value?.uid]),pe=async o=>{b.push({path:"/bio-banking",state:{sample:JSON.stringify(o)}})},A=h(!1),P=h(!1),U=h(null),R=h(null),fe=f(()=>{if(!R.value?.children?.length)return[];const o=[],d=(p,y)=>{o.push({node:p,depth:y}),(p.children??[]).forEach(ge=>d(ge,y+1))};return R.value.children.forEach(p=>d(p,0)),o}),G=async()=>{n?.value?.uid&&(P.value=!0,U.value=null,T(De,{sampleUid:n?.value?.uid,depth:6,includeTests:!1,includeExtraRelationships:!0},"sampleGenealogy").then(o=>{R.value=o??null}).catch(o=>{U.value=o?.message??"Failed to load genealogy."}).finally(()=>{P.value=!1}))},ve=async()=>{A.value=!0,await G()},B=h(!1),I=h([]),V={sampleStore:m,route:e,router:b,withClientQuery:T,DeriveSamplesModal:x,cancelSamples:_,reInstateSamples:w,receiveSamples:C,invalidateSamples:k,publishSamples:D,verifySamples:r,recoverSamples:O,state:E,sample:n,fetchingSample:z,repeatSample:H,profileAnalysesText:K,relationshipBadge:Q,canReceive:X,receiveSample:Y,canCancel:Z,cancelSample:$,canReinstate:ee,reInstateSample:te,canVerify:se,verifySample:oe,canInvalidate:ne,publishText:M,canPublish:ae,publishSample:re,invalidateSample:le,printBarCooe:ie,canReject:de,rejectSample:ue,canRecover:ce,recoverSample:me,goToStorage:pe,showGenealogyModal:A,genealogyLoading:P,genealogyError:U,genealogy:R,genealogyRows:fe,fetchGenealogy:G,openGenealogyModal:ve,showDeriveModal:B,deriveSelection:I,openDeriveModal:()=>{n?.value&&(I.value=[n.value],B.value=!0,E.dropdownOpen=!1)},closeDeriveModal:()=>{B.value=!1,I.value=[]},handleDerived:o=>{o?.length&&m.addSampleClones(o)},get parseDate(){return Me}};return Object.defineProperty(V,"__isScriptSetup",{enumerable:!1,value:!0}),V}}),Ue={class:"space-y-6"},Be={class:"flex justify-between items-center"},Ie={class:"flex items-center space-x-4"},Oe={class:"flex items-center"},Ee={class:"bg-background rounded-lg shadow-sm p-6 space-y-6"},Ae={key:0,class:"py-4 text-center"},Ge={key:1,class:"space-y-6"},Ve={class:"space-y-4"},qe={class:"flex items-center justify-between"},Ne={class:"flex items-center space-x-2"},Fe={key:0,class:"text-destructive"},We={class:"text-lg font-semibold text-foreground"},Je={key:1,class:"inline-flex items-center justify-center w-4 h-4 rounded-full text-[9px] italic font-semibold bg-muted text-foreground"},ze={key:2,class:"flex items-center space-x-2"},He={class:"text-muted-foreground"},Ke={class:"relative"},Qe={type:"button",class:"px-4 py-2 bg-primary text-primary-foreground rounded-md hover:bg-primary/90 transition-colors duration-200 focus:outline-none focus:ring-2 focus:ring-primary/50"},Xe={class:"absolute right-0 mt-2 py-2 bg-background rounded-lg shadow-lg border border-border z-20 min-w-[200px]"},Ye={class:"grid grid-cols-3 gap-6"},Ze={class:"space-y-4"},$e={class:"flex justify-between"},et={class:"text-sm text-muted-foreground"},tt={class:"flex justify-between"},st={class:"text-sm text-muted-foreground"},ot={class:"space-y-4"},nt={class:"flex justify-between"},at={class:"text-sm text-muted-foreground"},rt={class:"flex justify-between"},lt={class:"text-sm text-muted-foreground"},it={class:"flex justify-between"},dt={class:"text-sm text-muted-foreground"},ut={class:"flex justify-between"},ct={class:"text-sm text-muted-foreground"},mt={class:"space-y-4"},pt={class:"flex justify-between"},ft={class:"text-sm text-muted-foreground"},vt={class:"flex justify-between"},gt={class:"text-sm text-muted-foreground"},xt={class:"flex justify-between"},yt={class:"text-sm text-muted-foreground"},ht={class:"flex justify-between"},bt={class:"text-sm text-muted-foreground"},_t={class:"bg-muted rounded-lg shadow-sm p-6"},wt={class:"flex items-center space-x-4"},St={class:"flex items-center space-x-2"},Ct={class:"bg-destructive/10 text-destructive rounded-lg shadow-sm p-6"},kt={class:"space-y-2"},Dt={class:"space-y-4"},Rt={key:0,class:"py-6 text-center"},jt={key:1,class:"text-destructive"},Lt={key:2,class:"text-muted-foreground"},Tt={key:3,class:"space-y-2"},Mt={class:"font-medium text-foreground"},Pt={key:0,class:"text-xs text-muted-foreground"};function Ut(J,s,m,e,b,T){const x=S("font-awesome-icon"),_=S("router-link"),w=S("fel-loader"),C=S("fel-modal"),k=S("router-view"),D=je("motion-slide-right");return l(),i("div",Ue,[t("div",Be,[s[15]||(s[15]=t("h3",{class:"text-xl font-semibold text-foreground"},"Sample Detail",-1)),t("div",Ie,[t("button",{class:"px-4 py-2 bg-background border border-border text-foreground rounded-md hover:bg-accent hover:text-accent-foreground transition-colors duration-200 focus:outline-none focus:ring-2 focus:ring-primary/50",onClick:e.printBarCooe},[t("span",Oe,[s[13]||(s[13]=j(" Barcode ",-1)),v(x,{icon:"barcode",class:"ml-2"})])]),e.sample?.analysisRequest?.patient?.uid?(l(),N(_,{key:0,to:{name:"patient-detail",params:{patientUid:e.sample?.analysisRequest?.patient?.uid}},class:"px-4 py-2 bg-primary text-primary-foreground rounded-md hover:bg-primary/90 transition-colors duration-200 focus:outline-none focus:ring-2 focus:ring-primary/50"},{default:L(()=>[...s[14]||(s[14]=[j(" ... other samples ",-1)])]),_:1},8,["to"])):g("",!0),e.sample?.uid?(l(),i("button",{key:1,class:"px-4 py-2 bg-background border border-border text-foreground rounded-md hover:bg-accent hover:text-accent-foreground transition-colors duration-200 focus:outline-none focus:ring-2 focus:ring-primary/50",onClick:e.openGenealogyModal}," View genealogy ")):g("",!0)])]),u((l(),i("div",Ee,[e.fetchingSample?(l(),i("div",Ae,[v(w,{message:"Fetching sample details ..."})])):(l(),i("div",Ge,[t("div",Ve,[t("div",qe,[t("div",Ne,[e.sample?.priority??!0?(l(),i("span",Fe,[v(x,{icon:"fa-star"})])):g("",!0),t("span",We,a(e.sample?.sampleId),1),e.relationshipBadge(e.sample?.relationshipType)?(l(),i("span",Je,a(e.relationshipBadge(e.sample?.relationshipType)),1)):g("",!0),e.sample?.analysisRequest?.patient?.uid&&e.repeatSample?.uid?(l(),i("span",ze,[v(x,{icon:"angle-double-right"}),v(_,{to:{name:"sample-detail",params:{patientUid:e.sample?.analysisRequest?.patient?.uid,sampleUid:e.repeatSample?.uid}},class:"px-4 py-2 bg-primary text-primary-foreground rounded-md hover:bg-primary/90 transition-colors duration-200 focus:outline-none focus:ring-2 focus:ring-primary/50"},{default:L(()=>[j(a(e.repeatSample?.sampleId),1)]),_:1},8,["to"])])):g("",!0)]),t("span",He,a(e.profileAnalysesText(e.sample?.profiles,e.sample?.analyses??[])),1),t("div",Ke,[t("div",{onClick:s[0]||(s[0]=r=>e.state.dropdownOpen=!e.state.dropdownOpen),class:"flex items-center space-x-2 cursor-pointer"},[t("button",Qe,a(e.sample?.status),1),v(x,{icon:"chevron-down",class:"text-muted-foreground"})]),u(t("div",{onClick:s[1]||(s[1]=r=>e.state.dropdownOpen=!1),class:"fixed inset-0 h-full w-full z-10"},null,512),[[c,e.state.dropdownOpen]]),u(t("div",Xe,[u(t("button",{onClick:s[2]||(s[2]=r=>e.receiveSample()),class:"w-full px-4 py-2 text-left text-foreground hover:bg-primary hover:text-primary-foreground transition-colors duration-200"}," Receive ",512),[[c,e.canReceive]]),u(t("button",{onClick:s[3]||(s[3]=r=>e.verifySample()),class:"w-full px-4 py-2 text-left text-foreground hover:bg-primary hover:text-primary-foreground transition-colors duration-200"}," Approve ",512),[[c,e.canVerify]]),u(t("button",{onClick:s[4]||(s[4]=r=>e.rejectSample()),class:"w-full px-4 py-2 text-left text-foreground hover:bg-destructive hover:text-destructive-foreground transition-colors duration-200"}," Reject ",512),[[c,e.canReject]]),u(t("button",{onClick:s[5]||(s[5]=r=>e.cancelSample()),class:"w-full px-4 py-2 text-left text-foreground hover:bg-destructive hover:text-destructive-foreground transition-colors duration-200"}," Cancel ",512),[[c,e.canCancel]]),u(t("button",{onClick:s[6]||(s[6]=r=>e.reInstateSample()),class:"w-full px-4 py-2 text-left text-foreground hover:bg-destructive hover:text-destructive-foreground transition-colors duration-200"}," Reinstate ",512),[[c,e.canReinstate]]),u(t("button",{onClick:s[7]||(s[7]=r=>e.publishSample()),class:"w-full px-4 py-2 text-left text-foreground hover:bg-primary hover:text-primary-foreground transition-colors duration-200"},a(e.publishText),513),[[c,e.canPublish]]),u(t("button",{onClick:s[8]||(s[8]=r=>e.invalidateSample()),class:"w-full px-4 py-2 text-left text-foreground hover:bg-primary hover:text-primary-foreground transition-colors duration-200"}," Invalidate ",512),[[c,e.canInvalidate]]),u(t("button",{onClick:s[9]||(s[9]=r=>e.recoverSample()),class:"w-full px-4 py-2 text-left text-foreground hover:bg-primary hover:text-primary-foreground transition-colors duration-200"}," Recover ",512),[[c,e.canRecover]]),u(t("button",{onClick:s[10]||(s[10]=r=>e.openDeriveModal()),class:"w-full px-4 py-2 text-left text-foreground hover:bg-primary hover:text-primary-foreground transition-colors duration-200"}," Derive ",512),[[c,e.sample?.uid]])],512),[[c,e.state.dropdownOpen]])])]),t("div",Ye,[t("div",Ze,[t("div",$e,[s[16]||(s[16]=t("span",{class:"text-sm font-medium text-foreground"},"Client Request ID",-1)),t("span",et,a(e.sample?.analysisRequest?.clientRequestId),1)]),t("div",tt,[s[17]||(s[17]=t("span",{class:"text-sm font-medium text-foreground"},"Client",-1)),t("span",st,a(e.sample?.analysisRequest?.client?.name),1)]),s[18]||(s[18]=t("div",{class:"flex justify-between"},[t("span",{class:"text-sm font-medium text-foreground"},"Client Contact"),t("span",{class:"text-sm text-muted-foreground"},"Sister in Charge")],-1))]),t("div",ot,[t("div",nt,[s[19]||(s[19]=t("span",{class:"text-sm font-medium text-foreground"},"Sample Type",-1)),t("span",at,a(e.sample?.sampleType?.name),1)]),t("div",rt,[s[20]||(s[20]=t("span",{class:"text-sm font-medium text-foreground"},"Date Sampled",-1)),t("span",lt,a(e.parseDate(e.sample?.dateCollected,!0)),1)]),t("div",it,[s[21]||(s[21]=t("span",{class:"text-sm font-medium text-foreground"},"Date Registered",-1)),t("span",dt,a(e.parseDate(e.sample?.createdAt,!0)),1)]),t("div",ut,[s[22]||(s[22]=t("span",{class:"text-sm font-medium text-foreground"},"Date Received",-1)),t("span",ct,a(e.parseDate(e.sample?.dateReceived,!0)),1)])]),t("div",mt,[t("div",pt,[s[23]||(s[23]=t("span",{class:"text-sm font-medium text-foreground"},"Date Submitted",-1)),t("span",ft,a(e.parseDate(e.sample?.dateSubmitted,!0)),1)]),t("div",vt,[s[24]||(s[24]=t("span",{class:"text-sm font-medium text-foreground"},"Date Verified",-1)),t("span",gt,a(e.parseDate(e.sample?.dateVerified,!0)),1)]),t("div",xt,[s[25]||(s[25]=t("span",{class:"text-sm font-medium text-foreground"},"Date Published",-1)),t("span",yt,a(e.parseDate(e.sample?.datePublished,!0)),1)]),t("div",ht,[s[26]||(s[26]=t("span",{class:"text-sm font-medium text-foreground"},"Date Printed",-1)),t("span",bt,a(e.parseDate(e.sample?.datePrinted,!0)),1)])])])])]))])),[[D]]),u(t("div",_t,[t("div",wt,[s[31]||(s[31]=t("span",{class:"font-medium text-foreground"},"Storage:",-1)),t("button",{class:"text-primary hover:text-primary/80 transition-colors",onClick:s[11]||(s[11]=r=>e.goToStorage(e.sample))},[t("span",St,[t("span",null,a(e.sample?.storageContainer?.storageSection?.storageLocation?.storeRoom?.name),1),s[27]||(s[27]=t("span",null,"›",-1)),t("span",null,a(e.sample?.storageContainer?.storageSection?.storageLocation?.name),1),s[28]||(s[28]=t("span",null,"›",-1)),t("span",null,a(e.sample?.storageContainer?.storageSection?.name),1),s[29]||(s[29]=t("span",null,"›",-1)),t("span",null,a(e.sample?.storageContainer?.name),1),s[30]||(s[30]=t("span",null,"›",-1)),t("span",null,a(e.sample?.storageSlot),1)])])])],512),[[c,e.sample?.status==="stored"]]),u(t("div",Ct,[t("ul",kt,[(l(!0),i(F,null,W(e.sample?.rejectionReasons,r=>(l(),i("li",{key:r.uid},a(r.reason),1))),128))])],512),[[c,e.sample?.status==="rejected"]]),e.showGenealogyModal?(l(),N(C,{key:0,onClose:s[12]||(s[12]=r=>e.showGenealogyModal=!1),"content-width":"w-3/4"},{header:L(()=>[j(a(e.sample?.sampleId??e.sample?.uid)+" Genealogy ",1)]),body:L(()=>[t("div",Dt,[e.genealogyLoading?(l(),i("div",Rt,[v(w,{message:"Fetching genealogy ..."})])):e.genealogyError?(l(),i("div",jt,a(e.genealogyError),1)):e.genealogyRows.length?(l(),i("div",Tt,[(l(!0),i(F,null,W(e.genealogyRows,r=>(l(),i("div",{key:r.node.sampleUid,class:"flex items-center gap-2",style:Le({paddingLeft:`${r.depth*1.25}rem`})},[t("span",Mt,a(r.node.sampleId??r.node.sampleUid),1),r.node.relationshipType?(l(),i("span",Pt," ("+a(r.node.relationshipType)+") ",1)):g("",!0)],4))),128))])):(l(),i("div",Lt," Sample has no genealogy. "))])]),_:1})):g("",!0),v(e.DeriveSamplesModal,{show:e.showDeriveModal,samples:e.deriveSelection,onClose:e.closeDeriveModal,onDerived:e.handleDerived},null,8,["show","samples"]),v(k)])}const Nt=Re(Pe,[["render",Ut],["__file","/home/administrator/Documents/Development/beak-insights/felicity/felicity-lims/webapp/views/sample/_id/Sample.vue"]]);export{Nt as default};
