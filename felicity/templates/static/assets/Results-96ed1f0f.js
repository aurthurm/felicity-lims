import{d as fe,J as xe,R as ke,s as ve,n as we,q as Re,P as Ce,r as j,m as Ue,x as Ee,o,c as n,b as e,f as i,g as _,e as u,ae as G,F as p,C as y,G as Ae,y as P,B as N,A as b,t as c,ad as $,v as Se,az as q,L as v,z as h,w,j as D,_ as I,aE as J,p as Ve,k as De}from"./index-ad4ed84b.js";import{u as Ie}from"./analysis-706b2145.js";import{h as R,o as C,a as U}from"./constants-1081a5c1.js";import"./analyses.mutations-6b5db61d.js";const Te=e("hr",{class:"mt-4 mb-2"},null,-1),Le=e("h3",{class:"font-bold"},"Analyses/Results",-1),Pe=e("hr",{class:"mb-4 mt-2"},null,-1),Ne={class:"overflow-x-auto"},$e={class:"align-middle inline-block min-w-full shadow overflow-hidden bg-white shadow-dashboard px-2 pt-1 rounded-bl-lg rounded-br-lg"},Be={key:0,class:"py-4 text-center"},Oe={key:1,class:"min-w-full"},Fe={class:"px-1 py-1 border-b-2 border-gray-300 text-left leading-4 text-gray-800 tracking-wider"},Me=e("th",{class:"px-1 py-1 border-b-2 border-gray-300 text-left leading-4 text-gray-800 tracking-wider"},null,-1),qe=e("th",{class:"px-1 py-1 border-b-2 border-gray-300 text-left leading-4 text-gray-800 tracking-wider"}," Analysis ",-1),ze=e("th",{class:"px-1 py-1 border-b-2 border-gray-300 text-left text-sm leading-4 text-gray-800 tracking-wider"}," Instrument ",-1),Ke=e("th",{class:"px-1 py-1 border-b-2 border-gray-300 text-left text-sm leading-4 text-gray-800 tracking-wider"}," Method ",-1),je=e("th",{class:"px-1 py-1 border-b-2 border-gray-300 text-left text-sm leading-4 text-gray-800 tracking-wider"}," Analyst ",-1),Ge=e("th",{class:"px-1 py-1 border-b-2 border-gray-300 text-left text-sm leading-4 text-gray-800 tracking-wider"}," Reviewer(s) ",-1),Je=e("th",{class:"px-1 py-1 border-b-2 border-gray-300 text-left text-sm leading-4 text-gray-800 tracking-wider"}," Interim ",-1),We=e("th",{class:"px-1 py-1 border-b-2 border-gray-300 text-left text-sm leading-4 text-gray-800 tracking-wider"}," Result ",-1),He=e("th",{class:"px-1 py-1 border-b-2 border-gray-300 text-left text-sm leading-4 text-gray-800 tracking-wider"}," Retest ",-1),Qe=e("th",{class:"px-1 py-1 border-b-2 border-gray-300 text-left text-sm leading-4 text-gray-800 tracking-wider"}," Due Date ",-1),Xe=e("th",{class:"px-1 py-1 border-b-2 border-gray-300 text-left text-sm leading-4 text-gray-800 tracking-wider"}," Submitted ",-1),Ye=e("th",{class:"px-1 py-1 border-b-2 border-gray-300 text-left text-sm leading-4 text-gray-800 tracking-wider"}," Approved ",-1),Ze=e("th",{class:"px-1 py-1 border-b-2 border-gray-300 text-left text-sm leading-4 text-gray-800 tracking-wider"}," Status ",-1),et=e("th",{class:"px-1 py-1 border-b-2 border-gray-300 text-left text-sm leading-4 text-gray-800 tracking-wider"}," Reportable ",-1),tt=e("th",{class:"px-1 py-1 border-b-2 border-gray-300"},null,-1),st={class:"bg-white"},at=["onUpdate:modelValue","onChange","disabled"],ot=e("td",{class:"px-1 py-1 whitespace-no-wrap border-b border-gray-500"},null,-1),nt={class:"px-1 py-1 whitespace-no-wrap border-b border-gray-500"},rt={class:"text-sm leading-5 text-sky-800 font-semibold"},lt=["onClick"],it={class:"px-1 py-1 whitespace-no-wrap border-b border-gray-500"},ct={key:0,class:"text-sm leading-5 text-sky-800"},dt={key:1,class:"block col-span-2 mb-2"},ut=["onUpdate:modelValue","onChange"],_t=e("option",{value:""},null,-1),pt=["value"],ht={class:"px-1 py-1 whitespace-no-wrap border-b border-gray-500"},yt={key:0,class:"text-sm leading-5 text-sky-800"},bt={key:1,class:"block col-span-2 mb-2"},mt=["onUpdate:modelValue","onChange"],gt=e("option",{value:""},null,-1),ft=["value"],xt={class:"px-1 py-1 whitespace-no-wrap border-b border-gray-500"},kt={class:"text-sm leading-5 text-sky-800"},vt={class:"px-1 py-1 whitespace-no-wrap border-b border-gray-500"},wt={class:"text-sm leading-5 text-sky-800"},Rt={class:"px-1 py-1 whitespace-no-wrap border-b border-gray-500"},Ct={key:0,class:"text-sm leading-5 text-sky-800"},Ut={key:1,class:"block col-span-2 mb-2"},Et=["onUpdate:modelValue","onChange"],At=e("option",{value:""},null,-1),St=["value"],Vt={class:"px-1 py-1 whitespace-no-wrap border-b border-gray-500"},Dt={key:0,class:"text-sm leading-5 text-sky-800"},It={key:1,class:"block"},Tt=["onUpdate:modelValue","onKeyup"],Lt={key:2,class:"block col-span-2 mb-2"},Pt=["onUpdate:modelValue","onChange"],Nt=e("option",{value:""},null,-1),$t=["value"],Bt={class:"px-1 py-1 whitespace-no-wrap border-b border-gray-500"},Ot={class:"text-sm leading-5 text-sky-800"},Ft={key:0,class:"text-sky-800"},Mt={key:1,class:"text-orange-600"},qt={class:"px-1 py-1 whitespace-no-wrap border-b border-gray-500"},zt={class:"text-sm leading-5 text-sky-800"},Kt={class:"px-1 py-1 whitespace-no-wrap border-b border-gray-500"},jt={class:"text-sm leading-5 text-sky-800"},Gt={class:"px-1 py-1 whitespace-no-wrap border-b border-gray-500"},Jt={class:"text-sm leading-5 text-sky-800"},Wt={class:"px-1 py-1 whitespace-no-wrap border-b border-gray-500"},Ht={type:"button",class:"bg-sky-800 text-white px-2 py-1 rounded-sm leading-none"},Qt={class:"px-1 py-1 whitespace-no-wrap border-b border-gray-500"},Xt={class:"text-sm leading-5 text-sky-800"},Yt={key:0,class:"text-emerald-600"},Zt={key:1,class:"text-orange-600"},es=e("td",{class:"px-1 py-1 whitespace-no-wrap text-right border-b border-gray-500 text-sm leading-5"},null,-1),ts={class:"my-4"},ss=e("h3",null,"Result Information",-1),as=fe({__name:"Results",setup(os){const m=D(()=>I(()=>import("./FelButton-1eb0dadd.js"),["assets/FelButton-1eb0dadd.js","assets/index-ad4ed84b.js","assets/index-3e01f4af.css"])),W=D(()=>I(()=>import("./FelLoadingMessage-b442db31.js"),["assets/FelLoadingMessage-b442db31.js","assets/index-ad4ed84b.js","assets/index-3e01f4af.css"])),H=D(()=>I(()=>import("./FelDrawer-7e01a16c.js"),["assets/FelDrawer-7e01a16c.js","assets/index-ad4ed84b.js","assets/index-3e01f4af.css"])),Q=D(()=>I(()=>import("./AnalysisSneak-1fe9016c.js"),["assets/AnalysisSneak-1fe9016c.js","assets/index-ad4ed84b.js","assets/index-3e01f4af.css"])),X=D(()=>I(()=>import("./ResultDetail-9dfcb22c.js"),["assets/ResultDetail-9dfcb22c.js","assets/index-ad4ed84b.js","assets/index-3e01f4af.css"])),B=xe(),g=ke(),{sample:T,analysisResults:E,fetchingResults:Y}=ve(g),r=we({can_submit:!1,can_cancel:!1,can_retract:!1,can_approve:!1,can_retest:!1,can_reinstate:!1,allChecked:!1});Re(()=>{g.fetchAnalysisResultsForSample(B.params.sampleUid)}),Ce(()=>B.params.sampleUid,(s,l)=>{g.resetSample(),g.fetchAnalysisResultsForSample(B.params.sampleUid)});function O(){let s=[];return E?.value?.forEach(l=>{l.checked&&s.push(l)}),s}function Z(){let s=O(),l=[];return s?.forEach(d=>l.push({uid:d.uid,result:d.result,methodUid:d.methodUid,laboratoryInstrumentUid:d.laboratoryInstrumentUid})),l}function A(){const s=O();let l=[];return s?.forEach(d=>l.push(d.uid)),l}function ee(s){se()?r.allChecked=!0:r.allChecked=!1,S()}function f(s){K(s)||(s.checked=!0,S())}function z(s){s.checked=!1,S()}async function te(){await E?.value?.forEach(s=>r.allChecked?f(s):z(s)),S()}async function x(){await E?.value?.forEach(s=>z(s)),S()}function se(){return E?.value?.every(s=>s.checked===!0)}function K(s){switch(s?.status){case"retracted":return!0;case"approved":return!0;case"cancelled":return T?.value?.status!=="received";default:return!1}}function ae(s){s.editable=!0}function L(s){return!["received","paired"].includes(T?.value?.status??"")||s.status!=="pending"?!1:s?.editable||J(s?.result)?(ae(s),!0):!1}function oe(s){switch(s?.status){case"retracted":return"bg-gray-300";case"aproved":return s?.reportable===!1?"bg-orange-600":"";default:return""}}function S(){r.can_cancel=!1,r.can_submit=!1,r.can_retract=!1,r.can_approve=!1,r.can_retest=!1,r.can_reinstate=!1;const s=O();s.length!==0&&(s.every(l=>l.status==="cancelled")&&(r.can_reinstate=!0),s.every(l=>l.status==="pending")&&(r.can_cancel=!0),s.every(l=>["pending"].includes(l.status??"")&&!J(l.result))&&(r.can_submit=!0),s.every(l=>l.status==="resulted")&&(r.can_retract=!0,r.can_approve=!0,r.can_retest=!0))}const k=async()=>{const s=Ve(()=>g.getSample);s.value&&g.fetchSampleStatus(s?.value?.uid)},F=j(!1),V=j(void 0),ne=s=>{F.value=!0,V.value=s};let{submitResults:re,cancelResults:le,reInstateResults:ie,approveResults:ce,retractResults:de,retestResults:ue}=Ie();const _e=()=>re(Z(),"sample",T?.value?.uid).then(()=>k()).finally(()=>x()),pe=()=>le(A()).then(()=>k()).finally(()=>x()),he=()=>ie(A()).then(()=>k()).finally(()=>x()),ye=()=>ce(A(),"sample",T?.value?.uid).then(()=>k()).finally(()=>x()),be=()=>de(A()).then(()=>k()).finally(()=>x()),me=()=>ue(A()).then(()=>k()).finally(()=>x());return(s,l)=>{const d=Ue("font-awesome-icon"),ge=Ee("motion-slide-right");return o(),n(p,null,[Te,Le,Pe,e("div",Ne,[e("div",$e,[i(Y)?(o(),n("div",Be,[_(i(W),{message:"Fetching analytes ..."})])):(o(),n("table",Oe,[e("thead",null,[e("tr",null,[e("th",Fe,[u(e("input",{type:"checkbox",class:"",onChange:te,"onUpdate:modelValue":l[0]||(l[0]=t=>r.allChecked=t)},null,544),[[G,r.allChecked]])]),Me,qe,ze,Ke,je,Ge,Je,We,He,Qe,Xe,Ye,Ze,et,tt])]),e("tbody",st,[(o(!0),n(p,null,y(i(E),t=>u((o(),n("tr",{key:t.uid,class:Ae([oe(t)])},[e("td",null,[u(e("input",{type:"checkbox",class:"border-red-500","onUpdate:modelValue":a=>t.checked=a,onChange:a=>ee(),disabled:K(t)},null,40,at),[[G,t.checked]]),t.status==="pending"?(o(),P(d,{key:0,icon:"fa-question",class:"ml-1 text-xs"})):N("",!0),t.status==="resulted"?(o(),P(d,{key:1,icon:"fa-question",class:"ml-1 text-xs text-orange"})):N("",!0)]),ot,e("td",nt,[e("div",rt,[e("span",{class:"mr-1 hover:cursor-pointer",onClick:a=>ne(t)},[_(d,{icon:"fa-info-circle"})],8,lt),b(" "+c(t.analysis?.name),1)])]),e("td",it,[L(t)?(o(),n("label",dt,[u(e("select",{class:"form-input mt-1 block w-full","onUpdate:modelValue":a=>t.laboratoryInstrumentUid=a,onChange:a=>f(t)},[_t,(o(!0),n(p,null,y(t.analysis?.instruments,a=>(o(),n(p,{key:a.uid},[(o(!0),n(p,null,y(a.laboratoryInstruments,M=>(o(),n("option",{key:M.uid,value:M.uid},c(M.labName)+" â†’ ("+c(a?.name)+") ",9,pt))),128))],64))),128))],40,ut),[[$,t.laboratoryInstrumentUid]])])):(o(),n("div",ct,c(t.laboratoryInstrument?.labName||"---"),1))]),e("td",ht,[L(t)?(o(),n("label",bt,[u(e("select",{class:"form-input mt-1 block w-full","onUpdate:modelValue":a=>t.methodUid=a,onChange:a=>f(t)},[gt,(o(!0),n(p,null,y(t.analysis?.methods,a=>(o(),n("option",{key:a.uid,value:a.uid},c(a.name),9,ft))),128))],40,mt),[[$,t.methodUid]])])):(o(),n("div",yt,c(t.method?.name||"---"),1))]),e("td",xt,[e("div",kt,c(`${t.submittedBy?.firstName??"--"} ${t.submittedBy?.lastName??"--"}`),1)]),e("td",vt,[e("div",wt,[(o(!0),n(p,null,y(t.verifiedBy,a=>(o(),n("span",{key:a.firstName,class:"ml-1"},c(`${a?.firstName??"--"} ${a?.lastName??"--"},`),1))),128))])]),e("td",Rt,[!L(t)||t?.analysis?.interims?.length===0?(o(),n("div",Ct," --- ")):(o(),n("label",Ut,[u(e("select",{class:"form-input mt-1 block w-full","onUpdate:modelValue":a=>t.result=a,onChange:a=>f(t)},[At,(o(!0),n(p,null,y(t?.analysis?.interims,a=>(o(),n("option",{key:a.key,value:a.value},c(a.value),9,St))),128))],40,Et),[[$,t.result]])]))]),e("td",Vt,[L(t)?t?.analysis?.resultOptions?.length===0?(o(),n("label",It,[u(e("input",{class:"form-input mt-1 block w-full","onUpdate:modelValue":a=>t.result=a,onKeyup:a=>f(t)},null,40,Tt),[[Se,t.result]])])):(o(),n("label",Lt,[u(e("select",{class:"form-input mt-1 block w-full","onUpdate:modelValue":a=>t.result=a,onChange:a=>f(t)},[Nt,(o(!0),n(p,null,y(t?.analysis?.resultOptions,a=>(o(),n("option",{key:a.optionKey,value:a.value},c(a.value),9,$t))),128))],40,Pt),[[$,t.result]])])):(o(),n("div",Dt,c(t?.result),1))]),e("td",Bt,[e("div",Ot,[t?.retest?(o(),n("span",Ft,[_(d,{icon:"fa-check-circle"})])):(o(),n("span",Mt,[_(d,{icon:"fa-times-circle"})]))])]),e("td",qt,[e("div",zt,c(i(q)(t?.dueDate)),1)]),e("td",Kt,[e("div",jt,c(i(q)(t?.dateSubmitted)),1)]),e("td",Gt,[e("div",Jt,c(i(q)(t?.dateVerified)),1)]),e("td",Wt,[e("button",Ht,c(t.status),1)]),e("td",Qt,[e("div",Xt,[t?.reportable?(o(),n("span",Yt,[_(d,{icon:"fa-thumbs-up","aria-hidden":"true"})])):(o(),n("span",Zt,[_(d,{icon:"fa-thumbs-down","aria-hidden":"true"})]))])]),es],2)),[[ge]])),128))])]))])]),e("section",ts,[u(_(i(m),{key:"cancel",onClick:w(pe,["prevent"]),color:"sky-800"},{default:h(()=>[b("Cancel")]),_:1},512),[[v,R(U.UPDATE,C.RESULT)&&r.can_cancel]]),u(_(i(m),{key:"reinstate",onClick:w(he,["prevent"]),color:"orange-600"},{default:h(()=>[b("Re-Instate")]),_:1},512),[[v,R(U.UPDATE,C.RESULT)&&r.can_reinstate]]),u(_(i(m),{key:"submit",onClick:w(_e,["prevent"]),color:"orange-600"},{default:h(()=>[b("Submit")]),_:1},512),[[v,R(U.UPDATE,C.RESULT)&&r.can_submit]]),u(_(i(m),{key:"retract",onClick:w(be,["prevent"]),color:"orange-600"},{default:h(()=>[b("Retract")]),_:1},512),[[v,R(U.UPDATE,C.RESULT)&&r.can_retract]]),u(_(i(m),{key:"verify",onClick:w(ye,["prevent"]),color:"orange-600"},{default:h(()=>[b("Verify")]),_:1},512),[[v,R(U.UPDATE,C.RESULT)&&r.can_approve]]),u(_(i(m),{key:"retest",onClick:w(me,["prevent"]),color:"orange-600"},{default:h(()=>[b("Retest")]),_:1},512),[[v,R(U.UPDATE,C.RESULT)&&r.can_retest]])]),_(i(H),{show:F.value,onClose:l[1]||(l[1]=t=>F.value=!1),"content-width":"w-2/4"},{header:h(()=>[ss]),body:h(()=>[V.value?.analysisUid?(o(),P(i(Q),{key:0,analysisUid:V.value?.analysisUid},null,8,["analysisUid"])):N("",!0),V.value?.uid?(o(),P(i(X),{key:1,analysisResultesultUid:V.value?.uid},null,8,["analysisResultesultUid"])):N("",!0)]),_:1},8,["show"])],64)}}}),cs=De(as,[["__file","/home/aurthurm/Documents/Development/felicity/felicity-lims/webapp/views/sample/_id/Results.vue"]]);export{cs as default};
