import{S as j,a7 as R,W as B,i as E,o as i,c as l,N as s,F as w,E as U,y as L,a5 as a,H as u,K as x,A as N,C as A,a2 as P,D as W,a as $,aE as q,Z as O,$ as H,_ as J}from"./index-9a11e11f.js";import{u as K}from"./samples-5de26ccb.js";import{u as Z,a as G}from"./storage-3144c671.js";import{c as Q,d as X,u as Y,e as z}from"./array-6d6c7e05.js";import"./analyses.mutations-f8d881c0.js";import"./storage.mutations-bf427a4a.js";const M=(b,S,C,v)=>{const h="ABCDEFGHIJKLMNOPQRSTUVWXYZ".split("").slice(0,b),m=Array.from({length:S},(d,r)=>r+1);if(C)return Array.from({length:(S??1)*b},(d,r)=>r+1).map(d=>({storageSlot:d.toString(),storageSlotIndex:d}));{const d=[];let r=1;return v?h.forEach((c,y)=>{m.forEach(o=>{d.push({storageSlot:c+o.toString(),storageSlotIndex:r}),r++})}):m.forEach(c=>{h.forEach((y,o)=>{d.push({storageSlot:y+c.toString(),storageSlotIndex:r}),r++})}),d}},ee={class:"space-y-6"},se={class:"grid grid-cols-12 gap-6 min-h-full"},te={class:"col-span-2 bg-secondary rounded-lg shadow-sm p-4"},oe={class:"space-y-2"},ae={class:"col-span-7 space-y-6"},re={class:"bg-background rounded-lg shadow-sm p-6"},ne={key:0},ie={class:"grid grid-cols-2 gap-6"},le={class:"space-y-4"},de={class:"flex items-center justify-between"},ce={class:"text-muted-foreground"},ue={class:"flex items-center justify-between"},me={class:"flex items-center gap-2"},pe={class:"text-muted-foreground"},ge={key:0,class:"text-sm text-muted-foreground bg-muted px-2 py-1 rounded-md"},fe={class:"space-y-4"},ve={class:"flex items-center justify-between"},_e={class:"text-muted-foreground"},Se={class:"flex items-center justify-between"},he={class:"text-muted-foreground"},ye={key:1,class:"text-muted-foreground"},xe={class:"flex justify-end"},be={class:"space-y-4"},Ce={class:"col-span-1 text-muted-foreground"},we={class:"col-span-1 text-muted-foreground"},Ue={class:"col-span-10"},ke={class:"flex items-center gap-4"},Ie=["onUpdate:modelValue"],Ee=["value"],Ae=["onClick"],De={class:"flex justify-end pt-4"},Ve={key:0,type:"submit",class:"px-6 py-2 bg-destructive text-destructive-foreground rounded-md hover:bg-destructive/90 transition-colors duration-200 focus:outline-none focus:ring-2 focus:ring-destructive/50"},Fe=j({__name:"StoreSamples",setup(b){const S=O(()=>H(()=>import("./FelTreeItem-c6e8c571.js"),["assets/FelTreeItem-c6e8c571.js","assets/index-9a11e11f.js","assets/index-f2df9813.css","assets/storage-3144c671.js"])),{treeData:C,tags:v,activeTree:_,resetActiveTree:h}=Z();h();const m=G(),{storeSamples:d}=K();let r=JSON.parse(window.history.state.samples),c=[];const y=n=>{c=[],g.value.forEach(e=>{e.sampleUid&&c.push(e.sampleUid?.toString())})};R(()=>m.fetchStorageTree()),B(()=>_.value,(n,e)=>{n.tag==="storage-container"&&(m.fetchStorageContainer(n.uid),g.value=[])},{deep:!0});const o=E(()=>m.getStorageContainer),D=E(()=>{const n=m.getStorageContainer;return(n?.slots??0)-(n?.storedCount??0)}),k=()=>{r=[...r,...o.value?.samples??[]],g.value=[],M(o.value?.cols??1,o.value?.rows??1,!o.value?.grid,o.value?.rowWise??!1).map(e=>({...e,storageContainerUid:o.value?.uid})).forEach(e=>{const t=r.filter(f=>f.storageSlotIndex===e.storageSlotIndex&&f.storageContainerUid===e.storageContainerUid);t.length>0&&(e={...e,sampleUid:t[0].uid},c.push(e.sampleUid.toString())),g.value.push({sampleUid:void 0,...e})})},V=Q({samples:X().required().min(1,"Select At least one sample")}),{handleSubmit:F,errors:Te}=Y({validationSchema:V,initialValues:{priority:0,samples:o.value?.samples??[]}}),{value:g}=z("samples"),T=n=>{g.value=g.value.map(e=>(e.sampleUid===n&&(e={...e,sampleUid:void 0}),e)),c=c.filter(e=>+e!==n)},I=F(async n=>{const e=n.samples.filter(t=>t.sampleUid);await d(e).then(async t=>{await m.fetchStorageContainer(e[0].storageContainerUid),k()})});return(n,e)=>(i(),l("div",ee,[e[8]||(e[8]=s("h4",{class:"text-xl font-semibold text-foreground"},"Store Samples",-1)),s("div",se,[s("div",te,[s("ul",oe,[(i(!0),l(w,null,U(a(C),(t,f)=>(i(),L(a(S),{tree:t,key:f},null,8,["tree"]))),128))])]),s("div",ae,[s("div",re,[a(_).tag===a(v).storageContainer?(i(),l("div",ne,[s("div",ie,[s("div",le,[s("div",de,[e[2]||(e[2]=s("span",{class:"font-medium text-foreground"},"Name",-1)),s("span",ce,u(o.value?.name),1)]),s("div",ue,[e[3]||(e[3]=s("span",{class:"font-medium text-foreground"},"Layout",-1)),s("div",me,[s("span",pe,u(o.value?.grid?"grid":"column"),1),o.value?.grid?(i(),l("span",ge,u(o.value?.rowWise?"by-row":"by-column"),1)):x("v-if",!0)])])]),s("div",fe,[s("div",ve,[e[4]||(e[4]=s("span",{class:"font-medium text-foreground"},"Slots",-1)),s("span",_e,u(o.value?.slots),1)]),s("div",Se,[e[5]||(e[5]=s("span",{class:"font-medium text-foreground"},"Empty Slots",-1)),s("span",he,u(D.value),1)])])])])):(i(),l("div",ye,"Please select a storage container"))]),s("div",xe,[a(_).tag===a(v).storageContainer?(i(),l("button",{key:0,onClick:e[0]||(e[0]=t=>k()),class:"px-4 py-2 bg-primary text-primary-foreground rounded-md hover:bg-primary/90 transition-colors duration-200 focus:outline-none focus:ring-2 focus:ring-primary/50"}," Reset Slots ")):x("v-if",!0)]),s("form",{action:"post",class:"bg-background rounded-lg shadow-sm p-6 space-y-6",onSubmit:e[1]||(e[1]=N((...t)=>a(I)&&a(I)(...t),["prevent"]))},[e[6]||(e[6]=s("div",{class:"grid grid-cols-12 gap-4 text-sm font-medium text-foreground"},[s("div",{class:"col-span-1"},"Position"),s("div",{class:"col-span-1"},"Label"),s("div",{class:"col-span-10"},"Sample")],-1)),s("div",be,[(i(!0),l(w,null,U(a(g),(t,f)=>(i(),l("div",{key:f,class:"grid grid-cols-12 gap-4 items-center py-4 border-b border-border last:border-0"},[s("div",Ce,u(t.storageSlotIndex),1),s("div",we,u(t.storageSlot),1),s("div",Ue,[s("div",ke,[A(s("select",{name:"sampleUid",id:"sampleUid","onUpdate:modelValue":p=>t.sampleUid=p,class:"w-64 px-3 py-2 bg-background border border-border rounded-md focus:outline-none focus:ring-2 focus:ring-primary/50",onChange:y,"aria-label":"Select sample"},[(i(!0),l(w,null,U(a(r),p=>A((i(),l("option",{key:p.uid,value:p.uid},u(p?.sampleId)+" ❲"+u(p?.analysisRequest?.clientRequestId)+"❳ ",9,Ee)),[[W,!a(c).includes(p.uid.toString())]])),128))],40,Ie),[[P,t.sampleUid]]),t.sampleUid?(i(),l("button",{key:0,onClick:p=>T(t.sampleUid),class:"text-destructive hover:text-destructive/80 transition-colors","aria-label":"Remove sample"},[$(a(q),{icon:"ban"})],8,Ae)):x("v-if",!0)])])]))),128))]),s("div",De,[a(_).tag===a(v).storageContainer&&a(r)?.length>0?(i(),l("button",Ve," Store Samples ")):x("v-if",!0)])],32)]),e[7]||(e[7]=s("div",{class:"col-span-3"},null,-1))])]))}}),We=J(Fe,[["__file","/home/aurthurm/Documents/Development/felicity/felicity-lims/webapp/views/sample/StoreSamples.vue"]]);export{We as default};
