import{P as Ve,M as Se,a9 as Ee,Q as Ae,Z as p,h as $e,f as De,r as J,$ as Q,o as n,c as l,A as i,a as k,a2 as r,a7 as X,b as t,K as Y,L as Z,z as m,C as h,W as G,F as v,D as g,a1 as ee,J as te,x as Te,E as d,a4 as D,V as Ie,X as B,Y as q,ap as We,_ as Ne}from"./index-fa13e788.js";import{u as Oe}from"./worksheet-7165f6fe.js";import{u as Pe}from"./analysis-265e51d4.js";import{u as Ke}from"./user-c399b7d7.js";import{u as Me}from"./setup-8d8c5945.js";import{h as w,o as U,a as R}from"./constants-68671847.js";import"./analyses.mutations-bfee3c87.js";import"./_queries-fa6c96fd.js";const Be={class:""},qe=t("hr",{class:"mt-4"},null,-1),Le={class:"flex justify-between items-center"},Fe={action:"post",class:"p-1"},He={class:"flex justify-start items-center gap-x-4 mb-4"},je={class:"ml-6 mt-2"},ze=t("hr",{class:"mb-4"},null,-1),Je={class:"overflow-x-auto"},Qe={class:"align-middle inline-block min-w-full shadow overflow-hidden bg-white shadow-dashboard px-2 pt-1 rounded-bl-lg rounded-br-lg"},Xe={class:"min-w-full"},Ye={class:"px-1 py-1 border-b-2 border-gray-300 text-left leading-4 text-gray-800 tracking-wider"},Ze=t("th",{class:"px-1 py-1 border-b-2 border-gray-300 text-left leading-4 text-gray-800 tracking-wider"},null,-1),Ge=t("th",{class:"px-1 py-1 border-b-2 border-gray-300 text-left leading-4 text-gray-800 tracking-wider"}," Sample ID ",-1),et=t("th",{class:"px-1 py-1 border-b-2 border-gray-300 text-left text-sm leading-4 text-gray-800 tracking-wider"}," Analysis/Test ",-1),tt=t("th",{class:"px-1 py-1 border-b-2 border-gray-300 text-left text-sm leading-4 text-gray-800 tracking-wider"}," Instrument ",-1),st=t("th",{class:"px-1 py-1 border-b-2 border-gray-300 text-left text-sm leading-4 text-gray-800 tracking-wider"}," Method ",-1),ot=t("th",{class:"px-1 py-1 border-b-2 border-gray-300 text-left text-sm leading-4 text-gray-800 tracking-wider"}," Interim ",-1),at=t("th",{class:"px-1 py-1 border-b-2 border-gray-300 text-left text-sm leading-4 text-gray-800 tracking-wider"}," Result ",-1),nt=t("th",{class:"px-1 py-1 border-b-2 border-gray-300 text-left text-sm leading-4 text-gray-800 tracking-wider"}," Unit ",-1),lt=t("th",{class:"px-1 py-1 border-b-2 border-gray-300 text-left text-sm leading-4 text-gray-800 tracking-wider"}," Status ",-1),rt={class:"bg-white"},it=["onUpdate:modelValue","disabled"],dt={class:"px-1 py-1 whitespace-no-wrap border-b border-gray-500"},ut={class:"px-1 py-1 whitespace-no-wrap border-b border-gray-500"},ct={class:"text-sm leading-5 text-gray-800 font-semibold"},pt={key:1},mt={key:0},ht={class:"px-1 py-1 whitespace-no-wrap border-b border-gray-500"},yt={class:"px-1 py-1 whitespace-no-wrap border-b border-gray-500"},bt={key:0,class:"text-sm leading-5 text-sky-800"},_t={key:1,class:"block col-span-2 mb-2"},vt=["onUpdate:modelValue","onChange"],ft=t("option",{value:""},null,-1),kt=["value"],gt={class:"px-1 py-1 whitespace-no-wrap border-b border-gray-500"},xt={key:0,class:"text-sm leading-5 text-sky-800"},wt={key:1,class:"block col-span-2 mb-2"},Ut=["onUpdate:modelValue","onChange"],Rt=t("option",{value:""},null,-1),Ct=["value"],Vt={class:"px-1 py-1 whitespace-no-wrap border-b border-gray-500"},St={key:0,class:"text-sm leading-5 text-sky-800"},Et={key:1,class:"block col-span-2 mb-2"},At=["onUpdate:modelValue","onChange"],$t=t("option",{value:""},null,-1),Dt=["value"],Tt={class:"px-1 py-1 whitespace-no-wrap border-b border-gray-500"},It={key:0},Wt={key:1,class:"block"},Nt=["onUpdate:modelValue","onKeyup"],Ot={key:2,class:"block col-span-2 mb-2"},Pt=["onUpdate:modelValue","onChange"],Kt=t("option",{value:""},null,-1),Mt=["value"],Bt={class:"px-1 py-1 whitespace-no-wrap border-b border-gray-500"},qt={class:"px-1 py-1 whitespace-no-wrap border-b border-gray-500"},Lt={type:"button",class:"bg-sky-800 text-white py-1 px-2 rounded-sm leading-none"},Ft={class:"my-4"},Ht=Ve({__name:"WorkSheetResults",setup(jt){const se=B(()=>q(()=>import("./FelButton-1d1ff19a.js"),["assets/FelButton-1d1ff19a.js","assets/index-fa13e788.js","assets/index-ccc6a521.css"])),T=B(()=>q(()=>import("./FelSelect-7739d6be.js"),["assets/FelSelect-7739d6be.js","assets/index-fa13e788.js","assets/index-ccc6a521.css"])),oe=B(()=>q(()=>import("./FelSwitch-db1eabf1.js"),["assets/FelSwitch-db1eabf1.js","assets/index-fa13e788.js","assets/index-ccc6a521.css"])),I=Se(),C=Me(),L=Ke(),F=Ee(),ae=Ae();let W=p(!1),N=p(!1),O=p(!1),P=p(!1),K=p(!1),M=p(!1),y=p(!1),x=p(!1),u=$e(()=>I.getWorkSheet);const H=()=>{I.fetchWorksheetByUid(F.params.workSheetUid)};L.fetchUsers({}),C.fetchLaboratoryInstruments(),C.fetchMethods();const b=De({analystUid:null,instrumentUid:null,methodUid:null}),V=p(!1),ne=()=>{V.value=!0,I.updateWorksheet({worksheetUid:F.params.workSheetUid,...b}).then(()=>{V.value=!1,H()})};function le(){return u.value?.analysisResults?.every(o=>o.checked===!0)}function S(){let o=[];return u.value?.analysisResults?.forEach(s=>{s.checked&&o.push(s)}),o}function re(){le()?y.value=!0:y.value=!1,$()}function f(o){if(j(o)){z(o);return}o.checked=!0,$()}function j(o){return["retracted","approved"].includes(o.status)}function z(o){o.checked=!1,$()}function ie(){u?.value?.analysisResults?.forEach(o=>y.value?f(o):z(o)),$()}function de(o){o.editable=!0}function E(o){return o.status!=="pending"?!1:o?.editable||We(o?.result)?(de(o),!0):!1}function ue(){let o=S(),s=[];return o?.forEach(c=>s.push({uid:c.uid,result:c.result,laboratoryInstrumentUid:c.laboratoryInstrumentUid,methodUid:c.methodUid})),s}function A(){const o=S();let s=[];return o?.forEach(c=>s.push(c.uid)),s}function ce(){const o=S();let s=[];return o?.forEach(c=>s.push(c.sample?.uid)),s}function pe(o){switch(o?.status){case"retracted":return"bg-gray-300 text-sm italic text-gray-500";default:return"text-sm leading-5 text-sky-800"}}function $(){W.value=!1,K.value=!1,N.value=!1,O.value=!1,P.value=!1,M.value=!1;const o=S();o.length!==0&&(M.value=!0,o.every(s=>s.status==="pending")&&(W.value=!0,K.value=!0),o.every(s=>s.status==="resulted")&&(N.value=!0,O.value=!0,P.value=!0))}const{submitResults:me,approveResults:he,retractResults:ye,retestResults:be}=Pe(),{unAssignSamples:_e}=Oe(),ve=()=>_e(A()),fe=()=>me(ue(),"worksheet",u.value?.uid),ke=()=>he(A(),"worksheet",u.value?.uid),ge=()=>ye(A()),xe=()=>be(A()),we=async()=>{window.open(ae.resolve({name:"print-barcodes",query:{sampleUids:JSON.stringify(ce().join(","))}}).href,"_blank")};return(o,s)=>{const c=J("font-awesome-icon"),Ue=J("router-link"),Re=Q("motion-slide-left"),Ce=Q("motion-slide-right");return n(),l("div",Be,[qe,i((n(),l("div",Le,[k(r(oe),{modelValue:r(x),"onUpdate:modelValue":s[0]||(s[0]=e=>X(x)?x.value=e:x=e),label:"More Sample Detail"},null,8,["modelValue"]),i(t("form",Fe,[t("div",He,[k(r(T),{label:"Analyst",name:"analyst_uid",modelValue:b.analystUid,"onUpdate:modelValue":s[1]||(s[1]=e=>b.analystUid=e),options:r(L).users.map(e=>({value:e.uid,label:`${e.firstName} ${e.lastName}`})),disabled:r(u)?.state!=="pending"},null,8,["modelValue","options","disabled"]),k(r(T),{label:"Instrument",name:"instrument_uid",modelValue:b.instrumentUid,"onUpdate:modelValue":s[2]||(s[2]=e=>b.instrumentUid=e),options:r(C).laboratoryInstruments.map(e=>({value:e.uid,label:`${e?.instrument.name} (${e?.labName})`})),disabled:r(u)?.state!=="pending"},null,8,["modelValue","options","disabled"]),k(r(T),{label:"Method",name:"method_uid",modelValue:b.methodUid,"onUpdate:modelValue":s[3]||(s[3]=e=>b.methodUid=e),options:r(C).methods.map(e=>({value:e.uid,label:`${e.name}`})),disabled:r(u)?.state!=="pending"},null,8,["modelValue","options","disabled"]),t("div",je,[k(r(se),{onClick:s[4]||(s[4]=m(e=>ne(),["prevent"])),color:"sky-800",class:"p-1",disabled:!0},{default:Y(()=>[Z("Apply")]),_:1})])])],512),[[h,!V.value]]),i(t("p",null,"updating ...",512),[[h,V.value]]),t("div",null,[t("button",{onClick:s[5]||(s[5]=m(e=>H(),["prevent"])),class:"px-1 py-1 mr-2 border-sky-800 border text-sky-800 rounded-sm transition duration-300 hover:bg-sky-800 hover:text-white focus:outline-none"}," Refresh ")])])),[[Re]]),ze,t("div",Je,[t("div",Qe,[t("table",Xe,[t("thead",null,[t("tr",null,[t("th",Ye,[i(t("input",{type:"checkbox",class:"",onChange:s[6]||(s[6]=e=>ie()),"onUpdate:modelValue":s[7]||(s[7]=e=>X(y)?y.value=e:y=e)},null,544),[[G,r(y)]])]),Ze,Ge,et,tt,st,ot,at,nt,lt])]),t("tbody",rt,[(n(!0),l(v,null,g(r(u)?.analysisResults,e=>i((n(),l("tr",{key:e.uid,class:ee([pe(e)])},[t("td",null,[i(t("input",{type:"checkbox",class:"","onUpdate:modelValue":a=>e.checked=a,onChange:s[8]||(s[8]=a=>re()),disabled:j(e)},null,40,it),[[G,e.checked]])]),t("td",dt,[(e?.sample?.priority??0)>0?(n(),l("span",{key:0,class:ee(["font-small",{"text-orange-600":(r(u)?.priority??0)>1}])},[k(c,{icon:"fa-star"})],2)):te("",!0)]),t("td",ut,[t("div",ct,[e?.sample?.analysisRequest?.patient?.uid?(n(),Te(Ue,{key:0,to:{name:"sample-detail",params:{patientUid:e?.sample?.analysisRequest?.patient?.uid,sampleUid:e?.sample?.uid}}},{default:Y(()=>[Z(d(e?.sample?.sampleId),1)]),_:2},1032,["to"])):(n(),l("div",pt,d(e?.sample?.sampleId),1))]),r(x)?(n(),l("span",mt,[t("span",null,d(e?.sample?.qcLevel?.level),1),t("div",null,d(e?.sample?.analysisRequest?.patient?.firstName)+" "+d(e?.sample?.analysisRequest?.patient?.lastName),1),t("div",null,d(e?.sample?.analysisRequest?.client?.name),1)])):te("",!0)]),t("td",ht,[t("div",null,d(e?.analysis?.name),1)]),t("td",yt,[E(e)?(n(),l("label",_t,[i(t("select",{class:"form-input mt-1 block w-full","onUpdate:modelValue":a=>e.laboratoryInstrumentUid=a,onChange:a=>f(e)},[ft,(n(!0),l(v,null,g(e.analysis?.instruments,a=>(n(),l(v,{key:a.uid},[(n(!0),l(v,null,g(a.laboratoryInstruments,_=>(n(),l("option",{key:_.uid,value:_.uid},d(_.labName)+" â†’ ("+d(a?.name)+") ",9,kt))),128))],64))),128))],40,vt),[[D,e.laboratoryInstrumentUid]])])):(n(),l("div",bt,d(e.laboratoryInstrument?.labName||"---"),1))]),t("td",gt,[E(e)?(n(),l("label",wt,[i(t("select",{class:"form-input mt-1 block w-full","onUpdate:modelValue":a=>e.methodUid=a,onChange:a=>f(e)},[Rt,(n(!0),l(v,null,g(e.analysis?.methods,a=>(n(),l("option",{key:a.uid,value:a.uid},d(a.name),9,Ct))),128))],40,Ut),[[D,e.methodUid]])])):(n(),l("div",xt,d(e.method?.name||"---"),1))]),t("td",Vt,[!E(e)||(e?.analysis?.interims?.length??0)===0?(n(),l("div",St," --- ")):(n(),l("label",Et,[i(t("select",{class:"form-input mt-1 block w-full","onUpdate:modelValue":a=>e.result=a,onChange:a=>f(e)},[$t,(n(!0),l(v,null,g(e?.analysis?.interims,(a,_)=>(n(),l("option",{key:a.key||_,value:a.value},d(a.value),9,Dt))),128))],40,At),[[D,e.result]])]))]),t("td",Tt,[E(e)?e?.analysis?.resultOptions?.length===0?(n(),l("label",Wt,[i(t("input",{class:"form-input mt-1 block w-full","onUpdate:modelValue":a=>e.result=a,onKeyup:a=>f(e)},null,40,Nt),[[Ie,e.result]])])):(n(),l("label",Ot,[i(t("select",{class:"form-input mt-1 block w-full","onUpdate:modelValue":a=>e.result=a,onChange:a=>f(e)},[Kt,(n(!0),l(v,null,g(e?.analysis?.resultOptions,(a,_)=>(n(),l("option",{key:a.optionKey||_,value:a.value},d(a.value),9,Mt))),128))],40,Pt),[[D,e.result]])])):(n(),l("div",It,d(e?.result),1))]),t("td",Bt,[t("div",null,d(e?.analysis?.unit?.name||"---"),1)]),t("td",qt,[t("button",Lt,d(e?.status||"unknown"),1)])],2)),[[Ce]])),128))])])])]),t("section",Ft,[i(t("button",{onClick:s[9]||(s[9]=m(e=>ve(),["prevent"])),class:"px-2 py-1 mr-2 border-sky-800 border text-sky-800 rounded-sm transition duration-300 hover:bg-sky-800 hover:text-white focus:outline-none"}," Un Assign ",512),[[h,w(R.CREATE,U.WORKSHEET)&&r(K)]]),i(t("button",{onClick:s[10]||(s[10]=m(e=>fe(),["prevent"])),class:"px-2 py-1 mr-2 border-sky-800 border text-sky-800 rounded-sm transition duration-300 hover:bg-sky-800 hover:text-white focus:outline-none"}," Submit ",512),[[h,w(R.UPDATE,U.WORKSHEET)&&r(W)]]),i(t("button",{onClick:s[11]||(s[11]=m(e=>ge(),["prevent"])),class:"px-2 py-1 mr-2 border-sky-800 border text-sky-800 rounded-sm transition duration-300 hover:bg-sky-800 hover:text-white focus:outline-none"}," Retract ",512),[[h,w(R.UPDATE,U.WORKSHEET)&&r(N)]]),i(t("button",{onClick:s[12]||(s[12]=m(e=>ke(),["prevent"])),class:"px-2 py-1 mr-2 border-sky-800 border text-sky-800 rounded-sm transition duration-300 hover:bg-sky-800 hover:text-white focus:outline-none"}," Approve ",512),[[h,w(R.UPDATE,U.WORKSHEET)&&r(O)]]),i(t("button",{onClick:s[13]||(s[13]=m(e=>xe(),["prevent"])),class:"px-2 py-1 mr-2 border-sky-800 border text-sky-800 rounded-sm transition duration-300 hover:bg-sky-800 hover:text-white focus:outline-none"}," Retest ",512),[[h,w(R.UPDATE,U.WORKSHEET)&&r(P)]]),i(t("button",{onClick:m(we,["prevent"]),class:"px-2 py-1 mr-2 border-sky-800 border text-sky-800 rounded-sm transition duration-300 hover:bg-sky-800 hover:text-white focus:outline-none"}," Print Barcodes ",512),[[h,r(M)]])])])}}}),ts=Ne(Ht,[["__file","/home/aurthurm/Documents/Development/felicity/felicity-lims/webapp/views/worksheet/_id/WorkSheetResults.vue"]]);export{ts as default};
