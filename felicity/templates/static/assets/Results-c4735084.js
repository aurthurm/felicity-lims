import{d as ge,N as xe,K as ke,W as ve,s as we,q as Re,y as Ce,V as Ue,r as z,m as Ee,z as Se,o,c as n,b as e,f as i,g as _,e as u,at as W,F as y,E as k,I as Ae,A as N,D as $,C as p,t as c,as as B,v as Ve,aG as K,P as v,B as h,w,j as D,_ as I,aR as G,x as De,k as Ie}from"./index-53659ec0.js";import{u as Te}from"./analysis-b9b3d92b.js";import{h as R,o as C,a as U}from"./constants-aa98a836.js";const Le=e("hr",{class:"mt-4 mb-2"},null,-1),Pe=e("h3",{class:"font-bold"},"Analyses/Results",-1),Ne=e("hr",{class:"mb-4 mt-2"},null,-1),$e={class:"overflow-x-auto"},Be={class:"align-middle inline-block min-w-full shadow overflow-hidden bg-white shadow-dashboard px-2 pt-1 rounded-bl-lg rounded-br-lg"},Me={key:0,class:"py-4 text-center"},Oe={key:1,class:"min-w-full"},Fe={class:"px-1 py-1 border-b-2 border-gray-300 text-left leading-4 text-gray-800 tracking-wider"},Ke=e("th",{class:"px-1 py-1 border-b-2 border-gray-300 text-left leading-4 text-gray-800 tracking-wider"},null,-1),je=e("th",{class:"px-1 py-1 border-b-2 border-gray-300 text-left leading-4 text-gray-800 tracking-wider"}," Analysis ",-1),qe=e("th",{class:"px-1 py-1 border-b-2 border-gray-300 text-left text-sm leading-4 text-gray-800 tracking-wider"}," Instrument ",-1),ze=e("th",{class:"px-1 py-1 border-b-2 border-gray-300 text-left text-sm leading-4 text-gray-800 tracking-wider"}," Method ",-1),We=e("th",{class:"px-1 py-1 border-b-2 border-gray-300 text-left text-sm leading-4 text-gray-800 tracking-wider"}," Analyst ",-1),Ge=e("th",{class:"px-1 py-1 border-b-2 border-gray-300 text-left text-sm leading-4 text-gray-800 tracking-wider"}," Reviewer(s) ",-1),He=e("th",{class:"px-1 py-1 border-b-2 border-gray-300 text-left text-sm leading-4 text-gray-800 tracking-wider"}," Interim ",-1),Je=e("th",{class:"px-1 py-1 border-b-2 border-gray-300 text-left text-sm leading-4 text-gray-800 tracking-wider"}," Result ",-1),Qe=e("th",{class:"px-1 py-1 border-b-2 border-gray-300 text-left text-sm leading-4 text-gray-800 tracking-wider"}," Retest ",-1),Xe=e("th",{class:"px-1 py-1 border-b-2 border-gray-300 text-left text-sm leading-4 text-gray-800 tracking-wider"}," Due Date ",-1),Ye=e("th",{class:"px-1 py-1 border-b-2 border-gray-300 text-left text-sm leading-4 text-gray-800 tracking-wider"}," Submitted ",-1),Ze=e("th",{class:"px-1 py-1 border-b-2 border-gray-300 text-left text-sm leading-4 text-gray-800 tracking-wider"}," Approved ",-1),et=e("th",{class:"px-1 py-1 border-b-2 border-gray-300 text-left text-sm leading-4 text-gray-800 tracking-wider"}," Status ",-1),tt=e("th",{class:"px-1 py-1 border-b-2 border-gray-300 text-left text-sm leading-4 text-gray-800 tracking-wider"}," Reportable ",-1),st=e("th",{class:"px-1 py-1 border-b-2 border-gray-300"},null,-1),at={class:"bg-white"},ot=["onUpdate:modelValue","onChange","disabled"],nt=e("td",{class:"px-1 py-1 whitespace-no-wrap border-b border-gray-500"},null,-1),rt={class:"px-1 py-1 whitespace-no-wrap border-b border-gray-500"},lt={class:"text-sm leading-5 text-sky-800 font-semibold"},it=["onClick"],ct={class:"px-1 py-1 whitespace-no-wrap border-b border-gray-500"},dt={key:0,class:"text-sm leading-5 text-sky-800"},ut={key:1,class:"block col-span-2 mb-2"},_t=["onUpdate:modelValue","onChange"],pt=e("option",{value:""},null,-1),ht=["value"],yt={class:"flex justify-start items-center gap-x-1"},bt={class:"text-xs font-thin text-gray-300"},mt={class:"px-1 py-1 whitespace-no-wrap border-b border-gray-500"},ft={key:0,class:"text-sm leading-5 text-sky-800"},gt={key:1,class:"block col-span-2 mb-2"},xt=["onUpdate:modelValue","onChange"],kt=e("option",{value:""},null,-1),vt=["value"],wt={class:"px-1 py-1 whitespace-no-wrap border-b border-gray-500"},Rt={class:"text-sm leading-5 text-sky-800"},Ct={class:"px-1 py-1 whitespace-no-wrap border-b border-gray-500"},Ut={class:"text-sm leading-5 text-sky-800"},Et={class:"px-1 py-1 whitespace-no-wrap border-b border-gray-500"},St={key:0,class:"text-sm leading-5 text-sky-800"},At={key:1,class:"block col-span-2 mb-2"},Vt=["onUpdate:modelValue","onChange"],Dt=e("option",{value:""},null,-1),It=["value"],Tt={class:"px-1 py-1 whitespace-no-wrap border-b border-gray-500"},Lt={key:0,class:"text-sm leading-5 text-sky-800"},Pt={key:1,class:"block"},Nt=["onUpdate:modelValue","onKeyup"],$t={key:2,class:"block col-span-2 mb-2"},Bt=["onUpdate:modelValue","onChange"],Mt=e("option",{value:""},null,-1),Ot=["value"],Ft={class:"px-1 py-1 whitespace-no-wrap border-b border-gray-500"},Kt={class:"text-sm leading-5 text-sky-800"},jt={key:0,class:"text-sky-800"},qt={key:1,class:"text-orange-600"},zt={class:"px-1 py-1 whitespace-no-wrap border-b border-gray-500"},Wt={class:"text-sm leading-5 text-sky-800"},Gt={class:"px-1 py-1 whitespace-no-wrap border-b border-gray-500"},Ht={class:"text-sm leading-5 text-sky-800"},Jt={class:"px-1 py-1 whitespace-no-wrap border-b border-gray-500"},Qt={class:"text-sm leading-5 text-sky-800"},Xt={class:"px-1 py-1 whitespace-no-wrap border-b border-gray-500"},Yt={type:"button",class:"bg-sky-800 text-white px-2 py-1 rounded-sm leading-none"},Zt={class:"px-1 py-1 whitespace-no-wrap border-b border-gray-500"},es={class:"text-sm leading-5 text-sky-800"},ts={key:0,class:"text-emerald-600"},ss={key:1,class:"text-orange-600"},as=e("td",{class:"px-1 py-1 whitespace-no-wrap text-right border-b border-gray-500 text-sm leading-5"},null,-1),os={class:"my-4"},ns=e("h3",null,"Result Information",-1),rs=ge({__name:"Results",setup(ls){const b=D(()=>I(()=>import("./FelButton-29967816.js"),["assets/FelButton-29967816.js","assets/index-53659ec0.js","assets/index-5e1ff226.css"])),H=D(()=>I(()=>import("./FelLoadingMessage-95452cc5.js"),["assets/FelLoadingMessage-95452cc5.js","assets/index-53659ec0.js","assets/index-5e1ff226.css"])),J=D(()=>I(()=>import("./FelDrawer-51aa07ed.js"),["assets/FelDrawer-51aa07ed.js","assets/index-53659ec0.js","assets/index-5e1ff226.css"])),Q=D(()=>I(()=>import("./AnalysisSneak-9eb2e2dd.js"),["assets/AnalysisSneak-9eb2e2dd.js","assets/index-53659ec0.js","assets/index-5e1ff226.css"])),X=D(()=>I(()=>import("./ResultDetail-3ba549af.js"),["assets/ResultDetail-3ba549af.js","assets/index-53659ec0.js","assets/index-5e1ff226.css"])),M=xe(),T=ke(),m=ve(),{sample:L,analysisResults:E,fetchingResults:Y}=we(m),r=Re({can_submit:!1,can_cancel:!1,can_retract:!1,can_approve:!1,can_retest:!1,can_reinstate:!1,allChecked:!1});Ce(()=>{T.fetchLaboratoryInstruments(),T.fetchMethods(),m.fetchAnalysisResultsForSample(M.params.sampleUid)}),Ue(()=>M.params.sampleUid,(s,l)=>{m.resetSample(),m.fetchAnalysisResultsForSample(M.params.sampleUid)});function O(){let s=[];return E?.value?.forEach(l=>{l.checked&&s.push(l)}),s}function Z(){let s=O(),l=[];return s?.forEach(d=>l.push({uid:d.uid,result:d.result,methodUid:d.methodUid,laboratoryInstrumentUid:d.laboratoryInstrumentUid})),l}function S(){const s=O();let l=[];return s?.forEach(d=>l.push(d.uid)),l}function ee(s){se()?r.allChecked=!0:r.allChecked=!1,A()}function f(s){q(s)||(s.checked=!0,A())}function j(s){s.checked=!1,A()}async function te(){await E?.value?.forEach(s=>r.allChecked?f(s):j(s)),A()}async function g(){await E?.value?.forEach(s=>j(s)),A()}function se(){return E?.value?.every(s=>s.checked===!0)}function q(s){switch(s?.status){case"retracted":return!0;case"approved":return!0;case"cancelled":return L?.value?.status!=="received";default:return!1}}function ae(s){s.editable=!0}function P(s){return!["received","paired"].includes(L?.value?.status??"")||s.status!=="pending"?!1:s?.editable||G(s?.result)?(ae(s),!0):!1}function oe(s){switch(s?.status){case"retracted":return"bg-gray-300";case"aproved":return s?.reportable===!1?"bg-orange-600":"";default:return""}}function A(){r.can_cancel=!1,r.can_submit=!1,r.can_retract=!1,r.can_approve=!1,r.can_retest=!1,r.can_reinstate=!1;const s=O();s.length!==0&&(s.every(l=>l.status==="cancelled")&&(r.can_reinstate=!0),s.every(l=>l.status==="pending")&&(r.can_cancel=!0),s.every(l=>["pending"].includes(l.status??"")&&!G(l.result))&&(r.can_submit=!0),s.every(l=>l.status==="resulted")&&(r.can_retract=!0,r.can_approve=!0,r.can_retest=!0))}const x=async()=>{const s=De(()=>m.getSample);s.value&&m.fetchSampleStatus(s?.value?.uid)},F=z(!1),V=z(void 0),ne=s=>{F.value=!0,V.value=s};let{submitResults:re,cancelResults:le,reInstateResults:ie,approveResults:ce,retractResults:de,retestResults:ue}=Te();const _e=()=>re(Z(),"sample",L?.value?.uid).then(()=>x()).finally(()=>g()),pe=()=>le(S()).then(()=>x()).finally(()=>g()),he=()=>ie(S()).then(()=>x()).finally(()=>g()),ye=()=>ce(S(),"sample",L?.value?.uid).then(()=>x()).finally(()=>g()),be=()=>de(S()).then(()=>x()).finally(()=>g()),me=()=>ue(S()).then(()=>x()).finally(()=>g());return(s,l)=>{const d=Ee("font-awesome-icon"),fe=Se("motion-slide-right");return o(),n(y,null,[Le,Pe,Ne,e("div",$e,[e("div",Be,[i(Y)?(o(),n("div",Me,[_(i(H),{message:"Fetching analytes ..."})])):(o(),n("table",Oe,[e("thead",null,[e("tr",null,[e("th",Fe,[u(e("input",{type:"checkbox",class:"",onChange:te,"onUpdate:modelValue":l[0]||(l[0]=t=>r.allChecked=t)},null,544),[[W,r.allChecked]])]),Ke,je,qe,ze,We,Ge,He,Je,Qe,Xe,Ye,Ze,et,tt,st])]),e("tbody",at,[(o(!0),n(y,null,k(i(E),t=>u((o(),n("tr",{key:t.uid,class:Ae([oe(t)])},[e("td",null,[u(e("input",{type:"checkbox",class:"border-red-500","onUpdate:modelValue":a=>t.checked=a,onChange:a=>ee(),disabled:q(t)},null,40,ot),[[W,t.checked]]),t.status==="pending"?(o(),N(d,{key:0,icon:"fa-question",class:"ml-1 text-xs"})):$("",!0),t.status==="resulted"?(o(),N(d,{key:1,icon:"fa-question",class:"ml-1 text-xs text-orange"})):$("",!0)]),nt,e("td",rt,[e("div",lt,[e("span",{class:"mr-1 hover:cursor-pointer",onClick:a=>ne(t)},[_(d,{icon:"fa-info-circle"})],8,it),p(" "+c(t.analysis?.name),1)])]),e("td",ct,[P(t)?(o(),n("label",ut,[u(e("select",{class:"form-input mt-1 block w-full","onUpdate:modelValue":a=>t.laboratoryInstrumentUid=a,onChange:a=>f(t)},[pt,(o(!0),n(y,null,k(i(T).laboratoryInstruments,a=>(o(),n("option",{key:a.uid,value:a.uid},[e("div",yt,[e("span",null,c(a.labName),1),p(" â†’ "),e("span",bt,"("+c(a?.instrument?.name)+")",1)])],8,ht))),128))],40,_t),[[B,t.laboratoryInstrumentUid]])])):(o(),n("div",dt,c(t.laboratoryInstrument?.labName||"---"),1))]),e("td",mt,[P(t)?(o(),n("label",gt,[u(e("select",{class:"form-input mt-1 block w-full","onUpdate:modelValue":a=>t.methodUid=a,onChange:a=>f(t)},[kt,(o(!0),n(y,null,k(i(T).methods,a=>(o(),n("option",{key:a.uid,value:a.uid},c(a.name),9,vt))),128))],40,xt),[[B,t.methodUid]])])):(o(),n("div",ft,c(t.method?.name||"---"),1))]),e("td",wt,[e("div",Rt,c(`${t.submittedBy?.firstName??"--"} ${t.submittedBy?.lastName??"--"}`),1)]),e("td",Ct,[e("div",Ut,[(o(!0),n(y,null,k(t.verifiedBy,a=>(o(),n("span",{key:a.firstName,class:"ml-1"},c(`${a?.firstName??"--"} ${a?.lastName??"--"},`),1))),128))])]),e("td",Et,[!P(t)||t?.analysis?.interims?.length===0?(o(),n("div",St," --- ")):(o(),n("label",At,[u(e("select",{class:"form-input mt-1 block w-full","onUpdate:modelValue":a=>t.result=a,onChange:a=>f(t)},[Dt,(o(!0),n(y,null,k(t?.analysis?.interims,a=>(o(),n("option",{key:a.key,value:a.value},c(a.value),9,It))),128))],40,Vt),[[B,t.result]])]))]),e("td",Tt,[P(t)?t?.analysis?.resultOptions?.length===0?(o(),n("label",Pt,[u(e("input",{class:"form-input mt-1 block w-full","onUpdate:modelValue":a=>t.result=a,onKeyup:a=>f(t)},null,40,Nt),[[Ve,t.result]])])):(o(),n("label",$t,[u(e("select",{class:"form-input mt-1 block w-full","onUpdate:modelValue":a=>t.result=a,onChange:a=>f(t)},[Mt,(o(!0),n(y,null,k(t?.analysis?.resultOptions,a=>(o(),n("option",{key:a.optionKey,value:a.value},c(a.value),9,Ot))),128))],40,Bt),[[B,t.result]])])):(o(),n("div",Lt,c(t?.result),1))]),e("td",Ft,[e("div",Kt,[t?.retest?(o(),n("span",jt,[_(d,{icon:"fa-check-circle"})])):(o(),n("span",qt,[_(d,{icon:"fa-times-circle"})]))])]),e("td",zt,[e("div",Wt,c(i(K)(t?.dueDate)),1)]),e("td",Gt,[e("div",Ht,c(i(K)(t?.dateSubmitted)),1)]),e("td",Jt,[e("div",Qt,c(i(K)(t?.dateVerified)),1)]),e("td",Xt,[e("button",Yt,c(t.status),1)]),e("td",Zt,[e("div",es,[t?.reportable?(o(),n("span",ts,[_(d,{icon:"fa-thumbs-up","aria-hidden":"true"})])):(o(),n("span",ss,[_(d,{icon:"fa-thumbs-down","aria-hidden":"true"})]))])]),as],2)),[[fe]])),128))])]))])]),e("section",os,[u(_(i(b),{key:"cancel",onClick:w(pe,["prevent"]),color:"sky-800"},{default:h(()=>[p("Cancel")]),_:1},512),[[v,R(U.UPDATE,C.RESULT)&&r.can_cancel]]),u(_(i(b),{key:"reinstate",onClick:w(he,["prevent"]),color:"orange-600"},{default:h(()=>[p("Re-Instate")]),_:1},512),[[v,R(U.UPDATE,C.RESULT)&&r.can_reinstate]]),u(_(i(b),{key:"submit",onClick:w(_e,["prevent"]),color:"orange-600"},{default:h(()=>[p("Submit")]),_:1},512),[[v,R(U.UPDATE,C.RESULT)&&r.can_submit]]),u(_(i(b),{key:"retract",onClick:w(be,["prevent"]),color:"orange-600"},{default:h(()=>[p("Retract")]),_:1},512),[[v,R(U.UPDATE,C.RESULT)&&r.can_retract]]),u(_(i(b),{key:"verify",onClick:w(ye,["prevent"]),color:"orange-600"},{default:h(()=>[p("Verify")]),_:1},512),[[v,R(U.UPDATE,C.RESULT)&&r.can_approve]]),u(_(i(b),{key:"retest",onClick:w(me,["prevent"]),color:"orange-600"},{default:h(()=>[p("Retest")]),_:1},512),[[v,R(U.UPDATE,C.RESULT)&&r.can_retest]])]),_(i(J),{show:F.value,onClose:l[1]||(l[1]=t=>F.value=!1),"content-width":"w-2/4"},{header:h(()=>[ns]),body:h(()=>[V.value?.analysisUid?(o(),N(i(Q),{key:0,analysisUid:V.value?.analysisUid},null,8,["analysisUid"])):$("",!0),V.value?.uid?(o(),N(i(X),{key:1,analysisResultesultUid:V.value?.uid},null,8,["analysisResultesultUid"])):$("",!0)]),_:1},8,["show"])],64)}}}),us=Ie(rs,[["__file","/home/aurthurm/Documents/Development/felicity/felicity-lims/webapp/views/sample/_id/Results.vue"]]);export{us as default};
