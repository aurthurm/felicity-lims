const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/index-DApeomWQ.js","assets/index-CfJ_N7IC.css","assets/FelSelect-DP_cqdSE.js","assets/FelSwitch-ACW_YjyX.js"])))=>i.map(i=>d[i]);
import{a0 as ue,S as ce,ac as me,a4 as pe,a7 as i,h as fe,g as ge,a1 as B,a6 as F,av as N,_ as he,c as k,o as x,A as a,F as u,H as w,a as l,N as f,P as g,a3 as ee,J as ve,K as be,Q as te,L as _,a2 as ye}from"./index-DApeomWQ.js";import{u as ke}from"./worksheet-CYVj9uOY.js";import{u as xe}from"./analysis-DgQlUFGJ.js";import{u as we}from"./user-B9RFIqrA.js";import{u as _e}from"./setup-HNpvekU2.js";import{s as Se}from"./index-DmuM67UT.js";import"./analyses.mutations-Bu696l9I.js";const Re=ue({__name:"WorkSheetResults",setup(m,{expose:s}){s();const L=B(()=>F(()=>import("./index-DApeomWQ.js").then(t=>t.cm),__vite__mapDeps([0,1]))),e=B(()=>F(()=>import("./FelSelect-DP_cqdSE.js"),__vite__mapDeps([2,0,1]))),T=B(()=>F(()=>import("./FelSwitch-ACW_YjyX.js"),__vite__mapDeps([3,0,1]))),h=ce(),o=_e(),c=we(),E=me(),j=pe();let S=i(!1),R=i(!1),U=i(!1),C=i(!1),A=i(!1),V=i(!1),v=i(!1),W=i(!1),d=fe(()=>h.getWorkSheet);const P=()=>{h.fetchWorksheetByUid(E.params.workSheetUid)};c.fetchUsers({}),o.fetchLaboratoryInstruments(),o.fetchMethods();const z=ge({analystUid:null,instrumentUid:null,methodUid:null}),D=i(!1),se=()=>{D.value=!0,h.updateWorksheet({worksheetUid:E.params.workSheetUid,...z}).then(()=>{D.value=!1,P()})};function M(){return d.value?.analysisResults?.every(t=>t.checked===!0)}function b(){let t=[];return d.value?.analysisResults?.forEach(n=>{n.checked&&t.push(n)}),t}function oe(){M()?v.value=!0:v.value=!1,p()}function O(t){if(Y(t)){I(t);return}t.checked=!0,p()}function Y(t){return["retracted","approved"].includes(t.status)}function I(t){t.checked=!1,p()}function ae(){d?.value?.analysisResults?.forEach(t=>v.value?O(t):I(t)),p()}function ne(){d?.value?.analysisResults?.forEach(t=>I(t)),p()}function le(t){let n=[];return t?.forEach(r=>n.push(r.name)),n.join(", ")}function J(t){t.editable=!0}function re(t){return t.status!=="pending"?!1:t?.editable||N(t?.result)?(J(t),!0):!1}function q(){let t=b(),n=[];return t?.forEach(r=>n.push({uid:r.uid,result:r.result,laboratoryInstrumentUid:r.laboratoryInstrumentUid,methodUid:r.methodUid})),n}function y(){const t=b();let n=[];return t?.forEach(r=>n.push(r.uid)),n}function G(){const t=b();let n=[];return t?.forEach(r=>n.push(r.sample?.uid)),n}function ie(t){switch(t?.status){case"retracted":return"bg-muted text-sm italic text-muted-foreground";default:return"text-sm leading-5 text-primary"}}function de(t){switch(t?.status){case"retracted":return!0;case"approved":return t?.reportable===!1;default:return!1}}function p(){S.value=!1,A.value=!1,R.value=!1,U.value=!1,C.value=!1,V.value=!1;const t=b();t.length!==0&&(V.value=!0,t.every(n=>n.status==="pending"&&!N(n.methodUid)&&!N(n.laboratoryInstrumentUid))&&(S.value=!0,A.value=!0),t.every(n=>n.status==="resulted")&&(R.value=!0,U.value=!0,C.value=!0))}const{submitResults:H,approveResults:K,retractResults:Q,retestResults:X}=xe(),{unAssignSamples:Z}=ke(),$={FButton:L,FelSelect:e,FelSwitch:T,worksheetStore:h,setupStore:o,userStore:c,route:E,router:j,get can_submit(){return S},set can_submit(t){S=t},get can_retract(){return R},set can_retract(t){R=t},get can_approve(){return U},set can_approve(t){U=t},get can_retest(){return C},set can_retest(t){C=t},get can_unassign(){return A},set can_unassign(t){A=t},get barcodes(){return V},set barcodes(t){V=t},get allChecked(){return v},set allChecked(t){v=t},get viewDetail(){return W},set viewDetail(t){W=t},get worksheet(){return d},set worksheet(t){d=t},refresh:P,form:z,applying:D,applyChanges:se,areAllChecked:M,getResultsChecked:b,checkCheck:oe,check:O,checkDisabled:Y,unCheck:I,toggleCheckAll:ae,unCheckAll:ne,analysesText:le,editResult:J,isEditable:re,prepareResults:q,getResultsUids:y,getSampleUids:G,getResultRowColor:ie,isDisabledRowCheckBox:de,checkUserActionPermissios:p,submitter_:H,approver_:K,retracter_:Q,retester_:X,unassinger_:Z,unAssignSamples:()=>Z(y()),submitResults:()=>H(q(),"worksheet",d.value?.uid),approveResults:()=>K(y(),"worksheet",d.value?.uid),retractResults:()=>Q(y()),retestResults:()=>X(y()),printBarCodes:async()=>{window.open(j.resolve({name:"print-barcodes",query:{sampleUids:JSON.stringify(G().join(","))}}).href,"_blank")},get shield(){return Se}};return Object.defineProperty($,"__isScriptSetup",{enumerable:!1,value:!0}),$}}),Ue={class:"space-y-6"},Ce={class:"flex items-center justify-between bg-background rounded-lg shadow-sm p-4"},Ae={class:"flex items-center space-x-4"},Ve={class:"flex items-center space-x-4"},Ie={class:"bg-background rounded-lg shadow-sm overflow-hidden"},Ee={class:"p-4 border-b border-border"},De={class:"grid grid-cols-3 gap-4"},Be={class:"block space-y-2"},Fe={class:"block space-y-2"},Ne={class:"block space-y-2"},Le={class:"mt-4 flex justify-end"},Te={class:"overflow-x-auto"},je={class:"w-full fel-table"},We={class:"bg-muted"},Pe={class:"px-4 py-3 text-left text-xs font-medium text-muted-foreground uppercase tracking-wider"},ze={class:"divide-y divide-border"},Me={class:"px-4 py-3 whitespace-nowrap"},Oe=["onUpdate:modelValue","disabled"],Ye={class:"px-4 py-3 whitespace-nowrap"},Je={class:"px-4 py-3 whitespace-nowrap"},qe={class:"px-4 py-3 whitespace-nowrap"},Ge={class:"px-4 py-3 whitespace-nowrap"},He=["onUpdate:modelValue"],Ke={key:1},Qe={class:"px-4 py-3 whitespace-nowrap"};function Xe(m,s,L,e,T,h){return x(),k("div",Ue,[a("div",Ce,[a("div",Ae,[u(l(e.FButton,{onClick:s[0]||(s[0]=o=>e.submitResults()),loading:m.submitting,variant:"primary",size:"sm"},{default:f(()=>[...s[14]||(s[14]=[g(" Submit Results ",-1)])]),_:1},8,["loading"]),[[w,e.can_submit&&e.shield.hasRights(e.shield.actions.SUBMIT,e.shield.objects.ANALYSIS)]]),u(l(e.FButton,{onClick:s[1]||(s[1]=o=>e.approveResults()),loading:m.approving,variant:"primary",size:"sm"},{default:f(()=>[...s[15]||(s[15]=[g(" Approve Results ",-1)])]),_:1},8,["loading"]),[[w,e.can_approve&&e.shield.hasRights(e.shield.actions.VERIFY,e.shield.objects.ANALYSIS)]]),u(l(e.FButton,{onClick:s[2]||(s[2]=o=>e.retractResults()),loading:m.retracting,variant:"destructive",size:"sm"},{default:f(()=>[...s[16]||(s[16]=[g(" Retract Results ",-1)])]),_:1},8,["loading"]),[[w,e.can_retract&&e.shield.hasRights(e.shield.actions.RETRACT,e.shield.objects.ANALYSIS)]]),u(l(e.FButton,{onClick:s[3]||(s[3]=o=>e.retestResults()),loading:m.retesting,variant:"secondary",size:"sm"},{default:f(()=>[...s[17]||(s[17]=[g(" Retest ",-1)])]),_:1},8,["loading"]),[[w,e.can_retest&&e.shield.hasRights(e.shield.actions.RETEST,e.shield.objects.ANALYSIS)]]),u(l(e.FButton,{onClick:s[4]||(s[4]=o=>e.unAssignSamples()),loading:m.unassigning,variant:"secondary",size:"sm"},{default:f(()=>[...s[18]||(s[18]=[g(" Unassign ",-1)])]),_:1},8,["loading"]),[[w,e.can_unassign&&e.shield.hasRights(e.shield.actions.UNASSIGN,e.shield.objects.ANALYSIS)]])]),a("div",Ve,[l(e.FelSwitch,{modelValue:e.viewDetail,"onUpdate:modelValue":s[5]||(s[5]=o=>e.viewDetail=o),label:"View Detail"},null,8,["modelValue"]),l(e.FelSwitch,{modelValue:e.barcodes,"onUpdate:modelValue":s[6]||(s[6]=o=>e.barcodes=o),label:"Print Barcodes"},null,8,["modelValue"])])]),a("div",Ie,[a("div",Ee,[a("div",De,[a("label",Be,[s[19]||(s[19]=a("span",{class:"text-sm font-medium text-foreground"},"Analyst",-1)),l(e.FelSelect,{modelValue:e.form.analystUid,"onUpdate:modelValue":s[7]||(s[7]=o=>e.form.analystUid=o),options:e.userStore.getUsers,"option-label":"firstName","option-value":"uid",placeholder:"Select Analyst",class:"w-full"},null,8,["modelValue","options"])]),a("label",Fe,[s[20]||(s[20]=a("span",{class:"text-sm font-medium text-foreground"},"Instrument",-1)),l(e.FelSelect,{modelValue:e.form.instrumentUid,"onUpdate:modelValue":s[8]||(s[8]=o=>e.form.instrumentUid=o),options:e.setupStore.getLaboratoryInstruments,"option-label":"name","option-value":"uid",placeholder:"Select Instrument",class:"w-full"},null,8,["modelValue","options"])]),a("label",Ne,[s[21]||(s[21]=a("span",{class:"text-sm font-medium text-foreground"},"Method",-1)),l(e.FelSelect,{modelValue:e.form.methodUid,"onUpdate:modelValue":s[9]||(s[9]=o=>e.form.methodUid=o),options:e.setupStore.getMethods,"option-label":"name","option-value":"uid",placeholder:"Select Method",class:"w-full"},null,8,["modelValue","options"])])]),a("div",Le,[l(e.FButton,{onClick:s[10]||(s[10]=o=>e.applyChanges()),loading:e.applying,variant:"primary",size:"sm"},{default:f(()=>[...s[22]||(s[22]=[g(" Apply Changes ",-1)])]),_:1},8,["loading"])])]),a("div",Te,[a("table",je,[a("thead",We,[a("tr",null,[a("th",Pe,[u(a("input",{type:"checkbox","onUpdate:modelValue":s[11]||(s[11]=o=>e.allChecked=o),onClick:s[12]||(s[12]=o=>e.toggleCheckAll()),class:"rounded border-input text-primary focus:ring-primary"},null,512),[[ee,e.allChecked]])]),s[23]||(s[23]=a("th",{class:"px-4 py-3 text-left text-xs font-medium text-muted-foreground uppercase tracking-wider"},"Sample ID",-1)),s[24]||(s[24]=a("th",{class:"px-4 py-3 text-left text-xs font-medium text-muted-foreground uppercase tracking-wider"},"Client Sample ID",-1)),s[25]||(s[25]=a("th",{class:"px-4 py-3 text-left text-xs font-medium text-muted-foreground uppercase tracking-wider"},"Analysis",-1)),s[26]||(s[26]=a("th",{class:"px-4 py-3 text-left text-xs font-medium text-muted-foreground uppercase tracking-wider"},"Result",-1)),s[27]||(s[27]=a("th",{class:"px-4 py-3 text-left text-xs font-medium text-muted-foreground uppercase tracking-wider"},"Status",-1))])]),a("tbody",ze,[(x(!0),k(ve,null,be(e.worksheet?.analysisResults,o=>(x(),k("tr",{key:o.uid,class:te(e.getResultRowColor(o))},[a("td",Me,[u(a("input",{type:"checkbox","onUpdate:modelValue":c=>o.checked=c,onClick:s[13]||(s[13]=c=>e.checkCheck()),disabled:e.isDisabledRowCheckBox(o),class:"rounded border-input text-primary focus:ring-primary"},null,8,Oe),[[ee,o.checked]])]),a("td",Ye,_(o.sample?.sampleId),1),a("td",Je,_(o.sample?.clientSampleId),1),a("td",qe,_(o.analysis?.name),1),a("td",Ge,[e.isEditable(o)?u((x(),k("input",{key:0,type:"text","onUpdate:modelValue":c=>o.result=c,class:"w-full px-2 py-1 border border-input rounded-md bg-background text-foreground focus:outline-none focus:ring-2 focus:ring-primary"},null,8,He)),[[ye,o.result]]):(x(),k("span",Ke,_(o.result),1))]),a("td",Qe,[a("span",{class:te(["inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium",{"bg-primary/10 text-primary":o.status==="pending","bg-warning/10 text-warning":o.status==="awaiting","bg-success/10 text-success":o.status==="approved","bg-destructive/10 text-destructive":o.status==="retracted"}])},_(o.status),3)])],2))),128))])])])])])}const ct=he(Re,[["render",Xe],["__file","/home/administrator/Documents/Development/beak-insights/felicity/felicity-lims/webapp/views/worksheet/_id/WorkSheetResults.vue"]]);export{ct as default};
