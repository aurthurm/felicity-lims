import{d as T,I as N,r as d,q,p as K,o as a,c as l,b as t,y as n,t as h,F as v,C as R,G as O,B as Q,h as M,D as Y,E as J,k as X}from"./index-68ba4247.js";import{l as Z,D as I,m as ee}from"./grind.queries-2b50ae5c.js";import{M as F}from"./schema-f3233b53.js";const r=p=>(Y("data-v-334d1478"),p=p(),J(),p),te={class:"flex justify-between items-start"},se={class:"w-3/4 pr-4"},oe=r(()=>t("h3",{class:"text-lg font-medium mb-3"},"Uploaded Files",-1)),ae={key:0,class:"py-6 text-center text-gray-500 bg-gray-50 rounded-lg border border-dashed border-gray-300"},le={key:1,class:"mb-3 p-3 bg-red-50 text-red-700 rounded-md"},ne={key:2,class:"space-y-2"},re={class:"file-icon mr-3 text-blue-500 flex-shrink-0"},ie={key:0,xmlns:"http://www.w3.org/2000/svg",class:"h-6 w-6",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},de=r(()=>t("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M4 16l4.586-4.586a2 2 0 012.828 0L16 16m-2-2l1.586-1.586a2 2 0 012.828 0L20 14m-6-6h.01M6 20h12a2 2 0 002-2V6a2 2 0 00-2-2H6a2 2 0 00-2 2v12a2 2 0 002 2z"},null,-1)),ce=[de],ue=r(()=>t("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-6 w-6",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M7 21h10a2 2 0 002-2V9.414a1 1 0 00-.293-.707l-5.414-5.414A1 1 0 0012.586 3H7a2 2 0 00-2 2v14a2 2 0 002 2z"})],-1)),he=r(()=>t("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-6 w-6",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"})],-1)),ve=r(()=>t("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-6 w-6",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M9 17v-2m3 2v-4m3 4v-6m2 10H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"})],-1)),pe=r(()=>t("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-6 w-6",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"})],-1)),_e={class:"flex-grow min-w-0 mr-3"},ge=["title"],fe={class:"text-sm text-gray-500 flex items-center gap-2"},we=r(()=>t("span",{class:"h-1 w-1 rounded-full bg-gray-300"},null,-1)),me={class:"flex gap-2 flex-shrink-0"},xe=["onClick"],ke=r(()=>t("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-5 w-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M4 16v1a3 3 0 003 3h10a3 3 0 003-3v-1m-4-4l-4 4m0 0l-4-4m4 4V4"})],-1)),ye=[ke],be=["onClick","disabled"],De={key:0,class:"animate-spin h-5 w-5",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24"},Ce=r(()=>t("circle",{class:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor","stroke-width":"4"},null,-1)),Fe=r(()=>t("path",{class:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"},null,-1)),Me=[Ce,Fe],Be={key:1,xmlns:"http://www.w3.org/2000/svg",class:"h-5 w-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},Ue=r(()=>t("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"},null,-1)),Ve=[Ue],ze={class:"file-upload-container"},Ee=M('<div class="w-16 h-16 mb-2 mx-auto text-gray-400" data-v-334d1478><svg xmlns="http://www.w3.org/2000/svg" class="w-full h-full" fill="none" viewBox="0 0 24 24" stroke="currentColor" data-v-334d1478><path stroke-linecap="round" stroke-linejoin="round" stroke-width="1" d="M5 8h14M5 8a2 2 0 110-4h14a2 2 0 110 4M5 8v10a2 2 0 002 2h10a2 2 0 002-2V8m-9 4h4" data-v-334d1478></path></svg></div><p class="text-center text-gray-500 mb-2" data-v-334d1478>Drag and drop file here</p><p class="text-center text-gray-400 text-sm mb-3" data-v-334d1478>or</p>',3),je={class:"file-input-button"},Se={class:"file-preview"},$e={key:0,class:"image-preview mb-3"},Ae=["src"],Ge={key:1,class:"file-icon w-16 h-16 mx-auto mb-3 text-blue-500"},He=r(()=>t("svg",{xmlns:"http://www.w3.org/2000/svg",class:"w-full h-full",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"1",d:"M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"})],-1)),Le=[He],We={class:"file-info mb-4 text-center"},Pe={class:"font-medium text-gray-800"},Te={class:"text-sm text-gray-500"},Ne={class:"flex justify-center gap-3"},qe=["disabled"],Ke={key:0},Re={key:1},Oe={key:2,class:"mt-3 text-red-500 text-center"},Qe=M('<div class="success-icon w-16 h-16 mx-auto mb-3 text-green-500" data-v-334d1478><svg xmlns="http://www.w3.org/2000/svg" class="w-full h-full" fill="none" viewBox="0 0 24 24" stroke="currentColor" data-v-334d1478><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7" data-v-334d1478></path></svg></div><p class="text-center text-gray-800 font-medium mb-2" data-v-334d1478>Upload Successful</p><p class="text-center text-gray-500 text-sm mb-4" data-v-334d1478>Your file has been uploaded successfully</p>',3),Ye=T({__name:"ErrandFile",props:{errandUid:{type:String,required:!0}},setup(p){const y=p,{withClientMutation:b,withClientQuery:B}=N(),w=d(null),m=d(null);q(()=>{U()});const _=d(!1),i=d(null),g=d(null),x=d(!1),u=d(null),f=d(!1),c=d([]),U=()=>{B(Z,{target:F.Errand,targetUid:y.errandUid},"grindMediaByTarget").then(e=>{e&&(c.value=e)})},V=e=>{b(ee,{payload:e},"createGrindMedia").then(s=>{s&&(c.value=[s,...c.value])})},z=e=>{w.value=e,m.value=null,b(I,{uid:e},"deleteGrindMedia").then(s=>{s&&(c.value=c.value.filter(o=>o.uid!==e))}).catch(s=>{m.value=s?.message||"Failed to delete file"}).finally(()=>{w.value=null})},E=e=>{const s=parseInt(e);return s<1024?`${s} B`:s<1024*1024?`${(s/1024).toFixed(1)} KB`:`${(s/(1024*1024)).toFixed(1)} MB`},k=e=>{const{mimetype:s,filename:o}=e;return s?.startsWith("image/")?"image":s?.includes("pdf")||o.endsWith(".pdf")?"pdf":s?.includes("word")||o.endsWith(".doc")||o.endsWith(".docx")?"doc":s?.includes("sheet")||o.endsWith(".xls")||o.endsWith(".xlsx")?"excel":"file"},j=e=>{window.open(`/${e.path}`,"_blank")},D=e=>{if(u.value=null,i.value=e,e.type.startsWith("image/")){const s=new FileReader;s.onload=o=>{g.value=o.target?.result},s.readAsDataURL(e)}else g.value=null},S=async()=>{if(i.value){x.value=!0,u.value=null;try{const e=await V({file:i.value,target:F.Errand,targetUid:y.errandUid});e?.error?u.value=e.error.message:f.value=!0}catch(e){u.value=e instanceof Error?e.message:"Upload failed"}finally{x.value=!1}}},$=e=>{const s=e.target;s.files&&s.files.length>0&&D(s.files[0])},A=e=>{e.preventDefault(),e.stopPropagation(),_.value=!0},G=e=>{e.preventDefault(),e.stopPropagation(),_.value=!1},H=e=>{e.preventDefault(),e.stopPropagation(),_.value=!0},L=e=>{e.preventDefault(),e.stopPropagation(),_.value=!1,e.dataTransfer&&e.dataTransfer.files.length>0&&D(e.dataTransfer.files[0])},C=()=>{i.value=null,g.value=null,f.value=!1,u.value=null},W=K(()=>{if(!i.value)return"";const e=i.value.size;return e<1024?`${e} B`:e<1024*1024?`${(e/1024).toFixed(1)} KB`:`${(e/(1024*1024)).toFixed(1)} MB`});return(e,s)=>(a(),l("div",te,[t("div",se,[oe,n(" Loading or empty state "),c.value.length===0?(a(),l("div",ae," No files uploaded yet ")):n("v-if",!0),n(" Error message "),m.value?(a(),l("div",le,h(m.value),1)):n("v-if",!0),n(" File list "),c.value.length>0?(a(),l("ul",ne,[(a(!0),l(v,null,R(c.value,o=>(a(),l("li",{key:o.uid,class:"p-3 border rounded-md flex items-center hover:bg-gray-50 transition-colors"},[n(" File icon based on type "),t("div",re,[n(" Image icon "),k(o)==="image"?(a(),l("svg",ie,[...ce])):k(o)==="pdf"?(a(),l(v,{key:1},[n(" PDF icon "),ue],2112)):k(o)==="doc"?(a(),l(v,{key:2},[n(" Word/Doc icon "),he],2112)):k(o)==="excel"?(a(),l(v,{key:3},[n(" Excel icon "),ve],2112)):(a(),l(v,{key:4},[n(" Generic file icon "),pe],2112))]),n(" File info "),t("div",_e,[t("div",{class:"font-medium text-gray-800 truncate",title:o.filename},h(o.filename),9,ge),t("div",fe,[t("span",null,h(E(o.size)),1),we,t("span",null,h(o.mimetype),1)])]),n(" Actions "),t("div",me,[n(" Download button "),t("button",{onClick:P=>j(o),class:"p-2 text-blue-600 hover:bg-blue-50 rounded transition-colors",title:"Download file"},[...ye],8,xe),n(" Delete button "),t("button",{onClick:P=>z(o.uid),class:"p-2 text-red-600 hover:bg-red-50 rounded transition-colors",title:"Delete file",disabled:w.value===o.uid},[w.value===o.uid?(a(),l("svg",De,[...Me])):(a(),l("svg",Be,[...Ve]))],8,be)])]))),128))])):n("v-if",!0)]),t("div",ze,[n(" Upload area "),!i.value&&!f.value?(a(),l("div",{key:0,class:O(["upload-area",{dragging:_.value}]),onDragenter:A,onDragleave:G,onDragover:H,onDrop:L},[Ee,t("label",je,[Q(" Browse Files "),t("input",{type:"file",class:"hidden",onChange:$},null,32)])],34)):i.value&&!f.value?(a(),l(v,{key:1},[n(" File preview "),t("div",Se,[g.value?(a(),l("div",$e,[t("img",{src:g.value,alt:"File preview",class:"rounded-md max-h-64 max-w-full"},null,8,Ae)])):(a(),l("div",Ge,[...Le])),t("div",We,[t("p",Pe,h(i.value.name),1),t("p",Te,h(W.value),1)]),t("div",Ne,[t("button",{onClick:C,class:"cancel-button"}," Cancel "),t("button",{onClick:S,class:"upload-button",disabled:x.value},[x.value?(a(),l("span",Ke,"Uploading...")):(a(),l("span",Re,"Upload"))],8,qe)]),u.value?(a(),l("div",Oe,h(u.value),1)):n("v-if",!0)])],2112)):f.value?(a(),l(v,{key:2},[n(" Upload success "),t("div",{class:"upload-success"},[Qe,t("button",{onClick:C,class:"upload-new-button"}," Upload Another File ")])],2112)):n("v-if",!0)])]))}});const Ie=X(Ye,[["__scopeId","data-v-334d1478"],["__file","/home/aurthurm/Documents/Development/felicity/felicity-lims/webapp/views/grind/_id/ErrandFile.vue"]]);export{Ie as default};
