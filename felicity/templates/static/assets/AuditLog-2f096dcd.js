import{_ as U,a2 as V,a3 as j,m as E,L as l}from"./shipment-53265c2d.js";import{f as F,G as O,T as R,d as z,aj as C,h as r,k as d,u as p,B as P,ag as G,F as m,ak as g,x as i,D as a,al as h,_ as M}from"./_plugin-vue_export-helper-dacf3d65.js";const q={class:"relative mt-4"},H=i("div",{class:"border-r-2 border-gray-400 border-dotted absolute h-full top-0 z-0",style:{left:"7px"}},null,-1),J={key:0,class:"py-4 text-center"},K={key:1,initial:{opacity:0,y:100},enter:{opacity:1,y:0,scale:1},variants:{custom:{scale:2}},delay:200,class:"list-none m-0 p-0"},Q={class:"flex items-center mb-1"},W=i("div",{class:"bg-indigo-600 rounded-full h-4 w-4 border-gray-200 border-2 z-10"},null,-1),X={class:"ml-4 font-medium italic"},Y={class:"ml-12 w-100"},Z={class:"col-span-1"},$={class:"text-sm text-gray-600 italic"},v={class:"col-span-3"},k={class:"text-muted text-xs text-orange-600"},B={class:"text-muted text-xs text-sky-800"},A=F({__name:"AuditLog",props:{targetId:String,targetType:String},setup(b){const x=b,y=O(()=>U(()=>import("./LoadingMessage-097e117a.js"),["assets/LoadingMessage-097e117a.js","assets/_plugin-vue_export-helper-dacf3d65.js"])),{targetType:L,targetId:S}=R(x),f=V(),u=j();u.restLogs();const{auditLogs:w,fetchingAudits:T}=E(u);f.fetchUsers({}),u.fetchAuditLogs({targetType:L?.value,targetId:S?.value});let D=z(()=>f.getUsers);function n(o){const c=D?.value?.find(_=>_.uid?.toString()===o?.toString());return c?c.auth.userName:""}function N(o){return o===1?"created":o===2?"updated":o===3?"deleted":""}function I(o){let c=new Set;return Object.entries(o?.stateBefore)?.map(([_,e])=>{Object.entries(o?.stateAfter)?.map(([t,s])=>{_===t&&e!==s&&(t&&t==="updated_by_uid"&&(t="updated_by",e=n(e),s=n(s)),t&&t==="submitted_by_uid"&&(t="submitted_by",e=n(e),s=n(s)),t&&t==="verified_by_uid"&&(t="verified_by",e=n(e),s=n(s)),t&&t==="updated_at"&&(t="updated_on",e=l(e),s=l(s)),t&&t==="cancelled_by_uid"&&(t="cancelled_by",e=n(e),s=n(s)),t&&t==="received_by_uid"&&(t="received_by",e=n(e),s=n(s)),c.add({key:t,old:e?.length>0?e:"None",new:s?.toString()?.length>0?s:"None"}))})}),c}return(o,c)=>{const _=C("motion");return r(),d("div",q,[H,p(T)?(r(),d("div",J,[P(p(y),{message:"Fetching audit logs ..."})])):G((r(),d("ul",K,[(r(!0),d(m,null,g(p(w),e=>(r(),d("li",{key:e.uid,class:"mb-2"},[i("div",Q,[W,i("div",X,[i("span",null,a(n(e?.userId))+" "+a(N(e?.action))+" "+a(e?.targetType),1),h(" on "),i("span",null,a(p(l)(e?.stateAfter?.updated_at)),1)])]),i("div",Y,[(r(!0),d(m,null,g(I(e),t=>(r(),d("div",{key:t.key,class:"grid grid-cols-4"},[i("span",Z,[i("span",$,a(t?.key),1)]),i("span",v,[i("span",k,a(t?.old),1),h(" â†’ "),i("span",B,a(t?.new),1)])]))),128))])]))),128))])),[[_]])])}}}),st=M(A,[["__file","/home/aurthurm/Development/felicity-lims/webapp/views/components/AuditLog.vue"]]);export{st as default};
