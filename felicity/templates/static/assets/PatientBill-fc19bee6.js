import{S as xe,f as he,u as ke,ah as z,a0 as f,i as Ce,a1 as X,r as I,aj as $,o as a,c as d,N as s,C as u,a5 as i,a as k,F as C,E as S,a3 as p,H as l,D as R,A as v,M as U,L as c,K as g,y as q,ac as E,a2 as Te,X as F,Z as we,$ as Be,j as Ve,_ as Ae}from"./index-6c3e61f6.js";import{u as Se,A as Ue,C as Fe,d as je}from"./billing-13210756.js";import{p as Me}from"./index-1ec5ed02.js";import{u as Ne}from"./bills-82279d91.js";import{c as Pe,a as L,b as De,u as Ie,e as Y}from"./array-c7a86e05.js";const $e={class:"space-y-6"},Re={class:"grid grid-cols-12 gap-6"},qe={initial:{opacity:0,y:100},enter:{opacity:1,y:0,scale:1},variants:{custom:{scale:2}},delay:400,class:"col-span-3 overflow-y-auto overscroll-contain billing-scroll"},Ee={key:0,class:"py-4 text-center bg-background w-full mb-2 rounded-lg shadow-sm border border-border"},Le={key:1},Ye={class:"space-y-2"},Ke=["onClick"],We={class:"space-y-1"},He={class:"font-semibold text-foreground"},Oe={class:"text-sm text-muted-foreground"},ze={initial:{opacity:0,y:-100},enter:{opacity:1,y:0,scale:1},variants:{custom:{scale:2}},delay:400,class:"col-span-9 space-y-6"},Xe={class:"bg-background rounded-lg shadow-sm p-6 space-y-4"},Ze={class:"flex justify-between items-center"},Ge={class:"text-lg font-semibold text-foreground"},Je={class:"grid grid-cols-3 gap-8"},Qe={class:"space-y-4"},es={class:"flex justify-between items-center"},ss={class:"text-sm text-foreground"},ts={class:"flex justify-between items-center"},os={class:"text-sm text-foreground"},ns={class:"space-y-4"},as={class:"flex justify-between items-center"},is={class:"text-sm text-foreground"},ls={class:"flex justify-between items-center"},rs={class:"text-sm text-foreground"},ds={class:"space-y-4"},us={class:"flex justify-between items-center"},cs={class:"text-sm text-foreground"},fs={class:"space-y-4"},ms={class:"flex justify-between items-center"},ps={class:"bg-background rounded-lg shadow-sm p-6 space-y-4"},vs={class:"font-semibold text-foreground"},gs={class:"text-muted-foreground"},bs={class:"ml-2 text-primary"},ys={class:"space-y-4"},_s={class:"flex justify-between items-center"},xs={class:"space-x-4"},hs={class:"bg-background rounded-lg shadow-sm p-6"},ks={class:"space-y-6 p-6"},Cs={class:"grid grid-cols-2 gap-6"},Ts={class:"space-y-2"},ws=["disabled"],Bs=["value"],Vs={class:"text-sm text-destructive"},As={class:"space-y-2"},Ss=["disabled"],Us={class:"space-y-2"},Fs=["disabled"],js={class:"flex justify-end"},Ms={class:"space-y-6 p-6"},Ns={class:"text-lg font-medium text-foreground"},Ps={class:"space-y-2"},Ds=["disabled"],Is={class:"flex justify-end"},$s={class:"space-y-6 p-6"},Rs={class:"space-y-2"},qs=["disabled"],Es={class:"flex justify-end"},Ls=xe({__name:"PatientBill",props:{patientUid:String},setup(Z){const G=we(()=>Be(()=>import("./FelDataTable-204fbd7a.js"),["assets/FelDataTable-204fbd7a.js","assets/index-6c3e61f6.js","assets/index-a402b5a2.css"])),K=Z,{toastSuccess:W}=Ve(),{withClientMutation:j}=he(),b=Se(),J=ke(),{bills:H,fetchingBills:Q,transactions:ee,fetchingTransactions:se}=z(b),{analysisRequests:te}=z(J);b.fetchBillsForPatient(K?.patientUid);const oe=f(["cash","medical-aid","e-payment"]),T=f(!1),n=f({}),ne=o=>{n.value={...o},b.fetchBillTransactions(o.uid)},ae=Ce(()=>{const o=n?.value?.orders?.map(e=>e.uid)??[];return te?.value?.filter(e=>o.includes(e.uid))});function ie(o,e){let x=[];return o.forEach(m=>x.push(m.name)),e.forEach(m=>x.push(m.name)),x.join(", ")}const le=Pe({testBillUid:L().required(),kind:L().required(),amount:De().required(),notes:L()}),{handleSubmit:re,errors:y,setFieldValue:w}=Ie({validationSchema:le,initialValues:{testBillUid:n.value?.uid}}),{value:B}=Y("kind"),{value:M}=Y("amount"),{value:N}=Y("notes"),r=f(!1),de=re(o=>{r.value=!0,ce(o)}),ue=()=>{w("testBillUid",n.value?.uid),w("kind","cash"),w("amount",Math.ceil(Number((n?.value?.totalCharged-n?.value?.totalPaid).toFixed(2)))),w("notes",""),T.value=!0},ce=o=>{j(Ue,{payload:o},"createTestBillTransaction").then(e=>{b.addTransaction(e),r.value=!1,T.value=!1,W("Transaction added.")})},V=f(!1),_=f({}),fe=()=>{r.value=!0,j(Fe,{uid:_.value.uid,notes:_.value.notes},"confirmTestBillTransaction").then(o=>{b.updateTransaction(o),r.value=!1,V.value=!1,W("Transaction confirmed.")})},me=f([{name:"Kind",value:"kind",sortable:!0,sortBy:"asc",defaultSort:!0,showInToggler:!1,hidden:!1},{name:"Amount",value:"amount",sortable:!1,sortBy:"asc",hidden:!1},{name:"Success",value:"isSuccess",sortable:!1,sortBy:"asc",hidden:!1},{name:"Notes",value:"notes",sortable:!1,sortBy:"asc",hidden:!1},{name:"Message",value:"message",sortable:!1,sortBy:"asc",hidden:!1},{name:"Processed",value:"processed",sortable:!1,sortBy:"asc",hidden:!1,customRender:function(o,e){return X("span",{innerHTML:o.processed?"Yes":"Pending confirmation"},[])}},{name:"Action",sortable:!1,hidden:!1,customRender:(o,e)=>{if(!o.processed)return X("button",{onClick(){V.value=!0,_.value=o},type:"button",class:"bg-primary text-primary-foreground py-1 px-2 rounded-sm leading-none"},"confirm")}}]),P=f(!1),A=f({code:""}),pe=()=>{P.value=!0},ve=()=>{r.value=!0,j(je,{payload:{voucherCode:A.value?.code,testBillUid:n.value?.uid,customerUid:K.patientUid}},"applyVoucher").then(o=>r.value=!1)},{downloadInvoice:ge}=Ne(),be=async o=>await ge(o.uid);return(o,e)=>{const x=I("fel-loader"),m=I("fel-button"),D=I("fel-modal"),O=$("motion"),ye=$("motion-slide-top"),_e=$("motion-slide-right");return a(),d(C,null,[s("div",$e,[s("div",Re,[u((a(),d("section",qe,[i(Q)?(a(),d("div",Ee,[k(x,{message:"Fetching bills ..."})])):(a(),d("div",Le,[s("ul",Ye,[(a(!0),d(C,null,S(i(H),t=>(a(),d("li",{key:t.uid,class:p(["bg-background w-full p-3 rounded-lg shadow-sm border border-border transition-all duration-200 hover:shadow-md",{"border-primary bg-primary/5":t.uid===n.value.uid}]),onClick:h=>ne(t)},[s("div",We,[s("div",He," Bill "+l(t.billId?.toLocaleUpperCase()),1),s("div",Oe,l(i(Me)(t.createdAt)),1)])],10,Ke))),128))])]))])),[[O]]),u((a(),d("section",ze,[u((a(),d("div",Xe,[s("div",Ze,[s("h4",Ge,l(n.value.billId?.toLocaleUpperCase()),1)]),s("div",Je,[s("div",Qe,[s("div",es,[e[9]||(e[9]=s("span",{class:"text-sm font-medium text-foreground"},"Active:",-1)),s("span",ss,l(n.value.isActive?"Yes":"No"),1)]),s("div",ts,[e[10]||(e[10]=s("span",{class:"text-sm font-medium text-foreground"},"Confirmed:",-1)),s("span",os,l(n.value?.toConfirm?"No":"Yes"),1)])]),s("div",ns,[s("div",as,[e[11]||(e[11]=s("span",{class:"text-sm font-medium text-foreground"},"Total Charged:",-1)),s("span",is,l(n.value?.totalCharged),1)]),s("div",ls,[e[12]||(e[12]=s("span",{class:"text-sm font-medium text-foreground"},"Total Paid:",-1)),s("span",rs,l(n.value?.totalPaid),1)])]),s("div",ds,[s("div",us,[e[13]||(e[13]=s("span",{class:"text-sm font-medium text-foreground"},"Partial:",-1)),s("span",cs,l(n.value?.totalPaid<n.value?.totalCharged?"Yes":"No"),1)])])])])),[[ye]]),s("div",fs,[s("div",ms,[e[14]||(e[14]=s("h4",{class:"text-lg font-semibold text-foreground"},"Order Items",-1)),s("button",{class:"px-4 py-2 bg-primary text-primary-foreground rounded-md hover:bg-primary/90 transition-colors duration-200 focus:outline-none focus:ring-2 focus:ring-primary/50",onClick:e[0]||(e[0]=v(t=>be(n.value),["prevent"]))}," Invoice ")]),s("ul",ps,[(a(!0),d(C,null,S(ae.value,t=>(a(),d("li",{class:"space-y-2",key:t.uid},[s("div",vs,l(t?.requestId)+" ("+l(t?.clientRequestId)+")",1),(a(!0),d(C,null,S(t.samples,h=>u((a(),d("div",{class:"space-y-1 pl-4",key:h.uid},[s("span",gs,l(h.sampleId),1),e[15]||(e[15]=U(" â‡’ ")),s("span",bs,l(ie(h.profiles??[],h.analyses??[])),1)])),[[_e]])),128))]))),128))])]),s("div",ys,[s("div",_s,[e[16]||(e[16]=s("h4",{class:"text-lg font-semibold text-foreground"},"Transactions",-1)),s("div",xs,[u(s("button",{class:"px-4 py-2 bg-primary text-primary-foreground rounded-md hover:bg-primary/90 transition-colors duration-200 focus:outline-none focus:ring-2 focus:ring-primary/50",onClick:v(ue,["prevent"])}," Add Transaction ",512),[[R,n.value.isActive]]),u(s("button",{class:"px-4 py-2 bg-primary text-primary-foreground rounded-md hover:bg-primary/90 transition-colors duration-200 focus:outline-none focus:ring-2 focus:ring-primary/50",onClick:v(pe,["prevent"])}," Apply Voucher ",512),[[R,n.value.isActive]])])]),s("div",hs,[k(i(G),{columns:me.value,data:i(ee),toggleColumns:!1,loading:i(se),paginable:!1,searchable:!1,filterable:!1,selectable:!1},{footer:c(()=>e[17]||(e[17]=[])),_:1},8,["columns","data","loading"])])])])),[[R,i(H)?.length>0&&n.value.uid],[O]])])]),g(" New Transaction Form Modal "),T.value?(a(),q(D,{key:0,onClose:e[4]||(e[4]=t=>T.value=!1),contentWidth:"w-3/6",class:"bg-background"},{header:c(()=>e[18]||(e[18]=[s("h3",{class:"text-xl font-semibold text-foreground"},"Transaction Form",-1)])),body:c(()=>[s("form",ks,[s("div",Cs,[s("label",Ts,[e[20]||(e[20]=s("span",{class:"text-sm font-medium text-foreground"},"Kind of payment",-1)),u(s("select",{class:p(["w-full rounded-md border border-input bg-background px-3 py-2 text-sm ring-offset-background focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2",{"border-destructive":i(y).kind}]),"onUpdate:modelValue":e[1]||(e[1]=t=>E(B)?B.value=t:null),disabled:r.value},[e[19]||(e[19]=s("option",null,null,-1)),(a(!0),d(C,null,S(oe.value,t=>(a(),d("option",{key:t,value:t},l(t),9,Bs))),128))],10,ws),[[Te,i(B)]]),s("div",Vs,l(i(y).gender),1)]),s("label",As,[e[21]||(e[21]=s("span",{class:"text-sm font-medium text-foreground"},"Amount",-1)),u(s("input",{class:p(["w-full rounded-md border border-input bg-background px-3 py-2 text-sm ring-offset-background focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2",{"border-destructive":i(y).amount}]),type:"number","onUpdate:modelValue":e[2]||(e[2]=t=>E(M)?M.value=t:null),disabled:r.value},null,10,Ss),[[F,i(M)]])])]),s("label",Us,[e[22]||(e[22]=s("span",{class:"text-sm font-medium text-foreground"},"Notes",-1)),u(s("input",{class:p(["w-full rounded-md border border-input bg-background px-3 py-2 text-sm ring-offset-background focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2",{"border-destructive":i(y).notes}]),"onUpdate:modelValue":e[3]||(e[3]=t=>E(N)?N.value=t:null),disabled:r.value},null,10,Fs),[[F,i(N)]])]),s("div",js,[k(m,{color:"primary",type:"submit",loading:r.value,onClick:v(i(de),["prevent"])},{default:c(()=>e[23]||(e[23]=[U(" Save Transaction ")])),_:1},8,["loading","onClick"])])])]),_:1})):g("v-if",!0),g(" Confirm Transaction Form Modal "),V.value?(a(),q(D,{key:1,onClose:e[6]||(e[6]=t=>V.value=!1),contentWidth:"w-3/6",class:"bg-background"},{header:c(()=>e[24]||(e[24]=[s("h3",{class:"text-xl font-semibold text-foreground"},"Confirm Transaction",-1)])),body:c(()=>[s("form",Ms,[s("h4",Ns,l(i(B))+" Transaction",1),s("label",Ps,[e[25]||(e[25]=s("span",{class:"text-sm font-medium text-foreground"},"Notes",-1)),u(s("input",{class:p(["w-full rounded-md border border-input bg-background px-3 py-2 text-sm ring-offset-background focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2",{"border-destructive":i(y).notes}]),"onUpdate:modelValue":e[5]||(e[5]=t=>_.value.notes=t),disabled:r.value},null,10,Ds),[[F,_.value.notes]])]),s("div",Is,[k(m,{color:"primary",type:"submit",loading:r.value,onClick:v(fe,["prevent"])},{default:c(()=>e[26]||(e[26]=[U(" Confirm Transaction ")])),_:1},8,["loading"])])])]),_:1})):g("v-if",!0),g(" Voucher Code Form Modal "),P.value?(a(),q(D,{key:2,onClose:e[8]||(e[8]=t=>P.value=!1),contentWidth:"w-1/5",class:"bg-background"},{header:c(()=>e[27]||(e[27]=[s("h3",{class:"text-xl font-semibold text-foreground"},"Apply Voucher Code",-1)])),body:c(()=>[s("form",$s,[s("label",Rs,[e[28]||(e[28]=s("span",{class:"text-sm font-medium text-foreground"},"Voucher Code",-1)),u(s("input",{class:p(["w-full rounded-md border border-input bg-background px-3 py-2 text-sm ring-offset-background focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2",{"border-destructive":!A.value.code}]),type:"text","onUpdate:modelValue":e[7]||(e[7]=t=>A.value.code=t),disabled:r.value},null,10,qs),[[F,A.value.code]])]),s("div",Es,[k(m,{color:"primary",type:"submit",loading:r.value,onClick:v(ve,["prevent"])},{default:c(()=>e[29]||(e[29]=[U(" Apply Voucher ")])),_:1},8,["loading"])])])]),_:1})):g("v-if",!0)],64)}}});const zs=Ae(Ls,[["__scopeId","data-v-afb0e1b5"],["__file","/home/aurthurm/Documents/Development/felicity/felicity-lims/webapp/views/patient/_id/PatientBill.vue"]]);export{zs as default};
