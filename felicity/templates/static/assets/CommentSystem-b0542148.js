import{P as U,e as E,Z as b,o,c as l,A as B,V as j,b as n,a1 as m,J as p,L as q,E as x,_ as R,aa as L,h as f,a2 as P,as as Q,a as w,F as $,D as J}from"./index-f86d8273.js";import{o as W,p as Z,q as K,r as X}from"./grind.queries-12f686e0.js";const Y={class:"mb-4"},_=["rows","placeholder"],ee={class:"flex items-center justify-end mt-2 gap-2"},te={key:0,class:"flex items-center gap-2 font-sm"},ne=U({__name:"CommentForm",props:{errandUid:{type:String,required:!0},parentDiscussion:{type:Object,default:void 0},isReply:{type:Boolean,default:!1}},emits:["commentAdded","cancelReply"],setup(e,{emit:y}){const t=e,i=y,{withClientMutation:u}=E(),s=b("");function r(){s.value.trim()&&u(W,{payload:{comment:s.value,errandUid:t.errandUid,parentUid:t.parentDiscussion?.uid}},"createGrindErrandDiscussion").then(()=>{s.value="",i("commentAdded")})}function d(){i("cancelReply")}return(v,a)=>(o(),l("div",Y,[B(n("textarea",{"onUpdate:modelValue":a[0]||(a[0]=h=>s.value=h),rows:e.isReply?2:3,class:m(`w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-sky-500 focus:border-sky-500 ${e.isReply?"text-sm":""}`),placeholder:e.isReply?"Write a reply...":"Add a comment..."},null,10,_),[[j,s.value]]),n("div",ee,[e.isReply?(o(),l("button",{key:0,onClick:d,class:"px-2 py-1 border border-gray-300 rounded hover:bg-gray-50 text-sm"}," Cancel ")):p("",!0),n("button",{onClick:r,class:m(`px-3 py-1.5 bg-blue-500 text-white rounded hover:bg-blue-600 flex items-center gap-2 ${e.isReply?"text-sm px-2 py-1":""}`)},[e.isReply?p("",!0):(o(),l("div",te,a[1]||(a[1]=[n("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-5 w-5",viewBox:"0 0 20 20",fill:"currentColor"},[n("path",{"fill-rule":"evenodd",d:"M7.707 3.293a1 1 0 010 1.414L5.414 7H11a7 7 0 017 7v2a1 1 0 11-2 0v-2a5 5 0 00-5-5H5.414l2.293 2.293a1 1 0 11-1.414 1.414l-4-4a1 1 0 010-1.414l4-4a1 1 0 011.414 0z","clip-rule":"evenodd"})],-1)]))),q(" "+x(e.isReply?"Reply":"Comment"),1)],2)])]))}}),M=R(ne,[["__file","/home/aurthurm/Documents/Development/felicity/felicity-lims/webapp/components/grind/CommentForm.vue"]]),ie={class:"flex items-start gap-4"},oe={class:"flex-1"},le={class:"flex justify-between"},me={key:0,class:"flex gap-2"},se=["rows"],de={class:"flex items-center justify-end gap-2 mt-2"},ae=["innerHTML"],re=U({__name:"CommentItem",props:{comment:{type:Object,required:!0},replyingTo:{type:Object,default:null},editingComment:{type:Object,default:null},level:{type:Number,default:0}},emits:["setReplyingTo","setEditingComment","commentAdded","commentUpdated"],setup(e,{emit:y}){const t=e;L(()=>{d(t.comment.uid)});const i=y,{withClientMutation:u,withClientQuery:s}=E(),r=b([]);function d(C){s(Z,{parentUid:C},"grindErrandDiscussionsByParent").then(g=>{g&&(r.value=g)})}const v=f(()=>t.editingComment&&t.editingComment.uid===t.comment.uid),a=f(()=>t.replyingTo&&t.replyingTo.uid===t.comment.uid),h=f(()=>t.level<2),D=f(()=>{switch(t.level){case 0:return"h-10 w-10";case 1:return"h-8 w-8";case 2:return"h-6 w-6";default:return"h-10 w-10"}}),c=f(()=>{switch(t.level){case 0:return"bg-orange-100 text-orange-600";case 1:return"bg-blue-100 text-blue-600";case 2:return"bg-green-100 text-green-600";default:return"bg-orange-100 text-orange-600"}}),k=f(()=>{switch(t.level){case 0:return"";case 1:return"text-sm";case 2:return"text-xs";default:return""}}),T=f(()=>{switch(t.level){case 0:return"h-5 w-5";case 1:return"h-4 w-4";case 2:return"h-3.5 w-3.5";default:return"h-5 w-5"}});function A(){a.value?i("setReplyingTo",null):i("setReplyingTo",t.comment)}function G(){i("setEditingComment",{...t.comment})}function V(){i("setEditingComment",null)}function z(){t.editingComment&&u(K,{uid:t.comment.uid,payload:{comment:t.editingComment.comment,errandUid:t.editingComment.errandUid}},"updateGrindErrandDiscussion").then(()=>{i("commentUpdated")})}function S(){i("commentAdded"),d(t.comment.uid)}function H(){i("commentUpdated"),d(t.comment.uid)}function I(C){i("setReplyingTo",C)}function O(C){i("setEditingComment",C)}return(C,g)=>(o(),l($,null,[n("div",ie,[n("div",{class:m(`${D.value} shrink-0 rounded-full ${c.value} flex items-center justify-center font-semibold ${k.value}`)},x(P(Q)(e.comment.createdBy?.firstName,e.comment.createdBy?.lastName)),3),n("div",oe,[n("div",le,[n("div",null,[n("h3",{class:m(`font-medium ${k.value}`)},x(e.comment.createdBy?.firstName)+" "+x(e.comment.createdBy?.lastName),3),n("div",{class:m(`${e.level>0?"text-xs":"text-sm"} text-gray-500`)},x(e.comment.createdAt),3)]),v.value?p("",!0):(o(),l("div",me,[e.comment.canEdit?(o(),l("button",{key:0,onClick:G,class:"text-gray-500 hover:text-blue-500"},[(o(),l("svg",{xmlns:"http://www.w3.org/2000/svg",class:m(T.value),fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},g[1]||(g[1]=[n("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2v-5m-1.414-9.414a2 2 0 112.828 2.828L11.828 15H9v-2.828l8.586-8.586z"},null,-1)]),2))])):p("",!0),h.value?(o(),l("button",{key:1,onClick:A,class:"text-gray-500 hover:text-blue-500"},[(o(),l("svg",{xmlns:"http://www.w3.org/2000/svg",class:m(T.value),fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},g[2]||(g[2]=[n("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M3 10h10a8 8 0 018 8v2M3 10l6 6m-6-6l6-6"},null,-1)]),2))])):p("",!0)]))]),v.value?(o(),l("div",{key:0,class:m(`mt-${e.level===0||e.level===1?2:1}`)},[B(n("textarea",{"onUpdate:modelValue":g[0]||(g[0]=F=>e.editingComment.comment=F),rows:e.level===0?3:2,class:m(`w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-sky-500 focus:border-sky-500 ${e.level===2?"text-xs":""}`)},null,10,se),[[j,e.editingComment.comment]]),n("div",de,[n("button",{onClick:V,class:m(`px-${e.level<2?3:2} py-${e.level<2?"1.5":1} border border-gray-300 rounded hover:bg-gray-50 ${e.level>0?"text-sm":""}`)}," Cancel ",2),n("button",{onClick:z,class:m(`px-${e.level<2?3:2} py-${e.level<2?"1.5":1} bg-blue-500 text-white rounded hover:bg-blue-600 ${e.level>0?"text-sm":""}`)}," Save ",2)])],2)):(o(),l("div",{key:1,class:m(`mt-${e.level===0?2:1} text-gray-600 ${k.value}`),innerHTML:e.comment.comment},null,10,ae)),a.value?(o(),l("div",{key:2,class:m(`mt-${e.level===0?3:2}`)},[w(M,{"parent-discussion":e.comment,"is-reply":!0,errandUid:e.comment.errandUid,onCommentAdded:S,onCancelReply:A},null,8,["parent-discussion","errandUid"])],2)):p("",!0)])]),r.value.length>0?(o(),l("div",{key:0,class:m(`ml-${e.level===0?14:12} mt-4`)},[w(N,{comments:r.value,"replying-to":e.replyingTo,"editing-comment":e.editingComment,level:e.level+1,onSetReplyingTo:I,onSetEditingComment:O,onCommentAdded:S,onCommentUpdated:H},null,8,["comments","replying-to","editing-comment","level"])],2)):p("",!0)],64))}});const ce=R(re,[["__scopeId","data-v-31ab5fff"],["__file","/home/aurthurm/Documents/Development/felicity/felicity-lims/webapp/components/grind/CommentItem.vue"]]),ue=U({__name:"CommentList",props:{comments:{type:Array,required:!0},replyingTo:{type:Object,default:null},editingComment:{type:Object,default:null},level:{type:Number,default:0}},emits:["setReplyingTo","setEditingComment","commentAdded","commentUpdated"],setup(e,{emit:y}){const t=y;function i(d){t("setReplyingTo",d)}function u(d){t("setEditingComment",d)}function s(){t("commentAdded")}function r(){t("commentUpdated")}return(d,v)=>(o(),l("div",{class:m(`space-y-${e.level===0?"6":"4"}`)},[(o(!0),l($,null,J(e.comments,a=>(o(),l("div",{key:a.uid,class:m(e.level===0?"border-b border-gray-200 pb-4":"")},[w(ce,{comment:a,"replying-to":e.replyingTo,"editing-comment":e.editingComment,level:e.level,onSetReplyingTo:i,onSetEditingComment:u,onCommentAdded:s,onCommentUpdated:r},null,8,["comment","replying-to","editing-comment","level"])],2))),128))],2))}}),N=R(ue,[["__file","/home/aurthurm/Documents/Development/felicity/felicity-lims/webapp/components/grind/CommentList.vue"]]),ge=U({__name:"CommentSystem",props:["errandUid"],setup(e){const y=e,{withClientQuery:t}=E(),i=b([]),u=b(null),s=b(null);L(()=>{r()});function r(){t(X,{errandUid:y.errandUid},"grindErrandDiscussions").then(c=>{c&&(i.value=c)})}function d(){return i.value.filter(c=>!c.parentUid)}function v(){r(),u.value=null}function a(){r(),s.value=null}function h(c){u.value=c}function D(c){s.value=c}return(c,k)=>(o(),l($,null,[w(M,{"errand-uid":e.errandUid,onCommentAdded:v},null,8,["errand-uid"]),w(N,{comments:d(),"replying-to":u.value,"editing-comment":s.value,"errand-uid":e.errandUid,onSetReplyingTo:h,onSetEditingComment:D,onCommentAdded:v,onCommentUpdated:a},null,8,["comments","replying-to","editing-comment","errand-uid"])],64))}}),fe=R(ge,[["__file","/home/aurthurm/Documents/Development/felicity/felicity-lims/webapp/components/grind/CommentSystem.vue"]]);export{fe as default};
