import{S as fe,u as pe,ai as me,a6 as ve,V as ye,h as E,i as T,a0 as B,a1 as r,aj as be,aG as Ce,r as he,o as Se,c as _e,a as o,L as u,N as ge,C as c,A as d,M as f,D as p,a5 as A,Z as Re,$ as Ae,_ as Le}from"./index-0c222abb.js";import{p as _}from"./index-821b8b6e.js";import{u as ke}from"./analysis-8752c99a.js";import{u as Pe}from"./samples-c809cdea.js";import{h as m,a as v,o as y}from"./constants-db06f5c8.js";import"./analyses.mutations-5f97547d.js";import"./storage.mutations-b6c293b8.js";const Ee={class:"rounded-lg border border-border bg-card shadow-sm p-6"},Be=fe({__name:"FelSampleListing",setup(Me){const w=Re(()=>Ae(()=>import("./FelDataTable-f7cdd56f.js"),["assets/FelDataTable-f7cdd56f.js","assets/index-0c222abb.js","assets/index-8412b2a5.css"])),b=pe(),M=ke(),{samplePageInfo:x,fetchingSamples:D}=me(b);let N=ve(),L=ye();const s=E({barcodes:!1,can_cancel:!1,can_receive:!1,can_reinstate:!1,can_reject:!1,can_copy_to:!1,can_download:!1,can_print:!1,can_publish:!1,can_store:!1,can_recover:!1}),S=T(()=>b.getSamples),I=B([{name:"All",value:""},{name:"Expected",value:"expected"},{name:"Received",value:"received"},{name:"Awaiting",value:"awaiting"},{name:"Approved",value:"approved"},{name:"Published",value:"published"},{name:"Invalidated",value:"invalidated"},{name:"Cancelled",value:"cancelled"},{name:"Rejected",value:"rejected"},{name:"Stored",value:"stored"},{name:"Referred",value:"referred"},{name:"Paired",value:"paired"}]),q=B([{name:"UID",value:"uid",sortable:!0,sortBy:"asc",defaultSort:!0,showInToggler:!1,hidden:!0},{name:"",value:"",sortable:!1,showInToggler:!1,hidden:!1,customRender:function(t,e){return r("div",{class:"flex items-center gap-2"},[t.priority>1?r("span",{class:"text-destructive"},r("i",{class:"fa fa-star"})):"",t.status==="stored"?r("span",{class:"text-muted-foreground"},r("i",{class:"fa-briefcase"})):""])}},{name:"Sample ID",value:"sampleId",sortable:!0,sortBy:"asc",hidden:!1,customRender:function(t,e){return r(be,{to:{name:"sample-detail",params:{patientUid:t?.analysisRequest?.patient?.uid,sampleUid:t?.uid}},class:"text-primary hover:underline",innerHTML:t?.sampleId})}},{name:"Sample Type",value:"sampleType.name",sortable:!1,sortBy:"asc",hidden:!0},{name:"Test(s)",value:"",sortable:!1,sortBy:"asc",hidden:!1,customRender:function(t,e){return r("span",{innerHTML:j(t.profiles,t.analyses)},[])}},{name:"Patient",value:"",sortable:!1,sortBy:"asc",hidden:!1,customRender:function(t,e){const a="analysisRequest.patient.firstName".split(".").reduce((l,P)=>l?.[P],t),n="analysisRequest.patient.lastName".split(".").reduce((l,P)=>l?.[P],t);return r("span",{innerHTML:`${a} ${n}`},[])}},{name:"Gender",value:"analysisRequest.patient.gender",sortable:!1,sortBy:"asc",hidden:!0},{name:"Age",value:"analysisRequest.patient.age",sortable:!1,sortBy:"asc",hidden:!0},{name:"Client Patient ID",value:"analysisRequest.patient.clientPatientId",sortable:!1,sortBy:"asc",hidden:!1},{name:"Client",value:"analysisRequest.client.name",sortable:!1,sortBy:"asc",hidden:!1},{name:"Client Code",value:"analysisRequest.client.code",sortable:!1,sortBy:"asc",hidden:!0},{name:"Province",value:"analysisRequest.client.district.province.name",sortable:!1,sortBy:"asc",hidden:!0},{name:"District",value:"analysisRequest.client.district.name",sortable:!1,sortBy:"asc",hidden:!0},{name:"Client Request Id",value:"analysisRequest.clientRequestId",sortable:!1,sortBy:"asc",hidden:!1},{name:"Date Collected",value:"dateCollected",sortable:!1,sortBy:"asc",hidden:!0,customRender:function(t,e){const a=e.value.split(".").reduce((n,l)=>n?.[l],t);return r("span",{innerHTML:_(a)},[])}},{name:"Date Created",value:"createdAt",sortable:!1,sortBy:"asc",hidden:!0,customRender:function(t,e){const a=e.value.split(".").reduce((n,l)=>n?.[l],t);return r("span",{innerHTML:_(a)},[])}},{name:"Creator",value:"createdBy.firstName",sortable:!1,sortBy:"asc",hidden:!1},{name:"Date Received",value:"dateReceived",sortable:!1,sortBy:"asc",hidden:!0,customRender:function(t,e){const a=e.value.split(".").reduce((n,l)=>n?.[l],t);return r("span",{innerHTML:_(a)},[])}},{name:"Date Submitted",value:"dateSubmitted",sortable:!1,sortBy:"asc",hidden:!0,customRender:function(t,e){const a=e.value.split(".").reduce((n,l)=>n?.[l],t);return r("span",{innerHTML:_(a)},[])}},{name:"Date Verified",value:"dateVerified",sortable:!1,sortBy:"asc",hidden:!0,customRender:function(t,e){const a=e.value.split(".").reduce((n,l)=>n?.[l],t);return r("span",{innerHTML:_(a)},[])}},{name:"Date Published",value:"datePublished",sortable:!1,sortBy:"asc",hidden:!0,customRender:function(t,e){const a=e.value.split(".").reduce((n,l)=>n?.[l],t);return r("span",{innerHTML:_(a)},[])}},{name:"Date Printed",value:"datePrinted",sortable:!1,sortBy:"asc",hidden:!0,customRender:function(t,e){const a=e.value.split(".").reduce((n,l)=>n?.[l],t);return r("span",{innerHTML:_(a)},[])}},{name:"Printed",value:"printed",sortable:!1,sortBy:"asc",hidden:!0},{name:"Status",value:"status",sortable:!1,sortBy:"asc",hidden:!1,customRender:function(t,e){const a=e.value.split(".").reduce((n,l)=>n?.[l],t);return r("button",{type:"button",class:"bg-primary text-primary-foreground py-1 px-2 rounded-sm leading-none",innerHTML:a},[])}}]);N?.query?.clientUid&&b.resetSamples(),b.fetchSampleTypes();let $=E({first:void 0,after:"",text:"",sortBy:["name"]});M.fetchAnalysesServices($),M.fetchAnalysesProfiles();function j(t,e){let a=[];return t.forEach(n=>a.push(n.name)),e.forEach(n=>a.push(n.name)),a.join(", ")}let i=E({first:50,before:"",status:"received",text:"",sortBy:["-uid"],clientUid:Ce(N?.query?.clientUid),filterAction:!1});b.fetchSamples(i);function H(t){i.first=t.fetchCount,i.before=x?.value?.endCursor??"",i.text=t.filterText,i.status=t.filterStatus,i.filterAction=!1,b.fetchSamples(i)}function O(t){i.first=50,i.before="",i.text=t.filterText,i.status=t.filterStatus,i.filterAction=!0,b.fetchSamples(i)}const g=B(!1);function U(t){S.value?.forEach(e=>e.checked=t.checked),g.value=t.checked,k()}function V(t){const e=S.value.findIndex(a=>a.uid===t.uid);S.value[e].checked=t.checked,F()?g.value=!0:g.value=!1,k()}async function C(){S.value?.forEach(t=>t.checked=!1),g.value=!1,k()}function F(){return S.value?.every(t=>t.checked===!0)}function R(){let t=[];return S.value?.forEach(e=>{e.checked&&t.push(e)}),t}function k(){s.can_cancel=!1,s.can_receive=!1,s.can_reinstate=!1,s.can_download=!1,s.can_publish=!1,s.can_print=!1,s.can_reject=!1,s.can_store=!1,s.can_recover=!1,s.can_copy_to=!1,s.barcodes=!1;const t=R();t.length!==0&&(s.barcodes=!0,t.every(e=>e.status==="expected")&&(s.can_receive=!0),t.every(e=>["received","expected"].includes(e.status))&&(s.can_cancel=!0,s.can_reject=!0),t.every(e=>["received"].includes(e.status))&&(s.can_store=!0,s.can_copy_to=!0),t.every(e=>["stored"].includes(e.status))&&(s.can_recover=!0),t.every(e=>e.status==="cancelled")&&(s.can_reinstate=!0),t.every(e=>["approved","published"].includes(e.status))&&(s.can_copy_to=!0),t.every(e=>e.status==="approved")&&(s.can_publish=!0),t.every(e=>e.status==="published")&&(s.can_print=!0,s.can_download=!0))}function h(){const t=R();let e=[];return t?.forEach(a=>e.push(a.uid)),e}function J(){const t=R();let e=[];return t?.forEach(a=>e.push(a.sampleId)),e}const{cancelSamples:G,reInstateSamples:Z,receiveSamples:z,printSamples:K,downloadSamplesImpress:Q,publishSamples:W,recoverSamples:X,cloneSamples:Y}=Pe(),ee=T(()=>b.getSamples?.length+" of "+b.getSampleCount+" samples"),te=async()=>Y(h()).finally(()=>C()),ae=async()=>G(h()).finally(()=>C()),se=async()=>Z(h()).finally(()=>C()),ne=async()=>z(h()).finally(()=>C()),le=async()=>{const t=h().map(e=>({uid:e,action:"publish"}));await W(t).finally(()=>C())},re=async()=>await K(h()).finally(()=>C()),ie=async()=>await Q(J()).finally(()=>C()),oe=async()=>{const t=R();L.push({name:"reject-samples",state:{samples:JSON.stringify(t)}})},ue=async()=>{const t=R();L.push({name:"store-samples",state:{samples:JSON.stringify(t)}})},ce=async()=>X(h()).finally(()=>C()),de=async()=>L.push({name:"print-barcodes",state:{sampleUids:JSON.stringify(h())}});return(t,e)=>{const a=he("fel-button");return Se(),_e("div",Ee,[o(A(w),{columns:q.value,data:S.value,toggleColumns:!0,loading:A(D),paginable:!0,pageMeta:{fetchCount:A(i).first,hasNextPage:A(x)?.hasNextPage,countNone:ee.value},searchable:!0,filterable:!0,filterMeta:{defaultFilter:A(i).status,filters:I.value},selectable:!0,allChecked:g.value,onOnSearch:O,onOnPaginate:H,onOnCheck:V,onOnCheckAll:U},{footer:u(()=>[ge("div",null,[c(o(a,{onClick:e[0]||(e[0]=d(n=>ae(),["prevent"]))},{default:u(()=>e[10]||(e[10]=[f(" Cancel ")])),_:1},512),[[p,m(v.CANCEL,y.SAMPLE)&&s.can_cancel]]),c(o(a,{onClick:e[1]||(e[1]=d(n=>se(),["prevent"]))},{default:u(()=>e[11]||(e[11]=[f(" ReInstate ")])),_:1},512),[[p,m(v.CANCEL,y.SAMPLE)&&s.can_reinstate]]),c(o(a,{onClick:e[2]||(e[2]=d(n=>ne(),["prevent"]))},{default:u(()=>e[12]||(e[12]=[f(" Reveive ")])),_:1},512),[[p,m(v.CANCEL,y.SAMPLE)&&s.can_receive]]),c(o(a,{onClick:e[3]||(e[3]=d(n=>ue(),["prevent"]))},{default:u(()=>e[13]||(e[13]=[f(" Store ")])),_:1},512),[[p,m(v.CANCEL,y.SAMPLE)&&s.can_store]]),c(o(a,{onClick:e[4]||(e[4]=d(n=>ce(),["prevent"]))},{default:u(()=>e[14]||(e[14]=[f(" Recover ")])),_:1},512),[[p,m(v.CANCEL,y.SAMPLE)&&s.can_recover]]),c(o(a,{onClick:e[5]||(e[5]=d(n=>oe(),["prevent"]))},{default:u(()=>e[15]||(e[15]=[f(" Reject ")])),_:1},512),[[p,m(v.CANCEL,y.SAMPLE)&&s.can_reject]]),c(o(a,{onClick:e[6]||(e[6]=d(n=>te(),["prevent"]))},{default:u(()=>e[16]||(e[16]=[f(" Copy to New ")])),_:1},512),[[p,m(v.CANCEL,y.SAMPLE)&&s.can_copy_to]]),c(o(a,{onClick:e[7]||(e[7]=d(n=>ie(),["prevent"]))},{default:u(()=>e[17]||(e[17]=[f(" Download ")])),_:1},512),[[p,m(v.CANCEL,y.SAMPLE)&&s.can_download]]),c(o(a,{onClick:e[8]||(e[8]=d(n=>le(),["prevent"]))},{default:u(()=>e[18]||(e[18]=[f(" Publish ")])),_:1},512),[[p,m(v.CANCEL,y.SAMPLE)&&s.can_publish]]),c(o(a,{onClick:e[9]||(e[9]=d(n=>re(),["prevent"]))},{default:u(()=>e[19]||(e[19]=[f(" Print ")])),_:1},512),[[p,m(v.CANCEL,y.SAMPLE)&&s.can_print]]),c(o(a,{onClick:d(de,["prevent"])},{default:u(()=>e[20]||(e[20]=[f(" Print Barcodes ")])),_:1},512),[[p,s.barcodes]])])]),_:1},8,["columns","data","loading","pageMeta","filterMeta","allChecked"])])}}}),$e=Le(Be,[["__file","/home/aurthurm/Documents/Development/felicity/felicity-lims/webapp/components/sample/FelSampleListing.vue"]]);export{$e as default};
