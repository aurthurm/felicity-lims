import{f as Z,k as X,W as be,am as ye,a2 as f,a9 as xe,Y as _e,a3 as G,r as J,ap as R,o as r,c as m,O as t,D as u,E as L,J as a,C as b,F as I,H as O,N as S,a as j,M as c,a7 as l,z as Y,a5 as h,ai as W,a4 as he,Z as N,L as z,a0 as Be,a1 as we,_ as Ce}from"./index-5d85e9da.js";import{u as ke}from"./billing-87301a8c.js";import{g as Te,C as Ae,h as Ve}from"./billing.mutations-d73a0197.js";import{I as De,k as Ue}from"./billing.queries-223b5d80.js";import{c as Ie,a as H,e as Se,u as je,f as K}from"./array-5c68cccc.js";function Ne(){const{withClientQuery:n}=Z(),{swalConfirm:M,toastSuccess:d,toastError:B}=X();return{downloadInvoice:async F=>{try{if((await M("You want to download this invoice","Are you sure?")).isConfirmed){const C=await n(De,{billUid:F},"billInvoiceCreate","network-only");if(C){const y=document.createElement("a");y.href=`data:application/pdf;base64,${C}`,y.setAttribute("download","invoice-report.pdf"),y.click(),d("Invoice downloaded successfully")}}}catch(p){B(`Failed to download invoice: ${p instanceof Error?p.message:"Unknown error"}`)}}}}const Me={class:"space-y-6"},Fe={initial:{opacity:0,y:-100},enter:{opacity:1,y:0,scale:1},variants:{custom:{scale:2}},delay:400,class:"col-span-9 space-y-6"},Ee={class:"bg-background rounded-lg shadow-sm p-6 space-y-4"},Pe={class:"flex justify-between items-center"},$e={class:"text-lg font-semibold text-foreground"},qe={class:"grid grid-cols-3 gap-8"},Re={class:"space-y-4"},Le={class:"flex justify-between items-center"},Oe={class:"text-sm text-foreground"},Ye={class:"flex justify-between items-center"},We={class:"text-sm text-foreground"},ze={class:"space-y-4"},He={class:"flex justify-between items-center"},Ke={class:"text-sm text-foreground"},Qe={class:"flex justify-between items-center"},Ge={class:"text-sm text-foreground"},Je={class:"space-y-4"},Ze={class:"flex justify-between items-center"},Xe={class:"text-sm text-foreground"},et={class:"space-y-4"},tt={class:"flex justify-between items-center"},st={class:"bg-background rounded-lg shadow-sm p-6 space-y-4"},ot={class:"font-semibold text-foreground"},nt={class:"text-muted-foreground"},it={class:"ml-2 text-primary"},at={class:"space-y-4"},lt={class:"flex justify-between items-center"},rt={class:"space-x-4"},dt={class:"bg-background rounded-lg shadow-sm p-6"},ut={class:"space-y-6 p-6"},ct={class:"grid grid-cols-2 gap-6"},ft={class:"space-y-2"},mt=["disabled"],pt=["value"],gt={class:"text-sm text-destructive"},vt={class:"space-y-2"},bt=["disabled"],yt={class:"space-y-2"},xt=["disabled"],_t={class:"flex justify-end"},ht={class:"space-y-6 p-6"},Bt={class:"text-lg font-medium text-foreground"},wt={class:"space-y-2"},Ct=["disabled"],kt={class:"flex justify-end"},Tt={class:"space-y-6 p-6"},At={class:"space-y-2"},Vt=["disabled"],Dt={class:"flex justify-end"},Ut=be({__name:"BillDetail",props:{customerUid:{type:String,required:!0},testBill:{type:Object,required:!0}},setup(n){const M=Be(()=>we(()=>import("./FelDataTable-f331e430.js"),["assets/FelDataTable-f331e430.js","assets/index-5d85e9da.js","assets/index-8a6751fe.css"])),d=n,{toastSuccess:B}=X(),{withClientMutation:w,withClientQuery:F}=Z(),p=ke(),{transactions:C,fetchingTransactions:y}=ye(p),ee=f(["cash","medical-aid","e-payment"]),k=f(!1);xe(()=>{Q(d.testBill)}),_e(()=>d.testBill,s=>{s?.uid&&(console.log("testBill changed",s.uid),Q(s))},{deep:!0});const Q=s=>{E.value=[],p.fetchBillTransactions(s.uid),te(s.uid)},E=f([]),te=async s=>{const e=await F(Ue,{uid:s},"ordersByBillUid");E.value=e};function se(s,e){let g=[];return s.forEach(v=>g.push(v.name)),e.forEach(v=>g.push(v.name)),g.join(", ")}const oe=Ie({testBillUid:H().required(),kind:H().required(),amount:Se().required(),notes:H()}),{handleSubmit:ne,errors:x,setFieldValue:T}=je({validationSchema:oe,initialValues:{testBillUid:d.testBill?.uid}}),{value:A}=K("kind"),{value:P}=K("amount"),{value:$}=K("notes"),i=f(!1),ie=ne(s=>{i.value=!0,le(s)}),ae=()=>{d.testBill?.uid&&(T("testBillUid",d.testBill?.uid),T("kind","cash"),T("amount",Math.ceil(Number((d.testBill?.totalCharged-d.testBill?.totalPaid).toFixed(2)))),T("notes",""),k.value=!0)},le=s=>{w(Te,{payload:s},"createTestBillTransaction").then(e=>{p.addTransaction(e),i.value=!1,k.value=!1,B("Transaction added.")})},V=f(!1),_=f({}),re=()=>{i.value=!0,w(Ae,{uid:_.value.uid,notes:_.value.notes},"confirmTestBillTransaction").then(s=>{p.updateTransaction(s),i.value=!1,V.value=!1,B("Transaction confirmed.")})},de=f([{name:"Kind",value:"kind",sortable:!0,sortBy:"asc",defaultSort:!0,showInToggler:!1,hidden:!1},{name:"Amount",value:"amount",sortable:!1,sortBy:"asc",hidden:!1},{name:"Success",value:"isSuccess",sortable:!1,sortBy:"asc",hidden:!1},{name:"Notes",value:"notes",sortable:!1,sortBy:"asc",hidden:!1},{name:"Message",value:"message",sortable:!1,sortBy:"asc",hidden:!1},{name:"Processed",value:"processed",sortable:!1,sortBy:"asc",hidden:!1,customRender:function(s,e){return G("span",{innerHTML:s.processed?"Yes":"Pending confirmation"},[])}},{name:"Action",sortable:!1,hidden:!1,customRender:(s,e)=>{if(!s.processed)return G("button",{onClick(){V.value=!0,_.value=s},type:"button",class:"bg-primary text-primary-foreground py-1 px-2 rounded-sm leading-none"},"confirm")}}]),q=f(!1),D=f({code:""}),ue=()=>{q.value=!0},ce=()=>{i.value=!0,w(Ve,{payload:{voucherCode:D.value?.code,testBillUid:d.testBill?.uid,customerUid:d.customerUid}},"applyVoucher").then(s=>i.value=!1)},{downloadInvoice:fe}=Ne(),me=async s=>await fe(s.uid);return(s,e)=>{const g=J("fel-button"),v=J("fel-modal"),pe=R("motion-slide-top"),ge=R("motion-slide-right"),ve=R("motion");return r(),m(I,null,[t("div",Me,[u((r(),m("section",Fe,[u((r(),m("div",Ee,[t("div",Pe,[t("h4",$e,a(n.testBill.billId?.toLocaleUpperCase()),1)]),t("div",qe,[t("div",Re,[t("div",Le,[e[9]||(e[9]=t("span",{class:"text-sm font-medium text-foreground"},"Active:",-1)),t("span",Oe,a(n.testBill.isActive?"Yes":"No"),1)]),t("div",Ye,[e[10]||(e[10]=t("span",{class:"text-sm font-medium text-foreground"},"Confirmed:",-1)),t("span",We,a(n.testBill?.toConfirm?"No":"Yes"),1)])]),t("div",ze,[t("div",He,[e[11]||(e[11]=t("span",{class:"text-sm font-medium text-foreground"},"Total Charged:",-1)),t("span",Ke,a(n.testBill?.totalCharged),1)]),t("div",Qe,[e[12]||(e[12]=t("span",{class:"text-sm font-medium text-foreground"},"Total Paid:",-1)),t("span",Ge,a(n.testBill?.totalPaid),1)])]),t("div",Je,[t("div",Ze,[e[13]||(e[13]=t("span",{class:"text-sm font-medium text-foreground"},"Partial:",-1)),t("span",Xe,a(n.testBill?.totalPaid<n.testBill?.totalCharged?"Yes":"No"),1)])])])])),[[pe]]),t("div",et,[t("div",tt,[e[14]||(e[14]=t("h4",{class:"text-lg font-semibold text-foreground"},"Order Items",-1)),t("button",{class:"px-4 py-2 bg-primary text-primary-foreground rounded-md hover:bg-primary/90 transition-colors duration-200 focus:outline-none focus:ring-2 focus:ring-primary/50",onClick:e[0]||(e[0]=b(o=>me(n.testBill),["prevent"]))}," Invoice ")]),t("ul",st,[(r(!0),m(I,null,O(E.value,o=>(r(),m("li",{class:"space-y-2",key:o.uid},[t("div",ot,a(o?.requestId)+" ("+a(o?.clientRequestId)+")",1),(r(!0),m(I,null,O(o.samples,U=>u((r(),m("div",{class:"space-y-1 pl-4",key:U.uid},[t("span",nt,a(U.sampleId),1),e[15]||(e[15]=S(" â‡’ ")),t("span",it,a(se(U.profiles??[],U.analyses??[])),1)])),[[ge]])),128))]))),128))])]),t("div",at,[t("div",lt,[e[16]||(e[16]=t("h4",{class:"text-lg font-semibold text-foreground"},"Transactions",-1)),t("div",rt,[u(t("button",{class:"px-4 py-2 bg-primary text-primary-foreground rounded-md hover:bg-primary/90 transition-colors duration-200 focus:outline-none focus:ring-2 focus:ring-primary/50",onClick:b(ae,["prevent"])}," Add Transaction ",512),[[L,n.testBill.isActive]]),u(t("button",{class:"px-4 py-2 bg-primary text-primary-foreground rounded-md hover:bg-primary/90 transition-colors duration-200 focus:outline-none focus:ring-2 focus:ring-primary/50",onClick:b(ue,["prevent"])}," Apply Voucher ",512),[[L,n.testBill.isActive]])])]),t("div",dt,[j(l(M),{columns:de.value,data:l(C),toggleColumns:!1,loading:l(y),paginable:!1,searchable:!1,filterable:!1,selectable:!1},{footer:c(()=>e[17]||(e[17]=[])),_:1},8,["columns","data","loading"])])])])),[[L,n.testBill.uid],[ve]])]),k.value?(r(),Y(v,{key:0,onClose:e[4]||(e[4]=o=>k.value=!1),contentWidth:"w-3/6",class:"bg-background"},{header:c(()=>e[18]||(e[18]=[t("h3",{class:"text-xl font-semibold text-foreground"},"Transaction Form",-1)])),body:c(()=>[t("form",ut,[t("div",ct,[t("label",ft,[e[20]||(e[20]=t("span",{class:"text-sm font-medium text-foreground"},"Kind of payment",-1)),u(t("select",{class:h(["w-full rounded-md border border-input bg-background px-3 py-2 text-sm ring-offset-background focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2",{"border-destructive":l(x).kind}]),"onUpdate:modelValue":e[1]||(e[1]=o=>W(A)?A.value=o:null),disabled:i.value},[e[19]||(e[19]=t("option",null,null,-1)),(r(!0),m(I,null,O(ee.value,o=>(r(),m("option",{key:o,value:o},a(o),9,pt))),128))],10,mt),[[he,l(A)]]),t("div",gt,a(l(x).gender),1)]),t("label",vt,[e[21]||(e[21]=t("span",{class:"text-sm font-medium text-foreground"},"Amount",-1)),u(t("input",{class:h(["w-full rounded-md border border-input bg-background px-3 py-2 text-sm ring-offset-background focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2",{"border-destructive":l(x).amount}]),type:"number","onUpdate:modelValue":e[2]||(e[2]=o=>W(P)?P.value=o:null),disabled:i.value},null,10,bt),[[N,l(P)]])])]),t("label",yt,[e[22]||(e[22]=t("span",{class:"text-sm font-medium text-foreground"},"Notes",-1)),u(t("input",{class:h(["w-full rounded-md border border-input bg-background px-3 py-2 text-sm ring-offset-background focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2",{"border-destructive":l(x).notes}]),"onUpdate:modelValue":e[3]||(e[3]=o=>W($)?$.value=o:null),disabled:i.value},null,10,xt),[[N,l($)]])]),t("div",_t,[j(g,{color:"primary",type:"submit",loading:i.value,onClick:b(l(ie),["prevent"])},{default:c(()=>e[23]||(e[23]=[S(" Save Transaction ")])),_:1},8,["loading","onClick"])])])]),_:1})):z("",!0),V.value?(r(),Y(v,{key:1,onClose:e[6]||(e[6]=o=>V.value=!1),contentWidth:"w-3/6",class:"bg-background"},{header:c(()=>e[24]||(e[24]=[t("h3",{class:"text-xl font-semibold text-foreground"},"Confirm Transaction",-1)])),body:c(()=>[t("form",ht,[t("h4",Bt,a(l(A))+" Transaction",1),t("label",wt,[e[25]||(e[25]=t("span",{class:"text-sm font-medium text-foreground"},"Notes",-1)),u(t("input",{class:h(["w-full rounded-md border border-input bg-background px-3 py-2 text-sm ring-offset-background focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2",{"border-destructive":l(x).notes}]),"onUpdate:modelValue":e[5]||(e[5]=o=>_.value.notes=o),disabled:i.value},null,10,Ct),[[N,_.value.notes]])]),t("div",kt,[j(g,{color:"primary",type:"submit",loading:i.value,onClick:b(re,["prevent"])},{default:c(()=>e[26]||(e[26]=[S(" Confirm Transaction ")])),_:1},8,["loading"])])])]),_:1})):z("",!0),q.value?(r(),Y(v,{key:2,onClose:e[8]||(e[8]=o=>q.value=!1),contentWidth:"w-1/5",class:"bg-background"},{header:c(()=>e[27]||(e[27]=[t("h3",{class:"text-xl font-semibold text-foreground"},"Apply Voucher Code",-1)])),body:c(()=>[t("form",Tt,[t("label",At,[e[28]||(e[28]=t("span",{class:"text-sm font-medium text-foreground"},"Voucher Code",-1)),u(t("input",{class:h(["w-full rounded-md border border-input bg-background px-3 py-2 text-sm ring-offset-background focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2",{"border-destructive":!D.value.code}]),type:"text","onUpdate:modelValue":e[7]||(e[7]=o=>D.value.code=o),disabled:i.value},null,10,Vt),[[N,D.value.code]])]),t("div",Dt,[j(g,{color:"primary",type:"submit",loading:i.value,onClick:b(ce,["prevent"])},{default:c(()=>e[29]||(e[29]=[S(" Apply Voucher ")])),_:1},8,["loading"])])])]),_:1})):z("",!0)],64)}}});const Ft=Ce(Ut,[["__scopeId","data-v-3a43e177"],["__file","/home/aurthurm/Documents/Development/felicity/felicity-lims/webapp/components/billing/BillDetail.vue"]]);export{Ft as default};
