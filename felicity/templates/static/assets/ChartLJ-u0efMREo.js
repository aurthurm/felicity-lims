import{a0 as M,a7 as S,h as j,ad as rr,_ as nr,c as F,o as $,A as K,L as er}from"./index-CNAOKjig.js";import{C as or}from"./index-BjN3hr04.js";import"./index-BkD7Hj8s.js";import"./ticks-yQcwDFE8.js";import"./arc-B8IjlRao.js";import"./rgb-Co1IAoj1.js";import"./math-CyDA0WRY.js";import"./index-DaJBD5B5.js";import"./defaultLocale-D2nGpDRe.js";import"./Tableau10-1LCcg9PS.js";import"./range-OtVwhkKS.js";var U={exports:{}},ir=U.exports,Y;function ur(){return Y||(Y=1,(function(G,W){(function(b,u){G.exports=u()})(ir,function(){var b=(function(u,f){var _=Array.prototype.concat,p=Array.prototype.slice,w=Object.prototype.toString;function d(a,c){var v=a>c?a:c;return u.pow(10,17-~~(u.log(v>0?v:-v)*u.LOG10E))}var i=Array.isArray||function(c){return w.call(c)==="[object Array]"};function r(a){return w.call(a)==="[object Function]"}function n(a){return typeof a=="number"?a-a===0:!1}function e(a){return _.apply([],a)}function o(){return new o._init(arguments)}o.fn=o.prototype,o._init=function(c){if(i(c[0]))if(i(c[0][0])){r(c[1])&&(c[0]=o.map(c[0],c[1]));for(var v=0;v<c[0].length;v++)this[v]=c[0][v];this.length=c[0].length}else this[0]=r(c[1])?o.map(c[0],c[1]):c[0],this.length=1;else if(n(c[0]))this[0]=o.seq.apply(null,c),this.length=1;else{if(c[0]instanceof o)return o(c[0].toArray());this[0]=[],this.length=1}return this},o._init.prototype=o.prototype,o._init.constructor=o,o.utils={calcRdx:d,isArray:i,isFunction:r,isNumber:n,toVector:e},o._random_fn=u.random,o.setRandom=function(c){if(typeof c!="function")throw new TypeError("fn is not a function");o._random_fn=c},o.extend=function(c){var v,g;if(arguments.length===1){for(g in c)o[g]=c[g];return this}for(v=1;v<arguments.length;v++)for(g in arguments[v])c[g]=arguments[v][g];return c},o.rows=function(c){return c.length||1},o.cols=function(c){return c[0].length||1},o.dimensions=function(c){return{rows:o.rows(c),cols:o.cols(c)}},o.row=function(c,v){return i(v)?v.map(function(g){return o.row(c,g)}):c[v]},o.rowa=function(c,v){return o.row(c,v)},o.col=function(c,v){if(i(v)){var g=o.arange(c.length).map(function(){return new Array(v.length)});return v.forEach(function(q,x){o.arange(c.length).forEach(function(R){g[R][x]=c[R][q]})}),g}for(var y=new Array(c.length),h=0;h<c.length;h++)y[h]=[c[h][v]];return y},o.cola=function(c,v){return o.col(c,v).map(function(g){return g[0]})},o.diag=function(c){for(var v=o.rows(c),g=new Array(v),y=0;y<v;y++)g[y]=[c[y][y]];return g},o.antidiag=function(c){for(var v=o.rows(c)-1,g=new Array(v),y=0;v>=0;v--,y++)g[y]=[c[y][v]];return g},o.transpose=function(c){var v=[],g,y,h,q,x;for(i(c[0])||(c=[c]),y=c.length,h=c[0].length,x=0;x<h;x++){for(g=new Array(y),q=0;q<y;q++)g[q]=c[q][x];v.push(g)}return v.length===1?v[0]:v},o.map=function(c,v,g){var y,h,q,x,R;for(i(c[0])||(c=[c]),h=c.length,q=c[0].length,x=g?c:new Array(h),y=0;y<h;y++)for(x[y]||(x[y]=new Array(q)),R=0;R<q;R++)x[y][R]=v(c[y][R],y,R);return x.length===1?x[0]:x},o.cumreduce=function(c,v,g){var y,h,q,x,R;for(i(c[0])||(c=[c]),h=c.length,q=c[0].length,x=g?c:new Array(h),y=0;y<h;y++)for(x[y]||(x[y]=new Array(q)),q>0&&(x[y][0]=c[y][0]),R=1;R<q;R++)x[y][R]=v(x[y][R-1],c[y][R]);return x.length===1?x[0]:x},o.alter=function(c,v){return o.map(c,v,!0)},o.create=function(c,v,g){var y=new Array(c),h,q;for(r(v)&&(g=v,v=c),h=0;h<c;h++)for(y[h]=new Array(v),q=0;q<v;q++)y[h][q]=g(h,q);return y};function t(){return 0}o.zeros=function(c,v){return n(v)||(v=c),o.create(c,v,t)};function s(){return 1}o.ones=function(c,v){return n(v)||(v=c),o.create(c,v,s)},o.rand=function(c,v){return n(v)||(v=c),o.create(c,v,o._random_fn)};function l(a,c){return a===c?1:0}o.identity=function(c,v){return n(v)||(v=c),o.create(c,v,l)},o.symmetric=function(c){var v=c.length,g,y;if(c.length!==c[0].length)return!1;for(g=0;g<v;g++)for(y=0;y<v;y++)if(c[y][g]!==c[g][y])return!1;return!0},o.clear=function(c){return o.alter(c,t)},o.seq=function(c,v,g,y){r(y)||(y=!1);var h=[],q=d(c,v),x=(v*q-c*q)/((g-1)*q),R=c,E;for(E=0;R<=v&&E<g;E++,R=(c*q+x*q*E)/q)h.push(y?y(R,E):R);return h},o.arange=function(c,v,g){var y=[],h;if(g=g||1,v===f&&(v=c,c=0),c===v||g===0)return[];if(c<v&&g<0)return[];if(c>v&&g>0)return[];if(g>0)for(h=c;h<v;h+=g)y.push(h);else for(h=c;h>v;h+=g)y.push(h);return y},o.slice=(function(){function a(v,g,y,h){var q,x=[],R=v.length;if(g===f&&y===f&&h===f)return o.copy(v);if(g=g||0,y=y||v.length,g=g>=0?g:R+g,y=y>=0?y:R+y,h=h||1,g===y||h===0)return[];if(g<y&&h<0)return[];if(g>y&&h>0)return[];if(h>0)for(q=g;q<y;q+=h)x.push(v[q]);else for(q=g;q>y;q+=h)x.push(v[q]);return x}function c(v,g){var y,h;if(g=g||{},n(g.row)){if(n(g.col))return v[g.row][g.col];var q=o.rowa(v,g.row);return y=g.col||{},a(q,y.start,y.end,y.step)}if(n(g.col)){var x=o.cola(v,g.col);return h=g.row||{},a(x,h.start,h.end,h.step)}h=g.row||{},y=g.col||{};var R=a(v,h.start,h.end,h.step);return R.map(function(E){return a(E,y.start,y.end,y.step)})}return c})(),o.sliceAssign=function(c,v,g){var y,h;if(n(v.row)){if(n(v.col))return c[v.row][v.col]=g;v.col=v.col||{},v.col.start=v.col.start||0,v.col.end=v.col.end||c[0].length,v.col.step=v.col.step||1,y=o.arange(v.col.start,u.min(c.length,v.col.end),v.col.step);var q=v.row;return y.forEach(function(R,E){c[q][R]=g[E]}),c}if(n(v.col)){v.row=v.row||{},v.row.start=v.row.start||0,v.row.end=v.row.end||c.length,v.row.step=v.row.step||1,h=o.arange(v.row.start,u.min(c[0].length,v.row.end),v.row.step);var x=v.col;return h.forEach(function(R,E){c[R][x]=g[E]}),c}return g[0].length===f&&(g=[g]),v.row.start=v.row.start||0,v.row.end=v.row.end||c.length,v.row.step=v.row.step||1,v.col.start=v.col.start||0,v.col.end=v.col.end||c[0].length,v.col.step=v.col.step||1,h=o.arange(v.row.start,u.min(c.length,v.row.end),v.row.step),y=o.arange(v.col.start,u.min(c[0].length,v.col.end),v.col.step),h.forEach(function(R,E){y.forEach(function(I,k){c[R][I]=g[E][k]})}),c},o.diagonal=function(c){var v=o.zeros(c.length,c.length);return c.forEach(function(g,y){v[y][y]=g}),v},o.copy=function(c){return c.map(function(v){return n(v)?v:v.map(function(g){return g})})};var m=o.prototype;return m.length=0,m.push=Array.prototype.push,m.sort=Array.prototype.sort,m.splice=Array.prototype.splice,m.slice=Array.prototype.slice,m.toArray=function(){return this.length>1?p.call(this):p.call(this)[0]},m.map=function(c,v){return o(o.map(this,c,v))},m.cumreduce=function(c,v){return o(o.cumreduce(this,c,v))},m.alter=function(c){return o.alter(this,c),this},(function(a){for(var c=0;c<a.length;c++)(function(v){m[v]=function(g){var y=this,h;return g?(setTimeout(function(){g.call(y,m[v].call(y))}),this):(h=o[v](this),i(h)?o(h):h)}})(a[c])})("transpose clear symmetric rows cols dimensions diag antidiag".split(" ")),(function(a){for(var c=0;c<a.length;c++)(function(v){m[v]=function(g,y){var h=this;return y?(setTimeout(function(){y.call(h,m[v].call(h,g))}),this):o(o[v](this,g))}})(a[c])})("row col".split(" ")),(function(a){for(var c=0;c<a.length;c++)(function(v){m[v]=function(){return o(o[v].apply(null,arguments))}})(a[c])})("create zeros ones rand identity".split(" ")),o})(Math);return(function(u,f){var _=u.utils.isFunction;function p(i,r){return i-r}function w(i,r,n){return f.max(r,f.min(i,n))}u.sum=function(r){for(var n=0,e=r.length;--e>=0;)n+=r[e];return n},u.sumsqrd=function(r){for(var n=0,e=r.length;--e>=0;)n+=r[e]*r[e];return n},u.sumsqerr=function(r){for(var n=u.mean(r),e=0,o=r.length,t;--o>=0;)t=r[o]-n,e+=t*t;return e},u.sumrow=function(r){for(var n=0,e=r.length;--e>=0;)n+=r[e];return n},u.product=function(r){for(var n=1,e=r.length;--e>=0;)n*=r[e];return n},u.min=function(r){for(var n=r[0],e=0;++e<r.length;)r[e]<n&&(n=r[e]);return n},u.max=function(r){for(var n=r[0],e=0;++e<r.length;)r[e]>n&&(n=r[e]);return n},u.unique=function(r){for(var n={},e=[],o=0;o<r.length;o++)n[r[o]]||(n[r[o]]=!0,e.push(r[o]));return e},u.mean=function(r){return u.sum(r)/r.length},u.meansqerr=function(r){return u.sumsqerr(r)/r.length},u.geomean=function(r){var n=r.map(f.log),e=u.mean(n);return f.exp(e)},u.median=function(r){var n=r.length,e=r.slice().sort(p);return n&1?e[n/2|0]:(e[n/2-1]+e[n/2])/2},u.cumsum=function(r){return u.cumreduce(r,function(n,e){return n+e})},u.cumprod=function(r){return u.cumreduce(r,function(n,e){return n*e})},u.diff=function(r){var n=[],e=r.length,o;for(o=1;o<e;o++)n.push(r[o]-r[o-1]);return n},u.rank=function(i){var r,n=[],e={};for(r=0;r<i.length;r++){var o=i[r];e[o]?e[o]++:(e[o]=1,n.push(o))}var t=n.sort(p),s={},l=1;for(r=0;r<t.length;r++){var o=t[r],m=e[o],a=l,c=l+m-1,v=(a+c)/2;s[o]=v,l+=m}return i.map(function(g){return s[g]})},u.mode=function(r){var n=r.length,e=r.slice().sort(p),o=1,t=0,s=0,l=[],m;for(m=0;m<n;m++)e[m]===e[m+1]?o++:(o>t?(l=[e[m]],t=o,s=0):o===t&&(l.push(e[m]),s++),o=1);return s===0?l[0]:l},u.range=function(r){return u.max(r)-u.min(r)},u.variance=function(r,n){return u.sumsqerr(r)/(r.length-(n?1:0))},u.pooledvariance=function(r){var n=r.reduce(function(o,t){return o+u.sumsqerr(t)},0),e=r.reduce(function(o,t){return o+t.length},0);return n/(e-r.length)},u.deviation=function(i){for(var r=u.mean(i),n=i.length,e=new Array(n),o=0;o<n;o++)e[o]=i[o]-r;return e},u.stdev=function(r,n){return f.sqrt(u.variance(r,n))},u.pooledstdev=function(r){return f.sqrt(u.pooledvariance(r))},u.meandev=function(r){for(var n=u.mean(r),e=[],o=r.length-1;o>=0;o--)e.push(f.abs(r[o]-n));return u.mean(e)},u.meddev=function(r){for(var n=u.median(r),e=[],o=r.length-1;o>=0;o--)e.push(f.abs(r[o]-n));return u.median(e)},u.coeffvar=function(r){return u.stdev(r)/u.mean(r)},u.quartiles=function(r){var n=r.length,e=r.slice().sort(p);return[e[f.round(n/4)-1],e[f.round(n/2)-1],e[f.round(n*3/4)-1]]},u.quantiles=function(r,n,e,o){var t=r.slice().sort(p),s=[n.length],l=r.length,m,a,c,v,g,y;for(typeof e>"u"&&(e=3/8),typeof o>"u"&&(o=3/8),m=0;m<n.length;m++)a=n[m],c=e+a*(1-e-o),v=l*a+c,g=f.floor(w(v,1,l-1)),y=w(v-g,0,1),s[m]=(1-y)*t[g-1]+y*t[g];return s},u.percentile=function(r,n,e){var o=r.slice().sort(p),t=n*(o.length+(e?1:-1))+(e?0:1),s=parseInt(t),l=t-s;return s+1<o.length?o[s-1]+l*(o[s]-o[s-1]):o[s-1]},u.percentileOfScore=function(r,n,e){var o=0,t=r.length,s=!1,l,m;for(e==="strict"&&(s=!0),m=0;m<t;m++)l=r[m],(s&&l<n||!s&&l<=n)&&o++;return o/t},u.histogram=function(r,n){n=n||4;var e=u.min(r),o=(u.max(r)-e)/n,t=r.length,s=[],l;for(l=0;l<n;l++)s[l]=0;for(l=0;l<t;l++)s[f.min(f.floor((r[l]-e)/o),n-1)]+=1;return s},u.covariance=function(r,n){var e=u.mean(r),o=u.mean(n),t=r.length,s=new Array(t),l;for(l=0;l<t;l++)s[l]=(r[l]-e)*(n[l]-o);return u.sum(s)/(t-1)},u.corrcoeff=function(r,n){return u.covariance(r,n)/u.stdev(r,1)/u.stdev(n,1)},u.spearmancoeff=function(i,r){return i=u.rank(i),r=u.rank(r),u.corrcoeff(i,r)},u.stanMoment=function(r,n){for(var e=u.mean(r),o=u.stdev(r),t=r.length,s=0,l=0;l<t;l++)s+=f.pow((r[l]-e)/o,n);return s/r.length},u.skewness=function(r){return u.stanMoment(r,3)},u.kurtosis=function(r){return u.stanMoment(r,4)-3};var d=u.prototype;(function(i){for(var r=0;r<i.length;r++)(function(n){d[n]=function(e,o){var t=[],s=0,l=this;if(_(e)&&(o=e,e=!1),o)return setTimeout(function(){o.call(l,d[n].call(l,e))}),this;if(this.length>1){for(l=e===!0?this:this.transpose();s<l.length;s++)t[s]=u[n](l[s]);return t}return u[n](this[0],e)}})(i[r])})("cumsum cumprod".split(" ")),(function(i){for(var r=0;r<i.length;r++)(function(n){d[n]=function(e,o){var t=[],s=0,l=this;if(_(e)&&(o=e,e=!1),o)return setTimeout(function(){o.call(l,d[n].call(l,e))}),this;if(this.length>1){for(n!=="sumrow"&&(l=e===!0?this:this.transpose());s<l.length;s++)t[s]=u[n](l[s]);return e===!0?u[n](u.utils.toVector(t)):t}return u[n](this[0],e)}})(i[r])})("sum sumsqrd sumsqerr sumrow product min max unique mean meansqerr geomean median diff rank mode range variance deviation stdev meandev meddev coeffvar quartiles histogram skewness kurtosis".split(" ")),(function(i){for(var r=0;r<i.length;r++)(function(n){d[n]=function(){var e=[],o=0,t=this,s=Array.prototype.slice.call(arguments),l;if(_(s[s.length-1])){l=s[s.length-1];var m=s.slice(0,s.length-1);return setTimeout(function(){l.call(t,d[n].apply(t,m))}),this}else{l=void 0;var a=function(v){return u[n].apply(t,[v].concat(s))}}if(this.length>1){for(t=t.transpose();o<t.length;o++)e[o]=a(t[o]);return e}return a(this[0])}})(i[r])})("quantiles percentileOfScore".split(" "))})(b,Math),(function(u,f){u.gammaln=function(p){var w=0,d=[76.18009172947146,-86.50532032941678,24.01409824083091,-1.231739572450155,.001208650973866179,-5395239384953e-18],i=1.000000000190015,r,n,e;for(e=(n=r=p)+5.5,e-=(r+.5)*f.log(e);w<6;w++)i+=d[w]/++n;return f.log(2.5066282746310007*i/r)-e},u.loggam=function(p){var w,d,i,r,n,e,o,t=[.08333333333333333,-.002777777777777778,.0007936507936507937,-.0005952380952380952,.0008417508417508418,-.001917526917526918,.00641025641025641,-.02955065359477124,.1796443723688307,-1.3924322169059];if(w=p,o=0,p==1||p==2)return 0;for(p<=7&&(o=f.floor(7-p),w=p+o),d=1/(w*w),i=2*f.PI,n=t[9],e=8;e>=0;e--)n*=d,n+=t[e];if(r=n/w+.5*f.log(i)+(w-.5)*f.log(w)-w,p<=7)for(e=1;e<=o;e++)r-=f.log(w-1),w-=1;return r},u.gammafn=function(p){var w=[-1.716185138865495,24.76565080557592,-379.80425647094563,629.3311553128184,866.9662027904133,-31451.272968848367,-36144.413418691176,66456.14382024054],d=[-30.8402300119739,315.35062697960416,-1015.1563674902192,-3107.771671572311,22538.11842098015,4755.846277527881,-134659.9598649693,-115132.2596755535],i=!1,r=0,n=0,e=0,o=p,t,s,l,m;if(p>171.6243769536076)return 1/0;if(o<=0)if(m=o%1+36e-17,m)i=(o&1?-1:1)*f.PI/f.sin(f.PI*m),o=1-o;else return 1/0;for(l=o,o<1?s=o++:s=(o-=r=(o|0)-1)-1,t=0;t<8;++t)e=(e+w[t])*s,n=n*s+d[t];if(m=e/n+1,l<o)m/=l;else if(l>o)for(t=0;t<r;++t)m*=o,o++;return i&&(m=i/m),m},u.gammap=function(p,w){return u.lowRegGamma(p,w)*u.gammafn(p)},u.lowRegGamma=function(p,w){var d=u.gammaln(p),i=p,r=1/p,n=r,e=w+1-p,o=1/1e-30,t=1/e,s=t,l=1,m=-~(f.log(p>=1?p:1/p)*8.5+p*.4+17),a;if(w<0||p<=0)return NaN;if(w<p+1){for(;l<=m;l++)r+=n*=w/++i;return r*f.exp(-w+p*f.log(w)-d)}for(;l<=m;l++)a=-l*(l-p),e+=2,t=a*t+e,o=e+a/o,t=1/t,s*=t*o;return 1-s*f.exp(-w+p*f.log(w)-d)},u.factorialln=function(p){return p<0?NaN:u.gammaln(p+1)},u.factorial=function(p){return p<0?NaN:u.gammafn(p+1)},u.combination=function(p,w){return p>170||w>170?f.exp(u.combinationln(p,w)):u.factorial(p)/u.factorial(w)/u.factorial(p-w)},u.combinationln=function(p,w){return u.factorialln(p)-u.factorialln(w)-u.factorialln(p-w)},u.permutation=function(p,w){return u.factorial(p)/u.factorial(p-w)},u.betafn=function(p,w){if(!(p<=0||w<=0))return p+w>170?f.exp(u.betaln(p,w)):u.gammafn(p)*u.gammafn(w)/u.gammafn(p+w)},u.betaln=function(p,w){return u.gammaln(p)+u.gammaln(w)-u.gammaln(p+w)},u.betacf=function(p,w,d){var i=1e-30,r=1,n=w+d,e=w+1,o=w-1,t=1,s=1-n*p/e,l,m,a,c;for(f.abs(s)<i&&(s=i),s=1/s,c=s;r<=100&&(l=2*r,m=r*(d-r)*p/((o+l)*(w+l)),s=1+m*s,f.abs(s)<i&&(s=i),t=1+m/t,f.abs(t)<i&&(t=i),s=1/s,c*=s*t,m=-(w+r)*(n+r)*p/((w+l)*(e+l)),s=1+m*s,f.abs(s)<i&&(s=i),t=1+m/t,f.abs(t)<i&&(t=i),s=1/s,a=s*t,c*=a,!(f.abs(a-1)<3e-7));r++);return c},u.gammapinv=function(p,w){var d=0,i=w-1,r=1e-8,n=u.gammaln(w),e,o,t,s,l,m,a;if(p>=1)return f.max(100,w+100*f.sqrt(w));if(p<=0)return 0;for(w>1?(m=f.log(i),a=f.exp(i*(m-1)-n),l=p<.5?p:1-p,t=f.sqrt(-2*f.log(l)),e=(2.30753+t*.27061)/(1+t*(.99229+t*.04481))-t,p<.5&&(e=-e),e=f.max(.001,w*f.pow(1-1/(9*w)-e/(3*f.sqrt(w)),3))):(t=1-w*(.253+w*.12),p<t?e=f.pow(p/t,1/w):e=1-f.log(1-(p-t)/(1-t)));d<12;d++){if(e<=0)return 0;if(o=u.lowRegGamma(w,e)-p,w>1?t=a*f.exp(-(e-i)+i*(f.log(e)-m)):t=f.exp(-e+i*f.log(e)-n),s=o/t,e-=t=s/(1-.5*f.min(1,s*((w-1)/e-1))),e<=0&&(e=.5*(e+t)),f.abs(t)<r*e)break}return e},u.erf=function(p){var w=[-1.3026537197817094,.6419697923564902,.019476473204185836,-.00956151478680863,-.000946595344482036,.000366839497852761,42523324806907e-18,-20278578112534e-18,-1624290004647e-18,130365583558e-17,15626441722e-18,-85238095915e-18,6529054439e-18,5059343495e-18,-991364156e-18,-227365122e-18,96467911e-18,2394038e-18,-6886027e-18,894487e-18,313092e-18,-112708e-18,381e-18,7106e-18,-1523e-18,-94e-18,121e-18,-28e-18],d=w.length-1,i=!1,r=0,n=0,e,o,t,s;for(p<0&&(p=-p,i=!0),e=2/(2+p),o=4*e-2;d>0;d--)t=r,r=o*r-n+w[d],n=t;return s=e*f.exp(-p*p+.5*(w[0]+o*r)-n),i?s-1:1-s},u.erfc=function(p){return 1-u.erf(p)},u.erfcinv=function(p){var w=0,d,i,r,n;if(p>=2)return-100;if(p<=0)return 100;for(n=p<1?p:2-p,r=f.sqrt(-2*f.log(n/2)),d=-.70711*((2.30753+r*.27061)/(1+r*(.99229+r*.04481))-r);w<2;w++)i=u.erfc(d)-n,d+=i/(1.1283791670955126*f.exp(-d*d)-d*i);return p<1?d:-d},u.ibetainv=function(p,w,d){var i=1e-8,r=w-1,n=d-1,e=0,o,t,s,l,m,a,c,v,g,y,h;if(p<=0)return 0;if(p>=1)return 1;for(w>=1&&d>=1?(s=p<.5?p:1-p,l=f.sqrt(-2*f.log(s)),c=(2.30753+l*.27061)/(1+l*(.99229+l*.04481))-l,p<.5&&(c=-c),v=(c*c-3)/6,g=2/(1/(2*w-1)+1/(2*d-1)),y=c*f.sqrt(v+g)/g-(1/(2*d-1)-1/(2*w-1))*(v+5/6-2/(3*g)),c=w/(w+d*f.exp(2*y))):(o=f.log(w/(w+d)),t=f.log(d/(w+d)),l=f.exp(w*o)/w,m=f.exp(d*t)/d,y=l+m,p<l/y?c=f.pow(w*y*p,1/w):c=1-f.pow(d*y*(1-p),1/d)),h=-u.gammaln(w)-u.gammaln(d)+u.gammaln(w+d);e<10;e++){if(c===0||c===1)return c;if(a=u.ibeta(c,w,d)-p,l=f.exp(r*f.log(c)+n*f.log(1-c)+h),m=a/l,c-=l=m/(1-.5*f.min(1,m*(r/c-n/(1-c)))),c<=0&&(c=.5*(c+l)),c>=1&&(c=.5*(c+l+1)),f.abs(l)<i*c&&e>0)break}return c},u.ibeta=function(p,w,d){var i=p===0||p===1?0:f.exp(u.gammaln(w+d)-u.gammaln(w)-u.gammaln(d)+w*f.log(p)+d*f.log(1-p));return p<0||p>1?!1:p<(w+1)/(w+d+2)?i*u.betacf(p,w,d)/w:1-i*u.betacf(1-p,d,w)/d},u.randn=function(p,w){var d,i,r,n,e;if(w||(w=p),p)return u.create(p,w,function(){return u.randn()});do d=u._random_fn(),i=1.7156*(u._random_fn()-.5),r=d-.449871,n=f.abs(i)+.386595,e=r*r+n*(.196*n-.25472*r);while(e>.27597&&(e>.27846||i*i>-4*f.log(d)*d*d));return i/d},u.randg=function(p,w,d){var i=p,r,n,e,o,t,s;if(d||(d=w),p||(p=1),w)return s=u.zeros(w,d),s.alter(function(){return u.randg(p)}),s;p<1&&(p+=1),r=p-1/3,n=1/f.sqrt(9*r);do{do t=u.randn(),o=1+n*t;while(o<=0);o=o*o*o,e=u._random_fn()}while(e>1-.331*f.pow(t,4)&&f.log(e)>.5*t*t+r*(1-o+f.log(o)));if(p==i)return r*o;do e=u._random_fn();while(e===0);return f.pow(e,1/i)*r*o},(function(_){for(var p=0;p<_.length;p++)(function(w){u.fn[w]=function(){return u(u.map(this,function(d){return u[w](d)}))}})(_[p])})("gammaln gammafn factorial factorialln".split(" ")),(function(_){for(var p=0;p<_.length;p++)(function(w){u.fn[w]=function(){return u(u[w].apply(null,arguments))}})(_[p])})("randn".split(" "))})(b,Math),(function(u,f){(function(i){for(var r=0;r<i.length;r++)(function(n){u[n]=function e(o,t,s){return this instanceof e?(this._a=o,this._b=t,this._c=s,this):new e(o,t,s)},u.fn[n]=function(e,o,t){var s=u[n](e,o,t);return s.data=this,s},u[n].prototype.sample=function(e){var o=this._a,t=this._b,s=this._c;return e?u.alter(e,function(){return u[n].sample(o,t,s)}):u[n].sample(o,t,s)},(function(e){for(var o=0;o<e.length;o++)(function(t){u[n].prototype[t]=function(s){var l=this._a,m=this._b,a=this._c;return!s&&s!==0&&(s=this.data),typeof s!="number"?u.fn.map.call(s,function(c){return u[n][t](c,l,m,a)}):u[n][t](s,l,m,a)}})(e[o])})("pdf cdf inv".split(" ")),(function(e){for(var o=0;o<e.length;o++)(function(t){u[n].prototype[t]=function(){return u[n][t](this._a,this._b,this._c)}})(e[o])})("mean median mode variance".split(" "))})(i[r])})("beta centralF cauchy chisquare exponential gamma invgamma kumaraswamy laplace lognormal noncentralt normal pareto studentt weibull uniform binomial negbin hypgeom poisson triangular tukey arcsine".split(" ")),u.extend(u.beta,{pdf:function(r,n,e){return r>1||r<0?0:n==1&&e==1?1:n<512&&e<512?f.pow(r,n-1)*f.pow(1-r,e-1)/u.betafn(n,e):f.exp((n-1)*f.log(r)+(e-1)*f.log(1-r)-u.betaln(n,e))},cdf:function(r,n,e){return r>1||r<0?(r>1)*1:u.ibeta(r,n,e)},inv:function(r,n,e){return u.ibetainv(r,n,e)},mean:function(r,n){return r/(r+n)},median:function(r,n){return u.ibetainv(.5,r,n)},mode:function(r,n){return(r-1)/(r+n-2)},sample:function(r,n){var e=u.randg(r);return e/(e+u.randg(n))},variance:function(r,n){return r*n/(f.pow(r+n,2)*(r+n+1))}}),u.extend(u.centralF,{pdf:function(r,n,e){var o,t,s;return r<0?0:n<=2?r===0&&n<2?1/0:r===0&&n===2?1:1/u.betafn(n/2,e/2)*f.pow(n/e,n/2)*f.pow(r,n/2-1)*f.pow(1+n/e*r,-(n+e)/2):(o=n*r/(e+r*n),t=e/(e+r*n),s=n*t/2,s*u.binomial.pdf((n-2)/2,(n+e-2)/2,o))},cdf:function(r,n,e){return r<0?0:u.ibeta(n*r/(n*r+e),n/2,e/2)},inv:function(r,n,e){return e/(n*(1/u.ibetainv(r,n/2,e/2)-1))},mean:function(r,n){return n>2?n/(n-2):void 0},mode:function(r,n){return r>2?n*(r-2)/(r*(n+2)):void 0},sample:function(r,n){var e=u.randg(r/2)*2,o=u.randg(n/2)*2;return e/r/(o/n)},variance:function(r,n){if(!(n<=4))return 2*n*n*(r+n-2)/(r*(n-2)*(n-2)*(n-4))}}),u.extend(u.cauchy,{pdf:function(r,n,e){return e<0?0:e/(f.pow(r-n,2)+f.pow(e,2))/f.PI},cdf:function(r,n,e){return f.atan((r-n)/e)/f.PI+.5},inv:function(i,r,n){return r+n*f.tan(f.PI*(i-.5))},median:function(r){return r},mode:function(r){return r},sample:function(r,n){return u.randn()*f.sqrt(1/(2*u.randg(.5)))*n+r}}),u.extend(u.chisquare,{pdf:function(r,n){return r<0?0:r===0&&n===2?.5:f.exp((n/2-1)*f.log(r)-r/2-n/2*f.log(2)-u.gammaln(n/2))},cdf:function(r,n){return r<0?0:u.lowRegGamma(n/2,r/2)},inv:function(i,r){return 2*u.gammapinv(i,.5*r)},mean:function(i){return i},median:function(r){return r*f.pow(1-2/(9*r),3)},mode:function(r){return r-2>0?r-2:0},sample:function(r){return u.randg(r/2)*2},variance:function(r){return 2*r}}),u.extend(u.exponential,{pdf:function(r,n){return r<0?0:n*f.exp(-n*r)},cdf:function(r,n){return r<0?0:1-f.exp(-n*r)},inv:function(i,r){return-f.log(1-i)/r},mean:function(i){return 1/i},median:function(i){return 1/i*f.log(2)},mode:function(){return 0},sample:function(r){return-1/r*f.log(u._random_fn())},variance:function(i){return f.pow(i,-2)}}),u.extend(u.gamma,{pdf:function(r,n,e){return r<0?0:r===0&&n===1?1/e:f.exp((n-1)*f.log(r)-r/e-u.gammaln(n)-n*f.log(e))},cdf:function(r,n,e){return r<0?0:u.lowRegGamma(n,r/e)},inv:function(i,r,n){return u.gammapinv(i,r)*n},mean:function(i,r){return i*r},mode:function(r,n){if(r>1)return(r-1)*n},sample:function(r,n){return u.randg(r)*n},variance:function(r,n){return r*n*n}}),u.extend(u.invgamma,{pdf:function(r,n,e){return r<=0?0:f.exp(-(n+1)*f.log(r)-e/r-u.gammaln(n)+n*f.log(e))},cdf:function(r,n,e){return r<=0?0:1-u.lowRegGamma(n,e/r)},inv:function(i,r,n){return n/u.gammapinv(1-i,r)},mean:function(i,r){return i>1?r/(i-1):void 0},mode:function(r,n){return n/(r+1)},sample:function(r,n){return n/u.randg(r)},variance:function(r,n){if(!(r<=2))return n*n/((r-1)*(r-1)*(r-2))}}),u.extend(u.kumaraswamy,{pdf:function(r,n,e){return r===0&&n===1?e:r===1&&e===1?n:f.exp(f.log(n)+f.log(e)+(n-1)*f.log(r)+(e-1)*f.log(1-f.pow(r,n)))},cdf:function(r,n,e){return r<0?0:r>1?1:1-f.pow(1-f.pow(r,n),e)},inv:function(r,n,e){return f.pow(1-f.pow(1-r,1/e),1/n)},mean:function(i,r){return r*u.gammafn(1+1/i)*u.gammafn(r)/u.gammafn(1+1/i+r)},median:function(r,n){return f.pow(1-f.pow(2,-1/n),1/r)},mode:function(r,n){if(r>=1&&n>=1&&r!==1&&n!==1)return f.pow((r-1)/(r*n-1),1/r)},variance:function(){throw new Error("variance not yet implemented")}}),u.extend(u.lognormal,{pdf:function(r,n,e){return r<=0?0:f.exp(-f.log(r)-.5*f.log(2*f.PI)-f.log(e)-f.pow(f.log(r)-n,2)/(2*e*e))},cdf:function(r,n,e){return r<0?0:.5+.5*u.erf((f.log(r)-n)/f.sqrt(2*e*e))},inv:function(i,r,n){return f.exp(-1.4142135623730951*n*u.erfcinv(2*i)+r)},mean:function(r,n){return f.exp(r+n*n/2)},median:function(r){return f.exp(r)},mode:function(r,n){return f.exp(r-n*n)},sample:function(r,n){return f.exp(u.randn()*n+r)},variance:function(r,n){return(f.exp(n*n)-1)*f.exp(2*r+n*n)}}),u.extend(u.noncentralt,{pdf:function(r,n,e){var o=1e-14;return f.abs(e)<o?u.studentt.pdf(r,n):f.abs(r)<o?f.exp(u.gammaln((n+1)/2)-e*e/2-.5*f.log(f.PI*n)-u.gammaln(n/2)):n/r*(u.noncentralt.cdf(r*f.sqrt(1+2/n),n+2,e)-u.noncentralt.cdf(r,n,e))},cdf:function(r,n,e){var o=1e-14,t=200;if(f.abs(e)<o)return u.studentt.cdf(r,n);var s=!1;r<0&&(s=!0,e=-e);for(var l=u.normal.cdf(-e,0,1),m=o+1,a=m,c=r*r/(r*r+n),v=0,g=f.exp(-e*e/2),y=f.exp(-e*e/2-.5*f.log(2)-u.gammaln(3/2))*e;v<t||a>o||m>o;)a=m,v>0&&(g*=e*e/(2*v),y*=e*e/(2*(v+1/2))),m=g*u.beta.cdf(c,v+.5,n/2)+y*u.beta.cdf(c,v+1,n/2),l+=.5*m,v++;return s?1-l:l}}),u.extend(u.normal,{pdf:function(r,n,e){return f.exp(-.5*f.log(2*f.PI)-f.log(e)-f.pow(r-n,2)/(2*e*e))},cdf:function(r,n,e){return .5*(1+u.erf((r-n)/f.sqrt(2*e*e)))},inv:function(i,r,n){return-1.4142135623730951*n*u.erfcinv(2*i)+r},mean:function(i){return i},median:function(r){return r},mode:function(i){return i},sample:function(r,n){return u.randn()*n+r},variance:function(i,r){return r*r}}),u.extend(u.pareto,{pdf:function(r,n,e){return r<n?0:e*f.pow(n,e)/f.pow(r,e+1)},cdf:function(r,n,e){return r<n?0:1-f.pow(n/r,e)},inv:function(r,n,e){return n/f.pow(1-r,1/e)},mean:function(r,n){if(!(n<=1))return n*f.pow(r,n)/(n-1)},median:function(r,n){return r*(n*f.SQRT2)},mode:function(r){return r},variance:function(i,r){if(!(r<=2))return i*i*r/(f.pow(r-1,2)*(r-2))}}),u.extend(u.studentt,{pdf:function(r,n){return n=n>1e100?1e100:n,1/(f.sqrt(n)*u.betafn(.5,n/2))*f.pow(1+r*r/n,-((n+1)/2))},cdf:function(r,n){var e=n/2;return u.ibeta((r+f.sqrt(r*r+n))/(2*f.sqrt(r*r+n)),e,e)},inv:function(i,r){var n=u.ibetainv(2*f.min(i,1-i),.5*r,.5);return n=f.sqrt(r*(1-n)/n),i>.5?n:-n},mean:function(r){return r>1?0:void 0},median:function(){return 0},mode:function(){return 0},sample:function(r){return u.randn()*f.sqrt(r/(2*u.randg(r/2)))},variance:function(r){return r>2?r/(r-2):r>1?1/0:void 0}}),u.extend(u.weibull,{pdf:function(r,n,e){return r<0||n<0||e<0?0:e/n*f.pow(r/n,e-1)*f.exp(-f.pow(r/n,e))},cdf:function(r,n,e){return r<0?0:1-f.exp(-f.pow(r/n,e))},inv:function(i,r,n){return r*f.pow(-f.log(1-i),1/n)},mean:function(i,r){return i*u.gammafn(1+1/r)},median:function(r,n){return r*f.pow(f.log(2),1/n)},mode:function(r,n){return n<=1?0:r*f.pow((n-1)/n,1/n)},sample:function(r,n){return r*f.pow(-f.log(u._random_fn()),1/n)},variance:function(r,n){return r*r*u.gammafn(1+2/n)-f.pow(u.weibull.mean(r,n),2)}}),u.extend(u.uniform,{pdf:function(r,n,e){return r<n||r>e?0:1/(e-n)},cdf:function(r,n,e){return r<n?0:r<e?(r-n)/(e-n):1},inv:function(i,r,n){return r+i*(n-r)},mean:function(r,n){return .5*(r+n)},median:function(r,n){return u.mean(r,n)},mode:function(){throw new Error("mode is not yet implemented")},sample:function(r,n){return r/2+n/2+(n/2-r/2)*(2*u._random_fn()-1)},variance:function(r,n){return f.pow(n-r,2)/12}});function _(i,r,n,e){for(var o=0,t=1,s=1,l=1,m=0,a=0,c;f.abs((s-a)/s)>e;)a=s,c=-(r+m)*(r+n+m)*i/(r+2*m)/(r+2*m+1),o=s+c*o,t=l+c*t,m=m+1,c=m*(n-m)*i/(r+2*m-1)/(r+2*m),s=o+c*s,l=t+c*l,o=o/l,t=t/l,s=s/l,l=1;return s/r}u.extend(u.binomial,{pdf:function(r,n,e){return e===0||e===1?n*e===r?1:0:u.combination(n,r)*f.pow(e,r)*f.pow(1-e,n-r)},cdf:function(r,n,e){var o,t=1e-10;if(r<0)return 0;if(r>=n)return 1;if(e<0||e>1||n<=0)return NaN;r=f.floor(r);var s=e,l=r+1,m=n-r,a=l+m,c=f.exp(u.gammaln(a)-u.gammaln(m)-u.gammaln(l)+l*f.log(s)+m*f.log(1-s));return s<(l+1)/(a+2)?o=c*_(s,l,m,t):o=1-c*_(1-s,m,l,t),f.round((1-o)*(1/t))/(1/t)}}),u.extend(u.negbin,{pdf:function(r,n,e){return r!==r>>>0?!1:r<0?0:u.combination(r+n-1,n-1)*f.pow(1-e,r)*f.pow(e,n)},cdf:function(r,n,e){var o=0,t=0;if(r<0)return 0;for(;t<=r;t++)o+=u.negbin.pdf(t,n,e);return o}}),u.extend(u.hypgeom,{pdf:function(r,n,e,o){if(r!==r|0)return!1;if(r<0||r<e-(n-o))return 0;if(r>o||r>e)return 0;if(e*2>n)return o*2>n?u.hypgeom.pdf(n-e-o+r,n,n-e,n-o):u.hypgeom.pdf(o-r,n,n-e,o);if(o*2>n)return u.hypgeom.pdf(e-r,n,e,n-o);if(e<o)return u.hypgeom.pdf(r,n,o,e);for(var t=1,s=0,l=0;l<r;l++){for(;t>1&&s<o;)t*=1-e/(n-s),s++;t*=(o-l)*(e-l)/((l+1)*(n-e-o+l+1))}for(;s<o;s++)t*=1-e/(n-s);return f.min(1,f.max(0,t))},cdf:function(r,n,e,o){if(r<0||r<e-(n-o))return 0;if(r>=o||r>=e)return 1;if(e*2>n)return o*2>n?u.hypgeom.cdf(n-e-o+r,n,n-e,n-o):1-u.hypgeom.cdf(o-r-1,n,n-e,o);if(o*2>n)return 1-u.hypgeom.cdf(e-r-1,n,e,n-o);if(e<o)return u.hypgeom.cdf(r,n,o,e);for(var t=1,s=1,l=0,m=0;m<r;m++){for(;t>1&&l<o;){var a=1-e/(n-l);s*=a,t*=a,l++}s*=(o-m)*(e-m)/((m+1)*(n-e-o+m+1)),t+=s}for(;l<o;l++)t*=1-e/(n-l);return f.min(1,f.max(0,t))}}),u.extend(u.poisson,{pdf:function(r,n){return n<0||r%1!==0||r<0?0:f.pow(n,r)*f.exp(-n)/u.factorial(r)},cdf:function(r,n){var e=[],o=0;if(r<0)return 0;for(;o<=r;o++)e.push(u.poisson.pdf(o,n));return u.sum(e)},mean:function(i){return i},variance:function(i){return i},sampleSmall:function(r){var n=1,e=0,o=f.exp(-r);do e++,n*=u._random_fn();while(n>o);return e-1},sampleLarge:function(r){var n=r,e,o,t,s,l,m,a,c,v,g;for(s=f.sqrt(n),l=f.log(n),a=.931+2.53*s,m=-.059+.02483*a,c=1.1239+1.1328/(a-3.4),v=.9277-3.6224/(a-2);;){if(o=f.random()-.5,t=f.random(),g=.5-f.abs(o),e=f.floor((2*m/g+a)*o+n+.43),g>=.07&&t<=v)return e;if(!(e<0||g<.013&&t>g)&&f.log(t)+f.log(c)-f.log(m/(g*g)+a)<=-n+e*l-u.loggam(e+1))return e}},sample:function(r){return r<10?this.sampleSmall(r):this.sampleLarge(r)}}),u.extend(u.triangular,{pdf:function(r,n,e,o){return e<=n||o<n||o>e?NaN:r<n||r>e?0:r<o?2*(r-n)/((e-n)*(o-n)):r===o?2/(e-n):2*(e-r)/((e-n)*(e-o))},cdf:function(r,n,e,o){return e<=n||o<n||o>e?NaN:r<=n?0:r>=e?1:r<=o?f.pow(r-n,2)/((e-n)*(o-n)):1-f.pow(e-r,2)/((e-n)*(e-o))},inv:function(r,n,e,o){return e<=n||o<n||o>e?NaN:r<=(o-n)/(e-n)?n+(e-n)*f.sqrt(r*((o-n)/(e-n))):n+(e-n)*(1-f.sqrt((1-r)*(1-(o-n)/(e-n))))},mean:function(r,n,e){return(r+n+e)/3},median:function(r,n,e){if(e<=(r+n)/2)return n-f.sqrt((n-r)*(n-e))/f.sqrt(2);if(e>(r+n)/2)return r+f.sqrt((n-r)*(e-r))/f.sqrt(2)},mode:function(r,n,e){return e},sample:function(r,n,e){var o=u._random_fn();return o<(e-r)/(n-r)?r+f.sqrt(o*(n-r)*(e-r)):n-f.sqrt((1-o)*(n-r)*(n-e))},variance:function(r,n,e){return(r*r+n*n+e*e-r*n-r*e-n*e)/18}}),u.extend(u.arcsine,{pdf:function(r,n,e){return e<=n?NaN:r<=n||r>=e?0:2/f.PI*f.pow(f.pow(e-n,2)-f.pow(2*r-n-e,2),-.5)},cdf:function(r,n,e){return r<n?0:r<e?2/f.PI*f.asin(f.sqrt((r-n)/(e-n))):1},inv:function(i,r,n){return r+(.5-.5*f.cos(f.PI*i))*(n-r)},mean:function(r,n){return n<=r?NaN:(r+n)/2},median:function(r,n){return n<=r?NaN:(r+n)/2},mode:function(){throw new Error("mode is not yet implemented")},sample:function(r,n){return(r+n)/2+(n-r)/2*f.sin(2*f.PI*u.uniform.sample(0,1))},variance:function(r,n){return n<=r?NaN:f.pow(n-r,2)/8}});function p(i){return i/f.abs(i)}u.extend(u.laplace,{pdf:function(r,n,e){return e<=0?0:f.exp(-f.abs(r-n)/e)/(2*e)},cdf:function(r,n,e){return e<=0?0:r<n?.5*f.exp((r-n)/e):1-.5*f.exp(-(r-n)/e)},mean:function(i){return i},median:function(i){return i},mode:function(i){return i},variance:function(i,r){return 2*r*r},sample:function(r,n){var e=u._random_fn()-.5;return r-n*p(e)*f.log(1-2*f.abs(e))}});function w(i,r,n){var e=12,o=6,t=-30,s=-50,l=60,m=8,a=3,c=2,v=3,g=[.9815606342467192,.9041172563704749,.7699026741943047,.5873179542866175,.3678314989981802,.1252334085114689],y=[.04717533638651183,.10693932599531843,.16007832854334622,.20316742672306592,.2334925365383548,.24914704581340277],h=i*.5;if(h>=m)return 1;var q=2*u.normal.cdf(h,0,1,1,0)-1;q>=f.exp(s/n)?q=f.pow(q,n):q=0;var x;i>a?x=c:x=v;for(var R=h,E=(m-h)/x,I=R+E,k=0,N=n-1,J=1;J<=x;J++){for(var D=0,O=.5*(I+R),V=.5*(I-R),L=1;L<=e;L++){var P,A;o<L?(P=e-L+1,A=g[P-1]):(P=L,A=-g[P-1]);var T=V*A,z=O+T,C=z*z;if(C>l)break;var B=2*u.normal.cdf(z,0,1,1,0),H=2*u.normal.cdf(z,i,1,1,0),Q=B*.5-H*.5;Q>=f.exp(t/N)&&(Q=y[P-1]*f.exp(-(.5*C))*f.pow(Q,N),D+=Q)}D*=2*V*n/f.sqrt(2*f.PI),k+=D,R=I,I+=E}return q+=k,q<=f.exp(t/r)?0:(q=f.pow(q,r),q>=1?1:q)}function d(i,r,n){var e=.322232421088,o=.099348462606,t=-1,s=.588581570495,l=-.342242088547,m=.531103462366,a=-.204231210125,c=.10353775285,v=-453642210148e-16,g=.0038560700634,y=.8832,h=.2368,q=1.208,x=1.4142,R=120,E=.5-.5*i,I=f.sqrt(f.log(1/(E*E))),k=I+((((I*v+a)*I+l)*I+t)*I+e)/((((I*g+c)*I+m)*I+s)*I+o);n<R&&(k+=(k*k*k+k)/n/4);var N=y-h*k;return n<R&&(N+=-1.214/n+q*k/n),k*(N*f.log(r-1)+x)}u.extend(u.tukey,{cdf:function(r,n,e){var o=1,t=n,s=16,l=8,m=-30,a=1e-14,c=100,v=800,g=5e3,y=25e3,h=1,q=.5,x=.25,R=.125,E=[.9894009349916499,.9445750230732326,.8656312023878318,.755404408355003,.6178762444026438,.45801677765722737,.2816035507792589,.09501250983763744],I=[.027152459411754096,.062253523938647894,.09515851168249279,.12462897125553388,.14959598881657674,.16915651939500254,.18260341504492358,.1894506104550685];if(r<=0)return 0;if(e<2||o<1||t<2)return NaN;if(!Number.isFinite(r))return 1;if(e>y)return w(r,o,t);var k=e*.5,N=k*f.log(e)-e*f.log(2)-u.gammaln(k),J=k-1,D=e*.25,O;e<=c?O=h:e<=v?O=q:e<=g?O=x:O=R,N+=f.log(O);for(var V=0,L=1;L<=50;L++){for(var P=0,A=(2*L-1)*O,T=1;T<=s;T++){var z,C;l<T?(z=T-l-1,C=N+J*f.log(A+E[z]*O)-(E[z]*O+A)*D):(z=T-1,C=N+J*f.log(A-E[z]*O)+(E[z]*O-A)*D);var B;if(C>=m){l<T?B=r*f.sqrt((E[z]*O+A)*.5):B=r*f.sqrt((-(E[z]*O)+A)*.5);var H=w(B,o,t),Q=H*I[z]*f.exp(C);P+=Q}}if(L*O>=1&&P<=a)break;V+=P}if(P>a)throw new Error("tukey.cdf failed to converge");return V>1&&(V=1),V},inv:function(i,r,n){var e=1,o=r,t=1e-4,s=50;if(n<2||e<1||o<2)return NaN;if(i<0||i>1)return NaN;if(i===0)return 0;if(i===1)return 1/0;var l=d(i,o,n),m=u.tukey.cdf(l,r,n)-i,a;m>0?a=f.max(0,l-1):a=l+1;for(var c=u.tukey.cdf(a,r,n)-i,v,g=1;g<s;g++){v=a-c*(a-l)/(c-m),m=c,l=a,v<0&&(v=0,c=-i),c=u.tukey.cdf(v,r,n)-i,a=v;var y=f.abs(a-l);if(y<t)return v}throw new Error("tukey.inv failed to converge")}})})(b,Math),(function(u,f){var _=Array.prototype.push,p=u.utils.isArray;function w(d){return p(d)||d instanceof u}u.extend({add:function(i,r){return w(r)?(w(r[0])||(r=[r]),u.map(i,function(n,e,o){return n+r[e][o]})):u.map(i,function(n){return n+r})},subtract:function(i,r){return w(r)?(w(r[0])||(r=[r]),u.map(i,function(n,e,o){return n-r[e][o]||0})):u.map(i,function(n){return n-r})},divide:function(i,r){return w(r)?(w(r[0])||(r=[r]),u.multiply(i,u.inv(r))):u.map(i,function(n){return n/r})},multiply:function(i,r){var n,e,o,t,s,l,m,a;if(i.length===void 0&&r.length===void 0)return i*r;if(s=i.length,l=i[0].length,m=u.zeros(s,o=w(r)?r[0].length:l),a=0,w(r)){for(;a<o;a++)for(n=0;n<s;n++){for(t=0,e=0;e<l;e++)t+=i[n][e]*r[e][a];m[n][a]=t}return s===1&&a===1?m[0][0]:m}return u.map(i,function(c){return c*r})},outer:function(i,r){return u.multiply(i.map(function(n){return[n]}),[r])},dot:function(i,r){w(i[0])||(i=[i]),w(r[0])||(r=[r]);for(var n=i[0].length===1&&i.length!==1?u.transpose(i):i,e=r[0].length===1&&r.length!==1?u.transpose(r):r,o=[],t=0,s=n.length,l=n[0].length,m,a;t<s;t++){for(o[t]=[],m=0,a=0;a<l;a++)m+=n[t][a]*e[t][a];o[t]=m}return o.length===1?o[0]:o},pow:function(i,r){return u.map(i,function(n){return f.pow(n,r)})},exp:function(i){return u.map(i,function(r){return f.exp(r)})},log:function(i){return u.map(i,function(r){return f.log(r)})},abs:function(i){return u.map(i,function(r){return f.abs(r)})},norm:function(i,r){var n=0,e=0;for(isNaN(r)&&(r=2),w(i[0])&&(i=i[0]);e<i.length;e++)n+=f.pow(f.abs(i[e]),r);return f.pow(n,1/r)},angle:function(i,r){return f.acos(u.dot(i,r)/(u.norm(i)*u.norm(r)))},aug:function(i,r){var n=[],e;for(e=0;e<i.length;e++)n.push(i[e].slice());for(e=0;e<n.length;e++)_.apply(n[e],r[e]);return n},inv:function(i){for(var r=i.length,n=i[0].length,e=u.identity(r,n),o=u.gauss_jordan(i,e),t=[],s=0,l;s<r;s++)for(t[s]=[],l=n;l<o[0].length;l++)t[s][l-n]=o[s][l];return t},det:function d(i){if(i.length===2)return i[0][0]*i[1][1]-i[0][1]*i[1][0];for(var r=0,n=0;n<i.length;n++){for(var e=[],o=1;o<i.length;o++){e[o-1]=[];for(var t=0;t<i.length;t++)t<n?e[o-1][t]=i[o][t]:t>n&&(e[o-1][t-1]=i[o][t])}var s=n%2?-1:1;r+=d(e)*i[0][n]*s}return r},gauss_elimination:function(i,r){var n=0,e=0,o=i.length,t=i[0].length,s=1,l=0,m=[],a,c,v,g;for(i=u.aug(i,r),a=i[0].length,n=0;n<o;n++){for(c=i[n][n],e=n,g=n+1;g<t;g++)c<f.abs(i[g][n])&&(c=i[g][n],e=g);if(e!=n)for(g=0;g<a;g++)v=i[n][g],i[n][g]=i[e][g],i[e][g]=v;for(e=n+1;e<o;e++)for(s=i[e][n]/i[n][n],g=n;g<a;g++)i[e][g]=i[e][g]-s*i[n][g]}for(n=o-1;n>=0;n--){for(l=0,e=n+1;e<=o-1;e++)l=l+m[e]*i[n][e];m[n]=(i[n][a-1]-l)/i[n][n]}return m},gauss_jordan:function(i,r){var n=u.aug(i,r),e=n.length,o=n[0].length,t=0,s,l,m;for(l=0;l<e;l++){var a=l;for(m=l+1;m<e;m++)f.abs(n[m][l])>f.abs(n[a][l])&&(a=m);var c=n[l];for(n[l]=n[a],n[a]=c,m=l+1;m<e;m++)for(t=n[m][l]/n[l][l],s=l;s<o;s++)n[m][s]-=n[l][s]*t}for(l=e-1;l>=0;l--){for(t=n[l][l],m=0;m<l;m++)for(s=o-1;s>l-1;s--)n[m][s]-=n[l][s]*n[m][l]/t;for(n[l][l]/=t,s=e;s<o;s++)n[l][s]/=t}return n},triaUpSolve:function(i,r){var n=i[0].length,e=u.zeros(1,n)[0],o,t=!1;return r[0].length!=null&&(r=r.map(function(s){return s[0]}),t=!0),u.arange(n-1,-1,-1).forEach(function(s){o=u.arange(s+1,n).map(function(l){return e[l]*i[s][l]}),e[s]=(r[s]-u.sum(o))/i[s][s]}),t?e.map(function(s){return[s]}):e},triaLowSolve:function(i,r){var n=i[0].length,e=u.zeros(1,n)[0],o,t=!1;return r[0].length!=null&&(r=r.map(function(s){return s[0]}),t=!0),u.arange(n).forEach(function(s){o=u.arange(s).map(function(l){return i[s][l]*e[l]}),e[s]=(r[s]-u.sum(o))/i[s][s]}),t?e.map(function(s){return[s]}):e},lu:function(i){var r=i.length,n=u.identity(r),e=u.zeros(i.length,i[0].length),o;return u.arange(r).forEach(function(t){e[0][t]=i[0][t]}),u.arange(1,r).forEach(function(t){u.arange(t).forEach(function(s){o=u.arange(s).map(function(l){return n[t][l]*e[l][s]}),n[t][s]=(i[t][s]-u.sum(o))/e[s][s]}),u.arange(t,r).forEach(function(s){o=u.arange(t).map(function(l){return n[t][l]*e[l][s]}),e[t][s]=i[o.length][s]-u.sum(o)})}),[n,e]},cholesky:function(i){var r=i.length,n=u.zeros(i.length,i[0].length),e;return u.arange(r).forEach(function(o){e=u.arange(o).map(function(t){return f.pow(n[o][t],2)}),n[o][o]=f.sqrt(i[o][o]-u.sum(e)),u.arange(o+1,r).forEach(function(t){e=u.arange(o).map(function(s){return n[o][s]*n[t][s]}),n[t][o]=(i[o][t]-u.sum(e))/n[o][o]})}),n},gauss_jacobi:function(i,r,n,e){for(var o=0,t=0,s=i.length,l=[],m=[],a=[],c,v,g,y;o<s;o++)for(l[o]=[],m[o]=[],a[o]=[],t=0;t<s;t++)o>t?(l[o][t]=i[o][t],m[o][t]=a[o][t]=0):o<t?(m[o][t]=i[o][t],l[o][t]=a[o][t]=0):(a[o][t]=i[o][t],l[o][t]=m[o][t]=0);for(g=u.multiply(u.multiply(u.inv(a),u.add(l,m)),-1),v=u.multiply(u.inv(a),r),c=n,y=u.add(u.multiply(g,n),v),o=2;f.abs(u.norm(u.subtract(y,c)))>e;)c=y,y=u.add(u.multiply(g,c),v),o++;return y},gauss_seidel:function(i,r,n,e){for(var o=0,t=i.length,s=[],l=[],m=[],a,c,v,g,y;o<t;o++)for(s[o]=[],l[o]=[],m[o]=[],a=0;a<t;a++)o>a?(s[o][a]=i[o][a],l[o][a]=m[o][a]=0):o<a?(l[o][a]=i[o][a],s[o][a]=m[o][a]=0):(m[o][a]=i[o][a],s[o][a]=l[o][a]=0);for(g=u.multiply(u.multiply(u.inv(u.add(m,s)),l),-1),v=u.multiply(u.inv(u.add(m,s)),r),c=n,y=u.add(u.multiply(g,n),v),o=2;f.abs(u.norm(u.subtract(y,c)))>e;)c=y,y=u.add(u.multiply(g,c),v),o=o+1;return y},SOR:function(i,r,n,e,o){for(var t=0,s=i.length,l=[],m=[],a=[],c,v,g,y,h;t<s;t++)for(l[t]=[],m[t]=[],a[t]=[],c=0;c<s;c++)t>c?(l[t][c]=i[t][c],m[t][c]=a[t][c]=0):t<c?(m[t][c]=i[t][c],l[t][c]=a[t][c]=0):(a[t][c]=i[t][c],l[t][c]=m[t][c]=0);for(y=u.multiply(u.inv(u.add(a,u.multiply(l,o))),u.subtract(u.multiply(a,1-o),u.multiply(m,o))),g=u.multiply(u.multiply(u.inv(u.add(a,u.multiply(l,o))),r),o),v=n,h=u.add(u.multiply(y,n),g),t=2;f.abs(u.norm(u.subtract(h,v)))>e;)v=h,h=u.add(u.multiply(y,v),g),t++;return h},householder:function(i){for(var r=i.length,n=i[0].length,e=0,o=[],t=[],s,l,m,a,c;e<r-1;e++){for(s=0,a=e+1;a<n;a++)s+=i[a][e]*i[a][e];for(c=i[e+1][e]>0?-1:1,s=c*f.sqrt(s),l=f.sqrt((s*s-i[e+1][e]*s)/2),o=u.zeros(r,1),o[e+1][0]=(i[e+1][e]-s)/(2*l),m=e+2;m<r;m++)o[m][0]=i[m][e]/(2*l);t=u.subtract(u.identity(r,n),u.multiply(u.multiply(o,u.transpose(o)),2)),i=u.multiply(t,u.multiply(i,t))}return i},QR:(function(){var d=u.sum,i=u.arange;function r(n){var e=n.length,o=n[0].length,t=u.zeros(o,o);n=u.copy(n);var s,l,m;for(l=0;l<o;l++){for(t[l][l]=f.sqrt(d(i(e).map(function(a){return n[a][l]*n[a][l]}))),s=0;s<e;s++)n[s][l]=n[s][l]/t[l][l];for(m=l+1;m<o;m++)for(t[l][m]=d(i(e).map(function(a){return n[a][l]*n[a][m]})),s=0;s<e;s++)n[s][m]=n[s][m]-n[s][l]*t[l][m]}return[n,t]}return r})(),lstsq:(function(){function d(r){r=u.copy(r);var n=r.length,e=u.identity(n);return u.arange(n-1,-1,-1).forEach(function(o){u.sliceAssign(e,{row:o},u.divide(u.slice(e,{row:o}),r[o][o])),u.sliceAssign(r,{row:o},u.divide(u.slice(r,{row:o}),r[o][o])),u.arange(o).forEach(function(t){var s=u.multiply(r[t][o],-1),l=u.slice(r,{row:t}),m=u.multiply(u.slice(r,{row:o}),s);u.sliceAssign(r,{row:t},u.add(l,m));var a=u.slice(e,{row:t}),c=u.multiply(u.slice(e,{row:o}),s);u.sliceAssign(e,{row:t},u.add(a,c))})}),e}function i(r,n){var e=!1;n[0].length===void 0&&(n=n.map(function(y){return[y]}),e=!0);var o=u.QR(r),t=o[0],s=o[1],l=r[0].length,m=u.slice(t,{col:{end:l}}),a=u.slice(s,{row:{end:l}}),c=d(a),v=u.transpose(m);v[0].length===void 0&&(v=[v]);var g=u.multiply(u.multiply(c,v),n);return g.length===void 0&&(g=[[g]]),e?g.map(function(y){return y[0]}):g}return i})(),jacobi:function(i){for(var r=1,n=i.length,e=u.identity(n,n),o=[],t,s,l,m,a,c,v,g;r===1;){for(c=i[0][1],m=0,a=1,s=0;s<n;s++)for(l=0;l<n;l++)s!=l&&c<f.abs(i[s][l])&&(c=f.abs(i[s][l]),m=s,a=l);for(i[m][m]===i[a][a]?v=i[m][a]>0?f.PI/4:-f.PI/4:v=f.atan(2*i[m][a]/(i[m][m]-i[a][a]))/2,g=u.identity(n,n),g[m][m]=f.cos(v),g[m][a]=-f.sin(v),g[a][m]=f.sin(v),g[a][a]=f.cos(v),e=u.multiply(e,g),t=u.multiply(u.multiply(u.inv(g),i),g),i=t,r=0,s=1;s<n;s++)for(l=1;l<n;l++)s!=l&&f.abs(i[s][l])>.001&&(r=1)}for(s=0;s<n;s++)o.push(i[s][s]);return[e,o]},rungekutta:function(i,r,n,e,o,t){var s,l,m,a,c;if(t===2)for(;e<=n;)s=r*i(e,o),l=r*i(e+r,o+s),m=o+(s+l)/2,o=m,e=e+r;if(t===4)for(;e<=n;)s=r*i(e,o),l=r*i(e+r/2,o+s/2),a=r*i(e+r/2,o+l/2),c=r*i(e+r,o+a),m=o+(s+2*l+2*a+c)/6,o=m,e=e+r;return o},romberg:function(i,r,n,e){for(var o=0,t=(n-r)/2,s=[],l=[],m=[],a,c,v,g,y;o<e/2;){for(y=i(r),v=r,g=0;v<=n;v=v+t,g++)s[g]=v;for(a=s.length,v=1;v<a-1;v++)y+=(v%2!==0?4:2)*i(s[v]);y=t/3*(y+i(n)),m[o]=y,t/=2,o++}for(c=m.length,a=1;c!==1;){for(v=0;v<c-1;v++)l[v]=(f.pow(4,a)*m[v+1]-m[v])/(f.pow(4,a)-1);c=l.length,m=l,l=[],a++}return m},richardson:function(i,r,n,e){function o(h,q){for(var x=0,R=h.length,E;x<R;x++)h[x]===q&&(E=x);return E}for(var t=f.abs(n-i[o(i,n)+1]),s=0,l=[],m=[],a,c,v,g,y;e>=t;)a=o(i,n+e),c=o(i,n),l[s]=(r[a]-2*r[c]+r[2*c-a])/(e*e),e/=2,s++;for(g=l.length,v=1;g!=1;){for(y=0;y<g-1;y++)m[y]=(f.pow(4,v)*l[y+1]-l[y])/(f.pow(4,v)-1);g=m.length,l=m,m=[],v++}return l},simpson:function(i,r,n,e){for(var o=(n-r)/e,t=i(r),s=[],l=r,m=0,a=1,c;l<=n;l=l+o,m++)s[m]=l;for(c=s.length;a<c-1;a++)t+=(a%2!==0?4:2)*i(s[a]);return o/3*(t+i(n))},hermite:function(i,r,n,e){for(var o=i.length,t=0,s=0,l=[],m=[],a=[],c=[],v;s<o;s++){for(l[s]=1,v=0;v<o;v++)s!=v&&(l[s]*=(e-i[v])/(i[s]-i[v]));for(m[s]=0,v=0;v<o;v++)s!=v&&(m[s]+=1/(i[s]-i[v]));a[s]=(1-2*(e-i[s])*m[s])*(l[s]*l[s]),c[s]=(e-i[s])*(l[s]*l[s]),t+=a[s]*r[s]+c[s]*n[s]}return t},lagrange:function(i,r,n){for(var e=0,o=0,t,s,l=i.length;o<l;o++){for(s=r[o],t=0;t<l;t++)o!=t&&(s*=(n-i[t])/(i[o]-i[t]));e+=s}return e},cubic_spline:function(i,r,n){for(var e=i.length,o=0,t,s=[],l=[],m=[],a=[],c=[],v=[],g=[];o<e-1;o++)c[o]=i[o+1]-i[o];for(m[0]=0,o=1;o<e-1;o++)m[o]=3/c[o]*(r[o+1]-r[o])-3/c[o-1]*(r[o]-r[o-1]);for(o=1;o<e-1;o++)s[o]=[],l[o]=[],s[o][o-1]=c[o-1],s[o][o]=2*(c[o-1]+c[o]),s[o][o+1]=c[o],l[o][0]=m[o];for(a=u.multiply(u.inv(s),l),t=0;t<e-1;t++)v[t]=(r[t+1]-r[t])/c[t]-c[t]*(a[t+1][0]+2*a[t][0])/3,g[t]=(a[t+1][0]-a[t][0])/(3*c[t]);for(t=0;t<e&&!(i[t]>n);t++);return t-=1,r[t]+(n-i[t])*v[t]+u.sq(n-i[t])*a[t]+(n-i[t])*u.sq(n-i[t])*g[t]},gauss_quadrature:function(){throw new Error("gauss_quadrature not yet implemented")},PCA:function(i){var r=i.length,n=i[0].length,e=0,o,t,s=[],l=[],m=[],a=[],c=[],v=[],g=[],y=[],h=[],q=[];for(e=0;e<r;e++)s[e]=u.sum(i[e])/n;for(e=0;e<n;e++)for(g[e]=[],o=0;o<r;o++)g[e][o]=i[o][e]-s[o];for(g=u.transpose(g),e=0;e<r;e++)for(y[e]=[],o=0;o<r;o++)y[e][o]=u.dot([g[e]],[g[o]])/(n-1);for(m=u.jacobi(y),h=m[0],l=m[1],q=u.transpose(h),e=0;e<l.length;e++)for(o=e;o<l.length;o++)l[e]<l[o]&&(t=l[e],l[e]=l[o],l[o]=t,a=q[e],q[e]=q[o],q[o]=a);for(v=u.transpose(g),e=0;e<r;e++)for(c[e]=[],o=0;o<v.length;o++)c[e][o]=u.dot([q[e]],[v[o]]);return[i,l,q,c]}}),(function(d){for(var i=0;i<d.length;i++)(function(r){u.fn[r]=function(n,e){var o=this;return e?(setTimeout(function(){e.call(o,u.fn[r].call(o,n))},15),this):typeof u[r](this,n)=="number"?u[r](this,n):u(u[r](this,n))}})(d[i])})("add divide multiply subtract dot pow exp log abs norm angle".split(" "))})(b,Math),(function(u,f){var _=[].slice,p=u.utils.isNumber,w=u.utils.isArray;u.extend({zscore:function(){var r=_.call(arguments);return p(r[1])?(r[0]-r[1])/r[2]:(r[0]-u.mean(r[1]))/u.stdev(r[1],r[2])},ztest:function(){var r=_.call(arguments),n;return w(r[1])?(n=u.zscore(r[0],r[1],r[3]),r[2]===1?u.normal.cdf(-f.abs(n),0,1):u.normal.cdf(-f.abs(n),0,1)*2):r.length>2?(n=u.zscore(r[0],r[1],r[2]),r[3]===1?u.normal.cdf(-f.abs(n),0,1):u.normal.cdf(-f.abs(n),0,1)*2):(n=r[0],r[1]===1?u.normal.cdf(-f.abs(n),0,1):u.normal.cdf(-f.abs(n),0,1)*2)}}),u.extend(u.fn,{zscore:function(r,n){return(r-this.mean())/this.stdev(n)},ztest:function(r,n,e){var o=f.abs(this.zscore(r,e));return n===1?u.normal.cdf(-o,0,1):u.normal.cdf(-o,0,1)*2}}),u.extend({tscore:function(){var r=_.call(arguments);return r.length===4?(r[0]-r[1])/(r[2]/f.sqrt(r[3])):(r[0]-u.mean(r[1]))/(u.stdev(r[1],!0)/f.sqrt(r[1].length))},ttest:function(){var r=_.call(arguments),n;return r.length===5?(n=f.abs(u.tscore(r[0],r[1],r[2],r[3])),r[4]===1?u.studentt.cdf(-n,r[3]-1):u.studentt.cdf(-n,r[3]-1)*2):p(r[1])?(n=f.abs(r[0]),r[2]==1?u.studentt.cdf(-n,r[1]-1):u.studentt.cdf(-n,r[1]-1)*2):(n=f.abs(u.tscore(r[0],r[1])),r[2]==1?u.studentt.cdf(-n,r[1].length-1):u.studentt.cdf(-n,r[1].length-1)*2)}}),u.extend(u.fn,{tscore:function(r){return(r-this.mean())/(this.stdev(!0)/f.sqrt(this.cols()))},ttest:function(r,n){return n===1?1-u.studentt.cdf(f.abs(this.tscore(r)),this.cols()-1):u.studentt.cdf(-f.abs(this.tscore(r)),this.cols()-1)*2}}),u.extend({anovafscore:function(){var r=_.call(arguments),n,e,o,t,s,l,m,a;if(r.length===1){for(s=new Array(r[0].length),m=0;m<r[0].length;m++)s[m]=r[0][m];r=s}for(e=new Array,m=0;m<r.length;m++)e=e.concat(r[m]);for(o=u.mean(e),n=0,m=0;m<r.length;m++)n=n+r[m].length*f.pow(u.mean(r[m])-o,2);for(n/=r.length-1,l=0,m=0;m<r.length;m++)for(t=u.mean(r[m]),a=0;a<r[m].length;a++)l+=f.pow(r[m][a]-t,2);return l/=e.length-r.length,n/l},anovaftest:function(){var r=_.call(arguments),n,e,o,t;if(p(r[0]))return 1-u.centralF.cdf(r[0],r[1],r[2]);var s=u.anovafscore(r);for(n=r.length-1,o=0,t=0;t<r.length;t++)o=o+r[t].length;return e=o-n-1,1-u.centralF.cdf(s,n,e)},ftest:function(r,n,e){return 1-u.centralF.cdf(r,n,e)}}),u.extend(u.fn,{anovafscore:function(){return u.anovafscore(this.toArray())},anovaftes:function(){var r=0,n;for(n=0;n<this.length;n++)r=r+this[n].length;return u.ftest(this.anovafscore(),this.length-1,r-this.length)}}),u.extend({qscore:function(){var r=_.call(arguments),n,e,o,t,s;return p(r[0])?(n=r[0],e=r[1],o=r[2],t=r[3],s=r[4]):(n=u.mean(r[0]),e=u.mean(r[1]),o=r[0].length,t=r[1].length,s=r[2]),f.abs(n-e)/(s*f.sqrt((1/o+1/t)/2))},qtest:function(){var r=_.call(arguments),n;r.length===3?(n=r[0],r=r.slice(1)):r.length===7?(n=u.qscore(r[0],r[1],r[2],r[3],r[4]),r=r.slice(5)):(n=u.qscore(r[0],r[1],r[2]),r=r.slice(3));var e=r[0],o=r[1];return 1-u.tukey.cdf(n,o,e-o)},tukeyhsd:function(r){for(var n=u.pooledstdev(r),e=r.map(function(a){return u.mean(a)}),o=r.reduce(function(a,c){return a+c.length},0),t=[],s=0;s<r.length;++s)for(var l=s+1;l<r.length;++l){var m=u.qtest(e[s],e[l],r[s].length,r[l].length,n,o,r.length);t.push([[s,l],m])}return t}}),u.extend({normalci:function(){var r=_.call(arguments),n=new Array(2),e;return r.length===4?e=f.abs(u.normal.inv(r[1]/2,0,1)*r[2]/f.sqrt(r[3])):e=f.abs(u.normal.inv(r[1]/2,0,1)*u.stdev(r[2])/f.sqrt(r[2].length)),n[0]=r[0]-e,n[1]=r[0]+e,n},tci:function(){var r=_.call(arguments),n=new Array(2),e;return r.length===4?e=f.abs(u.studentt.inv(r[1]/2,r[3]-1)*r[2]/f.sqrt(r[3])):e=f.abs(u.studentt.inv(r[1]/2,r[2].length-1)*u.stdev(r[2],!0)/f.sqrt(r[2].length)),n[0]=r[0]-e,n[1]=r[0]+e,n},significant:function(r,n){return r<n}}),u.extend(u.fn,{normalci:function(r,n){return u.normalci(r,n,this.toArray())},tci:function(r,n){return u.tci(r,n,this.toArray())}});function d(i,r,n,e){if(i>1||n>1||i<=0||n<=0)throw new Error("Proportions should be greater than 0 and less than 1");var o=(i*r+n*e)/(r+e),t=f.sqrt(o*(1-o)*(1/r+1/e));return(i-n)/t}u.extend(u.fn,{oneSidedDifferenceOfProportions:function(r,n,e,o){var t=d(r,n,e,o);return u.ztest(t,1)},twoSidedDifferenceOfProportions:function(r,n,e,o){var t=d(r,n,e,o);return u.ztest(t,2)}})})(b,Math),b.models=(function(){function u(d){var i=d[0].length,r=b.arange(i).map(function(n){var e=b.arange(i).filter(function(o){return o!==n});return f(b.col(d,n).map(function(o){return o[0]}),b.col(d,e))});return r}function f(d,i){var r=d.length,n=i[0].length-1,e=r-n-1,o=b.lstsq(i,d),t=b.multiply(i,o.map(function(g){return[g]})).map(function(g){return g[0]}),s=b.subtract(d,t),l=b.mean(d),m=b.sum(t.map(function(g){return Math.pow(g-l,2)})),a=b.sum(d.map(function(g,y){return Math.pow(g-t[y],2)})),c=m+a,v=m/c;return{exog:i,endog:d,nobs:r,df_model:n,df_resid:e,coef:o,predict:t,resid:s,ybar:l,SST:c,SSE:m,SSR:a,R2:v}}function _(d){var i=u(d.exog),r=Math.sqrt(d.SSR/d.df_resid),n=i.map(function(l){var m=l.SST,a=l.R2;return r/Math.sqrt(m*(1-a))}),e=d.coef.map(function(l,m){return(l-0)/n[m]}),o=e.map(function(l){var m=b.studentt.cdf(l,d.df_resid);return(m>.5?1-m:m)*2}),t=b.studentt.inv(.975,d.df_resid),s=d.coef.map(function(l,m){var a=t*n[m];return[l-a,l+a]});return{se:n,t:e,p:o,sigmaHat:r,interval95:s}}function p(d){var i=d.R2/d.df_model/((1-d.R2)/d.df_resid),r=function(e,o,t){return b.beta.cdf(e/(t/o+e),o/2,t/2)},n=1-r(i,d.df_model,d.df_resid);return{F_statistic:i,pvalue:n}}function w(d,i){var r=f(d,i),n=_(r),e=p(r),o=1-(1-r.R2)*((r.nobs-1)/r.df_resid);return r.t=n,r.f=e,r.adjust_R2=o,r}return{ols:w}})(),b.extend({buildxmatrix:function(){for(var f=new Array(arguments.length),_=0;_<arguments.length;_++){var p=[1];f[_]=p.concat(arguments[_])}return b(f)},builddxmatrix:function(){for(var f=new Array(arguments[0].length),_=0;_<arguments[0].length;_++){var p=[1];f[_]=p.concat(arguments[0][_])}return b(f)},buildjxmatrix:function(f){for(var _=new Array(f.length),p=0;p<f.length;p++)_[p]=f[p];return b.builddxmatrix(_)},buildymatrix:function(f){return b(f).transpose()},buildjymatrix:function(f){return f.transpose()},matrixmult:function(f,_){var p,w,d,i,r;if(f.cols()==_.rows()){if(_.rows()>1){for(i=[],p=0;p<f.rows();p++)for(i[p]=[],w=0;w<_.cols();w++){for(r=0,d=0;d<f.cols();d++)r+=f.toArray()[p][d]*_.toArray()[d][w];i[p][w]=r}return b(i)}for(i=[],p=0;p<f.rows();p++)for(i[p]=[],w=0;w<_.cols();w++){for(r=0,d=0;d<f.cols();d++)r+=f.toArray()[p][d]*_.toArray()[w];i[p][w]=r}return b(i)}},regress:function(f,_){var p=b.xtranspxinv(f),w=f.transpose(),d=b.matrixmult(b(p),w);return b.matrixmult(d,_)},regresst:function(f,_,p){var w=b.regress(f,_),d={};d.anova={};var i=b.jMatYBar(f,w);d.yBar=i;var r=_.mean();d.anova.residuals=b.residuals(_,i),d.anova.ssr=b.ssr(i,r),d.anova.msr=d.anova.ssr/(f[0].length-1),d.anova.sse=b.sse(_,i),d.anova.mse=d.anova.sse/(_.length-(f[0].length-1)-1),d.anova.sst=b.sst(_,r),d.anova.mst=d.anova.sst/(_.length-1),d.anova.r2=1-d.anova.sse/d.anova.sst,d.anova.r2<0&&(d.anova.r2=0),d.anova.fratio=d.anova.msr/d.anova.mse,d.anova.pvalue=b.anovaftest(d.anova.fratio,f[0].length-1,_.length-(f[0].length-1)-1),d.anova.rmse=Math.sqrt(d.anova.mse),d.anova.r2adj=1-d.anova.mse/d.anova.mst,d.anova.r2adj<0&&(d.anova.r2adj=0),d.stats=new Array(f[0].length);for(var n=b.xtranspxinv(f),e,o,t,s=0;s<w.length;s++)e=Math.sqrt(d.anova.mse*Math.abs(n[s][s])),o=Math.abs(w[s]/e),t=b.ttest(o,_.length-f[0].length-1,p),d.stats[s]=[w[s],e,o,t];return d.regress=w,d},xtranspx:function(f){return b.matrixmult(f.transpose(),f)},xtranspxinv:function(f){var _=b.matrixmult(f.transpose(),f),p=b.inv(_);return p},jMatYBar:function(f,_){var p=b.matrixmult(f,_);return new b(p)},residuals:function(f,_){return b.matrixsubtract(f,_)},ssr:function(f,_){for(var p=0,w=0;w<f.length;w++)p+=Math.pow(f[w]-_,2);return p},sse:function(f,_){for(var p=0,w=0;w<f.length;w++)p+=Math.pow(f[w]-_[w],2);return p},sst:function(f,_){for(var p=0,w=0;w<f.length;w++)p+=Math.pow(f[w]-_,2);return p},matrixsubtract:function(f,_){for(var p=new Array(f.length),w=0;w<f.length;w++){p[w]=new Array(f[w].length);for(var d=0;d<f[w].length;d++)p[w][d]=f[w][d]-_[w][d]}return b(p)}}),b.jStat=b,b})})(U)),U.exports}var Z=ur();const X=5,fr=M({__name:"ChartLJ",props:{title:{type:String,required:!0},series:{type:Array,required:!0}},setup(G,{expose:W}){W();const b=S(`lj-chart-${Math.random().toString(36).substr(2,9)}`),u=j(()=>!G.series||G.series.length<X),f={ERROR:"#dc2626",WARNING:"#f59e0b",GOOD:"#22c55e",MEAN_LINE:"#3b82f6"},_={"1_3s":"1-3s: One control result outside 3SD","1_2s":"1-2s: One control result outside 2SD (Warning)","2_2s":"2-2s: Two consecutive controls outside 2SD",R_4s:"R-4s: Difference between consecutive runs 4SD","4_1s":"4-1s: Four consecutive controls outside 1SD on same side","10_x":"10-x: Ten consecutive controls on same side of mean"};function p(i,r){let n=[];i?.forEach(a=>{typeof a[r]=="number"&&n.push(a[r])});const e=n.length,o=Z.jStat.mean(n),t=Z.jStat.stdev(n),s=[-4,-3,-2,-1,0,1,2,3,4].map(a=>Math.round((o+a*t)*100)/100),l={mean:o,sd1:{upper:o+t,lower:o-t},sd2:{upper:o+2*t,lower:o-2*t},sd3:{upper:o+3*t,lower:o-3*t}};return{rules:i.map(a=>{const c=Z.jStat.abs([a[r]])[0],v={...a,color:f.GOOD,rule:null,description:"",deviation:Math.round((c-o)/t*100)/100};if(Math.abs(a[r]-o)>3*t)return v.color=f.ERROR,v.rule="1_3s",v.description=_["1_3s"],v;if(Math.abs(a[r]-o)>2*t)return v.color=f.WARNING,v.rule="1_2s",v.description=_["1_2s"],v;if(i.indexOf(a)>0){const g=i[i.indexOf(a)-1][r];if(Math.abs(a[r]-g)>=4*t)return v.color=f.ERROR,v.rule="R_4s",v.description=_.R_4s,v}if(i.indexOf(a)>=3){const g=i.slice(i.indexOf(a)-3,i.indexOf(a)).map(R=>R[r]),y=a[r],h=[y,...g].every(R=>R>o),q=[y,...g].every(R=>R<o),x=[y,...g].every(R=>Math.abs(R-o)>t);if((h||q)&&x)return v.color=f.ERROR,v.rule="4_1s",v.description=_["4_1s"],v}if(i.indexOf(a)>=9){const g=i.slice(i.indexOf(a)-9,i.indexOf(a)+1).map(q=>q[r]),y=g.every(q=>q>o),h=g.every(q=>q<o);(y||h)&&(v.color=f.ERROR,v.rule="10_x",v.description=_["10_x"])}return v}),stats:{n:e,mu:o,sd:t,x_sds:s,controlLimits:l}}}const w=()=>{const i=document.getElementById(b.value);if(!i)return;i.innerHTML="";const r=new or({container:b.value,autoFit:!0,height:400,padding:[30,40,120,60]}),n=p(G.series,"value");r.data(n.rules),r.scale({date:{range:[0,1],tickCount:Math.min(10,G.series.length)},value:{ticks:n.stats.x_sds,nice:!0,alias:"Standard Deviations"}}),r.tooltip({showTitle:!0,showCrosshairs:!0,customItems:e=>{const o=e[0];return[{...o,name:"Date",value:o.data.date,data:o.data,mappingData:o.mappingData,color:o.color,marker:o.marker},{...o,name:"Value",value:o.data.value.toFixed(2),data:o.data,mappingData:o.mappingData,color:o.color,marker:o.marker},{...o,name:"Deviation",value:`${o.data.deviation}`,data:o.data,mappingData:o.mappingData,color:o.color,marker:o.marker},{...o,name:"Rule Violation",value:o.data.description||"None",data:o.data,mappingData:o.mappingData,color:o.color,marker:o.marker}]}}),r.annotation().line({start:["min",n.stats.mu],end:["max",n.stats.mu],style:{stroke:f.MEAN_LINE,lineDash:[4,4]}}),[-3,-2,-1,1,2,3].forEach(e=>{const o=n.stats.mu+e*n.stats.sd;r.annotation().line({start:["min",o],end:["max",o],style:{stroke:e===3||e===-3?f.ERROR:e===2||e===-2?f.WARNING:"#ddd",lineDash:[2,2],opacity:.5},text:{content:`${e}`,position:"end",autoRotate:!0,style:{fill:e===3||e===-3?f.ERROR:e===2||e===-2?f.WARNING:"#666"}}})}),r.line().position("date*value").tooltip("date*value*deviation*description").style({stroke:"#666",lineWidth:1}),r.point().position("date*value").color("color").shape("circle").style({stroke:"#fff",lineWidth:1}).size(6),r.axis("date",{label:{autoRotate:!0,rotate:45,offset:20,style:{textAlign:"left",textBaseline:"middle"}},tickLine:{alignTick:!0}}),r.legend({position:"bottom",flipPage:!1,itemMarginBottom:8}),r.render()};rr(()=>{u.value||w()});const d={SERIES_LIMIT:X,chartId:b,cannotPlot:u,COLORS:f,RULE_DESCRIPTIONS:_,westGardRule:p,plotLevyJennings:w};return Object.defineProperty(d,"__isScriptSetup",{enumerable:!1,value:!0}),d}}),tr={class:"w-full bg-card rounded-lg border border-border p-4",role:"region","aria-label":"Levy-Jennings chart"},sr={key:0,class:"text-center py-8 text-muted-foreground"},lr=["id"];function cr(G,W,b,u,f,_){return $(),F("div",tr,[u.cannotPlot?($(),F("div",sr,[W[0]||(W[0]=K("p",null,"Insufficient data points for Levy-Jennings chart.",-1)),K("p",{class:"text-sm"},"Minimum "+er(u.SERIES_LIMIT)+" points required.")])):($(),F("div",{key:1,id:u.chartId,class:"w-full h-[400px]",role:"img","aria-label":"Quality control chart"},null,8,lr))])}const br=nr(fr,[["render",cr],["__file","/home/aurthurm/Documents/Development/felicity/felicity-lims/webapp/components/analysis/quality/ChartLJ.vue"]]);export{br as default};
