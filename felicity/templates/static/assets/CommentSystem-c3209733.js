import{P as R,e as $,Z as w,o as i,c as l,A as j,V as L,b as n,a1 as m,J as h,L as q,E as b,_ as D,aa as M,h as p,a2 as P,at as Q,a as k,F as T,D as J}from"./index-66877f9a.js";import{q as W,r as Z,s as K,t as X}from"./grind.queries-5bd837c7.js";const Y={class:"mb-4"},_=["rows","placeholder"],ee={class:"flex items-center justify-end mt-2 gap-2"},te={key:0,class:"flex items-center gap-2 font-sm"},ne=R({__name:"CommentForm",props:{errandUid:{type:String,required:!0},parentDiscussion:{type:Object,default:void 0},isReply:{type:Boolean,default:!1}},emits:["commentAdded","cancelReply"],setup(e,{emit:y}){const t=e,o=y,{withClientMutation:u}=$(),s=w("");function r(){s.value.trim()&&u(W,{payload:{comment:s.value,errandUid:t.errandUid,parentUid:t.parentDiscussion?.uid}},"createGrindErrandDiscussion").then(()=>{s.value="",o("commentAdded")})}function d(){o("cancelReply")}return(v,a)=>(i(),l("div",Y,[j(n("textarea",{"onUpdate:modelValue":a[0]||(a[0]=x=>s.value=x),rows:e.isReply?2:3,class:m(`w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-sky-500 focus:border-sky-500 ${e.isReply?"text-sm":""}`),placeholder:e.isReply?"Write a reply...":"Add a comment..."},null,10,_),[[L,s.value]]),n("div",ee,[e.isReply?(i(),l("button",{key:0,onClick:d,class:"px-2 py-1 border border-gray-300 rounded hover:bg-gray-50 text-sm"}," Cancel ")):h("",!0),n("button",{onClick:r,class:m(`px-3 py-1.5 bg-blue-500 text-white rounded hover:bg-blue-600 flex items-center gap-2 ${e.isReply?"text-sm px-2 py-1":""}`)},[e.isReply?h("",!0):(i(),l("div",te,a[1]||(a[1]=[n("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-5 w-5",viewBox:"0 0 20 20",fill:"currentColor"},[n("path",{"fill-rule":"evenodd",d:"M7.707 3.293a1 1 0 010 1.414L5.414 7H11a7 7 0 017 7v2a1 1 0 11-2 0v-2a5 5 0 00-5-5H5.414l2.293 2.293a1 1 0 11-1.414 1.414l-4-4a1 1 0 010-1.414l4-4a1 1 0 011.414 0z","clip-rule":"evenodd"})],-1)]))),q(" "+b(e.isReply?"Reply":"Comment"),1)],2)])]))}}),N=D(ne,[["__file","/home/aurthurm/Documents/Development/felicity/felicity-lims/webapp/components/grind/CommentForm.vue"]]),oe={class:"flex items-start gap-4"},ie={class:"flex-1"},le={class:"flex justify-between"},me={key:0,class:"flex gap-2"},se=["rows"],de={class:"flex items-center justify-end gap-2 mt-2"},ae=["innerHTML"],re=R({__name:"CommentItem",props:{comment:{type:Object,required:!0},replyingTo:{type:Object,default:null},editingComment:{type:Object,default:null},level:{type:Number,default:0}},emits:["setReplyingTo","setEditingComment","commentAdded","commentUpdated"],setup(e,{emit:y}){const t=e;M(()=>{d(t.comment.uid)});const o=y,{withClientMutation:u,withClientQuery:s}=$(),r=w([]);function d(C,g="cache-first"){s(Z,{parentUid:C},"grindErrandDiscussionsByParent",g).then(U=>{U&&(r.value=U)})}const v=p(()=>t.editingComment&&t.editingComment.uid===t.comment.uid),a=p(()=>t.replyingTo&&t.replyingTo.uid===t.comment.uid),x=p(()=>t.level<2),E=p(()=>{switch(t.level){case 0:return"h-10 w-10";case 1:return"h-8 w-8";case 2:return"h-6 w-6";default:return"h-10 w-10"}}),c=p(()=>{switch(t.level){case 0:return"bg-orange-100 text-orange-600";case 1:return"bg-blue-100 text-blue-600";case 2:return"bg-green-100 text-green-600";default:return"bg-orange-100 text-orange-600"}}),f=p(()=>{switch(t.level){case 0:return"";case 1:return"text-sm";case 2:return"text-xs";default:return""}}),A=p(()=>{switch(t.level){case 0:return"h-5 w-5";case 1:return"h-4 w-4";case 2:return"h-3.5 w-3.5";default:return"h-5 w-5"}});function S(){a.value?o("setReplyingTo",null):o("setReplyingTo",t.comment)}function V(){o("setEditingComment",{...t.comment})}function z(){o("setEditingComment",null)}function H(){t.editingComment&&u(K,{uid:t.comment.uid,payload:{comment:t.editingComment.comment,errandUid:t.editingComment.errandUid}},"updateGrindErrandDiscussion").then(()=>{o("commentUpdated")})}function B(){o("commentAdded"),d(t.comment.uid,"network-only")}function I(){o("commentUpdated"),d(t.comment.uid,"network-only")}function O(C){o("setReplyingTo",C)}function F(C){o("setEditingComment",C)}return(C,g)=>(i(),l(T,null,[n("div",oe,[n("div",{class:m(`${E.value} shrink-0 rounded-full ${c.value} flex items-center justify-center font-semibold ${f.value}`)},b(P(Q)(e.comment.createdBy?.firstName,e.comment.createdBy?.lastName)),3),n("div",ie,[n("div",le,[n("div",null,[n("h3",{class:m(`font-medium ${f.value}`)},b(e.comment.createdBy?.firstName)+" "+b(e.comment.createdBy?.lastName),3),n("div",{class:m(`${e.level>0?"text-xs":"text-sm"} text-gray-500`)},b(e.comment.createdAt),3)]),v.value?h("",!0):(i(),l("div",me,[e.comment.canEdit?(i(),l("button",{key:0,onClick:V,class:"text-gray-500 hover:text-blue-500"},[(i(),l("svg",{xmlns:"http://www.w3.org/2000/svg",class:m(A.value),fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},g[1]||(g[1]=[n("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2v-5m-1.414-9.414a2 2 0 112.828 2.828L11.828 15H9v-2.828l8.586-8.586z"},null,-1)]),2))])):h("",!0),x.value?(i(),l("button",{key:1,onClick:S,class:"text-gray-500 hover:text-blue-500"},[(i(),l("svg",{xmlns:"http://www.w3.org/2000/svg",class:m(A.value),fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},g[2]||(g[2]=[n("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M3 10h10a8 8 0 018 8v2M3 10l6 6m-6-6l6-6"},null,-1)]),2))])):h("",!0)]))]),v.value?(i(),l("div",{key:0,class:m(`mt-${e.level===0||e.level===1?2:1}`)},[j(n("textarea",{"onUpdate:modelValue":g[0]||(g[0]=U=>e.editingComment.comment=U),rows:e.level===0?3:2,class:m(`w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-sky-500 focus:border-sky-500 ${e.level===2?"text-xs":""}`)},null,10,se),[[L,e.editingComment.comment]]),n("div",de,[n("button",{onClick:z,class:m(`px-${e.level<2?3:2} py-${e.level<2?"1.5":1} border border-gray-300 rounded hover:bg-gray-50 ${e.level>0?"text-sm":""}`)}," Cancel ",2),n("button",{onClick:H,class:m(`px-${e.level<2?3:2} py-${e.level<2?"1.5":1} bg-blue-500 text-white rounded hover:bg-blue-600 ${e.level>0?"text-sm":""}`)}," Save ",2)])],2)):(i(),l("div",{key:1,class:m(`mt-${e.level===0?2:1} text-gray-600 ${f.value}`),innerHTML:e.comment.comment},null,10,ae)),a.value?(i(),l("div",{key:2,class:m(`mt-${e.level===0?3:2}`)},[k(N,{"parent-discussion":e.comment,"is-reply":!0,errandUid:e.comment.errandUid,onCommentAdded:B,onCancelReply:S},null,8,["parent-discussion","errandUid"])],2)):h("",!0)])]),r.value.length>0?(i(),l("div",{key:0,class:m(`ml-${e.level===0?14:12} mt-4`)},[k(G,{comments:r.value,"replying-to":e.replyingTo,"editing-comment":e.editingComment,level:e.level+1,onSetReplyingTo:O,onSetEditingComment:F,onCommentAdded:B,onCommentUpdated:I},null,8,["comments","replying-to","editing-comment","level"])],2)):h("",!0)],64))}});const ce=D(re,[["__scopeId","data-v-31ab5fff"],["__file","/home/aurthurm/Documents/Development/felicity/felicity-lims/webapp/components/grind/CommentItem.vue"]]),ue=R({__name:"CommentList",props:{comments:{type:Array,required:!0},replyingTo:{type:Object,default:null},editingComment:{type:Object,default:null},level:{type:Number,default:0}},emits:["setReplyingTo","setEditingComment","commentAdded","commentUpdated"],setup(e,{emit:y}){const t=y;function o(d){t("setReplyingTo",d)}function u(d){t("setEditingComment",d)}function s(){t("commentAdded")}function r(){t("commentUpdated")}return(d,v)=>(i(),l("div",{class:m(`space-y-${e.level===0?"6":"4"}`)},[(i(!0),l(T,null,J(e.comments,a=>(i(),l("div",{key:a.uid,class:m(e.level===0?"border-b border-gray-200 pb-4":"")},[k(ce,{comment:a,"replying-to":e.replyingTo,"editing-comment":e.editingComment,level:e.level,onSetReplyingTo:o,onSetEditingComment:u,onCommentAdded:s,onCommentUpdated:r},null,8,["comment","replying-to","editing-comment","level"])],2))),128))],2))}}),G=D(ue,[["__file","/home/aurthurm/Documents/Development/felicity/felicity-lims/webapp/components/grind/CommentList.vue"]]),ge=R({__name:"CommentSystem",props:["errandUid"],setup(e){const y=e,{withClientQuery:t}=$(),o=w([]),u=w(null),s=w(null);M(()=>{r()});function r(c="cache-first"){t(X,{errandUid:y.errandUid},"grindErrandDiscussions",c).then(f=>{f&&(o.value=f)})}function d(){return o.value.filter(c=>!c.parentUid)}function v(){r("network-only"),u.value=null}function a(){r("network-only"),s.value=null}function x(c){u.value=c}function E(c){s.value=c}return(c,f)=>(i(),l(T,null,[k(N,{"errand-uid":e.errandUid,onCommentAdded:v},null,8,["errand-uid"]),k(G,{comments:d(),"replying-to":u.value,"editing-comment":s.value,"errand-uid":e.errandUid,onSetReplyingTo:x,onSetEditingComment:E,onCommentAdded:v,onCommentUpdated:a},null,8,["comments","replying-to","editing-comment","errand-uid"])],64))}}),fe=D(ge,[["__file","/home/aurthurm/Documents/Development/felicity/felicity-lims/webapp/components/grind/CommentSystem.vue"]]);export{fe as default};
