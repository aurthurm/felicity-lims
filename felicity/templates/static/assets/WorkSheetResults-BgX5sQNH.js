const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/index-C5OmCQ1r.js","assets/index-DNLAO2yS.css","assets/FelSelect-hunCqllM.js","assets/FelSwitch-B2eZu7rS.js"])))=>i.map(i=>d[i]);
import{a0 as de,S as ue,ac as ce,a4 as me,a7 as i,h as pe,g as fe,a1 as B,a6 as F,aw as ge,_ as he,c as k,o as x,A as a,F as u,H as w,a as l,N as f,P as g,a3 as $,J as ve,K as be,Q as ee,L as _,a2 as ye}from"./index-C5OmCQ1r.js";import{u as ke}from"./worksheet-J2RPc7FT.js";import{u as xe}from"./analysis-DmproWS6.js";import{u as we}from"./user-QlIHobL1.js";import{u as _e}from"./setup-BMS7aX7t.js";import{s as Re}from"./index-K3ETbf84.js";import"./analyses.mutations-COGCX6rV.js";const Se=de({__name:"WorkSheetResults",setup(c,{expose:s}){s();const N=B(()=>F(()=>import("./index-C5OmCQ1r.js").then(e=>e.df),__vite__mapDeps([0,1]))),t=B(()=>F(()=>import("./FelSelect-hunCqllM.js"),__vite__mapDeps([2,0,1]))),L=B(()=>F(()=>import("./FelSwitch-B2eZu7rS.js"),__vite__mapDeps([3,0,1]))),h=ue(),o=_e(),m=we(),E=ce(),T=me();let R=i(!1),S=i(!1),C=i(!1),U=i(!1),A=i(!1),V=i(!1),v=i(!1),j=i(!1),d=pe(()=>h.getWorkSheet);const W=()=>{h.fetchWorksheetByUid(E.params.workSheetUid)};m.fetchUsers({}),o.fetchLaboratoryInstruments(),o.fetchMethods();const P=fe({analystUid:null,instrumentUid:null,methodUid:null}),D=i(!1),te=()=>{D.value=!0,h.updateWorksheet({worksheetUid:E.params.workSheetUid,...P}).then(()=>{D.value=!1,W()})};function z(){return d.value?.analysisResults?.every(e=>e.checked===!0)}function b(){let e=[];return d.value?.analysisResults?.forEach(n=>{n.checked&&e.push(n)}),e}function se(){z()?v.value=!0:v.value=!1,p()}function M(e){if(O(e)){I(e);return}e.checked=!0,p()}function O(e){return["retracted","approved"].includes(e.status)}function I(e){e.checked=!1,p()}function oe(){d?.value?.analysisResults?.forEach(e=>v.value?M(e):I(e)),p()}function ae(){d?.value?.analysisResults?.forEach(e=>I(e)),p()}function ne(e){let n=[];return e?.forEach(r=>n.push(r.name)),n.join(", ")}function Y(e){e.editable=!0}function le(e){return e.status!=="pending"?!1:e?.editable||ge(e?.result)?(Y(e),!0):!1}function J(){let e=b(),n=[];return e?.forEach(r=>n.push({uid:r.uid,result:r.result,laboratoryInstrumentUid:r.laboratoryInstrumentUid,methodUid:r.methodUid})),n}function y(){const e=b();let n=[];return e?.forEach(r=>n.push(r.uid)),n}function q(){const e=b();let n=[];return e?.forEach(r=>n.push(r.sample?.uid)),n}function re(e){switch(e?.status){case"retracted":return"bg-muted text-sm italic text-muted-foreground";default:return"text-sm leading-5 text-primary"}}function ie(e){switch(e?.status){case"retracted":return!0;case"approved":return e?.reportable===!1;default:return!1}}function p(){R.value=!1,A.value=!1,S.value=!1,C.value=!1,U.value=!1,V.value=!1;const e=b();e.length!==0&&(V.value=!0,e.every(n=>n.status==="pending")&&(R.value=!0,A.value=!0),e.every(n=>n.status==="resulted")&&(S.value=!0,C.value=!0,U.value=!0))}const{submitResults:G,approveResults:H,retractResults:K,retestResults:Q}=xe(),{unAssignSamples:X}=ke(),Z={FButton:N,FelSelect:t,FelSwitch:L,worksheetStore:h,setupStore:o,userStore:m,route:E,router:T,get can_submit(){return R},set can_submit(e){R=e},get can_retract(){return S},set can_retract(e){S=e},get can_approve(){return C},set can_approve(e){C=e},get can_retest(){return U},set can_retest(e){U=e},get can_unassign(){return A},set can_unassign(e){A=e},get barcodes(){return V},set barcodes(e){V=e},get allChecked(){return v},set allChecked(e){v=e},get viewDetail(){return j},set viewDetail(e){j=e},get worksheet(){return d},set worksheet(e){d=e},refresh:W,form:P,applying:D,applyChanges:te,areAllChecked:z,getResultsChecked:b,checkCheck:se,check:M,checkDisabled:O,unCheck:I,toggleCheckAll:oe,unCheckAll:ae,analysesText:ne,editResult:Y,isEditable:le,prepareResults:J,getResultsUids:y,getSampleUids:q,getResultRowColor:re,isDisabledRowCheckBox:ie,checkUserActionPermissios:p,submitter_:G,approver_:H,retracter_:K,retester_:Q,unassinger_:X,unAssignSamples:()=>X(y()),submitResults:()=>G(J(),"worksheet",d.value?.uid),approveResults:()=>H(y(),"worksheet",d.value?.uid),retractResults:()=>K(y()),retestResults:()=>Q(y()),printBarCodes:async()=>{window.open(T.resolve({name:"print-barcodes",query:{sampleUids:JSON.stringify(q().join(","))}}).href,"_blank")},get shield(){return Re}};return Object.defineProperty(Z,"__isScriptSetup",{enumerable:!1,value:!0}),Z}}),Ce={class:"space-y-6"},Ue={class:"flex items-center justify-between bg-background rounded-lg shadow-sm p-4"},Ae={class:"flex items-center space-x-4"},Ve={class:"flex items-center space-x-4"},Ie={class:"bg-background rounded-lg shadow-sm overflow-hidden"},Ee={class:"p-4 border-b border-border"},De={class:"grid grid-cols-3 gap-4"},Be={class:"block space-y-2"},Fe={class:"block space-y-2"},Ne={class:"block space-y-2"},Le={class:"mt-4 flex justify-end"},Te={class:"overflow-x-auto"},je={class:"w-full"},We={class:"bg-muted"},Pe={class:"px-4 py-3 text-left text-xs font-medium text-muted-foreground uppercase tracking-wider"},ze={class:"divide-y divide-border"},Me={class:"px-4 py-3 whitespace-nowrap"},Oe=["onUpdate:modelValue","disabled"],Ye={class:"px-4 py-3 whitespace-nowrap"},Je={class:"px-4 py-3 whitespace-nowrap"},qe={class:"px-4 py-3 whitespace-nowrap"},Ge={class:"px-4 py-3 whitespace-nowrap"},He=["onUpdate:modelValue"],Ke={key:1},Qe={class:"px-4 py-3 whitespace-nowrap"};function Xe(c,s,N,t,L,h){return x(),k("div",Ce,[a("div",Ue,[a("div",Ae,[u(l(t.FButton,{onClick:s[0]||(s[0]=o=>t.submitResults()),loading:c.submitting,variant:"primary",size:"sm"},{default:f(()=>[...s[14]||(s[14]=[g(" Submit Results ",-1)])]),_:1},8,["loading"]),[[w,t.can_submit&&t.shield.hasRights(t.shield.actions.SUBMIT,t.shield.objects.ANALYSIS)]]),u(l(t.FButton,{onClick:s[1]||(s[1]=o=>t.approveResults()),loading:c.approving,variant:"primary",size:"sm"},{default:f(()=>[...s[15]||(s[15]=[g(" Approve Results ",-1)])]),_:1},8,["loading"]),[[w,t.can_approve&&t.shield.hasRights(t.shield.actions.VERIFY,t.shield.objects.ANALYSIS)]]),u(l(t.FButton,{onClick:s[2]||(s[2]=o=>t.retractResults()),loading:c.retracting,variant:"destructive",size:"sm"},{default:f(()=>[...s[16]||(s[16]=[g(" Retract Results ",-1)])]),_:1},8,["loading"]),[[w,t.can_retract&&t.shield.hasRights(t.shield.actions.RETRACT,t.shield.objects.ANALYSIS)]]),u(l(t.FButton,{onClick:s[3]||(s[3]=o=>t.retestResults()),loading:c.retesting,variant:"secondary",size:"sm"},{default:f(()=>[...s[17]||(s[17]=[g(" Retest ",-1)])]),_:1},8,["loading"]),[[w,t.can_retest&&t.shield.hasRights(t.shield.actions.RETEST,t.shield.objects.ANALYSIS)]]),u(l(t.FButton,{onClick:s[4]||(s[4]=o=>c.unassignResults()),loading:c.unassigning,variant:"secondary",size:"sm"},{default:f(()=>[...s[18]||(s[18]=[g(" Unassign ",-1)])]),_:1},8,["loading"]),[[w,t.can_unassign&&t.shield.hasRights(t.shield.actions.UNASSIGN,t.shield.objects.ANALYSIS)]])]),a("div",Ve,[l(t.FelSwitch,{modelValue:t.viewDetail,"onUpdate:modelValue":s[5]||(s[5]=o=>t.viewDetail=o),label:"View Detail"},null,8,["modelValue"]),l(t.FelSwitch,{modelValue:t.barcodes,"onUpdate:modelValue":s[6]||(s[6]=o=>t.barcodes=o),label:"Print Barcodes"},null,8,["modelValue"])])]),a("div",Ie,[a("div",Ee,[a("div",De,[a("label",Be,[s[19]||(s[19]=a("span",{class:"text-sm font-medium text-foreground"},"Analyst",-1)),l(t.FelSelect,{modelValue:t.form.analystUid,"onUpdate:modelValue":s[7]||(s[7]=o=>t.form.analystUid=o),options:t.userStore.getUsers,"option-label":"firstName","option-value":"uid",placeholder:"Select Analyst",class:"w-full"},null,8,["modelValue","options"])]),a("label",Fe,[s[20]||(s[20]=a("span",{class:"text-sm font-medium text-foreground"},"Instrument",-1)),l(t.FelSelect,{modelValue:t.form.instrumentUid,"onUpdate:modelValue":s[8]||(s[8]=o=>t.form.instrumentUid=o),options:t.setupStore.getLaboratoryInstruments,"option-label":"name","option-value":"uid",placeholder:"Select Instrument",class:"w-full"},null,8,["modelValue","options"])]),a("label",Ne,[s[21]||(s[21]=a("span",{class:"text-sm font-medium text-foreground"},"Method",-1)),l(t.FelSelect,{modelValue:t.form.methodUid,"onUpdate:modelValue":s[9]||(s[9]=o=>t.form.methodUid=o),options:t.setupStore.getMethods,"option-label":"name","option-value":"uid",placeholder:"Select Method",class:"w-full"},null,8,["modelValue","options"])])]),a("div",Le,[l(t.FButton,{onClick:s[10]||(s[10]=o=>t.applyChanges()),loading:t.applying,variant:"primary",size:"sm"},{default:f(()=>[...s[22]||(s[22]=[g(" Apply Changes ",-1)])]),_:1},8,["loading"])])]),a("div",Te,[a("table",je,[a("thead",We,[a("tr",null,[a("th",Pe,[u(a("input",{type:"checkbox","onUpdate:modelValue":s[11]||(s[11]=o=>t.allChecked=o),onClick:s[12]||(s[12]=o=>t.toggleCheckAll()),class:"rounded border-input text-primary focus:ring-primary"},null,512),[[$,t.allChecked]])]),s[23]||(s[23]=a("th",{class:"px-4 py-3 text-left text-xs font-medium text-muted-foreground uppercase tracking-wider"},"Sample ID",-1)),s[24]||(s[24]=a("th",{class:"px-4 py-3 text-left text-xs font-medium text-muted-foreground uppercase tracking-wider"},"Client Sample ID",-1)),s[25]||(s[25]=a("th",{class:"px-4 py-3 text-left text-xs font-medium text-muted-foreground uppercase tracking-wider"},"Analysis",-1)),s[26]||(s[26]=a("th",{class:"px-4 py-3 text-left text-xs font-medium text-muted-foreground uppercase tracking-wider"},"Result",-1)),s[27]||(s[27]=a("th",{class:"px-4 py-3 text-left text-xs font-medium text-muted-foreground uppercase tracking-wider"},"Status",-1))])]),a("tbody",ze,[(x(!0),k(ve,null,be(t.worksheet?.analysisResults,o=>(x(),k("tr",{key:o.uid,class:ee(t.getResultRowColor(o))},[a("td",Me,[u(a("input",{type:"checkbox","onUpdate:modelValue":m=>o.checked=m,onClick:s[13]||(s[13]=m=>t.checkCheck()),disabled:t.isDisabledRowCheckBox(o),class:"rounded border-input text-primary focus:ring-primary"},null,8,Oe),[[$,o.checked]])]),a("td",Ye,_(o.sample?.sampleId),1),a("td",Je,_(o.sample?.clientSampleId),1),a("td",qe,_(o.analysis?.name),1),a("td",Ge,[t.isEditable(o)?u((x(),k("input",{key:0,type:"text","onUpdate:modelValue":m=>o.result=m,class:"w-full px-2 py-1 border border-input rounded-md bg-background text-foreground focus:outline-none focus:ring-2 focus:ring-primary"},null,8,He)),[[ye,o.result]]):(x(),k("span",Ke,_(o.result),1))]),a("td",Qe,[a("span",{class:ee(["inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium",{"bg-primary/10 text-primary":o.status==="pending","bg-warning/10 text-warning":o.status==="awaiting","bg-success/10 text-success":o.status==="approved","bg-destructive/10 text-destructive":o.status==="retracted"}])},_(o.status),3)])],2))),128))])])])])])}const ct=he(Se,[["render",Xe],["__file","/home/aurthurm/Documents/Development/felicity/felicity-lims/webapp/views/worksheet/_id/WorkSheetResults.vue"]]);export{ct as default};
