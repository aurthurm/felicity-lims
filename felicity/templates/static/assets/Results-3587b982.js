import{_ as ie,t as de,j as ue,ab as I}from"./billing-356772f3.js";import{f as pe,G as _e,c as he,M as ye,w as be,v as me,aj as fe,h as n,k as l,x as e,u as D,B as u,ag as c,F as E,ak as V,s as ge,j as N,y as L,D as i,A as y,al as b,d as xe,_ as ke}from"./_plugin-vue_export-helper-3f67fb71.js";import m from"./Button-dc046b43.js";import{a as ve}from"./index-3189f120.js";import{u as we}from"./analysis-ff49db01.js";import{h as f,o as g,a as x}from"./constants-df420cc9.js";import{e as F,d as j,v as Re,b as k,a as v}from"./runtime-dom.esm-bundler-6e07ef74.js";const Ce=e("hr",{class:"mt-4 mb-2"},null,-1),Ue=e("h3",{class:"font-bold"},"Analyses/Results",-1),Se=e("hr",{class:"mb-4 mt-2"},null,-1),Ee={class:"overflow-x-auto"},Ae={class:"align-middle inline-block min-w-full shadow overflow-hidden bg-white shadow-dashboard px-2 pt-1 rounded-bl-lg rounded-br-lg"},Te={key:0,class:"py-4 text-center"},De={key:1,class:"min-w-full"},Ve={class:"px-1 py-1 border-b-2 border-gray-300 text-left leading-4 text-gray-800 tracking-wider"},Le=e("th",{class:"px-1 py-1 border-b-2 border-gray-300 text-left leading-4 text-gray-800 tracking-wider"},null,-1),Pe=e("th",{class:"px-1 py-1 border-b-2 border-gray-300 text-left leading-4 text-gray-800 tracking-wider"}," Analysis ",-1),Me=e("th",{class:"px-1 py-1 border-b-2 border-gray-300 text-left text-sm leading-4 text-gray-800 tracking-wider"}," Methods ",-1),Be=e("th",{class:"px-1 py-1 border-b-2 border-gray-300 text-left text-sm leading-4 text-gray-800 tracking-wider"}," Instrument ",-1),Ie=e("th",{class:"px-1 py-1 border-b-2 border-gray-300 text-left text-sm leading-4 text-gray-800 tracking-wider"}," Analyst ",-1),Ne=e("th",{class:"px-1 py-1 border-b-2 border-gray-300 text-left text-sm leading-4 text-gray-800 tracking-wider"}," Interim ",-1),Fe=e("th",{class:"px-1 py-1 border-b-2 border-gray-300 text-left text-sm leading-4 text-gray-800 tracking-wider"}," Result ",-1),je=e("th",{class:"px-1 py-1 border-b-2 border-gray-300 text-left text-sm leading-4 text-gray-800 tracking-wider"}," Retest ",-1),Oe=e("th",{class:"px-1 py-1 border-b-2 border-gray-300 text-left text-sm leading-4 text-gray-800 tracking-wider"}," Submitted ",-1),$e=e("th",{class:"px-1 py-1 border-b-2 border-gray-300 text-left text-sm leading-4 text-gray-800 tracking-wider"}," Due Date ",-1),Ke=e("th",{class:"px-1 py-1 border-b-2 border-gray-300 text-left text-sm leading-4 text-gray-800 tracking-wider"}," Status ",-1),qe=e("th",{class:"px-1 py-1 border-b-2 border-gray-300 text-left text-sm leading-4 text-gray-800 tracking-wider"}," Reportable ",-1),ze=e("th",{class:"px-1 py-1 border-b-2 border-gray-300"},null,-1),Ge={class:"bg-white"},We=["onUpdate:modelValue","onChange","disabled"],He=e("td",{class:"px-1 py-1 whitespace-no-wrap border-b border-gray-500"},null,-1),Je={class:"px-1 py-1 whitespace-no-wrap border-b border-gray-500"},Qe={class:"text-sm leading-5 text-sky-800 font-semibold"},Xe={class:"px-1 py-1 whitespace-no-wrap border-b border-gray-500"},Ye={class:"text-sm leading-5 text-sky-800"},Ze={class:"px-1 py-1 whitespace-no-wrap border-b border-gray-500"},et={class:"text-sm leading-5 text-sky-800"},tt={class:"px-1 py-1 whitespace-no-wrap border-b border-gray-500"},st={class:"text-sm leading-5 text-sky-800"},at={class:"px-1 py-1 whitespace-no-wrap border-b border-gray-500"},ot={key:0,class:"text-sm leading-5 text-sky-800"},nt={key:1,class:"block col-span-2 mb-2"},rt=["onUpdate:modelValue","onChange"],lt=e("option",{value:""},null,-1),ct=["value"],it={class:"px-1 py-1 whitespace-no-wrap border-b border-gray-500"},dt={key:0,class:"text-sm leading-5 text-sky-800"},ut={key:1,class:"block"},pt=["onUpdate:modelValue","onKeyup"],_t={key:2,class:"block col-span-2 mb-2"},ht=["onUpdate:modelValue","onChange"],yt=e("option",{value:""},null,-1),bt=["value"],mt={class:"px-1 py-1 whitespace-no-wrap border-b border-gray-500"},ft={class:"text-sm leading-5 text-sky-800"},gt={key:0,class:"text-sky-800"},xt=e("i",{class:"fa fa-check-circle","aria-hidden":"true"},null,-1),kt=[xt],vt={key:1,class:"text-orange-600"},wt=e("i",{class:"fa fa-times-circle","aria-hidden":"true"},null,-1),Rt=[wt],Ct=e("td",{class:"px-1 py-1 whitespace-no-wrap border-b border-gray-500"},[e("div",{class:"text-sm leading-5 text-sky-800"},"2020-10-10")],-1),Ut=e("td",{class:"px-1 py-1 whitespace-no-wrap border-b border-gray-500"},[e("div",{class:"text-sm leading-5 text-sky-800"},"2020-10-10")],-1),St={class:"px-1 py-1 whitespace-no-wrap border-b border-gray-500"},Et={type:"button",class:"bg-sky-800 text-white px-2 py-1 rounded-sm leading-none"},At={class:"px-1 py-1 whitespace-no-wrap border-b border-gray-500"},Tt={class:"text-sm leading-5 text-sky-800"},Dt={key:0,class:"text-emerald-600"},Vt=e("i",{class:"fa fa-thumbs-up","aria-hidden":"true"},null,-1),Lt=[Vt],Pt={key:1,class:"text-orange-600"},Mt=e("i",{class:"fa fa-thumbs-down","aria-hidden":"true"},null,-1),Bt=[Mt],It=e("td",{class:"px-1 py-1 whitespace-no-wrap text-right border-b border-gray-500 text-sm leading-5"},[L(` <button @click.prevent="submitResult(result)" \r
                              class="p-1 ml-2 border-white border text-gray-500rounded-smtransition duration-300 hover:border-sky-800 hover:text-sky-800 focus:outline-none">\r
                              submit\r
                            </button> `)],-1),Nt={class:"my-4"},Ft=pe({__name:"Results",setup(jt){const O=_e(()=>ie(()=>import("./LoadingMessage-83976fce.js"),["assets/LoadingMessage-83976fce.js","assets/_plugin-vue_export-helper-3f67fb71.js"])),A=ve(),p=de(),{sample:U,analysisResults:w,fetchingResults:$}=ue(p),a=he({can_submit:!1,can_cancel:!1,can_retract:!1,can_approve:!1,can_retest:!1,can_reinstate:!1,allChecked:!1});ye(()=>p.fetchAnalysisResultsForSample(A.params.sampleUid)),be(()=>A.params.sampleUid,(t,o)=>{p.resetSample(),p.fetchAnalysisResultsForSample(A.params.sampleUid)});function T(){let t=[];return w?.value?.forEach(o=>{o.checked&&t.push(o)}),t}function K(){let t=T(),o=[];return t?.forEach(d=>o.push({uid:d.uid,result:d.result})),o}function R(){const t=T();let o=[];return t?.forEach(d=>o.push(d.uid)),o}function q(t){G()?a.allChecked=!0:a.allChecked=!1,C()}function S(t){M(t)||(t.checked=!0,C())}function P(t){t.checked=!1,C()}async function z(){await w?.value?.forEach(t=>a.allChecked?S(t):P(t)),C()}async function _(){await w?.value?.forEach(t=>P(t)),C()}function G(){return w?.value?.every(t=>t.checked===!0)}function M(t){switch(t?.status){case"retracted":return!0;case"approved":return!0;case"cancelled":return U?.value?.status!=="received";default:return!1}}function W(t){t.editable=!0}function B(t){return!["received","paired"].includes(U?.value?.status??"")||t.status!=="pending"?!1:t?.editable||I(t?.result)?(W(t),!0):!1}function H(t){switch(t?.status){case"retracted":return"bg-gray-300";case"aproved":return t?.reportable===!1?"bg-orange-600":"";default:return""}}function C(){a.can_cancel=!1,a.can_submit=!1,a.can_retract=!1,a.can_approve=!1,a.can_retest=!1,a.can_reinstate=!1;const t=T();t.length!==0&&(t.every(o=>o.status==="cancelled")&&(a.can_reinstate=!0),t.every(o=>o.status==="pending")&&(a.can_cancel=!0),t.every(o=>["pending"].includes(o.status??"")&&!I(o.result))&&(a.can_submit=!0),t.every(o=>o.status==="resulted")&&(a.can_retract=!0,a.can_approve=!0,a.can_retest=!0))}const h=async()=>{const t=xe(()=>p.getSample);t.value&&p.fetchSampleStatus(t?.value?.uid)};let{submitResults:J,cancelResults:Q,reInstateResults:X,approveResults:Y,retractResults:Z,retestResults:ee}=we();const te=()=>J(K(),"sample",U?.value?.uid).then(()=>h()).finally(()=>_()),se=()=>Q(R()).then(()=>h()).finally(()=>_()),ae=()=>X(R()).then(()=>h()).finally(()=>_()),oe=()=>Y(R(),"sample",U?.value?.uid).then(()=>h()).finally(()=>_()),ne=()=>Z(R()).then(()=>h()).finally(()=>_()),re=()=>ee(R()).then(()=>h()).finally(()=>_());return(t,o)=>{const d=me("font-awesome-icon"),le=fe("motion-slide-right");return n(),l(E,null,[Ce,Ue,Se,e("div",Ee,[e("div",Ae,[D($)?(n(),l("div",Te,[u(D(O),{message:"Fetching analytes ..."})])):(n(),l("table",De,[e("thead",null,[e("tr",null,[e("th",Ve,[c(e("input",{type:"checkbox",class:"",onChange:z,"onUpdate:modelValue":o[0]||(o[0]=s=>a.allChecked=s)},null,544),[[F,a.allChecked]])]),Le,Pe,Me,Be,Ie,Ne,Fe,je,Oe,$e,Ke,qe,ze])]),e("tbody",Ge,[(n(!0),l(E,null,V(D(w),s=>c((n(),l("tr",{key:s.uid,class:ge([H(s)])},[e("td",null,[c(e("input",{type:"checkbox",class:"border-red-500","onUpdate:modelValue":r=>s.checked=r,onChange:r=>q(),disabled:M(s)},null,40,We),[[F,s.checked]]),s.status==="pending"?(n(),N(d,{key:0,icon:"fa-question",class:"ml-1 text-xs"})):L("v-if",!0),s.status==="resulted"?(n(),N(d,{key:1,icon:"fa-question",class:"ml-1 text-xs text-orange"})):L("v-if",!0)]),He,e("td",Je,[e("div",Qe,i(s.analysis?.name),1)]),e("td",Xe,[e("div",Ye,i(s.method?.name||"None"),1)]),e("td",Ze,[e("div",et,i(s.instrument?.name||"None"),1)]),e("td",tt,[e("div",st,i(s.analyst?.name||"moyoza"),1)]),e("td",at,[!B(s)||s?.analysis?.interims?.length===0?(n(),l("div",ot," --- ")):(n(),l("label",nt,[c(e("select",{class:"form-input mt-1 block w-full","onUpdate:modelValue":r=>s.result=r,onChange:r=>S(s)},[lt,(n(!0),l(E,null,V(s?.analysis?.interims,(r,ce)=>(n(),l("option",{key:r.key,value:r.value},i(r.value),9,ct))),128))],40,rt),[[j,s.result]])]))]),e("td",it,[B(s)?s?.analysis?.resultOptions?.length===0?(n(),l("label",ut,[c(e("input",{class:"form-input mt-1 block w-full","onUpdate:modelValue":r=>s.result=r,onKeyup:r=>S(s)},null,40,pt),[[Re,s.result]])])):(n(),l("label",_t,[c(e("select",{class:"form-input mt-1 block w-full","onUpdate:modelValue":r=>s.result=r,onChange:r=>S(s)},[yt,(n(!0),l(E,null,V(s?.analysis?.resultOptions,(r,ce)=>(n(),l("option",{key:r.optionKey,value:r.value},i(r.value),9,bt))),128))],40,ht),[[j,s.result]])])):(n(),l("div",dt,i(s?.result),1))]),e("td",mt,[e("div",ft,[s?.retest?(n(),l("span",gt,kt)):(n(),l("span",vt,Rt))])]),Ct,Ut,e("td",St,[e("button",Et,i(s.status),1)]),e("td",At,[e("div",Tt,[s?.reportable?(n(),l("span",Dt,Lt)):(n(),l("span",Pt,Bt))])]),It],2)),[[le]])),128))])]))])]),e("section",Nt,[c(u(m,{key:"cancel",onClick:v(se,["prevent"]),color:"sky-800"},{default:y(()=>[b("Cancel")]),_:1},8,["onClick"]),[[k,f(x.UPDATE,g.RESULT)&&a.can_cancel]]),c(u(m,{key:"reinstate",onClick:v(ae,["prevent"]),color:"orange-600"},{default:y(()=>[b("Re-Instate")]),_:1},8,["onClick"]),[[k,f(x.UPDATE,g.RESULT)&&a.can_reinstate]]),c(u(m,{key:"submit",onClick:v(te,["prevent"]),color:"orange-600"},{default:y(()=>[b("Submit")]),_:1},8,["onClick"]),[[k,f(x.UPDATE,g.RESULT)&&a.can_submit]]),c(u(m,{key:"retract",onClick:v(ne,["prevent"]),color:"orange-600"},{default:y(()=>[b("Retract")]),_:1},8,["onClick"]),[[k,f(x.UPDATE,g.RESULT)&&a.can_retract]]),c(u(m,{key:"verify",onClick:v(oe,["prevent"]),color:"orange-600"},{default:y(()=>[b("Verify")]),_:1},8,["onClick"]),[[k,f(x.UPDATE,g.RESULT)&&a.can_approve]]),c(u(m,{key:"retest",onClick:v(re,["prevent"]),color:"orange-600"},{default:y(()=>[b("Retest")]),_:1},8,["onClick"]),[[k,f(x.UPDATE,g.RESULT)&&a.can_retest]])])],64)}}}),Ht=ke(Ft,[["__file","/home/aurthurm/Development/felicity-lims/webapp/views/sample/_id/Results.vue"]]);export{Ht as default};
