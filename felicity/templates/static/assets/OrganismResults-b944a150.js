import{S as L,f as P,a0 as v,i as H,a7 as K,h as Q,r as S,o as a,c as r,N as s,y as p,L as u,M as c,K as g,F as w,E as N,H as x,a as j,C as $,X as I,_ as X}from"./index-9a11e11f.js";import{u as J}from"./analysis-c5179d9d.js";import{G as W,A as Y,S as Z,D as ee,a as se}from"./microbiology.mutations-f9b54039.js";import"./analyses.mutations-f8d881c0.js";const te={class:"space-y-6"},ne={class:"bg-background rounded-lg shadow-sm"},ae={class:"p-6 space-y-6"},le={class:"flex items-center justify-between"},oe={class:"overflow-x-auto"},ie={class:"w-full"},re={class:"px-4 py-2"},ue={class:"text-sm text-foreground"},de={class:"px-4 py-2"},me={key:0,class:"text-sm text-primary"},ce={class:"px-4 py-2 text-right"},fe={class:"flex items-center justify-end space-x-2"},ve={class:"bg-background rounded-lg shadow-sm p-6 space-y-6"},pe={class:"flex items-center justify-between"},ge={class:"inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-primary text-primary-foreground"},xe={class:"space-y-4"},be={key:1,class:"text-sm text-muted-foreground"},ye={class:"flex justify-end space-x-4"},_e={class:"p-6 space-y-6"},ke={class:"flex items-center space-x-4"},he={class:"space-y-2"},Oe=["onClick"],Ce=L({__name:"OrganismResults",props:{sample:{type:Object,required:!0},analysisResults:{type:Object,required:!0}},setup(b){const{withClientMutation:k,withClientQuery:R}=P(),i=v([]),y=v(!1),_=v(""),D=v([]),h=v(void 0),m=v(!1),l=H(()=>b.analysisResults[0]);K(()=>{R(W,{analysisResultUid:l.value.uid},"abxOrganismResultAll").then(t=>{t&&(i.value=t||[])}).finally(()=>O())});function V(){m.value=!0,k(Y,{analysisResultUid:l.value.uid},"createAbxOrganismResult").then(t=>{t&&i.value.unshift(t)}).finally(()=>m.value=!1)}function B(t){m.value=!0,k(Z,{uid:t.uid,organismUid:t.organism.uid},"saveAbxOrganismResult").then(e=>{if(e){const o=i.value.findIndex(d=>d.uid===t.uid);if(o>-1){const d=e.organism;i.value[o].organismUid=d?.uid,i.value[o].organism=d}}}).finally(()=>{m.value=!1,O()})}function M(t){m.value=!0,k(ee,{uid:t.uid},"removeAbxOrganismResult").then(e=>{if(e){const o=i.value.findIndex(d=>d.uid===e?.uid);o>-1&&i.value.splice(o,1)}}).finally(()=>{m.value=!1,O()})}function U(t){h.value=t,y.value=!0}function E(t){y.value=!1,i.value[h.value].organism=t,h.value=void 0,b.analysisResults[0].result=i.value?.map(e=>e.organism?.name).join(", ")}function F(){_.value.length<3||R(se,{text:_.value,pageSize:25,sortBy:["name"]},"abxOrganismAll").then(t=>{D.value=t?.items})}const f=Q({can_submit:!1,can_approve:!1});function O(){f.can_submit=!1,f.can_approve=!1;const t=i.value?.every(e=>e.organismUid!=null);l.value.status=="pending"&&t&&(f.can_submit=!0),l.value.status=="resulted"&&(f.can_approve=!0)}let{submitResults:G,approveResults:T}=J();const q=()=>G([{uid:l.value.uid,result:l.value.result,methodUid:"felicity_ast",laboratoryInstrumentUid:"felicity_ast"}],"sample",b.sample?.uid).then(()=>{}),z=()=>T([l.value.uid],"sample",b.sample?.uid).then(()=>{});return(t,e)=>{const o=S("fel-button"),d=S("fel-modal");return a(),r("div",te,[s("div",ne,[s("div",ae,[s("div",le,[e[5]||(e[5]=s("h3",{class:"text-lg font-semibold text-foreground"},"Organisms",-1)),l.value.status=="pending"?(a(),p(o,{key:0,onClick:e[0]||(e[0]=n=>V()),disabled:m.value,color:"primary"},{default:u(()=>e[4]||(e[4]=[c(" Add Organism ")])),_:1},8,["disabled"])):g("v-if",!0)]),e[11]||(e[11]=s("div",{class:"border-t border-border"},null,-1)),s("div",oe,[s("table",ie,[e[10]||(e[10]=s("thead",null,[s("tr",{class:"border-b border-border bg-muted/50"},[s("th",{class:"px-4 py-2 text-left text-sm font-medium text-foreground"},"Isolate Number"),s("th",{class:"px-4 py-2 text-left text-sm font-medium text-foreground"},"Organism Name"),s("th",{class:"px-4 py-2"})])],-1)),s("tbody",null,[(a(!0),r(w,null,N(i.value,(n,C)=>(a(),r("tr",{key:n?.uid,class:"border-b border-border hover:bg-muted/50 transition-colors duration-200"},[s("td",re,[s("span",ue,"#"+x(n?.isolateNumber),1)]),s("td",de,[n?.organism?(a(),r("span",me,x(n?.organism?.name),1)):(a(),p(o,{key:1,onClick:A=>U(C),color:"outline"},{default:u(()=>[...e[6]||(e[6]=[c(" Pick Organism ")])]),_:2},1032,["onClick"]))]),s("td",ce,[s("div",fe,[n?.organism&&!n?.organismUid?(a(),r(w,{key:0},[j(o,{onClick:A=>U(C),color:"destructive"},{default:u(()=>[...e[7]||(e[7]=[c(" Change ")])]),_:2},1032,["onClick"]),j(o,{onClick:A=>B(n),color:"primary"},{default:u(()=>[...e[8]||(e[8]=[c(" Save ")])]),_:2},1032,["onClick"])],64)):g("v-if",!0),l.value.status=="pending"&&i.value.length>1?(a(),p(o,{key:1,onClick:A=>M(n),color:"destructive"},{default:u(()=>[...e[9]||(e[9]=[c(" Delete ")])]),_:2},1032,["onClick"])):g("v-if",!0)])])]))),128))])])])])]),s("div",ve,[s("div",pe,[e[12]||(e[12]=s("h4",{class:"text-lg font-semibold text-foreground"},"Culture",-1)),s("span",ge,x(l.value.status),1)]),e[15]||(e[15]=s("div",{class:"border-t border-border"},null,-1)),s("div",xe,[l.value.status=="pending"?$((a(),r("textarea",{key:0,"onUpdate:modelValue":e[1]||(e[1]=n=>l.value.result=n),rows:"4",class:"w-full rounded-md border border-input bg-background px-3 py-2 text-sm ring-offset-background placeholder:text-muted-foreground focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50",placeholder:"Enter culture results..."},null,512)),[[I,l.value.result]]):(a(),r("p",be,x(l.value.result),1)),s("div",ye,[f.can_submit?(a(),p(o,{key:0,onClick:q,color:"primary"},{default:u(()=>e[13]||(e[13]=[c(" Submit Results ")])),_:1})):g("v-if",!0),f.can_approve?(a(),p(o,{key:1,onClick:z,color:"primary"},{default:u(()=>e[14]||(e[14]=[c(" Approve Results ")])),_:1})):g("v-if",!0)])])]),y.value?(a(),p(d,{key:0,onClose:e[3]||(e[3]=n=>y.value=!1)},{header:u(()=>e[16]||(e[16]=[s("h3",{class:"text-xl font-semibold text-foreground"},"Select Organism",-1)])),body:u(()=>[s("div",_e,[s("div",ke,[$(s("input",{type:"text","onUpdate:modelValue":e[2]||(e[2]=n=>_.value=n),onInput:F,placeholder:"Search organisms...",class:"flex-1 rounded-md border border-input bg-background px-3 py-2 text-sm ring-offset-background placeholder:text-muted-foreground focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2"},null,544),[[I,_.value]])]),s("div",he,[(a(!0),r(w,null,N(D.value,n=>(a(),r("button",{key:n.uid,onClick:C=>E(n),class:"w-full text-left px-4 py-2 text-sm text-foreground hover:bg-muted/50 rounded-md transition-colors duration-200"},x(n.name),9,Oe))),128))])])]),_:1})):g("v-if",!0)])}}}),Ue=X(Ce,[["__file","/home/aurthurm/Documents/Development/felicity/felicity-lims/webapp/views/sample/_id/results/OrganismResults.vue"]]);export{Ue as default};
