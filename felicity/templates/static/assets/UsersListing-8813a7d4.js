import{W as D,a2 as y,Y as M,o as i,c as l,a5 as f,O as e,J as d,F as x,H as k,L as B,b0 as T,_ as I,a9 as F,i as S,h as P,f as z,r as O,a7 as r,z as R,M as G,C as H,D as g,Z as U,a as K,a4 as q,$ as J,ai as W,ba as Y,bb as Z}from"./index-5d85e9da.js";import{u as j}from"./user-838cdd03.js";import{u as Q}from"./setup-d31371ee.js";import"./_queries-0bd36c18.js";const X={class:"relative"},ee=["title"],te={key:0,class:"text-foreground"},se={key:1,class:"text-muted-foreground"},oe={key:0,class:"absolute inset-y-0 right-0 flex items-center pr-3 pointer-events-none"},re={key:0,class:"flex items-center space-x-1 bg-background/95 backdrop-blur-sm px-2 py-1 rounded-md shadow-sm border border-border"},ae={class:"flex space-x-1"},ie={class:"text-xs text-muted-foreground ml-1"},le={key:1,class:"text-muted-foreground bg-background/80 backdrop-blur-sm p-1 rounded transition-colors duration-200 group-hover:text-primary"},ne={key:1,class:"relative"},de=["id","value","type","placeholder","disabled"],ue=D({__name:"FelProtectedInput",props:{modelValue:{type:String,required:!0},disabled:{type:Boolean,required:!1,default:!1},placeholder:{type:String,required:!1,default:""},requiredClicks:{type:Number,required:!1,default:3},type:{type:String,required:!1,default:"text"},id:{type:String,required:!1,default:""},class:{type:String,required:!1,default:""}},emits:["update:modelValue"],setup(E,{emit:b}){const p=E,_=b,h=y(!0),u=y(p.modelValue),v=y(),s=y(0),m=y();M(()=>p.modelValue,a=>{u.value=a});const N=a=>{if(!(p.disabled||!h.value)){if(a.preventDefault(),a.stopPropagation(),s.value++,m.value&&clearTimeout(m.value),s.value>=p.requiredClicks){V();return}m.value=setTimeout(()=>{s.value=0},1500)}},V=async()=>{h.value=!1,s.value=0,m.value&&clearTimeout(m.value),await T(),v.value?.focus(),v.value?.select()},w=()=>{h.value=!0,s.value=0,m.value&&clearTimeout(m.value)},A=a=>{const n=a.target;u.value=n.value,_("update:modelValue",n.value)},C=a=>{a.key==="Enter"?(w(),v.value?.blur()):a.key==="Escape"&&(u.value=p.modelValue,_("update:modelValue",p.modelValue),w(),v.value?.blur())},$=()=>{setTimeout(()=>{w()},200)};return(a,n)=>(i(),l("div",X,[h.value?(i(),l("div",{key:0,onClick:N,class:f(["relative cursor-pointer transition-all duration-200 group select-none",a.disabled?"cursor-not-allowed opacity-50":"hover:ring-2 hover:ring-primary/20 hover:bg-primary/5",s.value>0&&!a.disabled&&"ring-2 ring-primary/30 bg-primary/10"]),title:a.disabled?"Input is disabled":`Click ${a.requiredClicks} times quickly to unlock for editing (${s.value}/${a.requiredClicks})`},[e("div",{class:f(["w-full px-3 py-2 bg-background border border-border rounded-md text-sm transition-colors duration-200",a.disabled?"bg-muted text-muted-foreground cursor-not-allowed":s.value>0?"border-primary bg-primary/5 text-foreground":"text-foreground group-hover:border-primary/50"])},[u.value?(i(),l("span",te,d(u.value),1)):(i(),l("span",se,d(a.placeholder),1))],2),a.disabled?B("",!0):(i(),l("div",oe,[s.value>0?(i(),l("div",re,[e("div",ae,[(i(!0),l(x,null,k(a.requiredClicks,t=>(i(),l("div",{key:t,class:f(["w-1.5 h-1.5 rounded-full transition-all duration-200",t<=s.value?"bg-primary":"bg-muted"])},null,2))),128))]),e("span",ie,d(a.requiredClicks-s.value)+" more ",1)])):(i(),l("div",le,n[0]||(n[0]=[e("svg",{class:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M12 15v2m-6 4h12a2 2 0 002-2v-6a2 2 0 00-2-2H6a2 2 0 00-2 2v6a2 2 0 002 2zm10-10V7a4 4 0 00-8 0v4h8z"})],-1)])))]))],10,ee)):(i(),l("div",ne,[e("input",{ref_key:"inputRef",ref:v,id:a.id,value:u.value,type:a.type,placeholder:a.placeholder,disabled:a.disabled,onInput:A,onKeydown:C,onBlur:$,class:"w-full px-3 py-2 bg-background border-2 border-primary text-foreground rounded-md text-sm placeholder:text-muted-foreground transition-colors duration-200 focus:border-primary focus:outline-none focus:ring-2 focus:ring-primary/20"},null,40,de),n[1]||(n[1]=e("div",{class:"absolute inset-y-0 right-0 flex items-center pr-3 pointer-events-none"},[e("div",{class:"text-primary bg-background/90 backdrop-blur-sm p-1 rounded"},[e("svg",{class:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M8 11V7a4 4 0 118 0m-4 8v2m-6 4h12a2 2 0 002-2v-6a2 2 0 00-2 2v6a2 2 0 002 2z"})])])],-1))]))]))}}),ce=I(ue,[["__file","/home/aurthurm/Documents/Development/felicity/felicity-lims/webapp/components/ui/form/FelProtectedInput.vue"]]),pe={class:"space-y-6"},me={class:"flex justify-between items-center"},fe={class:"bg-card rounded-lg shadow-sm"},be={class:"min-w-full divide-y divide-border"},ge={class:"bg-background divide-y divide-border"},ye={class:"px-6 py-4 whitespace-nowrap text-sm"},ve={class:"px-6 py-4 whitespace-nowrap text-sm"},xe={class:"px-6 py-4 whitespace-nowrap text-sm"},he={class:"px-6 py-4 whitespace-nowrap text-sm"},ke={class:"px-6 py-4 whitespace-nowrap text-sm"},we={class:"px-6 py-4 whitespace-nowrap text-sm"},Ue={class:"px-6 py-4 whitespace-nowrap text-sm"},_e={class:"px-6 py-4 whitespace-nowrap text-sm"},Ne={class:"px-6 py-4 whitespace-nowrap text-sm text-right"},Ae=["onClick"],Ce={class:"grid grid-cols-2 gap-6"},Le={class:"space-y-2"},Ve={class:"space-y-2"},$e={class:"space-y-2"},Be={class:"space-y-2"},Ee={class:"space-y-2"},Se={class:"space-y-2"},qe={class:"col-span-2 space-y-2"},De=["value"],Ie={class:"col-span-2 space-y-4 border-t border-gray-200 pt-6"},Me={class:"space-y-2"},Te={class:"border-2 border-gray-300 rounded-md p-3 space-y-2 max-h-32 overflow-y-auto"},Fe=["id","value"],Pe=["for"],ze={key:0,class:"space-y-2"},Oe=["value"],Re={class:"flex items-center space-x-4"},Ge={class:"flex items-center space-x-2"},He=["aria-checked"],Ke={class:"flex items-center space-x-4"},Je={class:"flex items-center space-x-2"},We=["aria-checked"],Ye={class:"flex justify-end pt-6"},Ze={type:"submit",class:"inline-flex justify-center rounded-md border border-transparent bg-blue-600 px-4 py-2 text-sm font-medium text-white hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:ring-offset-2 transition-colors duration-200"},je=D({__name:"UsersListing",setup(E){const b=j(),p=Q();F(()=>{b.fetchUsers({}),b.fetchGroupsAndPermissions(),p.fetchLaboratories()});let _=S(()=>b.getUsers);const h=S(()=>b.getGroups);let u=y(!1),v=y(""),s=P({userUid:"",firstName:"",lastName:"",email:"",groupUid:"",userName:"",password:"",passwordc:"",isActive:!0,isBlocked:!1,laboratoryUids:[],activeLaboratoryUid:""});const m=y(!0),{withClientMutation:N}=z();function V(){N(Y,s,"createUser").then(n=>b.addUser(n))}function w(){N(Z,s,"updateUser").then(n=>b.updateUser(n))}const A=n=>{const t=p.getLaboratories.find(c=>c.uid===n);return t?t?.name||"Unknown Laboratory":"-- Not Assigned --"};function C(n,t={}){if(m.value=n,u.value=!0,v.value=(n?"CREATE":"EDIT")+" USER",n){let c=new Object;c.firstName="",c.lastName="",c.email="",c.isActive=!0,c.userName="",c.isBlocked=!1,Object.assign(s,{...c,groupUid:"",userUid:"",laboratoryUids:[],activeLaboratoryUid:""})}else s.userUid=t?.uid||"",s.groupUid=t?.groups&&t.groups[0]?t.groups[0].uid:"",s.isActive=t.isActive??!0,s.isBlocked=t.isBlocked??!1,s.userName=t.userName??"",s.laboratoryUids=t.laboratories||[],s.activeLaboratoryUid=t.activeLaboratoryUid||"",Object.assign(s,{...t})}function $(){m.value?V():w(),u.value=!1}const a=["Full Name","Email","Active","Group","Username","Blocked","Active Laboratory","Assigned Labs","Actions"];return(n,t)=>{const c=O("fel-modal");return i(),l(x,null,[e("div",pe,[e("div",me,[t[14]||(t[14]=e("h1",{class:"text-2xl font-semibold"},"Users",-1)),e("button",{onClick:t[0]||(t[0]=o=>C(!0)),class:"inline-flex items-center px-4 py-2 bg-primary text-primary-foreground rounded-md hover:bg-primary/90 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-primary","aria-label":"Add new user"}," Add User ")]),e("div",fe,[e("table",be,[e("thead",null,[e("tr",null,[(i(),l(x,null,k(a,o=>e("th",{key:o,class:"px-6 py-3 text-left text-sm font-medium text-muted-foreground tracking-wider"},d(o),1)),64))])]),e("tbody",ge,[(i(!0),l(x,null,k(r(_),o=>(i(),l("tr",{key:o.uid,class:"hover:bg-muted/50"},[e("td",ye,d(o.firstName)+" "+d(o.lastName),1),e("td",ve,d(o.email),1),e("td",xe,[e("span",{class:f(["inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium",o.isActive?"bg-success/20 text-success":"bg-destructive/20 text-destructive"])},d(o.isActive?"Active":"Inactive"),3)]),e("td",he,d(o.groups?.map(L=>L?.name).join(", ")),1),e("td",ke,d(o.userName),1),e("td",we,[e("span",{class:f(["inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium",o.isBlocked?"bg-destructive/20 text-destructive":"bg-success/20 text-success"])},d(o.isBlocked?"Blocked":"Active"),3)]),e("td",Ue,d(A(o.activeLaboratoryUid||"")),1),e("td",_e,d(o.laboratories?.length)+" Labs",1),e("td",Ne,[e("button",{onClick:L=>C(!1,o),class:"text-primary hover:text-primary/80 focus:outline-none focus:underline","aria-label":"Edit user"}," Edit ",8,Ae)])]))),128))])])])]),r(u)?(i(),R(c,{key:0,onClose:t[13]||(t[13]=o=>W(u)?u.value=!1:u=!1),title:r(s).userUid?"Edit User":"Add User"},{body:G(()=>[e("form",{onSubmit:t[12]||(t[12]=H(o=>$(),["prevent"])),class:"space-y-6"},[e("div",Ce,[e("div",Le,[t[15]||(t[15]=e("label",{for:"firstName",class:"block text-sm font-medium text-gray-700"}," First Name ",-1)),g(e("input",{id:"firstName","onUpdate:modelValue":t[1]||(t[1]=o=>r(s).firstName=o),type:"text",class:"mt-1 block w-full rounded-md border-2 border-gray-300 bg-white px-3 py-2 text-sm text-gray-900 placeholder:text-gray-400 transition-colors duration-200 focus:border-blue-500 focus:outline-none focus:ring-2 focus:ring-blue-200 hover:border-gray-400",placeholder:"Enter first name"},null,512),[[U,r(s).firstName]])]),e("div",Ve,[t[16]||(t[16]=e("label",{for:"lastName",class:"block text-sm font-medium text-gray-700"}," Last Name ",-1)),g(e("input",{id:"lastName","onUpdate:modelValue":t[2]||(t[2]=o=>r(s).lastName=o),type:"text",class:"mt-1 block w-full rounded-md border-2 border-gray-300 bg-white px-3 py-2 text-sm text-gray-900 placeholder:text-gray-400 transition-colors duration-200 focus:border-blue-500 focus:outline-none focus:ring-2 focus:ring-blue-200 hover:border-gray-400",placeholder:"Enter last name"},null,512),[[U,r(s).lastName]])]),e("div",$e,[t[17]||(t[17]=e("label",{for:"email",class:"block text-sm font-medium text-gray-700"}," Email ",-1)),g(e("input",{id:"email","onUpdate:modelValue":t[3]||(t[3]=o=>r(s).email=o),type:"email",class:"mt-1 block w-full rounded-md border-2 border-gray-300 bg-white px-3 py-2 text-sm text-gray-900 placeholder:text-gray-400 transition-colors duration-200 focus:border-blue-500 focus:outline-none focus:ring-2 focus:ring-blue-200 hover:border-gray-400",placeholder:"Enter email address"},null,512),[[U,r(s).email]])]),e("div",Be,[t[18]||(t[18]=e("label",{for:"userName",class:"block text-sm font-medium text-gray-700"}," Username ",-1)),K(ce,{id:"userName",modelValue:r(s).userName,"onUpdate:modelValue":t[4]||(t[4]=o=>r(s).userName=o),type:"text","required-clicks":5,placeholder:"Enter username"},null,8,["modelValue"])]),e("div",Ee,[t[19]||(t[19]=e("label",{for:"password",class:"block text-sm font-medium text-gray-700"}," Password ",-1)),g(e("input",{id:"password","onUpdate:modelValue":t[5]||(t[5]=o=>r(s).password=o),type:"password",class:"mt-1 block w-full rounded-md border-2 border-gray-300 bg-white px-3 py-2 text-sm text-gray-900 placeholder:text-gray-400 transition-colors duration-200 focus:border-blue-500 focus:outline-none focus:ring-2 focus:ring-blue-200 hover:border-gray-400",placeholder:"Enter password"},null,512),[[U,r(s).password]])]),e("div",Se,[t[20]||(t[20]=e("label",{for:"passwordc",class:"block text-sm font-medium text-gray-700"}," Confirm Password ",-1)),g(e("input",{id:"passwordc","onUpdate:modelValue":t[6]||(t[6]=o=>r(s).passwordc=o),type:"password",class:"mt-1 block w-full rounded-md border-2 border-gray-300 bg-white px-3 py-2 text-sm text-gray-900 placeholder:text-gray-400 transition-colors duration-200 focus:border-blue-500 focus:outline-none focus:ring-2 focus:ring-blue-200 hover:border-gray-400",placeholder:"Confirm password"},null,512),[[U,r(s).passwordc]])]),e("div",qe,[t[22]||(t[22]=e("label",{for:"groupUid",class:"block text-sm font-medium text-gray-700"}," Group ",-1)),g(e("select",{id:"groupUid","onUpdate:modelValue":t[7]||(t[7]=o=>r(s).groupUid=o),class:"mt-1 block w-full rounded-md border-2 border-gray-300 bg-white px-3 py-2 text-sm text-gray-900 transition-colors duration-200 focus:border-blue-500 focus:outline-none focus:ring-2 focus:ring-blue-200 hover:border-gray-400"},[t[21]||(t[21]=e("option",{value:"",class:"text-gray-400"},"Select a group",-1)),(i(!0),l(x,null,k(h.value,o=>(i(),l("option",{key:o.uid,value:o.uid,class:"text-gray-900"},d(o?.name),9,De))),128))],512),[[q,r(s).groupUid]])]),e("div",Ie,[t[26]||(t[26]=e("h4",{class:"text-md font-medium text-gray-700"},"Laboratory Access (Optional)",-1)),e("div",Me,[t[23]||(t[23]=e("label",{class:"block text-sm font-medium text-gray-700"},"Assigned Laboratories",-1)),e("div",Te,[(i(!0),l(x,null,k(r(p).getLaboratories,o=>(i(),l("div",{key:o.uid,class:"flex items-center space-x-3"},[g(e("input",{id:`lab-${o.uid}`,"onUpdate:modelValue":t[8]||(t[8]=L=>r(s).laboratoryUids=L),value:o.uid,type:"checkbox",class:"h-4 w-4 text-blue-600 focus:ring-blue-500 border-gray-300 rounded"},null,8,Fe),[[J,r(s).laboratoryUids]]),e("label",{for:`lab-${o.uid}`,class:"flex-1 cursor-pointer text-sm"},d(o.name)+" ("+d(o.code)+") ",9,Pe)]))),128))])]),r(s).laboratoryUids&&r(s).laboratoryUids.length>0?(i(),l("div",ze,[t[25]||(t[25]=e("label",{class:"block text-sm font-medium text-gray-700"},"Default Active Laboratory",-1)),g(e("select",{"onUpdate:modelValue":t[9]||(t[9]=o=>r(s).activeLaboratoryUid=o),class:"mt-1 block w-full rounded-md border-2 border-gray-300 bg-white px-3 py-2 text-sm text-gray-900 transition-colors duration-200 focus:border-blue-500 focus:outline-none focus:ring-2 focus:ring-blue-200 hover:border-gray-400"},[t[24]||(t[24]=e("option",{value:""},"Select default laboratory...",-1)),(i(!0),l(x,null,k(r(s).laboratoryUids,o=>(i(),l("option",{key:o,value:o,class:"text-gray-900"},d(A(o)),9,Oe))),128))],512),[[q,r(s).activeLaboratoryUid]])])):B("",!0)]),e("div",Re,[e("label",Ge,[t[27]||(t[27]=e("span",{class:"text-sm font-medium text-gray-700"},"Blocked",-1)),e("button",{type:"button",role:"switch","aria-checked":r(s).isBlocked,onClick:t[10]||(t[10]=o=>r(s).isBlocked=!r(s).isBlocked),class:f(["relative inline-flex h-6 w-11 flex-shrink-0 cursor-pointer rounded-full border-2 border-transparent transition-colors duration-200 ease-in-out focus:outline-none focus:ring-2 focus:ring-blue-500 focus:ring-offset-2 shadow-sm",[r(s).isBlocked?"bg-red-500":"bg-green-500"]])},[e("span",{"aria-hidden":"true",class:f(["pointer-events-none inline-block h-5 w-5 transform rounded-full bg-white shadow ring-0 transition duration-200 ease-in-out",[r(s).isBlocked?"translate-x-5":"translate-x-0"]])},null,2)],10,He)])]),e("div",Ke,[e("label",Je,[t[28]||(t[28]=e("span",{class:"text-sm font-medium text-gray-700"},"Active",-1)),e("button",{type:"button",role:"switch","aria-checked":r(s).isActive,onClick:t[11]||(t[11]=o=>r(s).isActive=!r(s).isActive),class:f(["relative inline-flex h-6 w-11 flex-shrink-0 cursor-pointer rounded-full border-2 border-transparent transition-colors duration-200 ease-in-out focus:outline-none focus:ring-2 focus:ring-blue-500 focus:ring-offset-2 shadow-sm",[r(s).isActive?"bg-green-500":"bg-red-500"]])},[e("span",{"aria-hidden":"true",class:f(["pointer-events-none inline-block h-5 w-5 transform rounded-full bg-white shadow ring-0 transition duration-200 ease-in-out",[r(s).isActive?"translate-x-5":"translate-x-0"]])},null,2)],10,We)])])]),e("div",Ye,[e("button",Ze,d(r(s).userUid?"Update":"Create")+" User ",1)])],32)]),_:1},8,["title"])):B("",!0)],64)}}});const st=I(je,[["__scopeId","data-v-0b494f3a"],["__file","/home/aurthurm/Documents/Development/felicity/felicity-lims/webapp/views/admin/users/UsersListing.vue"]]);export{st as default};
