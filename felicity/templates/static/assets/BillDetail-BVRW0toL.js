const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/DataTable-DLBrhw2Z.js","assets/index-OdhKCqIc.js","assets/index-DD18L2yL.css","assets/TooltipTrigger-BWIYwmnQ.js","assets/PopperContent-BfyCnGUj.js","assets/Input-BEm5S0CJ.js","assets/SelectValue-Ds0cfAgl.js","assets/useNonce-B4v0IDPb.js","assets/chevron-down-Dqf-ptA3.js","assets/useFocusGuards-Bjb6OG0k.js","assets/Spinner-Bl8RfjFA.js"])))=>i.map(i=>d[i]);
import{u as J,e as X,Y as ae,aB as ie,a0 as g,ah as re,an as z,a5 as de,a6 as ce,a3 as ue,aD as G,_ as me,r as fe,aF as U,c as b,o as c,z as o,A as S,C as L,D as C,E as N,I as u,a as s,K as n,M as r,B as F,F as I,H as P,a4 as k}from"./index-OdhKCqIc.js";import{u as ge}from"./billing-COaJ61t1.js";import{g as be,C as ve,h as ye}from"./billing.mutations-BKsnFCTJ.js";import{I as _e,l as pe}from"./billing.queries-CxKPIhZs.js";import{c as he,a as E,d as xe,u as Be,F as Ce}from"./index.esm-BfHj8iGm.js";import{I as Fe}from"./Input-BEm5S0CJ.js";import{F as Te,a as we,b as Se}from"./FormMessage-CgXFMXx9.js";import{F as Ie}from"./FormLabel-DxP9wnWS.js";import{S as ke,a as Ve,b as Me,c as Ae,d as De}from"./SelectValue-Ds0cfAgl.js";import"./Label-CS46LzLb.js";import"./useNonce-B4v0IDPb.js";import"./chevron-down-Dqf-ptA3.js";import"./useFocusGuards-Bjb6OG0k.js";import"./PopperContent-BfyCnGUj.js";function je(){const{withClientQuery:T}=J(),{swalConfirm:t,toastSuccess:i,toastError:e}=X();return{downloadInvoice:async v=>{try{if((await t("You want to download this invoice","Are you sure?")).isConfirmed){const f=await T(_e,{billUid:v},"billInvoiceCreate","network-only");if(f){const y=document.createElement("a");y.href=`data:application/pdf;base64,${f}`,y.setAttribute("download","invoice-report.pdf"),y.click(),i("Invoice downloaded successfully")}}}catch(m){e(`Failed to download invoice: ${m instanceof Error?m.message:"Unknown error"}`)}}}}const Ue=ae({__name:"BillDetail",props:{customerUid:{type:String,required:!0},testBill:{type:Object,required:!0}},setup(T,{expose:t}){t();const i=de(()=>ce(()=>import("./DataTable-DLBrhw2Z.js"),__vite__mapDeps([0,1,2,3,4,5,6,7,8,9,10]))),e=T,{toastSuccess:B}=X(),{withClientMutation:v,withClientQuery:m}=J(),f=ge(),{transactions:y,fetchingTransactions:V}=ie(f),a=g(["cash","medical-aid","e-payment"]),d=g(!1);re(()=>{M(e.testBill)}),z(()=>e.testBill,l=>{l?.uid&&M(l)},{deep:!0});const M=l=>{A.value=[],f.fetchBillTransactions(l.uid),q(l.uid)},A=g([]),q=async l=>{const h=await m(pe,{uid:l},"ordersByBillUid");A.value=h};function Z(l,h){let D=[];return l.forEach(j=>D.push(j.name)),h.forEach(j=>D.push(j.name)),D.join(", ")}const O=he({testBillUid:E().required(),kind:E().required(),amount:xe().required(),notes:E()}),{handleSubmit:R,setFieldValue:_,values:$}=Be({validationSchema:O,initialValues:{testBillUid:e.testBill?.uid}}),p=g(!1),ee=R(l=>{p.value=!0,Y(l)}),te=()=>{e.testBill?.uid&&(_("testBillUid",e.testBill?.uid),_("kind","cash"),_("amount",Math.ceil(Number((e.testBill?.totalCharged-e.testBill?.totalPaid).toFixed(2)))),_("notes",""),d.value=!0)},Y=l=>{v(be,{payload:l},"createTestBillTransaction").then(h=>{f.addTransaction(h),p.value=!1,d.value=!1,B("Transaction added.")})},w=g(!1),x=g({}),oe=()=>{p.value=!0,v(ve,{uid:x.value.uid,notes:x.value.notes},"confirmTestBillTransaction").then(l=>{f.updateTransaction(l),p.value=!1,w.value=!1,B("Transaction confirmed.")})},se=g([{name:"Kind",value:"kind",sortable:!0,sortBy:"asc",defaultSort:!0,showInToggler:!1,hidden:!1},{name:"Amount",value:"amount",sortable:!1,sortBy:"asc",hidden:!1},{name:"Success",value:"isSuccess",sortable:!1,sortBy:"asc",hidden:!1},{name:"Notes",value:"notes",sortable:!1,sortBy:"asc",hidden:!1},{name:"Message",value:"message",sortable:!1,sortBy:"asc",hidden:!1},{name:"Processed",value:"processed",sortable:!1,sortBy:"asc",hidden:!1,customRender:function(l,h){return G("span",{innerHTML:l.processed?"Yes":"Pending confirmation"},[])}},{name:"Action",sortable:!1,hidden:!1,customRender:(l,h)=>{if(!l.processed)return G("button",{onClick(){w.value=!0,x.value=l},type:"button",class:"bg-primary text-primary-foreground py-1 px-2 rounded-sm leading-none"},"confirm")}}]),K=g(!1),W=g({code:""}),ne=()=>{K.value=!0};z(w,l=>{l&&(_("kind",x.value?.kind??""),_("notes",x.value?.notes??""))});const le=()=>{p.value=!0,v(ye,{payload:{voucherCode:W.value?.code,testBillUid:e.testBill?.uid,customerUid:e.customerUid}},"applyVoucher").then(l=>p.value=!1)},{downloadInvoice:H}=je(),Q={DataTable:i,props:e,toastSuccess:B,withClientMutation:v,withClientQuery:m,billingStore:f,transactions:y,fetchingTransactions:V,kinds:a,showTransactionModal:d,selectTestBill:M,orders:A,getOrders:q,profileAnalysesText:Z,transactionSchema:O,handleSubmit:R,setFieldValue:_,values:$,processing:p,submitTransactionForm:ee,newTransaction:te,addTransaction:Y,showConfirmTransactionModal:w,confirmTransaction:x,submitConfirmTransaction:oe,tableColumns:se,showVoucherModal:K,voucherCodeForm:W,applyVoucher:ne,submitVoucherCodeForm:le,downloadInvoice:H,invoice:async l=>await H(l.uid),get Button(){return ue},get Input(){return Fe},get FormControl(){return Se},get FormField(){return Ce},get FormItem(){return we},get FormLabel(){return Ie},get FormMessage(){return Te},get Select(){return De},get SelectContent(){return Ae},get SelectItem(){return Me},get SelectTrigger(){return Ve},get SelectValue(){return ke}};return Object.defineProperty(Q,"__isScriptSetup",{enumerable:!1,value:!0}),Q}}),Le={class:"space-y-6"},Ne={initial:{opacity:0,y:-100},enter:{opacity:1,y:0,scale:1},variants:{custom:{scale:2}},delay:400,class:"col-span-9 space-y-6"},Pe={class:"bg-background rounded-lg shadow-sm p-6 space-y-4"},Ee={class:"flex justify-between items-center"},qe={class:"text-lg font-semibold text-foreground"},Oe={class:"grid grid-cols-3 gap-8"},Re={class:"space-y-4"},Ye={class:"flex justify-between items-center"},Ke={class:"text-sm text-foreground"},We={class:"flex justify-between items-center"},He={class:"text-sm text-foreground"},Qe={class:"space-y-4"},ze={class:"flex justify-between items-center"},Ge={class:"text-sm text-foreground"},Je={class:"flex justify-between items-center"},Xe={class:"text-sm text-foreground"},Ze={class:"space-y-4"},$e={class:"flex justify-between items-center"},et={class:"text-sm text-foreground"},tt={class:"space-y-4"},ot={class:"flex justify-between items-center"},st={class:"bg-background rounded-lg shadow-sm p-6 space-y-4"},nt={class:"font-semibold text-foreground"},lt={class:"text-muted-foreground"},at={class:"ml-2 text-primary"},it={class:"space-y-4"},rt={class:"flex justify-between items-center"},dt={class:"space-x-4"},ct={class:"bg-background rounded-lg shadow-sm p-6"},ut={class:"grid grid-cols-2 gap-6"},mt={class:"flex justify-end"},ft={class:"text-lg font-medium text-foreground"},gt={class:"flex justify-end"},bt={class:"space-y-6 p-6"},vt={class:"flex justify-end"};function yt(T,t,i,e,B,v){const m=fe("Modal"),f=U("motion-slide-top"),y=U("motion-slide-right"),V=U("motion");return c(),b(I,null,[o("div",Le,[C((c(),b("section",Ne,[C((c(),b("div",Pe,[o("div",Ee,[o("h4",qe,u(i.testBill.billId?.toLocaleUpperCase()),1)]),o("div",Oe,[o("div",Re,[o("div",Ye,[t[6]||(t[6]=o("span",{class:"text-sm font-medium text-foreground"},"Active:",-1)),o("span",Ke,u(i.testBill.isActive?"Yes":"No"),1)]),o("div",We,[t[7]||(t[7]=o("span",{class:"text-sm font-medium text-foreground"},"Confirmed:",-1)),o("span",He,u(i.testBill?.toConfirm?"No":"Yes"),1)])]),o("div",Qe,[o("div",ze,[t[8]||(t[8]=o("span",{class:"text-sm font-medium text-foreground"},"Total Charged:",-1)),o("span",Ge,u(i.testBill?.totalCharged),1)]),o("div",Je,[t[9]||(t[9]=o("span",{class:"text-sm font-medium text-foreground"},"Total Paid:",-1)),o("span",Xe,u(i.testBill?.totalPaid),1)])]),o("div",Ze,[o("div",$e,[t[10]||(t[10]=o("span",{class:"text-sm font-medium text-foreground"},"Partial:",-1)),o("span",et,u(i.testBill?.totalPaid<i.testBill?.totalCharged?"Yes":"No"),1)])])])])),[[f]]),o("div",tt,[o("div",ot,[t[12]||(t[12]=o("h4",{class:"text-lg font-semibold text-foreground"},"Order Items",-1)),s(e.Button,{onClick:t[0]||(t[0]=F(a=>e.invoice(i.testBill),["prevent"])),type:"button"},{default:n(()=>[...t[11]||(t[11]=[r(" Invoice ",-1)])]),_:1})]),o("ul",st,[(c(!0),b(I,null,P(e.orders,a=>(c(),b("li",{class:"space-y-2",key:a.uid},[o("div",nt,u(a?.requestId)+" ("+u(a?.clientRequestId)+")",1),(c(!0),b(I,null,P(a.samples,d=>C((c(),b("div",{class:"space-y-1 pl-4",key:d.uid},[o("span",lt,u(d.sampleId),1),t[13]||(t[13]=r(" â‡’ ",-1)),o("span",at,u(e.profileAnalysesText(d.profiles??[],d.analyses??[])),1)])),[[y]])),128))]))),128))])]),o("div",it,[o("div",rt,[t[16]||(t[16]=o("h4",{class:"text-lg font-semibold text-foreground"},"Transactions",-1)),o("div",dt,[C(s(e.Button,{onClick:F(e.newTransaction,["prevent"]),type:"button"},{default:n(()=>[...t[14]||(t[14]=[r(" Add Transaction ",-1)])]),_:1},512),[[N,i.testBill.isActive]]),C(s(e.Button,{onClick:F(e.applyVoucher,["prevent"]),type:"button"},{default:n(()=>[...t[15]||(t[15]=[r(" Apply Voucher ",-1)])]),_:1},512),[[N,i.testBill.isActive]])])]),o("div",ct,[s(e.DataTable,{columns:e.tableColumns,data:e.transactions,toggleColumns:!1,loading:e.fetchingTransactions,paginable:!1,searchable:!1,filterable:!1,selectable:!1},{footer:n(()=>[...t[17]||(t[17]=[])]),_:1},8,["columns","data","loading"])])])])),[[N,i.testBill.uid],[V]])]),e.showTransactionModal?(c(),S(m,{key:0,onClose:t[2]||(t[2]=a=>e.showTransactionModal=!1),contentWidth:"w-3/6",class:"bg-background"},{header:n(()=>[...t[18]||(t[18]=[o("h3",{class:"text-xl font-semibold text-foreground"},"Transaction Form",-1)])]),body:n(()=>[o("form",{class:"space-y-6 p-6",onSubmit:t[1]||(t[1]=F((...a)=>e.submitTransactionForm&&e.submitTransactionForm(...a),["prevent"]))},[o("div",ut,[s(e.FormField,{name:"kind"},{default:n(({componentField:a})=>[s(e.FormItem,null,{default:n(()=>[s(e.FormLabel,null,{default:n(()=>[...t[19]||(t[19]=[r("Kind of payment",-1)])]),_:1}),s(e.FormControl,null,{default:n(()=>[s(e.Select,k(a,{disabled:e.processing}),{default:n(()=>[s(e.SelectTrigger,null,{default:n(()=>[s(e.SelectValue,{placeholder:"Select kind"})]),_:1}),s(e.SelectContent,null,{default:n(()=>[(c(!0),b(I,null,P(e.kinds,d=>(c(),S(e.SelectItem,{key:d,value:d},{default:n(()=>[r(u(d),1)]),_:2},1032,["value"]))),128))]),_:1})]),_:1},16,["disabled"])]),_:2},1024),s(e.FormMessage)]),_:2},1024)]),_:1}),s(e.FormField,{name:"amount"},{default:n(({componentField:a})=>[s(e.FormItem,null,{default:n(()=>[s(e.FormLabel,null,{default:n(()=>[...t[20]||(t[20]=[r("Amount",-1)])]),_:1}),s(e.FormControl,null,{default:n(()=>[s(e.Input,k(a,{type:"number",disabled:e.processing}),null,16,["disabled"])]),_:2},1024),s(e.FormMessage)]),_:2},1024)]),_:1})]),s(e.FormField,{name:"notes"},{default:n(({componentField:a})=>[s(e.FormItem,null,{default:n(()=>[s(e.FormLabel,null,{default:n(()=>[...t[21]||(t[21]=[r("Notes",-1)])]),_:1}),s(e.FormControl,null,{default:n(()=>[s(e.Input,k(a,{disabled:e.processing}),null,16,["disabled"])]),_:2},1024),s(e.FormMessage)]),_:2},1024)]),_:1}),o("div",mt,[s(e.Button,{type:"submit",disabled:e.processing},{default:n(()=>[...t[22]||(t[22]=[r(" Save Transaction ",-1)])]),_:1},8,["disabled"])])],32)]),_:1})):L("",!0),e.showConfirmTransactionModal?(c(),S(m,{key:1,onClose:t[3]||(t[3]=a=>e.showConfirmTransactionModal=!1),contentWidth:"w-3/6",class:"bg-background"},{header:n(()=>[...t[23]||(t[23]=[o("h3",{class:"text-xl font-semibold text-foreground"},"Confirm Transaction",-1)])]),body:n(()=>[o("form",{class:"space-y-6 p-6",onSubmit:F(e.submitConfirmTransaction,["prevent"])},[o("h4",ft,u(e.values.kind)+" Transaction",1),s(e.FormField,{name:"notes"},{default:n(({componentField:a})=>[s(e.FormItem,null,{default:n(()=>[s(e.FormLabel,null,{default:n(()=>[...t[24]||(t[24]=[r("Notes",-1)])]),_:1}),s(e.FormControl,null,{default:n(()=>[s(e.Input,k(a,{disabled:e.processing}),null,16,["disabled"])]),_:2},1024),s(e.FormMessage)]),_:2},1024)]),_:1}),o("div",gt,[s(e.Button,{type:"submit",disabled:e.processing},{default:n(()=>[...t[25]||(t[25]=[r(" Confirm Transaction ",-1)])]),_:1},8,["disabled"])])],32)]),_:1})):L("",!0),e.showVoucherModal?(c(),S(m,{key:2,onClose:t[5]||(t[5]=a=>e.showVoucherModal=!1),contentWidth:"w-1/5",class:"bg-background"},{header:n(()=>[...t[26]||(t[26]=[o("h3",{class:"text-xl font-semibold text-foreground"},"Apply Voucher Code",-1)])]),body:n(()=>[o("form",bt,[s(e.FormItem,null,{default:n(()=>[s(e.FormLabel,null,{default:n(()=>[...t[27]||(t[27]=[r("Voucher Code",-1)])]),_:1}),s(e.FormControl,null,{default:n(()=>[s(e.Input,{type:"text",modelValue:e.voucherCodeForm.code,"onUpdate:modelValue":t[4]||(t[4]=a=>e.voucherCodeForm.code=a),disabled:e.processing},null,8,["modelValue","disabled"])]),_:1})]),_:1}),o("div",vt,[s(e.Button,{type:"button",disabled:e.processing,onClick:e.submitVoucherCodeForm},{default:n(()=>[...t[28]||(t[28]=[r(" Apply Voucher ",-1)])]),_:1},8,["disabled"])])])]),_:1})):L("",!0)],64)}const Dt=me(Ue,[["render",yt],["__scopeId","data-v-3a43e177"],["__file","/home/administrator/Documents/Development/beak-insights/felicity/felicity-lims/webapp/components/billing/BillDetail.vue"]]);export{Dt as default};
