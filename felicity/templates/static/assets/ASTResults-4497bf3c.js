import{d as _e,R as ve,I as he,p as fe,r,q as xe,P as be,m as ge,o as u,c as i,F as c,C as m,b as l,t as _,A as b,e as p,L as g,ad as B,v as Q,G as Ae,g as T,ae as Ue,z as A,w as P,f as M,y as Re,B as G,j as W,_ as H,S as we,k as Ce}from"./index-d5ae4e74.js";import{u as Se}from"./analysis-ecced86b.js";import{h as F,o as I,a as L}from"./constants-d3cbea61.js";import{a9 as Ve,ad as Te,Y as Pe,ae as Me,af as je,ag as De,ah as Ee}from"./microbiology.mutations-146484b7.js";import"./analyses.mutations-f20367a3.js";const Ye=l("h3",{class:"flex justify-between items-center mt-4"},[l("span",{class:"font-bold"},"AST Panel")],-1),ke=l("hr",{class:"mt-1"},null,-1),Be={class:"flex justify-between items-center"},Ge={class:"font-bold"},Fe={class:"italic"},Ie=["onClick"],Le={class:"overflow-x-auto"},Ne={class:"min-w-full divide-y divide-gray-200"},$e={class:"bg-gray-50"},qe=l("th",{class:"px-4 py-2 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"},"Parameter",-1),ze={class:"bg-white divide-y divide-gray-200"},Qe=l("td",{class:"px-4 py-2 text-sm font-medium text-gray-900"},"Guideline",-1),We=["onUpdate:modelValue","onChange","disabled"],He=["value"],Je=l("td",{class:"px-4 py-2 text-sm font-medium text-gray-900"},"AST Method",-1),Ke=["onUpdate:modelValue","onChange","disabled"],Xe=["value"],Ze=l("td",{class:"px-4 py-2 text-sm font-medium text-gray-900"},"AST Value",-1),Oe=["onUpdate:modelValue","onChange","disabled"],et=l("td",{class:"px-4 py-2 text-sm font-medium text-gray-900"},"Result",-1),tt=["onUpdate:modelValue","onChange","disabled"],st=l("option",{value:"S"},"S",-1),lt=l("option",{value:"I"},"I",-1),at=l("option",{value:"R"},"R",-1),nt=[st,lt,at],ot={class:"ml-2 text-xs text-gray-400"},ut=l("td",{class:"px-4 py-2 text-sm font-medium text-gray-900"},"Reportable",-1),it=["onUpdate:modelValue","onChange","disabled"],dt={type:"button",class:"bg-sky-800 text-white ml-4 px-2 py-1 rounded-sm leading-none"},rt={class:"mt-2"},ct={class:"italic font-semibold"},pt={class:"w-full"},mt={class:"block mb-4"},yt={class:"border p-2 h-64 overflow-y-auto"},_t={class:"w-full"},vt={class:"px-1 py-1 whitespace-no-wrap border-b border-gray-500"},ht={class:"text-sm leading-5 text-gray-800 font-bold"},ft={class:"px-1 py-1 whitespace-no-wrap border-b border-gray-500"},xt={class:"text-sm leading-5 text-gray-800"},bt={class:"px-1 py-1 whitespace-no-wrap text-right border-b border-gray-500 text-sm leading-5"},gt=["onClick"],At={key:0},Ut=l("td",{colspan:"3",class:"px-4 py-3 text-center text-sm text-gray-500"}," Loading panels... ",-1),Rt=[Ut],wt={key:1},Ct=l("td",{colspan:"3",class:"px-4 py-3 text-center text-sm text-gray-500"}," No panels found ",-1),St=[Ct],Vt=_e({__name:"ASTResults",props:{sample:{type:Object,required:!0},organismAnalysisResults:{type:Object,required:!0}},setup(J){const K=W(()=>H(()=>import("./index-d5ae4e74.js").then(s=>s.bs),["assets/index-d5ae4e74.js","assets/index-246842b1.css"])),j=W(()=>H(()=>import("./FelButton-5eab97cd.js"),["assets/FelButton-5eab97cd.js","assets/index-d5ae4e74.js","assets/index-246842b1.css"])),{sample:y,organismAnalysisResults:X}=J,D=ve(),{withClientMutation:N,withClientQuery:h}=he(),Z=fe(()=>X[0]),U=r([]),R=r([]),$=r([]),q=r([]);xe(()=>{h(Ve,{analysisResultUid:Z.value.uid},"abxOrganismResultAll").then(s=>{s&&(R.value=s||[])}).finally(()=>V()),S(),h(Te,{},"abxGuidelineYearAll").then(s=>{s&&($.value=s||[])}),h(Pe,{},"abxTestMethodAll").then(s=>{s&&(q.value=s||[])})});const w=r(!1),C=r(!1),E=r(""),Y=r([]),f=r();function S(){h(Me,{sampleUid:y.uid},"abxAstResultAll").then(s=>{s&&(U.value=s||[])}).finally(()=>V())}function O(s){f.value=s,w.value=!0}function ee(s){const a=n.value[s.uid];return a?Object.values(a)?.every(d=>d.status=="pending"):!1}function te(){C.value=!0,h(je,{organismUid:f.value?.uid,text:E.value},"abxAstPanelFilter").then(s=>{s&&(Y.value=s||[])}).finally(()=>{C.value=!1})}function se(s){w.value=!1,we.fire({title:"Are you sure?",text:"You want to apply panel: "+s.name+" to organism: "+f.value?.organism?.name,icon:"warning",showCancelButton:!0,confirmButtonColor:"#3085d6",cancelButtonColor:"#d33",confirmButtonText:"Yes, apply now!",cancelButtonText:"No, do not apply!"}).then(async a=>{a.isConfirmed&&N(De,{payload:{organismResultUid:f.value?.uid,panelUid:s.uid,sampleUid:y.uid}},"applyAbxAstPanel").then(d=>{d?.astResults?.forEach(e=>U.value.push(e)),V()})})}const n=r({});function V(){const s={};R.value?.forEach(a=>{s[a.uid]={},(U.value?.filter(e=>e.organismResultUid===a.uid)).forEach(e=>{e.antibiotic?.name&&(s[a.uid][e.antibiotic.name+" "+e.antibiotic.potency]={uid:e.uid,analResultUid:e.analysisResultUid,status:e.analysisResult?.status,astMethodUid:e.astMethodUid,guidelineYearUid:e.guidelineYearUid,breakpointUid:e.breakpointUid,astValue:e.astValue,result:e.analysisResult?.result,reportable:e.analysisResult?.reportable,dirty:!1})})}),n.value=s}be([R,U],()=>{V()});const v=s=>Object.keys(n.value[s]||{});let{submitResults:le,approveResults:ae}=Se();function ne(s){const a=n.value[s];if(!a)return!1;const d=Object.values(a)?.some(t=>t.dirty&&t.status=="pending"),e=Object.values(a)?.some(t=>t.guidelineYearUid&&t.astMethodUid&&t.astValue);return d&&e}function oe(s){const a=n.value[s];return(Object.values(a)?.filter(t=>t.dirty&&t.status=="pending")).filter(t=>t.guidelineYearUid&&t.astMethodUid&&t.astValue).map(({dirty:t,breakpointUid:o,analResultUid:z,status:Tt,...ye})=>ye)}const k=r(!1);function ue(s){k.value=!0;const a=oe(s);N(Ee,{payload:{results:a}},"updateAbxAstResults").then(()=>{D.fetchAnalysisResultsForSample(y.uid),S()}).finally(()=>k.value=!1)}function ie(s){const a=n.value[s];if(!a)return!1;const d=Object.values(a)?.some(t=>t.dirty),e=Object.values(a)?.some(t=>t.guidelineYearUid&&t.astMethodUid&&t.astValue&&t.result&&t.status=="pending");return!d&&e&&y.status!="submitting"}function de(s){const a=n.value[s];return(Object.values(a)?.filter(t=>!t.dirty)).filter(t=>t.guidelineYearUid&&t.astMethodUid&&t.astValue&&t.result&&t.status=="pending").map(({dirty:t,breakpointUid:o,...z})=>z)}function re(s){const d=de(s).map(e=>({uid:e.analResultUid,result:e.result,reportable:e.reportable,methodUid:"felicity_ast",laboratoryInstrumentUid:"felicity_ast"}));le(d,"sample",y?.uid).then(()=>{D.fetchAnalysisResultsForSample(y.uid),S()})}function ce(s){const a=n.value[s];if(!a)return!1;const d=Object.values(a)?.some(t=>t.dirty),e=Object.values(a)?.some(t=>t.status=="resulted");return!d&&e&&y.status!="approving"}function pe(s){const a=n.value[s];return(Object.values(a)?.filter(e=>!e.dirty)).filter(e=>e.status=="resulted")}function me(s){const d=pe(s).map(e=>e.analResultUid);ae(d,"sample",y?.uid).then(()=>{D.fetchAnalysisResultsForSample(y.uid),S()})}async function x(s,a,d,e){n.value[s][a],n.value[s][a].dirty=!0,n.value[s][a]={...n.value[s][a],[d]:e}}return(s,a)=>{const d=ge("font-awesome-icon");return u(),i(c,null,[Ye,ke,(u(!0),i(c,null,m(R.value,e=>(u(),i("div",{key:e.uid,class:"mb-4"},[l("h3",Be,[l("span",null,[l("span",Ge,"Organism #"+_(e?.isolateNumber),1),b(": "),l("span",Fe,_(e?.organism?.name),1)]),p(l("button",{onClick:t=>O(e),class:"ml-2 px-2 py-1 border-sky-800 border text-sky-800 rounded-sm transition duration-300 hover:bg-sky-800 hover:text-white focus:outline-none"}," choose panel ",8,Ie),[[g,ee(e)]])]),l("div",Le,[l("table",Ne,[l("thead",null,[l("tr",$e,[qe,(u(!0),i(c,null,m(v(e.uid),t=>(u(),i("th",{key:t,class:"px-4 py-2 text-left text-xs font-medium text-gray-500 tracking-wider"},_(t),1))),128))])]),l("tbody",ze,[l("tr",null,[Qe,(u(!0),i(c,null,m(v(e.uid),t=>(u(),i("td",{key:t,class:"px-4 py-2 text-sm text-gray-500"},[p(l("select",{"onUpdate:modelValue":o=>n.value[e.uid][t].guidelineYearUid=o,onChange:o=>x(e.uid,t,"guidelineYearUid",o.target.value),class:"w-32 px-2 py-1 border rounded",disabled:n.value[e.uid][t].status!=="pending"},[(u(!0),i(c,null,m($.value,o=>(u(),i("option",{key:o.uid,value:o.uid},_(o.code),9,He))),128))],40,We),[[B,n.value[e.uid][t].guidelineYearUid]])]))),128))]),l("tr",null,[Je,(u(!0),i(c,null,m(v(e.uid),t=>(u(),i("td",{key:t,class:"px-4 py-2 text-sm text-gray-500"},[p(l("select",{"onUpdate:modelValue":o=>n.value[e.uid][t].astMethodUid=o,onChange:o=>x(e.uid,t,"astMethodUid",o.target.value),class:"w-32 px-2 py-1 border rounded",disabled:n.value[e.uid][t].status!=="pending"},[(u(!0),i(c,null,m(q.value,o=>(u(),i("option",{key:o.uid,value:o.uid},_(o.name),9,Xe))),128))],40,Ke),[[B,n.value[e.uid][t].astMethodUid]])]))),128))]),l("tr",null,[Ze,(u(!0),i(c,null,m(v(e.uid),t=>(u(),i("td",{key:t,class:"px-4 py-2 text-sm text-gray-500"},[p(l("input",{type:"number","onUpdate:modelValue":o=>n.value[e.uid][t].astValue=o,onChange:o=>x(e.uid,t,"astValue",o.target.value),class:"w-32 px-2 py-1 border rounded",step:"0.1",disabled:n.value[e.uid][t].status!=="pending"},null,40,Oe),[[Q,n.value[e.uid][t].astValue]])]))),128))]),l("tr",null,[et,(u(!0),i(c,null,m(v(e.uid),t=>(u(),i("td",{key:t,class:"px-4 py-2 text-sm"},[p(l("select",{"onUpdate:modelValue":o=>n.value[e.uid][t].result=o,onChange:o=>x(e.uid,t,"result",o.target.value),class:Ae(["w-32 px-2 py-1 border rounded",{"text-green-600":n.value[e.uid][t].result?.toUpperCase()==="S","text-yellow-600":n.value[e.uid][t].result?.toUpperCase()==="I","text-red-600":n.value[e.uid][t].result?.toUpperCase()==="R"}]),disabled:n.value[e.uid][t].status!=="pending"},[...nt],42,tt),[[B,n.value[e.uid][t].result]]),l("span",ot,[p(l("span",null,[T(d,{icon:"robot",class:"text-md text-gray-400 mr-1"})],512),[[g,n.value[e.uid][t].breakpointUid]])])]))),128))]),l("tr",null,[ut,(u(!0),i(c,null,m(v(e.uid),t=>(u(),i("td",{key:t,class:"px-4 py-2 text-sm"},[p(l("input",{type:"checkbox","onUpdate:modelValue":o=>n.value[e.uid][t].reportable=o,onChange:o=>x(e.uid,t,"reportable",o.target.checked),class:"form-checkbox h-4 w-4 text-sky-600",disabled:n.value[e.uid][t].status!=="pending"},null,40,it),[[Ue,n.value[e.uid][t].reportable]]),l("button",dt,_(n.value[e.uid][t].status),1)]))),128))])])]),l("div",rt,[p(T(M(j),{key:"button",onClick:P(t=>ue(e.uid),["prevent"]),color:"orange-600",disabled:k.value},{default:A(()=>[b("Save Antibiotics")]),_:2},1032,["onClick","disabled"]),[[g,F(L.UPDATE,I.RESULT)&&ne(e.uid)]]),p(T(M(j),{key:"button",onClick:P(t=>re(e.uid),["prevent"]),color:"orange-600"},{default:A(()=>[b("Submit Antibiotics")]),_:2},1032,["onClick"]),[[g,F(L.UPDATE,I.RESULT)&&ie(e.uid)]]),p(T(M(j),{key:"button",onClick:P(t=>me(e.uid),["prevent"]),color:"orange-600"},{default:A(()=>[b("Approve Antibiotics")]),_:2},1032,["onClick"]),[[g,F(L.UPDATE,I.RESULT)&&ce(e.uid)]])])])]))),128)),w.value?(u(),Re(M(K),{key:0,onClose:a[1]||(a[1]=e=>w.value=!1),contentWidth:"w-1/2"},{header:A(()=>[l("h3",null,[b("Search Panel for "),l("span",ct,_(f.value?.organism?.name),1)])]),body:A(()=>[l("form",{class:"",onSubmit:P(e=>({}),["prevent"])},[l("div",pt,[l("label",mt,[p(l("input",{"onUpdate:modelValue":a[0]||(a[0]=e=>E.value=e),onInput:te,class:"form-input mt-1 block w-full",placeholder:"Begin typing..."},null,544),[[Q,E.value]])]),l("div",yt,[l("table",_t,[(u(!0),i(c,null,m(Y.value,e=>(u(),i("tr",{key:e.uid},[l("td",vt,[l("div",ht,_(e.name),1)]),l("td",ft,[l("div",xt,_(e.antibiotics?.map(t=>t.name)?.join(", ")),1)]),l("td",bt,[l("button",{type:"button",onClick:t=>se(e),class:"px-2 py-1 border-sky-800 border text-sky-800 rounded-sm transition duration-300 hover:bg-sky-800 hover:text-white focus:outline-none"}," Appy Panel ",8,gt)])]))),128)),C.value?(u(),i("tr",At,[...Rt])):G("",!0),!C.value&&Y.value.length===0?(u(),i("tr",wt,[...St])):G("",!0)])])])],32)]),_:1})):G("",!0)],64)}}}),Yt=Ce(Vt,[["__file","/home/aurthurm/Documents/Development/felicity/felicity-lims/webapp/views/sample/_id/results/ASTResults.vue"]]);export{Yt as default};
