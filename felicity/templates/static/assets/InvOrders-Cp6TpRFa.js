import{Y as A,u as V,a0 as C,av as _,a7 as M,a8 as j,a9 as F,aa as z,ab as G,ac as Q,ad as K,ae as Y,af as J,aD as h,_ as W,c,o as b,a as l,K as r,C as y,F as p,z as d,I as f,D as T,H as k,aG as X,M as n,A as g,al as E}from"./index-OdhKCqIc.js";import{u as Z,I as $,E as ee,S as te}from"./inventory-CcBllciv.js";import{u as re}from"./setup-BcFG_bXr.js";import{i as le}from"./inventory.queries-Bx-sCQu8.js";import{E as de,a as ae,b as oe,c as ne,d as se}from"./EmptyTitle-aCQRDpx3.js";import{s as ie}from"./index-DJJ2wcNX.js";import ue from"./DataTable-DLBrhw2Z.js";import"./TooltipTrigger-BWIYwmnQ.js";import"./PopperContent-BfyCnGUj.js";import"./Input-BEm5S0CJ.js";import"./SelectValue-Ds0cfAgl.js";import"./useNonce-B4v0IDPb.js";import"./chevron-down-Dqf-ptA3.js";import"./useFocusGuards-Bjb6OG0k.js";import"./Spinner-Bl8RfjFA.js";const be=A({name:"StockOrders",__name:"InvOrders",setup(D,{expose:t}){t();const{withClientQuery:x,withClientMutation:e}=V(),w=re(),m=Z();m.fetchStockOrders({first:50,after:"",text:"",status:"preparation",sortBy:["-uid"]});const a=C(!1),s=_({order:{},products:[],departmentUid:""});async function O(o){const u=await x(le,{stockOrderUid:o},"stockOrderProductAll");s.products=(u??[]).map(S=>({...S,issue:S.quantity}))}const H=C([{name:"UID",value:"uid",sortable:!0,sortBy:"asc",defaultSort:!0,showInToggler:!1,hidden:!0},{name:"Order Number",value:"orderNumber",sortable:!1,sortBy:"asc",hidden:!1,customRender(o){return h("span",{innerHTML:o?.orderNumber,onClick:()=>{s.order=o,s.departmentUid=o?.department?.uid??"",O(o?.uid??""),a.value=!0}})}},{name:"Department",value:"department.name",sortable:!1,sortBy:"asc",hidden:!1},{name:"Orderer",value:"orderBy",sortable:!1,sortBy:"asc",hidden:!1,customRender(o){return h("span",{innerHTML:`${o?.orderBy?.firstName??"---"} ${o?.orderBy?.lastName??""}`})}},{name:"Issued By",value:"status",sortable:!1,sortBy:"asc",hidden:!1},{name:"Status",value:"status",sortable:!1,sortBy:"asc",hidden:!1}]),i=_({first:50,before:"",text:"",sortBy:["-uid"],filterAction:!1,status:"preparation"}),R=[{name:"All",value:""},{name:"Preparation",value:"preparation"},{name:"Submitted",value:"submitted"},{name:"Processed",value:"processed"}];function U(o){i.first=50,i.before="",i.text=o.filterText??"",i.status=o.filterStatus??i.status,i.filterAction=!0,m.fetchStockOrders(i)}function B(o){i.first=o.fetchCount??50,i.before=m.stockOrdersPaging?.pageInfo?.endCursor??"",i.text=o.filterText??"",i.status=o.filterStatus??i.status,i.filterAction=!1,m.fetchStockOrders(i)}const N=M(()=>`${m.stockOrders?.length??0} of ${m.stockOrdersPaging?.totalCount??0} orders`);function I(){const o=s.products.map(u=>({productUid:u.product?.uid,stockLotUid:u.stockLot?.uid,quantity:u?.issue,remarks:"issue stock"}));e($,{uid:s?.order?.uid,payload:o},"issueStockOrder").then(u=>{m.issueStockOrder(u),a.value=!1})}function q(o){s.products=s.products.filter(u=>u?.product?.uid!==o)}function L(){const o=s.products.map(u=>({productUid:u?.product?.uid,stockLotUid:u?.stockLot?.uid,quantity:u?.quantity,remarks:""}));e(ee,{uid:s.order.uid,payload:{orderProducts:o,departmentUid:s.departmentUid}},"updateStockOrder").then(u=>{m.updateStockOrder(u?.stockOrder),a.value=!1})}function P(){e(te,{uid:s.order.uid},"submitStockOrder").then(o=>{m.updateStockOrder(o),a.value=!1})}const v={withClientQuery:x,withClientMutation:e,setupStore:w,inventoryStore:m,openDrawer:a,selectedStockOrder:s,getOrderProducts:O,tableColumns:H,stockOrderParams:i,filterOptions:R,filterStockOrders:U,showMoreStockOrders:B,countNone:N,issueOrder:I,removeOrderProduct:q,updateOrder:L,submitOrder:P,Drawer:j,get Table(){return J},get TableBody(){return Y},get TableCell(){return K},get TableEmpty(){return Q},get TableHead(){return G},get TableHeader(){return z},get TableRow(){return F},get Empty(){return se},get EmptyContent(){return ne},get EmptyDescription(){return oe},get EmptyHeader(){return ae},get EmptyTitle(){return de},get shield(){return ie},DataTable:ue};return Object.defineProperty(v,"__isScriptSetup",{enumerable:!1,value:!0}),v}}),fe={class:"mt-2"},me={class:"mb-4 flex items-center justify-between gap-4"},ce=["value"],pe={class:"mb-4 mt-2 overflow-x-auto"},ge={class:"inline-block min-w-full overflow-hidden rounded-bl-lg rounded-br-lg bg-background px-2 pt-1 align-middle shadow shadow-dashboard"},ye=["onUpdate:modelValue"],ke=["onClick"],xe={class:"flex justify-start gap-x-4"},Te=["disabled"],we=["disabled"],Oe={class:"mb-4 mt-4 overflow-x-auto"},ve={class:"inline-block min-w-full overflow-hidden rounded-bl-lg rounded-br-lg bg-background px-2 pt-1 align-middle shadow shadow-dashboard"},Se=["onUpdate:modelValue"],Ce=["disabled"],_e={class:"mb-4 mt-4 overflow-x-auto"},he={class:"inline-block min-w-full overflow-hidden rounded-bl-lg rounded-br-lg bg-background px-2 pt-1 align-middle shadow shadow-dashboard"};function Ee(D,t,x,e,w,m){return b(),c("div",fe,[l(e.DataTable,{columns:e.tableColumns,data:e.inventoryStore.stockOrders,"toggle-columns":!1,loading:!1,paginable:!0,"page-meta":{fetchCount:10,hasNextPage:!1,countNone:e.countNone},searchable:!0,filterable:!0,"filter-meta":{defaultFilter:e.stockOrderParams.status,filters:e.filterOptions},selectable:!1,onOnSearch:e.filterStockOrders,onOnPaginate:e.showMoreStockOrders},null,8,["columns","data","page-meta","filter-meta"]),l(e.Drawer,{"content-width":"w-1/2",show:e.openDrawer,onClose:t[4]||(t[4]=a=>e.openDrawer=!1)},{header:r(()=>[n(" Order: "+f(e.selectedStockOrder?.order?.orderNumber),1)]),body:r(()=>[e.selectedStockOrder?.order?.status==="preparation"?(b(),c(p,{key:0},[d("div",null,"Status: "+f(e.selectedStockOrder?.order?.status),1),t[11]||(t[11]=d("hr",null,null,-1)),d("label",me,[t[5]||(t[5]=d("span",{class:"text-foreground"},"Department",-1)),T(d("select",{"onUpdate:modelValue":t[0]||(t[0]=a=>e.selectedStockOrder.departmentUid=a),class:"mt-1 block w-full rounded-md border border-input bg-background px-3 py-2 text-sm"},[(b(!0),c(p,null,k(e.setupStore.departments,a=>(b(),c("option",{key:a.uid,value:a.uid},f(a.name),9,ce))),128))],512),[[X,e.selectedStockOrder.departmentUid]])]),t[12]||(t[12]=d("hr",null,null,-1)),d("div",pe,[d("div",ge,[l(e.Table,{class:"min-w-full"},{default:r(()=>[l(e.TableHeader,null,{default:r(()=>[l(e.TableRow,null,{default:r(()=>[l(e.TableHead,{class:"border-b-2 border-border px-1 py-1 text-left leading-4 tracking-wider text-foreground"},{default:r(()=>[...t[6]||(t[6]=[n("Product",-1)])]),_:1}),l(e.TableHead,{class:"border-b-2 border-border px-1 py-1 text-left leading-4 tracking-wider text-foreground"},{default:r(()=>[...t[7]||(t[7]=[n("Lot",-1)])]),_:1}),l(e.TableHead,{class:"border-b-2 border-border px-1 py-1 text-left text-sm leading-4 tracking-wider text-foreground"},{default:r(()=>[...t[8]||(t[8]=[n("Qty",-1)])]),_:1}),l(e.TableHead,{class:"border-b-2 border-border px-1 py-1 text-left leading-4 tracking-wider text-foreground"})]),_:1})]),_:1}),l(e.TableBody,{class:"bg-background"},{default:r(()=>[e.selectedStockOrder.products.length===0?(b(),g(e.TableEmpty,{key:0,colspan:4},{default:r(()=>[l(e.Empty,{class:"border-0 bg-transparent p-0"},{default:r(()=>[l(e.EmptyContent,null,{default:r(()=>[l(e.EmptyHeader,null,{default:r(()=>[l(e.EmptyTitle,null,{default:r(()=>[...t[9]||(t[9]=[n("No products on this order",-1)])]),_:1}),l(e.EmptyDescription,null,{default:r(()=>[...t[10]||(t[10]=[n("Add products before finalizing the order.",-1)])]),_:1})]),_:1})]),_:1})]),_:1})]),_:1})):y("",!0),(b(!0),c(p,null,k(e.selectedStockOrder.products,a=>(b(),g(e.TableRow,{key:a?.product?.uid},{default:r(()=>[l(e.TableCell,null,{default:r(()=>[d("p",null,f(a?.product?.name),1)]),_:2},1024),l(e.TableCell,null,{default:r(()=>[d("p",null,f(a?.stockLot?.lotNumber)+" ("+f(a?.stockLot?.quantity)+")",1)]),_:2},1024),l(e.TableCell,{class:"px-1 py-1"},{default:r(()=>[T(d("input",{"onUpdate:modelValue":s=>a.quantity=s,type:"number",class:"rounded border border-input px-2 py-1",placeholder:""},null,8,ye),[[E,a.quantity,void 0,{number:!0}]])]),_:2},1024),l(e.TableCell,{class:"whitespace-nowrap px-1"},{default:r(()=>[d("button",{type:"button",class:"w-16 rounded-sm bg-primary px-2 py-1 leading-none text-primary-foreground",onClick:s=>e.removeOrderProduct(a?.product?.uid??"")}," Remove ",8,ke)]),_:2},1024)]),_:2},1024))),128))]),_:1})]),_:1})])]),t[13]||(t[13]=d("hr",null,null,-1)),t[14]||(t[14]=d("p",{class:"my-2 text-xs italic text-destructive"}," If you made any changes here please update order first before finalising else your changes wont be saved ",-1)),t[15]||(t[15]=d("hr",null,null,-1)),d("div",xe,[d("button",{type:"button",class:"mt-4 rounded-sm bg-primary px-2 py-1 leading-none text-primary-foreground disabled:cursor-not-allowed disabled:opacity-50",disabled:!e.shield.hasRights(e.shield.actions.ORDER,e.shield.objects.PRODUCT),onClick:t[1]||(t[1]=a=>e.updateOrder())}," Update ",8,Te),d("button",{type:"button",class:"mt-4 rounded-sm bg-primary px-2 py-1 leading-none text-primary-foreground disabled:cursor-not-allowed disabled:opacity-50",disabled:!e.shield.hasRights(e.shield.actions.ORDER,e.shield.objects.PRODUCT),onClick:t[2]||(t[2]=a=>e.submitOrder())}," Finalize ",8,we)])],64)):["pending","submitted"].includes(e.selectedStockOrder?.order?.status??"")?(b(),c(p,{key:1},[d("div",null,"Status: "+f(e.selectedStockOrder?.order?.status),1),t[23]||(t[23]=d("hr",null,null,-1)),d("div",Oe,[d("div",ve,[l(e.Table,{class:"min-w-full"},{default:r(()=>[l(e.TableHeader,null,{default:r(()=>[l(e.TableRow,null,{default:r(()=>[l(e.TableHead,{class:"border-b-2 border-border px-1 py-1 text-left leading-4 tracking-wider text-foreground"},{default:r(()=>[...t[16]||(t[16]=[n("Product",-1)])]),_:1}),l(e.TableHead,{class:"border-b-2 border-border px-1 py-1 text-left leading-4 tracking-wider text-foreground"},{default:r(()=>[...t[17]||(t[17]=[n("Lot",-1)])]),_:1}),l(e.TableHead,{class:"border-b-2 border-border px-1 py-1 text-left text-sm leading-4 tracking-wider text-foreground"},{default:r(()=>[...t[18]||(t[18]=[n("Available",-1)])]),_:1}),l(e.TableHead,{class:"border-b-2 border-border px-1 py-1 text-left text-sm leading-4 tracking-wider text-foreground"},{default:r(()=>[...t[19]||(t[19]=[n("Requested",-1)])]),_:1}),l(e.TableHead,{class:"border-b-2 border-border px-1 py-1 text-left text-sm leading-4 tracking-wider text-foreground"},{default:r(()=>[...t[20]||(t[20]=[n("Issue",-1)])]),_:1}),l(e.TableHead,{class:"border-b-2 border-border px-1 py-1 text-left leading-4 tracking-wider text-foreground"})]),_:1})]),_:1}),l(e.TableBody,{class:"bg-background"},{default:r(()=>[e.selectedStockOrder.products.length===0?(b(),g(e.TableEmpty,{key:0,colspan:6},{default:r(()=>[l(e.Empty,{class:"border-0 bg-transparent p-0"},{default:r(()=>[l(e.EmptyContent,null,{default:r(()=>[l(e.EmptyHeader,null,{default:r(()=>[l(e.EmptyTitle,null,{default:r(()=>[...t[21]||(t[21]=[n("No products on this order",-1)])]),_:1}),l(e.EmptyDescription,null,{default:r(()=>[...t[22]||(t[22]=[n("Products will appear here once the order is submitted.",-1)])]),_:1})]),_:1})]),_:1})]),_:1})]),_:1})):y("",!0),(b(!0),c(p,null,k(e.selectedStockOrder.products,a=>(b(),g(e.TableRow,{key:a.uid},{default:r(()=>[l(e.TableCell,null,{default:r(()=>[d("p",null,f(a?.product?.name),1)]),_:2},1024),l(e.TableCell,null,{default:r(()=>[d("p",null,f(a?.stockLot?.lotNumber),1)]),_:2},1024),l(e.TableCell,null,{default:r(()=>[d("p",null,f(a?.stockLot?.quantity),1)]),_:2},1024),l(e.TableCell,null,{default:r(()=>[d("p",null,f(a?.quantity),1)]),_:2},1024),l(e.TableCell,{class:"whitespace-nowrap px-1 py-1"},{default:r(()=>[T(d("input",{"onUpdate:modelValue":s=>a.issue=s,type:"number",class:"rounded border border-input px-2 py-1",placeholder:""},null,8,Se),[[E,a.issue,void 0,{number:!0}]])]),_:2},1024)]),_:2},1024))),128))]),_:1})]),_:1})])]),t[24]||(t[24]=d("hr",null,null,-1)),d("button",{type:"button",class:"mt-4 rounded-sm bg-primary px-2 py-1 leading-none text-primary-foreground disabled:cursor-not-allowed disabled:opacity-50",disabled:!e.shield.hasRights(e.shield.actions.ISSUE,e.shield.objects.PRODUCT),onClick:t[3]||(t[3]=a=>e.issueOrder())}," Issue Order ",8,Ce)],64)):["processed"].includes(e.selectedStockOrder?.order?.status??"")?(b(),c(p,{key:2},[d("div",null,"Status: "+f(e.selectedStockOrder?.order?.status),1),t[30]||(t[30]=d("hr",null,null,-1)),t[31]||(t[31]=d("h4",null,"Request Details",-1)),t[32]||(t[32]=d("hr",null,null,-1)),d("div",_e,[d("div",he,[l(e.Table,{class:"min-w-full"},{default:r(()=>[l(e.TableHeader,null,{default:r(()=>[l(e.TableRow,null,{default:r(()=>[l(e.TableHead,{class:"border-b-2 border-border px-1 py-1 text-left leading-4 tracking-wider text-foreground"},{default:r(()=>[...t[25]||(t[25]=[n("Product Name",-1)])]),_:1}),l(e.TableHead,{class:"border-b-2 border-border px-1 py-1 text-left text-sm leading-4 tracking-wider text-foreground"},{default:r(()=>[...t[26]||(t[26]=[n("Available",-1)])]),_:1}),l(e.TableHead,{class:"border-b-2 border-border px-1 py-1 text-left text-sm leading-4 tracking-wider text-foreground"},{default:r(()=>[...t[27]||(t[27]=[n("Requested",-1)])]),_:1}),l(e.TableHead,{class:"border-b-2 border-border px-1 py-1 text-left leading-4 tracking-wider text-foreground"})]),_:1})]),_:1}),l(e.TableBody,{class:"bg-background"},{default:r(()=>[e.selectedStockOrder.products.length===0?(b(),g(e.TableEmpty,{key:0,colspan:4},{default:r(()=>[l(e.Empty,{class:"border-0 bg-transparent p-0"},{default:r(()=>[l(e.EmptyContent,null,{default:r(()=>[l(e.EmptyHeader,null,{default:r(()=>[l(e.EmptyTitle,null,{default:r(()=>[...t[28]||(t[28]=[n("No products on this order",-1)])]),_:1}),l(e.EmptyDescription,null,{default:r(()=>[...t[29]||(t[29]=[n("There are no products listed for this request.",-1)])]),_:1})]),_:1})]),_:1})]),_:1})]),_:1})):y("",!0),(b(!0),c(p,null,k(e.selectedStockOrder.products,a=>(b(),g(e.TableRow,{key:a.uid},{default:r(()=>[l(e.TableCell,null,{default:r(()=>[d("p",null,f(a?.product?.name),1)]),_:2},1024),l(e.TableCell),l(e.TableCell,null,{default:r(()=>[d("p",null,f(a.quantity),1)]),_:2},1024)]),_:2},1024))),128))]),_:1})]),_:1})])]),t[33]||(t[33]=d("hr",null,null,-1))],64)):y("",!0)]),_:1},8,["show"])])}const ze=W(be,[["render",Ee],["__file","/home/administrator/Documents/Development/beak-insights/felicity/felicity-lims/webapp/views/inventory/InvOrders.vue"]]);export{ze as default};
