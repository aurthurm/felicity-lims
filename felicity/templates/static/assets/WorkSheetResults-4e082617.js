import{S as z,bd as fe,w as ge,_ as ve,z as ke,t as xe,a2 as we,D as Ue,ah as Re}from"./shipment-53265c2d.js";import{f as Ce,G as Se,r as u,d as Ae,c as Ee,v as Te,aj as Y,h as n,k as a,ag as r,x as e,al as I,i as G,u as d,F as f,ak as g,D as i,B as Ve,A as J,y as V,s as Q,j as De,_ as We}from"./_plugin-vue_export-helper-dacf3d65.js";import{u as Be}from"./analysis-47167c72.js";import{h as x,o as w,a as U}from"./constants-743d82a1.js";import{e as K,d as R,a as y,b,v as Ne}from"./runtime-dom.esm-bundler-98433118.js";function Oe(){const{withClientMutation:M}=ge();return{unAssignSamples:async v=>{try{z.fire({title:"Are you sure?",text:"You want to Un-Assign these analyses",icon:"warning",showCancelButton:!0,confirmButtonColor:"#3085d6",cancelButtonColor:"#d33",confirmButtonText:"Yes, Un-Assign now!",cancelButtonText:"No, cancel UnAssign!"}).then(async c=>{c.isConfirmed&&(await M(fe,v,"updateWorksheet").then(C=>{}),z.fire("Its Happening!","Selected analyses have been UnAssigned.","success").then(C=>location.reload()))})}catch{}}}}const $e={class:""},Ie=e("hr",{class:"mt-4"},null,-1),Ke={class:"flex justify-between items-center"},Me={for:"toggle",class:"text-medium text-gray-700 my-4"},je={class:"relative inline-block w-10 mr-2 align-middle select-none transition duration-200 ease-in"},Pe=e("label",{for:"toggle",class:"toggle-label block overflow-hidden h-6 rounded-full bg-gray-300 cursor-pointer"},null,-1),He={action:"post",class:"p-1"},qe={class:"flex justify-start items-center mb-4"},Fe={class:"flex justify-between items-center"},Le=e("span",{class:"text-gray-700 mr-2"},"Analyst",-1),ze=["value"],Ye={class:"flex justify-between items-center ml-4"},Ge=e("span",{class:"text-gray-700 mr-2"},"Instrument",-1),Je=["value"],Qe={class:"flex justify-between items-center ml-4"},Xe=e("span",{class:"text-gray-700 mr-2"},"Method",-1),Ze=["value"],et={class:"ml-6 mt-2"},tt=e("hr",{class:"mb-4"},null,-1),st={class:"overflow-x-auto"},ot={class:"align-middle inline-block min-w-full shadow overflow-hidden bg-white shadow-dashboard px-2 pt-1 rounded-bl-lg rounded-br-lg"},nt={class:"min-w-full"},at={class:"px-1 py-1 border-b-2 border-gray-300 text-left leading-4 text-gray-800 tracking-wider"},lt=e("th",{class:"px-1 py-1 border-b-2 border-gray-300 text-left leading-4 text-gray-800 tracking-wider"},null,-1),rt=e("th",{class:"px-1 py-1 border-b-2 border-gray-300 text-left leading-4 text-gray-800 tracking-wider"}," Sample ID ",-1),it=e("th",{class:"px-1 py-1 border-b-2 border-gray-300 text-left text-sm leading-4 text-gray-800 tracking-wider"}," Analysis/Test ",-1),dt=e("th",{class:"px-1 py-1 border-b-2 border-gray-300 text-left text-sm leading-4 text-gray-800 tracking-wider"}," Instrument ",-1),ut=e("th",{class:"px-1 py-1 border-b-2 border-gray-300 text-left text-sm leading-4 text-gray-800 tracking-wider"}," Method ",-1),ct=e("th",{class:"px-1 py-1 border-b-2 border-gray-300 text-left text-sm leading-4 text-gray-800 tracking-wider"}," Interim ",-1),pt=e("th",{class:"px-1 py-1 border-b-2 border-gray-300 text-left text-sm leading-4 text-gray-800 tracking-wider"}," Result ",-1),ht=e("th",{class:"px-1 py-1 border-b-2 border-gray-300 text-left text-sm leading-4 text-gray-800 tracking-wider"}," Unit ",-1),mt=e("th",{class:"px-1 py-1 border-b-2 border-gray-300 text-left text-sm leading-4 text-gray-800 tracking-wider"}," Status ",-1),yt={class:"bg-white"},bt=["onUpdate:modelValue","disabled"],_t={class:"px-1 py-1 whitespace-no-wrap border-b border-gray-500"},ft=e("i",{class:"fa fa-star"},null,-1),gt=[ft],vt={class:"px-1 py-1 whitespace-no-wrap border-b border-gray-500"},kt={class:"text-sm leading-5 text-gray-800 font-semibold"},xt={key:1},wt={key:0},Ut={class:"px-1 py-1 whitespace-no-wrap border-b border-gray-500"},Rt={class:"px-1 py-1 whitespace-no-wrap border-b border-gray-500"},Ct={class:"px-1 py-1 whitespace-no-wrap border-b border-gray-500"},St={class:"px-1 py-1 whitespace-no-wrap border-b border-gray-500"},At={key:0,class:"text-sm leading-5 text-sky-800"},Et={key:1,class:"block col-span-2 mb-2"},Tt=["onUpdate:modelValue","onChange"],Vt=e("option",{value:""},null,-1),Dt=["value"],Wt={class:"px-1 py-1 whitespace-no-wrap border-b border-gray-500"},Bt={key:0},Nt={key:1,class:"block"},Ot=["onUpdate:modelValue","onKeyup"],$t={key:2,class:"block col-span-2 mb-2"},It=["onUpdate:modelValue","onChange"],Kt=e("option",{value:""},null,-1),Mt=["value"],jt={class:"px-1 py-1 whitespace-no-wrap border-b border-gray-500"},Pt={class:"px-1 py-1 whitespace-no-wrap border-b border-gray-500"},Ht={type:"button",class:"bg-sky-800 text-white py-1 px-2 rounded-sm leading-none"},qt={class:"my-4"},Ft=Ce({__name:"WorkSheetResults",setup(M){const j=Se(()=>ve(()=>import("./Button-ea0a63f5.js"),["assets/Button-ea0a63f5.js","assets/_plugin-vue_export-helper-dacf3d65.js"])),v=ke(),c=xe(),C=we(),P=Ue();let D=u(!1),W=u(!1),B=u(!1),N=u(!1),O=u(!1),p=u(!1),k=u(!1),h=Ae(()=>v.getWorkSheet);const H=()=>{v.fetchWorksheetByUid(P.params.workSheetUid)};C.fetchUsers({}),c.fetchInstruments(),c.fetchMethods();const m=Ee({analystUid:void 0,instrumentUid:void 0,methodUid:void 0}),S=u(!1),X=()=>{S.value=!0,v.updateWorksheet({worksheetUid:P.params.workSheetUid,...m}).then(()=>{S.value=!1,H()})};function Z(){return h.value?.analysisResults?.every(o=>o.checked===!0)}function $(){let o=[];return h.value?.analysisResults?.forEach(s=>{s.checked&&o.push(s)}),o}function ee(){Z()?p.value=!0:p.value=!1,T()}function A(o){if(q(o)){F(o);return}o.checked=!0,T()}function q(o){return["retracted","approved"].includes(o.status)}function F(o){o.checked=!1,T()}function te(){h?.value?.analysisResults?.forEach(o=>p.value?A(o):F(o)),T()}function se(o){o.editable=!0}function L(o){return o.status!=="pending"?!1:o?.editable||Re(o?.result)?(se(o),!0):!1}function oe(){let o=$(),s=[];return o?.forEach(_=>s.push({uid:_.uid,result:_.result})),s}function E(){const o=$();let s=[];return o?.forEach(_=>s.push(_.uid)),s}function ne(o){switch(o?.status){case"retracted":return"bg-gray-300 text-sm italic text-gray-500";case"pending":return o?.retest===!0?"bg-sky-800 text-sm leading-5 text-sky-800":"";case"resulted":return o?.retest===!0?"bg-sky-800 text-sm leading-5 text-sky-800":"";case"approved":return o?.retest===!0?"bg-sky-800 text-sm leading-5 text-sky-800":"";default:return"text-sm leading-5 text-sky-800"}}function T(){D.value=!1,O.value=!1,W.value=!1,B.value=!1,N.value=!1;const o=$();o.length!==0&&(o.every(s=>s.status==="pending")&&(D.value=!0,O.value=!0),o.every(s=>s.status==="resulted")&&(W.value=!0,B.value=!0,N.value=!0))}const{submitResults:ae,approveResults:le,retractResults:re,retestResults:ie}=Be(),{unAssignSamples:de}=Oe(),ue=()=>de(E()),ce=()=>ae(oe(),"worksheet",h.value?.uid),pe=()=>le(E(),"worksheet",h.value?.uid),he=()=>re(E()),me=()=>ie(E());return(o,s)=>{const _=Te("router-link"),ye=Y("motion-slide-left"),be=Y("motion-slide-right");return n(),a("div",$e,[Ie,r((n(),a("div",Ke,[e("label",Me,[I("More Sample Detail "),e("div",je,[r(e("input",{type:"checkbox",name:"toggle",id:"toggle","onUpdate:modelValue":s[0]||(s[0]=t=>G(k)?k.value=t:k=t),class:"toggle-checkbox absolute block w-6 h-6 rounded-full bg-white border-4 appearance-none cursor-pointer outline-none"},null,512),[[K,d(k)]]),Pe])]),r(e("form",He,[e("div",qe,[e("label",Fe,[Le,r(e("select",{name:"instrument_uid","onUpdate:modelValue":s[1]||(s[1]=t=>m.analystUid=t),class:"form-input mt-1 block w-full py-1"},[(n(!0),a(f,null,g(d(C).users,t=>(n(),a("option",{key:t.uid,value:t.uid},i(t.firstName)+" "+i(t.lastName),9,ze))),128))],512),[[R,m.analystUid]])]),e("label",Ye,[Ge,r(e("select",{name:"instrument_uid","onUpdate:modelValue":s[2]||(s[2]=t=>m.instrumentUid=t),class:"form-input mt-1 block w-full py-1"},[(n(!0),a(f,null,g(d(c).instruments,t=>(n(),a("option",{key:t.uid,value:t.uid},i(t.name),9,Je))),128))],512),[[R,m.instrumentUid]])]),e("label",Qe,[Xe,r(e("select",{name:"method_uid","onUpdate:modelValue":s[3]||(s[3]=t=>m.methodUid=t),class:"form-input mt-1 block w-full py-1"},[(n(!0),a(f,null,g(d(c).methods,t=>(n(),a("option",{key:t.uid,value:t.uid},i(t.name),9,Ze))),128))],512),[[R,m.methodUid]])]),e("div",et,[Ve(d(j),{onClick:s[4]||(s[4]=y(t=>X(),["prevent"])),color:"sky-800",class:"p-1"},{default:J(()=>[I("Apply")]),_:1})])])],512),[[b,!S.value]]),r(e("p",null,"updating ...",512),[[b,S.value]]),e("div",null,[e("button",{onClick:s[5]||(s[5]=y(t=>H(),["prevent"])),class:"px-1 py-1 mr-2 border-sky-800 border text-sky-800rounded-smtransition duration-300 hover:bg-sky-800 hover:text-white focus:outline-none"}," Refresh ")])])),[[ye]]),tt,V(" Sampe Table View "),e("div",st,[e("div",ot,[e("table",nt,[e("thead",null,[e("tr",null,[e("th",at,[r(e("input",{type:"checkbox",class:"",onChange:s[6]||(s[6]=t=>te()),"onUpdate:modelValue":s[7]||(s[7]=t=>G(p)?p.value=t:p=t)},null,544),[[K,d(p)]])]),lt,rt,it,dt,ut,ct,pt,ht,mt,V(' <th class="px-1 py-1 border-b-2 border-gray-300"></th> ')])]),e("tbody",yt,[(n(!0),a(f,null,g(d(h)?.analysisResults,t=>r((n(),a("tr",{key:t.uid,class:Q([ne(t)])},[e("td",null,[r(e("input",{type:"checkbox",class:"","onUpdate:modelValue":l=>t.checked=l,onChange:s[8]||(s[8]=l=>ee()),disabled:q(t)},null,40,bt),[[K,t.checked]])]),e("td",_t,[t?.sample?.priority>0?(n(),a("span",{key:0,class:Q(["font-small",{"text-orange-600":d(h)?.priority>1}])},gt,2)):V("v-if",!0)]),e("td",vt,[e("div",kt,[t?.sample?.analysisRequest?.patient?.uid?(n(),De(_,{key:0,to:{name:"sample-detail",params:{patientUid:t?.sample?.analysisRequest?.patient?.uid,sampleUid:t?.sample?.uid}}},{default:J(()=>[I(i(t?.sample?.sampleId),1)]),_:2},1032,["to"])):(n(),a("div",xt,i(t?.sample?.sampleId),1))]),d(k)?(n(),a("span",wt,[e("span",null,i(t?.sample?.qcLevel?.level),1),e("div",null,i(t?.sample?.analysisRequest?.patient?.firstName)+" "+i(t?.sample?.analysisRequest?.patient?.lastName),1),e("div",null,i(t?.sample?.analysisRequest?.client?.name),1)])):V("v-if",!0)]),e("td",Ut,[e("div",null,i(t?.analysis?.name),1)]),e("td",Rt,[e("div",null,i(t?.instrument?.name||"None"),1)]),e("td",Ct,[e("div",null,i(t?.method?.name||"None"),1)]),e("td",St,[!L(t)||(t?.analysis?.interims?.length??0)===0?(n(),a("div",At," --- ")):(n(),a("label",Et,[r(e("select",{class:"form-input mt-1 block w-full","onUpdate:modelValue":l=>t.result=l,onChange:l=>A(t)},[Vt,(n(!0),a(f,null,g(t?.analysis?.interims,(l,_e)=>(n(),a("option",{key:l.key,value:l.value},i(l.value),9,Dt))),128))],40,Tt),[[R,t.result]])]))]),e("td",Wt,[L(t)?t?.analysis?.resultOptions?.length===0?(n(),a("label",Nt,[r(e("input",{class:"form-input mt-1 block w-full","onUpdate:modelValue":l=>t.result=l,onKeyup:l=>A(t)},null,40,Ot),[[Ne,t.result]])])):(n(),a("label",$t,[r(e("select",{class:"form-input mt-1 block w-full","onUpdate:modelValue":l=>t.result=l,onChange:l=>A(t)},[Kt,(n(!0),a(f,null,g(t?.analysis?.resultOptions,(l,_e)=>(n(),a("option",{key:l.optionKey,value:l.value},i(l.value),9,Mt))),128))],40,It),[[R,t.result]])])):(n(),a("div",Bt,i(t?.result),1))]),e("td",jt,[e("div",null,i(t?.analysis?.unit?.name||"---"),1)]),e("td",Pt,[e("button",Ht,i(t?.status||"unknown"),1)])],2)),[[be]])),128))])])])]),e("section",qt,[r(e("button",{onClick:s[9]||(s[9]=y(t=>ue(),["prevent"])),class:"px-2 py-1 mr-2 border-sky-800 border text-sky-800rounded-smtransition duration-300 hover:bg-sky-800 hover:text-white focus:outline-none"}," Un Assign ",512),[[b,x(U.CREATE,w.WORKSHEET)&&d(O)]]),r(e("button",{onClick:s[10]||(s[10]=y(t=>ce(),["prevent"])),class:"px-2 py-1 mr-2 border-sky-800 border text-sky-800rounded-smtransition duration-300 hover:bg-sky-800 hover:text-white focus:outline-none"}," Submit ",512),[[b,x(U.UPDATE,w.WORKSHEET)&&d(D)]]),r(e("button",{onClick:s[11]||(s[11]=y(t=>he(),["prevent"])),class:"px-2 py-1 mr-2 border-sky-800 border text-sky-800rounded-smtransition duration-300 hover:bg-sky-800 hover:text-white focus:outline-none"}," Retract ",512),[[b,x(U.UPDATE,w.WORKSHEET)&&d(W)]]),r(e("button",{onClick:s[12]||(s[12]=y(t=>pe(),["prevent"])),class:"px-2 py-1 mr-2 border-sky-800 border text-sky-800rounded-smtransition duration-300 hover:bg-sky-800 hover:text-white focus:outline-none"}," Approve ",512),[[b,x(U.UPDATE,w.WORKSHEET)&&d(B)]]),r(e("button",{onClick:s[13]||(s[13]=y(t=>me(),["prevent"])),class:"px-2 py-1 mr-2 border-sky-800 border text-sky-800rounded-smtransition duration-300 hover:bg-sky-800 hover:text-white focus:outline-none"}," Retest ",512),[[b,x(U.UPDATE,w.WORKSHEET)&&d(N)]])])])}}}),Qt=We(Ft,[["__file","/home/aurthurm/Development/felicity-lims/webapp/views/worksheet/_id/WorkSheetResults.vue"]]);export{Qt as default};
