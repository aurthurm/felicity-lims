const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/CommentSystem-D0DTCQ_j.js","assets/index-OdhKCqIc.js","assets/index-DD18L2yL.css","assets/grind.queries-D_H4x9UG.js","assets/Spinner-Bl8RfjFA.js","assets/EmptyTitle-aCQRDpx3.js","assets/index-DVOOl0Kv.js","assets/ErrandFile-_mQg_a8R.js","assets/ErrandFile-UJ1mDsT4.css","assets/ErrandMilestone-vtNmS2Ml.js","assets/index-tFVefQDg.js","assets/vue-multiselect.esm-Cvm3ZCjW.js","assets/ErrandMilestone-TsdP9GGb.css"])))=>i.map(i=>d[i]);
import{Y as he,a0 as s,ah as _e,ag as ke,a7 as z,u as De,U as we,bn as Q,$ as Ee,aN as Ue,a5 as C,a6 as B,bo as Te,bl as Ve,_ as Me,r as J,c as u,C as p,o as c,z as t,D as W,a as d,I as m,al as Ce,J as Be,A as Se,E as Ae,L as Le,N as S,K as q}from"./index-OdhKCqIc.js";import{p as X,f as A}from"./index-CXV6PIcj.js";import{a as Pe,b as Ie,c as He,d as Re,e as Ye}from"./grind.queries-D_H4x9UG.js";import{A as Ne,a as Ge,b as Fe,B as je,c as Ke,E as Oe,H as ze,I as Qe,d as Je,e as We,L as qe,P as Xe,S as Ze,T as $e,f as et,U as tt,g as ot,C as rt}from"./index-BQ5jAWaE.js";import{Multiselect as at}from"./vue-multiselect.esm-Cvm3ZCjW.js";import{r as nt}from"./ArrowLeftIcon-DStHNGQt.js";const st=he({__name:"ErrandDetail",setup(Z,{expose:o}){o();const L=C(()=>B(()=>import("./CommentSystem-D0DTCQ_j.js"),__vite__mapDeps([0,1,2,3,4,5,6]))),e=C(()=>B(()=>import("./ErrandFile-_mQg_a8R.js"),__vite__mapDeps([7,1,2,3,5,8]))),P=C(()=>B(()=>import("./ErrandMilestone-vtNmS2Ml.js"),__vite__mapDeps([9,1,2,3,10,11,12]))),{alert:_}=Ue(),v=s(!1),y=s(null),a=s(rt);function g(){y.value={toolbar:{items:["undo","redo","|","heading","|","bold","italic","underline","|","link","insertTable","blockQuote","|","bulletedList","numberedList","todoList","outdent","indent"],shouldNotGroupWhenFull:!1},plugins:[Ne,Ge,Fe,je,Ke,Oe,ze,Qe,Je,We,qe,Xe,Ze,$e,et,tt,ot],heading:{options:[{model:"paragraph",title:"Paragraph",class:"ck-heading_paragraph"},{model:"heading1",view:"h1",title:"Heading 1",class:"ck-heading_heading1"},{model:"heading2",view:"h2",title:"Heading 2",class:"ck-heading_heading2"},{model:"heading3",view:"h3",title:"Heading 3",class:"ck-heading_heading3"},{model:"heading4",view:"h4",title:"Heading 4",class:"ck-heading_heading4"},{model:"heading5",view:"h5",title:"Heading 5",class:"ck-heading_heading5"},{model:"heading6",view:"h6",title:"Heading 6",class:"ck-heading_heading6"}]},placeholder:"Begin typing..."},v.value=!0}_e(()=>{g(),x(),Y(),G(),F()});const k=s("discussions"),D=ke(),w=z(()=>D.params.errandUid),I=z(()=>D.params.boardUid);let i=s();const{withClientQuery:b,withClientMutation:E}=De();function x(){b(Pe,{uid:w.value},"grindErrandByUid").then(r=>{i.value=r;const n=X(i.value.startDate,!0)??new Date,f=X(i.value.endDate,!0)??new Date(new Date().setDate(n.getDate()+7));H.value=[n,f]})}function l(r){E(Re,{uid:w.value,payload:r},"updateGrindErrand").then(()=>x())}const U=s(!1),T=s(null),$=()=>{U.value=!0,Te(()=>{T.value?.focus(),T.value?.select()})},ee=()=>{U.value=!1,l({title:i.value?.title})},h=s(!1),V=s(""),te=()=>{h.value=!0,V.value=i.value?.description??""},oe=()=>{h.value=!1,l({description:i.value?.description})},re=()=>{i.value.description=V.value,h.value=!1},H=s(),ae=r=>{const n=r[0]?.getDate(),f=r[0]?.getMonth()+1,be=r[0]?.getFullYear(),ve=r[1]?.getDate(),ye=r[1]?.getMonth()+1,xe=r[1]?.getFullYear();return`${n}/${f}/${be} - ${ve}/${ye}/${xe}`},ne=r=>{if(r.length!==2){_({title:"Invalid Date Range",description:"Please select a valid start and end date.",confirmText:"OK",variant:"default"});return}l({startDate:A(r[0],"YYYY-MM-DD HH:mm"),endDate:A(r[1],"YYYY-MM-DD HH:mm")})},R=s([]);function Y(){b(Ie,{boardUid:I.value},"grindPostersByBoard").then(r=>{R.value=r.filter(n=>n.uid!==i.value?.posterUid)})}function se(r){l({posterUid:r.uid})}const N=s();function G(){b(we,{first:100},"userAll").then(r=>{N.value=r.items})}function ie({firstName:r,lastName:n}){return`${r} ${n}`}function de(r){l({assigneeUid:r.uid})}function le(r){l({reporterUid:r.uid})}function ce(r){l({members:r.map(n=>n.uid)})}const ue=["Low","Normal","High","Critical"];function me(r){l({priority:r})}const M=s([]);function F(){b(He,{category:Q.Project},"grindStampByCategory").then(r=>{M.value=r})}function j(r){l({stamps:r?.map(n=>n.uid)})}const ge=r=>{E(Ye,{payload:{title:r,category:Q.Project}},"createGrindStamp").then(n=>{if(n.uid){M.value.push(n);const f=i.value?.stamps??[];f.push(n),j(f)}})},fe=()=>x(),K=Ee();function pe(){K.back()}const O={ErrandDiscussion:L,ErrandFile:e,ErrandMilestone:P,alert:_,isLayoutReady:v,config:y,editor:a,initCKEditor:g,activeTab:k,route:D,errandUid:w,boardUid:I,get errand(){return i},set errand(r){i=r},withClientQuery:b,withClientMutation:E,getErrand:x,updateErrand:l,editingTitle:U,titleInput:T,startEditingTitle:$,endEditingTitle:ee,editingBody:h,originalDescription:V,startEditingBody:te,saveDescription:oe,cancelEditing:re,dateRange:H,rangeFormat:ae,handleDate:ne,posters:R,getPosters:Y,updateStatus:se,users:N,getUsers:G,customLabel:ie,updateAssignee:de,updateReporter:le,updateMembers:ce,priorities:ue,updatePriority:me,stamps:M,getStamps:F,updateStamps:j,addStamp:ge,handleMilestoneUpdated:fe,router:K,goBack:pe,get formatDate(){return A},get getUserInitials(){return Ve},get Multiselect(){return at},get ArrowLeftIcon(){return nt}};return Object.defineProperty(O,"__isScriptSetup",{enumerable:!1,value:!0}),O}}),it={key:0,class:"bg-background rounded-lg shadow-sm border border-border"},dt={class:"flex flex-col md:flex-row"},lt={class:"flex-1 p-6 border-r border-border"},ct={class:"space-y-6 pb-6 border-b border-border"},ut={class:"flex justify-between items-center"},mt={class:"relative w-full"},gt={class:"flex items-center space-x-2 text-sm text-muted-foreground"},ft={class:"h-8 w-8 rounded-full bg-muted flex items-center justify-center text-destructive font-medium"},pt={class:"font-medium text-foreground"},bt=["innerHTML"],vt={key:1,class:"space-y-4"},yt={class:"prose max-w-none"},xt={class:"editor-container editor-container_balloon-editor",ref:"editorContainerElement"},ht={class:"editor-container__editor"},_t={ref:"editorElement"},kt={class:"flex items-center space-x-3 mt-6"},Dt={class:"flex-1 h-2 bg-muted rounded-full overflow-hidden"},wt={class:"text-sm font-medium text-muted-foreground"},Et={class:"border-b border-border mt-6"},Ut={class:"flex space-x-1"},Tt={class:"py-6"},Vt={key:0,class:"space-y-6"},Mt={key:1,class:"space-y-6"},Ct={key:2,class:"space-y-6"},Bt={class:"w-full md:w-80 p-6 border-l border-border"},St={class:"space-y-8"},At={class:"space-y-2"},Lt={class:"space-y-2"},Pt={class:"space-y-2"},It={class:"space-y-2"},Ht={class:"space-y-2"},Rt={class:"multiselect-tag bg-primary/10 text-primary px-2 py-1 rounded-md text-sm flex items-center space-x-1 hover:bg-primary/20 transition-colors duration-200"},Yt=["onClick"],Nt={class:"space-y-2"},Gt={class:"space-y-2"},Ft={class:"multiselect-tag bg-primary/10 text-primary px-2 py-1 rounded-md text-sm flex items-center space-x-1 hover:bg-primary/20 transition-colors duration-200"},jt=["onClick"];function Kt(Z,o,L,e,P,_){const v=J("ckeditor"),y=J("VueDatePicker");return e.errand?(c(),u("div",it,[t("div",dt,[t("div",lt,[t("div",ct,[t("div",ut,[t("div",mt,[t("button",{onClick:e.goBack,class:"absolute -left-2 -top-2 p-1 text-muted-foreground hover:text-foreground transition-colors duration-200"},[d(e.ArrowLeftIcon,{class:"w-5 h-5"})]),e.editingTitle?W((c(),u("input",{key:1,type:"text","onUpdate:modelValue":o[0]||(o[0]=a=>e.errand.title=a),onBlur:e.endEditingTitle,onKeyup:Be(e.endEditingTitle,["enter"]),ref:"titleInput",class:"text-2xl font-semibold text-foreground w-full px-3 py-2 border border-border rounded-md shadow-sm focus:outline-none focus:ring-2 focus:ring-primary focus:border-primary bg-background"},null,544)),[[Ce,e.errand.title]]):(c(),u("h1",{key:0,onClick:e.startEditingTitle,class:"text-3xl font-bold text-foreground cursor-pointer hover:bg-muted rounded px-2 py-1 transition-colors duration-200"},m(e.errand.title),1))])]),t("div",gt,[t("div",ft,m(e.getUserInitials(e.errand.createdBy?.firstName,e.errand.createdBy?.lastName)),1),o[12]||(o[12]=t("span",null,"by",-1)),t("span",pt,m(e.errand.createdBy?.firstName)+" "+m(e.errand.createdBy?.lastName),1),t("span",null,"on "+m(e.formatDate(e.errand.createdAt,"D MMMM YYYY")),1)]),e.editingBody?(c(),u("div",vt,[t("div",yt,[t("div",xt,[t("div",ht,[t("div",_t,[e.isLayoutReady?(c(),Se(v,{key:0,modelValue:e.errand.description,"onUpdate:modelValue":o[1]||(o[1]=a=>e.errand.description=a),editor:e.editor,config:e.config,"tag-name":"textarea",class:"ck-editor"},null,8,["modelValue","editor","config"])):p("",!0)],512)])],512)]),t("div",{class:"flex space-x-3"},[t("button",{onClick:e.saveDescription,class:"px-4 py-2 text-sm font-medium text-primary-foreground bg-primary border border-transparent rounded-md shadow-sm hover:bg-primary/90 focus:outline-none focus:ring-2 focus:ring-primary focus:ring-offset-2 transition-colors duration-200"}," Save "),t("button",{onClick:e.cancelEditing,class:"px-4 py-2 text-sm font-medium text-foreground bg-background border border-border rounded-md shadow-sm hover:bg-muted focus:outline-none focus:ring-2 focus:ring-primary focus:ring-offset-2 transition-colors duration-200"}," Cancel ")])])):(c(),u("div",{key:0,class:"prose max-w-none",onClick:e.startEditingBody},[e.errand.description?(c(),u("article",{key:0,class:"text-lg text-foreground",innerHTML:e.errand.description},null,8,bt)):p("",!0)]))]),W(t("div",kt,[t("div",Dt,[t("div",{class:"h-full bg-success rounded-full transition-all duration-300",style:Le(`width: ${e.errand?.milestonesAt}%`)},null,4)]),t("span",wt,m(e.errand?.milestonesAt)+"%",1)],512),[[Ae,e.errand?.milestonesAt]]),t("div",Et,[t("div",Ut,[t("button",{onClick:o[2]||(o[2]=a=>e.activeTab="discussions"),class:S(["py-3 px-4 text-sm font-medium border-b-2 transition-colors duration-200 focus:outline-none",e.activeTab==="discussions"?"border-primary text-primary":"border-transparent text-muted-foreground hover:text-foreground"])}," Discussions ",2),t("button",{onClick:o[3]||(o[3]=a=>e.activeTab="milestones"),class:S(["py-3 px-4 text-sm font-medium border-b-2 transition-colors duration-200 focus:outline-none",e.activeTab==="milestones"?"border-primary text-primary":"border-transparent text-muted-foreground hover:text-foreground"])}," Milestones ",2),t("button",{onClick:o[4]||(o[4]=a=>e.activeTab="files"),class:S(["py-3 px-4 text-sm font-medium border-b-2 transition-colors duration-200 focus:outline-none",e.activeTab==="files"?"border-primary text-primary":"border-transparent text-muted-foreground hover:text-foreground"])}," Files ",2)])]),t("div",Tt,[e.activeTab==="discussions"?(c(),u("div",Vt,[d(e.ErrandDiscussion,{errandUid:e.errand.uid},null,8,["errandUid"])])):p("",!0),e.activeTab==="milestones"?(c(),u("div",Mt,[d(e.ErrandMilestone,{errandUid:e.errand.uid,onMilestoneUpdated:e.handleMilestoneUpdated},null,8,["errandUid"])])):p("",!0),e.activeTab==="files"?(c(),u("div",Ct,[d(e.ErrandFile,{errandUid:e.errand.uid},null,8,["errandUid"])])):p("",!0)])]),t("div",Bt,[t("div",St,[t("div",At,[o[13]||(o[13]=t("label",{class:"block text-sm font-medium text-foreground"},"Date Range",-1)),d(y,{class:"w-full",modelValue:e.dateRange,"onUpdate:modelValue":[o[5]||(o[5]=a=>e.dateRange=a),e.handleDate],range:"",format:e.rangeFormat},null,8,["modelValue"])]),t("div",Lt,[o[14]||(o[14]=t("label",{class:"block text-sm font-medium text-foreground"},"Status",-1)),d(e.Multiselect,{modelValue:e.errand.poster,"onUpdate:modelValue":[o[6]||(o[6]=a=>e.errand.poster=a),e.updateStatus],options:e.posters,label:"title","track-by":"uid",placeholder:"Select status",class:"multiselect-primary"},null,8,["modelValue","options"])]),t("div",Pt,[o[15]||(o[15]=t("label",{class:"block text-sm font-medium text-foreground"},"Assignee",-1)),d(e.Multiselect,{modelValue:e.errand.assignee,"onUpdate:modelValue":[o[7]||(o[7]=a=>e.errand.assignee=a),e.updateAssignee],options:e.users,"track-by":"uid",searchable:!0,"custom-label":e.customLabel,placeholder:"Select assignee",class:"multiselect-primary"},null,8,["modelValue","options"])]),t("div",It,[o[16]||(o[16]=t("label",{class:"block text-sm font-medium text-foreground"},"Reporter",-1)),d(e.Multiselect,{modelValue:e.errand.reporter,"onUpdate:modelValue":[o[8]||(o[8]=a=>e.errand.reporter=a),e.updateReporter],options:e.users,"track-by":"uid",searchable:!0,"custom-label":e.customLabel,placeholder:"Select reporter",class:"multiselect-primary"},null,8,["modelValue","options"])]),t("div",Ht,[o[17]||(o[17]=t("label",{class:"block text-sm font-medium text-foreground"},"Team Members",-1)),d(e.Multiselect,{modelValue:e.errand.members,"onUpdate:modelValue":[o[9]||(o[9]=a=>e.errand.members=a),e.updateMembers],options:e.users,multiple:!0,searchable:!0,"custom-label":e.customLabel,"track-by":"uid",placeholder:"Select members",class:"multiselect-primary"},{tag:q(({option:a,remove:g})=>[t("div",Rt,[t("span",null,m(a.firstName)+" "+m(a.lastName),1),t("button",{onClick:k=>g(a),class:"text-primary hover:text-primary/80 focus:outline-none transition-colors duration-200"}," × ",8,Yt)])]),_:1},8,["modelValue","options"])]),t("div",Nt,[o[18]||(o[18]=t("label",{class:"block text-sm font-medium text-foreground"},"Priority",-1)),d(e.Multiselect,{modelValue:e.errand.priority,"onUpdate:modelValue":[o[10]||(o[10]=a=>e.errand.priority=a),e.updatePriority],options:e.priorities,searchable:!1,"show-labels":!1,placeholder:"Select priority",class:"multiselect-primary"},null,8,["modelValue"])]),t("div",Gt,[o[19]||(o[19]=t("label",{class:"block text-sm font-medium text-foreground"},"Tags",-1)),d(e.Multiselect,{modelValue:e.errand.stamps,"onUpdate:modelValue":[o[11]||(o[11]=a=>e.errand.stamps=a),e.updateStamps],options:e.stamps,multiple:!0,taggable:!0,searchable:!0,"track-by":"uid","show-labels":!1,placeholder:"Select or add tags",onTag:e.addStamp,"custom-label":({title:a})=>`${a}`,class:"multiselect-primary"},{tag:q(({option:a,remove:g})=>[t("div",Ft,[t("span",null,m(a.title),1),t("button",{onClick:k=>g(a),class:"text-primary hover:text-primary/80 focus:outline-none transition-colors duration-200"}," × ",8,jt)])]),_:1},8,["modelValue","options","custom-label"])])])])])])):p("",!0)}const Xt=Me(st,[["render",Kt],["__scopeId","data-v-2d23bea1"],["__file","/home/administrator/Documents/Development/beak-insights/felicity/felicity-lims/webapp/views/grind/_id/ErrandDetail.vue"]]);export{Xt as default};
