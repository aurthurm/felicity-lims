import{P as ye,u as ce,e as ve,h as fe,Z as r,aa as xe,R as be,r as he,o,c as i,b as a,F as m,D as c,E as v,L as g,A as p,C as A,a4 as B,V as W,a1 as ge,a as T,W as Ae,K as _,z as P,a2 as M,x as _e,J as G,X as J,Y as K,S as Ue,_ as Re}from"./index-e1b11e1a.js";import{u as we}from"./analysis-eabcb858.js";import{h as F,o as L,a as N}from"./constants-ba5dc390.js";import{G as Ce,b as Se,c as Ve,d as Te,e as Pe,f as Me,U as je}from"./microbiology.mutations-738698d8.js";import"./analyses.mutations-53bc24e5.js";const De={class:"flex justify-between items-center"},Ee={class:"font-bold"},Ye={class:"italic"},ke=["onClick"],Be={class:"overflow-x-auto"},Ge={class:"min-w-full divide-y divide-gray-200"},Fe={class:"bg-gray-50"},Le={class:"bg-white divide-y divide-gray-200"},Ne=["onUpdate:modelValue","onChange","disabled"],Ie=["value"],$e=["onUpdate:modelValue","onChange","disabled"],qe=["value"],ze=["onUpdate:modelValue","onChange","disabled"],We=["onUpdate:modelValue","onChange","disabled"],Je={class:"ml-2 text-xs text-gray-400"},Ke=["onUpdate:modelValue","onChange","disabled"],Qe={type:"button",class:"bg-sky-800 text-white ml-4 px-2 py-1 rounded-sm leading-none"},Xe={class:"mt-2"},Ze={class:"italic font-semibold"},He={class:"w-full"},Oe={class:"block mb-4"},et={class:"border p-2 h-64 overflow-y-auto"},tt={class:"w-full"},st={class:"px-1 py-1 whitespace-no-wrap border-b border-gray-500"},lt={class:"text-sm leading-5 text-gray-800 font-bold"},at={class:"px-1 py-1 whitespace-no-wrap border-b border-gray-500"},nt={class:"text-sm leading-5 text-gray-800"},ut={class:"px-1 py-1 whitespace-no-wrap text-right border-b border-gray-500 text-sm leading-5"},ot=["onClick"],it={key:0},dt={key:1},rt=ye({__name:"ASTResults",props:{sample:{type:Object,required:!0},organismAnalysisResults:{type:Object,required:!0}},setup(y){const Q=J(()=>K(()=>import("./index-e1b11e1a.js").then(l=>l.cN),["assets/index-e1b11e1a.js","assets/index-78b87750.css"])),j=J(()=>K(()=>import("./FelButton-3c5a7a29.js"),["assets/FelButton-3c5a7a29.js","assets/index-e1b11e1a.js","assets/index-78b87750.css"])),D=ce(),{withClientMutation:I,withClientQuery:x}=ve(),X=fe(()=>y.organismAnalysisResults[0]),U=r([]),R=r([]),$=r([]),q=r([]);xe(()=>{x(Ce,{analysisResultUid:X.value.uid},"abxOrganismResultAll").then(l=>{l&&(R.value=l||[])}).finally(()=>V()),S(),x(Se,{},"abxGuidelineYearAll").then(l=>{l&&($.value=l||[])}),x(Ve,{},"abxTestMethodAll").then(l=>{l&&(q.value=l||[])})});const w=r(!1),C=r(!1),E=r(""),Y=r([]),b=r();function S(){x(Te,{sampleUid:y.sample.uid},"abxAstResultAll").then(l=>{l&&(U.value=l||[])}).finally(()=>V())}function Z(l){b.value=l,w.value=!0}function H(l){const s=n.value[l.uid];return s?Object.values(s)?.every(d=>d.status=="pending"):!1}function O(){C.value=!0,x(Pe,{organismUid:b.value?.uid,text:E.value},"abxAstPanelFilter").then(l=>{l&&(Y.value=l||[])}).finally(()=>{C.value=!1})}function ee(l){w.value=!1,Ue.fire({title:"Are you sure?",text:"You want to apply panel: "+l.name+" to organism: "+b.value?.organism?.name,icon:"warning",showCancelButton:!0,confirmButtonColor:"#3085d6",cancelButtonColor:"#d33",confirmButtonText:"Yes, apply now!",cancelButtonText:"No, do not apply!"}).then(async s=>{s.isConfirmed&&I(Me,{payload:{organismResultUid:b.value?.uid,panelUid:l.uid,sampleUid:y.sample.uid}},"applyAbxAstPanel").then(d=>{d?.astResults?.forEach(e=>U.value.push(e)),V()})})}const n=r({});function V(){const l={};R.value?.forEach(s=>{l[s.uid]={},(U.value?.filter(e=>e.organismResultUid===s.uid)).forEach(e=>{e.antibiotic?.name&&(l[s.uid][e.antibiotic.name+" "+e.antibiotic.potency]={uid:e.uid,analResultUid:e.analysisResultUid,status:e.analysisResult?.status,astMethodUid:e.astMethodUid,guidelineYearUid:e.guidelineYearUid,breakpointUid:e.breakpointUid,astValue:e.astValue,result:e.analysisResult?.result,reportable:e.analysisResult?.reportable,dirty:!1})})}),n.value=l}be([R,U],()=>{V()});const f=l=>Object.keys(n.value[l]||{});let{submitResults:te,approveResults:se}=we();function le(l){const s=n.value[l];if(!s)return!1;const d=Object.values(s)?.some(t=>t.dirty&&t.status=="pending"),e=Object.values(s)?.some(t=>t.guidelineYearUid&&t.astMethodUid&&t.astValue);return d&&e}function ae(l){const s=n.value[l];return(Object.values(s)?.filter(t=>t.dirty&&t.status=="pending")).filter(t=>t.guidelineYearUid&&t.astMethodUid&&t.astValue).map(({dirty:t,breakpointUid:u,analResultUid:z,status:mt,...pe})=>pe)}const k=r(!1);function ne(l){k.value=!0;const s=ae(l);I(je,{payload:{results:s}},"updateAbxAstResults").then(()=>{D.fetchAnalysisResultsForSample(y.sample.uid),S()}).finally(()=>k.value=!1)}function ue(l){const s=n.value[l];if(!s)return!1;const d=Object.values(s)?.some(t=>t.dirty),e=Object.values(s)?.some(t=>t.guidelineYearUid&&t.astMethodUid&&t.astValue&&t.result&&t.status=="pending");return!d&&e&&y.sample.status!="submitting"}function oe(l){const s=n.value[l];return(Object.values(s)?.filter(t=>!t.dirty)).filter(t=>t.guidelineYearUid&&t.astMethodUid&&t.astValue&&t.result&&t.status=="pending").map(({dirty:t,breakpointUid:u,...z})=>z)}function ie(l){const d=oe(l).map(e=>({uid:e.analResultUid,result:e.result,reportable:e.reportable,methodUid:"felicity_ast",laboratoryInstrumentUid:"felicity_ast"}));te(d,"sample",y.sample?.uid).then(()=>{D.fetchAnalysisResultsForSample(y.sample.uid),S()})}function de(l){const s=n.value[l];if(!s)return!1;const d=Object.values(s)?.some(t=>t.dirty),e=Object.values(s)?.some(t=>t.status=="resulted");return!d&&e&&y.sample.status!="approving"}function re(l){const s=n.value[l];return(Object.values(s)?.filter(e=>!e.dirty)).filter(e=>e.status=="resulted")}function me(l){const d=re(l).map(e=>e.analResultUid);se(d,"sample",y.sample?.uid).then(()=>{D.fetchAnalysisResultsForSample(y.sample.uid),S()})}async function h(l,s,d,e){n.value[l][s],n.value[l][s].dirty=!0,n.value[l][s]={...n.value[l][s],[d]:e}}return(l,s)=>{const d=he("font-awesome-icon");return o(),i(m,null,[s[16]||(s[16]=a("h3",{class:"flex justify-between items-center mt-4"},[a("span",{class:"font-bold"},"AST Panel")],-1)),s[17]||(s[17]=a("hr",{class:"mt-1"},null,-1)),(o(!0),i(m,null,c(R.value,e=>(o(),i("div",{key:e.uid,class:"mb-4"},[a("h3",De,[a("span",null,[a("span",Ee,"Organism #"+v(e?.isolateNumber),1),s[2]||(s[2]=g(": ")),a("span",Ye,v(e?.organism?.name),1)]),p(a("button",{onClick:t=>Z(e),class:"ml-2 px-2 py-1 border-sky-800 border text-sky-800 rounded-sm transition duration-300 hover:bg-sky-800 hover:text-white focus:outline-none"}," choose panel ",8,ke),[[A,H(e)]])]),a("div",Be,[a("table",Ge,[a("thead",null,[a("tr",Fe,[s[3]||(s[3]=a("th",{class:"px-4 py-2 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"},"Parameter",-1)),(o(!0),i(m,null,c(f(e.uid),t=>(o(),i("th",{key:t,class:"px-4 py-2 text-left text-xs font-medium text-gray-500 tracking-wider"},v(t),1))),128))])]),a("tbody",Le,[a("tr",null,[s[4]||(s[4]=a("td",{class:"px-4 py-2 text-sm font-medium text-gray-900"},"Guideline",-1)),(o(!0),i(m,null,c(f(e.uid),t=>(o(),i("td",{key:t,class:"px-4 py-2 text-sm text-gray-500"},[p(a("select",{"onUpdate:modelValue":u=>n.value[e.uid][t].guidelineYearUid=u,onChange:u=>h(e.uid,t,"guidelineYearUid",u.target.value),class:"w-32 px-2 py-1 border rounded",disabled:n.value[e.uid][t].status!=="pending"},[(o(!0),i(m,null,c($.value,u=>(o(),i("option",{key:u.uid,value:u.uid},v(u.code),9,Ie))),128))],40,Ne),[[B,n.value[e.uid][t].guidelineYearUid]])]))),128))]),a("tr",null,[s[5]||(s[5]=a("td",{class:"px-4 py-2 text-sm font-medium text-gray-900"},"AST Method",-1)),(o(!0),i(m,null,c(f(e.uid),t=>(o(),i("td",{key:t,class:"px-4 py-2 text-sm text-gray-500"},[p(a("select",{"onUpdate:modelValue":u=>n.value[e.uid][t].astMethodUid=u,onChange:u=>h(e.uid,t,"astMethodUid",u.target.value),class:"w-32 px-2 py-1 border rounded",disabled:n.value[e.uid][t].status!=="pending"},[(o(!0),i(m,null,c(q.value,u=>(o(),i("option",{key:u.uid,value:u.uid},v(u.name),9,qe))),128))],40,$e),[[B,n.value[e.uid][t].astMethodUid]])]))),128))]),a("tr",null,[s[6]||(s[6]=a("td",{class:"px-4 py-2 text-sm font-medium text-gray-900"},"AST Value",-1)),(o(!0),i(m,null,c(f(e.uid),t=>(o(),i("td",{key:t,class:"px-4 py-2 text-sm text-gray-500"},[p(a("input",{type:"number","onUpdate:modelValue":u=>n.value[e.uid][t].astValue=u,onChange:u=>h(e.uid,t,"astValue",u.target.value),class:"w-32 px-2 py-1 border rounded",step:"0.1",disabled:n.value[e.uid][t].status!=="pending"},null,40,ze),[[W,n.value[e.uid][t].astValue]])]))),128))]),a("tr",null,[s[8]||(s[8]=a("td",{class:"px-4 py-2 text-sm font-medium text-gray-900"},"Result",-1)),(o(!0),i(m,null,c(f(e.uid),t=>(o(),i("td",{key:t,class:"px-4 py-2 text-sm"},[p(a("select",{"onUpdate:modelValue":u=>n.value[e.uid][t].result=u,onChange:u=>h(e.uid,t,"result",u.target.value),class:ge(["w-32 px-2 py-1 border rounded",{"text-green-600":n.value[e.uid][t].result?.toUpperCase()==="S","text-yellow-600":n.value[e.uid][t].result?.toUpperCase()==="I","text-red-600":n.value[e.uid][t].result?.toUpperCase()==="R"}]),disabled:n.value[e.uid][t].status!=="pending"},[...s[7]||(s[7]=[a("option",{value:"S"},"S",-1),a("option",{value:"I"},"I",-1),a("option",{value:"R"},"R",-1)])],42,We),[[B,n.value[e.uid][t].result]]),a("span",Je,[p(a("span",null,[T(d,{icon:"robot",class:"text-md text-gray-400 mr-1"})],512),[[A,n.value[e.uid][t].breakpointUid]])])]))),128))]),a("tr",null,[s[9]||(s[9]=a("td",{class:"px-4 py-2 text-sm font-medium text-gray-900"},"Reportable",-1)),(o(!0),i(m,null,c(f(e.uid),t=>(o(),i("td",{key:t,class:"px-4 py-2 text-sm"},[p(a("input",{type:"checkbox","onUpdate:modelValue":u=>n.value[e.uid][t].reportable=u,onChange:u=>h(e.uid,t,"reportable",u.target.checked),class:"form-checkbox h-4 w-4 text-sky-600",disabled:n.value[e.uid][t].status!=="pending"},null,40,Ke),[[Ae,n.value[e.uid][t].reportable]]),a("button",Qe,v(n.value[e.uid][t].status),1)]))),128))])])]),a("div",Xe,[p(T(M(j),{key:"button",onClick:P(t=>ne(e.uid),["prevent"]),color:"orange-600",disabled:k.value},{default:_(()=>[...s[10]||(s[10]=[g("Save Antibiotics")])]),_:2},1032,["onClick","disabled"]),[[A,F(N.UPDATE,L.RESULT)&&le(e.uid)]]),p(T(M(j),{key:"button",onClick:P(t=>ie(e.uid),["prevent"]),color:"orange-600"},{default:_(()=>[...s[11]||(s[11]=[g("Submit Antibiotics")])]),_:2},1032,["onClick"]),[[A,F(N.UPDATE,L.RESULT)&&ue(e.uid)]]),p(T(M(j),{key:"button",onClick:P(t=>me(e.uid),["prevent"]),color:"orange-600"},{default:_(()=>[...s[12]||(s[12]=[g("Approve Antibiotics")])]),_:2},1032,["onClick"]),[[A,F(N.UPDATE,L.RESULT)&&de(e.uid)]])])])]))),128)),w.value?(o(),_e(M(Q),{key:0,onClose:s[1]||(s[1]=e=>w.value=!1),contentWidth:"w-1/2"},{header:_(()=>[a("h3",null,[s[13]||(s[13]=g("Search Panel for ")),a("span",Ze,v(b.value?.organism?.name),1)])]),body:_(()=>[a("form",{class:"",onSubmit:P(e=>({}),["prevent"])},[a("div",He,[a("label",Oe,[p(a("input",{"onUpdate:modelValue":s[0]||(s[0]=e=>E.value=e),onInput:O,class:"form-input mt-1 block w-full",placeholder:"Begin typing..."},null,544),[[W,E.value]])]),a("div",et,[a("table",tt,[(o(!0),i(m,null,c(Y.value,e=>(o(),i("tr",{key:e.uid},[a("td",st,[a("div",lt,v(e.name),1)]),a("td",at,[a("div",nt,v(e.antibiotics?.map(t=>t.name)?.join(", ")),1)]),a("td",ut,[a("button",{type:"button",onClick:t=>ee(e),class:"px-2 py-1 border-sky-800 border text-sky-800 rounded-sm transition duration-300 hover:bg-sky-800 hover:text-white focus:outline-none"}," Appy Panel ",8,ot)])]))),128)),C.value?(o(),i("tr",it,s[14]||(s[14]=[a("td",{colspan:"3",class:"px-4 py-3 text-center text-sm text-gray-500"}," Loading panels... ",-1)]))):G("",!0),!C.value&&Y.value.length===0?(o(),i("tr",dt,s[15]||(s[15]=[a("td",{colspan:"3",class:"px-4 py-3 text-center text-sm text-gray-500"}," No panels found ",-1)]))):G("",!0)])])])],32)]),_:1})):G("",!0)],64)}}}),xt=Re(rt,[["__file","/home/aurthurm/Documents/Development/felicity/felicity-lims/webapp/views/sample/_id/results/ASTResults.vue"]]);export{xt as default};
