const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/DeriveSamplesModal-C5WhmsJK.js","assets/index-OdhKCqIc.js","assets/index-DD18L2yL.css","assets/analysis-PB9AMevg.js","assets/analyses.mutations-DUxQZn1r.js","assets/DeriveSamplesModal-B_WXTbde.css"])))=>i.map(i=>d[i]);
import{Y as ye,P as xe,ag as he,$ as be,u as _e,av as we,aB as Se,an as N,a7 as g,a0 as b,a5 as Ce,a6 as De,aE as ke,_ as Re,r as E,aF as Ee,c as i,o as l,z as t,D as u,A as I,C as y,a as c,M as _,K as v,I as a,E as p,F as z,H as F,L as je}from"./index-OdhKCqIc.js";import{u as Le}from"./samples-BGCTZScT.js";import{p as Te}from"./index-CXV6PIcj.js";import{E as Me,a as Pe,b as Be,c as Ie,d as Ue}from"./EmptyTitle-aCQRDpx3.js";import{S as Oe}from"./Spinner-Bl8RfjFA.js";import"./analyses.mutations-DUxQZn1r.js";const Ve=ye({name:"SampleView",__name:"Sample",setup(W,{expose:s}){s();const m=xe(),e=he(),w=be(),{withClientQuery:j}=_e(),x=Ce(()=>De(()=>import("./DeriveSamplesModal-C5WhmsJK.js"),__vite__mapDeps([0,1,2,3,4,5])));m.resetSample();const{cancelSamples:S,reInstateSamples:C,receiveSamples:D,invalidateSamples:k,publishSamples:r,verifySamples:U,recoverSamples:O}=Le(),V=we({dropdownOpen:!1}),{sample:n,fetchingSample:H,repeatSample:J}=Se(m);m.fetchSampleByUid(e.params.sampleUid),N(()=>n?.value?.status,(o,d)=>{if(o)if(o!=="invalidated"){m.resetRepeatSample();return}else m.fetchRepeatSampleByParentId(e.params.sampleUid)}),N(()=>e.params.sampleUid,(o,d)=>{m.fetchSampleByUid(o)});function K(o,d){let f=[];return o?.forEach(h=>f.push(h.name)),d?.forEach(h=>f.push(h.name)),f.join(", ")}function Q(o){if(!o)return null;const d=o.toLowerCase();return d.startsWith("der")?"D":d.startsWith("ali")?"A":d.startsWith("poo")?"P":o.charAt(0).toUpperCase()}const Y=g(()=>!!["expected"].includes(n?.value?.status?.toLowerCase())),X=async()=>D([n?.value?.uid]),Z=g(()=>!!["received","expected"].includes(n?.value?.status?.toLowerCase())),$=async()=>S([n?.value?.uid]),ee=g(()=>!!["cancelled"].includes(n?.value?.status?.toLowerCase())),te=async()=>C([n?.value?.uid]),se=g(()=>n?.value?.status?.toLowerCase()==="awaiting"),oe=async()=>U([n?.value?.uid]),ne=g(()=>n?.value?.status?.toLowerCase()==="published"),L=g(()=>["approved"].includes(n?.value?.status?.toLowerCase())?"Publish":["published"].includes(n?.value?.status?.toLowerCase())?"Re publish":"Pre publish"),ae=g(()=>{if(["awaiting","approved","published"].includes(n?.value?.status?.toLowerCase()))return!0;const o=m.analysisResults;return!!(["received","paired"].includes(n?.value?.status?.toLowerCase()??"")&&o?.some(d=>["approved"].includes(d.status?.toLowerCase()??"")))}),re=async()=>{const o=L.value.startsWith("Pre")?"pre-publish":L.value.startsWith("Re")?"re-publish":"publish";r([{uid:n?.value?.uid,action:o}])},le=async()=>k([n?.value?.uid]).then(o=>{let d=o?.filter(f=>f.uid!==n?.value?.uid);d.length>0&&m.setRepeatSample(d[0])}),ie=async()=>w.push({name:"print-barcodes",state:{sampleUids:JSON.stringify([n?.value?.uid])}}),de=g(()=>!!["received","expected"].includes(n?.value?.status?.toLowerCase())),ue=async()=>{w.push({name:"reject-samples",state:{samples:JSON.stringify([n?.value])}})},ce=g(()=>!!["stored"].includes(n?.value?.status?.toLowerCase())),pe=async()=>O([n?.value?.uid]),me=async o=>{w.push({path:"/bio-banking",state:{sample:JSON.stringify(o)}})},A=b(!1),T=b(!1),M=b(null),R=b(null),fe=g(()=>{if(!R.value?.children?.length)return[];const o=[],d=(f,h)=>{o.push({node:f,depth:h}),(f.children??[]).forEach(ve=>d(ve,h+1))};return R.value.children.forEach(f=>d(f,0)),o}),G=async()=>{n?.value?.uid&&(T.value=!0,M.value=null,j(ke,{sampleUid:n?.value?.uid,depth:6,includeTests:!1,includeExtraRelationships:!0},"sampleGenealogy").then(o=>{R.value=o??null}).catch(o=>{M.value=o?.message??"Failed to load genealogy."}).finally(()=>{T.value=!1}))},ge=async()=>{A.value=!0,await G()},P=b(!1),B=b([]),q={sampleStore:m,route:e,router:w,withClientQuery:j,DeriveSamplesModal:x,cancelSamples:S,reInstateSamples:C,receiveSamples:D,invalidateSamples:k,publishSamples:r,verifySamples:U,recoverSamples:O,state:V,sample:n,fetchingSample:H,repeatSample:J,profileAnalysesText:K,relationshipBadge:Q,canReceive:Y,receiveSample:X,canCancel:Z,cancelSample:$,canReinstate:ee,reInstateSample:te,canVerify:se,verifySample:oe,canInvalidate:ne,publishText:L,canPublish:ae,publishSample:re,invalidateSample:le,printBarCooe:ie,canReject:de,rejectSample:ue,canRecover:ce,recoverSample:pe,goToStorage:me,showGenealogyModal:A,genealogyLoading:T,genealogyError:M,genealogy:R,genealogyRows:fe,fetchGenealogy:G,openGenealogyModal:ge,showDeriveModal:P,deriveSelection:B,openDeriveModal:()=>{n?.value&&(B.value=[n.value],P.value=!0,V.dropdownOpen=!1)},closeDeriveModal:()=>{P.value=!1,B.value=[]},handleDerived:o=>{o?.length&&m.addSampleClones(o)},get parseDate(){return Te},get Empty(){return Ue},get EmptyContent(){return Ie},get EmptyDescription(){return Be},get EmptyHeader(){return Pe},get EmptyTitle(){return Me},get Spinner(){return Oe}};return Object.defineProperty(q,"__isScriptSetup",{enumerable:!1,value:!0}),q}}),Ae={class:"space-y-6"},Ge={class:"flex justify-between items-center"},qe={class:"flex items-center space-x-4"},Ne={class:"flex items-center"},ze={class:"bg-background rounded-lg shadow-sm p-6 space-y-6"},Fe={key:0,class:"py-4 text-center"},We={class:"inline-flex items-center gap-2"},He={key:1,class:"space-y-6"},Je={class:"space-y-4"},Ke={class:"flex items-center justify-between"},Qe={class:"flex items-center space-x-2"},Ye={key:0,class:"text-destructive"},Xe={class:"text-lg font-semibold text-foreground"},Ze={key:1,class:"inline-flex items-center justify-center w-4 h-4 rounded-full text-[9px] italic font-semibold bg-muted text-foreground"},$e={key:2,class:"flex items-center space-x-2"},et={class:"text-muted-foreground"},tt={class:"relative"},st={type:"button",class:"px-4 py-2 bg-primary text-primary-foreground rounded-md hover:bg-primary/90 transition-colors duration-200 focus:outline-none focus:ring-2 focus:ring-primary/50"},ot={class:"absolute right-0 mt-2 py-2 bg-background rounded-lg shadow-lg border border-border z-20 min-w-[200px]"},nt={class:"grid grid-cols-3 gap-6"},at={class:"space-y-4"},rt={class:"flex justify-between"},lt={class:"text-sm text-muted-foreground"},it={class:"flex justify-between"},dt={class:"text-sm text-muted-foreground"},ut={class:"space-y-4"},ct={class:"flex justify-between"},pt={class:"text-sm text-muted-foreground"},mt={class:"flex justify-between"},ft={class:"text-sm text-muted-foreground"},gt={class:"flex justify-between"},vt={class:"text-sm text-muted-foreground"},yt={class:"flex justify-between"},xt={class:"text-sm text-muted-foreground"},ht={class:"space-y-4"},bt={class:"flex justify-between"},_t={class:"text-sm text-muted-foreground"},wt={class:"flex justify-between"},St={class:"text-sm text-muted-foreground"},Ct={class:"flex justify-between"},Dt={class:"text-sm text-muted-foreground"},kt={class:"flex justify-between"},Rt={class:"text-sm text-muted-foreground"},Et={class:"bg-muted rounded-lg shadow-sm p-6"},jt={class:"flex items-center space-x-4"},Lt={class:"flex items-center space-x-2"},Tt={class:"bg-destructive/10 text-destructive rounded-lg shadow-sm p-6"},Mt={class:"space-y-2"},Pt={class:"space-y-4"},Bt={key:0,class:"py-6 text-center"},It={class:"inline-flex items-center gap-2"},Ut={key:1,class:"text-destructive"},Ot={key:3,class:"space-y-2"},Vt={class:"font-medium text-foreground"},At={key:0,class:"text-xs text-muted-foreground"};function Gt(W,s,m,e,w,j){const x=E("font-awesome-icon"),S=E("router-link"),C=E("Modal"),D=E("router-view"),k=Ee("motion-slide-right");return l(),i("div",Ae,[t("div",Ge,[s[15]||(s[15]=t("h3",{class:"text-xl font-semibold text-foreground"},"Sample Detail",-1)),t("div",qe,[t("button",{class:"px-4 py-2 bg-background border border-border text-foreground rounded-md hover:bg-accent hover:text-accent-foreground transition-colors duration-200 focus:outline-none focus:ring-2 focus:ring-primary/50",onClick:e.printBarCooe},[t("span",Ne,[s[13]||(s[13]=_(" Barcode ",-1)),c(x,{icon:"barcode",class:"ml-2"})])]),e.sample?.analysisRequest?.patient?.uid?(l(),I(S,{key:0,to:{name:"patient-detail",params:{patientUid:e.sample?.analysisRequest?.patient?.uid}},class:"px-4 py-2 bg-primary text-primary-foreground rounded-md hover:bg-primary/90 transition-colors duration-200 focus:outline-none focus:ring-2 focus:ring-primary/50"},{default:v(()=>[...s[14]||(s[14]=[_(" ... other samples ",-1)])]),_:1},8,["to"])):y("",!0),e.sample?.uid?(l(),i("button",{key:1,class:"px-4 py-2 bg-background border border-border text-foreground rounded-md hover:bg-accent hover:text-accent-foreground transition-colors duration-200 focus:outline-none focus:ring-2 focus:ring-primary/50",onClick:e.openGenealogyModal}," View genealogy ")):y("",!0)])]),u((l(),i("div",ze,[e.fetchingSample?(l(),i("div",Fe,[t("span",We,[c(e.Spinner,{class:"size-4"}),s[16]||(s[16]=t("span",{class:"text-sm"},"Fetching sample details ...",-1))])])):(l(),i("div",He,[t("div",Je,[t("div",Ke,[t("div",Qe,[e.sample?.priority??!0?(l(),i("span",Ye,[c(x,{icon:"fa-star"})])):y("",!0),t("span",Xe,a(e.sample?.sampleId),1),e.relationshipBadge(e.sample?.relationshipType)?(l(),i("span",Ze,a(e.relationshipBadge(e.sample?.relationshipType)),1)):y("",!0),e.sample?.analysisRequest?.patient?.uid&&e.repeatSample?.uid?(l(),i("span",$e,[c(x,{icon:"angle-double-right"}),c(S,{to:{name:"sample-detail",params:{patientUid:e.sample?.analysisRequest?.patient?.uid,sampleUid:e.repeatSample?.uid}},class:"px-4 py-2 bg-primary text-primary-foreground rounded-md hover:bg-primary/90 transition-colors duration-200 focus:outline-none focus:ring-2 focus:ring-primary/50"},{default:v(()=>[_(a(e.repeatSample?.sampleId),1)]),_:1},8,["to"])])):y("",!0)]),t("span",et,a(e.profileAnalysesText(e.sample?.profiles,e.sample?.analyses??[])),1),t("div",tt,[t("div",{onClick:s[0]||(s[0]=r=>e.state.dropdownOpen=!e.state.dropdownOpen),class:"flex items-center space-x-2 cursor-pointer"},[t("button",st,a(e.sample?.status),1),c(x,{icon:"chevron-down",class:"text-muted-foreground"})]),u(t("div",{onClick:s[1]||(s[1]=r=>e.state.dropdownOpen=!1),class:"fixed inset-0 h-full w-full z-10"},null,512),[[p,e.state.dropdownOpen]]),u(t("div",ot,[u(t("button",{onClick:s[2]||(s[2]=r=>e.receiveSample()),class:"w-full px-4 py-2 text-left text-foreground hover:bg-primary hover:text-primary-foreground transition-colors duration-200"}," Receive ",512),[[p,e.canReceive]]),u(t("button",{onClick:s[3]||(s[3]=r=>e.verifySample()),class:"w-full px-4 py-2 text-left text-foreground hover:bg-primary hover:text-primary-foreground transition-colors duration-200"}," Approve ",512),[[p,e.canVerify]]),u(t("button",{onClick:s[4]||(s[4]=r=>e.rejectSample()),class:"w-full px-4 py-2 text-left text-foreground hover:bg-destructive hover:text-destructive-foreground transition-colors duration-200"}," Reject ",512),[[p,e.canReject]]),u(t("button",{onClick:s[5]||(s[5]=r=>e.cancelSample()),class:"w-full px-4 py-2 text-left text-foreground hover:bg-destructive hover:text-destructive-foreground transition-colors duration-200"}," Cancel ",512),[[p,e.canCancel]]),u(t("button",{onClick:s[6]||(s[6]=r=>e.reInstateSample()),class:"w-full px-4 py-2 text-left text-foreground hover:bg-destructive hover:text-destructive-foreground transition-colors duration-200"}," Reinstate ",512),[[p,e.canReinstate]]),u(t("button",{onClick:s[7]||(s[7]=r=>e.publishSample()),class:"w-full px-4 py-2 text-left text-foreground hover:bg-primary hover:text-primary-foreground transition-colors duration-200"},a(e.publishText),513),[[p,e.canPublish]]),u(t("button",{onClick:s[8]||(s[8]=r=>e.invalidateSample()),class:"w-full px-4 py-2 text-left text-foreground hover:bg-primary hover:text-primary-foreground transition-colors duration-200"}," Invalidate ",512),[[p,e.canInvalidate]]),u(t("button",{onClick:s[9]||(s[9]=r=>e.recoverSample()),class:"w-full px-4 py-2 text-left text-foreground hover:bg-primary hover:text-primary-foreground transition-colors duration-200"}," Recover ",512),[[p,e.canRecover]]),u(t("button",{onClick:s[10]||(s[10]=r=>e.openDeriveModal()),class:"w-full px-4 py-2 text-left text-foreground hover:bg-primary hover:text-primary-foreground transition-colors duration-200"}," Derive ",512),[[p,e.sample?.uid]])],512),[[p,e.state.dropdownOpen]])])]),t("div",nt,[t("div",at,[t("div",rt,[s[17]||(s[17]=t("span",{class:"text-sm font-medium text-foreground"},"Client Request ID",-1)),t("span",lt,a(e.sample?.analysisRequest?.clientRequestId),1)]),t("div",it,[s[18]||(s[18]=t("span",{class:"text-sm font-medium text-foreground"},"Client",-1)),t("span",dt,a(e.sample?.analysisRequest?.client?.name),1)]),s[19]||(s[19]=t("div",{class:"flex justify-between"},[t("span",{class:"text-sm font-medium text-foreground"},"Client Contact"),t("span",{class:"text-sm text-muted-foreground"},"Sister in Charge")],-1))]),t("div",ut,[t("div",ct,[s[20]||(s[20]=t("span",{class:"text-sm font-medium text-foreground"},"Sample Type",-1)),t("span",pt,a(e.sample?.sampleType?.name),1)]),t("div",mt,[s[21]||(s[21]=t("span",{class:"text-sm font-medium text-foreground"},"Date Sampled",-1)),t("span",ft,a(e.parseDate(e.sample?.dateCollected,!0)),1)]),t("div",gt,[s[22]||(s[22]=t("span",{class:"text-sm font-medium text-foreground"},"Date Registered",-1)),t("span",vt,a(e.parseDate(e.sample?.createdAt,!0)),1)]),t("div",yt,[s[23]||(s[23]=t("span",{class:"text-sm font-medium text-foreground"},"Date Received",-1)),t("span",xt,a(e.parseDate(e.sample?.dateReceived,!0)),1)])]),t("div",ht,[t("div",bt,[s[24]||(s[24]=t("span",{class:"text-sm font-medium text-foreground"},"Date Submitted",-1)),t("span",_t,a(e.parseDate(e.sample?.dateSubmitted,!0)),1)]),t("div",wt,[s[25]||(s[25]=t("span",{class:"text-sm font-medium text-foreground"},"Date Verified",-1)),t("span",St,a(e.parseDate(e.sample?.dateVerified,!0)),1)]),t("div",Ct,[s[26]||(s[26]=t("span",{class:"text-sm font-medium text-foreground"},"Date Published",-1)),t("span",Dt,a(e.parseDate(e.sample?.datePublished,!0)),1)]),t("div",kt,[s[27]||(s[27]=t("span",{class:"text-sm font-medium text-foreground"},"Date Printed",-1)),t("span",Rt,a(e.parseDate(e.sample?.datePrinted,!0)),1)])])])])]))])),[[k]]),u(t("div",Et,[t("div",jt,[s[32]||(s[32]=t("span",{class:"font-medium text-foreground"},"Storage:",-1)),t("button",{class:"text-primary hover:text-primary/80 transition-colors",onClick:s[11]||(s[11]=r=>e.goToStorage(e.sample))},[t("span",Lt,[t("span",null,a(e.sample?.storageContainer?.storageSection?.storageLocation?.storeRoom?.name),1),s[28]||(s[28]=t("span",null,"›",-1)),t("span",null,a(e.sample?.storageContainer?.storageSection?.storageLocation?.name),1),s[29]||(s[29]=t("span",null,"›",-1)),t("span",null,a(e.sample?.storageContainer?.storageSection?.name),1),s[30]||(s[30]=t("span",null,"›",-1)),t("span",null,a(e.sample?.storageContainer?.name),1),s[31]||(s[31]=t("span",null,"›",-1)),t("span",null,a(e.sample?.storageSlot),1)])])])],512),[[p,e.sample?.status==="stored"]]),u(t("div",Tt,[t("ul",Mt,[(l(!0),i(z,null,F(e.sample?.rejectionReasons,r=>(l(),i("li",{key:r.uid},a(r.reason),1))),128))])],512),[[p,e.sample?.status==="rejected"]]),e.showGenealogyModal?(l(),I(C,{key:0,onClose:s[12]||(s[12]=r=>e.showGenealogyModal=!1),"content-width":"w-3/4"},{header:v(()=>[_(a(e.sample?.sampleId??e.sample?.uid)+" Genealogy ",1)]),body:v(()=>[t("div",Pt,[e.genealogyLoading?(l(),i("div",Bt,[t("span",It,[c(e.Spinner,{class:"size-4"}),s[33]||(s[33]=t("span",{class:"text-sm"},"Fetching genealogy ...",-1))])])):e.genealogyError?(l(),i("div",Ut,a(e.genealogyError),1)):e.genealogyRows.length?(l(),i("div",Ot,[(l(!0),i(z,null,F(e.genealogyRows,r=>(l(),i("div",{key:r.node.sampleUid,class:"flex items-center gap-2",style:je({paddingLeft:`${r.depth*1.25}rem`})},[t("span",Vt,a(r.node.sampleId??r.node.sampleUid),1),r.node.relationshipType?(l(),i("span",At," ("+a(r.node.relationshipType)+") ",1)):y("",!0)],4))),128))])):(l(),I(e.Empty,{key:2,class:"border-0 bg-transparent p-0"},{default:v(()=>[c(e.EmptyContent,null,{default:v(()=>[c(e.EmptyHeader,null,{default:v(()=>[c(e.EmptyTitle,null,{default:v(()=>[...s[34]||(s[34]=[_("No genealogy",-1)])]),_:1}),c(e.EmptyDescription,null,{default:v(()=>[...s[35]||(s[35]=[_("Sample has no genealogy.",-1)])]),_:1})]),_:1})]),_:1})]),_:1}))])]),_:1})):y("",!0),c(e.DeriveSamplesModal,{show:e.showDeriveModal,samples:e.deriveSelection,onClose:e.closeDeriveModal,onDerived:e.handleDerived},null,8,["show","samples"]),c(D)])}const Yt=Re(Ve,[["render",Gt],["__file","/home/administrator/Documents/Development/beak-insights/felicity/felicity-lims/webapp/views/sample/_id/Sample.vue"]]);export{Yt as default};
