import{V as ce,u as fe,f as me,i as pe,a1 as f,a8 as be,X as ve,r as E,o as d,c,O as s,F as m,H as v,J as y,D as p,E as U,L as g,a3 as B,Y as H,a4 as J,a as M,Z as ye,M as R,N as j,C as G,z as ge,ag as xe,_ as he}from"./index-74595aff.js";import{u as _e}from"./analysis-c8f7b8f1.js";import{h as F,o as N,a as k}from"./constants-b03e9ddf.js";import{G as Ae,b as Ue,c as Re,d as Ce,e as we,f as Se,U as Ve}from"./microbiology.mutations-05669adc.js";import"./analyses.mutations-185deb2b.js";const Te={class:"space-y-6"},Me={class:"space-y-8"},je={class:"flex items-center justify-between"},Pe={class:"space-x-2"},De={class:"font-semibold text-foreground"},Ye={class:"text-muted-foreground"},Ee=["onClick"],Be={class:"rounded-lg border border-border bg-background"},Ge={class:"overflow-x-auto"},Fe={class:"w-full"},Ne={class:"border-b border-border bg-muted/50"},ke={class:"border-b border-border"},$e=["onUpdate:modelValue","onChange","disabled"],Ie=["value"],Le={class:"border-b border-border"},qe=["onUpdate:modelValue","onChange","disabled"],ze=["value"],He={class:"border-b border-border"},Je=["onUpdate:modelValue","onChange","disabled"],Qe={class:"border-b border-border"},We={class:"flex items-center space-x-2"},Xe=["onUpdate:modelValue","onChange","disabled"],Ze={class:"flex items-center space-x-4"},Ke=["onUpdate:modelValue","onChange","disabled"],Oe={class:"flex items-center space-x-4"},et={class:"text-lg font-semibold text-foreground"},tt={class:"italic"},st={class:"space-y-6"},lt={class:"space-y-4"},ot={class:"rounded-lg border border-border"},nt={class:"overflow-y-auto max-h-64"},ut={class:"w-full"},at={class:"px-4 py-3"},rt={class:"font-medium text-foreground"},dt={class:"text-sm text-muted-foreground"},it={class:"px-4 py-3 text-right"},ct=["onClick"],ft=ce({__name:"ASTResults",props:{sample:{type:Object,required:!0},organismAnalysisResults:{type:Object,required:!0}},setup(b){const P=fe(),{withClientMutation:$,withClientQuery:h}=me(),Q=pe(()=>b.organismAnalysisResults[0]),C=f([]),w=f([]),I=f([]),L=f([]);be(()=>{h(Ae,{analysisResultUid:Q.value.uid},"abxOrganismResultAll").then(l=>{l&&(w.value=l||[])}).finally(()=>T()),V(),h(Ue,{},"abxGuidelineYearAll").then(l=>{l&&(I.value=l||[])}),h(Re,{},"abxTestMethodAll").then(l=>{l&&(L.value=l||[])})});const S=f(!1),q=f(!1),D=f(""),z=f([]),_=f();function V(){h(Ce,{sampleUid:b.sample.uid},"abxAstResultAll").then(l=>{l&&(C.value=l||[])}).finally(()=>T())}function W(l){_.value=l,S.value=!0}function X(l){const e=u.value[l.uid];return e?Object.values(e)?.every(i=>i.status=="pending"):!1}function Z(){q.value=!0,h(we,{organismUid:_.value?.uid,text:D.value},"abxAstPanelFilter").then(l=>{l&&(z.value=l||[])}).finally(()=>{q.value=!1})}function K(l){S.value=!1,xe.fire({title:"Are you sure?",text:"You want to apply panel: "+l.name+" to organism: "+_.value?.organism?.name,icon:"warning",showCancelButton:!0,confirmButtonColor:"#3085d6",cancelButtonColor:"#d33",confirmButtonText:"Yes, apply now!",cancelButtonText:"No, do not apply!"}).then(async e=>{e.isConfirmed&&$(Se,{payload:{organismResultUid:_.value?.uid,panelUid:l.uid,sampleUid:b.sample.uid}},"applyAbxAstPanel").then(i=>{i?.astResults?.forEach(n=>C.value.push(n)),T()})})}const u=f({});function T(){const l={};w.value?.forEach(e=>{l[e.uid]={},(C.value?.filter(n=>n.organismResultUid===e.uid)).forEach(n=>{n.antibiotic?.name&&(l[e.uid][n.antibiotic.name+" "+n.antibiotic.potency]={uid:n.uid,analResultUid:n.analysisResultUid,status:n.analysisResult?.status,astMethodUid:n.astMethodUid,guidelineYearUid:n.guidelineYearUid,breakpointUid:n.breakpointUid,astValue:n.astValue,result:n.analysisResult?.result,reportable:n.analysisResult?.reportable,dirty:!1})})}),u.value=l}ve([w,C],()=>{T()});const x=l=>Object.keys(u.value[l]||{});let{submitResults:O,approveResults:ee}=_e();function te(l){const e=u.value[l];if(!e)return!1;const i=Object.values(e)?.some(a=>a.dirty&&a.status=="pending"),n=Object.values(e)?.some(a=>a.guidelineYearUid&&a.astMethodUid&&a.astValue);return i&&n}function se(l){const e=u.value[l];return(Object.values(e)?.filter(a=>a.dirty&&a.status=="pending")).filter(a=>a.guidelineYearUid&&a.astMethodUid&&a.astValue).map(({dirty:a,breakpointUid:t,analResultUid:o,status:r,...ie})=>ie)}const Y=f(!1);function le(l){Y.value=!0;const e=se(l);$(Ve,{payload:{results:e}},"updateAbxAstResults").then(()=>{P.fetchAnalysisResultsForSample(b.sample.uid),V()}).finally(()=>Y.value=!1)}function oe(l){const e=u.value[l];if(!e)return!1;const i=Object.values(e)?.some(a=>a.dirty),n=Object.values(e)?.some(a=>a.guidelineYearUid&&a.astMethodUid&&a.astValue&&a.result&&a.status=="pending");return!i&&n&&b.sample.status!="submitting"}function ne(l){const e=u.value[l];return(Object.values(e)?.filter(a=>!a.dirty)).filter(a=>a.guidelineYearUid&&a.astMethodUid&&a.astValue&&a.result&&a.status=="pending").map(({dirty:a,breakpointUid:t,...o})=>o)}function ue(l){const i=ne(l).map(n=>({uid:n.analResultUid,result:n.result,reportable:n.reportable,methodUid:"felicity_ast",laboratoryInstrumentUid:"felicity_ast"}));O(i,"sample",b.sample?.uid).then(()=>{P.fetchAnalysisResultsForSample(b.sample.uid),V()})}function ae(l){const e=u.value[l];if(!e)return!1;const i=Object.values(e)?.some(a=>a.dirty),n=Object.values(e)?.some(a=>a.status=="resulted");return!i&&n&&b.sample.status!="approving"}function re(l){const e=u.value[l];return(Object.values(e)?.filter(n=>!n.dirty)).filter(n=>n.status=="resulted")}function de(l){const i=re(l).map(n=>n.analResultUid);ee(i,"sample",b.sample?.uid).then(()=>{P.fetchAnalysisResultsForSample(b.sample.uid),V()})}async function A(l,e,i,n){u.value[l][e],u.value[l][e].dirty=!0,u.value[l][e]={...u.value[l][e],[i]:n}}return(l,e)=>{const i=E("font-awesome-icon"),n=E("fel-button"),a=E("fel-modal");return d(),c(m,null,[s("div",Te,[e[12]||(e[12]=s("div",{class:"flex items-center justify-between border-b border-border pb-4"},[s("h3",{class:"text-lg font-semibold text-foreground"},"AST Panel")],-1)),s("div",Me,[(d(!0),c(m,null,v(w.value,t=>(d(),c("div",{key:t.uid,class:"space-y-6"},[s("div",je,[s("div",Pe,[s("span",De,"Organism #"+y(t?.isolateNumber),1),s("span",Ye,y(t?.organism?.name),1)]),p(s("button",{onClick:o=>W(t),class:"inline-flex items-center justify-center rounded-md text-sm font-medium ring-offset-background transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 border border-input bg-background hover:bg-accent hover:text-accent-foreground h-9 px-4 py-2"}," Choose Panel ",8,Ee),[[U,X(t)]])]),s("div",Be,[s("div",Ge,[s("table",Fe,[s("thead",null,[s("tr",Ne,[e[2]||(e[2]=s("th",{class:"px-4 py-3 text-left text-sm font-medium text-muted-foreground"},"Parameter",-1)),(d(!0),c(m,null,v(x(t.uid),o=>(d(),c("th",{key:o,class:"px-4 py-3 text-left text-sm font-medium text-muted-foreground"},y(o),1))),128))])]),s("tbody",null,[g(" Guideline year "),s("tr",ke,[e[3]||(e[3]=s("td",{class:"px-4 py-3 text-sm font-medium text-foreground"},"Guideline",-1)),(d(!0),c(m,null,v(x(t.uid),o=>(d(),c("td",{key:o,class:"px-4 py-3"},[p(s("select",{"onUpdate:modelValue":r=>u.value[t.uid][o].guidelineYearUid=r,onChange:r=>A(t.uid,o,"guidelineYearUid",r.target.value),class:"w-full rounded-md border border-input bg-background px-3 py-2 text-sm ring-offset-background focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50",disabled:u.value[t.uid][o].status!=="pending"},[(d(!0),c(m,null,v(I.value,r=>(d(),c("option",{key:r.uid,value:r.uid},y(r.code),9,Ie))),128))],40,$e),[[B,u.value[t.uid][o].guidelineYearUid]])]))),128))]),g(" AST Method "),s("tr",Le,[e[4]||(e[4]=s("td",{class:"px-4 py-3 text-sm font-medium text-foreground"},"AST Method",-1)),(d(!0),c(m,null,v(x(t.uid),o=>(d(),c("td",{key:o,class:"px-4 py-3"},[p(s("select",{"onUpdate:modelValue":r=>u.value[t.uid][o].astMethodUid=r,onChange:r=>A(t.uid,o,"astMethodUid",r.target.value),class:"w-full rounded-md border border-input bg-background px-3 py-2 text-sm ring-offset-background focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50",disabled:u.value[t.uid][o].status!=="pending"},[(d(!0),c(m,null,v(L.value,r=>(d(),c("option",{key:r.uid,value:r.uid},y(r.name),9,ze))),128))],40,qe),[[B,u.value[t.uid][o].astMethodUid]])]))),128))]),g(" AST Value "),s("tr",He,[e[5]||(e[5]=s("td",{class:"px-4 py-3 text-sm font-medium text-foreground"},"AST Value",-1)),(d(!0),c(m,null,v(x(t.uid),o=>(d(),c("td",{key:o,class:"px-4 py-3"},[p(s("input",{type:"number","onUpdate:modelValue":r=>u.value[t.uid][o].astValue=r,onChange:r=>A(t.uid,o,"astValue",r.target.value),class:"w-full rounded-md border border-input bg-background px-3 py-2 text-sm ring-offset-background focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50",step:"0.1",disabled:u.value[t.uid][o].status!=="pending"},null,40,Je),[[H,u.value[t.uid][o].astValue]])]))),128))]),g(" Result "),s("tr",Qe,[e[7]||(e[7]=s("td",{class:"px-4 py-3 text-sm font-medium text-foreground"},"Result",-1)),(d(!0),c(m,null,v(x(t.uid),o=>(d(),c("td",{key:o,class:"px-4 py-3"},[s("div",We,[p(s("select",{"onUpdate:modelValue":r=>u.value[t.uid][o].result=r,onChange:r=>A(t.uid,o,"result",r.target.value),class:J(["w-full rounded-md border border-input bg-background px-3 py-2 text-sm ring-offset-background focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50",{"text-success":u.value[t.uid][o].result?.toUpperCase()==="S","text-warning":u.value[t.uid][o].result?.toUpperCase()==="I","text-destructive":u.value[t.uid][o].result?.toUpperCase()==="R"}]),disabled:u.value[t.uid][o].status!=="pending"},[...e[6]||(e[6]=[s("option",{value:"S"},"S",-1),s("option",{value:"I"},"I",-1),s("option",{value:"R"},"R",-1)])],42,Xe),[[B,u.value[t.uid][o].result]]),p(s("span",null,[M(i,{icon:"robot",class:"text-muted-foreground","aria-label":"Auto-calculated"})],512),[[U,u.value[t.uid][o].breakpointUid]])])]))),128))]),g(" Reportable "),s("tr",null,[e[8]||(e[8]=s("td",{class:"px-4 py-3 text-sm font-medium text-foreground"},"Reportable",-1)),(d(!0),c(m,null,v(x(t.uid),o=>(d(),c("td",{key:o,class:"px-4 py-3"},[s("div",Ze,[p(s("input",{type:"checkbox","onUpdate:modelValue":r=>u.value[t.uid][o].reportable=r,onChange:r=>A(t.uid,o,"reportable",r.target.checked),class:"rounded border-input text-primary focus:ring-primary disabled:cursor-not-allowed disabled:opacity-50",disabled:u.value[t.uid][o].status!=="pending"},null,40,Ke),[[ye,u.value[t.uid][o].reportable]]),s("span",{class:J(["inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium",{"bg-primary/10 text-primary":u.value[t.uid][o].status==="pending","bg-warning/10 text-warning":u.value[t.uid][o].status==="resulted","bg-success/10 text-success":u.value[t.uid][o].status==="approved","bg-destructive/10 text-destructive":u.value[t.uid][o].status==="cancelled"}])},y(u.value[t.uid][o].status),3)])]))),128))])])])])]),s("div",Oe,[p(M(n,{key:"save",onClick:G(o=>le(t.uid),["prevent"]),color:"primary",disabled:Y.value},{default:R(()=>[...e[9]||(e[9]=[j(" Save Antibiotics ")])]),_:2},1032,["onClick","disabled"]),[[U,F(k.UPDATE,N.RESULT)&&te(t.uid)]]),p(M(n,{key:"submit",onClick:G(o=>ue(t.uid),["prevent"]),color:"warning"},{default:R(()=>[...e[10]||(e[10]=[j(" Submit Antibiotics ")])]),_:2},1032,["onClick"]),[[U,F(k.UPDATE,N.RESULT)&&oe(t.uid)]]),p(M(n,{key:"approve",onClick:G(o=>de(t.uid),["prevent"]),color:"success"},{default:R(()=>[...e[11]||(e[11]=[j(" Approve Antibiotics ")])]),_:2},1032,["onClick"]),[[U,F(k.UPDATE,N.RESULT)&&ae(t.uid)]])])]))),128))])]),g(" Panel Form Modal "),S.value?(d(),ge(a,{key:0,onClose:e[1]||(e[1]=t=>S.value=!1),contentWidth:"w-1/2"},{header:R(()=>[s("h3",et,[e[13]||(e[13]=j(" Search Panel for ")),s("span",tt,y(_.value?.organism?.name),1)])]),body:R(()=>[s("div",st,[s("div",lt,[p(s("input",{"onUpdate:modelValue":e[0]||(e[0]=t=>D.value=t),onInput:Z,class:"w-full rounded-md border border-input bg-background px-3 py-2 text-sm ring-offset-background focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2",placeholder:"Begin typing..."},null,544),[[H,D.value]]),s("div",ot,[s("div",nt,[s("table",ut,[s("tbody",null,[(d(!0),c(m,null,v(z.value,t=>(d(),c("tr",{key:t.uid,class:"border-b border-border hover:bg-muted/50 transition-colors duration-200"},[s("td",at,[s("div",rt,y(t.name),1),s("div",dt,y(t.antibiotics?.map(o=>o.name)?.join(", ")),1)]),s("td",it,[s("button",{onClick:o=>K(t),class:"inline-flex items-center justify-center rounded-md text-sm font-medium ring-offset-background transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 bg-primary text-primary-foreground hover:bg-primary/90 h-9 px-4 py-2"}," Apply ",8,ct)])]))),128))])])])])])])]),_:1})):g("v-if",!0)],64)}}}),gt=he(ft,[["__file","/home/aurthurm/Documents/Development/felicity/felicity-lims/webapp/views/sample/_id/results/ASTResults.vue"]]);export{gt as default};
