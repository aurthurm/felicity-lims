import{d as U,at as V,aL as j,aM as E,s as F,D as O,n as R,o as r,c as d,f as p,g as z,e as C,F as m,p as g,b as n,t as a,H as h,as as l,j as M,_ as P,k as H}from"./index-2a6c9271.js";const q={class:"relative mt-4"},G=n("div",{class:"border-r-2 border-gray-400 border-dotted absolute h-full top-0 z-0",style:{left:"7px"}},null,-1),J={key:0,class:"py-4 text-center"},K={key:1,initial:{opacity:0,y:100},enter:{opacity:1,y:0,scale:1},variants:{custom:{scale:2}},delay:200,class:"list-none m-0 p-0"},Q={class:"flex items-center mb-1"},W=n("div",{class:"bg-indigo-600 rounded-full h-4 w-4 border-gray-200 border-2 z-10"},null,-1),X={class:"ml-4 font-medium italic"},Y={class:"ml-12 w-100"},Z={class:"col-span-1"},$={class:"text-sm text-gray-600 italic"},v={class:"col-span-3"},k={class:"text-muted text-xs text-orange-600"},B={class:"text-muted text-xs text-sky-800"},A=U({__name:"AuditLog",props:{targetId:String,targetType:String},setup(b){const x=M(()=>P(()=>import("./LoadingMessage-72d34fcf.js"),["assets/LoadingMessage-72d34fcf.js","assets/index-2a6c9271.js","assets/index-88806377.css"])),y=b,{targetType:L,targetId:S}=V(y),f=j(),u=E();u.restLogs();const{auditLogs:w,fetchingAudits:D}=F(u);f.fetchUsers({}),u.fetchAuditLogs({targetType:L?.value,targetId:S?.value});let T=O(()=>f.getUsers);function o(i){const c=T?.value?.find(_=>_.uid?.toString()===i?.toString());return c?c.auth.userName:""}function N(i){return i===1?"created":i===2?"updated":i===3?"deleted":""}function I(i){let c=new Set;return Object.entries(i?.stateBefore)?.map(([_,e])=>{Object.entries(i?.stateAfter)?.map(([t,s])=>{_===t&&e!==s&&(t&&t==="updated_by_uid"&&(t="updated_by",e=o(e),s=o(s)),t&&t==="submitted_by_uid"&&(t="submitted_by",e=o(e),s=o(s)),t&&t==="verified_by_uid"&&(t="verified_by",e=o(e),s=o(s)),t&&t==="updated_at"&&(t="updated_on",e=l(e),s=l(s)),t&&t==="cancelled_by_uid"&&(t="cancelled_by",e=o(e),s=o(s)),t&&t==="received_by_uid"&&(t="received_by",e=o(e),s=o(s)),c.add({key:t,old:e?.length>0?e:"None",new:s?.toString()?.length>0?s:"None"}))})}),c}return(i,c)=>{const _=R("motion");return r(),d("div",q,[G,p(D)?(r(),d("div",J,[z(p(x),{message:"Fetching audit logs ..."})])):C((r(),d("ul",K,[(r(!0),d(m,null,g(p(w),e=>(r(),d("li",{key:e.uid,class:"mb-2"},[n("div",Q,[W,n("div",X,[n("span",null,a(o(e?.userId))+" "+a(N(e?.action))+" "+a(e?.targetType),1),h(" on "),n("span",null,a(p(l)(e?.stateAfter?.updated_at)),1)])]),n("div",Y,[(r(!0),d(m,null,g(I(e),t=>(r(),d("div",{key:t.key,class:"grid grid-cols-4"},[n("span",Z,[n("span",$,a(t?.key),1)]),n("span",v,[n("span",k,a(t?.old),1),h(" â†’ "),n("span",B,a(t?.new),1)])]))),128))])]))),128))])),[[_]])])}}}),et=H(A,[["__file","/home/aurthur/Documents/Development/felicity-lims/webapp/views/components/AuditLog.vue"]]);export{et as default};
