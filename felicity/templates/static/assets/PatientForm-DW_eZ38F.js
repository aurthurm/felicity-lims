import{Y as ae,u as ne,$ as ie,ag as re,av as K,a7 as P,ah as oe,aw as de,a0 as V,aI as me,f as ue,a3 as se,_ as fe,r as z,c as v,o as g,z as u,a as t,K as l,M as o,a4 as S,aK as L,aL as y,F as N,H as C,A as E,I as D,D as ce,E as ge,B as G}from"./index-OdhKCqIc.js";import{Multiselect as Fe}from"./vue-multiselect.esm-Cvm3ZCjW.js";import{c as k,e as ve,a as f,f as W,g as Se,d as be,u as _e,F as Ie}from"./index.esm-BfHj8iGm.js";import{A as Ne,E as Ce}from"./patient.mutations-Ck2KfiSz.js";import{u as Ue}from"./client-BNZY_Y1e.js";import{u as Ee}from"./location-zigt6URg.js";import{u as De}from"./patient-BGl7pq_l.js";import{f as Me}from"./index-CXV6PIcj.js";import{I as Pe}from"./Input-BEm5S0CJ.js";import{F as Ve,a as Oe,b as Be}from"./FormMessage-CgXFMXx9.js";import{F as Le}from"./FormLabel-DxP9wnWS.js";import{S as ye,a as ke,b as xe,c as we,d as Te}from"./SelectValue-Ds0cfAgl.js";/* empty css                                                                 */import"./Label-CS46LzLb.js";import"./useNonce-B4v0IDPb.js";import"./chevron-down-Dqf-ptA3.js";import"./useFocusGuards-Bjb6OG0k.js";import"./PopperContent-BfyCnGUj.js";const qe="__none__",Ye=ae({__name:"PatientForm",props:{patient:{type:Object,required:!1},navigate:{type:Boolean,required:!1,default:!1}},emits:["close"],setup(x,{expose:a,emit:w}){a();const e=x,M=w;let U=Ue(),c=Ee(),b=De();const{withClientMutation:r}=ne();let i=ie(),s=re();const F=K({genders:["Male","Female","Missing","Trans Gender"],createAction:!0,countries:P(()=>c.getCountries),provinces:P(()=>c.getProvinces),districts:P(()=>c.getDistricts),clients:P(()=>U.getClients)});let O=K({first:void 0,after:"",text:"",sortBy:["name"],filterAction:!1});oe(async()=>{await c.fetchCountries(),await U.fetchClients(O),e.patient?.countryUid&&await c.filterProvincesByCountry(e.patient?.countryUid),e.patient?.provinceUid&&await c.filterDistrictsByProvince(e.patient?.provinceUid),await b.fetchIdentifications()});const{patient:d,navigate:T}=de(e),X=V(new Date),B=V(0),q=V(0),Y=V(0),J=()=>{const n=ue().subtract(B.value,"year").subtract(q.value,"month").subtract(Y.value,"day");I("dateOfBirth",n.format("YYYY-MM-DD")),I("age",B.value)},Q=()=>{var n=new Date().getFullYear();if(_.dateOfBirth){const m=new Date(_.dateOfBirth).getFullYear();I("age",n-m)}},h=k({uid:f().nullable(),clientPatientId:f().required("Client Patient ID is Required"),patientId:f().nullable(),firstName:f().required("First Name is Required"),middleName:f().nullable(),lastName:f().required("Last Name is Required"),client:k().required("Client is Required"),gender:f().required("Gender is Required"),age:be().nullable(),dateOfBirth:Se().nullable(),ageDobEstimated:W().nullable(),phoneHome:f().nullable(),phoneMobile:f().nullable(),consentSms:W().nullable(),districtUid:f().nullable(),provinceUid:f().nullable(),countryUid:f().nullable(),identifications:ve().of(k({identificationUid:f().required("Identification type is required"),value:f().required("Identification value is required")})).nullable()}),{handleSubmit:A,values:_,setFieldValue:I}=_e({validationSchema:h,initialValues:{uid:d?.value?.uid,clientPatientId:d?.value?.clientPatientId||s?.query?.cpid,patientId:d?.value?.patientId,firstName:d?.value?.firstName,middleName:d?.value?.middleName,lastName:d?.value?.lastName,client:d?.value?.client,gender:d?.value?.gender,age:d?.value?.age,dateOfBirth:me(d?.value?.dateOfBirth)?void 0:new Date(d?.value?.dateOfBirth).toISOString().split("T")[0],ageDobEstimated:d?.value?.ageDobEstimated,phoneHome:d?.value?.phoneHome,phoneMobile:d?.value?.phoneMobile,consentSms:d?.value?.consentSms,districtUid:d?.value?.districtUid,provinceUid:d?.value?.provinceUid,countryUid:d?.value?.countryUid,identifications:d?.value?.identifications??[]}}),Z=A(n=>{n.uid||R(n),n.uid&&j(n)});function R(n){r(Ne,{payload:{clientPatientId:n.clientPatientId,firstName:n.firstName,middleName:n.middleName,lastName:n.lastName,age:n.age,gender:n.gender,dateOfBirth:n.dateOfBirth?Me(n.dateOfBirth,"YYYY-MM-DD HH:mm"):null,ageDobEstimated:n.ageDobEstimated,clientUid:n.client.uid,phoneMobile:n.phoneMobile,consentSms:n.consentSms,countryUid:n.countryUid,provinceUid:n.provinceUid,districtUid:n.districtUid,identifications:n.identifications}},"createPatient").then(m=>{b.addPatient(m),M("close",m),T.value===!0&&i.push({name:"patient-detail",params:{patientUid:m?.uid}})})}function j(n){r(Ce,{uid:n.uid,payload:{clientPatientId:n.clientPatientId,firstName:n.firstName,middleName:n.middleName,lastName:n.lastName,age:n.age,gender:n.gender,dateOfBirth:n.dateOfBirth?new Date(n.dateOfBirth).toISOString():null,ageDobEstimated:n.ageDobEstimated,clientUid:n.client.uid,phoneMobile:n.phoneMobile,consentSms:n.consentSms,countryUid:n.countryUid,provinceUid:n.provinceUid,districtUid:n.districtUid,identifications:n.identifications?.map(m=>({identificationUid:m.identificationUid,value:m.value}))}},"updatePatient").then(m=>{b.updatePatient(m),M("close",m)})}function p(n){const m=n??_.countryUid;m&&c.filterProvincesByCountry(m)}function $(n){const m=n??_.provinceUid;m&&c.filterDistrictsByProvince(m)}function ee(){const n=_.identifications??[];I("identifications",[...n,{identificationUid:"",value:""}])}function te(n){const m=_.identifications??[];I("identifications",m.filter((Ze,le)=>le!==n))}const H={props:e,emit:M,get clientStore(){return U},set clientStore(n){U=n},get locationsStore(){return c},set locationsStore(n){c=n},get patientStore(){return b},set patientStore(n){b=n},withClientMutation:r,get router(){return i},set router(n){i=n},get route(){return s},set route(n){s=n},state:F,get clientParams(){return O},set clientParams(n){O=n},SELECT_NONE:qe,patient:d,navigate:T,maxDate:X,estimateYears:B,estimateMonths:q,estimateDays:Y,estimateDOB:J,calculateAge:Q,patientSchema:h,handleSubmit:A,values:_,setFieldValue:I,submitPatientForm:Z,addPatient:R,updatePatient:j,getProvinces:p,getDistricts:$,addIdentifier:ee,removeIdentifier:te,get VueMultiselect(){return Fe},get Button(){return se},get Input(){return Pe},get FormControl(){return Be},get FormField(){return Ie},get FormItem(){return Oe},get FormLabel(){return Le},get FormMessage(){return Ve},get Select(){return Te},get SelectContent(){return we},get SelectItem(){return xe},get SelectTrigger(){return ke},get SelectValue(){return ye}};return Object.defineProperty(H,"__isScriptSetup",{enumerable:!1,value:!0}),H}}),he={class:"grid grid-cols-2 gap-6"},Ae={class:"flex items-center justify-between"},Re={class:"flex items-center space-x-2"},je={class:"flex items-center gap-2"},He={class:"flex items-center gap-2"},Ke={class:"flex items-center gap-2"},ze={class:"flex items-center gap-2"},Ge={class:"flex items-center justify-between"},We={class:"space-y-3"},Xe={class:"grid grid-cols-3 gap-6"},Je={class:"flex justify-end"};function Qe(x,a,w,e,M,U){const c=z("Checkbox"),b=z("VueDatePicker");return g(),v("form",{class:"space-y-6",autocomplete:"off",role:"form","aria-label":"Patient Information Form",onSubmit:a[10]||(a[10]=G((...r)=>e.submitPatientForm&&e.submitPatientForm(...r),["prevent"]))},[u("div",he,[t(e.FormField,{name:"clientPatientId"},{default:l(({componentField:r})=>[t(e.FormItem,{class:"col-span-2"},{default:l(()=>[t(e.FormLabel,null,{default:l(()=>[...a[11]||(a[11]=[o("Patient Unique Identifier",-1)])]),_:1}),t(e.FormControl,null,{default:l(()=>[t(e.Input,S(r,{placeholder:"Patient Unique Identifier"}),null,16)]),_:2},1024),t(e.FormMessage)]),_:2},1024)]),_:1}),t(e.FormField,{name:"firstName"},{default:l(({componentField:r})=>[t(e.FormItem,null,{default:l(()=>[t(e.FormLabel,null,{default:l(()=>[...a[12]||(a[12]=[o("First Name",-1)])]),_:1}),t(e.FormControl,null,{default:l(()=>[t(e.Input,S(r,{placeholder:"First Name"}),null,16)]),_:2},1024),t(e.FormMessage)]),_:2},1024)]),_:1}),t(e.FormField,{name:"middleName"},{default:l(({componentField:r})=>[t(e.FormItem,null,{default:l(()=>[t(e.FormLabel,null,{default:l(()=>[...a[13]||(a[13]=[o("Middle Name",-1)])]),_:1}),t(e.FormControl,null,{default:l(()=>[t(e.Input,S(r,{placeholder:"Middle Name"}),null,16)]),_:2},1024),t(e.FormMessage)]),_:2},1024)]),_:1}),t(e.FormField,{name:"lastName"},{default:l(({componentField:r})=>[t(e.FormItem,null,{default:l(()=>[t(e.FormLabel,null,{default:l(()=>[...a[14]||(a[14]=[o("Last Name",-1)])]),_:1}),t(e.FormControl,null,{default:l(()=>[t(e.Input,S(r,{placeholder:"Last Name"}),null,16)]),_:2},1024),t(e.FormMessage)]),_:2},1024)]),_:1}),t(e.FormField,{name:"gender"},{default:l(({componentField:r})=>[t(e.FormItem,null,{default:l(()=>[t(e.FormLabel,null,{default:l(()=>[...a[15]||(a[15]=[o("Gender",-1)])]),_:1}),t(e.FormControl,null,{default:l(()=>[t(e.Select,L(y(r)),{default:l(()=>[t(e.SelectTrigger,null,{default:l(()=>[t(e.SelectValue,{placeholder:"Select gender"})]),_:1}),t(e.SelectContent,null,{default:l(()=>[(g(!0),v(N,null,C(e.state.genders,i=>(g(),E(e.SelectItem,{key:i,value:i},{default:l(()=>[o(D(i),1)]),_:2},1032,["value"]))),128))]),_:1})]),_:1},16)]),_:2},1024),t(e.FormMessage)]),_:2},1024)]),_:1}),t(e.FormField,{name:"phoneMobile"},{default:l(({componentField:r})=>[t(e.FormItem,null,{default:l(()=>[t(e.FormLabel,null,{default:l(()=>[...a[16]||(a[16]=[o("Mobile Number",-1)])]),_:1}),t(e.FormControl,null,{default:l(()=>[t(e.Input,S(r,{placeholder:"Mobile Number"}),null,16)]),_:2},1024),t(e.FormMessage)]),_:2},1024)]),_:1}),t(e.FormField,{name:"consentSms",type:"checkbox","checked-value":!0,"unchecked-value":!1},{default:l(({componentField:r})=>[t(e.FormItem,{class:"flex items-center space-x-2"},{default:l(()=>[t(e.FormControl,null,{default:l(()=>[t(c,L(y(r)),null,16)]),_:2},1024),t(e.FormLabel,null,{default:l(()=>[...a[17]||(a[17]=[o("Consent to SMS",-1)])]),_:1}),t(e.FormMessage)]),_:2},1024)]),_:1}),t(e.FormField,{name:"ageDobEstimated",type:"checkbox","checked-value":!0,"unchecked-value":!1},{default:l(({componentField:r})=>[t(e.FormItem,{class:"col-span-2"},{default:l(()=>[u("div",Ae,[u("div",Re,[t(e.FormControl,null,{default:l(()=>[t(c,L(y(r)),null,16)]),_:2},1024),t(e.FormLabel,null,{default:l(()=>[...a[18]||(a[18]=[o("Age/DOB Estimated?",-1)])]),_:1})]),ce(u("div",je,[u("label",He,[a[19]||(a[19]=u("span",null,"Years",-1)),t(e.Input,{type:"number",min:"0",class:"w-24",modelValue:e.estimateYears,"onUpdate:modelValue":a[0]||(a[0]=i=>e.estimateYears=i),onChange:a[1]||(a[1]=i=>e.estimateDOB()),onKeyup:a[2]||(a[2]=i=>e.estimateDOB())},null,8,["modelValue"])]),u("label",Ke,[a[20]||(a[20]=u("span",null,"Months",-1)),t(e.Input,{type:"number",min:"0",max:"12",class:"w-24",modelValue:e.estimateMonths,"onUpdate:modelValue":a[3]||(a[3]=i=>e.estimateMonths=i),onChange:a[4]||(a[4]=i=>e.estimateDOB()),onKeyup:a[5]||(a[5]=i=>e.estimateDOB())},null,8,["modelValue"])]),u("label",ze,[a[21]||(a[21]=u("span",null,"Days",-1)),t(e.Input,{type:"number",min:"0",max:"365",class:"w-24",modelValue:e.estimateDays,"onUpdate:modelValue":a[6]||(a[6]=i=>e.estimateDays=i),onChange:a[7]||(a[7]=i=>e.estimateDOB()),onKeyup:a[8]||(a[8]=i=>e.estimateDOB())},null,8,["modelValue"])])],512),[[ge,e.values.ageDobEstimated]])]),t(e.FormMessage)]),_:2},1024)]),_:1}),t(e.FormField,{name:"dateOfBirth"},{default:l(({componentField:r})=>[t(e.FormItem,null,{default:l(()=>[t(e.FormLabel,null,{default:l(()=>[...a[22]||(a[22]=[o("Date of Birth",-1)])]),_:1}),t(e.FormControl,null,{default:l(()=>[t(b,S({class:"z-60 disabled:bg-muted"},r,{disabled:e.values.ageDobEstimated,onClosed:a[9]||(a[9]=i=>e.calculateAge()),"max-date":e.maxDate}),null,16,["disabled","max-date"])]),_:2},1024),t(e.FormMessage)]),_:2},1024)]),_:1}),t(e.FormField,{name:"age"},{default:l(({componentField:r})=>[t(e.FormItem,null,{default:l(()=>[t(e.FormLabel,null,{default:l(()=>[...a[23]||(a[23]=[o("Age",-1)])]),_:1}),t(e.FormControl,null,{default:l(()=>[t(e.Input,S(r,{type:"number",disabled:""}),null,16)]),_:2},1024),t(e.FormMessage)]),_:2},1024)]),_:1}),t(e.FormField,{name:"client"},{default:l(({componentField:r})=>[t(e.FormItem,{class:"col-span-2"},{default:l(()=>[t(e.FormLabel,null,{default:l(()=>[...a[24]||(a[24]=[o("Primary Referrer",-1)])]),_:1}),t(e.FormControl,null,{default:l(()=>[t(e.VueMultiselect,S(r,{placeholder:"Select a Primary Referrer",options:e.state.clients,searchable:!0,label:"name","track-by":"uid"}),null,16,["options"])]),_:2},1024),t(e.FormMessage)]),_:2},1024)]),_:1}),t(e.FormField,{name:"identifications"},{default:l(({value:r})=>[t(e.FormItem,{class:"col-span-2"},{default:l(()=>[u("div",Ge,[t(e.FormLabel,null,{default:l(()=>[...a[25]||(a[25]=[o("Extra IDs",-1)])]),_:1}),t(e.Button,{type:"button",variant:"outline",size:"sm",onClick:e.addIdentifier},{default:l(()=>[...a[26]||(a[26]=[o(" Add ",-1)])]),_:1})]),t(e.FormControl,null,{default:l(()=>[u("div",We,[(g(!0),v(N,null,C(r||[],(i,s)=>(g(),v("div",{key:s,class:"grid grid-cols-[1fr_1fr_auto] items-center gap-4"},[t(e.Select,{"model-value":i.identificationUid||e.SELECT_NONE,"onUpdate:modelValue":F=>e.setFieldValue(`identifications.${s}.identificationUid`,F===e.SELECT_NONE?"":F)},{default:l(()=>[t(e.SelectTrigger,null,{default:l(()=>[t(e.SelectValue,{placeholder:"Identification"})]),_:1}),t(e.SelectContent,null,{default:l(()=>[t(e.SelectItem,{value:e.SELECT_NONE},{default:l(()=>[...a[27]||(a[27]=[o("Select Identification",-1)])]),_:1}),(g(!0),v(N,null,C(e.patientStore.identifications,F=>(g(),E(e.SelectItem,{key:F.uid,value:F.uid},{default:l(()=>[o(D(F.name),1)]),_:2},1032,["value"]))),128))]),_:1})]),_:1},8,["model-value","onUpdate:modelValue"]),t(e.Input,{"model-value":i.value,placeholder:"Value","onUpdate:modelValue":F=>e.setFieldValue(`identifications.${s}.value`,F)},null,8,["model-value","onUpdate:modelValue"]),t(e.Button,{type:"button",variant:"ghost",onClick:G(F=>e.removeIdentifier(s),["prevent"])},{default:l(()=>[...a[28]||(a[28]=[o(" X ",-1)])]),_:1},8,["onClick"])]))),128))])]),_:2},1024),t(e.FormMessage)]),_:2},1024)]),_:1})]),a[36]||(a[36]=u("hr",{class:"border-border"},null,-1)),u("div",Xe,[t(e.FormField,{name:"countryUid"},{default:l(({componentField:r})=>[t(e.FormItem,null,{default:l(()=>[t(e.FormLabel,null,{default:l(()=>[...a[29]||(a[29]=[o("Country",-1)])]),_:1}),t(e.FormControl,null,{default:l(()=>[t(e.Select,{"model-value":r.modelValue||e.SELECT_NONE,"onUpdate:modelValue":i=>{const s=i===e.SELECT_NONE?"":i;r["onUpdate:modelValue"]?.(s),e.getProvinces(s)}},{default:l(()=>[t(e.SelectTrigger,null,{default:l(()=>[t(e.SelectValue,{placeholder:"Select country"})]),_:1}),t(e.SelectContent,null,{default:l(()=>[t(e.SelectItem,{value:e.SELECT_NONE},{default:l(()=>[...a[30]||(a[30]=[o("Select country",-1)])]),_:1}),(g(!0),v(N,null,C(e.state.countries,i=>(g(),E(e.SelectItem,{key:i.uid,value:i.uid},{default:l(()=>[o(D(i.name),1)]),_:2},1032,["value"]))),128))]),_:1})]),_:1},8,["model-value","onUpdate:modelValue"])]),_:2},1024),t(e.FormMessage)]),_:2},1024)]),_:1}),t(e.FormField,{name:"provinceUid"},{default:l(({componentField:r})=>[t(e.FormItem,null,{default:l(()=>[t(e.FormLabel,null,{default:l(()=>[...a[31]||(a[31]=[o("Province",-1)])]),_:1}),t(e.FormControl,null,{default:l(()=>[t(e.Select,{"model-value":r.modelValue||e.SELECT_NONE,"onUpdate:modelValue":i=>{const s=i===e.SELECT_NONE?"":i;r["onUpdate:modelValue"]?.(s),e.getDistricts(s)}},{default:l(()=>[t(e.SelectTrigger,null,{default:l(()=>[t(e.SelectValue,{placeholder:"Select province"})]),_:1}),t(e.SelectContent,null,{default:l(()=>[t(e.SelectItem,{value:e.SELECT_NONE},{default:l(()=>[...a[32]||(a[32]=[o("Select province",-1)])]),_:1}),(g(!0),v(N,null,C(e.state.provinces,i=>(g(),E(e.SelectItem,{key:i.uid,value:i.uid},{default:l(()=>[o(D(i.name),1)]),_:2},1032,["value"]))),128))]),_:1})]),_:1},8,["model-value","onUpdate:modelValue"])]),_:2},1024),t(e.FormMessage)]),_:2},1024)]),_:1}),t(e.FormField,{name:"districtUid"},{default:l(({componentField:r})=>[t(e.FormItem,null,{default:l(()=>[t(e.FormLabel,null,{default:l(()=>[...a[33]||(a[33]=[o("District",-1)])]),_:1}),t(e.FormControl,null,{default:l(()=>[t(e.Select,{"model-value":r.modelValue||e.SELECT_NONE,"onUpdate:modelValue":i=>r["onUpdate:modelValue"]?.(i===e.SELECT_NONE?"":i)},{default:l(()=>[t(e.SelectTrigger,null,{default:l(()=>[t(e.SelectValue,{placeholder:"Select district"})]),_:1}),t(e.SelectContent,null,{default:l(()=>[t(e.SelectItem,{value:e.SELECT_NONE},{default:l(()=>[...a[34]||(a[34]=[o("Select district",-1)])]),_:1}),(g(!0),v(N,null,C(e.state.districts,i=>(g(),E(e.SelectItem,{key:i.uid,value:i.uid},{default:l(()=>[o(D(i.name),1)]),_:2},1032,["value"]))),128))]),_:1})]),_:1},8,["model-value","onUpdate:modelValue"])]),_:2},1024),t(e.FormMessage)]),_:2},1024)]),_:1})]),u("div",Je,[t(e.Button,{type:"submit"},{default:l(()=>[...a[35]||(a[35]=[o("Save Patient",-1)])]),_:1})])],32)}const vt=fe(Ye,[["render",Qe],["__file","/home/administrator/Documents/Development/beak-insights/felicity/felicity-lims/webapp/components/person/PatientForm.vue"]]);export{vt as default};
