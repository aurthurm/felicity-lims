import{Y as se,u as oe,a0 as g,ah as ie,aq as ne,a3 as le,_ as re,r as y,c as d,o as a,a as n,z as o,A as U,C as E,K as i,M as m,F as k,H as C,I as f,B as ae,D,al as M}from"./index-OdhKCqIc.js";import{c as de,e as R,a as V,u as ce,b as B}from"./index.esm-BfHj8iGm.js";import{g as ue,a as me,X as fe,Y as be,Z as ge}from"./microbiology.mutations-cVAbKt4K.js";import{E as pe,a as xe,b as ve,c as _e,d as ye}from"./EmptyTitle-aCQRDpx3.js";import{P as he}from"./PageHeading-Czi_4opS.js";const Ae=se({__name:"AstPanel",setup(Y,{expose:t}){t();const{withClientMutation:P,withClientQuery:e}=oe(),S=g(!1),F=g(""),x=g(!0),h=g(null),O=g(""),v=g(""),_=g([]),A=g([]),w=g([]),b=g([]),T=g([]),s=de({name:V().trim().required("Panel name is required"),selectedAntibiotics:R().of(V().trim()).min(1,"Select at least one antibiotic"),selectedOrganisms:R().of(V().trim()).min(1,"Select at least one organism")}),{handleSubmit:r,resetForm:p,setValues:L,errors:K}=ce({validationSchema:s,initialValues:{name:"",description:"",selectedAntibiotics:[],selectedOrganisms:[]}}),{value:Q}=B("name"),{value:W}=B("description"),{value:X}=B("selectedAntibiotics"),{value:j}=B("selectedOrganisms");ie(()=>{I(),H(),q()});function I(){e(ue,{},"abxLaboratoryAntibiotics").then(l=>{l&&(A.value=l,w.value=[...A.value])})}function H(){e(me,{text:O.value,pageSize:25,sortBy:["name"]},"abxOrganismAll").then(l=>{b.value=b.value?.filter(c=>j.value.includes(c.uid))||[],b.value=ne(b.value,l?.items,"uid"),T.value=[...b.value]})}function q(){e(fe,{},"abxAstPanelAll").then(l=>{l&&(_.value=l,_.value.forEach(c=>c.organisms?.forEach(u=>b.value.push(u))))})}function Z(l,c={}){x.value=l,S.value=!0,F.value=(l?"Create":"Edit")+" AST Panel",l?(h.value=null,p()):(h.value=c.uid??null,L({name:c.name??"",description:c.description??"",selectedAntibiotics:c.antibiotics?.map(u=>u.uid)||[],selectedOrganisms:c.organisms?.map(u=>u.uid)||[]}))}const J=r(l=>{const c={name:l.name,description:l.description,antibiotics:l.selectedAntibiotics,organisms:l.selectedOrganisms};x.value?P(be,{payload:c},"createAbxAstPanel").then(u=>{u&&_.value.unshift(u)}):h.value&&P(ge,{uid:h.value,payload:c},"updateAbxAstPanel").then(u=>{if(u){const z=_.value.findIndex(N=>N.uid===u.uid);z>-1&&(_.value=[..._.value.map((N,te)=>te===z?u:N)])}}),S.value=!1});function $(){if(!v.value){w.value=[...A.value];return}w.value=A.value.filter(l=>l.name.toLowerCase().includes(v.value.toLowerCase()))}function ee(){if(!O.value){T.value=[...b.value];return}H()}const G={withClientMutation:P,withClientQuery:e,showModal:S,formTitle:F,formAction:x,currentUid:h,searchOrgText:O,searchAbxText:v,panels:_,antibiotics:A,filteredAntibiotics:w,organisms:b,filteredOrganisms:T,astPanelSchema:s,handleSubmit:r,resetForm:p,setValues:L,errors:K,name:Q,description:W,selectedAntibiotics:X,selectedOrganisms:j,fetchAntibiotics:I,fetchOrganisms:H,fetchPanels:q,FormManager:Z,saveForm:J,filterAntibiotics:$,filterOrganisms:ee,get Button(){return le},get Empty(){return ye},get EmptyContent(){return _e},get EmptyDescription(){return ve},get EmptyHeader(){return xe},get EmptyTitle(){return pe},PageHeading:he};return Object.defineProperty(G,"__isScriptSetup",{enumerable:!1,value:!0}),G}}),we={class:"border border-border bg-card rounded-lg shadow-md"},ke={class:"relative w-full overflow-auto"},Oe=["onClick"],Te={class:"text-xl font-semibold text-foreground"},Ee={class:"space-y-4 max-h-[70vh] overflow-y-auto"},Ce={class:"grid grid-cols-1 gap-4"},Pe={class:"block"},Se={key:0,class:"text-sm text-destructive"},De={class:"block"},Me={class:"flex flex-nowrap gap-4"},Be={class:"min-w-0 flex-1 space-y-2"},Fe={class:"block"},He={class:"border border-border rounded-md p-2 h-64 overflow-y-auto"},Ne={class:"ml-2 text-sm text-foreground"},Ue={key:0,class:"text-sm text-destructive"},Ve={class:"w-48 shrink-0"},Le={class:"border border-border rounded-md p-2 h-64 overflow-y-auto bg-muted/30"},je={class:"text-sm text-foreground"},Ie=["onClick"],qe={class:"flex flex-nowrap gap-4"},Ge={class:"min-w-0 flex-1 space-y-2"},ze={class:"block"},Re={class:"border border-border rounded-md p-2 h-64 overflow-y-auto"},Ye={class:"ml-2 text-sm text-foreground"},Ke={key:0,class:"text-sm text-destructive"},Qe={class:"w-48 shrink-0"},We={class:"border border-border rounded-md p-2 h-64 overflow-y-auto bg-muted/30"},Xe={class:"text-sm text-foreground"},Ze=["onClick"];function Je(Y,t,P,e,S,F){const x=y("TableHead"),h=y("TableRow"),O=y("TableHeader"),v=y("TableCell"),_=y("TableEmpty"),A=y("TableBody"),w=y("Table"),b=y("Checkbox"),T=y("Modal");return a(),d(k,null,[n(e.PageHeading,{title:"AST Panels"},{default:i(()=>[n(e.Button,{onClick:t[0]||(t[0]=s=>e.FormManager(!0))},{default:i(()=>[...t[7]||(t[7]=[m("Add Panel",-1)])]),_:1})]),_:1}),o("div",we,[o("div",ke,[n(w,{class:"w-full caption-bottom text-sm"},{default:i(()=>[n(O,{class:"[&_tr]:border-b"},{default:i(()=>[n(h,{class:"border-b transition-colors hover:bg-muted/50 data-[state=selected]:bg-muted"},{default:i(()=>[n(x,{class:"h-12 px-4 text-left align-middle font-medium text-muted-foreground"},{default:i(()=>[...t[8]||(t[8]=[m("Name",-1)])]),_:1}),n(x,{class:"h-12 px-4 text-left align-middle font-medium text-muted-foreground"},{default:i(()=>[...t[9]||(t[9]=[m("Description",-1)])]),_:1}),n(x,{class:"h-12 px-4 text-left align-middle font-medium text-muted-foreground"},{default:i(()=>[...t[10]||(t[10]=[m("Organisms",-1)])]),_:1}),n(x,{class:"h-12 px-4 text-left align-middle font-medium text-muted-foreground"},{default:i(()=>[...t[11]||(t[11]=[m("Antibiotics",-1)])]),_:1}),n(x,{class:"h-12 px-4 text-right align-middle font-medium text-muted-foreground"},{default:i(()=>[...t[12]||(t[12]=[m("Actions",-1)])]),_:1})]),_:1})]),_:1}),n(A,{class:"[&_tr:last-child]:border-0"},{default:i(()=>[(a(!0),d(k,null,C(e.panels,s=>(a(),U(h,{key:s?.uid,class:"border-b transition-colors hover:bg-muted/50 data-[state=selected]:bg-muted"},{default:i(()=>[n(v,{class:"px-4 py-3 align-middle whitespace-nowrap text-sm text-foreground"},{default:i(()=>[m(f(s?.name),1)]),_:2},1024),n(v,{class:"px-4 py-3 align-middle whitespace-nowrap text-sm text-foreground"},{default:i(()=>[m(f(s?.description),1)]),_:2},1024),n(v,{class:"px-4 py-3 align-middle whitespace-nowrap text-sm text-foreground"},{default:i(()=>[m(f(s?.organisms?.map(r=>r.name).join(", ")),1)]),_:2},1024),n(v,{class:"px-4 py-3 align-middle whitespace-nowrap text-sm text-foreground"},{default:i(()=>[m(f(s?.antibiotics?.map(r=>r.name).join(", ")),1)]),_:2},1024),n(v,{class:"px-4 py-3 align-middle text-right text-sm"},{default:i(()=>[o("button",{onClick:r=>e.FormManager(!1,s),class:"px-3 py-1.5 bg-primary text-primary-foreground rounded-sm transition duration-300 hover:bg-primary/90 focus:outline-none focus:ring-2 focus:ring-primary focus:ring-offset-2"}," Edit ",8,Oe)]),_:2},1024)]),_:2},1024))),128)),!e.panels||e.panels.length===0?(a(),U(_,{key:0,colspan:5},{default:i(()=>[n(e.Empty,{class:"border-0 bg-transparent p-0"},{default:i(()=>[n(e.EmptyContent,null,{default:i(()=>[n(e.EmptyHeader,null,{default:i(()=>[n(e.EmptyTitle,null,{default:i(()=>[...t[13]||(t[13]=[m("No AST panels found",-1)])]),_:1}),n(e.EmptyDescription,null,{default:i(()=>[...t[14]||(t[14]=[m("Add a panel to get started.",-1)])]),_:1})]),_:1})]),_:1})]),_:1})]),_:1})):E("",!0)]),_:1})]),_:1})])]),e.showModal?(a(),U(T,{key:0,onClose:t[6]||(t[6]=s=>e.showModal=!1),contentWidth:"max-w-4xl w-[90vw]"},{header:i(()=>[o("h3",Te,f(e.formTitle),1)]),body:i(()=>[o("form",{onSubmit:t[5]||(t[5]=ae((...s)=>e.saveForm&&e.saveForm(...s),["prevent"])),class:"space-y-6 p-4"},[o("div",Ee,[o("div",Ce,[o("label",Pe,[t[15]||(t[15]=o("span",{class:"text-sm font-medium text-foreground"},"Panel Name",-1)),D(o("input",{"onUpdate:modelValue":t[1]||(t[1]=s=>e.name=s),class:"flex h-10 w-full rounded-md border border-input bg-background px-3 py-2 text-sm ring-offset-background file:border-0 file:bg-transparent file:text-sm file:font-medium placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50",placeholder:"Enter panel name"},null,512),[[M,e.name]]),e.errors.name?(a(),d("p",Se,f(e.errors.name),1)):E("",!0)]),o("label",De,[t[16]||(t[16]=o("span",{class:"text-sm font-medium text-foreground"},"Description",-1)),D(o("textarea",{"onUpdate:modelValue":t[2]||(t[2]=s=>e.description=s),rows:"2",class:"flex h-10 w-full rounded-md border border-input bg-background px-3 py-2 text-sm ring-offset-background file:border-0 file:bg-transparent file:text-sm file:font-medium placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50",placeholder:"Enter description"},null,512),[[M,e.description]])])]),o("div",Me,[o("div",Be,[o("label",Fe,[t[17]||(t[17]=o("span",{class:"text-sm font-medium text-foreground"},"Search Organisms",-1)),D(o("input",{"onUpdate:modelValue":t[3]||(t[3]=s=>e.searchOrgText=s),onInput:e.filterOrganisms,class:"flex h-10 w-full rounded-md border border-input bg-background px-3 py-2 text-sm ring-offset-background file:border-0 file:bg-transparent file:text-sm file:font-medium placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50",placeholder:"Search organisms..."},null,544),[[M,e.searchOrgText]])]),o("div",He,[(a(!0),d(k,null,C(e.filteredOrganisms,s=>(a(),d("div",{key:s.uid,class:"flex items-center py-1"},[n(b,{checked:e.selectedOrganisms.includes(s.uid),"onUpdate:checked":r=>{e.selectedOrganisms=r?e.selectedOrganisms.includes(s.uid)?e.selectedOrganisms:[...e.selectedOrganisms,s.uid]:e.selectedOrganisms.filter(p=>p!==s.uid)}},null,8,["checked","onUpdate:checked"]),o("span",Ne,f(s.name),1)]))),128))]),e.errors.selectedOrganisms?(a(),d("p",Ue,f(e.errors.selectedOrganisms),1)):E("",!0)]),o("div",Ve,[t[18]||(t[18]=o("div",{class:"text-sm font-medium text-foreground mb-1"},"Selected Organisms",-1)),o("div",Le,[(a(!0),d(k,null,C(e.selectedOrganisms,s=>(a(),d("div",{key:s,class:"flex items-center justify-between py-1 px-2 mb-1 bg-background rounded-md shadow-sm"},[o("span",je,f(e.organisms?.find(r=>r.uid===s)?.name),1),o("button",{onClick:r=>e.selectedOrganisms=e.selectedOrganisms.filter(p=>p!==s),class:"text-destructive hover:text-destructive/80 text-sm"}," × ",8,Ie)]))),128))])])]),o("div",qe,[o("div",Ge,[o("label",ze,[t[19]||(t[19]=o("span",{class:"text-sm font-medium text-foreground"},"Search Antibiotics",-1)),D(o("input",{"onUpdate:modelValue":t[4]||(t[4]=s=>e.searchAbxText=s),onInput:e.filterAntibiotics,class:"flex h-10 w-full rounded-md border border-input bg-background px-3 py-2 text-sm ring-offset-background file:border-0 file:bg-transparent file:text-sm file:font-medium placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50",placeholder:"Search antibiotics..."},null,544),[[M,e.searchAbxText]])]),o("div",Re,[(a(!0),d(k,null,C(e.filteredAntibiotics,s=>(a(),d("div",{key:s.uid,class:"flex items-center py-1"},[n(b,{checked:e.selectedAntibiotics.includes(s.uid),"onUpdate:checked":r=>{e.selectedAntibiotics=r?e.selectedAntibiotics.includes(s.uid)?e.selectedAntibiotics:[...e.selectedAntibiotics,s.uid]:e.selectedAntibiotics.filter(p=>p!==s.uid)}},null,8,["checked","onUpdate:checked"]),o("span",Ye,f(s.name),1)]))),128))]),e.errors.selectedAntibiotics?(a(),d("p",Ke,f(e.errors.selectedAntibiotics),1)):E("",!0)]),o("div",Qe,[t[20]||(t[20]=o("div",{class:"text-sm font-medium text-foreground mb-1"},"Selected Antibiotics",-1)),o("div",We,[(a(!0),d(k,null,C(e.selectedAntibiotics,s=>(a(),d("div",{key:s,class:"flex items-center justify-between py-1 px-2 mb-1 bg-background rounded-md shadow-sm"},[o("span",Xe,f(e.antibiotics.find(r=>r.uid==s)?.name),1),o("button",{onClick:r=>e.selectedAntibiotics=e.selectedAntibiotics.filter(p=>p!==s),class:"text-destructive hover:text-destructive/80 text-sm"}," × ",8,Ze)]))),128))])])])]),t[21]||(t[21]=o("div",{class:"mt-6"},[o("button",{type:"submit",class:"w-full bg-primary text-primary-foreground rounded-sm px-4 py-2 transition-colors duration-300 hover:bg-primary/90 focus:outline-none focus:ring-2 focus:ring-primary focus:ring-offset-2"}," Save Panel ")],-1))],32)]),_:1})):E("",!0)],64)}const it=re(Ae,[["render",Je],["__scopeId","data-v-195d3b3a"],["__file","/home/administrator/Documents/Development/beak-insights/felicity/felicity-lims/webapp/views/admin/microbiology/astpanel/AstPanel.vue"]]);export{it as default};
