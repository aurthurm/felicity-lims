import{Y as J,u as X,a0 as d,ah as Z,bw as G,a7 as $,_ as ee,r as k,c,o as i,z as n,A as L,C as y,K as x,a as f,M,I as m,F as te,H as oe,ap as ne,N as re}from"./index-OdhKCqIc.js";import{g as ae,h as se,D as ie,i as le}from"./grind.queries-D_H4x9UG.js";import{E as de,a as ce,b as ue,c as fe,d as me}from"./EmptyTitle-aCQRDpx3.js";const pe=J({__name:"ErrandFile",props:{errandUid:{type:String,required:!0}},setup(F,{expose:s}){s();const b=F,{withClientMutation:t,withClientQuery:D}=X(),w=d(null),v=d(null);Z(()=>{B()});const u=d(!1),l=d(null),r=d(null),h=d(!1),p=d(null),C=d(!1),g=d([]),B=()=>{D(ae,{target:G.Errand,targetUid:b.errandUid},"grindMediaByTarget").then(e=>{e&&(g.value=e)})},T=e=>{t(se,{payload:e},"createGrindMedia").then(o=>{o&&(g.value=[o,...g.value])})},P=e=>{w.value=e,v.value=null,t(ie,{uid:e},"deleteGrindMedia").then(o=>{o&&(g.value=g.value.filter(a=>a.uid!==e))}).catch(o=>{v.value=o?.message||"Failed to delete file"}).finally(()=>{w.value=null})},W=e=>{const o=parseInt(e);return o<1024?`${o} B`:o<1024*1024?`${(o/1024).toFixed(1)} KB`:`${(o/(1024*1024)).toFixed(1)} MB`},j=e=>{const{mimetype:o,filename:a}=e;return o?.startsWith("image/")?"image":o?.includes("pdf")||a.endsWith(".pdf")?"pdf":o?.includes("word")||a.endsWith(".doc")||a.endsWith(".docx")?"doc":o?.includes("sheet")||a.endsWith(".xls")||a.endsWith(".xlsx")?"excel":"file"},A=e=>{try{D(le,{uid:e.uid},"downloadGrindMediaFile").then(o=>{const a=atob(o.content),S=new Uint8Array(a.length);for(let E=0;E<a.length;E++)S[E]=a.charCodeAt(E);const Y=new Blob([S],{type:o.mimetype}),I=URL.createObjectURL(Y),_=document.createElement("a");_.href=I,_.download=o.filename,document.body.appendChild(_),_.click(),setTimeout(()=>{document.body.removeChild(_),URL.revokeObjectURL(I)},0)})}catch{}},U=e=>{if(p.value=null,l.value=e,e.type.startsWith("image/")){const o=new FileReader;o.onload=a=>{r.value=a.target?.result},o.readAsDataURL(e)}else r.value=null},N=async()=>{if(l.value){h.value=!0,p.value=null;try{const e=await T({file:l.value,target:G.Errand,targetUid:b.errandUid});e?.error?p.value=e.error.message:C.value=!0}catch(e){p.value=e instanceof Error?e.message:"Upload failed"}finally{h.value=!1}}},R=e=>{const o=e.target;o.files&&o.files.length>0&&U(o.files[0])},O=e=>{e.preventDefault(),e.stopPropagation(),u.value=!0},H=e=>{e.preventDefault(),e.stopPropagation(),u.value=!1},V=e=>{e.preventDefault(),e.stopPropagation(),u.value=!0},K=e=>{e.preventDefault(),e.stopPropagation(),u.value=!1,e.dataTransfer&&e.dataTransfer.files.length>0&&U(e.dataTransfer.files[0])},q=()=>{l.value=null,r.value=null,C.value=!1,p.value=null},Q=$(()=>{if(!l.value)return"";const e=l.value.size;return e<1024?`${e} B`:e<1024*1024?`${(e/1024).toFixed(1)} KB`:`${(e/(1024*1024)).toFixed(1)} MB`}),z={props:b,withClientMutation:t,withClientQuery:D,isDeleting:w,deleteError:v,isDragging:u,file:l,filePreview:r,isUploading:h,uploadError:p,uploadSuccess:C,errandFiles:g,getFiles:B,uploadFile:T,deleteFile:P,formatFileSize:W,getFileIcon:j,downloadFile:A,handleFileSelect:U,handleUpload:N,onFileInputChange:R,onDragEnter:O,onDragLeave:H,onDragOver:V,onDrop:K,resetUpload:q,fileSize:Q,get Empty(){return me},get EmptyContent(){return fe},get EmptyDescription(){return ue},get EmptyHeader(){return ce},get EmptyTitle(){return de}};return Object.defineProperty(z,"__isScriptSetup",{enumerable:!1,value:!0}),z}}),ge={class:"bg-background rounded-lg shadow-sm border border-border p-6 space-y-6"},ve={class:"flex justify-between items-start"},he={class:"w-3/4 pr-4 space-y-4"},_e={key:1,class:"p-3 bg-destructive/10 text-destructive rounded-md"},ye={key:2,class:"space-y-2"},xe={class:"flex items-center space-x-3"},be={class:"text-muted-foreground"},De={class:"text-sm font-medium text-foreground"},we={class:"text-xs text-muted-foreground"},Ee={class:"flex items-center space-x-2"},Fe=["onClick"],Ce=["onClick","disabled"],Ue={class:"w-1/4 pl-4"},ke={key:0,class:"space-y-2"},Me={class:"text-sm text-muted-foreground"},Be={key:1,class:"space-y-3"},Te=["src"],ze={class:"text-sm"},Se={class:"font-medium text-foreground"},Ie={class:"text-muted-foreground"},Ge={class:"flex justify-center space-x-2"},Le=["disabled"],Pe={key:1,class:"text-sm text-destructive"};function We(F,s,b,t,D,w){const v=k("DownloadIcon"),u=k("TrashIcon"),l=k("UploadIcon");return i(),c("div",ge,[n("div",ve,[n("div",he,[s[3]||(s[3]=n("h3",{class:"text-lg font-medium text-foreground"},"Uploaded Files",-1)),t.errandFiles.length===0?(i(),L(t.Empty,{key:0},{default:x(()=>[f(t.EmptyContent,null,{default:x(()=>[f(t.EmptyHeader,null,{default:x(()=>[f(t.EmptyTitle,null,{default:x(()=>[...s[1]||(s[1]=[M("No files uploaded",-1)])]),_:1}),f(t.EmptyDescription,null,{default:x(()=>[...s[2]||(s[2]=[M("Upload a file to get started.",-1)])]),_:1})]),_:1})]),_:1})]),_:1})):y("",!0),t.deleteError?(i(),c("div",_e,m(t.deleteError),1)):y("",!0),t.errandFiles.length>0?(i(),c("ul",ye,[(i(!0),c(te,null,oe(t.errandFiles,r=>(i(),c("li",{key:r.uid,class:"flex items-center justify-between p-3 bg-muted rounded-md hover:bg-muted/80 transition-colors duration-200"},[n("div",xe,[n("span",be,[(i(),L(ne(t.getFileIcon(r)),{class:"w-5 h-5"}))]),n("div",null,[n("p",De,m(r.filename),1),n("p",we,m(t.formatFileSize(r.size)),1)])]),n("div",Ee,[n("button",{onClick:h=>t.downloadFile(r),class:"p-1 text-muted-foreground hover:text-foreground transition-colors duration-200",title:"Download file"},[f(v,{class:"w-5 h-5"})],8,Fe),n("button",{onClick:h=>t.deleteFile(r.uid),class:"p-1 text-muted-foreground hover:text-destructive transition-colors duration-200",disabled:t.isDeleting===r.uid,title:"Delete file"},[f(u,{class:"w-5 h-5"})],8,Ce)])]))),128))])):y("",!0)]),n("div",Ue,[n("div",{class:re(["border-2 border-dashed border-border rounded-lg p-6 text-center",{"border-primary bg-primary/5":t.isDragging}]),onDragenter:t.onDragEnter,onDragleave:t.onDragLeave,onDragover:t.onDragOver,onDrop:t.onDrop},[n("input",{type:"file",class:"hidden",ref:"fileInput",onChange:t.onFileInputChange},null,544),t.file?(i(),c("div",Be,[t.filePreview?(i(),c("img",{key:0,src:t.filePreview,class:"max-h-32 mx-auto rounded-md",alt:"File preview"},null,8,Te)):y("",!0),n("div",ze,[n("p",Se,m(t.file.name),1),n("p",Ie,m(t.fileSize),1)]),n("div",Ge,[n("button",{onClick:t.resetUpload,class:"px-3 py-1 text-sm font-medium text-foreground bg-background border border-border rounded-md shadow-sm hover:bg-muted focus:outline-none focus:ring-2 focus:ring-primary focus:ring-offset-2 transition-colors duration-200"}," Cancel "),n("button",{onClick:t.handleUpload,disabled:t.isUploading,class:"px-3 py-1 text-sm font-medium text-primary-foreground bg-primary border border-transparent rounded-md shadow-sm hover:bg-primary/90 focus:outline-none focus:ring-2 focus:ring-primary focus:ring-offset-2 transition-colors duration-200"},m(t.isUploading?"Uploading...":"Upload"),9,Le)]),t.uploadError?(i(),c("p",Pe,m(t.uploadError),1)):y("",!0)])):(i(),c("div",ke,[f(l,{class:"w-8 h-8 mx-auto text-muted-foreground"}),n("p",Me,[s[4]||(s[4]=M(" Drag and drop a file here, or ",-1)),n("button",{onClick:s[0]||(s[0]=r=>F.$refs.fileInput.click()),class:"text-primary hover:text-primary/80 transition-colors duration-200"}," browse ")])]))],34)])])])}const Re=ee(pe,[["render",We],["__scopeId","data-v-334d1478"],["__file","/home/administrator/Documents/Development/beak-insights/felicity/felicity-lims/webapp/views/grind/_id/ErrandFile.vue"]]);export{Re as default};
