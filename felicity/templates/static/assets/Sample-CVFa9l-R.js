const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/DeriveSamplesModal-QJVQX5zl.js","assets/index-DApeomWQ.js","assets/index-CfJ_N7IC.css","assets/analysis-BTUsl5OO.js","assets/analyses.mutations-Bu696l9I.js","assets/DeriveSamplesModal-DuNb9Bt-.css"])))=>i.map(i=>d[i]);
import{a0 as Se,u as Ce,ac as ke,a4 as Re,f as De,g as Le,aq as je,a5 as q,h as x,a7 as w,a1 as Oe,a6 as Te,at as Be,_ as Pe,r as C,aa as Ue,c,o as l,A as s,F as m,C as N,E as y,a as i,P as p,N as k,L as a,Q as F,H as f,T as Ie,J as W,K as z,O as Me}from"./index-DApeomWQ.js";import{u as Ee}from"./samples-DyvvG50W.js";import{p as Ae}from"./index-BqfY99Wm.js";import"./analyses.mutations-Bu696l9I.js";import"./storage.mutations-DsadjqQH.js";const Ge=Se({__name:"Sample",setup(J,{expose:t}){t();const g=Ce(),e=ke(),h=Re(),{withClientQuery:O}=De(),u=Oe(()=>Te(()=>import("./DeriveSamplesModal-QJVQX5zl.js"),__vite__mapDeps([0,1,2,3,4,5])));g.resetSample();const{cancelSamples:_,reInstateSamples:S,receiveSamples:R,invalidateSamples:D,publishSamples:L,verifySamples:r,recoverSamples:M}=Ee(),E=Le({dropdownOpen:!1}),{sample:n,fetchingSample:Q,repeatSample:H}=je(g);g.fetchSampleByUid(e.params.sampleUid),q(()=>n?.value?.status,(o,d)=>{if(o)if(o!=="invalidated"){g.resetRepeatSample();return}else g.fetchRepeatSampleByParentId(e.params.sampleUid)}),q(()=>e.params.sampleUid,(o,d)=>{g.fetchSampleByUid(o)});function K(o,d){let v=[];return o?.forEach(b=>v.push(b.name)),d?.forEach(b=>v.push(b.name)),v.join(", ")}function X(o){if(!o)return null;const d=o.toLowerCase();return d.startsWith("der")?"D":d.startsWith("ali")?"A":d.startsWith("poo")?"P":o.charAt(0).toUpperCase()}const Y=x(()=>!!["expected"].includes(n?.value?.status?.toLowerCase())),Z=async()=>R([n?.value?.uid]),$=x(()=>!!["received","expected"].includes(n?.value?.status?.toLowerCase())),ee=async()=>_([n?.value?.uid]),te=x(()=>!!["cancelled"].includes(n?.value?.status?.toLowerCase())),se=async()=>S([n?.value?.uid]),oe=x(()=>n?.value?.status?.toLowerCase()==="awaiting"),ne=async()=>r([n?.value?.uid]),ae=x(()=>n?.value?.status?.toLowerCase()==="published"),T=x(()=>["approved"].includes(n?.value?.status?.toLowerCase())?"Publish":["published"].includes(n?.value?.status?.toLowerCase())?"Re publish":"Pre publish"),re=x(()=>{if(["awaiting","approved","published"].includes(n?.value?.status?.toLowerCase()))return!0;const o=g.analysisResults;return!!(["received","paired"].includes(n?.value?.status?.toLowerCase()??"")&&o?.some(d=>["approved"].includes(d.status?.toLowerCase()??"")))}),le=async()=>{const o=T.value.startsWith("Pre")?"pre-publish":T.value.startsWith("Re")?"re-publish":"publish";L([{uid:n?.value?.uid,action:o}])},ie=async()=>D([n?.value?.uid]).then(o=>{let d=o?.filter(v=>v.uid!==n?.value?.uid);d.length>0&&g.setRepeatSample(d[0])}),de=async()=>h.push({name:"print-barcodes",state:{sampleUids:JSON.stringify([n?.value?.uid])}}),ce=x(()=>!!["received","expected"].includes(n?.value?.status?.toLowerCase())),ue=async()=>{h.push({name:"reject-samples",state:{samples:JSON.stringify([n?.value])}})},me=x(()=>!!["stored"].includes(n?.value?.status?.toLowerCase())),pe=async()=>M([n?.value?.uid]),fe=async o=>{h.push({path:"/bio-banking",state:{sample:JSON.stringify(o)}})},A=w(!1),B=w(!1),P=w(null),j=w(null),ge=x(()=>{if(!j.value?.children?.length)return[];const o=[],d=(v,b)=>{o.push({node:v,depth:b}),(v.children??[]).forEach(_e=>d(_e,b+1))};return j.value.children.forEach(v=>d(v,0)),o}),G=async()=>{n?.value?.uid&&(B.value=!0,P.value=null,O(Be,{sampleUid:n?.value?.uid,depth:6,includeTests:!1,includeExtraRelationships:!0},"sampleGenealogy").then(o=>{j.value=o??null}).catch(o=>{P.value=o?.message??"Failed to load genealogy."}).finally(()=>{B.value=!1}))},ve=async()=>{A.value=!0,await G()},U=w(!1),I=w([]),xe=()=>{n?.value&&(I.value=[n.value],U.value=!0,E.dropdownOpen=!1)},ye=()=>{U.value=!1,I.value=[]},be=o=>{o?.length&&g.addSampleClones(o)};function we(o){const d=o?.toLowerCase()??"";return{expected:"bg-warning/15 text-warning border border-warning/30",received:"bg-info/15 text-info border border-info/30",awaiting:"bg-muted text-muted-foreground border border-border",paired:"bg-accent/15 text-accent border border-accent/30",approved:"bg-success/15 text-success border border-success/30",published:"bg-primary/15 text-primary border border-primary/30",cancelled:"bg-muted text-muted-foreground border border-border",rejected:"bg-destructive/15 text-destructive border border-destructive/30",stored:"bg-secondary text-secondary-foreground border border-border",invalidated:"bg-warning/15 text-warning border border-warning/30"}[d]??"bg-muted text-muted-foreground border border-border"}function he(o){return o?o.charAt(0).toUpperCase()+o.slice(1).toLowerCase():""}const V={sampleStore:g,route:e,router:h,withClientQuery:O,DeriveSamplesModal:u,cancelSamples:_,reInstateSamples:S,receiveSamples:R,invalidateSamples:D,publishSamples:L,verifySamples:r,recoverSamples:M,state:E,sample:n,fetchingSample:Q,repeatSample:H,profileAnalysesText:K,relationshipBadge:X,canReceive:Y,receiveSample:Z,canCancel:$,cancelSample:ee,canReinstate:te,reInstateSample:se,canVerify:oe,verifySample:ne,canInvalidate:ae,publishText:T,canPublish:re,publishSample:le,invalidateSample:ie,printBarCooe:de,canReject:ce,rejectSample:ue,canRecover:me,recoverSample:pe,goToStorage:fe,showGenealogyModal:A,genealogyLoading:B,genealogyError:P,genealogy:j,genealogyRows:ge,fetchGenealogy:G,openGenealogyModal:ve,showDeriveModal:U,deriveSelection:I,openDeriveModal:xe,closeDeriveModal:ye,handleDerived:be,getStatusBadgeClass:we,formatStatusLabel:he,get parseDate(){return Ae}};return Object.defineProperty(V,"__isScriptSetup",{enumerable:!1,value:!0}),V}}),Ve={class:"space-y-6"},qe={class:"flex justify-between items-center"},Ne={class:"flex items-center space-x-4"},Fe={class:"flex items-center"},We={class:"bg-background rounded-lg shadow-sm p-6 space-y-6"},ze={key:0,class:"py-4 text-center"},Je={key:1,class:"space-y-6"},Qe={class:"space-y-4"},He={class:"flex items-center justify-between"},Ke={class:"flex items-center space-x-2"},Xe={key:0,class:"text-destructive"},Ye={class:"text-lg font-semibold text-foreground"},Ze={key:1,class:"inline-flex items-center justify-center w-4 h-4 rounded-full text-[9px] italic font-semibold bg-muted text-foreground"},$e={key:2,class:"flex items-center space-x-2"},et={class:"text-muted-foreground"},tt={class:"relative"},st={class:"absolute right-0 mt-2 w-56 rounded-lg border border-border bg-popover shadow-lg z-20 overflow-hidden"},ot={class:"px-3 py-2.5 border-b border-border bg-muted/40"},nt={class:"text-sm font-semibold text-foreground"},at={class:"py-1.5"},rt={class:"grid grid-cols-3 gap-6"},lt={class:"space-y-4"},it={class:"flex justify-between"},dt={class:"text-sm text-muted-foreground"},ct={class:"flex justify-between"},ut={class:"text-sm text-muted-foreground"},mt={class:"space-y-4"},pt={class:"flex justify-between"},ft={class:"text-sm text-muted-foreground"},gt={class:"flex justify-between"},vt={class:"text-sm text-muted-foreground"},xt={class:"flex justify-between"},yt={class:"text-sm text-muted-foreground"},bt={class:"flex justify-between"},wt={class:"text-sm text-muted-foreground"},ht={class:"space-y-4"},_t={class:"flex justify-between"},St={class:"text-sm text-muted-foreground"},Ct={class:"flex justify-between"},kt={class:"text-sm text-muted-foreground"},Rt={class:"flex justify-between"},Dt={class:"text-sm text-muted-foreground"},Lt={class:"flex justify-between"},jt={class:"text-sm text-muted-foreground"},Ot={class:"bg-muted rounded-lg shadow-sm p-6"},Tt={class:"flex items-center space-x-4"},Bt={class:"flex items-center space-x-2"},Pt={class:"bg-destructive/10 text-destructive rounded-lg shadow-sm p-6"},Ut={class:"space-y-2"},It={class:"space-y-4"},Mt={key:0,class:"py-6 text-center"},Et={key:1,class:"text-destructive"},At={key:2,class:"text-muted-foreground"},Gt={key:3,class:"space-y-2"},Vt={class:"font-medium text-foreground"},qt={key:0,class:"text-xs text-muted-foreground"};function Nt(J,t,g,e,h,O){const u=C("font-awesome-icon"),_=C("router-link"),S=C("fel-loader"),R=C("fel-modal"),D=C("router-view"),L=Ue("motion-slide-right");return l(),c("div",Ve,[s("div",qe,[t[15]||(t[15]=s("h3",{class:"text-xl font-semibold text-foreground"},"Sample Detail",-1)),s("div",Ne,[s("button",{class:"px-4 py-2 bg-background border border-border text-foreground rounded-md hover:bg-accent hover:text-accent-foreground transition-colors duration-200 focus:outline-none focus:ring-2 focus:ring-primary/50",onClick:e.printBarCooe},[s("span",Fe,[t[13]||(t[13]=p(" Barcode ",-1)),i(u,{icon:"barcode",class:"ml-2"})])]),e.sample?.analysisRequest?.patient?.uid?(l(),N(_,{key:0,to:{name:"patient-detail",params:{patientUid:e.sample?.analysisRequest?.patient?.uid}},class:"px-4 py-2 bg-primary text-primary-foreground rounded-md hover:bg-primary/90 transition-colors duration-200 focus:outline-none focus:ring-2 focus:ring-primary/50"},{default:k(()=>[...t[14]||(t[14]=[p(" ... other samples ",-1)])]),_:1},8,["to"])):y("",!0),e.sample?.uid?(l(),c("button",{key:1,class:"px-4 py-2 bg-background border border-border text-foreground rounded-md hover:bg-accent hover:text-accent-foreground transition-colors duration-200 focus:outline-none focus:ring-2 focus:ring-primary/50",onClick:e.openGenealogyModal}," View genealogy ")):y("",!0)])]),m((l(),c("div",We,[e.fetchingSample?(l(),c("div",ze,[i(S,{message:"Fetching sample details ..."})])):(l(),c("div",Je,[s("div",Qe,[s("div",He,[s("div",Ke,[e.sample?.priority??!0?(l(),c("span",Xe,[i(u,{icon:"fa-star"})])):y("",!0),s("span",Ye,a(e.sample?.sampleId),1),e.relationshipBadge(e.sample?.relationshipType)?(l(),c("span",Ze,a(e.relationshipBadge(e.sample?.relationshipType)),1)):y("",!0),e.sample?.analysisRequest?.patient?.uid&&e.repeatSample?.uid?(l(),c("span",$e,[i(u,{icon:"angle-double-right"}),i(_,{to:{name:"sample-detail",params:{patientUid:e.sample?.analysisRequest?.patient?.uid,sampleUid:e.repeatSample?.uid}},class:"px-4 py-2 bg-primary text-primary-foreground rounded-md hover:bg-primary/90 transition-colors duration-200 focus:outline-none focus:ring-2 focus:ring-primary/50"},{default:k(()=>[p(a(e.repeatSample?.sampleId),1)]),_:1},8,["to"])])):y("",!0)]),s("span",et,a(e.profileAnalysesText(e.sample?.profiles,e.sample?.analyses??[])),1),s("div",tt,[s("button",{type:"button",onClick:t[0]||(t[0]=r=>e.state.dropdownOpen=!e.state.dropdownOpen),class:F(["inline-flex items-center gap-2 px-3.5 py-2 rounded-lg border text-sm font-medium transition-all duration-200","hover:shadow-sm focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2",e.getStatusBadgeClass(e.sample?.status)])},[t[16]||(t[16]=s("span",{class:"w-2 h-2 rounded-full shrink-0 bg-current opacity-60","aria-hidden":"true"},null,-1)),p(" "+a(e.formatStatusLabel(e.sample?.status))+" ",1),i(u,{icon:"chevron-down",class:F(["text-xs transition-transform duration-200",e.state.dropdownOpen&&"rotate-180"])},null,8,["class"])],2),m(s("div",{onClick:t[1]||(t[1]=r=>e.state.dropdownOpen=!1),class:"fixed inset-0 h-full w-full z-10"},null,512),[[f,e.state.dropdownOpen]]),i(Ie,{"enter-active-class":"transition ease-out duration-150","enter-from-class":"opacity-0 scale-95 -translate-y-1","enter-to-class":"opacity-100 scale-100 translate-y-0","leave-active-class":"transition ease-in duration-100","leave-from-class":"opacity-100 scale-100","leave-to-class":"opacity-0 scale-95 -translate-y-1"},{default:k(()=>[m(s("div",st,[s("div",ot,[t[17]||(t[17]=s("p",{class:"text-xs font-medium text-muted-foreground uppercase tracking-wider"},"Status",-1)),s("p",nt,a(e.formatStatusLabel(e.sample?.status)),1)]),s("div",at,[m(s("button",{onClick:t[2]||(t[2]=r=>{e.receiveSample(),e.state.dropdownOpen=!1}),class:"w-full px-3 py-2 text-left text-sm text-foreground hover:bg-accent hover:text-accent-foreground transition-colors flex items-center gap-2"},[i(u,{icon:"download",class:"w-3.5 text-muted-foreground"}),t[18]||(t[18]=p(" Receive ",-1))],512),[[f,e.canReceive]]),m(s("button",{onClick:t[3]||(t[3]=r=>{e.verifySample(),e.state.dropdownOpen=!1}),class:"w-full px-3 py-2 text-left text-sm text-foreground hover:bg-accent hover:text-accent-foreground transition-colors flex items-center gap-2"},[i(u,{icon:"check-circle",class:"w-3.5 text-muted-foreground"}),t[19]||(t[19]=p(" Approve ",-1))],512),[[f,e.canVerify]]),m(s("button",{onClick:t[4]||(t[4]=r=>{e.rejectSample(),e.state.dropdownOpen=!1}),class:"w-full px-3 py-2 text-left text-sm text-foreground hover:bg-destructive/10 hover:text-destructive transition-colors flex items-center gap-2"},[i(u,{icon:"times-circle",class:"w-3.5 text-muted-foreground"}),t[20]||(t[20]=p(" Reject ",-1))],512),[[f,e.canReject]]),m(s("button",{onClick:t[5]||(t[5]=r=>{e.cancelSample(),e.state.dropdownOpen=!1}),class:"w-full px-3 py-2 text-left text-sm text-foreground hover:bg-destructive/10 hover:text-destructive transition-colors flex items-center gap-2"},[i(u,{icon:"ban",class:"w-3.5 text-muted-foreground"}),t[21]||(t[21]=p(" Cancel ",-1))],512),[[f,e.canCancel]]),m(s("button",{onClick:t[6]||(t[6]=r=>{e.reInstateSample(),e.state.dropdownOpen=!1}),class:"w-full px-3 py-2 text-left text-sm text-foreground hover:bg-accent hover:text-accent-foreground transition-colors flex items-center gap-2"},[i(u,{icon:"chevron-circle-left",class:"w-3.5 text-muted-foreground"}),t[22]||(t[22]=p(" Reinstate ",-1))],512),[[f,e.canReinstate]]),m(s("button",{onClick:t[7]||(t[7]=r=>{e.publishSample(),e.state.dropdownOpen=!1}),class:"w-full px-3 py-2 text-left text-sm text-foreground hover:bg-accent hover:text-accent-foreground transition-colors flex items-center gap-2"},[i(u,{icon:"flag",class:"w-3.5 text-muted-foreground"}),p(" "+a(e.publishText),1)],512),[[f,e.canPublish]]),m(s("button",{onClick:t[8]||(t[8]=r=>{e.invalidateSample(),e.state.dropdownOpen=!1}),class:"w-full px-3 py-2 text-left text-sm text-foreground hover:bg-accent hover:text-accent-foreground transition-colors flex items-center gap-2"},[i(u,{icon:"times-circle",class:"w-3.5 text-muted-foreground"}),t[23]||(t[23]=p(" Invalidate ",-1))],512),[[f,e.canInvalidate]]),m(s("button",{onClick:t[9]||(t[9]=r=>{e.recoverSample(),e.state.dropdownOpen=!1}),class:"w-full px-3 py-2 text-left text-sm text-foreground hover:bg-accent hover:text-accent-foreground transition-colors flex items-center gap-2"},[i(u,{icon:"database",class:"w-3.5 text-muted-foreground"}),t[24]||(t[24]=p(" Recover ",-1))],512),[[f,e.canRecover]]),m(s("button",{onClick:t[10]||(t[10]=r=>e.openDeriveModal()),class:"w-full px-3 py-2 text-left text-sm text-foreground hover:bg-accent hover:text-accent-foreground transition-colors flex items-center gap-2 border-t border-border mt-1 pt-1.5"},[i(u,{icon:"code-branch",class:"w-3.5 text-muted-foreground"}),t[25]||(t[25]=p(" Derive ",-1))],512),[[f,e.sample?.uid]])])],512),[[f,e.state.dropdownOpen]])]),_:1})])]),s("div",rt,[s("div",lt,[s("div",it,[t[26]||(t[26]=s("span",{class:"text-sm font-medium text-foreground"},"Client Request ID",-1)),s("span",dt,a(e.sample?.analysisRequest?.clientRequestId),1)]),s("div",ct,[t[27]||(t[27]=s("span",{class:"text-sm font-medium text-foreground"},"Client",-1)),s("span",ut,a(e.sample?.analysisRequest?.client?.name),1)]),t[28]||(t[28]=s("div",{class:"flex justify-between"},[s("span",{class:"text-sm font-medium text-foreground"},"Client Contact"),s("span",{class:"text-sm text-muted-foreground"},"Sister in Charge")],-1))]),s("div",mt,[s("div",pt,[t[29]||(t[29]=s("span",{class:"text-sm font-medium text-foreground"},"Sample Type",-1)),s("span",ft,a(e.sample?.sampleType?.name),1)]),s("div",gt,[t[30]||(t[30]=s("span",{class:"text-sm font-medium text-foreground"},"Date Sampled",-1)),s("span",vt,a(e.parseDate(e.sample?.dateCollected,!0)),1)]),s("div",xt,[t[31]||(t[31]=s("span",{class:"text-sm font-medium text-foreground"},"Date Registered",-1)),s("span",yt,a(e.parseDate(e.sample?.createdAt,!0)),1)]),s("div",bt,[t[32]||(t[32]=s("span",{class:"text-sm font-medium text-foreground"},"Date Received",-1)),s("span",wt,a(e.parseDate(e.sample?.dateReceived,!0)),1)])]),s("div",ht,[s("div",_t,[t[33]||(t[33]=s("span",{class:"text-sm font-medium text-foreground"},"Date Submitted",-1)),s("span",St,a(e.parseDate(e.sample?.dateSubmitted,!0)),1)]),s("div",Ct,[t[34]||(t[34]=s("span",{class:"text-sm font-medium text-foreground"},"Date Verified",-1)),s("span",kt,a(e.parseDate(e.sample?.dateVerified,!0)),1)]),s("div",Rt,[t[35]||(t[35]=s("span",{class:"text-sm font-medium text-foreground"},"Date Published",-1)),s("span",Dt,a(e.parseDate(e.sample?.datePublished,!0)),1)]),s("div",Lt,[t[36]||(t[36]=s("span",{class:"text-sm font-medium text-foreground"},"Date Printed",-1)),s("span",jt,a(e.parseDate(e.sample?.datePrinted,!0)),1)])])])])]))])),[[L]]),m(s("div",Ot,[s("div",Tt,[t[41]||(t[41]=s("span",{class:"font-medium text-foreground"},"Storage:",-1)),s("button",{class:"text-primary hover:text-primary/80 transition-colors",onClick:t[11]||(t[11]=r=>e.goToStorage(e.sample))},[s("span",Bt,[s("span",null,a(e.sample?.storageContainer?.storageSection?.storageLocation?.storeRoom?.name),1),t[37]||(t[37]=s("span",null,"›",-1)),s("span",null,a(e.sample?.storageContainer?.storageSection?.storageLocation?.name),1),t[38]||(t[38]=s("span",null,"›",-1)),s("span",null,a(e.sample?.storageContainer?.storageSection?.name),1),t[39]||(t[39]=s("span",null,"›",-1)),s("span",null,a(e.sample?.storageContainer?.name),1),t[40]||(t[40]=s("span",null,"›",-1)),s("span",null,a(e.sample?.storageSlot),1)])])])],512),[[f,e.sample?.status==="stored"]]),m(s("div",Pt,[s("ul",Ut,[(l(!0),c(W,null,z(e.sample?.rejectionReasons,r=>(l(),c("li",{key:r.uid},a(r.reason),1))),128))])],512),[[f,e.sample?.status==="rejected"]]),e.showGenealogyModal?(l(),N(R,{key:0,onClose:t[12]||(t[12]=r=>e.showGenealogyModal=!1),"content-width":"w-3/4"},{header:k(()=>[p(a(e.sample?.sampleId??e.sample?.uid)+" Genealogy ",1)]),body:k(()=>[s("div",It,[e.genealogyLoading?(l(),c("div",Mt,[i(S,{message:"Fetching genealogy ..."})])):e.genealogyError?(l(),c("div",Et,a(e.genealogyError),1)):e.genealogyRows.length?(l(),c("div",Gt,[(l(!0),c(W,null,z(e.genealogyRows,r=>(l(),c("div",{key:r.node.sampleUid,class:"flex items-center gap-2",style:Me({paddingLeft:`${r.depth*1.25}rem`})},[s("span",Vt,a(r.node.sampleId??r.node.sampleUid),1),r.node.relationshipType?(l(),c("span",qt," ("+a(r.node.relationshipType)+") ",1)):y("",!0)],4))),128))])):(l(),c("div",At," Sample has no genealogy. "))])]),_:1})):y("",!0),i(e.DeriveSamplesModal,{show:e.showDeriveModal,samples:e.deriveSelection,onClose:e.closeDeriveModal,onDerived:e.handleDerived},null,8,["show","samples"]),i(D)])}const Ht=Pe(Ge,[["render",Nt],["__file","/home/administrator/Documents/Development/beak-insights/felicity/felicity-lims/webapp/views/sample/_id/Sample.vue"]]);export{Ht as default};
