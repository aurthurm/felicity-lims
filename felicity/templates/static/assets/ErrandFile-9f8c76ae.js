import{S as K,f as O,a0 as l,a7 as q,i as H,r as w,o as r,c as a,N as o,K as v,H as f,F as Q,E as J,y as X,aC as Y,a as D,a3 as Z,M as ee,_ as te}from"./index-54016222.js";import{i as oe,D as ne,j as se,k as re}from"./grind.queries-62f1cdc7.js";import{M as E}from"./schema-f3233b53.js";const ae={class:"bg-background rounded-lg shadow-sm border border-border p-6 space-y-6"},le={class:"flex justify-between items-start"},ie={class:"w-3/4 pr-4 space-y-4"},de={key:0,class:"py-6 text-center text-muted-foreground bg-background rounded-lg border border-dashed border-border"},ue={key:1,class:"p-3 bg-destructive/10 text-destructive rounded-md"},ce={key:2,class:"space-y-2"},fe={class:"flex items-center space-x-3"},pe={class:"text-muted-foreground"},me={class:"text-sm font-medium text-foreground"},ve={class:"text-xs text-muted-foreground"},ge={class:"flex items-center space-x-2"},he=["onClick"],_e=["onClick","disabled"],xe={class:"w-1/4 pl-4"},ye={key:0,class:"space-y-2"},be={class:"text-sm text-muted-foreground"},we={key:1,class:"space-y-3"},De=["src"],ke={class:"text-sm"},Fe={class:"font-medium text-foreground"},Ce={class:"text-muted-foreground"},Ue={class:"flex justify-center space-x-2"},Me=["disabled"],Ee={key:1,class:"text-sm text-destructive"},Be=K({__name:"ErrandFile",props:{errandUid:{type:String,required:!0}},setup(B){const k=B,{withClientMutation:F,withClientQuery:C}=O(),y=l(null),g=l(null);q(()=>{$()});const p=l(!1),i=l(null),m=l(null),h=l(!1),u=l(null),U=l(!1),d=l([]),$=()=>{C(oe,{target:E.Errand,targetUid:k.errandUid},"grindMediaByTarget").then(e=>{e&&(d.value=e)})},T=e=>{F(re,{payload:e},"createGrindMedia").then(t=>{t&&(d.value=[t,...d.value])})},G=e=>{y.value=e,g.value=null,F(ne,{uid:e},"deleteGrindMedia").then(t=>{t&&(d.value=d.value.filter(n=>n.uid!==e))}).catch(t=>{g.value=t?.message||"Failed to delete file"}).finally(()=>{y.value=null})},z=e=>{const t=parseInt(e);return t<1024?`${t} B`:t<1024*1024?`${(t/1024).toFixed(1)} KB`:`${(t/(1024*1024)).toFixed(1)} MB`},L=e=>{const{mimetype:t,filename:n}=e;return t?.startsWith("image/")?"image":t?.includes("pdf")||n.endsWith(".pdf")?"pdf":t?.includes("word")||n.endsWith(".doc")||n.endsWith(".docx")?"doc":t?.includes("sheet")||n.endsWith(".xls")||n.endsWith(".xlsx")?"excel":"file"},S=e=>{try{C(se,{uid:e.uid},"downloadGrindMediaFile").then(t=>{const n=atob(t.content),_=new Uint8Array(n.length);for(let x=0;x<n.length;x++)_[x]=n.charCodeAt(x);const b=new Blob([_],{type:t.mimetype}),s=URL.createObjectURL(b),c=document.createElement("a");c.href=s,c.download=t.filename,document.body.appendChild(c),c.click(),setTimeout(()=>{document.body.removeChild(c),URL.revokeObjectURL(s)},0)})}catch(t){console.error("Error downloading file:",t)}},M=e=>{if(u.value=null,i.value=e,e.type.startsWith("image/")){const t=new FileReader;t.onload=n=>{m.value=n.target?.result},t.readAsDataURL(e)}else m.value=null},W=async()=>{if(i.value){h.value=!0,u.value=null;try{const e=await T({file:i.value,target:E.Errand,targetUid:k.errandUid});e?.error?u.value=e.error.message:U.value=!0}catch(e){u.value=e instanceof Error?e.message:"Upload failed"}finally{h.value=!1}}},j=e=>{const t=e.target;t.files&&t.files.length>0&&M(t.files[0])},I=e=>{e.preventDefault(),e.stopPropagation(),p.value=!0},N=e=>{e.preventDefault(),e.stopPropagation(),p.value=!1},R=e=>{e.preventDefault(),e.stopPropagation(),p.value=!0},A=e=>{e.preventDefault(),e.stopPropagation(),p.value=!1,e.dataTransfer&&e.dataTransfer.files.length>0&&M(e.dataTransfer.files[0])},P=()=>{i.value=null,m.value=null,U.value=!1,u.value=null},V=H(()=>{if(!i.value)return"";const e=i.value.size;return e<1024?`${e} B`:e<1024*1024?`${(e/1024).toFixed(1)} KB`:`${(e/(1024*1024)).toFixed(1)} MB`});return(e,t)=>{const n=w("DownloadIcon"),_=w("TrashIcon"),b=w("UploadIcon");return r(),a("div",ae,[o("div",le,[o("div",ie,[t[1]||(t[1]=o("h3",{class:"text-lg font-medium text-foreground"},"Uploaded Files",-1)),d.value.length===0?(r(),a("div",de," No files uploaded yet ")):v("",!0),g.value?(r(),a("div",ue,f(g.value),1)):v("",!0),d.value.length>0?(r(),a("ul",ce,[(r(!0),a(Q,null,J(d.value,s=>(r(),a("li",{key:s.uid,class:"flex items-center justify-between p-3 bg-muted rounded-md hover:bg-muted/80 transition-colors duration-200"},[o("div",fe,[o("span",pe,[(r(),X(Y(L(s)),{class:"w-5 h-5"}))]),o("div",null,[o("p",me,f(s.filename),1),o("p",ve,f(z(s.size)),1)])]),o("div",ge,[o("button",{onClick:c=>S(s),class:"p-1 text-muted-foreground hover:text-foreground transition-colors duration-200",title:"Download file"},[D(n,{class:"w-5 h-5"})],8,he),o("button",{onClick:c=>G(s.uid),class:"p-1 text-muted-foreground hover:text-destructive transition-colors duration-200",disabled:y.value===s.uid,title:"Delete file"},[D(_,{class:"w-5 h-5"})],8,_e)])]))),128))])):v("",!0)]),o("div",xe,[o("div",{class:Z(["border-2 border-dashed border-border rounded-lg p-6 text-center",{"border-primary bg-primary/5":p.value}]),onDragenter:I,onDragleave:N,onDragover:R,onDrop:A},[o("input",{type:"file",class:"hidden",ref:"fileInput",onChange:j},null,544),i.value?(r(),a("div",we,[m.value?(r(),a("img",{key:0,src:m.value,class:"max-h-32 mx-auto rounded-md",alt:"File preview"},null,8,De)):v("",!0),o("div",ke,[o("p",Fe,f(i.value.name),1),o("p",Ce,f(V.value),1)]),o("div",Ue,[o("button",{onClick:P,class:"px-3 py-1 text-sm font-medium text-foreground bg-background border border-border rounded-md shadow-sm hover:bg-muted focus:outline-none focus:ring-2 focus:ring-primary focus:ring-offset-2 transition-colors duration-200"}," Cancel "),o("button",{onClick:W,disabled:h.value,class:"px-3 py-1 text-sm font-medium text-primary-foreground bg-primary border border-transparent rounded-md shadow-sm hover:bg-primary/90 focus:outline-none focus:ring-2 focus:ring-primary focus:ring-offset-2 transition-colors duration-200"},f(h.value?"Uploading...":"Upload"),9,Me)]),u.value?(r(),a("p",Ee,f(u.value),1)):v("",!0)])):(r(),a("div",ye,[D(b,{class:"w-8 h-8 mx-auto text-muted-foreground"}),o("p",be,[t[2]||(t[2]=ee(" Drag and drop a file here, or ")),o("button",{onClick:t[0]||(t[0]=s=>e.$refs.fileInput.click()),class:"text-primary hover:text-primary/80 transition-colors duration-200"}," browse ")])]))],34)])])])}}});const ze=te(Be,[["__scopeId","data-v-334d1478"],["__file","/Users/admin/Documents/Development/felicity/felicity-lims/webapp/views/grind/_id/ErrandFile.vue"]]);export{ze as default};
