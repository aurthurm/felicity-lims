import{V as le,a1 as y,a2 as S,ak as P,u as ne,f as re,aj as ie,h as x,i as p,a8 as ue,r as _,o as v,c as g,a as m,M as b,O as t,D as T,C,ae as L,a6 as a,N as U,E as de,z as ce,F as w,H as D,J as me,a3 as fe,L as E,$ as M,a0 as I,_ as pe}from"./index-74595aff.js";import{u as ve}from"./setup-fa628218.js";import{u as ge}from"./analysis-7c37619c.js";import{h as be,a as ye,o as he}from"./constants-b03e9ddf.js";import{j as Se}from"./analyses.mutations-185deb2b.js";import{p as Ce}from"./index-52e9caa2.js";import"./_queries-3a88eae7.js";const xe={class:"flex justify-start items-start gap-x-4"},_e={class:"rounded-lg border border-border bg-card shadow-sm p-6"},we={action:"post",class:"mb-8 bg-background"},Ae={class:"grid grid-cols-3 gap-x-4 mb-4"},qe={class:"block col-span-1"},Qe=["value"],Ve={id:"samples"},ke={class:"flex justify-between items-center py-2"},Re={class:"flex items-center justify-between"},Pe={class:""},Te={class:"grid grid-cols-4 gap-x-4"},Le={class:"block col-span-1 mb-2"},Ue={class:"block col-span-1 mb-2"},De={class:"block col-span-1 mb-2"},Ee={class:"block col-span-1 mb-2"},Me={class:"ml-4"},Ie=["onClick"],Be=le({__name:"QualityControlListing",setup(je){const h=M(()=>I(()=>import("./vue-multiselect.esm-b1f61583.js"),["assets/vue-multiselect.esm-b1f61583.js","assets/index-74595aff.js","assets/index-8412b2a5.css"])),B=M(()=>I(()=>import("./FelDataTable-b273d3d1.js"),["assets/FelDataTable-b273d3d1.js","assets/index-74595aff.js","assets/index-8412b2a5.css"])),j=y([{name:"All",value:""},{name:"Pending",value:"pending"},{name:"Awaiting",value:"awaiting"},{name:"Approved",value:"approved"}]),$=y([{name:"UID",value:"uid",sortable:!0,sortBy:"asc",defaultSort:!0,showInToggler:!1,hidden:!0},{name:"Date Created",value:"createdAt",sortable:!1,defaultSort:!0,showInToggler:!1,hidden:!1,customRender:function(s,e){return S("div",Ce(s.createdAt))}},{name:"Run Sets (samples)",value:"",sortable:!1,sortBy:"asc",hidden:!1,customRender:function(s,e){return S("div",Y(s.samples??[]))}},{name:"Test(s)",value:"code",sortable:!1,sortBy:"asc",hidden:!1,customRender:function(s,e){return S("div",ee(s.samples??[]))}},{name:"Status",value:"status",sortable:!1,defaultSort:!1,showInToggler:!0},{name:"",value:"",sortable:!1,hidden:!1,showInToggler:!1,customRender:function(s,e){return S(P,{to:{name:"qc-set-detail",params:{qcSetUid:s.uid}},class:"px-2 mr-2 border-primary border text-gray-500rounded-smtransition duration-300 hover:bg-primary hover:text-primary-foreground focus:outline-none",innerHTML:"View Run Set"})}}]),d=ne(),u=ge(),A=ve(),{withClientMutation:N}=re(),{qcSets:q,fetchingQCSets:O}=ie(d);let F=x({first:void 0,after:"",text:"",sortBy:["name"]});u.fetchAnalysesServices(F),u.fetchQCLevels(),u.fetchQCTemplates(),u.fetchAnalysesProfiles(),A.fetchDepartments({}),d.resetQCSets();let Q=y(25),H=p(()=>`Showing ${q?.value?.length} of ${d.getQCSetCount} QC Sets`),n=x({first:Q.value,after:"",status:"",sortBy:["-uid"],filterAction:!1});d.fetchQCSets(n);function z(s){n.first=25,n.after="",n.status=s.filterStatus,n.filterAction=!0,d.fetchQCSets(n)}const J=p(()=>u.getAnalysesProfiles);p(()=>{const s=u.getAnalysesServicesSimple;let e=new Set;return s.forEach(o=>{o.profiles?.length===0&&e.add(o)}),[...e]});let r=y(!1),W=y(!0),f=x({departmentUid:void 0,samples:[]});ue(()=>V());function V(){f.samples?.push({qcTemplate:void 0,qcLevels:[],analysisProfiles:[],analysisServices:[]})}function Z(){const s=f.samples?.map(e=>({qcTemplateUid:e.qcTemplate?.uid,qcLevels:e.qcLevels?.map(o=>o.uid),analysisProfiles:e.analysisProfiles?.map(o=>o.uid),analysisServices:e.analysisServices?.map(o=>o.uid)}));N(Se,{samples:s},"createQcSet").then(e=>d.addQCSets(e?.qcSets))}function G(s){f.samples?.splice(s,1)}function K(){W.value===!0&&Z(),r.value=!1}const k=p(()=>d.getQCSetPageInfo);function X(){n.first=+Q.value,n.after=k?.value?.pageInfo?.endCursor??"",n.text="",n.filterAction=!1,d.fetchQCSets(n)}function Y(s){let e=[];return s?.forEach(o=>{o?.sampleId+""+o.status;let i=o?.qcLevel?.level?.match(/\b([A-Z])/g).join("")+" ("+o.status+")";e.includes(i)||e.push(i)}),e.join(", ")}function ee(s){let e=[];return s?.forEach(o=>{o?.profiles?.forEach(i=>{e.includes(i.name)||e.push(i.name)})}),s?.forEach(o=>{o?.analyses?.forEach(i=>{e.includes(i.name)||e.push(i.name)})}),e.join(", ")}const te=p(()=>A.getDepartments),se=p(()=>u.getQCTemplates),oe=p(()=>u.getQCLevels);return(s,e)=>{const o=_("fel-button"),i=_("fel-heading"),ae=_("fel-modal");return v(),g(w,null,[m(i,{title:"Reference Runs (QC)"},{default:b(()=>[t("div",xe,[T(m(o,{onClick:e[0]||(e[0]=C(l=>L(r)?r.value=!a(r):r=!a(r),["prevent"]))},{default:b(()=>e[5]||(e[5]=[U(" Add Reference Runs ")])),_:1},512),[[de,be(ye.CREATE,he.SAMPLE)]]),m(a(P),{to:"/quality-control/charts",id:"control-charts",class:"px-4 py-2 bg-accent text-accent-foreground rounded-md hover:bg-accent/90 transition-colors duration-200 focus:outline-none focus:ring-2 focus:ring-accent/50"},{default:b(()=>e[6]||(e[6]=[U(" View Run Charts ")])),_:1})])]),_:1}),t("div",_e,[m(a(B),{columns:$.value,data:a(q),toggleColumns:!0,loading:a(O),paginable:!0,pageMeta:{fetchCount:a(n).first,hasNextPage:k.value?.pageInfo?.hasNextPage,qcSetCount:a(H)},searchable:!1,onOnSearch:z,filterable:!0,filterMeta:{defaultFilter:a(n).status,filters:j.value},onOnPaginate:X,selectable:!1},{footer:b(()=>e[7]||(e[7]=[])),_:1},8,["columns","data","loading","pageMeta","filterMeta"])]),a(r)?(v(),ce(ae,{key:0,onClose:e[4]||(e[4]=l=>L(r)?r.value=!1:r=!1),contentWidth:"w-4/5"},{header:b(()=>e[8]||(e[8]=[t("h3",null,"Create QC Analyses Requests",-1)])),body:b(()=>[t("form",we,[t("div",Ae,[t("label",qe,[e[10]||(e[10]=t("span",{class:"text-foreground"},"Department",-1)),T(t("select",{name:"clientContacts",id:"clientContacts","onUpdate:modelValue":e[1]||(e[1]=l=>a(f).departmentUid=l),class:"form-input mt-1 block w-full"},[e[9]||(e[9]=t("option",{value:""},null,-1)),(v(!0),g(w,null,D(te.value,l=>(v(),g("option",{key:l.uid,value:l.uid},me(l.name),9,Qe))),128))],512),[[fe,a(f).departmentUid]])])]),t("section",Ve,[e[17]||(e[17]=t("hr",null,null,-1)),t("div",ke,[e[11]||(e[11]=t("h5",null,"Add Control Samples",-1)),a(f).samples?.length<20?(v(),g("button",{key:0,onClick:e[2]||(e[2]=C(l=>V(),["prevent"])),class:"px-2 py-1 mr-2 border-primary border text-primary rounded-sm transition duration-300 hover:bg-primary hover:text-primary-foreground focus:outline-none"},"Add QCSet")):E("v-if",!0)]),e[18]||(e[18]=t("hr",{class:"mb-4"},null,-1)),(v(!0),g(w,null,D(a(f).samples,(l,R)=>(v(),g("div",{key:R},[t("div",Re,[t("div",Pe,[t("div",Te,[t("label",Le,[e[12]||(e[12]=t("span",{class:"text-foreground"},"QC Template",-1)),m(a(h),{class:"max-w-[300px]",modelValue:l.qcTemplateUid,"onUpdate:modelValue":c=>l.qcTemplateUid=c,options:se.value,multiple:!1,searchable:!0,label:"name","track-by":"uid"},null,8,["modelValue","onUpdate:modelValue","options"])]),t("label",Ue,[e[13]||(e[13]=t("span",{class:"text-foreground"},"QC Levels",-1)),m(a(h),{class:"max-w-[300px]",modelValue:l.qcLevels,"onUpdate:modelValue":c=>l.qcLevels=c,options:oe.value,multiple:!0,searchable:!0,label:"level","track-by":"uid"},null,8,["modelValue","onUpdate:modelValue","options"])]),t("label",De,[e[14]||(e[14]=t("span",{class:"text-foreground"},"Analysis Profiles",-1)),m(a(h),{class:"max-w-[300px]",modelValue:l.analysisProfiles,"onUpdate:modelValue":c=>l.analysisProfiles=c,options:J.value,multiple:!0,searchable:!0,label:"name","track-by":"uid"},null,8,["modelValue","onUpdate:modelValue","options"])]),t("label",Ee,[e[15]||(e[15]=t("span",{class:"text-foreground"},"Analysis Services",-1)),m(a(h),{class:"max-w-[300px]",modelValue:l.analysisServices,"onUpdate:modelValue":c=>l.analysisServices=c,options:a(u).getAnalysesServicesSimple,multiple:!0,searchable:!0,label:"name","track-by":"uid"},null,8,["modelValue","onUpdate:modelValue","options"])])])]),t("div",Me,[t("button",{onClick:C(c=>G(R),["prevent"]),class:"px-2 py-1 mr-2 border-destructive border text-orange-600rounded-smtransition duration-300 hover:bg-destructive hover:text-primary-foreground focus:outline-none"},"Remove",8,Ie)])]),e[16]||(e[16]=t("hr",null,null,-1))]))),128))]),e[19]||(e[19]=t("hr",null,null,-1)),t("button",{type:"button",onClick:e[3]||(e[3]=C(l=>K(),["prevent"])),class:"-mb-4 w-full border border-primary bg-primary text-primary-foreground rounded-sm px-4 py-2 m-2 transition-colors duration-500 ease select-none hover:bg-primary focus:outline-none focus:shadow-outline"}," Save Form ")])]),_:1})):E("v-if",!0)],64)}}}),We=pe(Be,[["__file","/home/aurthurm/Documents/Development/felicity/felicity-lims/webapp/views/qcontrol/QualityControlListing.vue"]]);export{We as default};
