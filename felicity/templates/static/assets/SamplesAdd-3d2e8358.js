import{W as he,u as we,X as Se,f as Ce,a2 as q,i as x,h as W,e as Y,r as X,o as l,c as r,O as e,a as m,a7 as s,af as N,J as p,D as g,a4 as j,Z as I,a5 as Z,K as ke,C as P,F as f,H as b,N as E,L as G,b as _e,k as Ve,_ as De}from"./index-93739211.js";import _ from"./vue-multiselect.esm-183ee7c8.js";import{u as Re}from"./patient-08d80f88.js";import{u as Ae}from"./analysis-689a99f8.js";import{u as Ue}from"./client-946311ca.js";import{A as qe}from"./analyses.mutations-e3a0ff1f.js";import{c as h,a as V,b as Q,d as ee,e as Ne,u as Ie,f as w}from"./array-2f9882bb.js";import{f as te}from"./index-0f6f1926.js";/* empty css                                                                 */import"./location-d054e737.js";const Pe={class:"space-y-6"},Te={class:"space-y-4"},Me={class:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4"},Fe={class:"flex items-center gap-x-4"},$e={class:"flex items-center gap-x-4"},Be={class:"text-sm text-destructive"},Ye={class:"flex items-center gap-x-4"},je={class:"text-sm text-destructive"},Ee={class:"flex items-center gap-x-4"},He={class:"text-sm text-destructive"},Ke={class:"border border-border rounded-lg bg-background/50"},Le={key:0,class:"px-4 py-4 space-y-4 border-t border-border"},ze={class:"flex items-center gap-x-4"},Oe={class:"flex flex-wrap mt-2"},Je={class:"flex gap-2"},We=["onKeydown"],Xe={class:"flex flex-wrap gap-2 mt-2"},Ze=["onClick"],Ge={class:"flex items-center gap-x-4"},Qe={class:"grid grid-cols-1 md:grid-cols-2 gap-4"},et={class:"flex items-center gap-x-4"},tt={class:"flex items-center gap-x-4"},ot={id:"samples",class:"space-y-4"},st={class:"flex justify-between items-center"},lt={class:"flex items-center gap-4"},rt={class:"text-sm text-destructive"},at={class:"relative border border-border rounded-lg bg-background/50 overflow-visible"},nt={class:"overflow-x-auto overflow-y-visible pl-48"},it={class:"w-80 min-w-80"},dt={class:"border-b border-border bg-muted/30"},ut={class:"flex items-center justify-between"},ct=["onClick","disabled","title"],mt={class:"border-b border-border hover:bg-muted/20 h-20 min-h-20 max-h-20"},pt={class:"border-b border-border hover:bg-muted/20 h-20 min-h-20 max-h-20"},ft={class:"border-b border-border hover:bg-muted/20 h-20 min-h-20 max-h-20"},bt={class:"border-b border-border hover:bg-muted/20 h-20 min-h-20 max-h-20"},gt={class:"border-b border-border hover:bg-muted/20 h-20 min-h-20 max-h-20"},vt={class:"hover:bg-muted/20 h-24"},yt={class:"p-3 bg-muted/50 rounded-md text-sm space-y-1"},xt={key:0,class:"text-xs text-destructive whitespace-nowrap"},ht={key:1},wt={class:"text-xs text-muted-foreground"},St={class:"text-xs text-muted-foreground"},Ct={class:"flex justify-end pt-4"},kt={key:0,type:"submit",class:"px-6 py-2 bg-primary text-primary-foreground rounded-md hover:bg-primary/90 transition-colors duration-200 focus:outline-none focus:ring-2 focus:ring-primary/50"},_t={key:1,class:"py-4 text-center"},Vt=he({__name:"SamplesAdd",setup(Dt){const T=we(),oe=Re(),D=Ae(),H=Ue(),se=Se(),{withClientMutation:le}=Ce(),{swalError:K}=Ve(),R=q(!1);let S=x(()=>oe.getPatient),re=W({first:void 0,after:"",text:"",sortBy:["name"],contacts:!0});H.fetchClients(re);const ae=x(()=>H.getClients),M=q(null),ne=a=>{M.value=a,k.value=null};T.fetchSampleTypes();const ie=x(()=>T.getSampleTypes);let de=W({first:void 0,after:"",text:"",sortBy:["name"]});D.fetchAnalysesServices(de);const ue=x(()=>{const a=D.getAnalysesServicesSimple;let t=new Set;return a.forEach((i,y)=>{i.profiles?.length===0&&t.add(i)}),[...t]});D.fetchAnalysesProfiles();const ce=x(()=>D.getAnalysesProfiles),C=q(!1),L=Y().endOf("day").toDate(),me=h({clientRequestId:V().required("Client Request ID is Required"),clinicalData:h({clinicalIndication:V().nullable(),symptoms:Q().of(V()),symptomsRaw:V().nullable(),treatmentNotes:V().nullable(),pregnancyStatus:ee().nullable(),breastFeeding:ee().nullable(),vitals:h().nullable(),otherContext:h().nullable()}).nullable(),client:h().required("Client is Required"),clientContact:h().nullable().required("Client Contact is Required"),samples:Q().required().min(1,"Add at least 1 sample"),priority:Ne()});function z(a){return{sampleType:{},dateCollected:Y(new Date),dateReceived:Y(new Date),profiles:[],analyses:[],...a}}function pe(){return{clinicalIndication:"",symptoms:[],symptomsRaw:"",treatmentNotes:"",pregnancyStatus:null,breastFeeding:null,vitals:{},otherContext:{}}}const{handleSubmit:fe,errors:A}=Ie({validationSchema:me,initialValues:{priority:0,client:S?.value?.client,samples:[z({})],clinicalData:pe()}});S?.value?.client&&(M.value=S.value.client);const{value:F}=w("clientRequestId"),{value:d}=w("clinicalData"),{value:U}=w("client"),{value:k}=w("clientContact"),{value:$}=w("priority"),{value:u}=w("samples"),v=q(""),O=()=>{v.value.trim()&&!d.value?.symptoms?.includes(v.value.trim())&&(d.value?.symptoms?.push(v.value.trim()),v.value="")},be=a=>{d.value?.symptoms?.splice(a,1)},J=fe(a=>{C.value=!0,console.log("values",a);for(let t of a.samples||[]){if([null,void 0,""].includes(t?.sampleType)){K("Samples must have sample types"),C.value=!1;return}if(t?.analyses?.length<=0&&t?.profiles?.length<=0){K("Samples must have either profiles/analyses or both"),C.value=!1;return}}ge(a)});function ge(a){const t={patientUid:S.value?.uid,clientRequestId:a.clientRequestId,clinicalData:a.clinicalData,clientUid:U?.value?.uid,clientContactUid:k?.value?.uid,samples:a.samples?.map(i=>({...i,profiles:i.profiles?.map(y=>y.uid),analyses:i.analyses?.map(y=>y.uid),sampleType:i.sampleType?.uid,dateCollected:te(i.dateCollected,"YYYY-MM-DD HH:mm"),dateReceived:te(i.dateReceived,"YYYY-MM-DD HH:mm")}))};console.log(t),le(qe,{payload:t},"createAnalysisRequest").then(i=>{T.addAnalysisRequest(i),se.push({name:"patient-detail",params:{patientUid:S.value?.uid}})}).finally(()=>{C.value=!1})}function ve(){const a=z({});u.value.push(a)}function ye(a){u.value.length>1&&u.value.splice(a,1)}const B=x(()=>u.value.length>1),xe=a=>`${a.firstName} ${a.lastName}`;return(a,t)=>{const i=X("VueDatePicker"),y=X("fel-loader");return l(),r("div",Pe,[t[30]||(t[30]=e("h5",{class:"text-xl font-semibold text-foreground mb-4"},"Add Analysis Request",-1)),e("form",{action:"post",class:"p-6 bg-background rounded-lg shadow-sm space-y-6",onSubmit:t[11]||(t[11]=P((...o)=>s(J)&&s(J)(...o),["prevent"]))},[e("div",Te,[e("div",Me,[e("label",Fe,[t[12]||(t[12]=e("span",{class:"text-sm font-medium text-foreground"},"Client",-1)),m(s(_),{class:"w-full",placeholder:"Select a Client",modelValue:s(U),"onUpdate:modelValue":t[0]||(t[0]=o=>N(U)?U.value=o:null),options:ae.value,searchable:!0,label:"name","track-by":"uid",onSelect:ne,"option-height":60,"close-on-select":!0},null,8,["modelValue","options"])]),e("label",$e,[t[13]||(t[13]=e("span",{class:"text-sm font-medium text-foreground whitespace-nowrap"},"Client Contact",-1)),m(s(_),{class:"w-full",placeholder:"Select a Client Contact",modelValue:s(k),"onUpdate:modelValue":t[1]||(t[1]=o=>N(k)?k.value=o:null),options:M.value?.contacts??[],"custom-label":xe,"track-by":"uid","close-on-select":!0,searchable:!0},null,8,["modelValue","options"]),e("div",Be,p(s(A).clientContact),1)]),e("label",Ye,[t[15]||(t[15]=e("span",{class:"text-sm font-medium text-foreground"},"Priority",-1)),g(e("select",{name:"priority",id:"priority","onUpdate:modelValue":t[2]||(t[2]=o=>N($)?$.value=o:null),class:"w-full px-3 py-2 bg-background border border-border rounded-md focus:outline-none focus:ring-2 focus:ring-primary/50","aria-label":"Select priority level"},t[14]||(t[14]=[e("option",{value:"0"},"Low",-1),e("option",{value:"1"},"Medium",-1),e("option",{value:"2"},"High",-1)]),512),[[j,s($)]]),e("div",je,p(s(A).priority),1)])]),e("label",Ee,[t[16]||(t[16]=e("span",{class:"text-sm font-medium text-foreground whitespace-nowrap"},"Client Request ID",-1)),g(e("input",{class:"w-full px-3 py-2 bg-background border border-border rounded-md focus:outline-none focus:ring-2 focus:ring-primary/50","onUpdate:modelValue":t[3]||(t[3]=o=>N(F)?F.value=o:null),placeholder:"CRID ..."},null,512),[[I,s(F)]]),e("div",He,p(s(A).clientRequestId),1)]),e("div",Ke,[e("button",{type:"button",onClick:t[4]||(t[4]=o=>R.value=!R.value),class:"w-full px-4 py-3 flex items-center justify-between text-left hover:bg-muted/20 transition-colors duration-200 focus:outline-none focus:ring-2 focus:ring-primary/50 rounded-t-lg"},[t[18]||(t[18]=e("span",{class:"text-sm font-medium text-foreground whitespace-nowrap"},"Clinical Data (click to expand)",-1)),(l(),r("svg",{class:Z(["w-5 h-5 transition-transform duration-200",{"rotate-180":R.value}]),fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},t[17]||(t[17]=[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M19 9l-7 7-7-7"},null,-1)]),2))]),R.value?(l(),r("div",Le,[e("label",ze,[t[19]||(t[19]=e("span",{class:"text-sm font-medium text-foreground whitespace-nowrap w-40"},"Clinical Indication",-1)),g(e("input",{class:"w-full px-3 py-2 bg-background border border-border rounded-md focus:outline-none focus:ring-2 focus:ring-primary/50","onUpdate:modelValue":t[5]||(t[5]=o=>s(d).clinicalIndication=o),placeholder:"Enter clinical indication..."},null,512),[[I,s(d).clinicalIndication]])]),e("div",Oe,[t[20]||(t[20]=e("span",{class:"text-sm font-medium text-foreground w-40"},"Symptoms",-1)),e("div",Je,[g(e("input",{class:"flex-1 px-3 py-2 bg-background border border-border rounded-md focus:outline-none focus:ring-2 focus:ring-primary/50","onUpdate:modelValue":t[6]||(t[6]=o=>v.value=o),placeholder:"Add symptom...",onKeydown:ke(P(O,["prevent","stop"]),["enter"])},null,40,We),[[I,v.value]]),e("button",{type:"button",onClick:O,class:"px-3 py-2 bg-primary text-primary-foreground rounded-md hover:bg-primary/90 transition-colors duration-200 focus:outline-none focus:ring-2 focus:ring-primary/50"}," Add ")]),e("div",Xe,[(l(!0),r(f,null,b(s(d).symptoms,(o,n)=>(l(),r("span",{key:n,class:"inline-flex items-center gap-1 px-2 py-1 bg-muted text-muted-foreground rounded-md text-sm"},[E(p(o)+" ",1),e("button",{type:"button",onClick:c=>be(n),class:"text-destructive hover:text-destructive/80 ml-1"}," × ",8,Ze)]))),128))])]),e("label",Ge,[t[21]||(t[21]=e("span",{class:"text-sm font-medium text-foreground whitespace-nowrap w-40"},"Treatment Notes",-1)),g(e("textarea",{class:"w-full px-3 py-2 bg-background border border-border rounded-md focus:outline-none focus:ring-2 focus:ring-primary/50","onUpdate:modelValue":t[7]||(t[7]=o=>s(d).treatmentNotes=o),placeholder:"Enter treatment notes...",rows:"2"},null,512),[[I,s(d).treatmentNotes]])]),e("div",Qe,[e("label",et,[t[23]||(t[23]=e("span",{class:"text-sm font-medium text-foreground whitespace-nowrap w-40"},"Pregnancy Status",-1)),g(e("select",{"onUpdate:modelValue":t[8]||(t[8]=o=>s(d).pregnancyStatus=o),class:"w-full ml-4 px-3 py-2 bg-background border border-border rounded-md focus:outline-none focus:ring-2 focus:ring-primary/50"},t[22]||(t[22]=[e("option",{value:null},"Not specified",-1),e("option",{value:!0},"Pregnant",-1),e("option",{value:!1},"Not pregnant",-1)]),512),[[j,s(d).pregnancyStatus]])]),e("label",tt,[t[25]||(t[25]=e("span",{class:"text-sm font-medium text-foreground whitespace-nowrap w-40"},"Breastfeeding Status",-1)),g(e("select",{"onUpdate:modelValue":t[9]||(t[9]=o=>s(d).breastFeeding=o),class:"w-full px-3 py-2 bg-background border border-border rounded-md focus:outline-none focus:ring-2 focus:ring-primary/50"},t[24]||(t[24]=[e("option",{value:null},"Not specified",-1),e("option",{value:!0},"Breastfeeding",-1),e("option",{value:!1},"Not breastfeeding",-1)]),512),[[j,s(d).breastFeeding]])])])])):G("",!0)])]),e("section",ot,[e("div",st,[t[26]||(t[26]=e("h5",{class:"text-lg font-semibold text-foreground"},"Samples",-1)),e("div",lt,[e("span",rt,p(s(A).samples),1),s(u)?.length!==20?(l(),r("button",{key:0,type:"button",onClick:t[10]||(t[10]=P(o=>ve(),["prevent"])),class:"px-4 py-2 bg-primary text-primary-foreground rounded-md hover:bg-primary/90 transition-colors duration-200 focus:outline-none focus:ring-2 focus:ring-primary/50"}," Add Sample ")):G("",!0)])]),e("div",at,[t[29]||(t[29]=_e('<div class="absolute left-0 top-0 bottom-0 w-48 bg-muted/30 border-r border-border z-10"><table class="w-full h-full"><thead><tr class="border-b border-border bg-muted/30"><th class="p-4 text-left text-sm font-medium text-foreground h-16"> Field </th></tr></thead><tbody><tr class="border-b border-border h-20 min-h-20 max-h-20"><td class="p-4 text-sm font-medium text-foreground bg-muted/10"> Sample Type </td></tr><tr class="border-b border-border h-20 min-h-20 max-h-20"><td class="p-4 text-sm font-medium text-foreground bg-muted/10"> Date Collected </td></tr><tr class="border-b border-border h-20 min-h-20 max-h-20"><td class="p-4 text-sm font-medium text-foreground bg-muted/10"> Date Received </td></tr><tr class="border-b border-border h-20 min-h-20 max-h-20"><td class="p-4 text-sm font-medium text-foreground bg-muted/10"> Analysis Profiles </td></tr><tr class="border-b border-border h-20 min-h-20 max-h-20"><td class="p-4 text-sm font-medium text-foreground bg-muted/10"> Analysis Services </td></tr><tr class="h-24"><td class="p-4 text-sm font-medium text-foreground bg-muted/10"> Selection Summary </td></tr></tbody></table></div>',1)),e("div",nt,[e("table",it,[e("thead",null,[e("tr",dt,[(l(!0),r(f,null,b(s(u),(o,n)=>(l(),r("th",{key:n,class:"p-4 text-center text-sm font-medium text-foreground w-80 min-w-80 relative h-16 border-r"},[e("div",ut,[e("span",null,"Sample "+p(n+1),1),e("button",{type:"button",onClick:P(c=>ye(n),["prevent"]),disabled:!B.value,class:Z(["px-2 py-1 rounded-md transition-colors duration-200 focus:outline-none focus:ring-2 text-xs ml-2",B.value?"bg-destructive text-destructive-foreground hover:bg-destructive/90 focus:ring-destructive/50":"bg-muted text-muted-foreground cursor-not-allowed"]),title:B.value?"Remove sample":"At least one sample is required"}," Remove ",10,ct)])]))),128))])]),e("tbody",null,[e("tr",mt,[(l(!0),r(f,null,b(s(u),(o,n)=>(l(),r("td",{key:n,class:"p-4 w-80 border-r"},[m(s(_),{class:"w-full",placeholder:"Select sample type",modelValue:o.sampleType,"onUpdate:modelValue":c=>o.sampleType=c,options:ie.value,searchable:!0,label:"name","track-by":"uid",openDirection:"below"},null,8,["modelValue","onUpdate:modelValue","options"])]))),128))]),e("tr",pt,[(l(!0),r(f,null,b(s(u),(o,n)=>(l(),r("td",{key:n,class:"p-4 w-80 border-r"},[m(i,{class:"w-full",modelValue:o.dateCollected,"onUpdate:modelValue":c=>o.dateCollected=c,"max-date":s(L),"time-picker-inline":"",teleport:!0},null,8,["modelValue","onUpdate:modelValue","max-date"])]))),128))]),e("tr",ft,[(l(!0),r(f,null,b(s(u),(o,n)=>(l(),r("td",{key:n,class:"p-4 w-80 border-r"},[m(i,{class:"w-full",modelValue:o.dateReceived,"onUpdate:modelValue":c=>o.dateReceived=c,"min-date":o.dateCollected&&typeof o.dateCollected=="object"&&!(o.dateCollected instanceof Date)&&typeof o.dateCollected.toDate=="function"?o.dateCollected.toDate():o.dateCollected||null,"max-date":s(L),"time-picker-inline":"",teleport:!0},null,8,["modelValue","onUpdate:modelValue","min-date","max-date"])]))),128))]),e("tr",bt,[(l(!0),r(f,null,b(s(u),(o,n)=>(l(),r("td",{key:n,class:"p-4 w-80 border-r"},[m(s(_),{class:"w-full whitespace-nowrap z-10",placeholder:"Select analysis profiles",modelValue:o.profiles,"onUpdate:modelValue":c=>o.profiles=c,options:ce.value,searchable:!0,multiple:!0,label:"name","track-by":"uid",openDirection:"below"},null,8,["modelValue","onUpdate:modelValue","options"])]))),128))]),e("tr",gt,[(l(!0),r(f,null,b(s(u),(o,n)=>(l(),r("td",{key:n,class:"p-4 w-80 border-r"},[m(s(_),{class:"w-full whitespace-nowrap",placeholder:"Select analysis services",modelValue:o.analyses,"onUpdate:modelValue":c=>o.analyses=c,options:ue.value,searchable:!0,multiple:!0,label:"name","track-by":"uid",openDirection:"below"},null,8,["modelValue","onUpdate:modelValue","options"])]))),128))]),e("tr",vt,[(l(!0),r(f,null,b(s(u),(o,n)=>(l(),r("td",{key:n,class:"p-4 w-80 border-r"},[e("div",yt,[o.profiles?.length===0&&o.analyses?.length===0?(l(),r("div",xt," ⚠️ Select profiles or services ")):(l(),r("div",ht,[e("div",wt,[t[27]||(t[27]=e("strong",null,"Profiles:",-1)),E(" "+p(o.profiles?.length||0)+" selected ",1)]),e("div",St,[t[28]||(t[28]=e("strong",null,"Services:",-1)),E(" "+p(o.analyses?.length||0)+" selected ",1)])]))])]))),128))])])])])])]),e("div",Ct,[C.value?(l(),r("div",_t,[m(y,{message:"Adding Samples ..."})])):(l(),r("button",kt," Save Sample(s) "))])],32)])}}}),$t=De(Vt,[["__file","/home/aurthurm/Documents/Development/felicity/felicity-lims/webapp/views/sample/SamplesAdd.vue"]]);export{$t as default};
