const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/AnalysisSneak-Bc5efyoV.js","assets/index-OdhKCqIc.js","assets/index-DD18L2yL.css","assets/index-DVOOl0Kv.js","assets/Spinner-Bl8RfjFA.js","assets/ResultDetail-ZQgtV4qp.js"])))=>i.map(i=>d[i]);
import{Y as se,P as ne,av as oe,a0 as J,a8 as ae,a5 as Q,a6 as X,aI as V,a7 as re,R as le,a3 as de,_ as ie,r as C,aF as ue,c as i,o as l,z as d,a as o,K as a,M as m,F as k,H as I,D as x,A as R,N as Z,C as N,I as p,aG as P,al as ce,E as T}from"./index-OdhKCqIc.js";import{u as fe}from"./analysis-axSHEiPd.js";import{p as me}from"./index-CXV6PIcj.js";import{S as be}from"./Spinner-Bl8RfjFA.js";import{s as pe}from"./index-DJJ2wcNX.js";import"./analyses.mutations-DUxQZn1r.js";const xe=se({__name:"GenericResults",props:{sample:Object,analysisResults:Object,fetchingResults:Boolean},setup(_,{expose:t}){t();const D=Q(()=>X(()=>import("./AnalysisSneak-Bc5efyoV.js"),__vite__mapDeps([0,1,2,3,4]))),e=Q(()=>X(()=>import("./ResultDetail-ZQgtV4qp.js"),__vite__mapDeps([5,1,2]))),A=ne(),b=oe({can_submit:!1,can_cancel:!1,can_retract:!1,can_approve:!1,can_retest:!1,can_reinstate:!1,allChecked:!1});function w(){let n=[];return _.analysisResults?.forEach(u=>{u.checked&&n.push(u)}),n}function f(){let n=w(),u=[];return n?.forEach(g=>u.push({uid:g.uid,result:g.result,methodUid:g.methodUid,laboratoryInstrumentUid:g.laboratoryInstrumentUid})),u}function h(){const n=w();let u=[];return n?.forEach(g=>u.push(g.uid)),u}function j(n){B()?b.allChecked=!0:b.allChecked=!1,E()}function y(n){s(n)||(n.checked=!0,E())}function c(n){n.checked=!1,E()}async function L(){await _.analysisResults?.forEach(n=>b.allChecked?y(n):c(n)),E()}async function v(){await _.analysisResults?.forEach(n=>c(n)),E()}function B(){return _.analysisResults?.every(n=>n.checked===!0)||!1}function s(n){switch(n?.status){case"retracted":return!0;case"approved":return!0;case"cancelled":return _.sample?.status!=="received";default:return!1}}function r(n){n.editable=!0}function S(n){return!["received","paired"].includes(_.sample?.status??"")||n.status!=="pending"?!1:n?.editable||V(n?.result)?(r(n),!0):!1}function $(n){switch(n?.status){case"retracted":return"bg-muted";case"approved":return n?.reportable===!1?"bg-destructive":"";default:return""}}function E(){b.can_cancel=!1,b.can_submit=!1,b.can_retract=!1,b.can_approve=!1,b.can_retest=!1,b.can_reinstate=!1;const n=w();n.length!==0&&(n.every(u=>u.status==="cancelled")&&(b.can_reinstate=!0),n.every(u=>u.status==="pending")&&(b.can_cancel=!0),n.every(u=>["pending"].includes(u.status??"")&&!V(u.result)&&!V(u.methodUid)&&!V(u.laboratoryInstrumentUid))&&(b.can_submit=!0),n.every(u=>u.status==="resulted")&&(b.can_retract=!0,b.can_approve=!0,b.can_retest=!0))}const U=async()=>{const n=re(()=>A.getSample);n.value&&A.fetchSampleStatus(n.value.uid)},ee=(n,u)=>{let g=[];return n?.forEach(z=>g.push(z.name)),u?.forEach(z=>g.push(z.name)),g.join(", ")},q=J(!1),W=J(void 0),te=n=>{q.value=!0,W.value=n};let{submitResults:O,cancelResults:H,reInstateResults:F,approveResults:G,retractResults:K,retestResults:M}=fe();const Y={AnalysisSneak:D,ResultDetail:e,sampleStore:A,state:b,getResultsChecked:w,prepareResults:f,getResultsUids:h,checkCheck:j,check:y,unCheck:c,toggleCheckAll:L,unCheckAll:v,areAllChecked:B,isDisabledRowCheckBox:s,editResult:r,isEditable:S,getResultRowColor:$,resetAnalysesPermissions:E,_updateSample:U,profileAnalysesText:ee,viewInfo:q,viewResultInfo:W,viewAnalysisInfo:te,get submitter_(){return O},set submitter_(n){O=n},get canceller_(){return H},set canceller_(n){H=n},get reInstater_(){return F},set reInstater_(n){F=n},get approver_(){return G},set approver_(n){G=n},get retracter_(){return K},set retracter_(n){K=n},get retester_(){return M},set retester_(n){M=n},submitResults:()=>O(f(),le.Sample,_.sample?.uid).then(()=>U()).finally(()=>v()),cancelResults:()=>H(h()).then(()=>U()).finally(()=>v()),reInstateResults:()=>F(h()).then(()=>U()).finally(()=>v()),approveResults:()=>G(h(),"sample",_.sample?.uid).then(()=>U()).finally(()=>v()),retractResults:()=>K(h()).then(()=>U()).finally(()=>v()),retestResults:()=>M(h()).then(()=>U()).finally(()=>v()),Drawer:ae,get Button(){return de},get parseDate(){return me},get Spinner(){return be},get shield(){return pe}};return Object.defineProperty(Y,"__isScriptSetup",{enumerable:!1,value:!0}),Y}}),ye={class:"space-y-6"},ge={class:"rounded-lg border border-border bg-background shadow-sm"},_e={key:0,class:"p-6 text-center"},he={class:"inline-flex items-center gap-2"},ve={key:1,class:"overflow-x-auto"},ke={class:"flex items-center space-x-2"},Re={class:"flex items-center space-x-2"},Ce=["onClick"],we={class:"font-medium"},Ue={key:0,class:"text-sm text-foreground"},Ie=["onUpdate:modelValue","onChange"],Ee=["value"],Te={key:0,class:"text-sm text-foreground"},Se=["onUpdate:modelValue","onChange"],De=["value"],Ae={class:"text-sm text-foreground"},Be={class:"text-sm text-foreground space-x-1"},Ve={key:0,class:"text-sm text-foreground"},Ne=["onUpdate:modelValue","onChange"],Pe=["value"],je={key:0,class:"text-sm text-foreground"},Le=["onUpdate:modelValue","onKeyup"],Oe=["onUpdate:modelValue","onChange"],He=["value"],Fe={class:"text-sm"},Ge={class:"text-sm text-foreground"},Ke={class:"text-sm text-foreground"},Me={class:"text-sm text-foreground"},ze={class:"text-sm"},qe={class:"flex items-center space-x-4 pt-4"},We={class:"space-y-6"};function Ye(_,t,D,e,A,b){const w=C("Checkbox"),f=C("TableHead"),h=C("TableRow"),j=C("TableHeader"),y=C("font-awesome-icon"),c=C("TableCell"),L=C("TableBody"),v=C("Table"),B=ue("motion-slide-right");return l(),i(k,null,[d("div",ye,[t[26]||(t[26]=d("div",{class:"border-t border-border my-4"},null,-1)),t[27]||(t[27]=d("h3",{class:"text-lg font-semibold text-foreground"},"Analyses/Results",-1)),t[28]||(t[28]=d("div",{class:"border-t border-border my-4"},null,-1)),d("div",ge,[D.fetchingResults?(l(),i("div",_e,[d("span",he,[o(e.Spinner,{class:"size-4"}),t[2]||(t[2]=d("span",{class:"text-sm"},"Fetching analytes ...",-1))])])):(l(),i("div",ve,[o(v,{class:"w-full"},{default:a(()=>[o(j,null,{default:a(()=>[o(h,{class:"border-b border-border bg-muted/50"},{default:a(()=>[o(f,{class:"px-4 py-3 text-left text-sm font-medium text-muted-foreground"},{default:a(()=>[o(w,{checked:e.state.allChecked,"onUpdate:checked":t[0]||(t[0]=s=>{e.state.allChecked=s,e.toggleCheckAll()})},null,8,["checked"])]),_:1}),o(f,{class:"px-4 py-3 text-left text-sm font-medium text-muted-foreground"}),o(f,{class:"px-4 py-3 text-left text-sm font-medium text-muted-foreground"},{default:a(()=>[...t[3]||(t[3]=[m("Analysis",-1)])]),_:1}),o(f,{class:"px-4 py-3 text-left text-sm font-medium text-muted-foreground"},{default:a(()=>[...t[4]||(t[4]=[m("Instrument",-1)])]),_:1}),o(f,{class:"px-4 py-3 text-left text-sm font-medium text-muted-foreground"},{default:a(()=>[...t[5]||(t[5]=[m("Method",-1)])]),_:1}),o(f,{class:"px-4 py-3 text-left text-sm font-medium text-muted-foreground"},{default:a(()=>[...t[6]||(t[6]=[m("Analyst",-1)])]),_:1}),o(f,{class:"px-4 py-3 text-left text-sm font-medium text-muted-foreground"},{default:a(()=>[...t[7]||(t[7]=[m("Reviewer(s)",-1)])]),_:1}),o(f,{class:"px-4 py-3 text-left text-sm font-medium text-muted-foreground"},{default:a(()=>[...t[8]||(t[8]=[m("Interim",-1)])]),_:1}),o(f,{class:"px-4 py-3 text-left text-sm font-medium text-muted-foreground"},{default:a(()=>[...t[9]||(t[9]=[m("Result",-1)])]),_:1}),o(f,{class:"px-4 py-3 text-left text-sm font-medium text-muted-foreground"},{default:a(()=>[...t[10]||(t[10]=[m("Retest",-1)])]),_:1}),o(f,{class:"px-4 py-3 text-left text-sm font-medium text-muted-foreground"},{default:a(()=>[...t[11]||(t[11]=[m("Due Date",-1)])]),_:1}),o(f,{class:"px-4 py-3 text-left text-sm font-medium text-muted-foreground"},{default:a(()=>[...t[12]||(t[12]=[m("Submitted",-1)])]),_:1}),o(f,{class:"px-4 py-3 text-left text-sm font-medium text-muted-foreground"},{default:a(()=>[...t[13]||(t[13]=[m("Approved",-1)])]),_:1}),o(f,{class:"px-4 py-3 text-left text-sm font-medium text-muted-foreground"},{default:a(()=>[...t[14]||(t[14]=[m("Status",-1)])]),_:1}),o(f,{class:"px-4 py-3 text-left text-sm font-medium text-muted-foreground"},{default:a(()=>[...t[15]||(t[15]=[m("Reportable",-1)])]),_:1}),o(f,{class:"px-4 py-3"})]),_:1})]),_:1}),o(L,null,{default:a(()=>[(l(!0),i(k,null,I(D.analysisResults,s=>x((l(),R(h,{key:s.uid,class:Z([e.getResultRowColor(s),"hover:bg-muted/50 transition-colors duration-200"])},{default:a(()=>[o(c,{class:"px-4 py-3 border-b border-border"},{default:a(()=>[d("div",ke,[o(w,{checked:s.checked,disabled:e.isDisabledRowCheckBox(s),"onUpdate:checked":r=>{s.checked=r,e.checkCheck(s)}},null,8,["checked","disabled","onUpdate:checked"]),s.status==="pending"?(l(),R(y,{key:0,icon:"fa-question",class:"text-xs text-muted-foreground"})):N("",!0),s.status==="resulted"?(l(),R(y,{key:1,icon:"fa-question",class:"text-xs text-warning"})):N("",!0)])]),_:2},1024),o(c,{class:"px-4 py-3 border-b border-border"}),o(c,{class:"px-4 py-3 border-b border-border"},{default:a(()=>[d("div",Re,[d("button",{type:"button",onClick:r=>e.viewAnalysisInfo(s),class:"text-primary hover:text-primary/80 transition-colors"},[o(y,{icon:"fa-info-circle"})],8,Ce),d("span",we,p(s.analysis?.name),1)])]),_:2},1024),o(c,{class:"px-4 py-3 border-b border-border"},{default:a(()=>[e.isEditable(s)?x((l(),i("select",{key:1,"onUpdate:modelValue":r=>s.laboratoryInstrumentUid=r,onChange:r=>e.check(s),class:"w-full rounded-md border border-input bg-background px-3 py-2 text-sm ring-offset-background focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2"},[t[16]||(t[16]=d("option",{value:""},null,-1)),(l(!0),i(k,null,I(s.analysis?.instruments,r=>(l(),i(k,{key:r.uid},[(l(!0),i(k,null,I(r.laboratoryInstruments,S=>(l(),i("option",{key:S.uid,value:S.uid},p(S.labName)+" â†’ ("+p(r?.name)+") ",9,Ee))),128))],64))),128))],40,Ie)),[[P,s.laboratoryInstrumentUid]]):(l(),i("div",Ue,p(s.laboratoryInstrument?.labName||"---"),1))]),_:2},1024),o(c,{class:"px-4 py-3 border-b border-border"},{default:a(()=>[e.isEditable(s)?x((l(),i("select",{key:1,"onUpdate:modelValue":r=>s.methodUid=r,onChange:r=>e.check(s),class:"w-full rounded-md border border-input bg-background px-3 py-2 text-sm ring-offset-background focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2"},[t[17]||(t[17]=d("option",{value:""},null,-1)),(l(!0),i(k,null,I(s.analysis?.methods,r=>(l(),i("option",{key:r.uid,value:r.uid},p(r.name),9,De))),128))],40,Se)),[[P,s.methodUid]]):(l(),i("div",Te,p(s.method?.name||"---"),1))]),_:2},1024),o(c,{class:"px-4 py-3 border-b border-border"},{default:a(()=>[d("span",Ae,p(`${s.submittedBy?.firstName??"--"} ${s.submittedBy?.lastName??"--"}`),1)]),_:2},1024),o(c,{class:"px-4 py-3 border-b border-border"},{default:a(()=>[d("div",Be,[(l(!0),i(k,null,I(s.verifiedBy,r=>(l(),i("span",{key:r.uid},p(`${r?.firstName??"--"} ${r?.lastName??"--"},`),1))),128))])]),_:2},1024),o(c,{class:"px-4 py-3 border-b border-border"},{default:a(()=>[!e.isEditable(s)||s?.analysis?.interims?.length===0?(l(),i("div",Ve," --- ")):x((l(),i("select",{key:1,"onUpdate:modelValue":r=>s.result=r,onChange:r=>e.check(s),class:"w-full rounded-md border border-input bg-background px-3 py-2 text-sm ring-offset-background focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2"},[t[18]||(t[18]=d("option",{value:""},null,-1)),(l(!0),i(k,null,I(s?.analysis?.interims,r=>(l(),i("option",{key:r.key,value:r.value},p(r.value),9,Pe))),128))],40,Ne)),[[P,s.result]])]),_:2},1024),o(c,{class:"px-4 py-3 border-b border-border"},{default:a(()=>[e.isEditable(s)?s?.analysis?.resultOptions?.length===0?x((l(),i("input",{key:1,"onUpdate:modelValue":r=>s.result=r,onKeyup:r=>e.check(s),class:"w-full rounded-md border border-input bg-background px-3 py-2 text-sm ring-offset-background focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2"},null,40,Le)),[[ce,s.result]]):x((l(),i("select",{key:2,"onUpdate:modelValue":r=>s.result=r,onChange:r=>e.check(s),class:"w-full rounded-md border border-input bg-background px-3 py-2 text-sm ring-offset-background focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2"},[t[19]||(t[19]=d("option",{value:""},null,-1)),(l(!0),i(k,null,I(s?.analysis?.resultOptions,r=>(l(),i("option",{key:r.optionKey,value:r.value},p(r.value),9,He))),128))],40,Oe)),[[P,s.result]]):(l(),i("div",je,p(s?.result),1))]),_:2},1024),o(c,{class:"px-4 py-3 border-b border-border"},{default:a(()=>[d("div",Fe,[s?.retest?(l(),R(y,{key:0,icon:"fa-check-circle",class:"text-success"})):(l(),R(y,{key:1,icon:"fa-times-circle",class:"text-destructive"}))])]),_:2},1024),o(c,{class:"px-4 py-3 border-b border-border"},{default:a(()=>[d("span",Ge,p(e.parseDate(s?.dueDate)),1)]),_:2},1024),o(c,{class:"px-4 py-3 border-b border-border"},{default:a(()=>[d("span",Ke,p(e.parseDate(s?.dateSubmitted)),1)]),_:2},1024),o(c,{class:"px-4 py-3 border-b border-border"},{default:a(()=>[d("span",Me,p(e.parseDate(s?.dateVerified)),1)]),_:2},1024),o(c,{class:"px-4 py-3 border-b border-border"},{default:a(()=>[d("span",{class:Z(["inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium",{"bg-primary/10 text-primary":s.status==="pending","bg-warning/10 text-warning":s.status==="resulted","bg-success/10 text-success":s.status==="approved","bg-destructive/10 text-destructive":s.status==="cancelled"||s.status==="retracted"}])},p(s.status),3)]),_:2},1024),o(c,{class:"px-4 py-3 border-b border-border"},{default:a(()=>[d("div",ze,[s?.reportable?(l(),R(y,{key:0,icon:"fa-thumbs-up",class:"text-success","aria-label":"Reportable"})):(l(),R(y,{key:1,icon:"fa-thumbs-down",class:"text-destructive","aria-label":"Not reportable"}))])]),_:2},1024),o(c,{class:"px-4 py-3 border-b border-border"})]),_:2},1032,["class"])),[[B]])),128))]),_:1})]),_:1})]))]),d("div",qe,[x(o(e.Button,{key:"cancel",onClick:e.cancelResults,color:"destructive"},{default:a(()=>[...t[20]||(t[20]=[m(" Cancel ",-1)])]),_:1},512),[[T,e.shield.hasRights(e.shield.actions.UPDATE,e.shield.objects.RESULT)&&e.state.can_cancel]]),x(o(e.Button,{key:"reinstate",onClick:e.reInstateResults,color:"warning"},{default:a(()=>[...t[21]||(t[21]=[m(" Re-Instate ",-1)])]),_:1},512),[[T,e.shield.hasRights(e.shield.actions.UPDATE,e.shield.objects.RESULT)&&e.state.can_reinstate]]),x(o(e.Button,{key:"submit",onClick:e.submitResults,color:"primary"},{default:a(()=>[...t[22]||(t[22]=[m(" Submit ",-1)])]),_:1},512),[[T,e.shield.hasRights(e.shield.actions.UPDATE,e.shield.objects.RESULT)&&e.state.can_submit]]),x(o(e.Button,{key:"retract",onClick:e.retractResults,color:"warning"},{default:a(()=>[...t[23]||(t[23]=[m(" Retract ",-1)])]),_:1},512),[[T,e.shield.hasRights(e.shield.actions.UPDATE,e.shield.objects.RESULT)&&e.state.can_retract]]),x(o(e.Button,{key:"verify",onClick:e.approveResults,color:"success"},{default:a(()=>[...t[24]||(t[24]=[m(" Verify ",-1)])]),_:1},512),[[T,e.shield.hasRights(e.shield.actions.UPDATE,e.shield.objects.RESULT)&&e.state.can_approve]]),x(o(e.Button,{key:"retest",onClick:e.retestResults,color:"warning"},{default:a(()=>[...t[25]||(t[25]=[m(" Retest ",-1)])]),_:1},512),[[T,e.shield.hasRights(e.shield.actions.UPDATE,e.shield.objects.RESULT)&&e.state.can_retest]])])]),o(e.Drawer,{show:e.viewInfo,onClose:t[1]||(t[1]=s=>e.viewInfo=!1),"content-width":"w-2/4"},{header:a(()=>[...t[29]||(t[29]=[d("h3",{class:"text-lg font-semibold text-foreground"},"Result Information",-1)])]),body:a(()=>[d("div",We,[e.viewResultInfo?.analysisUid?(l(),R(e.AnalysisSneak,{key:0,analysisUid:e.viewResultInfo?.analysisUid},null,8,["analysisUid"])):N("",!0),e.viewResultInfo?.uid?(l(),R(e.ResultDetail,{key:1,analysisResultesultUid:e.viewResultInfo?.uid},null,8,["analysisResultesultUid"])):N("",!0)])]),_:1},8,["show"])],64)}const lt=ie(xe,[["render",Ye],["__file","/home/administrator/Documents/Development/beak-insights/felicity/felicity-lims/webapp/views/sample/_id/results/GenericResults.vue"]]);export{lt as default};
