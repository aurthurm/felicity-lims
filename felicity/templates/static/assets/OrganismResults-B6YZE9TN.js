import{Y as P,u as q,a0 as _,a7 as E,ah as K,av as L,R as V,a3 as Q,_ as Y,r as p,c as f,o as l,z as n,A as v,C as O,K as o,M as c,a as r,F as N,H,I as T,D as z,al as F}from"./index-OdhKCqIc.js";import{u as J}from"./analysis-axSHEiPd.js";import{G as W,A as X,S as Z,D as $,a as ee}from"./microbiology.mutations-cVAbKt4K.js";import"./analyses.mutations-DUxQZn1r.js";const se=P({__name:"OrganismResults",props:{sample:{type:Object,required:!0},analysisResults:{type:Object,required:!0}},setup(k,{expose:e}){e();const{withClientMutation:R,withClientQuery:s}=q(),i=_([]),B=_(!1),g=_(""),C=_([]),b=_(void 0),u=_(!1),d=E(()=>k.analysisResults[0]);K(()=>{s(W,{analysisResultUid:d.value.uid},"abxOrganismResultAll").then(t=>{t&&(i.value=t||[])}).finally(()=>D())});function S(){u.value=!0,R(X,{analysisResultUid:d.value.uid},"createAbxOrganismResult").then(t=>{t&&i.value.unshift(t)}).finally(()=>u.value=!1)}function U(t){u.value=!0,R(Z,{uid:t.uid,organismUid:t.organism?.uid??""},"saveAbxOrganismResult").then(m=>{if(m){const x=i.value.findIndex(y=>y.uid===t.uid);if(x>-1){const y=m.organism;i.value[x].organismUid=y?.uid,i.value[x].organism=y}}}).finally(()=>{u.value=!1,D()})}function a(t){u.value=!0,R($,{uid:t.uid},"removeAbxOrganismResult").then(m=>{if(m){const x=i.value.findIndex(y=>y.uid===m?.uid);x>-1&&i.value.splice(x,1)}}).finally(()=>{u.value=!1,D()})}function h(t){b.value=t,B.value=!0}function w(t){B.value=!1,i.value[b.value].organism=t,b.value=void 0,k.analysisResults[0].result=i.value?.map(m=>m.organism?.name).join(", ")}function G(){g.value.length<3||s(ee,{text:g.value,pageSize:25,sortBy:["name"]},"abxOrganismAll").then(t=>{C.value=t?.items})}const A=L({can_submit:!1,can_approve:!1});function D(){A.can_submit=!1,A.can_approve=!1;const t=i.value?.every(m=>m.organismUid!=null);d.value.status=="pending"&&t&&(A.can_submit=!0),d.value.status=="resulted"&&(A.can_approve=!0)}let{submitResults:j,approveResults:M}=J();const I={withClientMutation:R,withClientQuery:s,organismResults:i,showModal:B,searchOrgText:g,organisms:C,pickIndex:b,addingOrganism:u,analysisResult:d,addOrganism:S,saveOrgResult:U,removeOrgResult:a,pickOrganism:h,selectOrganism:w,searchOrganisms:G,state:A,resetAnalysesPermissions:D,get submitter_(){return j},set submitter_(t){j=t},get approver_(){return M},set approver_(t){M=t},submitResults:()=>j([{uid:d.value.uid,result:d.value.result??"",methodUid:"felicity_ast",laboratoryInstrumentUid:"felicity_ast"}],V.Sample,k.sample?.uid).then(()=>{}),approveResults:()=>M([d.value.uid],V.Sample,k.sample?.uid).then(()=>{}),get Button(){return Q}};return Object.defineProperty(I,"__isScriptSetup",{enumerable:!1,value:!0}),I}}),te={class:"space-y-6"},ae={class:"bg-background rounded-lg shadow-sm"},ne={class:"p-6 space-y-6"},oe={class:"flex items-center justify-between"},le={class:"overflow-x-auto"},ie={class:"text-sm text-foreground"},re={key:0,class:"text-sm text-primary"},ue={class:"flex items-center justify-end space-x-2"},de={class:"bg-background rounded-lg shadow-sm p-6 space-y-6"},me={class:"flex items-center justify-between"},ce={class:"inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-primary text-primary-foreground"},fe={class:"space-y-4"},ge={key:1,class:"text-sm text-muted-foreground"},pe={class:"flex justify-end space-x-4"},ve={class:"p-6 space-y-6"},be={class:"flex items-center space-x-4"},xe={class:"space-y-2"},ye=["onClick"];function _e(k,e,R,s,i,B){const g=p("TableHead"),C=p("TableRow"),b=p("TableHeader"),u=p("TableCell"),d=p("TableBody"),S=p("Table"),U=p("Modal");return l(),f("div",te,[n("div",ae,[n("div",ne,[n("div",oe,[e[5]||(e[5]=n("h3",{class:"text-lg font-semibold text-foreground"},"Organisms",-1)),s.analysisResult.status=="pending"?(l(),v(s.Button,{key:0,onClick:e[0]||(e[0]=a=>s.addOrganism()),disabled:s.addingOrganism,color:"primary"},{default:o(()=>[...e[4]||(e[4]=[c(" Add Organism ",-1)])]),_:1},8,["disabled"])):O("",!0)]),e[12]||(e[12]=n("div",{class:"border-t border-border"},null,-1)),n("div",le,[r(S,{class:"w-full"},{default:o(()=>[r(b,null,{default:o(()=>[r(C,{class:"border-b border-border bg-muted/50"},{default:o(()=>[r(g,{class:"px-4 py-2 text-left text-sm font-medium text-foreground"},{default:o(()=>[...e[6]||(e[6]=[c("Isolate Number",-1)])]),_:1}),r(g,{class:"px-4 py-2 text-left text-sm font-medium text-foreground"},{default:o(()=>[...e[7]||(e[7]=[c("Organism Name",-1)])]),_:1}),r(g,{class:"px-4 py-2"})]),_:1})]),_:1}),r(d,null,{default:o(()=>[(l(!0),f(N,null,H(s.organismResults,(a,h)=>(l(),v(C,{key:a?.uid,class:"border-b border-border hover:bg-muted/50 transition-colors duration-200"},{default:o(()=>[r(u,{class:"px-4 py-2"},{default:o(()=>[n("span",ie,"#"+T(a?.isolateNumber),1)]),_:2},1024),r(u,{class:"px-4 py-2"},{default:o(()=>[a?.organism?(l(),f("span",re,T(a?.organism?.name),1)):(l(),v(s.Button,{key:1,onClick:w=>s.pickOrganism(h),color:"outline"},{default:o(()=>[...e[8]||(e[8]=[c(" Pick Organism ",-1)])]),_:1},8,["onClick"]))]),_:2},1024),r(u,{class:"px-4 py-2 text-right"},{default:o(()=>[n("div",ue,[a?.organism&&!a?.organismUid?(l(),f(N,{key:0},[r(s.Button,{onClick:w=>s.pickOrganism(h),color:"destructive"},{default:o(()=>[...e[9]||(e[9]=[c(" Change ",-1)])]),_:1},8,["onClick"]),r(s.Button,{onClick:w=>s.saveOrgResult(a),color:"primary"},{default:o(()=>[...e[10]||(e[10]=[c(" Save ",-1)])]),_:1},8,["onClick"])],64)):O("",!0),s.analysisResult.status=="pending"&&s.organismResults.length>1?(l(),v(s.Button,{key:1,onClick:w=>s.removeOrgResult(a),color:"destructive"},{default:o(()=>[...e[11]||(e[11]=[c(" Delete ",-1)])]),_:1},8,["onClick"])):O("",!0)])]),_:2},1024)]),_:2},1024))),128))]),_:1})]),_:1})])])]),n("div",de,[n("div",me,[e[13]||(e[13]=n("h4",{class:"text-lg font-semibold text-foreground"},"Culture",-1)),n("span",ce,T(s.analysisResult.status),1)]),e[16]||(e[16]=n("div",{class:"border-t border-border"},null,-1)),n("div",fe,[s.analysisResult.status=="pending"?z((l(),f("textarea",{key:0,"onUpdate:modelValue":e[1]||(e[1]=a=>s.analysisResult.result=a),rows:"4",class:"w-full rounded-md border border-input bg-background px-3 py-2 text-sm ring-offset-background placeholder:text-muted-foreground focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50",placeholder:"Enter culture results..."},null,512)),[[F,s.analysisResult.result]]):(l(),f("p",ge,T(s.analysisResult.result),1)),n("div",pe,[s.state.can_submit?(l(),v(s.Button,{key:0,onClick:s.submitResults,color:"primary"},{default:o(()=>[...e[14]||(e[14]=[c(" Submit Results ",-1)])]),_:1})):O("",!0),s.state.can_approve?(l(),v(s.Button,{key:1,onClick:s.approveResults,color:"primary"},{default:o(()=>[...e[15]||(e[15]=[c(" Approve Results ",-1)])]),_:1})):O("",!0)])])]),s.showModal?(l(),v(U,{key:0,onClose:e[3]||(e[3]=a=>s.showModal=!1)},{header:o(()=>[...e[17]||(e[17]=[n("h3",{class:"text-xl font-semibold text-foreground"},"Select Organism",-1)])]),body:o(()=>[n("div",ve,[n("div",be,[z(n("input",{type:"text","onUpdate:modelValue":e[2]||(e[2]=a=>s.searchOrgText=a),onInput:s.searchOrganisms,placeholder:"Search organisms...",class:"flex-1 rounded-md border border-input bg-background px-3 py-2 text-sm ring-offset-background placeholder:text-muted-foreground focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2"},null,544),[[F,s.searchOrgText]])]),n("div",xe,[(l(!0),f(N,null,H(s.organisms,a=>(l(),f("button",{key:a.uid,onClick:h=>s.selectOrganism(a),class:"w-full text-left px-4 py-2 text-sm text-foreground hover:bg-muted/50 rounded-md transition-colors duration-200"},T(a.name),9,ye))),128))])])]),_:1})):O("",!0)])}const Ae=Y(se,[["render",_e],["__file","/home/administrator/Documents/Development/beak-insights/felicity/felicity-lims/webapp/views/sample/_id/results/OrganismResults.vue"]]);export{Ae as default};
