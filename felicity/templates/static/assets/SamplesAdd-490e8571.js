import{S as ae,u as ne,V as ie,f as re,i as f,h as M,a0 as N,r as B,o as n,c as i,N as t,C as u,X as F,a5 as o,ad as y,H as r,a as h,a2 as v,F as b,E as x,A as w,K as de,j as ue,_ as ce}from"./index-628f1f8f.js";import pe from"./vue-multiselect.esm-c818a0fb.js";import{u as me}from"./patient-6e80b802.js";import{u as fe}from"./analysis-0fa3a8dc.js";import{u as ye}from"./client-5eea332b.js";import{A as ve}from"./analyses.mutations-ee5b99ac.js";import{c as $,a as j,b as E,d as be,u as xe,e as c}from"./array-c8de4167.js";import{f as ge}from"./index-1c874f2e.js";/* empty css                                                                 */import"./location-1637c667.js";const Se={class:"space-y-6"},Ce={class:"space-y-4"},_e={class:"flex flex-col space-y-2"},ke={class:"text-sm text-destructive"},Ae={class:"flex flex-col space-y-2"},Ve={class:"text-sm text-destructive"},De={class:"flex flex-col space-y-2"},Ue={class:"flex flex-col space-y-2"},he=["value"],we={class:"text-sm text-destructive"},Re={class:"flex flex-col space-y-2"},qe={class:"text-sm text-destructive"},Pe={id:"samples",class:"space-y-4"},Te={class:"flex justify-between items-center"},Ie={class:"text-sm text-destructive"},Me={class:"flex items-start justify-between gap-4"},Ne={class:"flex-1 space-y-4"},Be={class:"flex flex-col space-y-2"},Fe=["onUpdate:modelValue"],$e=["value"],je={class:"flex flex-col space-y-2"},Ee={class:"flex flex-col space-y-2"},He=["onUpdate:modelValue"],Ye=["value"],Le={class:"flex flex-col space-y-2"},Ke=["onUpdate:modelValue"],Xe=["value"],ze=["onClick"],Ge={class:"flex justify-end pt-4"},Je={key:0,type:"submit",class:"px-6 py-2 bg-primary text-primary-foreground rounded-md hover:bg-primary/90 transition-colors duration-200 focus:outline-none focus:ring-2 focus:ring-primary/50"},Oe={key:1,class:"py-4 text-center"},Qe=ae({__name:"SamplesAdd",setup(We){const C=ne(),H=me(),g=fe(),R=ye(),Y=ie(),{withClientMutation:L}=re(),{swalError:q}=ue();let _=f(()=>H.getPatient),K=M({first:void 0,after:"",text:"",sortBy:["name"],contacts:!0});R.fetchClients(K);const X=f(()=>R.getClients),z=N(null),G=a=>{z.value=a};C.fetchSampleTypes();const J=f(()=>C.getSampleTypes);let O=M({first:void 0,after:"",text:"",sortBy:["name"]});g.fetchAnalysesServices(O);const Q=f(()=>{const a=g.getAnalysesServicesSimple;let e=new Set;return a.forEach((d,T)=>{d.profiles?.length===0&&e.add(d)}),[...e]});g.fetchAnalysesProfiles();const W=f(()=>g.getAnalysesProfiles),k=N(!1),Z=new Date,ee=$({clientRequestId:j().required("Client Request ID is Required"),clinicalData:j().nullable(),client:$().required("Client is Required"),clientContactUid:E().required("Client Contact is Required"),samples:be().required().min(1,"Add at least 1 sample"),priority:E()}),{handleSubmit:te,errors:p}=xe({validationSchema:ee,initialValues:{priority:0,client:_?.value?.client,samples:[]}}),{value:A}=c("clientRequestId"),{value:V}=c("clinicalData"),{value:m}=c("client"),{value:D}=c("clientContactUid"),{value:U}=c("priority"),{value:S}=c("samples"),P=te(a=>{k.value=!0;for(let e of a.samples||[]){if(typeof e?.sampleType!="string"){q("Samples must have sample types");return}if(e?.analyses?.length<=0&&e?.profiles?.length<=0){q("Samples must have either profiles/analyses or both");return}}se(a)});function se(a){const e={patientUid:_.value?.uid,clientRequestId:a.clientRequestId,clinicalData:a.clinicalData,clientUid:m?.value?.uid,clientContactUid:a.clientContactUid,samples:a.samples?.map(d=>({...d,dateCollected:ge(d.dateCollected,"YYYY-MM-DD HH:mm")}))};L(ve,{payload:e},"createAnalysisRequest").then(d=>{C.addAnalysisRequest(d),Y.push({name:"patient-detail",params:{patientUid:_.value?.uid}})}).finally(()=>{k.value=!1})}function le(){const a={sampleType:{},dateCollected:"",profiles:[],analyses:[]};S.value.push(a)}function oe(a){S.value.splice(a,1)}return(a,e)=>{const d=B("VueDatePicker"),T=B("fel-loader");return n(),i("div",Se,[e[22]||(e[22]=t("h5",{class:"text-xl font-semibold text-foreground mb-4"},"Add Analysis Request",-1)),t("form",{action:"post",class:"p-6 bg-background rounded-lg shadow-sm space-y-6",onSubmit:e[6]||(e[6]=w((...s)=>o(P)&&o(P)(...s),["prevent"]))},[t("div",Ce,[t("label",_e,[e[7]||(e[7]=t("span",{class:"text-sm font-medium text-foreground"},"Client Request ID",-1)),u(t("input",{class:"w-full px-3 py-2 bg-background border border-border rounded-md focus:outline-none focus:ring-2 focus:ring-primary/50","onUpdate:modelValue":e[0]||(e[0]=s=>y(A)?A.value=s:null),placeholder:"CRID ..."},null,512),[[F,o(A)]]),t("div",ke,r(o(p).clientRequestId),1)]),t("label",Ae,[e[8]||(e[8]=t("span",{class:"text-sm font-medium text-foreground"},"Clinical Data",-1)),u(t("textarea",{class:"w-full px-3 py-2 bg-background border border-border rounded-md focus:outline-none focus:ring-2 focus:ring-primary/50","onUpdate:modelValue":e[1]||(e[1]=s=>y(V)?V.value=s:null),placeholder:"Clinical Data ..."},null,512),[[F,o(V)]]),t("div",Ve,r(o(p).clinicalData),1)]),t("label",De,[e[9]||(e[9]=t("span",{class:"text-sm font-medium text-foreground"},"Client",-1)),h(o(pe),{class:"w-full",placeholder:"Select a Client",modelValue:o(m),"onUpdate:modelValue":e[2]||(e[2]=s=>y(m)?m.value=s:null),options:X.value,searchable:!0,label:"name","track-by":"uid",onSelect:G},null,8,["modelValue","options"])]),t("label",Ue,[e[11]||(e[11]=t("span",{class:"text-sm font-medium text-foreground"},"Client Contacts",-1)),u(t("select",{name:"clientContacts",id:"clientContacts","onUpdate:modelValue":e[3]||(e[3]=s=>y(D)?D.value=s:null),class:"w-full px-3 py-2 bg-background border border-border rounded-md focus:outline-none focus:ring-2 focus:ring-primary/50","aria-label":"Select client contact"},[e[10]||(e[10]=t("option",{value:""},null,-1)),(n(!0),i(b,null,x(o(m)?.contacts,s=>(n(),i("option",{key:s.uid,value:s.uid},r(s.firstName)+" "+r(s.lastName),9,he))),128))],512),[[v,o(D)]]),t("div",we,r(o(p).clientContactUid),1)]),t("label",Re,[e[13]||(e[13]=t("span",{class:"text-sm font-medium text-foreground"},"Priority",-1)),u(t("select",{name:"priority",id:"priority","onUpdate:modelValue":e[4]||(e[4]=s=>y(U)?U.value=s:null),class:"w-full px-3 py-2 bg-background border border-border rounded-md focus:outline-none focus:ring-2 focus:ring-primary/50","aria-label":"Select priority level"},e[12]||(e[12]=[t("option",{value:"0"},"Low",-1),t("option",{value:"1"},"Medium",-1),t("option",{value:"2"},"High",-1)]),512),[[v,o(U)]]),t("div",qe,r(o(p).priority),1)])]),t("section",Pe,[t("div",Te,[e[14]||(e[14]=t("h5",{class:"text-lg font-semibold text-foreground"},"Samples",-1)),t("span",Ie,r(o(p).samples),1),o(S)?.length!==20?(n(),i("button",{key:0,onClick:e[5]||(e[5]=w(s=>le(),["prevent"])),class:"px-4 py-2 bg-primary text-primary-foreground rounded-md hover:bg-primary/90 transition-colors duration-200 focus:outline-none focus:ring-2 focus:ring-primary/50"}," Add Sample ")):de("v-if",!0)]),(n(!0),i(b,null,x(o(S),(s,I)=>(n(),i("div",{key:I,class:"space-y-4 p-4 border border-border rounded-lg"},[t("div",Me,[t("div",Ne,[t("label",Be,[e[16]||(e[16]=t("span",{class:"text-sm font-medium text-foreground"},"Sample Type",-1)),u(t("select",{name:"sampleTypes",id:"sampleTypes","onUpdate:modelValue":l=>s.sampleType=l,class:"w-full px-3 py-2 bg-background border border-border rounded-md focus:outline-none focus:ring-2 focus:ring-primary/50","aria-label":"Select sample type"},[e[15]||(e[15]=t("option",{value:""},null,-1)),(n(!0),i(b,null,x(J.value,l=>(n(),i("option",{key:l.uid,value:l.uid},r(l.name),9,$e))),128))],8,Fe),[[v,s.sampleType]])]),t("label",je,[e[17]||(e[17]=t("span",{class:"text-sm font-medium text-foreground"},"Date Collected",-1)),h(d,{class:"w-full",modelValue:s.dateCollected,"onUpdate:modelValue":l=>s.dateCollected=l,"max-date":o(Z),"time-picker-inline":""},null,8,["modelValue","onUpdate:modelValue","max-date"])]),t("label",Ee,[e[19]||(e[19]=t("span",{class:"text-sm font-medium text-foreground"},"Analysis Profiles",-1)),u(t("select",{name:"analysisProfiles",id:"analysisProfiles","onUpdate:modelValue":l=>s.profiles=l,class:"w-full px-3 py-2 bg-background border border-border rounded-md focus:outline-none focus:ring-2 focus:ring-primary/50",multiple:"","aria-label":"Select analysis profiles"},[e[18]||(e[18]=t("option",{value:""},null,-1)),(n(!0),i(b,null,x(W.value,l=>(n(),i("option",{key:l.uid,value:l.uid},r(l.name),9,Ye))),128))],8,He),[[v,s.profiles]])]),t("label",Le,[e[21]||(e[21]=t("span",{class:"text-sm font-medium text-foreground"},"Analysis Services",-1)),u(t("select",{name:"analysesServices",id:"analysesServices","onUpdate:modelValue":l=>s.analyses=l,class:"w-full px-3 py-2 bg-background border border-border rounded-md focus:outline-none focus:ring-2 focus:ring-primary/50",multiple:"","aria-label":"Select analysis services"},[e[20]||(e[20]=t("option",{value:""},null,-1)),(n(!0),i(b,null,x(Q.value,l=>(n(),i("option",{key:l.uid,value:l.uid},r(l.name),9,Xe))),128))],8,Ke),[[v,s.analyses]])])]),t("button",{onClick:w(l=>oe(I),["prevent"]),class:"px-4 py-2 bg-destructive text-destructive-foreground rounded-md hover:bg-destructive/90 transition-colors duration-200 focus:outline-none focus:ring-2 focus:ring-destructive/50"}," Remove ",8,ze)])]))),128))]),t("div",Ge,[k.value?(n(),i("div",Oe,[h(T,{message:"Adding Samples ..."})])):(n(),i("button",Je," Add Sample(s) "))])],32)])}}}),dt=ce(Qe,[["__file","/home/aurthurm/Documents/Development/felicity/felicity-lims/webapp/views/sample/SamplesAdd.vue"]]);export{dt as default};
