import{e as T,d as O,P as E,t as V,ai as C,h as P,$ as R,o as d,c,b as r,a2 as l,a as j,A as z,F as b,D as y,E as u,L,a5 as m,X as J,Y as G,_ as I}from"./index-e1b11e1a.js";import{u as M}from"./user-3cd24915.js";import{d as Q}from"./_queries-2b677941.js";const{withClientQuery:X}=T(),Y=O("auditlog",{state:()=>({auditLogs:[],fetchingAudits:!1}),getters:{getAuditLogs:f=>f.auditLogs},actions:{async fetchAuditLogs(f){this.fetchingAudits=!0,await X(Q,f,"auditLogsFilter").then(_=>{this.fetchingAudits=!1,this.auditLogs=_?.map(n=>(n.stateAfter=typeof n?.stateAfter=="string"?JSON.parse(n?.stateAfter):n?.stateAfter,n.stateBefore=typeof n?.stateBefore=="string"?JSON.parse(n?.stateBefore):n?.stateBefore,n))}).catch(_=>this.fetchingAudits=!1)},async restLogs(){this.auditLogs=[]}}}),$={class:"relative mt-4"},q={key:0,class:"py-4 text-center"},H={key:1,initial:{opacity:0,y:100},enter:{opacity:1,y:0,scale:1},variants:{custom:{scale:2}},delay:200,class:"list-none m-0 p-0"},K={class:"flex items-center mb-1"},W={class:"ml-4 font-medium italic"},Z={class:"ml-12 w-100"},v={class:"col-span-1"},B={class:"text-sm text-gray-600 italic"},k={class:"col-span-3"},A={class:"text-muted text-xs text-orange-600"},tt={class:"text-muted text-xs text-sky-800"},et=E({__name:"FelAuditLog",props:{targetUid:String,targetType:String},setup(f){const _=J(()=>G(()=>import("./FelLoadingMessage-16252ca6.js"),["assets/FelLoadingMessage-16252ca6.js","assets/index-e1b11e1a.js","assets/index-78b87750.css"])),n=f,{targetType:x,targetUid:S}=V(n),h=M(),g=Y();g.restLogs();const{auditLogs:w,fetchingAudits:D}=C(g);h.fetchUsers({}),g.fetchAuditLogs({targetType:x?.value,targetUid:S?.value});let U=P(()=>h.getUsers);function o(a){const i=U?.value?.find(p=>p.uid?.toString()===a?.toString());return i?i.userName:""}function N(a){return a===1?"created":a===2?"updated":a===3?"deleted":""}function F(a){let i=new Set;return Object.entries(a?.stateBefore)?.map(([p,e])=>{Object.entries(a?.stateAfter)?.map(([t,s])=>{p===t&&e!==s&&(t&&t==="updated_by_uid"&&(t="updated_by",e=o(e),s=o(s)),t&&t==="submitted_by_uid"&&(t="submitted_by",e=o(e),s=o(s)),t&&t==="verified_by_uid"&&(t="verified_by",e=o(e),s=o(s)),t&&t==="updated_at"&&(t="updated_on",e=m(e),s=m(s)),t&&t==="cancelled_by_uid"&&(t="cancelled_by",e=o(e),s=o(s)),t&&t==="received_by_uid"&&(t="received_by",e=o(e),s=o(s)),i.add({key:t,old:e?.length>0?e:"None",new:s?.toString()?.length>0?s:"None"}))})}),i}return(a,i)=>{const p=R("motion");return d(),c("div",$,[i[3]||(i[3]=r("div",{class:"border-r-2 border-gray-400 border-dotted absolute h-full top-0 z-0",style:{left:"7px"}},null,-1)),l(D)?(d(),c("div",q,[j(l(_),{message:"Fetching audit logs ..."})])):z((d(),c("ul",H,[(d(!0),c(b,null,y(l(w),e=>(d(),c("li",{key:e.uid,class:"mb-2"},[r("div",K,[i[1]||(i[1]=r("div",{class:"bg-indigo-600 rounded-full h-4 w-4 border-gray-200 border-2 z-10"},null,-1)),r("div",W,[r("span",null,u(o(e?.userUid))+" "+u(N(e?.action))+" "+u(e?.targetType),1),i[0]||(i[0]=L(" on ")),r("span",null,u(l(m)(e?.stateAfter?.updated_at)),1)])]),r("div",Z,[(d(!0),c(b,null,y(F(e),t=>(d(),c("div",{key:t.key,class:"grid grid-cols-4"},[r("span",v,[r("span",B,u(t?.key),1)]),r("span",k,[r("span",A,u(t?.old),1),i[2]||(i[2]=L(" â†’ ")),r("span",tt,u(t?.new),1)])]))),128))])]))),128))])),[[p]])])}}}),nt=I(et,[["__file","/home/aurthurm/Documents/Development/felicity/felicity-lims/webapp/components/audit/FelAuditLog.vue"]]);export{nt as default};
