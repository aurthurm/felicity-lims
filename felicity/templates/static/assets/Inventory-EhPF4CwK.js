import{Y as P,u as U,a0 as b,a7 as H,an as C,ah as V,_ as j,r as f,c as p,o as u,z as l,D as L,al as B,aG as A,a as t,M as s,I as v,K as r,A as N,C as M,F as O,H as F}from"./index-OdhKCqIc.js";import{h as Q}from"./inventory.queries-Bx-sCQu8.js";import{E as z,a as G,b as q,c as Y,d as J}from"./EmptyTitle-aCQRDpx3.js";import{S as W}from"./Spinner-Bl8RfjFA.js";const X=P({name:"InventoryView",__name:"Inventory",setup(K,{expose:e}){e();const{withClientQuery:E}=U(),o=b(!1),w=b(null),k=b([]),y=b(""),a=b(!1),x=b(!1),_=b("100"),i=H(()=>{let d=k.value;return x.value?d=d.filter(m=>m.reorderNow):a.value&&(d=d.filter(m=>m.lowStock||m.reorderNow)),d}),S=()=>{if(i.value.length===0)return;const m=[["product_name","current_stock","minimum_level","maximum_level","reorder_point","reorder_quantity","low_stock","reorder_now"].join(",")];i.value.forEach(c=>{const I=[c.productName,c.currentStock,c.minimumLevel,c.maximumLevel,c.reorderPoint,c.reorderQuantity,c.lowStock,c.reorderNow].map(D=>`"${String(D).replace(/"/g,'""')}"`);m.push(I.join(","))});const R=new Blob([m.join(`
`)],{type:"text/csv;charset=utf-8;"}),T=document.createElement("a");T.href=URL.createObjectURL(R),T.download=`inventory-kpis-${new Date().toISOString().slice(0,10)}.csv`,T.click(),URL.revokeObjectURL(T.href)},h=async()=>{o.value=!0,w.value=null;try{const d=await E(Q,{text:y.value||void 0,limit:_.value==="all"?void 0:Number(_.value)},"inventoryKpis","network-only");Array.isArray(d)?k.value=d:(k.value=[],w.value="Invalid inventory KPI data received")}catch(d){const m=d instanceof Error?d.message:"Failed to load inventory KPIs";w.value=m}finally{o.value=!1}};let g=null;C([y,_],()=>{g&&clearTimeout(g),g=setTimeout(()=>{h()},300)}),C([a,x],()=>{x.value&&(a.value=!1)}),V(()=>{h()});const n={withClientQuery:E,loading:o,error:w,kpis:k,filterText:y,showLowStock:a,showReorderNow:x,limit:_,filteredKpis:i,exportCsv:S,fetchKpis:h,get fetchTimer(){return g},set fetchTimer(d){g=d},get Empty(){return J},get EmptyContent(){return Y},get EmptyDescription(){return q},get EmptyHeader(){return G},get EmptyTitle(){return z},get Spinner(){return W}};return Object.defineProperty(n,"__isScriptSetup",{enumerable:!1,value:!0}),n}}),Z={class:"mt-4 space-y-4"},$={class:"flex flex-wrap items-center gap-3"},ee={class:"flex items-center gap-2"},te={class:"flex items-center gap-2"},oe={class:"flex items-center gap-2 text-sm text-foreground"},re={class:"flex items-center gap-2 text-sm text-foreground"},ne=["disabled"],le={key:0,class:"text-start my-4"},se={class:"inline-flex items-center gap-2"},de={key:1,class:"text-sm text-destructive"},ae={key:2,class:"border border-border bg-card rounded-lg shadow-md"},ie={class:"relative w-full overflow-auto"},ue={key:0,class:"inline-flex items-center rounded-full bg-destructive/10 text-destructive px-2 py-0.5 text-xs font-semibold"},me={key:1,class:"inline-flex items-center rounded-full bg-warning/10 text-warning px-2 py-0.5 text-xs font-semibold"},ce={key:2,class:"inline-flex items-center rounded-full bg-emerald-50 text-emerald-600 px-2 py-0.5 text-xs font-semibold"};function fe(K,e,E,o,w,k){const y=f("Checkbox"),a=f("TableHead"),x=f("TableRow"),_=f("TableHeader"),i=f("TableCell"),S=f("TableEmpty"),h=f("TableBody"),g=f("Table");return u(),p("div",Z,[l("div",$,[l("div",ee,[e[4]||(e[4]=l("label",{class:"text-sm font-medium text-foreground"},"Search",-1)),L(l("input",{"onUpdate:modelValue":e[0]||(e[0]=n=>o.filterText=n),type:"text",placeholder:"Product name",class:"px-3 py-2 border border-input bg-background text-foreground rounded-lg focus:outline-none focus:ring-2 focus:ring-ring"},null,512),[[B,o.filterText]])]),l("div",te,[e[6]||(e[6]=l("label",{class:"text-sm font-medium text-foreground"},"Limit",-1)),L(l("select",{"onUpdate:modelValue":e[1]||(e[1]=n=>o.limit=n),class:"px-3 py-2 border border-input bg-background text-foreground rounded-lg focus:outline-none focus:ring-2 focus:ring-ring"},[...e[5]||(e[5]=[l("option",{value:"50"},"50",-1),l("option",{value:"100"},"100",-1),l("option",{value:"200"},"200",-1),l("option",{value:"all"},"All",-1)])],512),[[A,o.limit]])]),l("label",oe,[t(y,{checked:o.showLowStock,"onUpdate:checked":e[2]||(e[2]=n=>o.showLowStock=n)},null,8,["checked"]),e[7]||(e[7]=s(" Low stock ",-1))]),l("label",re,[t(y,{checked:o.showReorderNow,"onUpdate:checked":e[3]||(e[3]=n=>o.showReorderNow=n)},null,8,["checked"]),e[8]||(e[8]=s(" Reorder now ",-1))]),l("button",{type:"button",class:"ml-auto px-3 py-2 text-sm font-medium rounded-lg border border-input bg-background text-foreground hover:bg-muted transition-colors focus:outline-none focus:ring-2 focus:ring-ring",disabled:o.filteredKpis.length===0,onClick:o.exportCsv}," Export CSV ",8,ne)]),o.loading?(u(),p("div",le,[l("span",se,[t(o.Spinner,{class:"size-4"}),e[9]||(e[9]=l("span",{class:"text-sm"},"Fetching inventory KPIs...",-1))])])):o.error?(u(),p("div",de,v(o.error),1)):(u(),p("div",ae,[l("div",ie,[t(g,{class:"w-full caption-bottom text-sm"},{default:r(()=>[t(_,{class:"[&_tr]:border-b"},{default:r(()=>[t(x,{class:"border-b transition-colors hover:bg-muted/50 data-[state=selected]:bg-muted"},{default:r(()=>[t(a,{class:"h-12 px-4 text-left align-middle font-medium text-muted-foreground"},{default:r(()=>[...e[10]||(e[10]=[s("Product",-1)])]),_:1}),t(a,{class:"h-12 px-4 text-right align-middle font-medium text-muted-foreground"},{default:r(()=>[...e[11]||(e[11]=[s("Current",-1)])]),_:1}),t(a,{class:"h-12 px-4 text-right align-middle font-medium text-muted-foreground"},{default:r(()=>[...e[12]||(e[12]=[s("Min",-1)])]),_:1}),t(a,{class:"h-12 px-4 text-right align-middle font-medium text-muted-foreground"},{default:r(()=>[...e[13]||(e[13]=[s("Max",-1)])]),_:1}),t(a,{class:"h-12 px-4 text-right align-middle font-medium text-muted-foreground"},{default:r(()=>[...e[14]||(e[14]=[s("Reorder Point",-1)])]),_:1}),t(a,{class:"h-12 px-4 text-right align-middle font-medium text-muted-foreground"},{default:r(()=>[...e[15]||(e[15]=[s("ROQ",-1)])]),_:1}),t(a,{class:"h-12 px-4 text-left align-middle font-medium text-muted-foreground"},{default:r(()=>[...e[16]||(e[16]=[s("Status",-1)])]),_:1})]),_:1})]),_:1}),t(h,{class:"[&_tr:last-child]:border-0"},{default:r(()=>[(u(!0),p(O,null,F(o.filteredKpis,n=>(u(),N(x,{key:n.productUid,class:"border-b transition-colors hover:bg-muted/50 data-[state=selected]:bg-muted"},{default:r(()=>[t(i,{class:"px-4 py-3 align-middle text-sm text-foreground"},{default:r(()=>[s(v(n.productName),1)]),_:2},1024),t(i,{class:"px-4 py-3 align-middle text-sm text-right text-foreground"},{default:r(()=>[s(v(n.currentStock),1)]),_:2},1024),t(i,{class:"px-4 py-3 align-middle text-sm text-right text-foreground"},{default:r(()=>[s(v(n.minimumLevel),1)]),_:2},1024),t(i,{class:"px-4 py-3 align-middle text-sm text-right text-foreground"},{default:r(()=>[s(v(n.maximumLevel),1)]),_:2},1024),t(i,{class:"px-4 py-3 align-middle text-sm text-right text-foreground"},{default:r(()=>[s(v(n.reorderPoint),1)]),_:2},1024),t(i,{class:"px-4 py-3 align-middle text-sm text-right text-foreground"},{default:r(()=>[s(v(n.reorderQuantity),1)]),_:2},1024),t(i,{class:"px-4 py-3 align-middle text-sm"},{default:r(()=>[n.reorderNow?(u(),p("span",ue," Reorder now ")):n.lowStock?(u(),p("span",me," Low stock ")):(u(),p("span",ce," OK "))]),_:2},1024)]),_:2},1024))),128)),o.filteredKpis.length===0?(u(),N(S,{key:0,colspan:7},{default:r(()=>[t(o.Empty,{class:"border-0 bg-transparent p-0"},{default:r(()=>[t(o.EmptyContent,null,{default:r(()=>[t(o.EmptyHeader,null,{default:r(()=>[t(o.EmptyTitle,null,{default:r(()=>[...e[17]||(e[17]=[s("No KPI records",-1)])]),_:1}),t(o.EmptyDescription,null,{default:r(()=>[...e[18]||(e[18]=[s("Adjust filters or check back later.",-1)])]),_:1})]),_:1})]),_:1})]),_:1})]),_:1})):M("",!0)]),_:1})]),_:1})])]))])}const ve=j(X,[["render",fe],["__file","/home/administrator/Documents/Development/beak-insights/felicity/felicity-lims/webapp/views/dashboard/Inventory.vue"]]);export{ve as default};
