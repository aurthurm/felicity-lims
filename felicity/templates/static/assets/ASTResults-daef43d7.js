import{S as ie,u as ce,f as fe,i as me,a0 as f,a7 as pe,W as be,r as Y,o as d,c,N as s,F as m,E as v,H as y,C as p,D as A,a2 as E,X as W,a3 as z,a as T,Y as ve,L as U,M,A as B,y as ye,K as ge,ae as xe,_ as he}from"./index-8d0a01b3.js";import{u as _e}from"./analysis-85b1def1.js";import{h as G,o as F,a as N}from"./constants-cc44aa7b.js";import{G as Ae,b as Ue,c as Re,d as Ce,e as we,f as Se,U as Ve}from"./microbiology.mutations-7f834d53.js";import"./analyses.mutations-56a25983.js";const Te={class:"space-y-6"},Me={class:"space-y-8"},je={class:"flex items-center justify-between"},Pe={class:"space-x-2"},De={class:"font-semibold text-foreground"},Ye={class:"text-muted-foreground"},Ee=["onClick"],Be={class:"rounded-lg border border-border bg-background"},Ge={class:"overflow-x-auto"},Fe={class:"w-full"},Ne={class:"border-b border-border bg-muted/50"},ke={class:"border-b border-border"},$e=["onUpdate:modelValue","onChange","disabled"],Ie=["value"],Le={class:"border-b border-border"},qe=["onUpdate:modelValue","onChange","disabled"],We=["value"],ze={class:"border-b border-border"},He=["onUpdate:modelValue","onChange","disabled"],Ke={class:"border-b border-border"},Qe={class:"flex items-center space-x-2"},Xe=["onUpdate:modelValue","onChange","disabled"],Je={class:"flex items-center space-x-4"},Ze=["onUpdate:modelValue","onChange","disabled"],Oe={class:"flex items-center space-x-4"},et={class:"text-lg font-semibold text-foreground"},tt={class:"italic"},st={class:"space-y-6"},ot={class:"space-y-4"},lt={class:"rounded-lg border border-border"},nt={class:"overflow-y-auto max-h-64"},ut={class:"w-full"},at={class:"px-4 py-3"},rt={class:"font-medium text-foreground"},dt={class:"text-sm text-muted-foreground"},it={class:"px-4 py-3 text-right"},ct=["onClick"],ft=ie({__name:"ASTResults",props:{sample:{type:Object,required:!0},organismAnalysisResults:{type:Object,required:!0}},setup(b){const j=ce(),{withClientMutation:k,withClientQuery:x}=fe(),H=me(()=>b.organismAnalysisResults[0]),R=f([]),C=f([]),$=f([]),I=f([]);pe(()=>{x(Ae,{analysisResultUid:H.value.uid},"abxOrganismResultAll").then(o=>{o&&(C.value=o||[])}).finally(()=>V()),S(),x(Ue,{},"abxGuidelineYearAll").then(o=>{o&&($.value=o||[])}),x(Re,{},"abxTestMethodAll").then(o=>{o&&(I.value=o||[])})});const w=f(!1),L=f(!1),P=f(""),q=f([]),h=f();function S(){x(Ce,{sampleUid:b.sample.uid},"abxAstResultAll").then(o=>{o&&(R.value=o||[])}).finally(()=>V())}function K(o){h.value=o,w.value=!0}function Q(o){const e=u.value[o.uid];return e?Object.values(e)?.every(i=>i.status=="pending"):!1}function X(){L.value=!0,x(we,{organismUid:h.value?.uid,text:P.value},"abxAstPanelFilter").then(o=>{o&&(q.value=o||[])}).finally(()=>{L.value=!1})}function J(o){w.value=!1,xe.fire({title:"Are you sure?",text:"You want to apply panel: "+o.name+" to organism: "+h.value?.organism?.name,icon:"warning",showCancelButton:!0,confirmButtonColor:"#3085d6",cancelButtonColor:"#d33",confirmButtonText:"Yes, apply now!",cancelButtonText:"No, do not apply!"}).then(async e=>{e.isConfirmed&&k(Se,{payload:{organismResultUid:h.value?.uid,panelUid:o.uid,sampleUid:b.sample.uid}},"applyAbxAstPanel").then(i=>{i?.astResults?.forEach(n=>R.value.push(n)),V()})})}const u=f({});function V(){const o={};C.value?.forEach(e=>{o[e.uid]={},(R.value?.filter(n=>n.organismResultUid===e.uid)).forEach(n=>{n.antibiotic?.name&&(o[e.uid][n.antibiotic.name+" "+n.antibiotic.potency]={uid:n.uid,analResultUid:n.analysisResultUid,status:n.analysisResult?.status,astMethodUid:n.astMethodUid,guidelineYearUid:n.guidelineYearUid,breakpointUid:n.breakpointUid,astValue:n.astValue,result:n.analysisResult?.result,reportable:n.analysisResult?.reportable,dirty:!1})})}),u.value=o}be([C,R],()=>{V()});const g=o=>Object.keys(u.value[o]||{});let{submitResults:Z,approveResults:O}=_e();function ee(o){const e=u.value[o];if(!e)return!1;const i=Object.values(e)?.some(a=>a.dirty&&a.status=="pending"),n=Object.values(e)?.some(a=>a.guidelineYearUid&&a.astMethodUid&&a.astValue);return i&&n}function te(o){const e=u.value[o];return(Object.values(e)?.filter(a=>a.dirty&&a.status=="pending")).filter(a=>a.guidelineYearUid&&a.astMethodUid&&a.astValue).map(({dirty:a,breakpointUid:t,analResultUid:l,status:r,...de})=>de)}const D=f(!1);function se(o){D.value=!0;const e=te(o);k(Ve,{payload:{results:e}},"updateAbxAstResults").then(()=>{j.fetchAnalysisResultsForSample(b.sample.uid),S()}).finally(()=>D.value=!1)}function oe(o){const e=u.value[o];if(!e)return!1;const i=Object.values(e)?.some(a=>a.dirty),n=Object.values(e)?.some(a=>a.guidelineYearUid&&a.astMethodUid&&a.astValue&&a.result&&a.status=="pending");return!i&&n&&b.sample.status!="submitting"}function le(o){const e=u.value[o];return(Object.values(e)?.filter(a=>!a.dirty)).filter(a=>a.guidelineYearUid&&a.astMethodUid&&a.astValue&&a.result&&a.status=="pending").map(({dirty:a,breakpointUid:t,...l})=>l)}function ne(o){const i=le(o).map(n=>({uid:n.analResultUid,result:n.result,reportable:n.reportable,methodUid:"felicity_ast",laboratoryInstrumentUid:"felicity_ast"}));Z(i,"sample",b.sample?.uid).then(()=>{j.fetchAnalysisResultsForSample(b.sample.uid),S()})}function ue(o){const e=u.value[o];if(!e)return!1;const i=Object.values(e)?.some(a=>a.dirty),n=Object.values(e)?.some(a=>a.status=="resulted");return!i&&n&&b.sample.status!="approving"}function ae(o){const e=u.value[o];return(Object.values(e)?.filter(n=>!n.dirty)).filter(n=>n.status=="resulted")}function re(o){const i=ae(o).map(n=>n.analResultUid);O(i,"sample",b.sample?.uid).then(()=>{j.fetchAnalysisResultsForSample(b.sample.uid),S()})}async function _(o,e,i,n){u.value[o][e],u.value[o][e].dirty=!0,u.value[o][e]={...u.value[o][e],[i]:n}}return(o,e)=>{const i=Y("font-awesome-icon"),n=Y("fel-button"),a=Y("fel-modal");return d(),c(m,null,[s("div",Te,[e[12]||(e[12]=s("div",{class:"flex items-center justify-between border-b border-border pb-4"},[s("h3",{class:"text-lg font-semibold text-foreground"},"AST Panel")],-1)),s("div",Me,[(d(!0),c(m,null,v(C.value,t=>(d(),c("div",{key:t.uid,class:"space-y-6"},[s("div",je,[s("div",Pe,[s("span",De,"Organism #"+y(t?.isolateNumber),1),s("span",Ye,y(t?.organism?.name),1)]),p(s("button",{onClick:l=>K(t),class:"inline-flex items-center justify-center rounded-md text-sm font-medium ring-offset-background transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 border border-input bg-background hover:bg-accent hover:text-accent-foreground h-9 px-4 py-2"}," Choose Panel ",8,Ee),[[A,Q(t)]])]),s("div",Be,[s("div",Ge,[s("table",Fe,[s("thead",null,[s("tr",Ne,[e[2]||(e[2]=s("th",{class:"px-4 py-3 text-left text-sm font-medium text-muted-foreground"},"Parameter",-1)),(d(!0),c(m,null,v(g(t.uid),l=>(d(),c("th",{key:l,class:"px-4 py-3 text-left text-sm font-medium text-muted-foreground"},y(l),1))),128))])]),s("tbody",null,[s("tr",ke,[e[3]||(e[3]=s("td",{class:"px-4 py-3 text-sm font-medium text-foreground"},"Guideline",-1)),(d(!0),c(m,null,v(g(t.uid),l=>(d(),c("td",{key:l,class:"px-4 py-3"},[p(s("select",{"onUpdate:modelValue":r=>u.value[t.uid][l].guidelineYearUid=r,onChange:r=>_(t.uid,l,"guidelineYearUid",r.target.value),class:"w-full rounded-md border border-input bg-background px-3 py-2 text-sm ring-offset-background focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50",disabled:u.value[t.uid][l].status!=="pending"},[(d(!0),c(m,null,v($.value,r=>(d(),c("option",{key:r.uid,value:r.uid},y(r.code),9,Ie))),128))],40,$e),[[E,u.value[t.uid][l].guidelineYearUid]])]))),128))]),s("tr",Le,[e[4]||(e[4]=s("td",{class:"px-4 py-3 text-sm font-medium text-foreground"},"AST Method",-1)),(d(!0),c(m,null,v(g(t.uid),l=>(d(),c("td",{key:l,class:"px-4 py-3"},[p(s("select",{"onUpdate:modelValue":r=>u.value[t.uid][l].astMethodUid=r,onChange:r=>_(t.uid,l,"astMethodUid",r.target.value),class:"w-full rounded-md border border-input bg-background px-3 py-2 text-sm ring-offset-background focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50",disabled:u.value[t.uid][l].status!=="pending"},[(d(!0),c(m,null,v(I.value,r=>(d(),c("option",{key:r.uid,value:r.uid},y(r.name),9,We))),128))],40,qe),[[E,u.value[t.uid][l].astMethodUid]])]))),128))]),s("tr",ze,[e[5]||(e[5]=s("td",{class:"px-4 py-3 text-sm font-medium text-foreground"},"AST Value",-1)),(d(!0),c(m,null,v(g(t.uid),l=>(d(),c("td",{key:l,class:"px-4 py-3"},[p(s("input",{type:"number","onUpdate:modelValue":r=>u.value[t.uid][l].astValue=r,onChange:r=>_(t.uid,l,"astValue",r.target.value),class:"w-full rounded-md border border-input bg-background px-3 py-2 text-sm ring-offset-background focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50",step:"0.1",disabled:u.value[t.uid][l].status!=="pending"},null,40,He),[[W,u.value[t.uid][l].astValue]])]))),128))]),s("tr",Ke,[e[7]||(e[7]=s("td",{class:"px-4 py-3 text-sm font-medium text-foreground"},"Result",-1)),(d(!0),c(m,null,v(g(t.uid),l=>(d(),c("td",{key:l,class:"px-4 py-3"},[s("div",Qe,[p(s("select",{"onUpdate:modelValue":r=>u.value[t.uid][l].result=r,onChange:r=>_(t.uid,l,"result",r.target.value),class:z(["w-full rounded-md border border-input bg-background px-3 py-2 text-sm ring-offset-background focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50",{"text-success":u.value[t.uid][l].result?.toUpperCase()==="S","text-warning":u.value[t.uid][l].result?.toUpperCase()==="I","text-destructive":u.value[t.uid][l].result?.toUpperCase()==="R"}]),disabled:u.value[t.uid][l].status!=="pending"},[...e[6]||(e[6]=[s("option",{value:"S"},"S",-1),s("option",{value:"I"},"I",-1),s("option",{value:"R"},"R",-1)])],42,Xe),[[E,u.value[t.uid][l].result]]),p(s("span",null,[T(i,{icon:"robot",class:"text-muted-foreground","aria-label":"Auto-calculated"})],512),[[A,u.value[t.uid][l].breakpointUid]])])]))),128))]),s("tr",null,[e[8]||(e[8]=s("td",{class:"px-4 py-3 text-sm font-medium text-foreground"},"Reportable",-1)),(d(!0),c(m,null,v(g(t.uid),l=>(d(),c("td",{key:l,class:"px-4 py-3"},[s("div",Je,[p(s("input",{type:"checkbox","onUpdate:modelValue":r=>u.value[t.uid][l].reportable=r,onChange:r=>_(t.uid,l,"reportable",r.target.checked),class:"rounded border-input text-primary focus:ring-primary disabled:cursor-not-allowed disabled:opacity-50",disabled:u.value[t.uid][l].status!=="pending"},null,40,Ze),[[ve,u.value[t.uid][l].reportable]]),s("span",{class:z(["inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium",{"bg-primary/10 text-primary":u.value[t.uid][l].status==="pending","bg-warning/10 text-warning":u.value[t.uid][l].status==="resulted","bg-success/10 text-success":u.value[t.uid][l].status==="approved","bg-destructive/10 text-destructive":u.value[t.uid][l].status==="cancelled"}])},y(u.value[t.uid][l].status),3)])]))),128))])])])])]),s("div",Oe,[p(T(n,{key:"save",onClick:B(l=>se(t.uid),["prevent"]),color:"primary",disabled:D.value},{default:U(()=>[...e[9]||(e[9]=[M(" Save Antibiotics ")])]),_:2},1032,["onClick","disabled"]),[[A,G(N.UPDATE,F.RESULT)&&ee(t.uid)]]),p(T(n,{key:"submit",onClick:B(l=>ne(t.uid),["prevent"]),color:"warning"},{default:U(()=>[...e[10]||(e[10]=[M(" Submit Antibiotics ")])]),_:2},1032,["onClick"]),[[A,G(N.UPDATE,F.RESULT)&&oe(t.uid)]]),p(T(n,{key:"approve",onClick:B(l=>re(t.uid),["prevent"]),color:"success"},{default:U(()=>[...e[11]||(e[11]=[M(" Approve Antibiotics ")])]),_:2},1032,["onClick"]),[[A,G(N.UPDATE,F.RESULT)&&ue(t.uid)]])])]))),128))])]),w.value?(d(),ye(a,{key:0,onClose:e[1]||(e[1]=t=>w.value=!1),contentWidth:"w-1/2"},{header:U(()=>[s("h3",et,[e[13]||(e[13]=M(" Search Panel for ")),s("span",tt,y(h.value?.organism?.name),1)])]),body:U(()=>[s("div",st,[s("div",ot,[p(s("input",{"onUpdate:modelValue":e[0]||(e[0]=t=>P.value=t),onInput:X,class:"w-full rounded-md border border-input bg-background px-3 py-2 text-sm ring-offset-background focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2",placeholder:"Begin typing..."},null,544),[[W,P.value]]),s("div",lt,[s("div",nt,[s("table",ut,[s("tbody",null,[(d(!0),c(m,null,v(q.value,t=>(d(),c("tr",{key:t.uid,class:"border-b border-border hover:bg-muted/50 transition-colors duration-200"},[s("td",at,[s("div",rt,y(t.name),1),s("div",dt,y(t.antibiotics?.map(l=>l.name)?.join(", ")),1)]),s("td",it,[s("button",{onClick:l=>J(t),class:"inline-flex items-center justify-center rounded-md text-sm font-medium ring-offset-background transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 bg-primary text-primary-foreground hover:bg-primary/90 h-9 px-4 py-2"}," Apply ",8,ct)])]))),128))])])])])])])]),_:1})):ge("",!0)],64)}}}),gt=he(ft,[["__file","/Users/admin/Documents/Development/felicity/felicity-lims/webapp/views/sample/_id/results/ASTResults.vue"]]);export{gt as default};
