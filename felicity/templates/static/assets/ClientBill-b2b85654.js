import{V as _e,f as xe,aj as he,a1 as c,a2 as K,r as P,al as $,o as a,c as d,O as e,D as u,a6 as l,a as C,F as k,H as U,a4 as p,J as i,E,C as v,N as F,M as f,L as g,z as L,ae as R,a3 as Ce,Y as M,$ as ke,a0 as we,k as Te,_ as Be}from"./index-0a787601.js";import{u as Ve,A as Ae,G as Ue,C as Fe,d as Me}from"./billing-c74a3929.js";import{p as Ne}from"./index-b3a36a14.js";import{u as Se}from"./bills-bb724f89.js";import{c as je,a as q,b as De,u as Ie,e as O}from"./array-b823a927.js";const Pe={class:"space-y-6"},$e={class:"grid grid-cols-12 gap-6"},Ee={initial:{opacity:0,y:100},enter:{opacity:1,y:0,scale:1},variants:{custom:{scale:2}},delay:400,class:"col-span-3 overflow-y-auto overscroll-contain billing-scroll"},Le={key:0,class:"py-4 text-center bg-background w-full mb-2 rounded-lg shadow-sm border border-border"},Re={key:1},qe={class:"space-y-2"},Oe=["onClick"],Ye={class:"space-y-1"},We={class:"font-semibold text-foreground"},ze={class:"text-sm text-muted-foreground"},Ge={initial:{opacity:0,y:-100},enter:{opacity:1,y:0,scale:1},variants:{custom:{scale:2}},delay:400,class:"col-span-9 space-y-6"},He={class:"bg-background rounded-lg shadow-sm p-6 space-y-4"},Ke={class:"flex justify-between items-center"},Je={class:"text-lg font-semibold text-foreground"},Qe={class:"grid grid-cols-3 gap-8"},Xe={class:"space-y-4"},Ze={class:"flex justify-between items-center"},es={class:"text-sm text-foreground"},ss={class:"flex justify-between items-center"},ts={class:"text-sm text-foreground"},os={class:"space-y-4"},ns={class:"flex justify-between items-center"},as={class:"text-sm text-foreground"},ls={class:"flex justify-between items-center"},is={class:"text-sm text-foreground"},rs={class:"space-y-4"},ds={class:"flex justify-between items-center"},us={class:"text-sm text-foreground"},cs={class:"space-y-4"},fs={class:"flex justify-between items-center"},ms={class:"bg-background rounded-lg shadow-sm p-6 space-y-4"},ps={class:"font-semibold text-foreground"},vs={class:"text-muted-foreground"},gs={class:"ml-2 text-primary"},bs={class:"space-y-4"},ys={class:"flex justify-between items-center"},_s={class:"space-x-4"},xs={class:"bg-background rounded-lg shadow-sm p-6"},hs={class:"space-y-6 p-6"},Cs={class:"grid grid-cols-2 gap-6"},ks={class:"space-y-2"},ws=["disabled"],Ts=["value"],Bs={class:"text-sm text-destructive"},Vs={class:"space-y-2"},As=["disabled"],Us={class:"space-y-2"},Fs=["disabled"],Ms={class:"flex justify-end"},Ns={class:"space-y-6 p-6"},Ss={class:"text-lg font-medium text-foreground"},js={class:"space-y-2"},Ds=["disabled"],Is={class:"flex justify-end"},Ps={class:"space-y-6 p-6"},$s={class:"space-y-2"},Es=["disabled"],Ls={class:"flex justify-end"},Rs=_e({__name:"ClientBill",props:{clientUid:String},setup(J){const Q=ke(()=>we(()=>import("./FelDataTable-ff278bf5.js"),["assets/FelDataTable-ff278bf5.js","assets/index-0a787601.js","assets/index-8412b2a5.css"])),Y=J,{toastSuccess:W}=Te(),{withClientMutation:N,withClientQuery:X}=xe(),b=Ve(),{bills:z,fetchingBills:Z,transactions:ee,fetchingTransactions:se}=he(b);b.fetchBillsForClient(Y?.clientUid);const te=c(["cash","medical-aid","e-payment"]),w=c(!1),n=c({}),oe=o=>{n.value={...o},b.fetchBillTransactions(o.uid),ne(o.uid)},G=c([]),ne=async o=>{const s=await X(Ue,{uid:o},"ordersByBillUid");G.value=s??[]};function ae(o,s){let x=[];return o.forEach(m=>x.push(m.name)),s.forEach(m=>x.push(m.name)),x.join(", ")}const le=je({testBillUid:q().required(),kind:q().required(),amount:De().required(),notes:q()}),{handleSubmit:ie,errors:y,setFieldValue:T}=Ie({validationSchema:le,initialValues:{testBillUid:n.value?.uid}}),{value:B}=O("kind"),{value:S}=O("amount"),{value:j}=O("notes"),r=c(!1),re=ie(o=>{r.value=!0,ue(o)}),de=()=>{T("testBillUid",n.value?.uid),T("kind","cash"),T("amount",Math.ceil(Number((n?.value?.totalCharged-n?.value?.totalPaid).toFixed(2)))),T("notes",""),w.value=!0},ue=o=>{N(Ae,{payload:o},"createTestBillTransaction").then(s=>{b.addTransaction(s),r.value=!1,w.value=!1,W("Transaction added.")})},V=c(!1),_=c({}),ce=()=>{r.value=!0,N(Fe,{uid:_.value.uid,notes:_.value.notes},"confirmTestBillTransaction").then(o=>{b.updateTransaction(o),r.value=!1,V.value=!1,W("Transaction confirmed.")})},fe=c([{name:"Kind",value:"kind",sortable:!0,sortBy:"asc",defaultSort:!0,showInToggler:!1,hidden:!1},{name:"Amount",value:"amount",sortable:!1,sortBy:"asc",hidden:!1},{name:"Success",value:"isSuccess",sortable:!1,sortBy:"asc",hidden:!1},{name:"Notes",value:"notes",sortable:!1,sortBy:"asc",hidden:!1},{name:"Message",value:"message",sortable:!1,sortBy:"asc",hidden:!1},{name:"Processed",value:"processed",sortable:!1,sortBy:"asc",hidden:!1,customRender:function(o,s){return K("span",{innerHTML:o.processed?"Yes":"Pending confirmation"},[])}},{name:"Action",sortable:!1,hidden:!1,customRender:(o,s)=>{if(!o.processed)return K("button",{onClick(){V.value=!0,_.value=o},type:"button",class:"bg-primary text-primary-foreground py-1 px-2 rounded-sm leading-none"},"confirm")}}]),D=c(!1),A=c({code:""}),me=()=>{D.value=!0},pe=()=>{r.value=!0,N(Me,{payload:{voucherCode:A.value?.code,testBillUid:n.value?.uid,customerUid:Y.clientUid}},"applyVoucher").then(o=>r.value=!1)},{downloadInvoice:ve}=Se(),ge=async o=>await ve(o.uid);return(o,s)=>{const x=P("fel-loader"),m=P("fel-button"),I=P("fel-modal"),H=$("motion"),be=$("motion-slide-top"),ye=$("motion-slide-right");return a(),d(k,null,[e("div",Pe,[e("div",$e,[u((a(),d("section",Ee,[l(Z)?(a(),d("div",Le,[C(x,{message:"Fetching bills ..."})])):(a(),d("div",Re,[e("ul",qe,[(a(!0),d(k,null,U(l(z),t=>(a(),d("li",{key:t.uid,class:p(["bg-background w-full p-3 rounded-lg shadow-sm border border-border transition-all duration-200 hover:shadow-md",{"border-primary bg-primary/5":t.uid===n.value.uid}]),onClick:h=>oe(t)},[e("div",Ye,[e("div",We," Bill "+i(t.billId?.toLocaleUpperCase()),1),e("div",ze,i(l(Ne)(t.createdAt)),1)])],10,Oe))),128))])]))])),[[H]]),u((a(),d("section",Ge,[u((a(),d("div",He,[e("div",Ke,[e("h4",Je,i(n.value.billId?.toLocaleUpperCase()),1)]),e("div",Qe,[e("div",Xe,[e("div",Ze,[s[9]||(s[9]=e("span",{class:"text-sm font-medium text-foreground"},"Active:",-1)),e("span",es,i(n.value.isActive?"Yes":"No"),1)]),e("div",ss,[s[10]||(s[10]=e("span",{class:"text-sm font-medium text-foreground"},"Confirmed:",-1)),e("span",ts,i(n.value?.toConfirm?"No":"Yes"),1)])]),e("div",os,[e("div",ns,[s[11]||(s[11]=e("span",{class:"text-sm font-medium text-foreground"},"Total Charged:",-1)),e("span",as,i(n.value?.totalCharged),1)]),e("div",ls,[s[12]||(s[12]=e("span",{class:"text-sm font-medium text-foreground"},"Total Paid:",-1)),e("span",is,i(n.value?.totalPaid),1)])]),e("div",rs,[e("div",ds,[s[13]||(s[13]=e("span",{class:"text-sm font-medium text-foreground"},"Partial:",-1)),e("span",us,i(n.value?.totalPaid<n.value?.totalCharged?"Yes":"No"),1)])])])])),[[be]]),e("div",cs,[e("div",fs,[s[14]||(s[14]=e("h4",{class:"text-lg font-semibold text-foreground"},"Order Items",-1)),e("button",{class:"px-4 py-2 bg-primary text-primary-foreground rounded-md hover:bg-primary/90 transition-colors duration-200 focus:outline-none focus:ring-2 focus:ring-primary/50",onClick:s[0]||(s[0]=v(t=>ge(n.value),["prevent"]))}," Invoice ")]),e("ul",ms,[(a(!0),d(k,null,U(G.value,t=>(a(),d("li",{class:"space-y-2",key:t.uid},[e("div",ps,i(t?.requestId)+" ("+i(t?.clientRequestId)+")",1),(a(!0),d(k,null,U(t.samples,h=>u((a(),d("div",{class:"space-y-1 pl-4",key:h.uid},[e("span",vs,i(h.sampleId),1),s[15]||(s[15]=F(" â‡’ ")),e("span",gs,i(ae(h.profiles??[],h.analyses??[])),1)])),[[ye]])),128))]))),128))])]),e("div",bs,[e("div",ys,[s[16]||(s[16]=e("h4",{class:"text-lg font-semibold text-foreground"},"Transactions",-1)),e("div",_s,[u(e("button",{class:"px-4 py-2 bg-primary text-primary-foreground rounded-md hover:bg-primary/90 transition-colors duration-200 focus:outline-none focus:ring-2 focus:ring-primary/50",onClick:v(de,["prevent"])}," Add Transaction ",512),[[E,n.value.isActive]]),u(e("button",{class:"px-4 py-2 bg-primary text-primary-foreground rounded-md hover:bg-primary/90 transition-colors duration-200 focus:outline-none focus:ring-2 focus:ring-primary/50",onClick:v(me,["prevent"])}," Apply Voucher ",512),[[E,n.value.isActive]])])]),e("div",xs,[C(l(Q),{columns:fe.value,data:l(ee),toggleColumns:!1,loading:l(se),paginable:!1,searchable:!1,filterable:!1,selectable:!1},{footer:f(()=>s[17]||(s[17]=[])),_:1},8,["columns","data","loading"])])])])),[[E,l(z)?.length>0&&n.value.uid],[H]])])]),g(" New Transaction Form Modal "),w.value?(a(),L(I,{key:0,onClose:s[4]||(s[4]=t=>w.value=!1),contentWidth:"w-3/6",class:"bg-background"},{header:f(()=>s[18]||(s[18]=[e("h3",{class:"text-xl font-semibold text-foreground"},"Transaction Form",-1)])),body:f(()=>[e("form",hs,[e("div",Cs,[e("label",ks,[s[20]||(s[20]=e("span",{class:"text-sm font-medium text-foreground"},"Kind of payment",-1)),u(e("select",{class:p(["w-full rounded-md border border-input bg-background px-3 py-2 text-sm ring-offset-background focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2",{"border-destructive":l(y).kind}]),"onUpdate:modelValue":s[1]||(s[1]=t=>R(B)?B.value=t:null),disabled:r.value},[s[19]||(s[19]=e("option",null,null,-1)),(a(!0),d(k,null,U(te.value,t=>(a(),d("option",{key:t,value:t},i(t),9,Ts))),128))],10,ws),[[Ce,l(B)]]),e("div",Bs,i(l(y).gender),1)]),e("label",Vs,[s[21]||(s[21]=e("span",{class:"text-sm font-medium text-foreground"},"Amount",-1)),u(e("input",{class:p(["w-full rounded-md border border-input bg-background px-3 py-2 text-sm ring-offset-background focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2",{"border-destructive":l(y).amount}]),type:"number","onUpdate:modelValue":s[2]||(s[2]=t=>R(S)?S.value=t:null),disabled:r.value},null,10,As),[[M,l(S)]])])]),e("label",Us,[s[22]||(s[22]=e("span",{class:"text-sm font-medium text-foreground"},"Notes",-1)),u(e("input",{class:p(["w-full rounded-md border border-input bg-background px-3 py-2 text-sm ring-offset-background focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2",{"border-destructive":l(y).notes}]),"onUpdate:modelValue":s[3]||(s[3]=t=>R(j)?j.value=t:null),disabled:r.value},null,10,Fs),[[M,l(j)]])]),e("div",Ms,[C(m,{color:"primary",type:"submit",loading:r.value,onClick:v(l(re),["prevent"])},{default:f(()=>s[23]||(s[23]=[F(" Save Transaction ")])),_:1},8,["loading","onClick"])])])]),_:1})):g("v-if",!0),g(" Confirm Transaction Form Modal "),V.value?(a(),L(I,{key:1,onClose:s[6]||(s[6]=t=>V.value=!1),contentWidth:"w-3/6",class:"bg-background"},{header:f(()=>s[24]||(s[24]=[e("h3",{class:"text-xl font-semibold text-foreground"},"Confirm Transaction",-1)])),body:f(()=>[e("form",Ns,[e("h4",Ss,i(l(B))+" Transaction",1),e("label",js,[s[25]||(s[25]=e("span",{class:"text-sm font-medium text-foreground"},"Notes",-1)),u(e("input",{class:p(["w-full rounded-md border border-input bg-background px-3 py-2 text-sm ring-offset-background focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2",{"border-destructive":l(y).notes}]),"onUpdate:modelValue":s[5]||(s[5]=t=>_.value.notes=t),disabled:r.value},null,10,Ds),[[M,_.value.notes]])]),e("div",Is,[C(m,{color:"primary",type:"submit",loading:r.value,onClick:v(ce,["prevent"])},{default:f(()=>s[26]||(s[26]=[F(" Confirm Transaction ")])),_:1},8,["loading"])])])]),_:1})):g("v-if",!0),g(" Voucher Code Form Modal "),D.value?(a(),L(I,{key:2,onClose:s[8]||(s[8]=t=>D.value=!1),contentWidth:"w-1/5",class:"bg-background"},{header:f(()=>s[27]||(s[27]=[e("h3",{class:"text-xl font-semibold text-foreground"},"Apply Voucher Code",-1)])),body:f(()=>[e("form",Ps,[e("label",$s,[s[28]||(s[28]=e("span",{class:"text-sm font-medium text-foreground"},"Voucher Code",-1)),u(e("input",{class:p(["w-full rounded-md border border-input bg-background px-3 py-2 text-sm ring-offset-background focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2",{"border-destructive":!A.value.code}]),type:"text","onUpdate:modelValue":s[7]||(s[7]=t=>A.value.code=t),disabled:r.value},null,10,Es),[[M,A.value.code]])]),e("div",Ls,[C(m,{color:"primary",type:"submit",loading:r.value,onClick:v(pe,["prevent"])},{default:f(()=>s[29]||(s[29]=[F(" Apply Voucher ")])),_:1},8,["loading"])])])]),_:1})):g("v-if",!0)],64)}}});const Gs=Be(Rs,[["__scopeId","data-v-5aba8362"],["__file","/home/aurthurm/Documents/Development/felicity/felicity-lims/webapp/views/client/_id/ClientBill.vue"]]);export{Gs as default};
