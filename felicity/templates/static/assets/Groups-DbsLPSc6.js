import{Y as K,ai as l,u as q,a7 as w,a0 as T,av as z,aW as W,aX as j,aY as Q,a3 as X,_ as J,r as c,c as B,o as A,z as d,A as P,C as Z,a as o,K as s,M as u,F as L,H as $,I as M,B as ee,a4 as O}from"./index-OdhKCqIc.js";import{c as te,e as oe,a as R,u as se,F as re}from"./index.esm-BfHj8iGm.js";import{u as ae}from"./user-DYsgscqA.js";import{I as ne}from"./Input-BEm5S0CJ.js";import{M as le}from"./MultiSelect-BOJClHm8.js";import{F as ie,a as ue,b as de}from"./FormMessage-CgXFMXx9.js";import{F as me}from"./FormLabel-DxP9wnWS.js";import"./PopoverTrigger-Cf8QcqoV.js";import"./useFocusGuards-Bjb6OG0k.js";import"./PopperContent-BfyCnGUj.js";import"./index-Dj97WNKd.js";import"./Label-CS46LzLb.js";const pe=K({name:"GroupsView",__name:"Groups",setup(D,{expose:t}){t();const x=[l.ADMINISTRATION,l.DASHBOARD,l.CLIENTS,l.PATIENTS,l.PATIENTS_COMPACT,l.SAMPLES,l.QC_SAMPLES,l.WORKSHEETS,l.NOTICE_MANAGER,l.BIO_BANKING,l.INVENTORY,l.REFERRAL,l.SCHEMES,l.DOCUMENT,l.BILLING];let e=ae();const{withClientMutation:v}=q();e.fetchGroupsAndPermissions();const y=w(()=>e.getGroups);let g=T("permissions");const S=["permissions"];let _=T(!1),m=T("");const b=T(!0);let F=z({});const p=T(null),n=te({name:R().trim().required("Group name is required"),pages:oe().of(R()).nullable()}),{handleSubmit:G,resetForm:E,setValues:C}=se({validationSchema:n,initialValues:{name:"",pages:[]}});function k(r){const a=r.pages;Object.assign(F,{...r,pages:a?.split(",")||[]}),I.value?.forEach(i=>{i[1].forEach(f=>{f.checked=!1,F.permissions?.some(Y=>Y?.uid==f?.uid||!1)&&(f.checked=!0)})})}function H(r,a={}){b.value=r,_.value=!0,m.value=(r?"CREATE":"EDIT")+" ANALYSES PROFILE",r?(p.value=null,E({values:{name:"",pages:[]}})):(p.value=a.uid??null,C({name:a.name??"",pages:typeof a.pages=="string"?a.pages.split(",").filter(Boolean):Array.isArray(a.pages)?a.pages:[]}))}const V=G(r=>{const a={name:r.name,pages:(r.pages??[]).join(",")};if(b.value===!0&&v(W,{payload:a},"createGroup").then(i=>e.addGroup(i)),b.value===!1){if(!p.value)return;v(j,{uid:p.value,payload:{name:a.name,pages:a.pages}},"updateGroup").then(i=>e.updateGroup(i))}_.value=!1}),h=(r,a)=>r?.reduce(function(i,f){return(i[f[a]]=i[f[a]]||[]).push(f),i},{}),I=w(()=>Array.from(Object.entries(h(e.getPermissions,"target"))));function U(r,a){v(Q,{groupUid:r?.uid,permissionUid:a?.uid},"updateGroupPermissions").then(i=>e.updateGroupsAndPermissions(i))}const N={pages:x,get userStore(){return e},set userStore(r){e=r},withClientMutation:v,groups:y,get currentTab(){return g},set currentTab(r){g=r},tabs:S,get showModal(){return _},set showModal(r){_=r},get formTitle(){return m},set formTitle(r){m=r},formAction:b,get userGroup(){return F},set userGroup(r){F=r},currentUid:p,groupSchema:n,handleSubmit:G,resetForm:E,setValues:C,selectGroup:k,FormManager:H,saveForm:V,groupBy:h,permissions:I,updateGroupPerms:U,get Button(){return X},get Input(){return ne},get MultiSelect(){return le},get FormControl(){return de},get FormField(){return re},get FormItem(){return ue},get FormLabel(){return me},get FormMessage(){return ie}};return Object.defineProperty(N,"__isScriptSetup",{enumerable:!1,value:!0}),N}}),fe={class:"space-y-6"},ce={class:"flex items-center justify-between"},ge={class:"border border-border bg-card rounded-lg shadow-md"},_e={class:"relative w-full overflow-auto"},be={class:"text-lg font-semibold text-foreground"},Fe={class:"space-y-4"},ve={class:"flex justify-end"};function Te(D,t,x,e,v,y){const g=c("TableHead"),S=c("TableRow"),_=c("TableHeader"),m=c("TableCell"),b=c("TableBody"),F=c("Table"),p=c("Modal");return A(),B(L,null,[d("div",fe,[d("div",ce,[t[4]||(t[4]=d("h2",{class:"text-2xl font-semibold text-foreground"},"Groups",-1)),o(e.Button,{onClick:t[0]||(t[0]=n=>e.FormManager(!0))},{default:s(()=>[...t[3]||(t[3]=[u(" Add Group ",-1)])]),_:1})]),d("div",ge,[d("div",_e,[o(F,{class:"w-full caption-bottom text-sm"},{default:s(()=>[o(_,{class:"[&_tr]:border-b"},{default:s(()=>[o(S,{class:"border-b transition-colors hover:bg-muted/50 data-[state=selected]:bg-muted"},{default:s(()=>[o(g,{class:"h-12 px-4 text-left align-middle font-medium text-muted-foreground"},{default:s(()=>[...t[5]||(t[5]=[u("Group Name",-1)])]),_:1}),o(g,{class:"h-12 px-4 text-left align-middle font-medium text-muted-foreground"},{default:s(()=>[...t[6]||(t[6]=[u("Access Pages",-1)])]),_:1}),o(g,{class:"h-12 px-4 text-right align-middle font-medium text-muted-foreground"},{default:s(()=>[...t[7]||(t[7]=[u("Actions",-1)])]),_:1})]),_:1})]),_:1}),o(b,{class:"[&_tr:last-child]:border-0"},{default:s(()=>[(A(!0),B(L,null,$(e.groups,n=>(A(),P(S,{key:n.uid,class:"border-b transition-colors hover:bg-muted/50 data-[state=selected]:bg-muted"},{default:s(()=>[o(m,{class:"px-4 py-2 align-middle"},{default:s(()=>[u(M(n.name),1)]),_:2},1024),o(m,{class:"px-4 py-2 align-middle text-primary"},{default:s(()=>[u(M(n.pages),1)]),_:2},1024),o(m,{class:"px-4 py-2 align-middle text-right"},{default:s(()=>[o(e.Button,{variant:"outline",size:"sm",onClick:G=>e.FormManager(!1,n)},{default:s(()=>[...t[8]||(t[8]=[u(" Edit ",-1)])]),_:1},8,["onClick"])]),_:2},1024)]),_:2},1024))),128))]),_:1})]),_:1})])])]),e.showModal?(A(),P(p,{key:0,onClose:t[2]||(t[2]=n=>e.showModal=!1)},{header:s(()=>[d("h3",be,M(e.formTitle),1)]),body:s(()=>[d("form",{onSubmit:t[1]||(t[1]=ee((...n)=>e.saveForm&&e.saveForm(...n),["prevent"])),class:"space-y-4"},[d("div",Fe,[o(e.FormField,{name:"name"},{default:s(({componentField:n})=>[o(e.FormItem,null,{default:s(()=>[o(e.FormLabel,null,{default:s(()=>[...t[9]||(t[9]=[u("Group Name",-1)])]),_:1}),o(e.FormControl,null,{default:s(()=>[o(e.Input,O(n,{placeholder:"Enter group name..."}),null,16)]),_:2},1024),o(e.FormMessage)]),_:2},1024)]),_:1}),o(e.FormField,{name:"pages"},{default:s(({componentField:n})=>[o(e.FormItem,null,{default:s(()=>[o(e.FormLabel,null,{default:s(()=>[...t[10]||(t[10]=[u("Pages",-1)])]),_:1}),o(e.FormControl,null,{default:s(()=>[o(e.MultiSelect,O(n,{options:e.pages,placeholder:"Select pages...","search-placeholder":"Search pages...","empty-message":"No pages found."}),null,16)]),_:2},1024),o(e.FormMessage)]),_:2},1024)]),_:1})]),d("div",ve,[o(e.Button,{type:"submit"},{default:s(()=>[...t[11]||(t[11]=[u("Save Changes",-1)])]),_:1})])],32)]),_:1})):Z("",!0)],64)}const Be=J(pe,[["render",Te],["__file","/home/administrator/Documents/Development/beak-insights/felicity/felicity-lims/webapp/views/admin/users/Groups.vue"]]);export{Be as default};
