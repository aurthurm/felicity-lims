const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/vue-multiselect.esm-C31Sh9AO.js","assets/index-Daoe3XS9.js","assets/index-C7Rn7ES8.css"])))=>i.map(i=>d[i]);
import{a0 as L,u as Q,f as z,h as U,a7 as C,g as J,a5 as K,i as G,a1 as H,a6 as W,_ as X,r as Y,C as Z,E as _,o as d,N as q,A as s,c as n,Q as w,J as M,K as h,L as g,F as y,a2 as D,a9 as j,a3 as F,a as T,P as $}from"./index-Daoe3XS9.js";import{u as ee}from"./analysis-D7-3mDtD.js";import{_ as le}from"./analyses.mutations-DmiK7cfK.js";const se=L({__name:"DeriveSamplesModal",props:{show:{type:Boolean,required:!0},samples:{type:Array,required:!0}},emits:["close","derived"],setup(P,{expose:e,emit:V}){e();const t=H(()=>W(()=>import("./vue-multiselect.esm-C31Sh9AO.js"),__vite__mapDeps([0,1,2]))),v=P,S=V,b=Q(),l=ee(),{withClientMutation:a}=z(),{toastSuccess:A,toastError:m}=G(),N=U(()=>b.getSampleTypes||[]),E=U(()=>l.getAnalysesServicesSimple||[]),R=U(()=>l.getAnalysesProfiles||[]),f=C("aliquot"),c=C([]),i=J({parents:[],sampleTypeUid:null,overrideTests:!1,profiles:[],analyses:[],notes:""}),k=C(!1),B=U(()=>c.value.length>1),I=()=>{c.value=v.samples.map(p=>({sample:p,quantity:1,sampleTypeUid:p.sampleType?.uid??null,overrideTests:!1,profiles:[],analyses:[],notes:""})),i.parents=[...v.samples],i.sampleTypeUid=v.samples[0]?.sampleType?.uid??null,i.overrideTests=!1,i.profiles=[],i.analyses=[],i.notes="",!B.value&&f.value==="pool"&&(f.value="aliquot")};K(()=>v.show,async p=>{p&&(N.value.length||await b.fetchSampleTypes(),(!R.value.length||!E.value.length)&&await l.fetchAnalysesProfilesAndServices(),I())});const O={VueMultiselect:t,props:v,emit:S,sampleStore:b,analysisStore:l,withClientMutation:a,toastSuccess:A,toastError:m,sampleTypes:N,analysesServices:E,analysesProfiles:R,deriveMode:f,deriveConfigs:c,poolConfig:i,deriveSaving:k,canPool:B,initConfig:I,submitDeriveRequest:async()=>{const p={};if(f.value==="aliquot"){const r=c.value.map(o=>({parentSampleUid:o.sample.uid,quantity:o.quantity,sampleTypeUid:o.sampleTypeUid,profiles:o.overrideTests?o.profiles.map(u=>u.uid):null,analyses:o.overrideTests?o.analyses.map(u=>u.uid):null,notes:o.notes||null,metadataSnapshot:null}));if(r.some(o=>(o.quantity??1)<1)){m("Aliquot quantity must be at least 1.");return}if(r.some(o=>o.profiles?.length===0&&o.analyses?.length===0)){m("Aliquot overrides must include at least one profile or analysis.");return}p.aliquots=r}else if(f.value==="derivative"){const r=c.value.map(o=>({parentSampleUid:o.sample.uid,quantity:o.quantity,sampleTypeUid:o.sampleTypeUid,profiles:o.overrideTests?o.profiles.map(u=>u.uid):null,analyses:o.overrideTests?o.analyses.map(u=>u.uid):null,notes:o.notes||null,metadataSnapshot:null}));if(r.some(o=>!o.sampleTypeUid)){m("Derivative sample type is required.");return}if(r.some(o=>(o.quantity??1)<1)){m("Derivative quantity must be at least 1.");return}if(r.some(o=>o.profiles?.length===0&&o.analyses?.length===0)){m("Derivative overrides must include at least one profile or analysis.");return}p.derivatives=r}else{const r=i.parents.map(x=>x.uid);if(r.length<2){m("Pools require at least two parent samples.");return}const o=i.overrideTests?i.profiles.map(x=>x.uid):null,u=i.overrideTests?i.analyses.map(x=>x.uid):null;if(o?.length===0&&u?.length===0){m("Pool overrides must include at least one profile or analysis.");return}p.pools=[{parentSampleUids:r,sampleTypeUid:i.sampleTypeUid,profiles:o,analyses:u,notes:i.notes||null,metadataSnapshot:null}]}k.value=!0;try{const r=await a(le,{payload:p},"deriveAnalysisRequest");r?.samples?.length&&(S("derived",r.samples),A("Derived samples created successfully.")),S("close")}catch(r){m(`Failed to derive samples: ${r instanceof Error?r.message:"Unknown error"}`)}finally{k.value=!1}}};return Object.defineProperty(O,"__isScriptSetup",{enumerable:!1,value:!0}),O}}),te={class:"space-y-6"},oe={class:"flex flex-wrap gap-2"},ae=["disabled"],re={key:0,class:"space-y-4"},ie={class:"flex items-center justify-between"},de={class:"font-medium text-foreground"},ne={class:"text-xs text-muted-foreground"},ue={class:"grid grid-cols-1 md:grid-cols-3 gap-4"},me=["onUpdate:modelValue"],pe={class:"text-sm font-medium text-foreground"},ye=["onUpdate:modelValue"],ve={key:0,value:null},be={key:1,disabled:"",value:null},fe=["value"],ce={class:"flex items-center gap-2 pt-6"},xe=["onUpdate:modelValue"],ge={key:0,class:"grid grid-cols-1 md:grid-cols-2 gap-4"},Te=["onUpdate:modelValue"],Se={key:1,class:"space-y-4"},Ue=["value"],Ve={class:"flex items-center gap-2"},ke={key:0,class:"grid grid-cols-1 md:grid-cols-2 gap-4"},Ce={class:"flex justify-end gap-3"},_e=["disabled"];function qe(P,e,V,t,v,S){const b=Y("fel-modal");return V.show?(d(),Z(b,{key:0,onClose:e[10]||(e[10]=l=>t.emit("close")),"content-width":"w-4/5"},{header:q(()=>[...e[11]||(e[11]=[$(" Derive Samples ",-1)])]),body:q(()=>[s("div",te,[s("div",oe,[s("button",{type:"button",class:w(["px-3 py-1.5 rounded-md border text-sm",t.deriveMode==="aliquot"?"bg-primary text-primary-foreground border-primary":"bg-background border-border text-foreground"]),onClick:e[0]||(e[0]=l=>t.deriveMode="aliquot")}," Aliquot ",2),s("button",{type:"button",class:w(["px-3 py-1.5 rounded-md border text-sm",t.deriveMode==="derivative"?"bg-primary text-primary-foreground border-primary":"bg-background border-border text-foreground"]),onClick:e[1]||(e[1]=l=>t.deriveMode="derivative")}," Derivative ",2),s("button",{type:"button",class:w(["px-3 py-1.5 rounded-md border text-sm",[t.deriveMode==="pool"?"bg-primary text-primary-foreground border-primary":"bg-background border-border text-foreground",t.canPool?"":"opacity-50 cursor-not-allowed"]]),disabled:!t.canPool,onClick:e[2]||(e[2]=l=>t.deriveMode="pool")}," Pool ",10,ae)]),t.deriveMode!=="pool"?(d(),n("div",re,[(d(!0),n(M,null,h(t.deriveConfigs,l=>(d(),n("div",{key:l.sample.uid,class:"rounded-md border border-border p-4 space-y-4"},[s("div",ie,[s("div",de,g(l.sample.sampleId),1),s("div",ne,g(l.sample.sampleType?.name),1)]),s("div",ue,[s("div",null,[e[12]||(e[12]=s("label",{class:"text-sm font-medium text-foreground"},"Quantity",-1)),y(s("input",{"onUpdate:modelValue":a=>l.quantity=a,type:"number",min:"1",class:"mt-1 w-full rounded-md border border-border bg-background px-3 py-2 text-sm"},null,8,me),[[D,l.quantity,void 0,{number:!0}]])]),s("div",null,[s("label",pe,g(t.deriveMode==="derivative"?"Sample Type (required)":"Sample Type (optional)"),1),y(s("select",{"onUpdate:modelValue":a=>l.sampleTypeUid=a,class:"mt-1 w-full rounded-md border border-border bg-background px-3 py-2 text-sm"},[t.deriveMode==="aliquot"?(d(),n("option",ve,"Use parent sample type")):(d(),n("option",be,"Select sample type")),(d(!0),n(M,null,h(t.sampleTypes,a=>(d(),n("option",{key:a.uid,value:a.uid},g(a.name),9,fe))),128))],8,ye),[[j,l.sampleTypeUid]])]),s("div",ce,[y(s("input",{type:"checkbox","onUpdate:modelValue":a=>l.overrideTests=a},null,8,xe),[[F,l.overrideTests]]),e[13]||(e[13]=s("span",{class:"text-sm text-foreground"},"Override tests",-1))])]),l.overrideTests?(d(),n("div",ge,[s("div",null,[e[14]||(e[14]=s("label",{class:"text-sm font-medium text-foreground"},"Profiles",-1)),T(t.VueMultiselect,{modelValue:l.profiles,"onUpdate:modelValue":a=>l.profiles=a,options:t.analysesProfiles,label:"name","track-by":"uid",multiple:!0,placeholder:"Select profiles",class:"multiselect-primary"},null,8,["modelValue","onUpdate:modelValue","options"])]),s("div",null,[e[15]||(e[15]=s("label",{class:"text-sm font-medium text-foreground"},"Analyses",-1)),T(t.VueMultiselect,{modelValue:l.analyses,"onUpdate:modelValue":a=>l.analyses=a,options:t.analysesServices,label:"name","track-by":"uid",multiple:!0,placeholder:"Select analyses",class:"multiselect-primary"},null,8,["modelValue","onUpdate:modelValue","options"])])])):_("",!0),s("div",null,[e[16]||(e[16]=s("label",{class:"text-sm font-medium text-foreground"},"Notes",-1)),y(s("input",{"onUpdate:modelValue":a=>l.notes=a,type:"text",class:"mt-1 w-full rounded-md border border-border bg-background px-3 py-2 text-sm"},null,8,Te),[[D,l.notes]])])]))),128))])):(d(),n("div",Se,[s("div",null,[e[17]||(e[17]=s("label",{class:"text-sm font-medium text-foreground"},"Parent Samples (min 2)",-1)),T(t.VueMultiselect,{modelValue:t.poolConfig.parents,"onUpdate:modelValue":e[3]||(e[3]=l=>t.poolConfig.parents=l),options:t.deriveConfigs.map(l=>l.sample),label:"sampleId","track-by":"uid",multiple:!0,placeholder:"Select parent samples",class:"multiselect-primary"},null,8,["modelValue","options"])]),s("div",null,[e[19]||(e[19]=s("label",{class:"text-sm font-medium text-foreground"},"Sample Type (optional)",-1)),y(s("select",{"onUpdate:modelValue":e[4]||(e[4]=l=>t.poolConfig.sampleTypeUid=l),class:"mt-1 w-full rounded-md border border-border bg-background px-3 py-2 text-sm"},[e[18]||(e[18]=s("option",{value:null},"Use first parent sample type",-1)),(d(!0),n(M,null,h(t.sampleTypes,l=>(d(),n("option",{key:l.uid,value:l.uid},g(l.name),9,Ue))),128))],512),[[j,t.poolConfig.sampleTypeUid]])]),s("div",Ve,[y(s("input",{type:"checkbox","onUpdate:modelValue":e[5]||(e[5]=l=>t.poolConfig.overrideTests=l)},null,512),[[F,t.poolConfig.overrideTests]]),e[20]||(e[20]=s("span",{class:"text-sm text-foreground"},"Override tests",-1))]),t.poolConfig.overrideTests?(d(),n("div",ke,[s("div",null,[e[21]||(e[21]=s("label",{class:"text-sm font-medium text-foreground"},"Profiles",-1)),T(t.VueMultiselect,{modelValue:t.poolConfig.profiles,"onUpdate:modelValue":e[6]||(e[6]=l=>t.poolConfig.profiles=l),options:t.analysesProfiles,label:"name","track-by":"uid",multiple:!0,placeholder:"Select profiles",class:"multiselect-primary"},null,8,["modelValue","options"])]),s("div",null,[e[22]||(e[22]=s("label",{class:"text-sm font-medium text-foreground"},"Analyses",-1)),T(t.VueMultiselect,{modelValue:t.poolConfig.analyses,"onUpdate:modelValue":e[7]||(e[7]=l=>t.poolConfig.analyses=l),options:t.analysesServices,label:"name","track-by":"uid",multiple:!0,placeholder:"Select analyses",class:"multiselect-primary"},null,8,["modelValue","options"])])])):_("",!0),s("div",null,[e[23]||(e[23]=s("label",{class:"text-sm font-medium text-foreground"},"Notes",-1)),y(s("input",{"onUpdate:modelValue":e[8]||(e[8]=l=>t.poolConfig.notes=l),type:"text",class:"mt-1 w-full rounded-md border border-border bg-background px-3 py-2 text-sm"},null,512),[[D,t.poolConfig.notes]])])]))])]),footer:q(()=>[s("div",Ce,[s("button",{type:"button",class:"px-4 py-2 text-sm font-medium text-foreground bg-background border border-border rounded-md shadow-sm hover:bg-muted",onClick:e[9]||(e[9]=l=>t.emit("close"))}," Cancel "),s("button",{type:"button",class:"px-4 py-2 text-sm font-medium text-primary-foreground bg-primary border border-transparent rounded-md shadow-sm hover:bg-primary/90 disabled:opacity-60",disabled:t.deriveSaving,onClick:t.submitDeriveRequest}," Create ",8,_e)])]),_:1})):_("",!0)}const Pe=X(se,[["render",qe],["__scopeId","data-v-70d4f653"],["__file","/home/administrator/Documents/Development/beak-insights/felicity/felicity-lims/webapp/components/sample/DeriveSamplesModal.vue"]]);export{Pe as default};
