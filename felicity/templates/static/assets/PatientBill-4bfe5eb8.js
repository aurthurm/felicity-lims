import{W as xe,f as he,u as ke,ak as K,a2 as f,i as Ce,a3 as J,r as I,am as M,o as a,c as d,O as s,D as u,a7 as l,a as h,F as k,H as A,a5 as p,J as i,E as R,C as v,N as S,M as c,z as $,af as q,a4 as Te,Z as U,L as E,a0 as we,a1 as Be,k as Ve,_ as Ae}from"./index-93739211.js";import{u as Se,A as Ue,C as Pe,d as Ne}from"./billing-7eb454fc.js";import{p as je}from"./index-0f6f1926.js";import{u as De}from"./bills-3b4d77d9.js";import{c as Fe,a as L,e as Ie,u as Me,f as W}from"./array-2f9882bb.js";const Re={class:"space-y-6"},$e={class:"grid grid-cols-12 gap-6"},qe={initial:{opacity:0,y:100},enter:{opacity:1,y:0,scale:1},variants:{custom:{scale:2}},delay:400,class:"col-span-3 overflow-y-auto overscroll-contain billing-scroll"},Ee={key:0,class:"py-4 text-center bg-background w-full mb-2 rounded-lg shadow-sm border border-border"},Le={key:1},We={class:"space-y-2"},Ye=["onClick"],Oe={class:"space-y-1"},ze={class:"font-semibold text-foreground"},He={class:"text-sm text-muted-foreground"},Ke={initial:{opacity:0,y:-100},enter:{opacity:1,y:0,scale:1},variants:{custom:{scale:2}},delay:400,class:"col-span-9 space-y-6"},Je={class:"bg-background rounded-lg shadow-sm p-6 space-y-4"},Ze={class:"flex justify-between items-center"},Ge={class:"text-lg font-semibold text-foreground"},Qe={class:"grid grid-cols-3 gap-8"},Xe={class:"space-y-4"},es={class:"flex justify-between items-center"},ss={class:"text-sm text-foreground"},ts={class:"flex justify-between items-center"},os={class:"text-sm text-foreground"},ns={class:"space-y-4"},as={class:"flex justify-between items-center"},ls={class:"text-sm text-foreground"},is={class:"flex justify-between items-center"},rs={class:"text-sm text-foreground"},ds={class:"space-y-4"},us={class:"flex justify-between items-center"},cs={class:"text-sm text-foreground"},fs={class:"space-y-4"},ms={class:"flex justify-between items-center"},ps={class:"bg-background rounded-lg shadow-sm p-6 space-y-4"},vs={class:"font-semibold text-foreground"},gs={class:"text-muted-foreground"},bs={class:"ml-2 text-primary"},ys={class:"space-y-4"},_s={class:"flex justify-between items-center"},xs={class:"space-x-4"},hs={class:"bg-background rounded-lg shadow-sm p-6"},ks={class:"space-y-6 p-6"},Cs={class:"grid grid-cols-2 gap-6"},Ts={class:"space-y-2"},ws=["disabled"],Bs=["value"],Vs={class:"text-sm text-destructive"},As={class:"space-y-2"},Ss=["disabled"],Us={class:"space-y-2"},Ps=["disabled"],Ns={class:"flex justify-end"},js={class:"space-y-6 p-6"},Ds={class:"text-lg font-medium text-foreground"},Fs={class:"space-y-2"},Is=["disabled"],Ms={class:"flex justify-end"},Rs={class:"space-y-6 p-6"},$s={class:"space-y-2"},qs=["disabled"],Es={class:"flex justify-end"},Ls=xe({__name:"PatientBill",props:{patientUid:String},setup(Z){const G=we(()=>Be(()=>import("./FelDataTable-2f84e0fb.js"),["assets/FelDataTable-2f84e0fb.js","assets/index-93739211.js","assets/index-0f090789.css"])),Y=Z,{toastSuccess:O}=Ve(),{withClientMutation:P}=he(),g=Se(),Q=ke(),{bills:z,fetchingBills:X,transactions:ee,fetchingTransactions:se}=K(g),{analysisRequests:te}=K(Q);g.fetchBillsForPatient(Y?.patientUid);const oe=f(["cash","medical-aid","e-payment"]),C=f(!1),n=f({}),ne=o=>{n.value={...o},g.fetchBillTransactions(o.uid)},ae=Ce(()=>{const o=n?.value?.orders?.map(e=>e.uid)??[];return te?.value?.filter(e=>o.includes(e.uid))});function le(o,e){let _=[];return o.forEach(m=>_.push(m.name)),e.forEach(m=>_.push(m.name)),_.join(", ")}const ie=Fe({testBillUid:L().required(),kind:L().required(),amount:Ie().required(),notes:L()}),{handleSubmit:re,errors:b,setFieldValue:T}=Me({validationSchema:ie,initialValues:{testBillUid:n.value?.uid}}),{value:w}=W("kind"),{value:N}=W("amount"),{value:j}=W("notes"),r=f(!1),de=re(o=>{r.value=!0,ce(o)}),ue=()=>{T("testBillUid",n.value?.uid),T("kind","cash"),T("amount",Math.ceil(Number((n?.value?.totalCharged-n?.value?.totalPaid).toFixed(2)))),T("notes",""),C.value=!0},ce=o=>{P(Ue,{payload:o},"createTestBillTransaction").then(e=>{g.addTransaction(e),r.value=!1,C.value=!1,O("Transaction added.")})},B=f(!1),y=f({}),fe=()=>{r.value=!0,P(Pe,{uid:y.value.uid,notes:y.value.notes},"confirmTestBillTransaction").then(o=>{g.updateTransaction(o),r.value=!1,B.value=!1,O("Transaction confirmed.")})},me=f([{name:"Kind",value:"kind",sortable:!0,sortBy:"asc",defaultSort:!0,showInToggler:!1,hidden:!1},{name:"Amount",value:"amount",sortable:!1,sortBy:"asc",hidden:!1},{name:"Success",value:"isSuccess",sortable:!1,sortBy:"asc",hidden:!1},{name:"Notes",value:"notes",sortable:!1,sortBy:"asc",hidden:!1},{name:"Message",value:"message",sortable:!1,sortBy:"asc",hidden:!1},{name:"Processed",value:"processed",sortable:!1,sortBy:"asc",hidden:!1,customRender:function(o,e){return J("span",{innerHTML:o.processed?"Yes":"Pending confirmation"},[])}},{name:"Action",sortable:!1,hidden:!1,customRender:(o,e)=>{if(!o.processed)return J("button",{onClick(){B.value=!0,y.value=o},type:"button",class:"bg-primary text-primary-foreground py-1 px-2 rounded-sm leading-none"},"confirm")}}]),D=f(!1),V=f({code:""}),pe=()=>{D.value=!0},ve=()=>{r.value=!0,P(Ne,{payload:{voucherCode:V.value?.code,testBillUid:n.value?.uid,customerUid:Y.patientUid}},"applyVoucher").then(o=>r.value=!1)},{downloadInvoice:ge}=De(),be=async o=>await ge(o.uid);return(o,e)=>{const _=I("fel-loader"),m=I("fel-button"),F=I("fel-modal"),H=M("motion"),ye=M("motion-slide-top"),_e=M("motion-slide-right");return a(),d(k,null,[s("div",Re,[s("div",$e,[u((a(),d("section",qe,[l(X)?(a(),d("div",Ee,[h(_,{message:"Fetching bills ..."})])):(a(),d("div",Le,[s("ul",We,[(a(!0),d(k,null,A(l(z),t=>(a(),d("li",{key:t.uid,class:p(["bg-background w-full p-3 rounded-lg shadow-sm border border-border transition-all duration-200 hover:shadow-md",{"border-primary bg-primary/5":t.uid===n.value.uid}]),onClick:x=>ne(t)},[s("div",Oe,[s("div",ze," Bill "+i(t.billId?.toLocaleUpperCase()),1),s("div",He,i(l(je)(t.createdAt)),1)])],10,Ye))),128))])]))])),[[H]]),u((a(),d("section",Ke,[u((a(),d("div",Je,[s("div",Ze,[s("h4",Ge,i(n.value.billId?.toLocaleUpperCase()),1)]),s("div",Qe,[s("div",Xe,[s("div",es,[e[9]||(e[9]=s("span",{class:"text-sm font-medium text-foreground"},"Active:",-1)),s("span",ss,i(n.value.isActive?"Yes":"No"),1)]),s("div",ts,[e[10]||(e[10]=s("span",{class:"text-sm font-medium text-foreground"},"Confirmed:",-1)),s("span",os,i(n.value?.toConfirm?"No":"Yes"),1)])]),s("div",ns,[s("div",as,[e[11]||(e[11]=s("span",{class:"text-sm font-medium text-foreground"},"Total Charged:",-1)),s("span",ls,i(n.value?.totalCharged),1)]),s("div",is,[e[12]||(e[12]=s("span",{class:"text-sm font-medium text-foreground"},"Total Paid:",-1)),s("span",rs,i(n.value?.totalPaid),1)])]),s("div",ds,[s("div",us,[e[13]||(e[13]=s("span",{class:"text-sm font-medium text-foreground"},"Partial:",-1)),s("span",cs,i(n.value?.totalPaid<n.value?.totalCharged?"Yes":"No"),1)])])])])),[[ye]]),s("div",fs,[s("div",ms,[e[14]||(e[14]=s("h4",{class:"text-lg font-semibold text-foreground"},"Order Items",-1)),s("button",{class:"px-4 py-2 bg-primary text-primary-foreground rounded-md hover:bg-primary/90 transition-colors duration-200 focus:outline-none focus:ring-2 focus:ring-primary/50",onClick:e[0]||(e[0]=v(t=>be(n.value),["prevent"]))}," Invoice ")]),s("ul",ps,[(a(!0),d(k,null,A(ae.value,t=>(a(),d("li",{class:"space-y-2",key:t.uid},[s("div",vs,i(t?.requestId)+" ("+i(t?.clientRequestId)+")",1),(a(!0),d(k,null,A(t.samples,x=>u((a(),d("div",{class:"space-y-1 pl-4",key:x.uid},[s("span",gs,i(x.sampleId),1),e[15]||(e[15]=S(" â‡’ ")),s("span",bs,i(le(x.profiles??[],x.analyses??[])),1)])),[[_e]])),128))]))),128))])]),s("div",ys,[s("div",_s,[e[16]||(e[16]=s("h4",{class:"text-lg font-semibold text-foreground"},"Transactions",-1)),s("div",xs,[u(s("button",{class:"px-4 py-2 bg-primary text-primary-foreground rounded-md hover:bg-primary/90 transition-colors duration-200 focus:outline-none focus:ring-2 focus:ring-primary/50",onClick:v(ue,["prevent"])}," Add Transaction ",512),[[R,n.value.isActive]]),u(s("button",{class:"px-4 py-2 bg-primary text-primary-foreground rounded-md hover:bg-primary/90 transition-colors duration-200 focus:outline-none focus:ring-2 focus:ring-primary/50",onClick:v(pe,["prevent"])}," Apply Voucher ",512),[[R,n.value.isActive]])])]),s("div",hs,[h(l(G),{columns:me.value,data:l(ee),toggleColumns:!1,loading:l(se),paginable:!1,searchable:!1,filterable:!1,selectable:!1},{footer:c(()=>e[17]||(e[17]=[])),_:1},8,["columns","data","loading"])])])])),[[R,l(z)?.length>0&&n.value.uid],[H]])])]),C.value?(a(),$(F,{key:0,onClose:e[4]||(e[4]=t=>C.value=!1),contentWidth:"w-3/6",class:"bg-background"},{header:c(()=>e[18]||(e[18]=[s("h3",{class:"text-xl font-semibold text-foreground"},"Transaction Form",-1)])),body:c(()=>[s("form",ks,[s("div",Cs,[s("label",Ts,[e[20]||(e[20]=s("span",{class:"text-sm font-medium text-foreground"},"Kind of payment",-1)),u(s("select",{class:p(["w-full rounded-md border border-input bg-background px-3 py-2 text-sm ring-offset-background focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2",{"border-destructive":l(b).kind}]),"onUpdate:modelValue":e[1]||(e[1]=t=>q(w)?w.value=t:null),disabled:r.value},[e[19]||(e[19]=s("option",null,null,-1)),(a(!0),d(k,null,A(oe.value,t=>(a(),d("option",{key:t,value:t},i(t),9,Bs))),128))],10,ws),[[Te,l(w)]]),s("div",Vs,i(l(b).gender),1)]),s("label",As,[e[21]||(e[21]=s("span",{class:"text-sm font-medium text-foreground"},"Amount",-1)),u(s("input",{class:p(["w-full rounded-md border border-input bg-background px-3 py-2 text-sm ring-offset-background focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2",{"border-destructive":l(b).amount}]),type:"number","onUpdate:modelValue":e[2]||(e[2]=t=>q(N)?N.value=t:null),disabled:r.value},null,10,Ss),[[U,l(N)]])])]),s("label",Us,[e[22]||(e[22]=s("span",{class:"text-sm font-medium text-foreground"},"Notes",-1)),u(s("input",{class:p(["w-full rounded-md border border-input bg-background px-3 py-2 text-sm ring-offset-background focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2",{"border-destructive":l(b).notes}]),"onUpdate:modelValue":e[3]||(e[3]=t=>q(j)?j.value=t:null),disabled:r.value},null,10,Ps),[[U,l(j)]])]),s("div",Ns,[h(m,{color:"primary",type:"submit",loading:r.value,onClick:v(l(de),["prevent"])},{default:c(()=>e[23]||(e[23]=[S(" Save Transaction ")])),_:1},8,["loading","onClick"])])])]),_:1})):E("",!0),B.value?(a(),$(F,{key:1,onClose:e[6]||(e[6]=t=>B.value=!1),contentWidth:"w-3/6",class:"bg-background"},{header:c(()=>e[24]||(e[24]=[s("h3",{class:"text-xl font-semibold text-foreground"},"Confirm Transaction",-1)])),body:c(()=>[s("form",js,[s("h4",Ds,i(l(w))+" Transaction",1),s("label",Fs,[e[25]||(e[25]=s("span",{class:"text-sm font-medium text-foreground"},"Notes",-1)),u(s("input",{class:p(["w-full rounded-md border border-input bg-background px-3 py-2 text-sm ring-offset-background focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2",{"border-destructive":l(b).notes}]),"onUpdate:modelValue":e[5]||(e[5]=t=>y.value.notes=t),disabled:r.value},null,10,Is),[[U,y.value.notes]])]),s("div",Ms,[h(m,{color:"primary",type:"submit",loading:r.value,onClick:v(fe,["prevent"])},{default:c(()=>e[26]||(e[26]=[S(" Confirm Transaction ")])),_:1},8,["loading"])])])]),_:1})):E("",!0),D.value?(a(),$(F,{key:2,onClose:e[8]||(e[8]=t=>D.value=!1),contentWidth:"w-1/5",class:"bg-background"},{header:c(()=>e[27]||(e[27]=[s("h3",{class:"text-xl font-semibold text-foreground"},"Apply Voucher Code",-1)])),body:c(()=>[s("form",Rs,[s("label",$s,[e[28]||(e[28]=s("span",{class:"text-sm font-medium text-foreground"},"Voucher Code",-1)),u(s("input",{class:p(["w-full rounded-md border border-input bg-background px-3 py-2 text-sm ring-offset-background focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2",{"border-destructive":!V.value.code}]),type:"text","onUpdate:modelValue":e[7]||(e[7]=t=>V.value.code=t),disabled:r.value},null,10,qs),[[U,V.value.code]])]),s("div",Es,[h(m,{color:"primary",type:"submit",loading:r.value,onClick:v(ve,["prevent"])},{default:c(()=>e[29]||(e[29]=[S(" Apply Voucher ")])),_:1},8,["loading"])])])]),_:1})):E("",!0)],64)}}});const Ks=Ae(Ls,[["__scopeId","data-v-afb0e1b5"],["__file","/home/aurthurm/Documents/Development/felicity/felicity-lims/webapp/views/patient/_id/PatientBill.vue"]]);export{Ks as default};
