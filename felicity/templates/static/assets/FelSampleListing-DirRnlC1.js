const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/FelDataTable-DuhKEezJ.js","assets/index-CNAOKjig.js","assets/index-vawJu9QC.css"])))=>i.map(i=>d[i]);
import{a0 as te,u as se,as as ne,ac as le,a4 as re,g as x,h as G,a7 as M,aT as ie,a1 as oe,a6 as ce,a8 as o,at as de,_ as ue,r as fe,c as me,o as pe,a as f,N as m,A as ve,F as p,D as v,P as h,H as y}from"./index-CNAOKjig.js";import{p as g}from"./index-zY702zsb.js";import{u as he}from"./analysis-CIDyy6YR.js";import{u as ye}from"./samples-DqZBjYU6.js";import{s as be}from"./index-Isf4KT0D.js";import"./analyses.mutations-BhfuTbLn.js";import"./storage.mutations-CFO7fcBK.js";const Se=te({__name:"FelSampleListing",setup(Z,{expose:s}){s();const N=oe(()=>ce(()=>import("./FelDataTable-DuhKEezJ.js"),__vite__mapDeps([0,1,2]))),a=se(),k=he(),{samplePageInfo:L,fetchingSamples:u}=ne(a);let d=le(),P=re();const l=x({barcodes:!1,can_cancel:!1,can_receive:!1,can_reinstate:!1,can_reject:!1,can_copy_to:!1,can_download:!1,can_print:!1,can_publish:!1,can_store:!1,can_recover:!1}),b=G(()=>a.getSamples),z=M([{name:"All",value:""},{name:"Expected",value:"expected"},{name:"Received",value:"received"},{name:"Awaiting",value:"awaiting"},{name:"Approved",value:"approved"},{name:"Published",value:"published"},{name:"Invalidated",value:"invalidated"},{name:"Cancelled",value:"cancelled"},{name:"Rejected",value:"rejected"},{name:"Stored",value:"stored"},{name:"Referred",value:"referred"},{name:"Paired",value:"paired"}]),K=M([{name:"UID",value:"uid",sortable:!0,sortBy:"asc",defaultSort:!0,showInToggler:!1,hidden:!0},{name:"",value:"",sortable:!1,showInToggler:!1,hidden:!1,customRender:function(e,t){return o("div",{class:"flex items-center gap-2"},[e.priority>1?o("span",{class:"text-destructive"},o("i",{class:"fa fa-star"})):"",e.status==="stored"?o("span",{class:"text-muted-foreground"},o("i",{class:"fa-briefcase"})):""])}},{name:"Sample ID",value:"sampleId",sortable:!0,sortBy:"asc",hidden:!1,customRender:function(e,t){return o(de,{to:{name:"sample-detail",params:{patientUid:e?.analysisRequest?.patient?.uid,sampleUid:e?.uid}},class:"text-primary hover:underline",innerHTML:e?.sampleId})}},{name:"Sample Type",value:"sampleType.name",sortable:!1,sortBy:"asc",hidden:!0},{name:"Test(s)",value:"",sortable:!1,sortBy:"asc",hidden:!1,customRender:function(e,t){return o("span",{innerHTML:T(e.profiles,e.analyses)},[])}},{name:"Patient",value:"",sortable:!1,sortBy:"asc",hidden:!1,customRender:function(e,t){const n="analysisRequest.patient.firstName".split(".").reduce((i,E)=>i?.[E],e),r="analysisRequest.patient.lastName".split(".").reduce((i,E)=>i?.[E],e);return o("span",{innerHTML:`${n} ${r}`},[])}},{name:"Gender",value:"analysisRequest.patient.gender",sortable:!1,sortBy:"asc",hidden:!0},{name:"Age",value:"analysisRequest.patient.age",sortable:!1,sortBy:"asc",hidden:!0},{name:"Client Patient ID",value:"analysisRequest.patient.clientPatientId",sortable:!1,sortBy:"asc",hidden:!1},{name:"Client",value:"analysisRequest.client.name",sortable:!1,sortBy:"asc",hidden:!1},{name:"Client Code",value:"analysisRequest.client.code",sortable:!1,sortBy:"asc",hidden:!0},{name:"Province",value:"analysisRequest.client.district.province.name",sortable:!1,sortBy:"asc",hidden:!0},{name:"District",value:"analysisRequest.client.district.name",sortable:!1,sortBy:"asc",hidden:!0},{name:"Client Request Id",value:"analysisRequest.clientRequestId",sortable:!1,sortBy:"asc",hidden:!1},{name:"Date Collected",value:"dateCollected",sortable:!1,sortBy:"asc",hidden:!0,customRender:function(e,t){const n=t.value.split(".").reduce((r,i)=>r?.[i],e);return o("span",{innerHTML:g(n)},[])}},{name:"Date Created",value:"createdAt",sortable:!1,sortBy:"asc",hidden:!0,customRender:function(e,t){const n=t.value.split(".").reduce((r,i)=>r?.[i],e);return o("span",{innerHTML:g(n)},[])}},{name:"Creator",value:"createdBy.firstName",sortable:!1,sortBy:"asc",hidden:!1},{name:"Date Received",value:"dateReceived",sortable:!1,sortBy:"asc",hidden:!0,customRender:function(e,t){const n=t.value.split(".").reduce((r,i)=>r?.[i],e);return o("span",{innerHTML:g(n)},[])}},{name:"Date Submitted",value:"dateSubmitted",sortable:!1,sortBy:"asc",hidden:!0,customRender:function(e,t){const n=t.value.split(".").reduce((r,i)=>r?.[i],e);return o("span",{innerHTML:g(n)},[])}},{name:"Date Verified",value:"dateVerified",sortable:!1,sortBy:"asc",hidden:!0,customRender:function(e,t){const n=t.value.split(".").reduce((r,i)=>r?.[i],e);return o("span",{innerHTML:g(n)},[])}},{name:"Date Published",value:"datePublished",sortable:!1,sortBy:"asc",hidden:!0,customRender:function(e,t){const n=t.value.split(".").reduce((r,i)=>r?.[i],e);return o("span",{innerHTML:g(n)},[])}},{name:"Date Printed",value:"datePrinted",sortable:!1,sortBy:"asc",hidden:!0,customRender:function(e,t){const n=t.value.split(".").reduce((r,i)=>r?.[i],e);return o("span",{innerHTML:g(n)},[])}},{name:"Printed",value:"printed",sortable:!1,sortBy:"asc",hidden:!0},{name:"Status",value:"status",sortable:!1,sortBy:"asc",hidden:!1,customRender:function(e,t){const n=t.value.split(".").reduce((r,i)=>r?.[i],e);return o("button",{type:"button",class:"bg-primary text-primary-foreground py-1 px-2 rounded-sm leading-none",innerHTML:n},[])}}]);d?.query?.clientUid&&a.resetSamples(),a.fetchSampleTypes();let B=x({first:void 0,after:"",text:"",sortBy:["name"]});k.fetchAnalysesServices(B),k.fetchAnalysesProfiles();function T(e,t){let n=[];return e.forEach(r=>n.push(r.name)),t.forEach(r=>n.push(r.name)),n.join(", ")}let c=x({first:50,before:"",status:"received",text:"",sortBy:["-uid"],clientUid:ie(d?.query?.clientUid),filterAction:!1});a.fetchSamples(c);function Q(e){c.first=e.fetchCount,c.before=L?.value?.endCursor??"",c.text=e.filterText,c.status=e.filterStatus,c.filterAction=!1,a.fetchSamples(c)}function W(e){c.first=50,c.before="",c.text=e.filterText,c.status=e.filterStatus,c.filterAction=!0,a.fetchSamples(c)}const X=e=>{const t=e?.storageContainer,n=t?.storageSection,r=n?.storageLocation;return`${r?.storeRoom?.name} > ${r?.name} > ${n?.name} > ${t?.name} > ${e?.storageSlot}`},C=M(!1);function Y(e){b.value?.forEach(t=>t.checked=e.checked),C.value=e.checked,A()}function $(e){const t=b.value.findIndex(n=>n.uid===e.uid);b.value[t].checked=e.checked,w()?C.value=!0:C.value=!1,A()}function ee(e){const t=b.value.findIndex(n=>n.uid===e.uid);b.value[t].checked=!1,C.value=!1,A()}async function S(){b.value?.forEach(e=>e.checked=!1),C.value=!1,A()}function w(){return b.value?.every(e=>e.checked===!0)}function R(){let e=[];return b.value?.forEach(t=>{t.checked&&e.push(t)}),e}function A(){l.can_cancel=!1,l.can_receive=!1,l.can_reinstate=!1,l.can_download=!1,l.can_publish=!1,l.can_print=!1,l.can_reject=!1,l.can_store=!1,l.can_recover=!1,l.can_copy_to=!1,l.barcodes=!1;const e=R();e.length!==0&&(l.barcodes=!0,e.every(t=>t.status==="expected")&&(l.can_receive=!0),e.every(t=>["received","expected"].includes(t.status))&&(l.can_cancel=!0,l.can_reject=!0),e.every(t=>["received"].includes(t.status))&&(l.can_store=!0,l.can_copy_to=!0),e.every(t=>["stored"].includes(t.status))&&(l.can_recover=!0),e.every(t=>t.status==="cancelled")&&(l.can_reinstate=!0),e.every(t=>["approved","published"].includes(t.status))&&(l.can_copy_to=!0),e.every(t=>t.status==="approved")&&(l.can_publish=!0),e.every(t=>t.status==="published")&&(l.can_print=!0,l.can_download=!0))}function _(){const e=R();let t=[];return e?.forEach(n=>t.push(n.uid)),t}function I(){const e=R();let t=[];return e?.forEach(n=>t.push(n.sampleId)),t}const{cancelSamples:j,reInstateSamples:D,receiveSamples:q,printSamples:H,downloadSamplesImpress:O,publishSamples:U,recoverSamples:V,cloneSamples:F}=ye(),ae=G(()=>a.getSamples?.length+" of "+a.getSampleCount+" samples"),J={DataTable:N,sampleStore:a,analysisStore:k,samplePageInfo:L,fetchingSamples:u,get route(){return d},set route(e){d=e},get router(){return P},set router(e){P=e},state:l,samples:b,filterOptions:z,tableColumns:K,get analysesParams(){return B},set analysesParams(e){B=e},profileAnalysesText:T,get sampleParams(){return c},set sampleParams(e){c=e},showMoreSamples:Q,filterSamples:W,sampleToolTip:X,allChecked:C,toggleCheckAll:Y,toggleCheck:$,unCheck:ee,unCheckAll:S,areAllChecked:w,getSamplesChecked:R,checkUserActionPermissios:A,getSampleUids:_,getSampleIds:I,cancelSamples:j,reInstateSamples:D,receiveSamples:q,printSamples:H,downloadSamplesImpress:O,publishSamples:U,recoverSamples:V,cloneSamples:F,countNone:ae,cloneSamples_:async()=>F(_()).finally(()=>S()),cancelSamples_:async()=>j(_()).finally(()=>S()),reInstateSamples_:async()=>D(_()).finally(()=>S()),receiveSamples_:async()=>q(_()).finally(()=>S()),publishReports_:async()=>{const e=_().map(t=>({uid:t,action:"publish"}));await U(e).finally(()=>S())},printReports_:async()=>await H(_()).finally(()=>S()),impressDownload_:async()=>await O(I()).finally(()=>S()),prepareRejections:async()=>{const e=R();P.push({name:"reject-samples",state:{samples:JSON.stringify(e)}})},prepareStorages:async()=>{const e=R();P.push({name:"store-samples",state:{samples:JSON.stringify(e)}})},recoverSamples_:async()=>V(_()).finally(()=>S()),printBarCodes:async()=>P.push({name:"print-barcodes",state:{sampleUids:JSON.stringify(_())}}),get shield(){return be}};return Object.defineProperty(J,"__isScriptSetup",{enumerable:!1,value:!0}),J}}),_e={class:"rounded-lg border border-border bg-card shadow-sm p-6"};function ge(Z,s,N,a,k,L){const u=fe("fel-button");return pe(),me("div",_e,[f(a.DataTable,{columns:a.tableColumns,data:a.samples,toggleColumns:!0,loading:a.fetchingSamples,paginable:!0,pageMeta:{fetchCount:a.sampleParams.first,hasNextPage:a.samplePageInfo?.hasNextPage,countNone:a.countNone},searchable:!0,filterable:!0,filterMeta:{defaultFilter:a.sampleParams.status,filters:a.filterOptions},selectable:!0,allChecked:a.allChecked,onOnSearch:a.filterSamples,onOnPaginate:a.showMoreSamples,onOnCheck:a.toggleCheck,onOnCheckAll:a.toggleCheckAll},{footer:m(()=>[ve("div",null,[p(f(u,{onClick:s[0]||(s[0]=v(d=>a.cancelSamples_(),["prevent"]))},{default:m(()=>[...s[10]||(s[10]=[h(" Cancel ",-1)])]),_:1},512),[[y,a.shield.hasRights(a.shield.actions.CANCEL,a.shield.objects.SAMPLE)&&a.state.can_cancel]]),p(f(u,{onClick:s[1]||(s[1]=v(d=>a.reInstateSamples_(),["prevent"]))},{default:m(()=>[...s[11]||(s[11]=[h(" ReInstate ",-1)])]),_:1},512),[[y,a.shield.hasRights(a.shield.actions.CANCEL,a.shield.objects.SAMPLE)&&a.state.can_reinstate]]),p(f(u,{onClick:s[2]||(s[2]=v(d=>a.receiveSamples_(),["prevent"]))},{default:m(()=>[...s[12]||(s[12]=[h(" Reveive ",-1)])]),_:1},512),[[y,a.shield.hasRights(a.shield.actions.CANCEL,a.shield.objects.SAMPLE)&&a.state.can_receive]]),p(f(u,{onClick:s[3]||(s[3]=v(d=>a.prepareStorages(),["prevent"]))},{default:m(()=>[...s[13]||(s[13]=[h(" Store ",-1)])]),_:1},512),[[y,a.shield.hasRights(a.shield.actions.CANCEL,a.shield.objects.SAMPLE)&&a.state.can_store]]),p(f(u,{onClick:s[4]||(s[4]=v(d=>a.recoverSamples_(),["prevent"]))},{default:m(()=>[...s[14]||(s[14]=[h(" Recover ",-1)])]),_:1},512),[[y,a.shield.hasRights(a.shield.actions.CANCEL,a.shield.objects.SAMPLE)&&a.state.can_recover]]),p(f(u,{onClick:s[5]||(s[5]=v(d=>a.prepareRejections(),["prevent"]))},{default:m(()=>[...s[15]||(s[15]=[h(" Reject ",-1)])]),_:1},512),[[y,a.shield.hasRights(a.shield.actions.CANCEL,a.shield.objects.SAMPLE)&&a.state.can_reject]]),p(f(u,{onClick:s[6]||(s[6]=v(d=>a.cloneSamples_(),["prevent"]))},{default:m(()=>[...s[16]||(s[16]=[h(" Copy to New ",-1)])]),_:1},512),[[y,a.shield.hasRights(a.shield.actions.CANCEL,a.shield.objects.SAMPLE)&&a.state.can_copy_to]]),p(f(u,{onClick:s[7]||(s[7]=v(d=>a.impressDownload_(),["prevent"]))},{default:m(()=>[...s[17]||(s[17]=[h(" Download ",-1)])]),_:1},512),[[y,a.shield.hasRights(a.shield.actions.CANCEL,a.shield.objects.SAMPLE)&&a.state.can_download]]),p(f(u,{onClick:s[8]||(s[8]=v(d=>a.publishReports_(),["prevent"]))},{default:m(()=>[...s[18]||(s[18]=[h(" Publish ",-1)])]),_:1},512),[[y,a.shield.hasRights(a.shield.actions.CANCEL,a.shield.objects.SAMPLE)&&a.state.can_publish]]),p(f(u,{onClick:s[9]||(s[9]=v(d=>a.printReports_(),["prevent"]))},{default:m(()=>[...s[19]||(s[19]=[h(" Print ",-1)])]),_:1},512),[[y,a.shield.hasRights(a.shield.actions.CANCEL,a.shield.objects.SAMPLE)&&a.state.can_print]]),p(f(u,{onClick:v(a.printBarCodes,["prevent"])},{default:m(()=>[...s[20]||(s[20]=[h(" Print Barcodes ",-1)])]),_:1},512),[[y,a.state.barcodes]])])]),_:1},8,["columns","data","loading","pageMeta","filterMeta","allChecked"])])}const Oe=ue(Se,[["render",ge],["__file","/home/aurthurm/Documents/Development/felicity/felicity-lims/webapp/components/sample/FelSampleListing.vue"]]);export{Oe as default};
