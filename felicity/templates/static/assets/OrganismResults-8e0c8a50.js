import{d as X,I as Y,r as c,p as Z,q as ee,n as te,o as n,c as r,b as e,B as v,F as f,C as E,t as x,e as k,L as I,g as S,z as b,A as T,w as V,f as w,y as se,v as ae,j as B,_ as N,k as oe}from"./index-52cc981d.js";import{h as $,o as j,a as L}from"./constants-1ec6e6e6.js";import{u as ne}from"./analysis-b22715e2.js";import{a9 as ie,aa as re,ab as le,ac as de,k as ue}from"./microbiology.mutations-5efa76ee.js";import"./analyses.mutations-5012548d.js";const ce={class:"flex justify-between items-center"},me=e("span",{class:"font-bold"},"Organisms",-1),pe=["disabled"],ve=e("hr",{class:"mt-1"},null,-1),be={class:"overflow-x-auto mt-2"},he={class:"align-middle inline-block min-w-full shadow overflow-hidden bg-white shadow-dashboard px-2 pt-1 rounded-bl-lg rounded-br-lg"},_e={class:"min-w-full"},ge=e("thead",null,[e("tr",null,[e("th",{class:"px-1 py-1 border-b-2 border-gray-300 text-left text-sm leading-4 text-gray-800 tracking-wider"},"Isolate Number"),e("th",{class:"px-1 py-1 border-b-2 border-gray-300 text-left text-sm leading-4 text-gray-800 tracking-wider"},"Organism Name"),e("th",{class:"px-1 py-1 border-b-2 border-gray-300"})])],-1),ye={class:"bg-white"},fe={class:"px-1 py-1 whitespace-no-wrap border-b border-gray-500"},xe={class:"text-sm leading-5 text-gray-800"},ke={class:"px-1 py-1 whitespace-no-wrap border-b border-gray-500"},we={key:0,class:"text-sm leading-5 text-sky-800"},Oe=["onClick"],Ae={class:"px-1 py-1 whitespace-no-wrap text-right border-b border-gray-500 text-sm leading-5"},Ce={key:0},Re=["onClick"],De=["onClick"],Ue={key:1},Ee=["onClick"],Ie={class:"mt-4"},Se=e("h3",null,"Search Organism",-1),Te={class:""},Ve={class:"w-full"},Be={class:"block mb-4"},Ne={class:"border p-2 h-64 overflow-y-auto"},$e={class:"w-full"},je={class:"px-1 py-1 whitespace-no-wrap border-b border-gray-500"},Le={class:"text-sm leading-5 text-gray-800"},Pe={class:"px-1 py-1 whitespace-no-wrap text-right border-b border-gray-500 text-sm leading-5"},Me=["onClick"],Fe=X({__name:"OrganismResults",props:{sample:{type:Object,required:!0},analysisResults:{type:Object,required:!0}},setup(P){const M=B(()=>N(()=>import("./FelModal-2b9d991a.js"),["assets/FelModal-2b9d991a.js","assets/index-52cc981d.js","assets/index-8ef91573.css","assets/FelModal-780aeea9.css"])),O=B(()=>N(()=>import("./FelButton-77125fa9.js"),["assets/FelButton-77125fa9.js","assets/index-52cc981d.js","assets/index-8ef91573.css"])),{withClientMutation:h,withClientQuery:A}=Y(),o=c([]),m=c(!1),p=c(""),C=c([]),_=c(void 0),d=c(!1),{sample:R,analysisResults:D}=P,l=Z(()=>D[0]);ee(()=>{A(ie,{analysisResultUid:l.value.uid},"abxOrganismResultAll").then(s=>{s&&(o.value=s||[])}).finally(()=>g())});function F(){d.value=!0,h(re,{analysisResultUid:l.value.uid},"createAbxOrganismResult").then(s=>{s&&o.value.unshift(s)}).finally(()=>d.value=!1)}function q(s){d.value=!0,h(le,{uid:s.uid,organismUid:s.organism.uid},"saveAbxOrganismResult").then(a=>{if(a){const t=o.value.findIndex(i=>i.uid===s.uid);if(t>-1){const i=a.organism;o.value[t].organismUid=i?.uid,o.value[t].organism=i}}}).finally(()=>{d.value=!1,g()})}function z(s){d.value=!0,h(de,{uid:s.uid},"removeAbxOrganismResult").then(a=>{if(a){const t=o.value.findIndex(i=>i.uid===a?.uid);t>-1&&o.value.splice(t,1)}}).finally(()=>{d.value=!1,g()})}function U(s){_.value=s,m.value=!0}function G(s){m.value=!1,o.value[_.value].organism=s,_.value=void 0,D[0].result=o.value.map(a=>a.organism?.name).join(", ")}function Q(){p.value.length<3||A(ue,{text:p.value,pageSize:25,sortBy:["name"]},"abxOrganismAll").then(s=>{C.value=s?.items})}const u=te({can_submit:!1,can_approve:!1});function g(){u.can_submit=!1,u.can_approve=!1;const s=o.value.every(a=>a.organismUid!=null);l.value.status=="pending"&&s&&(u.can_submit=!0),l.value.status=="resulted"&&(u.can_approve=!0)}let{submitResults:W,approveResults:H}=ne();const J=()=>W([{uid:l.value.uid,result:l.value.result,methodUid:"felicity_ast",laboratoryInstrumentUid:"felicity_ast"}],"sample",R?.uid).then(console.log),K=()=>H([l.value.uid],"sample",R?.uid).then(console.log);return(s,a)=>(n(),r(f,null,[e("h3",ce,[me,l.value.status=="pending"?(n(),r("button",{key:0,onClick:a[0]||(a[0]=t=>F()),class:"ml-2 px-2 py-1 border-sky-800 border text-sky-800 rounded-sm transition duration-300 hover:bg-sky-800 hover:text-white focus:outline-none",disabled:d.value}," add organism ",8,pe)):v("",!0)]),ve,e("div",be,[e("div",he,[e("table",_e,[ge,e("tbody",ye,[(n(!0),r(f,null,E(o.value,(t,i)=>(n(),r("tr",{key:t?.uid},[e("td",fe,[e("div",xe,"#"+x(t?.isolateNumber),1)]),e("td",ke,[t?.organism?(n(),r("div",we,x(t?.organism?.name),1)):(n(),r("button",{key:1,class:"px-2 border-sky-800 border text-sky-800 rounded-sm transition duration-300 hover:bg-sky-800 hover:text-white focus:outline-none",onClick:y=>U(i)}," pick organism ",8,Oe))]),e("td",Ae,[t?.organism&&!t?.organismUid?(n(),r("span",Ce,[e("button",{class:"px-2 py-1 border-orange-800 border text-orange-800 rounded-sm transition duration-300 hover:bg-orange-800 hover:text-white focus:outline-none",onClick:y=>U(i)}," change ",8,Re),e("button",{class:"ml-2 px-2 py-1 border-sky-800 border text-sky-800 rounded-sm transition duration-300 hover:bg-sky-800 hover:text-white focus:outline-none",onClick:y=>q(t)}," save ",8,De)])):v("",!0),l.value.status=="pending"&&o.value.length>1?(n(),r("span",Ue,[e("button",{class:"px-2 py-1 border-orange-800 border text-orange-800 rounded-sm transition duration-300 hover:bg-orange-800 hover:text-white focus:outline-none",onClick:y=>z(t)}," delete ",8,Ee)])):v("",!0)])]))),128))])])])]),e("div",Ie,[k(S(w(O),{key:"submit",onClick:V(J,["prevent"]),color:"orange-600"},{default:b(()=>[T("Submit organisms")]),_:1},512),[[I,$(L.UPDATE,j.RESULT)&&u.can_submit]]),k(S(w(O),{key:"verify",onClick:V(K,["prevent"]),color:"orange-600"},{default:b(()=>[T("Verify organisms")]),_:1},512),[[I,$(L.UPDATE,j.RESULT)&&u.can_approve]])]),m.value?(n(),se(w(M),{key:0,onClose:a[2]||(a[2]=t=>m.value=!1),contentWidth:"w-1/2"},{header:b(()=>[Se]),body:b(()=>[e("form",Te,[e("div",Ve,[e("label",Be,[k(e("input",{"onUpdate:modelValue":a[1]||(a[1]=t=>p.value=t),onInput:Q,class:"form-input mt-1 block w-full",placeholder:"Search organisms..."},null,544),[[ae,p.value]])]),e("div",Ne,[e("table",$e,[(n(!0),r(f,null,E(C.value,t=>(n(),r("tr",{key:t.uid},[e("td",je,[e("div",Le,x(t.name),1)]),e("td",Pe,[e("button",{onClick:i=>G(t),class:"px-2 py-1 border-sky-800 border text-sky-800 rounded-sm transition duration-300 hover:bg-sky-800 hover:text-white focus:outline-none"}," pick ",8,Me)])]))),128))])])])])]),_:1})):v("",!0)],64))}}),He=oe(Fe,[["__file","/home/aurthurm/Documents/Development/felicity/felicity-lims/webapp/views/sample/_id/results/OrganismResults.vue"]]);export{He as default};
