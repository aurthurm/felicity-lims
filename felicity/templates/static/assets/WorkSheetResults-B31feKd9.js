import{Y as j,bs as ge,bq as be,A as c,o as i,K as a,y as L,a4 as M,bf as re,bg as Se,_ as P,Q as _e,ag as he,$ as ve,a0 as b,a7 as ke,av as ye,aI as q,aZ as xe,a3 as we,r as k,c as y,z as d,D as T,E as G,a as r,C as A,M as u,F as N,H as z,I as _,N as ae,al as Ce}from"./index-OdhKCqIc.js";import{u as Re}from"./worksheet-DABAW5lX.js";import{u as Ue}from"./analysis-axSHEiPd.js";import{u as Ie}from"./user-DYsgscqA.js";import{u as Te}from"./setup-BcFG_bXr.js";import{s as Ae}from"./index-DJJ2wcNX.js";import{e as Be,S as De,a as Ve,b as Ge,c as Ee,d as Ne}from"./SelectValue-Ds0cfAgl.js";import{S as ze}from"./Spinner-Bl8RfjFA.js";import"./analyses.mutations-DUxQZn1r.js";import"./useNonce-B4v0IDPb.js";import"./chevron-down-Dqf-ptA3.js";import"./useFocusGuards-Bjb6OG0k.js";import"./PopperContent-BfyCnGUj.js";const[At,je]=be("SelectGroup");var We=j({__name:"SelectGroup",props:{asChild:{type:Boolean,required:!1},as:{type:null,required:!1}},setup(n){const t=n,f=ge(void 0,"reka-select-group");return je({id:f}),(e,x)=>(i(),c(re(Se),M({role:"group"},t,{"aria-labelledby":re(f)}),{default:a(()=>[L(e.$slots,"default")]),_:3},16,["aria-labelledby"]))}}),qe=We;const Le=j({__name:"SelectGroup",props:{asChild:{type:Boolean,required:!1},as:{type:null,required:!1}},setup(n,{expose:t}){t();const e={props:n,get SelectGroup(){return qe}};return Object.defineProperty(e,"__isScriptSetup",{enumerable:!1,value:!0}),e}});function Me(n,t,f,e,x,w){return i(),c(e.SelectGroup,M({"data-slot":"select-group"},e.props),{default:a(()=>[L(n.$slots,"default")]),_:3},16)}const Pe=P(Le,[["render",Me],["__file","/home/administrator/Documents/Development/beak-insights/felicity/felicity-lims/webapp/components/ui/select/SelectGroup.vue"]]),Ye=j({__name:"SelectItemText",props:{asChild:{type:Boolean,required:!1},as:{type:null,required:!1}},setup(n,{expose:t}){t();const e={props:n,get SelectItemText(){return Be}};return Object.defineProperty(e,"__isScriptSetup",{enumerable:!1,value:!0}),e}});function He(n,t,f,e,x,w){return i(),c(e.SelectItemText,M({"data-slot":"select-item-text"},e.props),{default:a(()=>[L(n.$slots,"default")]),_:3},16)}const Oe=P(Ye,[["render",He],["__file","/home/administrator/Documents/Development/beak-insights/felicity/felicity-lims/webapp/components/ui/select/SelectItemText.vue"]]),Fe=j({__name:"WorkSheetResults",setup(n,{expose:t}){t();const f=_e(),e=Te(),x=Ie(),w=he(),B=ve();let m=b(!1),h=b(!1),C=b(!1),p=b(!1),R=b(!1),U=b(!1),l=b(!1),v=b(!1),S=ke(()=>f.getWorkSheet);const Y=()=>{f.fetchWorksheetByUid(w.params.workSheetUid)};x.fetchUsers({}),e.fetchLaboratoryInstruments(),e.fetchMethods();const H=ye({analystUid:null,instrumentUid:null,methodUid:null}),ne=s=>s!=null?String(s):void 0,W=b(!1),oe=()=>{W.value=!0,f.updateWorksheet({worksheetUid:w.params.workSheetUid,...H}).then(()=>{W.value=!1,Y()})};function O(){return S.value?.analysisResults?.every(s=>s.checked===!0)}function D(){let s=[];return S.value?.analysisResults?.forEach(o=>{o.checked&&s.push(o)}),s}function ie(){O()?l.value=!0:l.value=!1,I()}function F(s){if(J(s)){E(s);return}s.checked=!0,I()}function J(s){return["retracted","approved"].includes(s.status)}function E(s){s.checked=!1,I()}function de(){S?.value?.analysisResults?.forEach(s=>l.value?F(s):E(s)),I()}function ue(){S?.value?.analysisResults?.forEach(s=>E(s)),I()}function ce(s){let o=[];return s?.forEach(g=>o.push(g.name)),o.join(", ")}function K(s){s.editable=!0}function fe(s){return s.status!=="pending"?!1:s?.editable||q(s?.result)?(K(s),!0):!1}function Q(){let s=D(),o=[];return s?.forEach(g=>o.push({uid:g.uid,result:g.result,laboratoryInstrumentUid:g.laboratoryInstrumentUid,methodUid:g.methodUid})),o}function V(){const s=D();let o=[];return s?.forEach(g=>o.push(g.uid)),o}function Z(){const s=D();let o=[];return s?.forEach(g=>o.push(g.sample?.uid)),o}function me(s){switch(s?.status){case"retracted":return"bg-muted text-sm italic text-muted-foreground";default:return"text-sm leading-5 text-primary"}}function pe(s){switch(s?.status){case"retracted":return!0;case"approved":return s?.reportable===!1;default:return!1}}function I(){m.value=!1,R.value=!1,h.value=!1,C.value=!1,p.value=!1,U.value=!1;const s=D();s.length!==0&&(U.value=!0,s.every(o=>o.status==="pending"&&!q(o.methodUid)&&!q(o.laboratoryInstrumentUid))&&(m.value=!0,R.value=!0),s.every(o=>o.status==="resulted")&&(h.value=!0,C.value=!0,p.value=!0))}const{submitResults:X,approveResults:$,retractResults:ee,retestResults:te}=Ue(),{unAssignSamples:se}=Re(),le={worksheetStore:f,setupStore:e,userStore:x,route:w,router:B,get can_submit(){return m},set can_submit(s){m=s},get can_retract(){return h},set can_retract(s){h=s},get can_approve(){return C},set can_approve(s){C=s},get can_retest(){return p},set can_retest(s){p=s},get can_unassign(){return R},set can_unassign(s){R=s},get barcodes(){return U},set barcodes(s){U=s},get allChecked(){return l},set allChecked(s){l=s},get viewDetail(){return v},set viewDetail(s){v=s},get worksheet(){return S},set worksheet(s){S=s},refresh:Y,form:H,toSelectValue:ne,applying:W,applyChanges:oe,areAllChecked:O,getResultsChecked:D,checkCheck:ie,check:F,checkDisabled:J,unCheck:E,toggleCheckAll:de,unCheckAll:ue,analysesText:ce,editResult:K,isEditable:fe,prepareResults:Q,getResultsUids:V,getSampleUids:Z,getResultRowColor:me,isDisabledRowCheckBox:pe,checkUserActionPermissios:I,submitter_:X,approver_:$,retracter_:ee,retester_:te,unassinger_:se,unAssignSamples:()=>se(V()),submitResults:()=>X(Q(),"worksheet",S.value?.uid),approveResults:()=>$(V(),"worksheet",S.value?.uid),retractResults:()=>ee(V()),retestResults:()=>te(V()),printBarCodes:async()=>{window.open(B.resolve({name:"print-barcodes",query:{sampleUids:JSON.stringify(Z().join(","))}}).href,"_blank")},get shield(){return Ae},get Select(){return Ne},get SelectContent(){return Ee},get SelectGroup(){return Pe},get SelectItem(){return Ge},get SelectItemText(){return Oe},get SelectTrigger(){return Ve},get SelectValue(){return De},get Button(){return we},get Spinner(){return ze},get Switch(){return xe}};return Object.defineProperty(le,"__isScriptSetup",{enumerable:!1,value:!0}),le}}),Je={class:"space-y-6"},Ke={class:"flex items-center justify-between bg-background rounded-lg shadow-sm p-4"},Qe={class:"flex items-center space-x-4"},Ze={class:"flex items-center space-x-4"},Xe={class:"text-sm font-medium flex items-center gap-x-2"},$e={class:"text-sm font-medium flex items-center gap-x-2"},et={class:"border border-border bg-card rounded-lg shadow-md overflow-hidden"},tt={class:"p-4 border-b border-border"},st={class:"grid grid-cols-3 gap-4"},lt={class:"block space-y-2"},rt={class:"block space-y-2"},at={class:"block space-y-2"},nt={class:"mt-4 flex justify-end"},ot={class:"relative w-full overflow-auto"},it=["onUpdate:modelValue"],dt={key:1};function ut(n,t,f,e,x,w){const B=k("Checkbox"),m=k("TableHead"),h=k("TableRow"),C=k("TableHeader"),p=k("TableCell"),R=k("TableBody"),U=k("Table");return i(),y("div",Je,[d("div",Ke,[d("div",Qe,[T(r(e.Button,{onClick:t[0]||(t[0]=l=>e.submitResults()),disabled:n.submitting,size:"sm"},{default:a(()=>[n.submitting?(i(),c(e.Spinner,{key:0,class:"mr-2 size-4"})):A("",!0),t[14]||(t[14]=u(" Submit Results ",-1))]),_:1},8,["disabled"]),[[G,e.can_submit&&e.shield.hasRights(e.shield.actions.SUBMIT,e.shield.objects.ANALYSIS)]]),T(r(e.Button,{onClick:t[1]||(t[1]=l=>e.approveResults()),disabled:n.approving,size:"sm"},{default:a(()=>[n.approving?(i(),c(e.Spinner,{key:0,class:"mr-2 size-4"})):A("",!0),t[15]||(t[15]=u(" Approve Results ",-1))]),_:1},8,["disabled"]),[[G,e.can_approve&&e.shield.hasRights(e.shield.actions.VERIFY,e.shield.objects.ANALYSIS)]]),T(r(e.Button,{onClick:t[2]||(t[2]=l=>e.retractResults()),disabled:n.retracting,variant:"destructive",size:"sm"},{default:a(()=>[n.retracting?(i(),c(e.Spinner,{key:0,class:"mr-2 size-4"})):A("",!0),t[16]||(t[16]=u(" Retract Results ",-1))]),_:1},8,["disabled"]),[[G,e.can_retract&&e.shield.hasRights(e.shield.actions.RETRACT,e.shield.objects.ANALYSIS)]]),T(r(e.Button,{onClick:t[3]||(t[3]=l=>e.retestResults()),disabled:n.retesting,variant:"secondary",size:"sm"},{default:a(()=>[n.retesting?(i(),c(e.Spinner,{key:0,class:"mr-2 size-4"})):A("",!0),t[17]||(t[17]=u(" Retest ",-1))]),_:1},8,["disabled"]),[[G,e.can_retest&&e.shield.hasRights(e.shield.actions.RETEST,e.shield.objects.ANALYSIS)]]),T(r(e.Button,{onClick:t[4]||(t[4]=l=>e.unAssignSamples()),disabled:n.unassigning,variant:"secondary",size:"sm"},{default:a(()=>[n.unassigning?(i(),c(e.Spinner,{key:0,class:"mr-2 size-4"})):A("",!0),t[18]||(t[18]=u(" Unassign ",-1))]),_:1},8,["disabled"]),[[G,e.can_unassign&&e.shield.hasRights(e.shield.actions.UNASSIGN,e.shield.objects.ANALYSIS)]])]),d("div",Ze,[d("label",Xe,[r(e.Switch,{checked:e.viewDetail,"onUpdate:checked":t[5]||(t[5]=l=>e.viewDetail=l)},null,8,["checked"]),t[19]||(t[19]=d("span",null,"View Detail",-1))]),d("label",$e,[r(e.Switch,{checked:e.barcodes,"onUpdate:checked":t[6]||(t[6]=l=>e.barcodes=l)},null,8,["checked"]),t[20]||(t[20]=d("span",null,"Print Barcodes",-1))])])]),d("div",et,[d("div",tt,[d("div",st,[d("label",lt,[t[21]||(t[21]=d("span",{class:"text-sm font-medium text-foreground"},"Analyst",-1)),r(e.Select,{"model-value":e.toSelectValue(e.form.analystUid),"onUpdate:modelValue":t[7]||(t[7]=l=>e.form.analystUid=l)},{default:a(()=>[r(e.SelectTrigger,{class:"w-full"},{default:a(()=>[r(e.SelectValue,{placeholder:"Select Analyst"})]),_:1}),r(e.SelectContent,null,{default:a(()=>[r(e.SelectGroup,null,{default:a(()=>[(i(!0),y(N,null,z(e.userStore.getUsers,l=>(i(),c(e.SelectItem,{key:l?.uid,value:String(l?.uid)},{default:a(()=>[r(e.SelectItemText,null,{default:a(()=>[u(_(l?.firstName),1)]),_:2},1024)]),_:2},1032,["value"]))),128))]),_:1})]),_:1})]),_:1},8,["model-value"])]),d("label",rt,[t[22]||(t[22]=d("span",{class:"text-sm font-medium text-foreground"},"Instrument",-1)),r(e.Select,{"model-value":e.toSelectValue(e.form.instrumentUid),"onUpdate:modelValue":t[8]||(t[8]=l=>e.form.instrumentUid=l)},{default:a(()=>[r(e.SelectTrigger,{class:"w-full"},{default:a(()=>[r(e.SelectValue,{placeholder:"Select Instrument"})]),_:1}),r(e.SelectContent,null,{default:a(()=>[r(e.SelectGroup,null,{default:a(()=>[(i(!0),y(N,null,z(e.setupStore.getLaboratoryInstruments,l=>(i(),c(e.SelectItem,{key:l?.uid,value:String(l?.uid)},{default:a(()=>[r(e.SelectItemText,null,{default:a(()=>[u(_(l?.name),1)]),_:2},1024)]),_:2},1032,["value"]))),128))]),_:1})]),_:1})]),_:1},8,["model-value"])]),d("label",at,[t[23]||(t[23]=d("span",{class:"text-sm font-medium text-foreground"},"Method",-1)),r(e.Select,{"model-value":e.toSelectValue(e.form.methodUid),"onUpdate:modelValue":t[9]||(t[9]=l=>e.form.methodUid=l)},{default:a(()=>[r(e.SelectTrigger,{class:"w-full"},{default:a(()=>[r(e.SelectValue,{placeholder:"Select Method"})]),_:1}),r(e.SelectContent,null,{default:a(()=>[r(e.SelectGroup,null,{default:a(()=>[(i(!0),y(N,null,z(e.setupStore.getMethods,l=>(i(),c(e.SelectItem,{key:l?.uid,value:String(l?.uid)},{default:a(()=>[r(e.SelectItemText,null,{default:a(()=>[u(_(l?.name),1)]),_:2},1024)]),_:2},1032,["value"]))),128))]),_:1})]),_:1})]),_:1},8,["model-value"])])]),d("div",nt,[r(e.Button,{onClick:t[10]||(t[10]=l=>e.applyChanges()),disabled:e.applying,size:"sm"},{default:a(()=>[e.applying?(i(),c(e.Spinner,{key:0,class:"mr-2 size-4"})):A("",!0),t[24]||(t[24]=u(" Apply Changes ",-1))]),_:1},8,["disabled"])])]),d("div",ot,[r(U,{class:"w-full caption-bottom text-sm"},{default:a(()=>[r(C,{class:"[&_tr]:border-b"},{default:a(()=>[r(h,{class:"border-b transition-colors hover:bg-muted/50 data-[state=selected]:bg-muted"},{default:a(()=>[r(m,{class:"px-4 py-3 text-left text-xs font-medium text-muted-foreground uppercase tracking-wider"},{default:a(()=>[r(B,{checked:e.allChecked,"onUpdate:checked":t[11]||(t[11]=l=>e.allChecked=l),onClick:t[12]||(t[12]=l=>e.toggleCheckAll())},null,8,["checked"])]),_:1}),r(m,{class:"px-4 py-3 text-left text-xs font-medium text-muted-foreground uppercase tracking-wider"},{default:a(()=>[...t[25]||(t[25]=[u("Sample ID",-1)])]),_:1}),r(m,{class:"px-4 py-3 text-left text-xs font-medium text-muted-foreground uppercase tracking-wider"},{default:a(()=>[...t[26]||(t[26]=[u("Client Sample ID",-1)])]),_:1}),r(m,{class:"px-4 py-3 text-left text-xs font-medium text-muted-foreground uppercase tracking-wider"},{default:a(()=>[...t[27]||(t[27]=[u("Analysis",-1)])]),_:1}),r(m,{class:"px-4 py-3 text-left text-xs font-medium text-muted-foreground uppercase tracking-wider"},{default:a(()=>[...t[28]||(t[28]=[u("Result",-1)])]),_:1}),r(m,{class:"px-4 py-3 text-left text-xs font-medium text-muted-foreground uppercase tracking-wider"},{default:a(()=>[...t[29]||(t[29]=[u("Status",-1)])]),_:1})]),_:1})]),_:1}),r(R,{class:"[&_tr:last-child]:border-0"},{default:a(()=>[(i(!0),y(N,null,z(e.worksheet?.analysisResults,l=>(i(),c(h,{key:l.uid,class:ae(["border-b transition-colors",e.getResultRowColor(l)])},{default:a(()=>[r(p,{class:"px-4 py-3 whitespace-nowrap"},{default:a(()=>[r(B,{checked:l.checked,"onUpdate:checked":v=>l.checked=v,onClick:t[13]||(t[13]=v=>e.checkCheck()),disabled:e.isDisabledRowCheckBox(l)},null,8,["checked","onUpdate:checked","disabled"])]),_:2},1024),r(p,{class:"px-4 py-3 whitespace-nowrap"},{default:a(()=>[u(_(l.sample?.sampleId),1)]),_:2},1024),r(p,{class:"px-4 py-3 whitespace-nowrap"},{default:a(()=>[u(_(l.sample?.clientSampleId),1)]),_:2},1024),r(p,{class:"px-4 py-3 whitespace-nowrap"},{default:a(()=>[u(_(l.analysis?.name),1)]),_:2},1024),r(p,{class:"px-4 py-3 whitespace-nowrap"},{default:a(()=>[e.isEditable(l)?T((i(),y("input",{key:0,type:"text","onUpdate:modelValue":v=>l.result=v,class:"w-full px-2 py-1 border border-input rounded-md bg-background text-foreground focus:outline-none focus:ring-2 focus:ring-primary"},null,8,it)),[[Ce,l.result]]):(i(),y("span",dt,_(l.result),1))]),_:2},1024),r(p,{class:"px-4 py-3 whitespace-nowrap"},{default:a(()=>[d("span",{class:ae(["inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium",{"bg-primary/10 text-primary":l.status==="pending","bg-warning/10 text-warning":l.status==="awaiting","bg-success/10 text-success":l.status==="approved","bg-destructive/10 text-destructive":l.status==="retracted"}])},_(l.status),3)]),_:2},1024)]),_:2},1032,["class"]))),128))]),_:1})]),_:1})])])])}const Bt=P(Fe,[["render",ut],["__file","/home/administrator/Documents/Development/beak-insights/felicity/felicity-lims/webapp/views/worksheet/_id/WorkSheetResults.vue"]]);export{Bt as default};
