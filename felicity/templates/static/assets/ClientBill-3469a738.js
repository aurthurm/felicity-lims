import{W as _e,f as xe,ak as he,a2 as c,a3 as K,r as M,am as P,o as a,c as d,O as e,D as u,a7 as l,a as h,F as C,H as A,a5 as p,J as i,E as $,C as g,N as U,M as f,z as E,af as L,a4 as Ce,Z as S,L as R,a0 as ke,a1 as we,k as Te,_ as Be}from"./index-93739211.js";import{u as Ve,A as Ae,G as Ue,C as Se,d as De}from"./billing-7eb454fc.js";import{p as Ne}from"./index-0f6f1926.js";import{u as je}from"./bills-3b4d77d9.js";import{c as Fe,a as q,e as Ie,u as Me,f as O}from"./array-2f9882bb.js";const Pe={class:"space-y-6"},$e={class:"grid grid-cols-12 gap-6"},Ee={initial:{opacity:0,y:100},enter:{opacity:1,y:0,scale:1},variants:{custom:{scale:2}},delay:400,class:"col-span-3 overflow-y-auto overscroll-contain billing-scroll"},Le={key:0,class:"py-4 text-center bg-background w-full mb-2 rounded-lg shadow-sm border border-border"},Re={key:1},qe={class:"space-y-2"},Oe=["onClick"],We={class:"space-y-1"},Ye={class:"font-semibold text-foreground"},ze={class:"text-sm text-muted-foreground"},Ge={initial:{opacity:0,y:-100},enter:{opacity:1,y:0,scale:1},variants:{custom:{scale:2}},delay:400,class:"col-span-9 space-y-6"},He={class:"bg-background rounded-lg shadow-sm p-6 space-y-4"},Ke={class:"flex justify-between items-center"},Je={class:"text-lg font-semibold text-foreground"},Qe={class:"grid grid-cols-3 gap-8"},Ze={class:"space-y-4"},Xe={class:"flex justify-between items-center"},es={class:"text-sm text-foreground"},ss={class:"flex justify-between items-center"},ts={class:"text-sm text-foreground"},os={class:"space-y-4"},ns={class:"flex justify-between items-center"},as={class:"text-sm text-foreground"},ls={class:"flex justify-between items-center"},is={class:"text-sm text-foreground"},rs={class:"space-y-4"},ds={class:"flex justify-between items-center"},us={class:"text-sm text-foreground"},cs={class:"space-y-4"},fs={class:"flex justify-between items-center"},ms={class:"bg-background rounded-lg shadow-sm p-6 space-y-4"},ps={class:"font-semibold text-foreground"},gs={class:"text-muted-foreground"},vs={class:"ml-2 text-primary"},bs={class:"space-y-4"},ys={class:"flex justify-between items-center"},_s={class:"space-x-4"},xs={class:"bg-background rounded-lg shadow-sm p-6"},hs={class:"space-y-6 p-6"},Cs={class:"grid grid-cols-2 gap-6"},ks={class:"space-y-2"},ws=["disabled"],Ts=["value"],Bs={class:"text-sm text-destructive"},Vs={class:"space-y-2"},As=["disabled"],Us={class:"space-y-2"},Ss=["disabled"],Ds={class:"flex justify-end"},Ns={class:"space-y-6 p-6"},js={class:"text-lg font-medium text-foreground"},Fs={class:"space-y-2"},Is=["disabled"],Ms={class:"flex justify-end"},Ps={class:"space-y-6 p-6"},$s={class:"space-y-2"},Es=["disabled"],Ls={class:"flex justify-end"},Rs=_e({__name:"ClientBill",props:{clientUid:String},setup(J){const Q=ke(()=>we(()=>import("./FelDataTable-2f84e0fb.js"),["assets/FelDataTable-2f84e0fb.js","assets/index-93739211.js","assets/index-0f090789.css"])),W=J,{toastSuccess:Y}=Te(),{withClientMutation:D,withClientQuery:Z}=xe(),v=Ve(),{bills:z,fetchingBills:X,transactions:ee,fetchingTransactions:se}=he(v);v.fetchBillsForClient(W?.clientUid);const te=c(["cash","medical-aid","e-payment"]),k=c(!1),n=c({}),oe=o=>{n.value={...o},v.fetchBillTransactions(o.uid),ne(o.uid)},G=c([]),ne=async o=>{const s=await Z(Ue,{uid:o},"ordersByBillUid");G.value=s??[]};function ae(o,s){let _=[];return o.forEach(m=>_.push(m.name)),s.forEach(m=>_.push(m.name)),_.join(", ")}const le=Fe({testBillUid:q().required(),kind:q().required(),amount:Ie().required(),notes:q()}),{handleSubmit:ie,errors:b,setFieldValue:w}=Me({validationSchema:le,initialValues:{testBillUid:n.value?.uid}}),{value:T}=O("kind"),{value:N}=O("amount"),{value:j}=O("notes"),r=c(!1),re=ie(o=>{r.value=!0,ue(o)}),de=()=>{w("testBillUid",n.value?.uid),w("kind","cash"),w("amount",Math.ceil(Number((n?.value?.totalCharged-n?.value?.totalPaid).toFixed(2)))),w("notes",""),k.value=!0},ue=o=>{D(Ae,{payload:o},"createTestBillTransaction").then(s=>{v.addTransaction(s),r.value=!1,k.value=!1,Y("Transaction added.")})},B=c(!1),y=c({}),ce=()=>{r.value=!0,D(Se,{uid:y.value.uid,notes:y.value.notes},"confirmTestBillTransaction").then(o=>{v.updateTransaction(o),r.value=!1,B.value=!1,Y("Transaction confirmed.")})},fe=c([{name:"Kind",value:"kind",sortable:!0,sortBy:"asc",defaultSort:!0,showInToggler:!1,hidden:!1},{name:"Amount",value:"amount",sortable:!1,sortBy:"asc",hidden:!1},{name:"Success",value:"isSuccess",sortable:!1,sortBy:"asc",hidden:!1},{name:"Notes",value:"notes",sortable:!1,sortBy:"asc",hidden:!1},{name:"Message",value:"message",sortable:!1,sortBy:"asc",hidden:!1},{name:"Processed",value:"processed",sortable:!1,sortBy:"asc",hidden:!1,customRender:function(o,s){return K("span",{innerHTML:o.processed?"Yes":"Pending confirmation"},[])}},{name:"Action",sortable:!1,hidden:!1,customRender:(o,s)=>{if(!o.processed)return K("button",{onClick(){B.value=!0,y.value=o},type:"button",class:"bg-primary text-primary-foreground py-1 px-2 rounded-sm leading-none"},"confirm")}}]),F=c(!1),V=c({code:""}),me=()=>{F.value=!0},pe=()=>{r.value=!0,D(De,{payload:{voucherCode:V.value?.code,testBillUid:n.value?.uid,customerUid:W.clientUid}},"applyVoucher").then(o=>r.value=!1)},{downloadInvoice:ge}=je(),ve=async o=>await ge(o.uid);return(o,s)=>{const _=M("fel-loader"),m=M("fel-button"),I=M("fel-modal"),H=P("motion"),be=P("motion-slide-top"),ye=P("motion-slide-right");return a(),d(C,null,[e("div",Pe,[e("div",$e,[u((a(),d("section",Ee,[l(X)?(a(),d("div",Le,[h(_,{message:"Fetching bills ..."})])):(a(),d("div",Re,[e("ul",qe,[(a(!0),d(C,null,A(l(z),t=>(a(),d("li",{key:t.uid,class:p(["bg-background w-full p-3 rounded-lg shadow-sm border border-border transition-all duration-200 hover:shadow-md",{"border-primary bg-primary/5":t.uid===n.value.uid}]),onClick:x=>oe(t)},[e("div",We,[e("div",Ye," Bill "+i(t.billId?.toLocaleUpperCase()),1),e("div",ze,i(l(Ne)(t.createdAt)),1)])],10,Oe))),128))])]))])),[[H]]),u((a(),d("section",Ge,[u((a(),d("div",He,[e("div",Ke,[e("h4",Je,i(n.value.billId?.toLocaleUpperCase()),1)]),e("div",Qe,[e("div",Ze,[e("div",Xe,[s[9]||(s[9]=e("span",{class:"text-sm font-medium text-foreground"},"Active:",-1)),e("span",es,i(n.value.isActive?"Yes":"No"),1)]),e("div",ss,[s[10]||(s[10]=e("span",{class:"text-sm font-medium text-foreground"},"Confirmed:",-1)),e("span",ts,i(n.value?.toConfirm?"No":"Yes"),1)])]),e("div",os,[e("div",ns,[s[11]||(s[11]=e("span",{class:"text-sm font-medium text-foreground"},"Total Charged:",-1)),e("span",as,i(n.value?.totalCharged),1)]),e("div",ls,[s[12]||(s[12]=e("span",{class:"text-sm font-medium text-foreground"},"Total Paid:",-1)),e("span",is,i(n.value?.totalPaid),1)])]),e("div",rs,[e("div",ds,[s[13]||(s[13]=e("span",{class:"text-sm font-medium text-foreground"},"Partial:",-1)),e("span",us,i(n.value?.totalPaid<n.value?.totalCharged?"Yes":"No"),1)])])])])),[[be]]),e("div",cs,[e("div",fs,[s[14]||(s[14]=e("h4",{class:"text-lg font-semibold text-foreground"},"Order Items",-1)),e("button",{class:"px-4 py-2 bg-primary text-primary-foreground rounded-md hover:bg-primary/90 transition-colors duration-200 focus:outline-none focus:ring-2 focus:ring-primary/50",onClick:s[0]||(s[0]=g(t=>ve(n.value),["prevent"]))}," Invoice ")]),e("ul",ms,[(a(!0),d(C,null,A(G.value,t=>(a(),d("li",{class:"space-y-2",key:t.uid},[e("div",ps,i(t?.requestId)+" ("+i(t?.clientRequestId)+")",1),(a(!0),d(C,null,A(t.samples,x=>u((a(),d("div",{class:"space-y-1 pl-4",key:x.uid},[e("span",gs,i(x.sampleId),1),s[15]||(s[15]=U(" â‡’ ")),e("span",vs,i(ae(x.profiles??[],x.analyses??[])),1)])),[[ye]])),128))]))),128))])]),e("div",bs,[e("div",ys,[s[16]||(s[16]=e("h4",{class:"text-lg font-semibold text-foreground"},"Transactions",-1)),e("div",_s,[u(e("button",{class:"px-4 py-2 bg-primary text-primary-foreground rounded-md hover:bg-primary/90 transition-colors duration-200 focus:outline-none focus:ring-2 focus:ring-primary/50",onClick:g(de,["prevent"])}," Add Transaction ",512),[[$,n.value.isActive]]),u(e("button",{class:"px-4 py-2 bg-primary text-primary-foreground rounded-md hover:bg-primary/90 transition-colors duration-200 focus:outline-none focus:ring-2 focus:ring-primary/50",onClick:g(me,["prevent"])}," Apply Voucher ",512),[[$,n.value.isActive]])])]),e("div",xs,[h(l(Q),{columns:fe.value,data:l(ee),toggleColumns:!1,loading:l(se),paginable:!1,searchable:!1,filterable:!1,selectable:!1},{footer:f(()=>s[17]||(s[17]=[])),_:1},8,["columns","data","loading"])])])])),[[$,l(z)?.length>0&&n.value.uid],[H]])])]),k.value?(a(),E(I,{key:0,onClose:s[4]||(s[4]=t=>k.value=!1),contentWidth:"w-3/6",class:"bg-background"},{header:f(()=>s[18]||(s[18]=[e("h3",{class:"text-xl font-semibold text-foreground"},"Transaction Form",-1)])),body:f(()=>[e("form",hs,[e("div",Cs,[e("label",ks,[s[20]||(s[20]=e("span",{class:"text-sm font-medium text-foreground"},"Kind of payment",-1)),u(e("select",{class:p(["w-full rounded-md border border-input bg-background px-3 py-2 text-sm ring-offset-background focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2",{"border-destructive":l(b).kind}]),"onUpdate:modelValue":s[1]||(s[1]=t=>L(T)?T.value=t:null),disabled:r.value},[s[19]||(s[19]=e("option",null,null,-1)),(a(!0),d(C,null,A(te.value,t=>(a(),d("option",{key:t,value:t},i(t),9,Ts))),128))],10,ws),[[Ce,l(T)]]),e("div",Bs,i(l(b).gender),1)]),e("label",Vs,[s[21]||(s[21]=e("span",{class:"text-sm font-medium text-foreground"},"Amount",-1)),u(e("input",{class:p(["w-full rounded-md border border-input bg-background px-3 py-2 text-sm ring-offset-background focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2",{"border-destructive":l(b).amount}]),type:"number","onUpdate:modelValue":s[2]||(s[2]=t=>L(N)?N.value=t:null),disabled:r.value},null,10,As),[[S,l(N)]])])]),e("label",Us,[s[22]||(s[22]=e("span",{class:"text-sm font-medium text-foreground"},"Notes",-1)),u(e("input",{class:p(["w-full rounded-md border border-input bg-background px-3 py-2 text-sm ring-offset-background focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2",{"border-destructive":l(b).notes}]),"onUpdate:modelValue":s[3]||(s[3]=t=>L(j)?j.value=t:null),disabled:r.value},null,10,Ss),[[S,l(j)]])]),e("div",Ds,[h(m,{color:"primary",type:"submit",loading:r.value,onClick:g(l(re),["prevent"])},{default:f(()=>s[23]||(s[23]=[U(" Save Transaction ")])),_:1},8,["loading","onClick"])])])]),_:1})):R("",!0),B.value?(a(),E(I,{key:1,onClose:s[6]||(s[6]=t=>B.value=!1),contentWidth:"w-3/6",class:"bg-background"},{header:f(()=>s[24]||(s[24]=[e("h3",{class:"text-xl font-semibold text-foreground"},"Confirm Transaction",-1)])),body:f(()=>[e("form",Ns,[e("h4",js,i(l(T))+" Transaction",1),e("label",Fs,[s[25]||(s[25]=e("span",{class:"text-sm font-medium text-foreground"},"Notes",-1)),u(e("input",{class:p(["w-full rounded-md border border-input bg-background px-3 py-2 text-sm ring-offset-background focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2",{"border-destructive":l(b).notes}]),"onUpdate:modelValue":s[5]||(s[5]=t=>y.value.notes=t),disabled:r.value},null,10,Is),[[S,y.value.notes]])]),e("div",Ms,[h(m,{color:"primary",type:"submit",loading:r.value,onClick:g(ce,["prevent"])},{default:f(()=>s[26]||(s[26]=[U(" Confirm Transaction ")])),_:1},8,["loading"])])])]),_:1})):R("",!0),F.value?(a(),E(I,{key:2,onClose:s[8]||(s[8]=t=>F.value=!1),contentWidth:"w-1/5",class:"bg-background"},{header:f(()=>s[27]||(s[27]=[e("h3",{class:"text-xl font-semibold text-foreground"},"Apply Voucher Code",-1)])),body:f(()=>[e("form",Ps,[e("label",$s,[s[28]||(s[28]=e("span",{class:"text-sm font-medium text-foreground"},"Voucher Code",-1)),u(e("input",{class:p(["w-full rounded-md border border-input bg-background px-3 py-2 text-sm ring-offset-background focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2",{"border-destructive":!V.value.code}]),type:"text","onUpdate:modelValue":s[7]||(s[7]=t=>V.value.code=t),disabled:r.value},null,10,Es),[[S,V.value.code]])]),e("div",Ls,[h(m,{color:"primary",type:"submit",loading:r.value,onClick:g(pe,["prevent"])},{default:f(()=>s[29]||(s[29]=[U(" Apply Voucher ")])),_:1},8,["loading"])])])]),_:1})):R("",!0)],64)}}});const Gs=Be(Rs,[["__scopeId","data-v-5aba8362"],["__file","/home/aurthurm/Documents/Development/felicity/felicity-lims/webapp/views/client/_id/ClientBill.vue"]]);export{Gs as default};
