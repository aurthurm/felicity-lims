import{I as se,S as Z,d as Ce,R as Te,s as ee,r as _,p as Be,at as te,x as O,o as i,c as r,b as e,e as u,f as o,g as B,F as A,C as F,G as b,t as d,az as Ae,L as Y,w as y,A as E,z as m,y as z,i as W,ad as Ie,v as N,B as H,j as R,_ as L,ab as Ve,D as Se,E as Pe,k as De}from"./index-ad4ed84b.js";import{I as Ue,u as Fe,A as Ee,C as Ne,a as Re}from"./billing-79a21361.js";import{c as Le,a as K,d as Me,u as je,b as G}from"./array-94e46a26.js";function $e(){const{withClientQuery:p}=se();return{downloadInvoice:async x=>{try{await Z.fire({title:"Are you sure?",text:"You want to download this invoice",icon:"warning",showCancelButton:!0,confirmButtonColor:"#3085d6",cancelButtonColor:"#d33",confirmButtonText:"Yes, download now!",cancelButtonText:"No, do not download!"}).then(async h=>{h.isConfirmed&&(p(Ue,{billUid:x},"billInvoiceCreate","network-only").then(I=>{const v=document.createElement("a");v.href=`data:application/pdf;base64,${I}`,v.setAttribute("download","invoice-report.pdf"),v.click()}),await Z.fire("Its Happening!","Downloading .....","success").then(I=>{}))})}catch{}}}}const a=p=>(Se("data-v-afb0e1b5"),p=p(),Pe(),p),qe={class:"mt-4"},Oe=a(()=>e("h4",{class:"text-sm text-gray-800 font-bold"},"Patient's Order Bills",-1)),Ye=a(()=>e("hr",null,null,-1)),ze={class:"grid grid-cols-12 gap-4 mt-2"},We={initial:{opacity:0,y:100},enter:{opacity:1,y:0,scale:1},variants:{custom:{scale:2}},delay:400,class:"col-span-3 overflow-y-scroll overscroll-contain billing-scroll"},He={key:0,class:"py-4 text-center bg-white w-full mb-1 rounded-sm shadow border"},Ke={key:1},Ge=["onClick"],Qe={class:"flex-grow p-1"},Je={class:"font-semibold text-gray-800"},Xe={class:"text-sm text-gray-400"},Ze={initial:{opacity:0,y:-100},enter:{opacity:1,y:0,scale:1},variants:{custom:{scale:2}},delay:400,class:"col-span-9"},et={class:"bg-white rounded-sm shadow-sm hover:shadow-xs duration-500 px-4 sm:px-6 md:px-2 py-4"},tt={class:"flex justify-between items-center"},st={class:"text-gray-800 text-l font-bold"},ot=a(()=>e("hr",null,null,-1)),at={class:"grid grid-cols-3 gap-x-8"},nt={class:"col-span-1"},lt={class:"flex justify-between items-center mt-2"},it=a(()=>e("span",{class:"text-gray-800 text-sm font-semibold"},"Active:",-1)),dt={class:"text-gray-600 text-sm md:text-md"},ct={class:"flex justify-between items-center mt-2"},rt=a(()=>e("span",{class:"text-gray-800 text-sm font-semibold"},"Confirmed:",-1)),ut={class:"text-gray-600 text-sm md:text-md"},mt={class:"col-span-1"},_t={class:"flex justify-between items-center mt-2"},pt=a(()=>e("span",{class:"text-gray-800 text-sm font-semibold"},"Total Charged:",-1)),ht={class:"text-gray-600 text-sm md:text-md"},vt={class:"flex justify-between items-center mt-2"},ft=a(()=>e("span",{class:"text-gray-800 text-sm font-semibold"},"Total Paid:",-1)),bt={class:"text-gray-600 text-sm md:text-md"},yt={class:"col-span-1"},xt={class:"flex justify-between items-center mt-2"},gt=a(()=>e("span",{class:"text-gray-800 text-sm font-semibold"},"Partial:",-1)),wt={class:"text-gray-600 text-sm md:text-md"},kt={class:"mt-4"},Ct={class:"flex justify-between items-center"},Tt=a(()=>e("h4",{class:"text-gray-800 text-l font-semibold"},"Order Items",-1)),Bt=a(()=>e("hr",null,null,-1)),At={class:"mt-4 bg-white rounded-sm shadow-sm hover:shadow-xs duration-500 px-4 sm:px-6 md:px-2 py-4"},It={class:"text-gray-400"},Vt={class:"ml-2 text-md leading-5 text-sky-600"},St={class:"mt-4"},Pt={class:"flex justify-between items-center"},Dt=a(()=>e("h4",{class:"text-gray-800 text-l font-semibold"},"Transactions",-1)),Ut=a(()=>e("hr",null,null,-1)),Ft={class:"mt-4 bg-white rounded-sm shadow-sm hover:shadow-xs duration-500 px-4 sm:px-6 md:px-2 py-4"},Et=a(()=>e("h3",null,"Transaction Form",-1)),Nt={class:"grid grid-cols-2 gap-x-4 mb-4"},Rt={class:"whitespace-nowrap mb-2 w-full"},Lt=a(()=>e("span",{class:"text-gray-700 w-4/12"},"Kind of payment",-1)),Mt={class:"w-full"},jt=["disabled"],$t=a(()=>e("option",null,null,-1)),qt=["value"],Ot={class:"text-orange-600 w-4/12"},Yt={class:"block col-span-1 mb-2"},zt=a(()=>e("span",{class:"text-gray-700"},"Amount",-1)),Wt=["disabled"],Ht={class:"grid grid-cols-4 gap-x-4 mb-4"},Kt={class:"block col-span-4 mb-2"},Gt=a(()=>e("span",{class:"text-gray-700"},"Notes",-1)),Qt=["disabled"],Jt=a(()=>e("hr",{class:"mb-4"},null,-1)),Xt=a(()=>e("h3",null,"Confirm Tranaction",-1)),Zt={class:"grid grid-cols-4 gap-x-4 mb-4"},es={class:"block col-span-4 mb-2"},ts=a(()=>e("span",{class:"text-gray-700"},"Notes",-1)),ss=["disabled"],os=a(()=>e("hr",{class:"mb-4"},null,-1)),as=a(()=>e("h3",null,"Apply Voucher Code Form",-1)),ns={class:"grid grid-cols-2 gap-x-4 mb-4"},ls={class:"block col-span-2 mb-2"},is=a(()=>e("span",{class:"text-gray-700"},"Voucher Code:",-1)),ds=["disabled"],cs=a(()=>e("hr",{class:"mb-4"},null,-1)),rs=Ce({__name:"PatientBill",props:{patientUid:String},setup(p){const Q=R(()=>L(()=>import("./FelLoadingMessage-b442db31.js"),["assets/FelLoadingMessage-b442db31.js","assets/index-ad4ed84b.js","assets/index-3e01f4af.css"])),x=R(()=>L(()=>import("./FelModal-fa927fb9.js"),["assets/FelModal-fa927fb9.js","assets/index-ad4ed84b.js","assets/index-3e01f4af.css","assets/FelModal-780aeea9.css"])),h=R(()=>L(()=>import("./FelButton-1eb0dadd.js"),["assets/FelButton-1eb0dadd.js","assets/index-ad4ed84b.js","assets/index-3e01f4af.css"])),I=R(()=>L(()=>import("./FelDataTable-a0186d70.js"),["assets/FelDataTable-a0186d70.js","assets/index-ad4ed84b.js","assets/index-3e01f4af.css"])),v=p,{toastSuccess:J}=Ve(),{withClientMutation:M}=se(),g=Fe(),oe=Te(),{bills:X,fetchingBills:ae,transactions:ne,fetchingTransactions:le}=ee(g),{analysisRequests:ie}=ee(oe);g.fetchBillsForPatient(v?.patientUid);const de=_(["cash","medical-aid","e-payment"]),V=_(!1),l=_({}),ce=n=>{l.value={...n},g.fetchBillTransactions(n.uid)},re=Be(()=>{const n=l?.value?.orders?.map(t=>t.uid)??[];return ie?.value?.filter(t=>n.includes(t.uid))});function ue(n,t){let f=[];return n.forEach(C=>f.push(C.name)),t.forEach(C=>f.push(C.name)),f.join(", ")}const me=Le({testBillUid:K().required(),kind:K().required(),amount:Me().required(),notes:K()}),{handleSubmit:_e,errors:w,setFieldValue:S}=je({validationSchema:me,initialValues:{testBillUid:l.value?.uid}}),{value:P}=G("kind"),{value:j}=G("amount"),{value:$}=G("notes"),c=_(!1),pe=_e(n=>{c.value=!0,ve(n)}),he=()=>{S("testBillUid",l.value?.uid),S("kind","cash"),S("amount",Math.ceil(Number((l?.value?.totalCharged-l?.value?.totalPaid).toFixed(2)))),S("notes",""),V.value=!0},ve=n=>{M(Ee,{payload:n},"createTestBillTransaction").then(t=>{g.addTransaction(t),c.value=!1,V.value=!1,J("Transaction added.")})},D=_(!1),k=_({}),fe=()=>{c.value=!0,M(Ne,{uid:k.value.uid,notes:k.value.notes},"confirmTestBillTransaction").then(n=>{g.updateTransaction(n),c.value=!1,D.value=!1,J("Transaction confirmed.")})},be=_([{name:"Kind",value:"kind",sortable:!0,sortBy:"asc",defaultSort:!0,showInToggler:!1,hidden:!1},{name:"Amount",value:"amount",sortable:!1,sortBy:"asc",hidden:!1},{name:"Success",value:"isSuccess",sortable:!1,sortBy:"asc",hidden:!1},{name:"Notes",value:"notes",sortable:!1,sortBy:"asc",hidden:!1},{name:"Message",value:"message",sortable:!1,sortBy:"asc",hidden:!1},{name:"Processed",value:"processed",sortable:!1,sortBy:"asc",hidden:!1,customRender:function(n,t){return te("span",{innerHTML:n.processed?"Yes":"Pending confirmation"},[])}},{name:"Action",sortable:!1,hidden:!1,customRender:(n,t)=>{if(!n.processed)return te("button",{onClick(){D.value=!0,k.value=n},type:"button",class:"bg-sky-800 text-white py-1 px-2 rounded-sm leading-none"},"confirm")}}]),q=_(!1),U=_({code:""}),ye=()=>{q.value=!0},xe=()=>{c.value=!0,M(Re,{payload:{voucherCode:U.value?.code,testBillUid:l.value?.uid,customerUid:v.patientUid}},"applyVoucher").then(n=>c.value=!1)},{downloadInvoice:ge}=$e(),we=async n=>await ge(n.uid);return(n,t)=>{const f=O("motion"),C=O("motion-slide-top"),ke=O("motion-slide-right");return i(),r(A,null,[e("div",qe,[Oe,Ye,e("div",ze,[u((i(),r("section",We,[o(ae)?(i(),r("div",He,[B(o(Q),{message:"Fetching bills ..."})])):(i(),r("div",Ke,[e("ul",null,[(i(!0),r(A,null,F(o(X),s=>(i(),r("li",{key:s.uid,class:b(["bg-white w-full flex items-center p-1 mb-1 rounded-sm shadow border",{"border-sky-800 bg-emerald-200":s.uid===l.value.uid}]),onClick:T=>ce(s)},[e("div",Qe,[e("div",Je,[e("div",null,d(s.billId?.toLocaleUpperCase()),1),e("div",Xe,d(o(Ae)(s.createdAt)),1)])])],10,Ge))),128))])]))])),[[f]]),u((i(),r("section",Ze,[u((i(),r("div",et,[e("div",tt,[e("h4",st,d(l.value.billId?.toLocaleUpperCase()),1)]),ot,e("section",at,[e("div",nt,[e("div",lt,[it,e("span",dt,d(l.value.isActive?"Yes":"No"),1)]),e("div",ct,[rt,e("span",ut,d(l.value?.toConfirm?"No":"Yes"),1)])]),e("div",mt,[e("div",_t,[pt,e("span",ht,d(l.value?.totalCharged),1)]),e("div",vt,[ft,e("span",bt,d(l.value?.totalPaid),1)])]),e("div",yt,[e("div",xt,[gt,e("span",wt,d(l.value?.totalPaid<l.value?.totalCharged?"Yes":"No"),1)])])])])),[[C]]),e("div",kt,[e("div",Ct,[Tt,e("button",{class:"ml-4 px-2 py-1 mr-2 border-sky-800 border text-sky-800 rounded-sm transition duration-300 hover:bg-sky-800 hover:text-white focus:outline-none",onClick:t[0]||(t[0]=y(s=>we(l.value),["prevent"]))}," Invoice ")]),Bt,e("ul",At,[(i(!0),r(A,null,F(re.value,s=>(i(),r("li",{class:"font-semibold",key:s.uid},[e("div",null,d(s?.requestId)+" ("+d(s?.clientRequestId)+")",1),(i(!0),r(A,null,F(s.samples,T=>u((i(),r("div",{class:"ml-4 text-sm",key:T.uid},[e("span",It,d(T.sampleId),1),E(" â‡’ "),e("span",Vt,d(ue(T.profiles??[],T.analyses??[])),1)])),[[ke]])),128))]))),128))])]),e("div",St,[e("div",Pt,[Dt,e("div",null,[u(e("button",{class:"px-2 py-1 mr-2 border-sky-800 border text-sky-800 rounded-sm transition duration-300 hover:bg-sky-800 hover:text-white focus:outline-none",onClick:y(he,["prevent"])}," Add Transaction ",512),[[Y,l.value.isActive]]),u(e("button",{class:"ml-4 px-2 py-1 mr-2 border-sky-800 border text-sky-800 rounded-sm transition duration-300 hover:bg-sky-800 hover:text-white focus:outline-none",onClick:y(ye,["prevent"])}," Apply Voucher ",512),[[Y,l.value.isActive]])])]),Ut,e("div",Ft,[B(o(I),{columns:be.value,data:o(ne),toggleColumns:!1,loading:o(le),paginable:!1,searchable:!1,filterable:!1,selectable:!1},{footer:m(()=>[]),_:1},8,["columns","data","loading"])])])])),[[Y,o(X)?.length>0&&l.value.uid],[f]])])]),V.value?(i(),z(o(x),{key:0,onClose:t[4]||(t[4]=s=>V.value=!1),contentWidth:"w-3/6"},{header:m(()=>[Et]),body:m(()=>[e("form",null,[e("div",Nt,[e("label",Rt,[Lt,e("div",Mt,[u(e("select",{class:b(["form-select mt-1 w-full",{"border-red-500 animate-pulse":o(w).kind}]),"onUpdate:modelValue":t[1]||(t[1]=s=>W(P)?P.value=s:null),disabled:c.value},[$t,(i(!0),r(A,null,F(de.value,s=>(i(),r("option",{key:s,value:s},d(s),9,qt))),128))],10,jt),[[Ie,o(P)]]),e("div",Ot,d(o(w).gender),1)])]),e("label",Yt,[zt,u(e("input",{class:b(["form-input mt-1 block w-full",{"border-red-500 animate-pulse":o(w).amount}]),type:"number","onUpdate:modelValue":t[2]||(t[2]=s=>W(j)?j.value=s:null),disabled:c.value},null,10,Wt),[[N,o(j)]])])]),e("div",Ht,[e("label",Kt,[Gt,u(e("input",{class:b(["form-input mt-1 block w-full",{"border-red-500 animate-pulse":o(w).notes}]),"onUpdate:modelValue":t[3]||(t[3]=s=>W($)?$.value=s:null),disabled:c.value},null,10,Qt),[[N,o($)]])])]),Jt,B(o(h),{color:"sky-800",type:"submit",loading:c.value,onClick:y(o(pe),["prevent"])},{default:m(()=>[E(" Save Transaction ")]),_:1},8,["loading","onClick"])])]),_:1})):H("",!0),D.value?(i(),z(o(x),{key:1,onClose:t[6]||(t[6]=s=>D.value=!1),contentWidth:"w-3/6"},{header:m(()=>[Xt]),body:m(()=>[e("form",null,[e("h4",null,d(o(P))+" Transaction ",1),e("div",Zt,[e("label",es,[ts,u(e("input",{class:b(["form-input mt-1 block w-full",{"border-red-500 animate-pulse":o(w).notes}]),"onUpdate:modelValue":t[5]||(t[5]=s=>k.value.notes=s),disabled:c.value},null,10,ss),[[N,k.value.notes]])])]),os,B(o(h),{color:"sky-800",type:"submit",loading:c.value,onClick:y(fe,["prevent"])},{default:m(()=>[E(" Confirm Transaction ")]),_:1},8,["loading"])])]),_:1})):H("",!0),q.value?(i(),z(o(x),{key:2,onClose:t[8]||(t[8]=s=>q.value=!1),contentWidth:"w-1/5"},{header:m(()=>[as]),body:m(()=>[e("form",null,[e("div",ns,[e("label",ls,[is,u(e("input",{class:b(["form-input mt-1 block w-full",{"border-red-500 animate-pulse":!U.value.code}]),type:"text","onUpdate:modelValue":t[7]||(t[7]=s=>U.value.code=s),disabled:c.value},null,10,ds),[[N,U.value.code]])])]),cs,B(o(h),{color:"sky-800",type:"submit",loading:c.value,onClick:y(xe,["prevent"])},{default:m(()=>[E(" Apply Voucher ")]),_:1},8,["loading"])])]),_:1})):H("",!0)],64)}}});const ps=De(rs,[["__scopeId","data-v-afb0e1b5"],["__file","/home/aurthurm/Documents/Development/felicity/felicity-lims/webapp/views/patient/_id/PatientBill.vue"]]);export{ps as default};
