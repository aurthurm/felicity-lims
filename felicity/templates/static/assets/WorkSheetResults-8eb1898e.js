import{S as Y,c3 as Re,N as Se,d as Ee,ar as Ae,L as Ve,aL as Te,O as De,u as We,r as c,y as Ne,x as Be,n as Ie,A as z,o as a,c as l,e as i,g as G,f as d,i as Q,b as t,F as m,G as h,t as r,at as k,C as X,D as j,w as y,Q as _,au as Z,J as ee,E as te,B as Oe,v as $e,j as se,_ as oe,aS as Pe,k as je}from"./index-ab5e4518.js";import{u as Ke}from"./analysis-c9142366.js";import{h as U,o as C,a as R}from"./constants-b3336749.js";function Me(){const{withClientMutation:K}=Se();return{unAssignSamples:async D=>{try{Y.fire({title:"Are you sure?",text:"You want to Un-Assign these analyses",icon:"warning",showCancelButton:!0,confirmButtonColor:"#3085d6",cancelButtonColor:"#d33",confirmButtonText:"Yes, Un-Assign now!",cancelButtonText:"No, cancel UnAssign!"}).then(async g=>{g.isConfirmed&&(await K(Re,D,"updateWorksheet").then(p=>{}),Y.fire("Its Happening!","Selected analyses have been UnAssigned.","success").then(p=>location.reload()))})}catch{}}}}const qe={class:""},He=t("hr",{class:"mt-4"},null,-1),Le={class:"flex justify-between items-center"},Fe={action:"post",class:"p-1"},Je={class:"flex justify-start items-center mb-4"},Ye={class:"flex justify-between items-center"},ze=t("span",{class:"text-gray-700 mr-2"},"Analyst",-1),Ge=["value"],Qe={class:"flex justify-between items-center ml-4"},Xe=t("span",{class:"text-gray-700 mr-2"},"Instrument",-1),Ze=["value"],et={class:"flex justify-between items-center ml-4"},tt=t("span",{class:"text-gray-700 mr-2"},"Method",-1),st=["value"],ot={class:"ml-6 mt-2"},nt=t("hr",{class:"mb-4"},null,-1),at={class:"overflow-x-auto"},lt={class:"align-middle inline-block min-w-full shadow overflow-hidden bg-white shadow-dashboard px-2 pt-1 rounded-bl-lg rounded-br-lg"},rt={class:"min-w-full"},it={class:"px-1 py-1 border-b-2 border-gray-300 text-left leading-4 text-gray-800 tracking-wider"},dt=t("th",{class:"px-1 py-1 border-b-2 border-gray-300 text-left leading-4 text-gray-800 tracking-wider"},null,-1),ut=t("th",{class:"px-1 py-1 border-b-2 border-gray-300 text-left leading-4 text-gray-800 tracking-wider"}," Sample ID ",-1),ct=t("th",{class:"px-1 py-1 border-b-2 border-gray-300 text-left text-sm leading-4 text-gray-800 tracking-wider"}," Analysis/Test ",-1),pt=t("th",{class:"px-1 py-1 border-b-2 border-gray-300 text-left text-sm leading-4 text-gray-800 tracking-wider"}," Instrument ",-1),mt=t("th",{class:"px-1 py-1 border-b-2 border-gray-300 text-left text-sm leading-4 text-gray-800 tracking-wider"}," Method ",-1),ht=t("th",{class:"px-1 py-1 border-b-2 border-gray-300 text-left text-sm leading-4 text-gray-800 tracking-wider"}," Interim ",-1),yt=t("th",{class:"px-1 py-1 border-b-2 border-gray-300 text-left text-sm leading-4 text-gray-800 tracking-wider"}," Result ",-1),_t=t("th",{class:"px-1 py-1 border-b-2 border-gray-300 text-left text-sm leading-4 text-gray-800 tracking-wider"}," Unit ",-1),bt=t("th",{class:"px-1 py-1 border-b-2 border-gray-300 text-left text-sm leading-4 text-gray-800 tracking-wider"}," Status ",-1),ft={class:"bg-white"},vt=["onUpdate:modelValue","disabled"],kt={class:"px-1 py-1 whitespace-no-wrap border-b border-gray-500"},gt=t("i",{class:"fa fa-star"},null,-1),xt=[gt],wt={class:"px-1 py-1 whitespace-no-wrap border-b border-gray-500"},Ut={class:"text-sm leading-5 text-gray-800 font-semibold"},Ct={key:1},Rt={key:0},St={class:"px-1 py-1 whitespace-no-wrap border-b border-gray-500"},Et={class:"px-1 py-1 whitespace-no-wrap border-b border-gray-500"},At={key:0,class:"text-sm leading-5 text-sky-800"},Vt={key:1,class:"block col-span-2 mb-2"},Tt=["onUpdate:modelValue","onChange"],Dt=t("option",{value:""},null,-1),Wt=["value"],Nt={class:"flex justify-start items-center gap-x-1"},Bt={class:"text-xs font-thin text-gray-300"},It={class:"px-1 py-1 whitespace-no-wrap border-b border-gray-500"},Ot={key:0,class:"text-sm leading-5 text-sky-800"},$t={key:1,class:"block col-span-2 mb-2"},Pt=["onUpdate:modelValue","onChange"],jt=t("option",{value:""},null,-1),Kt=["value"],Mt={class:"px-1 py-1 whitespace-no-wrap border-b border-gray-500"},qt={key:0,class:"text-sm leading-5 text-sky-800"},Ht={key:1,class:"block col-span-2 mb-2"},Lt=["onUpdate:modelValue","onChange"],Ft=t("option",{value:""},null,-1),Jt=["value"],Yt={class:"px-1 py-1 whitespace-no-wrap border-b border-gray-500"},zt={key:0},Gt={key:1,class:"block"},Qt=["onUpdate:modelValue","onKeyup"],Xt={key:2,class:"block col-span-2 mb-2"},Zt=["onUpdate:modelValue","onChange"],es=t("option",{value:""},null,-1),ts=["value"],ss={class:"px-1 py-1 whitespace-no-wrap border-b border-gray-500"},os={class:"px-1 py-1 whitespace-no-wrap border-b border-gray-500"},ns={type:"button",class:"bg-sky-800 text-white py-1 px-2 rounded-sm leading-none"},as={class:"my-4"},ls=Ee({__name:"WorkSheetResults",setup(K){const M=se(()=>oe(()=>import("./FelButton-543442b4.js"),["assets/FelButton-543442b4.js","assets/index-ab5e4518.js","assets/index-571501ec.css"])),D=se(()=>oe(()=>import("./FelSwitch-b8349612.js"),["assets/FelSwitch-b8349612.js","assets/index-ab5e4518.js","assets/index-571501ec.css"])),g=Ae(),p=Ve(),q=Te(),H=De(),ne=We();let W=c(!1),N=c(!1),B=c(!1),I=c(!1),O=c(!1),$=c(!1),b=c(!1),w=c(!1),f=Ne(()=>g.getWorkSheet);const L=()=>{g.fetchWorksheetByUid(H.params.workSheetUid)};q.fetchUsers({}),p.fetchLaboratoryInstruments(),p.fetchMethods();const v=Be({analystUid:void 0,instrumentUid:void 0,methodUid:void 0}),S=c(!1),ae=()=>{S.value=!0,g.updateWorksheet({worksheetUid:H.params.workSheetUid,...v}).then(()=>{S.value=!1,L()})};function le(){return f.value?.analysisResults?.every(o=>o.checked===!0)}function E(){let o=[];return f.value?.analysisResults?.forEach(s=>{s.checked&&o.push(s)}),o}function re(){le()?b.value=!0:b.value=!1,T()}function x(o){if(F(o)){J(o);return}o.checked=!0,T()}function F(o){return["retracted","approved"].includes(o.status)}function J(o){o.checked=!1,T()}function ie(){f?.value?.analysisResults?.forEach(o=>b.value?x(o):J(o)),T()}function de(o){o.editable=!0}function A(o){return o.status!=="pending"?!1:o?.editable||Pe(o?.result)?(de(o),!0):!1}function ue(){let o=E(),s=[];return o?.forEach(u=>s.push({uid:u.uid,result:u.result,laboratoryInstrumentUid:u.laboratoryInstrumentUid,methodUid:u.methodUid})),s}function V(){const o=E();let s=[];return o?.forEach(u=>s.push(u.uid)),s}function ce(){const o=E();console.log(o);let s=[];return o?.forEach(u=>s.push(u.sample?.uid)),console.log(s),s}function pe(o){switch(o?.status){case"retracted":return"bg-gray-300 text-sm italic text-gray-500";default:return"text-sm leading-5 text-sky-800"}}function T(){W.value=!1,O.value=!1,N.value=!1,B.value=!1,I.value=!1,$.value=!1;const o=E();o.length!==0&&($.value=!0,o.every(s=>s.status==="pending")&&(W.value=!0,O.value=!0),o.every(s=>s.status==="resulted")&&(N.value=!0,B.value=!0,I.value=!0))}const{submitResults:me,approveResults:he,retractResults:ye,retestResults:_e}=Ke(),{unAssignSamples:be}=Me(),fe=()=>be(V()),ve=()=>me(ue(),"worksheet",f.value?.uid),ke=()=>he(V(),"worksheet",f.value?.uid),ge=()=>ye(V()),xe=()=>_e(V()),we=async()=>{window.open(ne.resolve({name:"print-barcodes",query:{sampleUids:JSON.stringify(ce().join(","))}}).href,"_blank")};return(o,s)=>{const u=Ie("router-link"),Ue=z("motion-slide-left"),Ce=z("motion-slide-right");return a(),l("div",qe,[He,i((a(),l("div",Le,[G(d(D),{modelValue:d(w),"onUpdate:modelValue":s[0]||(s[0]=e=>Q(w)?w.value=e:w=e),label:"More Sample Detail"},null,8,["modelValue"]),i(t("form",Fe,[t("div",Je,[t("label",Ye,[ze,i(t("select",{name:"instrument_uid","onUpdate:modelValue":s[1]||(s[1]=e=>v.analystUid=e),class:"form-input mt-1 block w-full py-1"},[(a(!0),l(m,null,h(d(q).users,e=>(a(),l("option",{key:e.uid,value:e.uid},r(e.firstName)+" "+r(e.lastName),9,Ge))),128))],512),[[k,v.analystUid]])]),t("label",Qe,[Xe,i(t("select",{name:"instrument_uid","onUpdate:modelValue":s[2]||(s[2]=e=>v.instrumentUid=e),class:"form-input mt-1 block w-full py-1"},[(a(!0),l(m,null,h(d(p).laboratoryInstruments,e=>(a(),l("option",{key:e.uid,value:e.uid},r(e?.instrument.name)+": ("+r(e?.labName)+") ",9,Ze))),128))],512),[[k,v.instrumentUid]])]),t("label",et,[tt,i(t("select",{name:"method_uid","onUpdate:modelValue":s[3]||(s[3]=e=>v.methodUid=e),class:"form-input mt-1 block w-full py-1"},[(a(!0),l(m,null,h(d(p).methods,e=>(a(),l("option",{key:e.uid,value:e.uid},r(e.name),9,st))),128))],512),[[k,v.methodUid]])]),t("div",ot,[G(d(M),{onClick:s[4]||(s[4]=y(e=>ae(),["prevent"])),color:"sky-800",class:"p-1"},{default:X(()=>[j("Apply")]),_:1})])])],512),[[_,!S.value]]),i(t("p",null,"updating ...",512),[[_,S.value]]),t("div",null,[t("button",{onClick:s[5]||(s[5]=y(e=>L(),["prevent"])),class:"px-1 py-1 mr-2 border-sky-800 border text-sky-800 rounded-sm transition duration-300 hover:bg-sky-800 hover:text-white focus:outline-none"}," Refresh ")])])),[[Ue]]),nt,t("div",at,[t("div",lt,[t("table",rt,[t("thead",null,[t("tr",null,[t("th",it,[i(t("input",{type:"checkbox",class:"",onChange:s[6]||(s[6]=e=>ie()),"onUpdate:modelValue":s[7]||(s[7]=e=>Q(b)?b.value=e:b=e)},null,544),[[Z,d(b)]])]),dt,ut,ct,pt,mt,ht,yt,_t,bt])]),t("tbody",ft,[(a(!0),l(m,null,h(d(f)?.analysisResults,e=>i((a(),l("tr",{key:e.uid,class:ee([pe(e)])},[t("td",null,[i(t("input",{type:"checkbox",class:"","onUpdate:modelValue":n=>e.checked=n,onChange:s[8]||(s[8]=n=>re()),disabled:F(e)},null,40,vt),[[Z,e.checked]])]),t("td",kt,[e?.sample?.priority>0?(a(),l("span",{key:0,class:ee(["font-small",{"text-orange-600":d(f)?.priority>1}])},[...xt],2)):te("",!0)]),t("td",wt,[t("div",Ut,[e?.sample?.analysisRequest?.patient?.uid?(a(),Oe(u,{key:0,to:{name:"sample-detail",params:{patientUid:e?.sample?.analysisRequest?.patient?.uid,sampleUid:e?.sample?.uid}}},{default:X(()=>[j(r(e?.sample?.sampleId),1)]),_:2},1032,["to"])):(a(),l("div",Ct,r(e?.sample?.sampleId),1))]),d(w)?(a(),l("span",Rt,[t("span",null,r(e?.sample?.qcLevel?.level),1),t("div",null,r(e?.sample?.analysisRequest?.patient?.firstName)+" "+r(e?.sample?.analysisRequest?.patient?.lastName),1),t("div",null,r(e?.sample?.analysisRequest?.client?.name),1)])):te("",!0)]),t("td",St,[t("div",null,r(e?.analysis?.name),1)]),t("td",Et,[A(e)?(a(),l("label",Vt,[i(t("select",{class:"form-input mt-1 block w-full","onUpdate:modelValue":n=>e.laboratoryInstrumentUid=n,onChange:n=>x(e)},[Dt,(a(!0),l(m,null,h(d(p).laboratoryInstruments,n=>(a(),l("option",{key:n.uid,value:n.uid},[t("div",Nt,[t("span",null,r(n.labName),1),j(" → "),t("span",Bt,"("+r(n?.instrument?.name)+")",1)])],8,Wt))),128))],40,Tt),[[k,e.laboratoryInstrumentUid]])])):(a(),l("div",At,r(e.laboratoryInstrument?.labName||"---"),1))]),t("td",It,[A(e)?(a(),l("label",$t,[i(t("select",{class:"form-input mt-1 block w-full","onUpdate:modelValue":n=>e.methodUid=n,onChange:n=>x(e)},[jt,(a(!0),l(m,null,h(d(p).methods,n=>(a(),l("option",{key:n.uid,value:n.uid},r(n.name),9,Kt))),128))],40,Pt),[[k,e.methodUid]])])):(a(),l("div",Ot,r(e.method?.name||"---"),1))]),t("td",Mt,[!A(e)||(e?.analysis?.interims?.length??0)===0?(a(),l("div",qt," --- ")):(a(),l("label",Ht,[i(t("select",{class:"form-input mt-1 block w-full","onUpdate:modelValue":n=>e.result=n,onChange:n=>x(e)},[Ft,(a(!0),l(m,null,h(e?.analysis?.interims,(n,P)=>(a(),l("option",{key:n.key||P,value:n.value},r(n.value),9,Jt))),128))],40,Lt),[[k,e.result]])]))]),t("td",Yt,[A(e)?e?.analysis?.resultOptions?.length===0?(a(),l("label",Gt,[i(t("input",{class:"form-input mt-1 block w-full","onUpdate:modelValue":n=>e.result=n,onKeyup:n=>x(e)},null,40,Qt),[[$e,e.result]])])):(a(),l("label",Xt,[i(t("select",{class:"form-input mt-1 block w-full","onUpdate:modelValue":n=>e.result=n,onChange:n=>x(e)},[es,(a(!0),l(m,null,h(e?.analysis?.resultOptions,(n,P)=>(a(),l("option",{key:n.optionKey||P,value:n.value},r(n.value),9,ts))),128))],40,Zt),[[k,e.result]])])):(a(),l("div",zt,r(e?.result),1))]),t("td",ss,[t("div",null,r(e?.analysis?.unit?.name||"---"),1)]),t("td",os,[t("button",ns,r(e?.status||"unknown"),1)])],2)),[[Ce]])),128))])])])]),t("section",as,[i(t("button",{onClick:s[9]||(s[9]=y(e=>fe(),["prevent"])),class:"px-2 py-1 mr-2 border-sky-800 border text-sky-800 rounded-sm transition duration-300 hover:bg-sky-800 hover:text-white focus:outline-none"}," Un Assign ",512),[[_,U(R.CREATE,C.WORKSHEET)&&d(O)]]),i(t("button",{onClick:s[10]||(s[10]=y(e=>ve(),["prevent"])),class:"px-2 py-1 mr-2 border-sky-800 border text-sky-800 rounded-sm transition duration-300 hover:bg-sky-800 hover:text-white focus:outline-none"}," Submit ",512),[[_,U(R.UPDATE,C.WORKSHEET)&&d(W)]]),i(t("button",{onClick:s[11]||(s[11]=y(e=>ge(),["prevent"])),class:"px-2 py-1 mr-2 border-sky-800 border text-sky-800 rounded-sm transition duration-300 hover:bg-sky-800 hover:text-white focus:outline-none"}," Retract ",512),[[_,U(R.UPDATE,C.WORKSHEET)&&d(N)]]),i(t("button",{onClick:s[12]||(s[12]=y(e=>ke(),["prevent"])),class:"px-2 py-1 mr-2 border-sky-800 border text-sky-800 rounded-sm transition duration-300 hover:bg-sky-800 hover:text-white focus:outline-none"}," Approve ",512),[[_,U(R.UPDATE,C.WORKSHEET)&&d(B)]]),i(t("button",{onClick:s[13]||(s[13]=y(e=>xe(),["prevent"])),class:"px-2 py-1 mr-2 border-sky-800 border text-sky-800 rounded-sm transition duration-300 hover:bg-sky-800 hover:text-white focus:outline-none"}," Retest ",512),[[_,U(R.UPDATE,C.WORKSHEET)&&d(I)]]),i(t("button",{onClick:y(we,["prevent"]),class:"px-2 py-1 mr-2 border-sky-800 border text-sky-800 rounded-sm transition duration-300 hover:bg-sky-800 hover:text-white focus:outline-none"}," Print Barcodes ",512),[[_,d($)]])])])}}}),us=je(ls,[["__file","/home/aurthurm/Documents/Development/felicity/felicity-lims/webapp/views/worksheet/_id/WorkSheetResults.vue"]]);export{us as default};
