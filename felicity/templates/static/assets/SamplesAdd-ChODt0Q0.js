import{a0 as ge,u as ye,a4 as ve,f as xe,a7 as U,h as y,g as J,e as E,i as he,_ as we,r as Q,c as a,o as r,A as e,a as u,L as m,F as b,a9 as j,a2 as q,E as G,Q as W,M as Se,D as P,J as p,K as f,P as B,b as Ce}from"./index-Cdc6vSVw.js";import{Multiselect as _e}from"./vue-multiselect.esm-CZOh13og.js";import{u as De}from"./patient-CT8lm8Na.js";import{u as ke}from"./analysis-C80mPHS9.js";import{u as Ve}from"./client-DZ7kywvY.js";import{A as Re}from"./analyses.mutations-DiZ_xJnn.js";import{c as v,a as Ae,b as X,d as Z,e as D,u as Ue,f as x}from"./index.esm-CxvirWgB.js";import{f as $}from"./index-DUkUXZe3.js";/* empty css                                                                 */import"./location-CDLyOdjk.js";const qe=ge({__name:"SamplesAdd",setup(ee,{expose:t}){t();const h=ye(),o=De(),g=ke(),k=Ve(),w=ve(),{withClientMutation:V}=xe(),{swalError:l}=he(),n=U(!1);let i=y(()=>o.getPatient),M=J({first:void 0,after:"",text:"",sortBy:["name"],contacts:!0});k.fetchClients(M);const te=y(()=>k.getClients),N=U(null),oe=s=>{N.value=s,F.value=null};h.fetchSampleTypes();const le=y(()=>h.getSampleTypes);let I=J({first:void 0,after:"",text:"",sortBy:["name"]});g.fetchAnalysesServices(I);const se=y(()=>{const s=g.getAnalysesServicesSimple;let c=new Set;return s.forEach((d,A)=>{d.profiles?.length===0&&c.add(d)}),[...c]});g.fetchAnalysesProfiles();const ae=y(()=>g.getAnalysesProfiles),S=U(!1),re=E().endOf("day").toDate(),Y=v({clientRequestId:D().required("Client Request ID is Required"),clinicalData:v({clinicalIndication:D().nullable(),symptoms:X().of(D()),symptomsRaw:D().nullable(),treatmentNotes:D().nullable(),pregnancyStatus:Z().nullable(),breastFeeding:Z().nullable(),vitals:v().nullable(),otherContext:v().nullable()}).nullable(),client:v().required("Client is Required"),clientContact:v().nullable().required("Client Contact is Required"),samples:X().required().min(1,"Add at least 1 sample"),priority:Ae()});function T(s){return{sampleType:{},dateCollected:E(new Date),dateReceived:E(new Date),profiles:[],analyses:[],...s}}function L(){return{clinicalIndication:"",symptoms:[],symptomsRaw:"",treatmentNotes:"",pregnancyStatus:null,breastFeeding:null,vitals:{},otherContext:{}}}const{handleSubmit:H,errors:ne}=Ue({validationSchema:Y,initialValues:{priority:0,client:i?.value?.client,samples:[T({})],clinicalData:L()}});i?.value?.client&&(N.value=i.value.client);const{value:ie}=x("clientRequestId"),{value:R}=x("clinicalData"),{value:K}=x("client"),{value:F}=x("clientContact"),{value:de}=x("priority"),{value:C}=x("samples"),_=U(""),ce=()=>{_.value.trim()&&!R.value?.symptoms?.includes(_.value.trim())&&(R.value?.symptoms?.push(_.value.trim()),_.value="")},ue=s=>{R.value?.symptoms?.splice(s,1)},me=H(s=>{S.value=!0,console.log("values",s);for(let c of s.samples||[]){if([null,void 0,""].includes(c?.sampleType)){l("Samples must have sample types"),S.value=!1;return}if(c?.analyses?.length<=0&&c?.profiles?.length<=0){l("Samples must have either profiles/analyses or both"),S.value=!1;return}}z(s)});function z(s){const c={patientUid:i.value?.uid,clientRequestId:s.clientRequestId,clinicalData:s.clinicalData,clientUid:K?.value?.uid,clientContactUid:F?.value?.uid,samples:s.samples?.map(d=>({...d,profiles:d.profiles?.map(A=>A.uid),analyses:d.analyses?.map(A=>A.uid),sampleType:d.sampleType?.uid,dateCollected:$(d.dateCollected,"YYYY-MM-DD HH:mm"),dateReceived:$(d.dateReceived,"YYYY-MM-DD HH:mm")}))};console.log(c),V(Re,{payload:c},"createAnalysisRequest").then(d=>{h.addAnalysisRequest(d),w.push({name:"patient-detail",params:{patientUid:i.value?.uid}})}).finally(()=>{S.value=!1})}function pe(){const s=T({});C.value.push(s)}function fe(s){C.value.length>1&&C.value.splice(s,1)}const be=y(()=>C.value.length>1),O={sampleStore:h,patientStore:o,analysisStore:g,clientStore:k,router:w,withClientMutation:V,swalError:l,clinicalDataExpanded:n,get patient(){return i},set patient(s){i=s},get clientParams(){return M},set clientParams(s){M=s},clients:te,selectedClient:N,selectContact:oe,sampleTypes:le,get analysesParams(){return I},set analysesParams(s){I=s},analysesServices:se,analysesProfiles:ae,arSaving:S,maxDate:re,arSchema:Y,createDefaultSample:T,createDefaultClinicalData:L,handleSubmit:H,errors:ne,clientRequestId:ie,clinicalData:R,client:K,clientContact:F,priority:de,samples:C,newSymptom:_,addSymptom:ce,removeSymptom:ue,submitARForm:me,addAnalysesRequest:z,addSample:pe,removeSample:fe,canRemoveSample:be,contactLabel:s=>`${s.firstName} ${s.lastName}`,get VueMultiselect(){return _e}};return Object.defineProperty(O,"__isScriptSetup",{enumerable:!1,value:!0}),O}}),Pe={class:"space-y-6"},Me={class:"space-y-4"},Ne={class:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4"},Ie={class:"flex items-center gap-x-4"},Te={class:"flex items-center gap-x-4"},Fe={class:"text-sm text-destructive"},Ee={class:"flex items-center gap-x-4"},je={class:"text-sm text-destructive"},Be={class:"flex items-center gap-x-4"},Ye={class:"text-sm text-destructive"},Le={class:"border border-border rounded-lg bg-background/50"},He={key:0,class:"px-4 py-4 space-y-4 border-t border-border"},Ke={class:"flex items-center gap-x-4"},ze={class:"flex flex-wrap mt-2"},Oe={class:"flex gap-2"},Je=["onKeydown"],Qe={class:"flex flex-wrap gap-2 mt-2"},Ge=["onClick"],We={class:"flex items-center gap-x-4"},Xe={class:"grid grid-cols-1 md:grid-cols-2 gap-4"},Ze={class:"flex items-center gap-x-4"},$e={class:"flex items-center gap-x-4"},et={id:"samples",class:"space-y-4"},tt={class:"flex justify-between items-center"},ot={class:"flex items-center gap-4"},lt={class:"text-sm text-destructive"},st={class:"relative border border-border rounded-lg bg-background/50 overflow-visible"},at={class:"overflow-x-auto overflow-y-visible pl-48"},rt={class:"w-80 min-w-80"},nt={class:"border-b border-border bg-muted/30"},it={class:"flex items-center justify-between"},dt=["onClick","disabled","title"],ct={class:"border-b border-border hover:bg-muted/20 h-20 min-h-20 max-h-20"},ut={class:"border-b border-border hover:bg-muted/20 h-20 min-h-20 max-h-20"},mt={class:"border-b border-border hover:bg-muted/20 h-20 min-h-20 max-h-20"},pt={class:"border-b border-border hover:bg-muted/20 h-20 min-h-20 max-h-20"},ft={class:"border-b border-border hover:bg-muted/20 h-20 min-h-20 max-h-20"},bt={class:"hover:bg-muted/20 h-24"},gt={class:"p-3 bg-muted/50 rounded-md text-sm space-y-1"},yt={key:0,class:"text-xs text-destructive whitespace-nowrap"},vt={key:1},xt={class:"text-xs text-muted-foreground"},ht={class:"text-xs text-muted-foreground"},wt={class:"flex justify-end pt-4"},St={key:0,type:"submit",class:"px-6 py-2 bg-primary text-primary-foreground rounded-md hover:bg-primary/90 transition-colors duration-200 focus:outline-none focus:ring-2 focus:ring-primary/50"},Ct={key:1,class:"py-4 text-center"};function _t(ee,t,h,o,g,k){const w=Q("VueDatePicker"),V=Q("fel-loader");return r(),a("div",Pe,[t[30]||(t[30]=e("h5",{class:"text-xl font-semibold text-foreground mb-4"},"Add Analysis Request",-1)),e("form",{action:"post",class:"p-6 bg-background rounded-lg shadow-sm space-y-6",onSubmit:t[11]||(t[11]=P((...l)=>o.submitARForm&&o.submitARForm(...l),["prevent"]))},[e("div",Me,[e("div",Ne,[e("label",Ie,[t[12]||(t[12]=e("span",{class:"text-sm font-medium text-foreground"},"Client",-1)),u(o.VueMultiselect,{class:"w-full",placeholder:"Select a Client",modelValue:o.client,"onUpdate:modelValue":t[0]||(t[0]=l=>o.client=l),options:o.clients,searchable:!0,label:"name","track-by":"uid",onSelect:o.selectContact,"option-height":60,"close-on-select":!0},null,8,["modelValue","options"])]),e("label",Te,[t[13]||(t[13]=e("span",{class:"text-sm font-medium text-foreground whitespace-nowrap"},"Client Contact",-1)),u(o.VueMultiselect,{class:"w-full",placeholder:"Select a Client Contact",modelValue:o.clientContact,"onUpdate:modelValue":t[1]||(t[1]=l=>o.clientContact=l),options:o.selectedClient?.contacts??[],"custom-label":o.contactLabel,"track-by":"uid","close-on-select":!0,searchable:!0},null,8,["modelValue","options"]),e("div",Fe,m(o.errors.clientContact),1)]),e("label",Ee,[t[15]||(t[15]=e("span",{class:"text-sm font-medium text-foreground"},"Priority",-1)),b(e("select",{name:"priority",id:"priority","onUpdate:modelValue":t[2]||(t[2]=l=>o.priority=l),class:"w-full px-3 py-2 bg-background border border-border rounded-md focus:outline-none focus:ring-2 focus:ring-primary/50","aria-label":"Select priority level"},[...t[14]||(t[14]=[e("option",{value:"0"},"Low",-1),e("option",{value:"1"},"Medium",-1),e("option",{value:"2"},"High",-1)])],512),[[j,o.priority]]),e("div",je,m(o.errors.priority),1)])]),e("label",Be,[t[16]||(t[16]=e("span",{class:"text-sm font-medium text-foreground whitespace-nowrap"},"Client Request ID",-1)),b(e("input",{class:"w-full px-3 py-2 bg-background border border-border rounded-md focus:outline-none focus:ring-2 focus:ring-primary/50","onUpdate:modelValue":t[3]||(t[3]=l=>o.clientRequestId=l),placeholder:"CRID ..."},null,512),[[q,o.clientRequestId]]),e("div",Ye,m(o.errors.clientRequestId),1)]),e("div",Le,[e("button",{type:"button",onClick:t[4]||(t[4]=l=>o.clinicalDataExpanded=!o.clinicalDataExpanded),class:"w-full px-4 py-3 flex items-center justify-between text-left hover:bg-muted/20 transition-colors duration-200 focus:outline-none focus:ring-2 focus:ring-primary/50 rounded-t-lg"},[t[18]||(t[18]=e("span",{class:"text-sm font-medium text-foreground whitespace-nowrap"},"Clinical Data (click to expand)",-1)),(r(),a("svg",{class:W(["w-5 h-5 transition-transform duration-200",{"rotate-180":o.clinicalDataExpanded}]),fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[...t[17]||(t[17]=[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M19 9l-7 7-7-7"},null,-1)])],2))]),o.clinicalDataExpanded?(r(),a("div",He,[e("label",Ke,[t[19]||(t[19]=e("span",{class:"text-sm font-medium text-foreground whitespace-nowrap w-40"},"Clinical Indication",-1)),b(e("input",{class:"w-full px-3 py-2 bg-background border border-border rounded-md focus:outline-none focus:ring-2 focus:ring-primary/50","onUpdate:modelValue":t[5]||(t[5]=l=>o.clinicalData.clinicalIndication=l),placeholder:"Enter clinical indication..."},null,512),[[q,o.clinicalData.clinicalIndication]])]),e("div",ze,[t[20]||(t[20]=e("span",{class:"text-sm font-medium text-foreground w-40"},"Symptoms",-1)),e("div",Oe,[b(e("input",{class:"flex-1 px-3 py-2 bg-background border border-border rounded-md focus:outline-none focus:ring-2 focus:ring-primary/50","onUpdate:modelValue":t[6]||(t[6]=l=>o.newSymptom=l),placeholder:"Add symptom...",onKeydown:Se(P(o.addSymptom,["prevent","stop"]),["enter"])},null,40,Je),[[q,o.newSymptom]]),e("button",{type:"button",onClick:o.addSymptom,class:"px-3 py-2 bg-primary text-primary-foreground rounded-md hover:bg-primary/90 transition-colors duration-200 focus:outline-none focus:ring-2 focus:ring-primary/50"}," Add ")]),e("div",Qe,[(r(!0),a(p,null,f(o.clinicalData.symptoms,(l,n)=>(r(),a("span",{key:n,class:"inline-flex items-center gap-1 px-2 py-1 bg-muted text-muted-foreground rounded-md text-sm"},[B(m(l)+" ",1),e("button",{type:"button",onClick:i=>o.removeSymptom(n),class:"text-destructive hover:text-destructive/80 ml-1"}," × ",8,Ge)]))),128))])]),e("label",We,[t[21]||(t[21]=e("span",{class:"text-sm font-medium text-foreground whitespace-nowrap w-40"},"Treatment Notes",-1)),b(e("textarea",{class:"w-full px-3 py-2 bg-background border border-border rounded-md focus:outline-none focus:ring-2 focus:ring-primary/50","onUpdate:modelValue":t[7]||(t[7]=l=>o.clinicalData.treatmentNotes=l),placeholder:"Enter treatment notes...",rows:"2"},null,512),[[q,o.clinicalData.treatmentNotes]])]),e("div",Xe,[e("label",Ze,[t[23]||(t[23]=e("span",{class:"text-sm font-medium text-foreground whitespace-nowrap w-40"},"Pregnancy Status",-1)),b(e("select",{"onUpdate:modelValue":t[8]||(t[8]=l=>o.clinicalData.pregnancyStatus=l),class:"w-full ml-4 px-3 py-2 bg-background border border-border rounded-md focus:outline-none focus:ring-2 focus:ring-primary/50"},[...t[22]||(t[22]=[e("option",{value:null},"Not specified",-1),e("option",{value:!0},"Pregnant",-1),e("option",{value:!1},"Not pregnant",-1)])],512),[[j,o.clinicalData.pregnancyStatus]])]),e("label",$e,[t[25]||(t[25]=e("span",{class:"text-sm font-medium text-foreground whitespace-nowrap w-40"},"Breastfeeding Status",-1)),b(e("select",{"onUpdate:modelValue":t[9]||(t[9]=l=>o.clinicalData.breastFeeding=l),class:"w-full px-3 py-2 bg-background border border-border rounded-md focus:outline-none focus:ring-2 focus:ring-primary/50"},[...t[24]||(t[24]=[e("option",{value:null},"Not specified",-1),e("option",{value:!0},"Breastfeeding",-1),e("option",{value:!1},"Not breastfeeding",-1)])],512),[[j,o.clinicalData.breastFeeding]])])])])):G("",!0)])]),e("section",et,[e("div",tt,[t[26]||(t[26]=e("h5",{class:"text-lg font-semibold text-foreground"},"Samples",-1)),e("div",ot,[e("span",lt,m(o.errors.samples),1),o.samples?.length!==20?(r(),a("button",{key:0,type:"button",onClick:t[10]||(t[10]=P(l=>o.addSample(),["prevent"])),class:"px-4 py-2 bg-primary text-primary-foreground rounded-md hover:bg-primary/90 transition-colors duration-200 focus:outline-none focus:ring-2 focus:ring-primary/50"}," Add Sample ")):G("",!0)])]),e("div",st,[t[29]||(t[29]=Ce('<div class="absolute left-0 top-0 bottom-0 w-48 bg-muted/30 border-r border-border z-10"><table class="w-full h-full"><thead><tr class="border-b border-border bg-muted/30"><th class="p-4 text-left text-sm font-medium text-foreground h-16"> Field </th></tr></thead><tbody><tr class="border-b border-border h-20 min-h-20 max-h-20"><td class="p-4 text-sm font-medium text-foreground bg-muted/10"> Sample Type </td></tr><tr class="border-b border-border h-20 min-h-20 max-h-20"><td class="p-4 text-sm font-medium text-foreground bg-muted/10"> Date Collected </td></tr><tr class="border-b border-border h-20 min-h-20 max-h-20"><td class="p-4 text-sm font-medium text-foreground bg-muted/10"> Date Received </td></tr><tr class="border-b border-border h-20 min-h-20 max-h-20"><td class="p-4 text-sm font-medium text-foreground bg-muted/10"> Analysis Profiles </td></tr><tr class="border-b border-border h-20 min-h-20 max-h-20"><td class="p-4 text-sm font-medium text-foreground bg-muted/10"> Analysis Services </td></tr><tr class="h-24"><td class="p-4 text-sm font-medium text-foreground bg-muted/10"> Selection Summary </td></tr></tbody></table></div>',1)),e("div",at,[e("table",rt,[e("thead",null,[e("tr",nt,[(r(!0),a(p,null,f(o.samples,(l,n)=>(r(),a("th",{key:n,class:"p-4 text-center text-sm font-medium text-foreground w-80 min-w-80 relative h-16 border-r"},[e("div",it,[e("span",null,"Sample "+m(n+1),1),e("button",{type:"button",onClick:P(i=>o.removeSample(n),["prevent"]),disabled:!o.canRemoveSample,class:W(["px-2 py-1 rounded-md transition-colors duration-200 focus:outline-none focus:ring-2 text-xs ml-2",o.canRemoveSample?"bg-destructive text-destructive-foreground hover:bg-destructive/90 focus:ring-destructive/50":"bg-muted text-muted-foreground cursor-not-allowed"]),title:o.canRemoveSample?"Remove sample":"At least one sample is required"}," Remove ",10,dt)])]))),128))])]),e("tbody",null,[e("tr",ct,[(r(!0),a(p,null,f(o.samples,(l,n)=>(r(),a("td",{key:n,class:"p-4 w-80 border-r"},[u(o.VueMultiselect,{class:"w-full",placeholder:"Select sample type",modelValue:l.sampleType,"onUpdate:modelValue":i=>l.sampleType=i,options:o.sampleTypes,searchable:!0,label:"name","track-by":"uid",openDirection:"below"},null,8,["modelValue","onUpdate:modelValue","options"])]))),128))]),e("tr",ut,[(r(!0),a(p,null,f(o.samples,(l,n)=>(r(),a("td",{key:n,class:"p-4 w-80 border-r"},[u(w,{class:"w-full",modelValue:l.dateCollected,"onUpdate:modelValue":i=>l.dateCollected=i,"max-date":o.maxDate,"time-picker-inline":"",teleport:!0},null,8,["modelValue","onUpdate:modelValue","max-date"])]))),128))]),e("tr",mt,[(r(!0),a(p,null,f(o.samples,(l,n)=>(r(),a("td",{key:n,class:"p-4 w-80 border-r"},[u(w,{class:"w-full",modelValue:l.dateReceived,"onUpdate:modelValue":i=>l.dateReceived=i,"min-date":l.dateCollected&&typeof l.dateCollected=="object"&&!(l.dateCollected instanceof Date)&&typeof l.dateCollected.toDate=="function"?l.dateCollected.toDate():l.dateCollected||null,"max-date":o.maxDate,"time-picker-inline":"",teleport:!0},null,8,["modelValue","onUpdate:modelValue","min-date","max-date"])]))),128))]),e("tr",pt,[(r(!0),a(p,null,f(o.samples,(l,n)=>(r(),a("td",{key:n,class:"p-4 w-80 border-r"},[u(o.VueMultiselect,{class:"w-full whitespace-nowrap z-10",placeholder:"Select analysis profiles",modelValue:l.profiles,"onUpdate:modelValue":i=>l.profiles=i,options:o.analysesProfiles,searchable:!0,multiple:!0,label:"name","track-by":"uid",openDirection:"below"},null,8,["modelValue","onUpdate:modelValue","options"])]))),128))]),e("tr",ft,[(r(!0),a(p,null,f(o.samples,(l,n)=>(r(),a("td",{key:n,class:"p-4 w-80 border-r"},[u(o.VueMultiselect,{class:"w-full whitespace-nowrap",placeholder:"Select analysis services",modelValue:l.analyses,"onUpdate:modelValue":i=>l.analyses=i,options:o.analysesServices,searchable:!0,multiple:!0,label:"name","track-by":"uid",openDirection:"below"},null,8,["modelValue","onUpdate:modelValue","options"])]))),128))]),e("tr",bt,[(r(!0),a(p,null,f(o.samples,(l,n)=>(r(),a("td",{key:n,class:"p-4 w-80 border-r"},[e("div",gt,[l.profiles?.length===0&&l.analyses?.length===0?(r(),a("div",yt," ⚠️ Select profiles or services ")):(r(),a("div",vt,[e("div",xt,[t[27]||(t[27]=e("strong",null,"Profiles:",-1)),B(" "+m(l.profiles?.length||0)+" selected ",1)]),e("div",ht,[t[28]||(t[28]=e("strong",null,"Services:",-1)),B(" "+m(l.analyses?.length||0)+" selected ",1)])]))])]))),128))])])])])])]),e("div",wt,[o.arSaving?(r(),a("div",Ct,[u(V,{message:"Adding Samples ..."})])):(r(),a("button",St," Save Sample(s) "))])],32)])}const Tt=we(qe,[["render",_t],["__file","/home/aurthurm/Documents/Development/felicity/felicity-lims/webapp/views/sample/SamplesAdd.vue"]]);export{Tt as default};
