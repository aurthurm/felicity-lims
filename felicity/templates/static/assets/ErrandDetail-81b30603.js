import{P as he,Z as i,aa as xe,a9 as _e,h as R,e as ke,a5 as F,Q as De,r as j,a2 as s,o as r,c as m,b as t,a as n,E as d,A as K,V as Ve,H as Ue,at as we,L as B,ak as S,J as g,x as Ee,C as Ce,au as Be,a1 as M,K as Q,X as A,av as Se,Y as T,_ as Me}from"./index-03a7f0eb.js";import{a as Ae,b as Te,c as He,d as Pe,e as Le}from"./grind.queries-4e5f98f5.js";import{S as z}from"./schema-f3233b53.js";import{C as Ye,A as $e,a as Ne,b as Ge,B as Ie,c as Re,E as Fe,H as je,I as Ke,d as Qe,e as ze,L as Oe,P as Je,S as We,T as Xe,f as Ze,U as qe,g as et}from"./index-5f6f66c3.js";import v from"./vue-multiselect.esm-e5326598.js";import{U as tt}from"./_queries-175415ec.js";import{r as st}from"./ArrowLeftIcon-d0161c60.js";import"./_baseForOwn-656fabb0.js";import"./merge-2849153f.js";import"./_isIterateeCall-6b47236c.js";import"./isArray-513c67aa.js";import"./mapValues-81d27fb1.js";import"./isString-588a66cc.js";import"./clone-e28103f1.js";import"./_baseSet-32e3b41c.js";const at={key:0,class:"bg-white rounded-lg shadow"},ot={class:"flex flex-col md:flex-row"},lt={class:"flex-1 p-6 border-r"},it={class:"p-2 border-b"},nt={class:"flex justify-between items-center"},rt={class:"relative w-full"},dt={class:"mt-4 text-xs flex items-center gap-2"},ut={class:"h-8 w-8 rounded-full bg-orange-200 flex items-center justify-center text-orange-600"},ct={class:"my-1 font-semibold"},mt={class:"text-sm text-gray-600"},pt=["innerHTML"],gt={key:1,class:"mt-6"},vt={class:"main-container min-w-full prose prose-slate"},bt={class:"editor-container editor-container_balloon-editor",ref:"editorContainerElement"},ft={class:"editor-container__editor"},yt={ref:"editorElement"},ht={class:"flex justify-start items-center gap-x-2 mt-1"},xt={class:"my-2 w-full bg-gray-200 rounded-full h-1 dark:bg-gray-700"},_t={class:"text-xs"},kt={class:"border-b border-gray-200"},Dt={class:"flex"},Vt={class:"py-4"},Ut={key:0,class:"space-y-6"},wt={key:1,class:"space-y-4"},Et={key:2},Ct={class:"w-full md:w-80 p-6"},Bt={class:"space-y-6"},St={class:"multiselect-tag"},Mt=["onClick"],At={class:"multiselect-tag"},Tt=["onClick"],Ht=he({__name:"ErrandDetail",setup(Pt){const O=A(()=>T(()=>import("./CommentSystem-d3a1edd1.js"),["assets/CommentSystem-d3a1edd1.js","assets/index-03a7f0eb.js","assets/index-81d3252e.css","assets/grind.queries-4e5f98f5.js","assets/CommentSystem-d474aa42.css"])),J=A(()=>T(()=>import("./ErrandFile-5875e527.js"),["assets/ErrandFile-5875e527.js","assets/index-03a7f0eb.js","assets/index-81d3252e.css","assets/grind.queries-4e5f98f5.js","assets/schema-f3233b53.js","assets/ErrandFile-67bd3621.css"])),W=A(()=>T(()=>import("./ErrandMilestone-a0293113.js"),["assets/ErrandMilestone-a0293113.js","assets/index-03a7f0eb.js","assets/index-81d3252e.css","assets/_queries-175415ec.js","assets/grind.queries-4e5f98f5.js","assets/vue-multiselect.esm-e5326598.js"])),x=i(!1),H=i(null),X=i(Ye);function Z(){H.value={toolbar:{items:["undo","redo","|","heading","|","bold","italic","underline","|","link","insertTable","blockQuote","|","bulletedList","numberedList","todoList","outdent","indent"],shouldNotGroupWhenFull:!1},plugins:[$e,Ne,Ge,Ie,Re,Fe,je,Ke,Qe,ze,Oe,Je,We,Xe,Ze,qe,et],heading:{options:[{model:"paragraph",title:"Paragraph",class:"ck-heading_paragraph"},{model:"heading1",view:"h1",title:"Heading 1",class:"ck-heading_heading1"},{model:"heading2",view:"h2",title:"Heading 2",class:"ck-heading_heading2"},{model:"heading3",view:"h3",title:"Heading 3",class:"ck-heading_heading3"},{model:"heading4",view:"h4",title:"Heading 4",class:"ck-heading_heading4"},{model:"heading5",view:"h5",title:"Heading 5",class:"ck-heading_heading5"},{model:"heading6",view:"h6",title:"Heading 6",class:"ck-heading_heading6"}]},placeholder:"Begin typing..."},x.value=!0}xe(()=>{Z(),_(),ie(),re(),ge()});const u=i("discussions"),P=_e(),L=R(()=>P.params.errandUid),q=R(()=>P.params.boardUid);let a=i();const{withClientQuery:f,withClientMutation:Y}=ke();function _(){f(Ae,{uid:L.value},"grindErrandByUid").then(o=>{a.value=o;const e=F(a.value.startDate,!0)??new Date,p=F(a.value.endDate,!0)??new Date(new Date().setDate(e.getDate()+7));V.value=[e,p]})}function c(o){Y(Le,{uid:L.value,payload:o},"updateGrindErrand").then(()=>_())}const k=i(!1),D=i(null),ee=()=>{k.value=!0,Se(()=>{D.value?.focus(),D.value?.select()})},$=()=>{k.value=!1,c({title:a.value?.title})},y=i(!1),N=i(""),te=()=>{y.value=!0,N.value=a.value?.description??""},se=()=>{y.value=!1,c({description:a.value?.description})},ae=()=>{a.value.description=N.value,y.value=!1},V=i(),oe=o=>{const e=o[0]?.getDate(),p=o[0]?.getMonth()+1,E=o[0]?.getFullYear(),l=o[1]?.getDate(),b=o[1]?.getMonth()+1,C=o[1]?.getFullYear();return`${e}/${p}/${E} - ${l}/${b}/${C}`},le=o=>{if(o.length!==2){alert("Invalid date range");return}c({startDate:S(o[0],"YYYY-MM-DD HH:mm"),endDate:S(o[1],"YYYY-MM-DD HH:mm")})},G=i([]);function ie(){f(Te,{boardUid:q.value},"grindPostersByBoard").then(o=>{G.value=o.filter(e=>e.uid!==a.value?.posterUid)})}function ne(o){c({posterUid:o.uid})}const h=i();function re(){f(tt,{first:100},"userAll").then(o=>{h.value=o.items})}function U({firstName:o,lastName:e}){return`${o} ${e}`}function de(o){c({assigneeUid:o.uid})}function ue(o){c({reporterUid:o.uid})}function ce(o){c({members:o.map(e=>e.uid)})}const me=["Low","Normal","High","Critical"];function pe(o){c({priority:o})}const w=i([]);function ge(){f(He,{category:z.Project},"grindStampByCategory").then(o=>{w.value=o})}function I(o){c({stamps:o?.map(e=>e.uid)})}const ve=o=>{Y(Pe,{payload:{title:o,category:z.Project}},"createGrindStamp").then(e=>{if(e.uid){w.value.push(e);const p=a.value?.stamps??[];p.push(e),I(p)}})},be=()=>_(),fe=De();function ye(){fe.back()}return(o,e)=>{const p=j("ckeditor"),E=j("VueDatePicker");return s(a)?(r(),m("div",at,[t("div",ot,[t("div",lt,[t("div",it,[t("div",nt,[t("div",rt,[t("button",{onClick:ye,class:"-mt-8 mr-4 text-gray-500 hover:text-gray-700"},[n(s(st),{class:"w-5 h-5"})]),k.value?K((r(),m("input",{key:1,type:"text","onUpdate:modelValue":e[0]||(e[0]=l=>s(a).title=l),onBlur:$,onKeyup:Ue($,["enter"]),ref_key:"titleInput",ref:D,class:"text-2xl font-semibold text-gray-800 w-full px-2 py-1 border border-blue-300 rounded focus:outline-none focus:ring-2 focus:ring-blue-500"},null,544)),[[Ve,s(a).title]]):(r(),m("h1",{key:0,onClick:ee,class:"text-3xl font-bold text-gray-800 cursor-pointer hover:bg-gray-50 rounded"},d(s(a).title),1))])]),t("div",dt,[t("div",ut,d(s(we)(s(a).createdBy?.firstName,s(a).createdBy?.lastName)),1),e[12]||(e[12]=B(" by ")),t("span",ct,d(s(a).createdBy?.firstName)+" "+d(s(a).createdBy?.lastName),1),t("span",mt,"on "+d(s(S)(s(a).createdAt,"D MMMM YYYY")),1)]),y.value?(r(),m("div",gt,[t("div",vt,[t("p",null,"isLayoutReady : "+d(x.value),1),t("div",bt,[t("div",ft,[t("div",yt,[x.value?(r(),Ee(p,{key:0,modelValue:s(a).description,"onUpdate:modelValue":e[1]||(e[1]=l=>s(a).description=l),editor:X.value,config:H.value,"tag-name":"textarea"},null,8,["modelValue","editor","config"])):g("",!0)],512)])],512)]),t("div",{class:"mt-2 flex gap-2"},[t("button",{onClick:se,class:"px-3 py-1 bg-blue-500 text-white rounded hover:bg-blue-600 text-sm"}," Save "),t("button",{onClick:ae,class:"px-3 py-1 bg-gray-200 text-gray-700 rounded hover:bg-gray-300 text-sm"}," Cancel ")])])):(r(),m("div",{key:0,class:"mt-6 prose",onClick:te},[s(a).description?(r(),m("article",{key:0,class:"text-lg text-gray-800",innerHTML:s(a).description},null,8,pt)):g("",!0)]))]),K(t("div",ht,[t("div",xt,[t("div",{class:"bg-green-600 h-1 rounded-full",style:Be(`width: ${s(a)?.milestonesAt}%`)},null,4)]),t("span",_t,d(s(a)?.milestonesAt)+"%",1)],512),[[Ce,s(a)?.milestonesAt]]),t("div",kt,[t("div",Dt,[t("button",{onClick:e[2]||(e[2]=l=>u.value="discussions"),class:M(["py-3 px-4 text-sm font-medium border-b-2 focus:outline-none",u.value==="discussions"?"border-blue-500 text-blue-500":"border-transparent text-gray-500 hover:text-gray-700"])}," Discussions ",2),t("button",{onClick:e[3]||(e[3]=l=>u.value="milestones"),class:M(["py-3 px-4 text-sm font-medium border-b-2 focus:outline-none",u.value==="milestones"?"border-blue-500 text-blue-500":"border-transparent text-gray-500 hover:text-gray-700"])}," Milestones ",2),t("button",{onClick:e[4]||(e[4]=l=>u.value="files"),class:M(["py-3 px-4 text-sm font-medium border-b-2 focus:outline-none",u.value==="files"?"border-blue-500 text-blue-500":"border-transparent text-gray-500 hover:text-gray-700"])}," Files ",2)])]),t("div",Vt,[u.value==="discussions"?(r(),m("div",Ut,[n(s(O),{errandUid:s(a).uid},null,8,["errandUid"])])):g("",!0),u.value==="milestones"?(r(),m("div",wt,[n(s(W),{errandUid:s(a).uid,onMilestoneUpdated:be},null,8,["errandUid"])])):g("",!0),u.value==="files"?(r(),m("div",Et,[n(s(J),{errandUid:s(a).uid},null,8,["errandUid"])])):g("",!0)])]),t("div",Ct,[t("div",Bt,[n(E,{class:"z-60",modelValue:V.value,"onUpdate:modelValue":[e[5]||(e[5]=l=>V.value=l),le],range:"",format:oe},null,8,["modelValue"]),t("div",null,[e[13]||(e[13]=t("label",{class:"block text-sm font-medium text-gray-700 mb-1"},"Status",-1)),n(s(v),{modelValue:s(a).poster,"onUpdate:modelValue":[e[6]||(e[6]=l=>s(a).poster=l),ne],options:G.value,label:"title","track-by":"uid",placeholder:"Select status"},null,8,["modelValue","options"])]),t("div",null,[e[14]||(e[14]=t("label",{class:"block text-sm font-medium text-gray-700 mb-1"},"Assignee",-1)),n(s(v),{modelValue:s(a).assignee,"onUpdate:modelValue":[e[7]||(e[7]=l=>s(a).assignee=l),de],options:h.value,"track-by":"uid",searchable:!0,"custom-label":U,placeholder:"Select assignee"},null,8,["modelValue","options"])]),t("div",null,[e[15]||(e[15]=t("label",{class:"block text-sm font-medium text-gray-700 mb-1"},"Reporter",-1)),n(s(v),{modelValue:s(a).reporter,"onUpdate:modelValue":[e[8]||(e[8]=l=>s(a).reporter=l),ue],options:h.value,"track-by":"uid",searchable:!0,"custom-label":U,placeholder:"Select reporter"},null,8,["modelValue","options"])]),t("div",null,[e[16]||(e[16]=t("label",{class:"block text-sm font-medium text-gray-700 mb-1"},"Team Members",-1)),n(s(v),{modelValue:s(a).members,"onUpdate:modelValue":[e[9]||(e[9]=l=>s(a).members=l),ce],options:h.value,multiple:!0,searchable:!0,"custom-label":U,"track-by":"uid",placeholder:"Select members"},{tag:Q(({option:l,remove:b})=>[t("div",St,[B(d(l.firstName)+" "+d(l.lastName)+" ",1),t("i",{class:"multiselect-tag-remove",onClick:C=>b(l)},"×",8,Mt)])]),_:1},8,["modelValue","options"])]),t("div",null,[e[17]||(e[17]=t("label",{class:"block text-sm font-medium text-gray-700 mb-1"},"Priority",-1)),n(s(v),{modelValue:s(a).priority,"onUpdate:modelValue":[e[10]||(e[10]=l=>s(a).priority=l),pe],options:me,searchable:!1,"show-labels":!1,placeholder:"Select priority"},null,8,["modelValue"])]),t("div",null,[e[18]||(e[18]=t("label",{class:"block text-sm font-medium text-gray-700 mb-1"},"Tags",-1)),n(s(v),{modelValue:s(a).stamps,"onUpdate:modelValue":[e[11]||(e[11]=l=>s(a).stamps=l),I],options:w.value,multiple:!0,taggable:!0,searchable:!0,"track-by":"uid","show-labels":!1,placeholder:"Select or add tags",onTag:ve,"custom-label":({title:l})=>`${l}`},{tag:Q(({option:l,remove:b})=>[t("div",At,[B(d(l.title)+" ",1),t("i",{class:"multiselect-tag-remove",onClick:C=>b(l)},"×",8,Tt)])]),_:1},8,["modelValue","options","custom-label"])])])])])])):g("",!0)}}}),Xt=Me(Ht,[["__file","/home/aurthurm/Documents/Development/felicity/felicity-lims/webapp/views/grind/_id/ErrandDetail.vue"]]);export{Xt as default};
