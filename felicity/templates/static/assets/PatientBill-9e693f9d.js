import{S as Z,bj as Ce,M as se,d as Te,bk as Be,W as Ae,s as ee,r as _,x as Ie,ay as te,z as q,o as i,c as r,b as e,e as u,f as o,g as A,F as I,E as U,I as b,t as d,aG as Se,P as W,w as y,D,C as m,A as x,B as H,i as z,as as Ve,v as E,j as M,_ as R,ap as Ne,G as Pe,H as Fe,k as Le}from"./index-4d0d48ab.js";import{A as Ue,C as De,a as Ee}from"./billing.mutations-f659bbc2.js";import{c as Me,a as G,d as Re,u as Oe,b as K}from"./array-93349b7b.js";function je(){const{withClientQuery:h}=se();return{downloadInvoice:async g=>{try{await Z.fire({title:"Are you sure?",text:"You want to download this invoice",icon:"warning",showCancelButton:!0,confirmButtonColor:"#3085d6",cancelButtonColor:"#d33",confirmButtonText:"Yes, download now!",cancelButtonText:"No, do not download!"}).then(async p=>{p.isConfirmed&&(h(Ce,{billUid:g},"billInvoiceCreate","network-only").then(S=>{const v=document.createElement("a");v.href=`data:application/pdf;base64,${S}`,v.setAttribute("download","invoice-report.pdf"),v.click()}),await Z.fire("Its Happening!","Downloading .....","success").then(S=>{}))})}catch{}}}}const a=h=>(Pe("data-v-afb0e1b5"),h=h(),Fe(),h),$e={class:"mt-4"},Ye=a(()=>e("h4",{class:"text-sm text-gray-800 font-bold"},"Patient's Order Bills",-1)),qe=a(()=>e("hr",null,null,-1)),We={class:"grid grid-cols-12 gap-4 mt-2"},He={initial:{opacity:0,y:100},enter:{opacity:1,y:0,scale:1},variants:{custom:{scale:2}},delay:400,class:"col-span-3 overflow-y-scroll overscroll-contain billing-scroll"},ze={key:0,class:"py-4 text-center bg-white w-full mb-1 rounded-sm shadow border"},Ge={key:1},Ke=["onClick"],Qe={class:"flex-grow p-1"},Je={class:"font-semibold text-gray-800"},Xe={class:"text-sm text-gray-400"},Ze={initial:{opacity:0,y:-100},enter:{opacity:1,y:0,scale:1},variants:{custom:{scale:2}},delay:400,class:"col-span-9"},et={class:"bg-white rounded-sm shadow-sm hover:shadow-xs duration-500 px-4 sm:px-6 md:px-2 py-4"},tt={class:"flex justify-between items-center"},st={class:"text-gray-800 text-l font-bold"},ot=a(()=>e("hr",null,null,-1)),at={class:"grid grid-cols-3 gap-x-8"},nt={class:"col-span-1"},lt={class:"flex justify-between items-center mt-2"},it=a(()=>e("span",{class:"text-gray-800 text-sm font-semibold"},"Active:",-1)),dt={class:"text-gray-600 text-sm md:text-md"},ct={class:"flex justify-between items-center mt-2"},rt=a(()=>e("span",{class:"text-gray-800 text-sm font-semibold"},"Confirmed:",-1)),ut={class:"text-gray-600 text-sm md:text-md"},mt={class:"col-span-1"},_t={class:"flex justify-between items-center mt-2"},ht=a(()=>e("span",{class:"text-gray-800 text-sm font-semibold"},"Total Charged:",-1)),pt={class:"text-gray-600 text-sm md:text-md"},vt={class:"flex justify-between items-center mt-2"},ft=a(()=>e("span",{class:"text-gray-800 text-sm font-semibold"},"Total Paid:",-1)),bt={class:"text-gray-600 text-sm md:text-md"},yt={class:"col-span-1"},xt={class:"flex justify-between items-center mt-2"},gt=a(()=>e("span",{class:"text-gray-800 text-sm font-semibold"},"Partial:",-1)),wt={class:"text-gray-600 text-sm md:text-md"},kt={class:"mt-4"},Ct={class:"flex justify-between items-center"},Tt=a(()=>e("h4",{class:"text-gray-800 text-l font-semibold"},"Order Items",-1)),Bt=a(()=>e("hr",null,null,-1)),At={class:"mt-4 bg-white rounded-sm shadow-sm hover:shadow-xs duration-500 px-4 sm:px-6 md:px-2 py-4"},It={class:"text-gray-400"},St={class:"ml-2 text-md leading-5 text-sky-600"},Vt={class:"mt-4"},Nt={class:"flex justify-between items-center"},Pt=a(()=>e("h4",{class:"text-gray-800 text-l font-semibold"},"Transactions",-1)),Ft=a(()=>e("hr",null,null,-1)),Lt={class:"mt-4 bg-white rounded-sm shadow-sm hover:shadow-xs duration-500 px-4 sm:px-6 md:px-2 py-4"},Ut=a(()=>e("h3",null,"Transaction Form",-1)),Dt={class:"grid grid-cols-2 gap-x-4 mb-4"},Et={class:"whitespace-nowrap mb-2 w-full"},Mt=a(()=>e("span",{class:"text-gray-700 w-4/12"},"Kind of payment",-1)),Rt={class:"w-full"},Ot=["disabled"],jt=a(()=>e("option",null,null,-1)),$t=["value"],Yt={class:"text-orange-600 w-4/12"},qt={class:"block col-span-1 mb-2"},Wt=a(()=>e("span",{class:"text-gray-700"},"Amount",-1)),Ht=["disabled"],zt={class:"grid grid-cols-4 gap-x-4 mb-4"},Gt={class:"block col-span-4 mb-2"},Kt=a(()=>e("span",{class:"text-gray-700"},"Notes",-1)),Qt=["disabled"],Jt=a(()=>e("hr",{class:"mb-4"},null,-1)),Xt=a(()=>e("h3",null,"Confirm Tranaction",-1)),Zt={class:"grid grid-cols-4 gap-x-4 mb-4"},es={class:"block col-span-4 mb-2"},ts=a(()=>e("span",{class:"text-gray-700"},"Notes",-1)),ss=["disabled"],os=a(()=>e("hr",{class:"mb-4"},null,-1)),as=a(()=>e("h3",null,"Apply Voucher Code Form",-1)),ns={class:"grid grid-cols-2 gap-x-4 mb-4"},ls={class:"block col-span-2 mb-2"},is=a(()=>e("span",{class:"text-gray-700"},"Voucher Code:",-1)),ds=["disabled"],cs=a(()=>e("hr",{class:"mb-4"},null,-1)),rs=Te({__name:"PatientBill",props:{patientUid:String},setup(h){const Q=M(()=>R(()=>import("./FelLoadingMessage-e29e7357.js"),["assets/FelLoadingMessage-e29e7357.js","assets/index-4d0d48ab.js","assets/index-c2286288.css"])),g=M(()=>R(()=>import("./FelModal-599b9c12.js"),["assets/FelModal-599b9c12.js","assets/index-4d0d48ab.js","assets/index-c2286288.css","assets/FelModal-780aeea9.css"])),p=M(()=>R(()=>import("./FelButton-f535b4fc.js"),["assets/FelButton-f535b4fc.js","assets/index-4d0d48ab.js","assets/index-c2286288.css"])),S=M(()=>R(()=>import("./FelDataTable-98793ba6.js"),["assets/FelDataTable-98793ba6.js","assets/index-4d0d48ab.js","assets/index-c2286288.css"])),v=h,{toastSuccess:J}=Ne(),{withClientMutation:O}=se(),w=Be(),oe=Ae(),{bills:X,fetchingBills:ae,transactions:ne,fetchingTransactions:le}=ee(w),{analysisRequests:ie}=ee(oe);w.fetchBillsForPatient(v?.patientUid);const de=_(["cash","medical-aid","e-payment"]),V=_(!1),l=_({}),ce=n=>{l.value={...n},w.fetchBillTransactions(n.uid)},re=Ie(()=>{const n=l?.value?.orders?.map(t=>t.uid)??[];return ie?.value?.filter(t=>n.includes(t.uid))});function ue(n,t){let f=[];return n.forEach(T=>f.push(T.name)),t.forEach(T=>f.push(T.name)),f.join(", ")}const me=Me({testBillUid:G().required(),kind:G().required(),amount:Re().required(),notes:G()}),{handleSubmit:_e,errors:k,setFieldValue:N}=Oe({validationSchema:me,initialValues:{testBillUid:l.value?.uid}}),{value:P}=K("kind"),{value:j}=K("amount"),{value:$}=K("notes"),c=_(!1),he=_e(n=>{c.value=!0,ve(n)}),pe=()=>{N("testBillUid",l.value?.uid),N("kind","cash"),N("amount",Math.ceil(Number((l?.value?.totalCharged-l?.value?.totalPaid).toFixed(2)))),N("notes",""),V.value=!0},ve=n=>{O(Ue,{payload:n},"createTestBillTransaction").then(t=>{w.addTransaction(t),c.value=!1,V.value=!1,J("Transaction added.")})},F=_(!1),C=_({}),fe=()=>{c.value=!0,O(De,{uid:C.value.uid,notes:C.value.notes},"confirmTestBillTransaction").then(n=>{w.updateTransaction(n),c.value=!1,F.value=!1,J("Transaction confirmed.")})},be=_([{name:"Kind",value:"kind",sortable:!0,sortBy:"asc",defaultSort:!0,showInToggler:!1,hidden:!1},{name:"Amount",value:"amount",sortable:!1,sortBy:"asc",hidden:!1},{name:"Success",value:"isSuccess",sortable:!1,sortBy:"asc",hidden:!1},{name:"Notes",value:"notes",sortable:!1,sortBy:"asc",hidden:!1},{name:"Message",value:"message",sortable:!1,sortBy:"asc",hidden:!1},{name:"Processed",value:"processed",sortable:!1,sortBy:"asc",hidden:!1,customRender:function(n,t){return te("span",{innerHTML:n.processed?"Yes":"Pending confirmation"},[])}},{name:"Action",sortable:!1,hidden:!1,customRender:(n,t)=>{if(!n.processed)return te("button",{onClick(){F.value=!0,C.value=n},type:"button",class:"bg-sky-800 text-white py-1 px-2 rounded-sm leading-none"},"confirm")}}]),Y=_(!1),L=_({code:""}),ye=()=>{Y.value=!0},xe=()=>{c.value=!0,O(Ee,{payload:{voucherCode:L.value?.code,testBillUid:l.value?.uid,customerUid:v.patientUid}},"applyVoucher").then(n=>c.value=!1)},{downloadInvoice:ge}=je(),we=async n=>await ge(n.uid);return(n,t)=>{const f=q("motion"),T=q("motion-slide-top"),ke=q("motion-slide-right");return i(),r(I,null,[e("div",$e,[Ye,qe,e("div",We,[u((i(),r("section",He,[o(ae)?(i(),r("div",ze,[A(o(Q),{message:"Fetching bills ..."})])):(i(),r("div",Ge,[e("ul",null,[(i(!0),r(I,null,U(o(X),s=>(i(),r("li",{key:s.uid,class:b(["bg-white w-full flex items-center p-1 mb-1 rounded-sm shadow border",{"border-sky-800 bg-emerald-200":s.uid===l.value.uid}]),onClick:B=>ce(s)},[e("div",Qe,[e("div",Je,[e("div",null,d(s.billId?.toLocaleUpperCase()),1),e("div",Xe,d(o(Se)(s.createdAt)),1)])])],10,Ke))),128))])]))])),[[f]]),u((i(),r("section",Ze,[u((i(),r("div",et,[e("div",tt,[e("h4",st,d(l.value.billId?.toLocaleUpperCase()),1)]),ot,e("section",at,[e("div",nt,[e("div",lt,[it,e("span",dt,d(l.value.isActive?"Yes":"No"),1)]),e("div",ct,[rt,e("span",ut,d(l.value?.toConfirm?"No":"Yes"),1)])]),e("div",mt,[e("div",_t,[ht,e("span",pt,d(l.value?.totalCharged),1)]),e("div",vt,[ft,e("span",bt,d(l.value?.totalPaid),1)])]),e("div",yt,[e("div",xt,[gt,e("span",wt,d(l.value?.totalPaid<l.value?.totalCharged?"Yes":"No"),1)])])])])),[[T]]),e("div",kt,[e("div",Ct,[Tt,e("button",{class:"ml-4 px-2 py-1 mr-2 border-sky-800 border text-sky-800 rounded-sm transition duration-300 hover:bg-sky-800 hover:text-white focus:outline-none",onClick:t[0]||(t[0]=y(s=>we(l.value),["prevent"]))}," Invoice ")]),Bt,e("ul",At,[(i(!0),r(I,null,U(re.value,s=>(i(),r("li",{class:"font-semibold",key:s.uid},[e("div",null,d(s?.requestId)+" ("+d(s?.clientRequestId)+")",1),(i(!0),r(I,null,U(s.samples,B=>u((i(),r("div",{class:"ml-4 text-sm",key:B.uid},[e("span",It,d(B.sampleId),1),D(" â‡’ "),e("span",St,d(ue(B.profiles??[],B.analyses??[])),1)])),[[ke]])),128))]))),128))])]),e("div",Vt,[e("div",Nt,[Pt,e("div",null,[u(e("button",{class:"px-2 py-1 mr-2 border-sky-800 border text-sky-800 rounded-sm transition duration-300 hover:bg-sky-800 hover:text-white focus:outline-none",onClick:y(pe,["prevent"])}," Add Transaction ",512),[[W,l.value.isActive]]),u(e("button",{class:"ml-4 px-2 py-1 mr-2 border-sky-800 border text-sky-800 rounded-sm transition duration-300 hover:bg-sky-800 hover:text-white focus:outline-none",onClick:y(ye,["prevent"])}," Apply Voucher ",512),[[W,l.value.isActive]])])]),Ft,e("div",Lt,[A(o(S),{columns:be.value,data:o(ne),toggleColumns:!1,loading:o(le),paginable:!1,searchable:!1,filterable:!1,selectable:!1},{footer:m(()=>[]),_:1},8,["columns","data","loading"])])])])),[[W,o(X)?.length>0&&l.value.uid],[f]])])]),x(" New Transaction Form Modal "),V.value?(i(),H(o(g),{key:0,onClose:t[4]||(t[4]=s=>V.value=!1),contentWidth:"w-3/6"},{header:m(()=>[Ut]),body:m(()=>[e("form",null,[e("div",Dt,[e("label",Et,[Mt,e("div",Rt,[u(e("select",{class:b(["form-select mt-1 w-full",{"border-red-500 animate-pulse":o(k).kind}]),"onUpdate:modelValue":t[1]||(t[1]=s=>z(P)?P.value=s:null),disabled:c.value},[jt,(i(!0),r(I,null,U(de.value,s=>(i(),r("option",{key:s,value:s},d(s),9,$t))),128))],10,Ot),[[Ve,o(P)]]),e("div",Yt,d(o(k).gender),1)])]),e("label",qt,[Wt,u(e("input",{class:b(["form-input mt-1 block w-full",{"border-red-500 animate-pulse":o(k).amount}]),type:"number","onUpdate:modelValue":t[2]||(t[2]=s=>z(j)?j.value=s:null),disabled:c.value},null,10,Ht),[[E,o(j)]])])]),e("div",zt,[e("label",Gt,[Kt,u(e("input",{class:b(["form-input mt-1 block w-full",{"border-red-500 animate-pulse":o(k).notes}]),"onUpdate:modelValue":t[3]||(t[3]=s=>z($)?$.value=s:null),disabled:c.value},null,10,Qt),[[E,o($)]])])]),Jt,A(o(p),{color:"sky-800",type:"submit",loading:c.value,onClick:y(o(he),["prevent"])},{default:m(()=>[D(" Save Transaction ")]),_:1},8,["loading","onClick"])])]),_:1})):x("v-if",!0),x(" Confirm Transaction Form Modal "),F.value?(i(),H(o(g),{key:1,onClose:t[6]||(t[6]=s=>F.value=!1),contentWidth:"w-3/6"},{header:m(()=>[Xt]),body:m(()=>[e("form",null,[e("h4",null,d(o(P))+" Transaction ",1),e("div",Zt,[e("label",es,[ts,u(e("input",{class:b(["form-input mt-1 block w-full",{"border-red-500 animate-pulse":o(k).notes}]),"onUpdate:modelValue":t[5]||(t[5]=s=>C.value.notes=s),disabled:c.value},null,10,ss),[[E,C.value.notes]])])]),os,A(o(p),{color:"sky-800",type:"submit",loading:c.value,onClick:y(fe,["prevent"])},{default:m(()=>[D(" Confirm Transaction ")]),_:1},8,["loading"])])]),_:1})):x("v-if",!0),x(" Voucher Code Form Modal "),Y.value?(i(),H(o(g),{key:2,onClose:t[8]||(t[8]=s=>Y.value=!1),contentWidth:"w-1/5"},{header:m(()=>[as]),body:m(()=>[e("form",null,[e("div",ns,[e("label",ls,[is,u(e("input",{class:b(["form-input mt-1 block w-full",{"border-red-500 animate-pulse":!L.value.code}]),type:"text","onUpdate:modelValue":t[7]||(t[7]=s=>L.value.code=s),disabled:c.value},null,10,ds),[[E,L.value.code]])])]),cs,A(o(p),{color:"sky-800",type:"submit",loading:c.value,onClick:y(xe,["prevent"])},{default:m(()=>[D(" Apply Voucher ")]),_:1},8,["loading"])])]),_:1})):x("v-if",!0)],64)}}});const hs=Le(rs,[["__scopeId","data-v-afb0e1b5"],["__file","/home/aurthurm/Documents/Development/felicity/felicity-lims/webapp/views/patient/_id/PatientBill.vue"]]);export{hs as default};
