import{P as Z,e as H,Z as c,h as ee,aa as te,f as se,o,c as l,b as e,J as h,F as w,D as S,E as m,A as b,V as T,C as V,a as I,K as _,L as N,z as P,a2 as O,x as ae,X as $,Y as j,_ as ne}from"./index-fa13e788.js";import{h as B,o as L,a as M}from"./constants-68671847.js";import{u as oe}from"./analysis-265e51d4.js";import{G as ie,A as le,S as re,D as ue,a as de}from"./microbiology.mutations-652bcc63.js";import"./analyses.mutations-bfee3c87.js";const ce={class:"flex justify-between items-center"},me=e("span",{class:"font-bold"},"Organisms",-1),pe=["disabled"],ve=e("hr",{class:"mt-1"},null,-1),he={class:"overflow-x-auto mt-2"},be={class:"align-middle inline-block min-w-full shadow overflow-hidden bg-white shadow-dashboard px-2 pt-1 rounded-bl-lg rounded-br-lg"},_e={class:"min-w-full"},ge=e("thead",null,[e("tr",null,[e("th",{class:"px-1 py-1 border-b-2 border-gray-300 text-left text-sm leading-4 text-gray-800 tracking-wider"},"Isolate Number"),e("th",{class:"px-1 py-1 border-b-2 border-gray-300 text-left text-sm leading-4 text-gray-800 tracking-wider"},"Organism Name"),e("th",{class:"px-1 py-1 border-b-2 border-gray-300"})])],-1),ye={class:"bg-white"},fe={class:"px-1 py-1 whitespace-no-wrap border-b border-gray-500"},xe={class:"text-sm leading-5 text-gray-800"},ke={class:"px-1 py-1 whitespace-no-wrap border-b border-gray-500"},we={key:0,class:"text-sm leading-5 text-sky-800"},Oe=["onClick"],Ae={class:"px-1 py-1 whitespace-no-wrap text-right border-b border-gray-500 text-sm leading-5"},Ce={key:0},Re=["onClick"],De=["onClick"],Ue={key:1},Ee=["onClick"],Se={class:"mt-4"},Te={class:"flex justify-start items-center"},Ve=e("h4",{class:"font-semibold text-l flex-1 mb-2"},"Culture",-1),Ie={type:"button",class:"bg-sky-800 text-white ml-4 px-2 py-1 rounded-sm leading-none"},Ne=e("hr",null,null,-1),Pe={key:1,class:"py-2 w-full leading italic bg-slate-50 p-2"},$e={class:"mt-2"},je=e("h3",null,"Search Organism",-1),Be={class:""},Le={class:"w-full"},Me={class:"block mb-4"},Fe={class:"border p-2 h-64 overflow-y-auto"},ze={class:"w-full"},Ge={class:"px-1 py-1 whitespace-no-wrap border-b border-gray-500"},qe={class:"text-sm leading-5 text-gray-800"},Je={class:"px-1 py-1 whitespace-no-wrap text-right border-b border-gray-500 text-sm leading-5"},Ke=["onClick"],Qe=Z({__name:"OrganismResults",props:{sample:{type:Object,required:!0},analysisResults:{type:Object,required:!0}},setup(g){const F=$(()=>j(()=>import("./index-fa13e788.js").then(s=>s.cN),["assets/index-fa13e788.js","assets/index-ccc6a521.css"])),A=$(()=>j(()=>import("./FelButton-1d1ff19a.js"),["assets/FelButton-1d1ff19a.js","assets/index-fa13e788.js","assets/index-ccc6a521.css"])),{withClientMutation:y,withClientQuery:C}=H(),i=c([]),p=c(!1),v=c(""),R=c([]),f=c(void 0),u=c(!1),{sample:D,analysisResults:U}=g,n=ee(()=>U[0]);te(()=>{C(ie,{analysisResultUid:n.value.uid},"abxOrganismResultAll").then(s=>{s&&(i.value=s||[])}).finally(()=>x())});function z(){u.value=!0,y(le,{analysisResultUid:n.value.uid},"createAbxOrganismResult").then(s=>{s&&i.value.unshift(s)}).finally(()=>u.value=!1)}function G(s){u.value=!0,y(re,{uid:s.uid,organismUid:s.organism.uid},"saveAbxOrganismResult").then(a=>{if(a){const t=i.value.findIndex(r=>r.uid===s.uid);if(t>-1){const r=a.organism;i.value[t].organismUid=r?.uid,i.value[t].organism=r}}}).finally(()=>{u.value=!1,x()})}function q(s){u.value=!0,y(ue,{uid:s.uid},"removeAbxOrganismResult").then(a=>{if(a){const t=i.value.findIndex(r=>r.uid===a?.uid);t>-1&&i.value.splice(t,1)}}).finally(()=>{u.value=!1,x()})}function E(s){f.value=s,p.value=!0}function J(s){p.value=!1,i.value[f.value].organism=s,f.value=void 0,U[0].result=i.value?.map(a=>a.organism?.name).join(", ")}function K(){v.value.length<3||C(de,{text:v.value,pageSize:25,sortBy:["name"]},"abxOrganismAll").then(s=>{R.value=s?.items})}const d=se({can_submit:!1,can_approve:!1});function x(){d.can_submit=!1,d.can_approve=!1;const s=i.value?.every(a=>a.organismUid!=null);n.value.status=="pending"&&s&&(d.can_submit=!0),n.value.status=="resulted"&&(d.can_approve=!0)}let{submitResults:Q,approveResults:W}=oe();const X=()=>Q([{uid:n.value.uid,result:n.value.result,methodUid:"felicity_ast",laboratoryInstrumentUid:"felicity_ast"}],"sample",D?.uid).then(()=>{}),Y=()=>W([n.value.uid],"sample",D?.uid).then(()=>{});return(s,a)=>(o(),l(w,null,[e("h3",ce,[me,n.value.status=="pending"?(o(),l("button",{key:0,onClick:a[0]||(a[0]=t=>z()),class:"ml-2 px-2 py-1 border-sky-800 border text-sky-800 rounded-sm transition duration-300 hover:bg-sky-800 hover:text-white focus:outline-none",disabled:u.value}," add organism ",8,pe)):h("",!0)]),ve,e("div",he,[e("div",be,[e("table",_e,[ge,e("tbody",ye,[(o(!0),l(w,null,S(i.value,(t,r)=>(o(),l("tr",{key:t?.uid},[e("td",fe,[e("div",xe,"#"+m(t?.isolateNumber),1)]),e("td",ke,[t?.organism?(o(),l("div",we,m(t?.organism?.name),1)):(o(),l("button",{key:1,class:"px-2 border-sky-800 border text-sky-800 rounded-sm transition duration-300 hover:bg-sky-800 hover:text-white focus:outline-none",onClick:k=>E(r)}," pick organism ",8,Oe))]),e("td",Ae,[t?.organism&&!t?.organismUid?(o(),l("span",Ce,[e("button",{class:"px-2 py-1 border-orange-800 border text-orange-800 rounded-sm transition duration-300 hover:bg-orange-800 hover:text-white focus:outline-none",onClick:k=>E(r)}," change ",8,Re),e("button",{class:"ml-2 px-2 py-1 border-sky-800 border text-sky-800 rounded-sm transition duration-300 hover:bg-sky-800 hover:text-white focus:outline-none",onClick:k=>G(t)}," save ",8,De)])):h("",!0),n.value.status=="pending"&&i.value.length>1?(o(),l("span",Ue,[e("button",{class:"px-2 py-1 border-orange-800 border text-orange-800 rounded-sm transition duration-300 hover:bg-orange-800 hover:text-white focus:outline-none",onClick:k=>q(t)}," delete ",8,Ee)])):h("",!0)])]))),128))])])])]),e("div",Se,[e("div",Te,[Ve,e("button",Ie,m(n.value.status),1)]),Ne,n.value.status=="pending"?b((o(),l("textarea",{key:0,name:"culture",id:"culture",class:"mt-2 p-2 w-full",rows:"2","onUpdate:modelValue":a[1]||(a[1]=t=>n.value.result=t)},null,512)),[[T,n.value.result]]):(o(),l("p",Pe,m(n.value.result),1))]),e("div",$e,[b(I(O(A),{key:"submit",onClick:P(X,["prevent"]),color:"orange-600"},{default:_(()=>[N("Submit culture")]),_:1},512),[[V,B(M.UPDATE,L.RESULT)&&d.can_submit&&g.sample.status!="submitting"]]),b(I(O(A),{key:"approve",onClick:P(Y,["prevent"]),color:"orange-600"},{default:_(()=>[N("Approve culture")]),_:1},512),[[V,B(M.UPDATE,L.RESULT)&&d.can_approve&&g.sample.status!="approving"]])]),p.value?(o(),ae(O(F),{key:0,onClose:a[3]||(a[3]=t=>p.value=!1),contentWidth:"w-1/2"},{header:_(()=>[je]),body:_(()=>[e("form",Be,[e("div",Le,[e("label",Me,[b(e("input",{"onUpdate:modelValue":a[2]||(a[2]=t=>v.value=t),onInput:K,class:"form-input mt-1 block w-full",placeholder:"Search organisms..."},null,544),[[T,v.value]])]),e("div",Fe,[e("table",ze,[(o(!0),l(w,null,S(R.value,t=>(o(),l("tr",{key:t.uid},[e("td",Ge,[e("div",qe,m(t.name),1)]),e("td",Je,[e("button",{onClick:r=>J(t),class:"px-2 py-1 border-sky-800 border text-sky-800 rounded-sm transition duration-300 hover:bg-sky-800 hover:text-white focus:outline-none"}," pick ",8,Ke)])]))),128))])])])])]),_:1})):h("",!0)],64))}}),et=ne(Qe,[["__file","/home/aurthurm/Documents/Development/felicity/felicity-lims/webapp/views/sample/_id/results/OrganismResults.vue"]]);export{et as default};
