const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/FelDataTable-CqqGlMhZ.js","assets/index-DApeomWQ.js","assets/index-CfJ_N7IC.css"])))=>i.map(i=>d[i]);
import{a0 as C,a as e,a1 as D,r as U,J as c,P as s,F as n,a9 as R,aa as b,a2 as g,f as P,a7 as k,g as x,h as N,a6 as q,a8 as y}from"./index-DApeomWQ.js";import{u as I,S as L,E as B,I as T}from"./inventory-0ZndIzIP.js";import{u as A}from"./setup-HNpvekU2.js";import{a as M}from"./inventory.queries-44x-54QB.js";import{a as f,o as m,s as _}from"./index-DmuM67UT.js";const E=D(()=>q(()=>import("./FelDataTable-CqqGlMhZ.js"),__vite__mapDeps([0,1,2]))),Q=C({name:"stock-orders",setup(t,u){const{withClientQuery:O,withClientMutation:p}=P(),w=A(),a=I();a.fetchStockOrders({first:50,after:"",text:"",status:"preparation",sortBy:["-uid"]});const i=k(!1),d=x({order:{},products:[],departmentUid:""}),v=async r=>{await O(M,{stockOrderUid:r},"stockOrderProductAll").then(o=>{d.products=o?.map(h=>({...h,issue:h.quantity}))})},S=k([{name:"UID",value:"uid",sortable:!0,sortBy:"asc",defaultSort:!0,showInToggler:!1,hidden:!0},{name:"Order Number",value:"orderNumber",sortable:!1,sortBy:"asc",hidden:!1,customRender:function(r){return y("span",{innerHTML:r?.orderNumber,onClick:()=>{d.order=r,d.departmentUid=r?.department?.uid,v(r?.uid),i.value=!0}},[])}},{name:"Department",value:"department.name",sortable:!1,sortBy:"asc",hidden:!1},{name:"Orderer",value:"orderBy",sortable:!1,sortBy:"asc",hidden:!1,customRender:function(r){return y("span",{innerHTML:`${r?.orderBy?.firstName??"---"} ${r?.orderBy?.lastName??""}`},[])}},{name:"Issued By",value:"status",sortable:!1,sortBy:"asc",hidden:!1},{name:"Status",value:"status",sortable:!1,sortBy:"asc",hidden:!1}]),l=x({first:50,before:"",text:"",sortBy:["-uid"],filterAction:!1,status:"preperation"});return{shield:_,tableColumns:S,inventoryStore:a,setupStore:w,slectedStockOrder:d,openDrawer:i,stockOrderParams:l,filterOptions:[{name:"All",value:""},{name:"Preperation",value:"preperation"},{name:"Submitted",value:"submitted"},{name:"Processed",value:"processed"}],filterStockOrders:r=>{l.first=50,l.before="",l.text=r.filterText,l.status=r.filterStatus,l.filterAction=!0,a.fetchStockOrders(l)},showMoreStockOrders:r=>{l.first=r.fetchCount,l.before=a.stockOrdersPaging?.pageInfo?.endCursor??"",l.text=r.filterText,l.status=r.filterStatus,l.filterAction=!1,a.fetchStockOrders(l)},countNone:N(()=>a.stockOrders?.length+" of "+a.stockOrdersPaging.totalCount+" orders"),issueOrder:()=>{const r=[];for(const o of d.products)r.push({productUid:o.product?.uid,stockLotUid:o.stockLot?.uid,quantity:o?.issue,remarks:"issue stock"});p(T,{uid:d?.order?.uid,payload:r},"issueStockOrder").then(o=>{a.issueStockOrder(o),i.value=!1})},removeOrderProduct:r=>{d.products=[...d.products.filter(o=>o?.product?.uid!==r)]},updateOrder:()=>{const r=[];for(const o of d.products)r.push({productUid:o?.product?.uid,stockLotUid:o?.stockLot?.uid,quantity:o?.quantity,remarks:""});p(B,{uid:d.order.uid,payload:{orderProducts:r,departmentUid:d.departmentUid}},"updateStockOrder").then(o=>{a.updateStockOrder(o?.stockOrder),i.value=!1})},submitOrder:()=>{p(L,{uid:d.order.uid},"submitStockOrder").then(r=>{a.updateStockOrder(r),i.value=!1})}}},render(){return e("div",{class:"mt-2"},[e(E,{columns:this.tableColumns,data:this.inventoryStore.stockOrders,toggleColumns:!1,loading:!1,paginable:!0,pageMeta:{fetchCount:10,hasNextPage:!1,countNone:this.countNone},searchable:!0,filterable:!0,filterMeta:{defaultFilter:this.stockOrderParams.status,filters:this.filterOptions},selectable:!1,onOnSearch:t=>this.filterStockOrders(t),onOnPaginate:t=>this.showMoreStockOrders(t)},null),e(U("fel-drawer"),{contentWidth:"w-1/2",show:this.openDrawer,onClose:()=>this.openDrawer=!1},{header:()=>`Order: ${this.slectedStockOrder?.order.orderNumber}`,body:()=>e(c,null,[this.slectedStockOrder?.order?.status=="preparation"&&e(c,null,[e("div",null,[s("Status: "),this.slectedStockOrder?.order?.status]),e("hr",null,null),e("label",{class:"flex justify-between items-center gap-4 mb-4"},[e("span",{class:"text-foreground"},[s("Department")]),n(e("select",{class:"form-select block w-full mt-1","onUpdate:modelValue":t=>this.slectedStockOrder.departmentUid=t},[this.setupStore.departments.map(t=>e("option",{value:t.uid},[t.name]))]),[[R,this.slectedStockOrder.departmentUid]])]),e("hr",null,null),e("div",{class:"overflow-x-auto mt-2 mb-4"},[e("div",{class:"align-middle inline-block min-w-full shadow overflow-hidden bg-background shadow-dashboard px-2 pt-1 rounded-bl-lg rounded-br-lg"},[e("table",{class:"min-w-full fel-table"},[e("thead",null,[e("tr",null,[e("th",{class:"px-1 py-1 border-b-2 border-border text-left leading-4 text-foreground tracking-wider"},[s("Product")]),e("th",{class:"px-1 py-1 border-b-2 border-border text-left leading-4 text-foreground tracking-wider"},[s("Lot")]),e("th",{class:"px-1 py-1 border-b-2 border-border text-left text-sm leading-4 text-foreground tracking-wider"},[s("Qty")]),e("th",{class:"px-1 py-1 border-b-2 border-border text-left leading-4 text-foreground tracking-wider"},null)])]),e("tbody",{class:"bg-background"},[this.slectedStockOrder.products.map(t=>n(e("tr",{key:t?.product?.uid},[e("td",null,[e("p",null,[t?.product?.name])]),e("td",null,[e("p",null,[t?.stockLot?.lotNumber,s(" ("),t?.stockLot?.quantity,s(")")])]),e("td",{class:"px-1 py-1"},[n(e("input",{class:"form-input",type:"number","onUpdate:modelValue":u=>t.quantity=u,placeholder:""},null),[[g,t.quantity]])]),e("td",{class:"px-1 whitespace-nowrap"},[e("button",{type:"button",class:"w-16 bg-primary text-primary-foreground rounded-sm leading-none px-2 py-1",onClick:()=>this.removeOrderProduct(t?.product?.uid??"")},[s("Remove")])])]),[[b("motion-slide-right")]]))])])])]),e("hr",null,null),e("div",{class:"my-2"},[e("p",{class:"italic text-destructive text-xs"},[s("If you made any changes here please update order first before finalising else your changes wont be saved")])]),e("hr",null,null),e("div",{class:"flex justify-start gap-x-4"},[e("button",{type:"button",onClick:()=>this.updateOrder(),class:"mt-4 bg-primary text-primary-foreground rounded-sm leading-none px-2 py-1 disabled:opacity-50 disabled:cursor-not-allowed",disabled:!this.shield.hasRights(f.ORDER,m.PRODUCT)},[s("Update")]),e("button",{type:"button",onClick:()=>this.submitOrder(),class:"mt-4 bg-primary text-primary-foreground rounded-sm leading-none px-2 py-1 disabled:opacity-50 disabled:cursor-not-allowed",disabled:!this.shield.hasRights(f.ORDER,m.PRODUCT)},[s("Finalize")])])]),["pending","submitted"].includes(this.slectedStockOrder?.order?.status??"")&&e(c,null,[e("div",null,[s("Status: "),this.slectedStockOrder?.order?.status]),e("hr",null,null),e("div",{class:"overflow-x-auto mt-4 mb-4"},[e("div",{class:"align-middle inline-block min-w-full shadow overflow-hidden bg-background shadow-dashboard px-2 pt-1 rounded-bl-lg rounded-br-lg"},[e("table",{class:"min-w-full fel-table"},[e("thead",null,[e("tr",null,[e("th",{class:"px-1 py-1 border-b-2 border-border text-left leading-4 text-foreground tracking-wider"},[s("Product")]),e("th",{class:"px-1 py-1 border-b-2 border-border text-left leading-4 text-foreground tracking-wider"},[s("Lot")]),e("th",{class:"px-1 py-1 border-b-2 border-border text-left text-sm leading-4 text-foreground tracking-wider"},[s("Available")]),e("th",{class:"px-1 py-1 border-b-2 border-border text-left text-sm leading-4 text-foreground tracking-wider"},[s("Requested")]),e("th",{class:"px-1 py-1 border-b-2 border-border text-left text-sm leading-4 text-foreground tracking-wider"},[s("Issue")]),e("th",{class:"px-1 py-1 border-b-2 border-border text-left leading-4 text-foreground tracking-wider"},null)])]),e("tbody",{class:"bg-background"},[this.slectedStockOrder.products.map(t=>n(e("tr",{key:t.uid},[e("td",null,[e("p",null,[t?.product?.name])]),e("td",null,[e("p",null,[t?.stockLot?.lotNumber])]),e("td",null,[e("p",null,[t?.stockLot?.quantity])]),e("td",null,[e("p",null,[t?.quantity])]),e("td",{class:"px-1 py-1 whitespace-nowrap"},[e("label",{class:"block"},[n(e("input",{class:"form-input",type:"number","onUpdate:modelValue":u=>t.issue=u,placeholder:""},null),[[g,t.issue]])])])]),[[b("motion-slide-right")]]))])])])]),e("hr",null,null),e("button",{type:"button",class:"mt-4 bg-primary text-primary-foreground rounded-sm leading-none px-2 py-1 disabled:opacity-50 disabled:cursor-not-allowed",disabled:!this.shield.hasRights(f.ISSUE,m.PRODUCT),onClick:()=>this.issueOrder()},[s("Issue Order")])]),["processed"].includes(this.slectedStockOrder?.order?.status??"")&&e(c,null,[e("div",null,[s("Status: "),this.slectedStockOrder?.order?.status]),e("hr",null,null),e("h4",null,[s("Request Details")]),e("hr",null,null),e("div",{class:"overflow-x-auto mt-4 mb-4"},[e("div",{class:"align-middle inline-block min-w-full shadow overflow-hidden bg-background shadow-dashboard px-2 pt-1 rounded-bl-lg rounded-br-lg"},[e("table",{class:"min-w-full fel-table"},[e("thead",null,[e("tr",null,[e("th",{class:"px-1 py-1 border-b-2 border-border text-left leading-4 text-foreground tracking-wider"},[s("Product Name")]),e("th",{class:"px-1 py-1 border-b-2 border-border text-left text-sm leading-4 text-foreground tracking-wider"},[s("Available")]),e("th",{class:"px-1 py-1 border-b-2 border-border text-left text-sm leading-4 text-foreground tracking-wider"},[s("Requested")]),e("th",{class:"px-1 py-1 border-b-2 border-border text-left leading-4 text-foreground tracking-wider"},null)])]),e("tbody",{class:"bg-background"},[this.slectedStockOrder.products.map(t=>n(e("tr",{key:t.uid},[e("td",null,[e("p",null,[t?.product?.name])]),e("td",null,null),e("td",null,[e("p",null,[t.quantity])])]),[[b("motion-slide-right")]]))])])])]),e("hr",null,null)])]),footer:()=>[]})])}});export{Q as InventoryOrders,Q as default};
