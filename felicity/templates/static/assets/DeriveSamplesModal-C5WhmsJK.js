const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/vue-multiselect.esm-Cvm3ZCjW.js","assets/index-OdhKCqIc.js","assets/index-DD18L2yL.css"])))=>i.map(i=>d[i]);
import{Y as z,P as L,u as Y,a7 as U,a0 as q,av as G,an as H,e as K,a5 as Q,a6 as J,_ as W,r as j,A as X,C as _,o as n,K as w,z as t,c as i,N as M,F as h,H as D,I as T,D as k,al as P,aG as F,a as y,M as Z}from"./index-OdhKCqIc.js";import{u as $}from"./analysis-PB9AMevg.js";import{Y as ee}from"./analyses.mutations-DUxQZn1r.js";const se=z({__name:"DeriveSamplesModal",props:{show:{type:Boolean,required:!0},samples:{type:Array,required:!0}},emits:["close","derived"],setup(A,{expose:e,emit:C}){e();const s=Q(()=>J(()=>import("./vue-multiselect.esm-Cvm3ZCjW.js"),__vite__mapDeps([0,1,2]))),v=A,S=C,b=L(),f=$(),{withClientMutation:l}=Y(),{toastSuccess:a,toastError:m}=K(),N=U(()=>b.getSampleTypes||[]),R=U(()=>f.getAnalysesServicesSimple||[]),B=U(()=>f.getAnalysesProfiles||[]),c=q("aliquot"),x=q([]),d=G({parents:[],sampleTypeUid:null,overrideTests:!1,profiles:[],analyses:[],notes:""}),V=q(!1),E=U(()=>x.value.length>1),I=()=>{x.value=v.samples.map(p=>({sample:p,quantity:1,sampleTypeUid:p.sampleType?.uid??null,overrideTests:!1,profiles:[],analyses:[],notes:""})),d.parents=[...v.samples],d.sampleTypeUid=v.samples[0]?.sampleType?.uid??null,d.overrideTests=!1,d.profiles=[],d.analyses=[],d.notes="",!E.value&&c.value==="pool"&&(c.value="aliquot")};H(()=>v.show,async p=>{p&&(N.value.length||await b.fetchSampleTypes(),(!B.value.length||!R.value.length)&&await f.fetchAnalysesProfilesAndServices(),I())});const O={VueMultiselect:s,props:v,emit:S,sampleStore:b,analysisStore:f,withClientMutation:l,toastSuccess:a,toastError:m,sampleTypes:N,analysesServices:R,analysesProfiles:B,deriveMode:c,deriveConfigs:x,poolConfig:d,deriveSaving:V,canPool:E,initConfig:I,submitDeriveRequest:async()=>{const p={};if(c.value==="aliquot"){const r=x.value.map(o=>({parentSampleUid:o.sample.uid,quantity:o.quantity,sampleTypeUid:o.sampleTypeUid,profiles:o.overrideTests?o.profiles.map(u=>u.uid):null,analyses:o.overrideTests?o.analyses.map(u=>u.uid):null,notes:o.notes||null,metadataSnapshot:null}));if(r.some(o=>(o.quantity??1)<1)){m("Aliquot quantity must be at least 1.");return}if(r.some(o=>o.profiles?.length===0&&o.analyses?.length===0)){m("Aliquot overrides must include at least one profile or analysis.");return}p.aliquots=r}else if(c.value==="derivative"){const r=x.value.map(o=>({parentSampleUid:o.sample.uid,quantity:o.quantity,sampleTypeUid:o.sampleTypeUid,profiles:o.overrideTests?o.profiles.map(u=>u.uid):null,analyses:o.overrideTests?o.analyses.map(u=>u.uid):null,notes:o.notes||null,metadataSnapshot:null}));if(r.some(o=>!o.sampleTypeUid)){m("Derivative sample type is required.");return}if(r.some(o=>(o.quantity??1)<1)){m("Derivative quantity must be at least 1.");return}if(r.some(o=>o.profiles?.length===0&&o.analyses?.length===0)){m("Derivative overrides must include at least one profile or analysis.");return}p.derivatives=r}else{const r=d.parents.map(g=>g.uid);if(r.length<2){m("Pools require at least two parent samples.");return}const o=d.overrideTests?d.profiles.map(g=>g.uid):null,u=d.overrideTests?d.analyses.map(g=>g.uid):null;if(o?.length===0&&u?.length===0){m("Pool overrides must include at least one profile or analysis.");return}p.pools=[{parentSampleUids:r,sampleTypeUid:d.sampleTypeUid,profiles:o,analyses:u,notes:d.notes||null,metadataSnapshot:null}]}V.value=!0;try{const r=await l(ee,{payload:p},"deriveAnalysisRequest");r?.samples?.length&&(S("derived",r.samples),a("Derived samples created successfully.")),S("close")}catch(r){m(`Failed to derive samples: ${r instanceof Error?r.message:"Unknown error"}`)}finally{V.value=!1}}};return Object.defineProperty(O,"__isScriptSetup",{enumerable:!1,value:!0}),O}}),le={class:"space-y-6"},te={class:"flex flex-wrap gap-2"},oe=["disabled"],ae={key:0,class:"space-y-4"},re={class:"flex items-center justify-between"},de={class:"font-medium text-foreground"},ne={class:"text-xs text-muted-foreground"},ie={class:"grid grid-cols-1 md:grid-cols-3 gap-4"},ue=["onUpdate:modelValue"],me={class:"text-sm font-medium text-foreground"},pe=["onUpdate:modelValue"],ye={key:0,value:null},ve={key:1,disabled:"",value:null},be=["value"],fe={class:"flex items-center gap-2 pt-6"},ce={key:0,class:"grid grid-cols-1 md:grid-cols-2 gap-4"},xe=["onUpdate:modelValue"],ge={key:1,class:"space-y-4"},Te=["value"],ke={class:"flex items-center gap-2"},Se={key:0,class:"grid grid-cols-1 md:grid-cols-2 gap-4"},Ue={class:"flex justify-end gap-3"},Ce=["disabled"];function Ve(A,e,C,s,v,S){const b=j("Checkbox"),f=j("Modal");return C.show?(n(),X(f,{key:0,onClose:e[10]||(e[10]=l=>s.emit("close")),"content-width":"w-4/5"},{header:w(()=>[...e[11]||(e[11]=[Z(" Derive Samples ",-1)])]),body:w(()=>[t("div",le,[t("div",te,[t("button",{type:"button",class:M(["px-3 py-1.5 rounded-md border text-sm",s.deriveMode==="aliquot"?"bg-primary text-primary-foreground border-primary":"bg-background border-border text-foreground"]),onClick:e[0]||(e[0]=l=>s.deriveMode="aliquot")}," Aliquot ",2),t("button",{type:"button",class:M(["px-3 py-1.5 rounded-md border text-sm",s.deriveMode==="derivative"?"bg-primary text-primary-foreground border-primary":"bg-background border-border text-foreground"]),onClick:e[1]||(e[1]=l=>s.deriveMode="derivative")}," Derivative ",2),t("button",{type:"button",class:M(["px-3 py-1.5 rounded-md border text-sm",[s.deriveMode==="pool"?"bg-primary text-primary-foreground border-primary":"bg-background border-border text-foreground",s.canPool?"":"opacity-50 cursor-not-allowed"]]),disabled:!s.canPool,onClick:e[2]||(e[2]=l=>s.deriveMode="pool")}," Pool ",10,oe)]),s.deriveMode!=="pool"?(n(),i("div",ae,[(n(!0),i(h,null,D(s.deriveConfigs,l=>(n(),i("div",{key:l.sample.uid,class:"rounded-md border border-border p-4 space-y-4"},[t("div",re,[t("div",de,T(l.sample.sampleId),1),t("div",ne,T(l.sample.sampleType?.name),1)]),t("div",ie,[t("div",null,[e[12]||(e[12]=t("label",{class:"text-sm font-medium text-foreground"},"Quantity",-1)),k(t("input",{"onUpdate:modelValue":a=>l.quantity=a,type:"number",min:"1",class:"mt-1 w-full rounded-md border border-border bg-background px-3 py-2 text-sm"},null,8,ue),[[P,l.quantity,void 0,{number:!0}]])]),t("div",null,[t("label",me,T(s.deriveMode==="derivative"?"Sample Type (required)":"Sample Type (optional)"),1),k(t("select",{"onUpdate:modelValue":a=>l.sampleTypeUid=a,class:"mt-1 w-full rounded-md border border-border bg-background px-3 py-2 text-sm"},[s.deriveMode==="aliquot"?(n(),i("option",ye,"Use parent sample type")):(n(),i("option",ve,"Select sample type")),(n(!0),i(h,null,D(s.sampleTypes,a=>(n(),i("option",{key:a.uid,value:a.uid},T(a.name),9,be))),128))],8,pe),[[F,l.sampleTypeUid]])]),t("div",fe,[y(b,{checked:l.overrideTests,"onUpdate:checked":a=>l.overrideTests=a},null,8,["checked","onUpdate:checked"]),e[13]||(e[13]=t("span",{class:"text-sm text-foreground"},"Override tests",-1))])]),l.overrideTests?(n(),i("div",ce,[t("div",null,[e[14]||(e[14]=t("label",{class:"text-sm font-medium text-foreground"},"Profiles",-1)),y(s.VueMultiselect,{modelValue:l.profiles,"onUpdate:modelValue":a=>l.profiles=a,options:s.analysesProfiles,label:"name","track-by":"uid",multiple:!0,placeholder:"Select profiles",class:"multiselect-primary"},null,8,["modelValue","onUpdate:modelValue","options"])]),t("div",null,[e[15]||(e[15]=t("label",{class:"text-sm font-medium text-foreground"},"Analyses",-1)),y(s.VueMultiselect,{modelValue:l.analyses,"onUpdate:modelValue":a=>l.analyses=a,options:s.analysesServices,label:"name","track-by":"uid",multiple:!0,placeholder:"Select analyses",class:"multiselect-primary"},null,8,["modelValue","onUpdate:modelValue","options"])])])):_("",!0),t("div",null,[e[16]||(e[16]=t("label",{class:"text-sm font-medium text-foreground"},"Notes",-1)),k(t("input",{"onUpdate:modelValue":a=>l.notes=a,type:"text",class:"mt-1 w-full rounded-md border border-border bg-background px-3 py-2 text-sm"},null,8,xe),[[P,l.notes]])])]))),128))])):(n(),i("div",ge,[t("div",null,[e[17]||(e[17]=t("label",{class:"text-sm font-medium text-foreground"},"Parent Samples (min 2)",-1)),y(s.VueMultiselect,{modelValue:s.poolConfig.parents,"onUpdate:modelValue":e[3]||(e[3]=l=>s.poolConfig.parents=l),options:s.deriveConfigs.map(l=>l.sample),label:"sampleId","track-by":"uid",multiple:!0,placeholder:"Select parent samples",class:"multiselect-primary"},null,8,["modelValue","options"])]),t("div",null,[e[19]||(e[19]=t("label",{class:"text-sm font-medium text-foreground"},"Sample Type (optional)",-1)),k(t("select",{"onUpdate:modelValue":e[4]||(e[4]=l=>s.poolConfig.sampleTypeUid=l),class:"mt-1 w-full rounded-md border border-border bg-background px-3 py-2 text-sm"},[e[18]||(e[18]=t("option",{value:null},"Use first parent sample type",-1)),(n(!0),i(h,null,D(s.sampleTypes,l=>(n(),i("option",{key:l.uid,value:l.uid},T(l.name),9,Te))),128))],512),[[F,s.poolConfig.sampleTypeUid]])]),t("div",ke,[y(b,{checked:s.poolConfig.overrideTests,"onUpdate:checked":e[5]||(e[5]=l=>s.poolConfig.overrideTests=l)},null,8,["checked"]),e[20]||(e[20]=t("span",{class:"text-sm text-foreground"},"Override tests",-1))]),s.poolConfig.overrideTests?(n(),i("div",Se,[t("div",null,[e[21]||(e[21]=t("label",{class:"text-sm font-medium text-foreground"},"Profiles",-1)),y(s.VueMultiselect,{modelValue:s.poolConfig.profiles,"onUpdate:modelValue":e[6]||(e[6]=l=>s.poolConfig.profiles=l),options:s.analysesProfiles,label:"name","track-by":"uid",multiple:!0,placeholder:"Select profiles",class:"multiselect-primary"},null,8,["modelValue","options"])]),t("div",null,[e[22]||(e[22]=t("label",{class:"text-sm font-medium text-foreground"},"Analyses",-1)),y(s.VueMultiselect,{modelValue:s.poolConfig.analyses,"onUpdate:modelValue":e[7]||(e[7]=l=>s.poolConfig.analyses=l),options:s.analysesServices,label:"name","track-by":"uid",multiple:!0,placeholder:"Select analyses",class:"multiselect-primary"},null,8,["modelValue","options"])])])):_("",!0),t("div",null,[e[23]||(e[23]=t("label",{class:"text-sm font-medium text-foreground"},"Notes",-1)),k(t("input",{"onUpdate:modelValue":e[8]||(e[8]=l=>s.poolConfig.notes=l),type:"text",class:"mt-1 w-full rounded-md border border-border bg-background px-3 py-2 text-sm"},null,512),[[P,s.poolConfig.notes]])])]))])]),footer:w(()=>[t("div",Ue,[t("button",{type:"button",class:"px-4 py-2 text-sm font-medium text-foreground bg-background border border-border rounded-md shadow-sm hover:bg-muted",onClick:e[9]||(e[9]=l=>s.emit("close"))}," Cancel "),t("button",{type:"button",class:"px-4 py-2 text-sm font-medium text-primary-foreground bg-primary border border-transparent rounded-md shadow-sm hover:bg-primary/90 disabled:opacity-60",disabled:s.deriveSaving,onClick:s.submitDeriveRequest}," Create ",8,Ce)])]),_:1})):_("",!0)}const he=W(se,[["render",Ve],["__scopeId","data-v-70d4f653"],["__file","/home/administrator/Documents/Development/beak-insights/felicity/felicity-lims/webapp/components/sample/DeriveSamplesModal.vue"]]);export{he as default};
