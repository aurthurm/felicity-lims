import{P as ye,u as he,e as ve,h as fe,Z as r,aa as xe,R as be,r as ge,o as u,c as i,F as c,D as m,b as l,E as y,L as b,A as p,C as g,a4 as B,V as W,a1 as Ae,a as T,W as Ue,K as A,z as P,a2 as M,x as Re,J as G,X as J,Y as K,S as we,_ as Ce}from"./index-fa13e788.js";import{u as Se}from"./analysis-265e51d4.js";import{h as F,o as L,a as N}from"./constants-68671847.js";import{G as Ve,b as Te,c as Pe,d as Me,e as je,f as De,U as Ee}from"./microbiology.mutations-652bcc63.js";import"./analyses.mutations-bfee3c87.js";const Ye=l("h3",{class:"flex justify-between items-center mt-4"},[l("span",{class:"font-bold"},"AST Panel")],-1),ke=l("hr",{class:"mt-1"},null,-1),Be={class:"flex justify-between items-center"},Ge={class:"font-bold"},Fe={class:"italic"},Le=["onClick"],Ne={class:"overflow-x-auto"},Ie={class:"min-w-full divide-y divide-gray-200"},$e={class:"bg-gray-50"},qe=l("th",{class:"px-4 py-2 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"},"Parameter",-1),ze={class:"bg-white divide-y divide-gray-200"},We=l("td",{class:"px-4 py-2 text-sm font-medium text-gray-900"},"Guideline",-1),Je=["onUpdate:modelValue","onChange","disabled"],Ke=["value"],Qe=l("td",{class:"px-4 py-2 text-sm font-medium text-gray-900"},"AST Method",-1),Xe=["onUpdate:modelValue","onChange","disabled"],Ze=["value"],He=l("td",{class:"px-4 py-2 text-sm font-medium text-gray-900"},"AST Value",-1),Oe=["onUpdate:modelValue","onChange","disabled"],et=l("td",{class:"px-4 py-2 text-sm font-medium text-gray-900"},"Result",-1),tt=["onUpdate:modelValue","onChange","disabled"],st=l("option",{value:"S"},"S",-1),lt=l("option",{value:"I"},"I",-1),at=l("option",{value:"R"},"R",-1),nt=[st,lt,at],ot={class:"ml-2 text-xs text-gray-400"},ut=l("td",{class:"px-4 py-2 text-sm font-medium text-gray-900"},"Reportable",-1),it=["onUpdate:modelValue","onChange","disabled"],dt={type:"button",class:"bg-sky-800 text-white ml-4 px-2 py-1 rounded-sm leading-none"},rt={class:"mt-2"},ct={class:"italic font-semibold"},pt={class:"w-full"},mt={class:"block mb-4"},_t={class:"border p-2 h-64 overflow-y-auto"},yt={class:"w-full"},ht={class:"px-1 py-1 whitespace-no-wrap border-b border-gray-500"},vt={class:"text-sm leading-5 text-gray-800 font-bold"},ft={class:"px-1 py-1 whitespace-no-wrap border-b border-gray-500"},xt={class:"text-sm leading-5 text-gray-800"},bt={class:"px-1 py-1 whitespace-no-wrap text-right border-b border-gray-500 text-sm leading-5"},gt=["onClick"],At={key:0},Ut=l("td",{colspan:"3",class:"px-4 py-3 text-center text-sm text-gray-500"}," Loading panels... ",-1),Rt=[Ut],wt={key:1},Ct=l("td",{colspan:"3",class:"px-4 py-3 text-center text-sm text-gray-500"}," No panels found ",-1),St=[Ct],Vt=ye({__name:"ASTResults",props:{sample:{type:Object,required:!0},organismAnalysisResults:{type:Object,required:!0}},setup(Q){const X=J(()=>K(()=>import("./index-fa13e788.js").then(s=>s.cN),["assets/index-fa13e788.js","assets/index-ccc6a521.css"])),j=J(()=>K(()=>import("./FelButton-1d1ff19a.js"),["assets/FelButton-1d1ff19a.js","assets/index-fa13e788.js","assets/index-ccc6a521.css"])),{sample:_,organismAnalysisResults:Z}=Q,D=he(),{withClientMutation:I,withClientQuery:v}=ve(),H=fe(()=>Z[0]),U=r([]),R=r([]),$=r([]),q=r([]);xe(()=>{v(Ve,{analysisResultUid:H.value.uid},"abxOrganismResultAll").then(s=>{s&&(R.value=s||[])}).finally(()=>V()),S(),v(Te,{},"abxGuidelineYearAll").then(s=>{s&&($.value=s||[])}),v(Pe,{},"abxTestMethodAll").then(s=>{s&&(q.value=s||[])})});const w=r(!1),C=r(!1),E=r(""),Y=r([]),f=r();function S(){v(Me,{sampleUid:_.uid},"abxAstResultAll").then(s=>{s&&(U.value=s||[])}).finally(()=>V())}function O(s){f.value=s,w.value=!0}function ee(s){const a=n.value[s.uid];return a?Object.values(a)?.every(d=>d.status=="pending"):!1}function te(){C.value=!0,v(je,{organismUid:f.value?.uid,text:E.value},"abxAstPanelFilter").then(s=>{s&&(Y.value=s||[])}).finally(()=>{C.value=!1})}function se(s){w.value=!1,we.fire({title:"Are you sure?",text:"You want to apply panel: "+s.name+" to organism: "+f.value?.organism?.name,icon:"warning",showCancelButton:!0,confirmButtonColor:"#3085d6",cancelButtonColor:"#d33",confirmButtonText:"Yes, apply now!",cancelButtonText:"No, do not apply!"}).then(async a=>{a.isConfirmed&&I(De,{payload:{organismResultUid:f.value?.uid,panelUid:s.uid,sampleUid:_.uid}},"applyAbxAstPanel").then(d=>{d?.astResults?.forEach(e=>U.value.push(e)),V()})})}const n=r({});function V(){const s={};R.value?.forEach(a=>{s[a.uid]={},(U.value?.filter(e=>e.organismResultUid===a.uid)).forEach(e=>{e.antibiotic?.name&&(s[a.uid][e.antibiotic.name+" "+e.antibiotic.potency]={uid:e.uid,analResultUid:e.analysisResultUid,status:e.analysisResult?.status,astMethodUid:e.astMethodUid,guidelineYearUid:e.guidelineYearUid,breakpointUid:e.breakpointUid,astValue:e.astValue,result:e.analysisResult?.result,reportable:e.analysisResult?.reportable,dirty:!1})})}),n.value=s}be([R,U],()=>{V()});const h=s=>Object.keys(n.value[s]||{});let{submitResults:le,approveResults:ae}=Se();function ne(s){const a=n.value[s];if(!a)return!1;const d=Object.values(a)?.some(t=>t.dirty&&t.status=="pending"),e=Object.values(a)?.some(t=>t.guidelineYearUid&&t.astMethodUid&&t.astValue);return d&&e}function oe(s){const a=n.value[s];return(Object.values(a)?.filter(t=>t.dirty&&t.status=="pending")).filter(t=>t.guidelineYearUid&&t.astMethodUid&&t.astValue).map(({dirty:t,breakpointUid:o,analResultUid:z,status:Tt,..._e})=>_e)}const k=r(!1);function ue(s){k.value=!0;const a=oe(s);I(Ee,{payload:{results:a}},"updateAbxAstResults").then(()=>{D.fetchAnalysisResultsForSample(_.uid),S()}).finally(()=>k.value=!1)}function ie(s){const a=n.value[s];if(!a)return!1;const d=Object.values(a)?.some(t=>t.dirty),e=Object.values(a)?.some(t=>t.guidelineYearUid&&t.astMethodUid&&t.astValue&&t.result&&t.status=="pending");return!d&&e&&_.status!="submitting"}function de(s){const a=n.value[s];return(Object.values(a)?.filter(t=>!t.dirty)).filter(t=>t.guidelineYearUid&&t.astMethodUid&&t.astValue&&t.result&&t.status=="pending").map(({dirty:t,breakpointUid:o,...z})=>z)}function re(s){const d=de(s).map(e=>({uid:e.analResultUid,result:e.result,reportable:e.reportable,methodUid:"felicity_ast",laboratoryInstrumentUid:"felicity_ast"}));le(d,"sample",_?.uid).then(()=>{D.fetchAnalysisResultsForSample(_.uid),S()})}function ce(s){const a=n.value[s];if(!a)return!1;const d=Object.values(a)?.some(t=>t.dirty),e=Object.values(a)?.some(t=>t.status=="resulted");return!d&&e&&_.status!="approving"}function pe(s){const a=n.value[s];return(Object.values(a)?.filter(e=>!e.dirty)).filter(e=>e.status=="resulted")}function me(s){const d=pe(s).map(e=>e.analResultUid);ae(d,"sample",_?.uid).then(()=>{D.fetchAnalysisResultsForSample(_.uid),S()})}async function x(s,a,d,e){n.value[s][a],n.value[s][a].dirty=!0,n.value[s][a]={...n.value[s][a],[d]:e}}return(s,a)=>{const d=ge("font-awesome-icon");return u(),i(c,null,[Ye,ke,(u(!0),i(c,null,m(R.value,e=>(u(),i("div",{key:e.uid,class:"mb-4"},[l("h3",Be,[l("span",null,[l("span",Ge,"Organism #"+y(e?.isolateNumber),1),b(": "),l("span",Fe,y(e?.organism?.name),1)]),p(l("button",{onClick:t=>O(e),class:"ml-2 px-2 py-1 border-sky-800 border text-sky-800 rounded-sm transition duration-300 hover:bg-sky-800 hover:text-white focus:outline-none"}," choose panel ",8,Le),[[g,ee(e)]])]),l("div",Ne,[l("table",Ie,[l("thead",null,[l("tr",$e,[qe,(u(!0),i(c,null,m(h(e.uid),t=>(u(),i("th",{key:t,class:"px-4 py-2 text-left text-xs font-medium text-gray-500 tracking-wider"},y(t),1))),128))])]),l("tbody",ze,[l("tr",null,[We,(u(!0),i(c,null,m(h(e.uid),t=>(u(),i("td",{key:t,class:"px-4 py-2 text-sm text-gray-500"},[p(l("select",{"onUpdate:modelValue":o=>n.value[e.uid][t].guidelineYearUid=o,onChange:o=>x(e.uid,t,"guidelineYearUid",o.target.value),class:"w-32 px-2 py-1 border rounded",disabled:n.value[e.uid][t].status!=="pending"},[(u(!0),i(c,null,m($.value,o=>(u(),i("option",{key:o.uid,value:o.uid},y(o.code),9,Ke))),128))],40,Je),[[B,n.value[e.uid][t].guidelineYearUid]])]))),128))]),l("tr",null,[Qe,(u(!0),i(c,null,m(h(e.uid),t=>(u(),i("td",{key:t,class:"px-4 py-2 text-sm text-gray-500"},[p(l("select",{"onUpdate:modelValue":o=>n.value[e.uid][t].astMethodUid=o,onChange:o=>x(e.uid,t,"astMethodUid",o.target.value),class:"w-32 px-2 py-1 border rounded",disabled:n.value[e.uid][t].status!=="pending"},[(u(!0),i(c,null,m(q.value,o=>(u(),i("option",{key:o.uid,value:o.uid},y(o.name),9,Ze))),128))],40,Xe),[[B,n.value[e.uid][t].astMethodUid]])]))),128))]),l("tr",null,[He,(u(!0),i(c,null,m(h(e.uid),t=>(u(),i("td",{key:t,class:"px-4 py-2 text-sm text-gray-500"},[p(l("input",{type:"number","onUpdate:modelValue":o=>n.value[e.uid][t].astValue=o,onChange:o=>x(e.uid,t,"astValue",o.target.value),class:"w-32 px-2 py-1 border rounded",step:"0.1",disabled:n.value[e.uid][t].status!=="pending"},null,40,Oe),[[W,n.value[e.uid][t].astValue]])]))),128))]),l("tr",null,[et,(u(!0),i(c,null,m(h(e.uid),t=>(u(),i("td",{key:t,class:"px-4 py-2 text-sm"},[p(l("select",{"onUpdate:modelValue":o=>n.value[e.uid][t].result=o,onChange:o=>x(e.uid,t,"result",o.target.value),class:Ae(["w-32 px-2 py-1 border rounded",{"text-green-600":n.value[e.uid][t].result?.toUpperCase()==="S","text-yellow-600":n.value[e.uid][t].result?.toUpperCase()==="I","text-red-600":n.value[e.uid][t].result?.toUpperCase()==="R"}]),disabled:n.value[e.uid][t].status!=="pending"},[...nt],42,tt),[[B,n.value[e.uid][t].result]]),l("span",ot,[p(l("span",null,[T(d,{icon:"robot",class:"text-md text-gray-400 mr-1"})],512),[[g,n.value[e.uid][t].breakpointUid]])])]))),128))]),l("tr",null,[ut,(u(!0),i(c,null,m(h(e.uid),t=>(u(),i("td",{key:t,class:"px-4 py-2 text-sm"},[p(l("input",{type:"checkbox","onUpdate:modelValue":o=>n.value[e.uid][t].reportable=o,onChange:o=>x(e.uid,t,"reportable",o.target.checked),class:"form-checkbox h-4 w-4 text-sky-600",disabled:n.value[e.uid][t].status!=="pending"},null,40,it),[[Ue,n.value[e.uid][t].reportable]]),l("button",dt,y(n.value[e.uid][t].status),1)]))),128))])])]),l("div",rt,[p(T(M(j),{key:"button",onClick:P(t=>ue(e.uid),["prevent"]),color:"orange-600",disabled:k.value},{default:A(()=>[b("Save Antibiotics")]),_:2},1032,["onClick","disabled"]),[[g,F(N.UPDATE,L.RESULT)&&ne(e.uid)]]),p(T(M(j),{key:"button",onClick:P(t=>re(e.uid),["prevent"]),color:"orange-600"},{default:A(()=>[b("Submit Antibiotics")]),_:2},1032,["onClick"]),[[g,F(N.UPDATE,L.RESULT)&&ie(e.uid)]]),p(T(M(j),{key:"button",onClick:P(t=>me(e.uid),["prevent"]),color:"orange-600"},{default:A(()=>[b("Approve Antibiotics")]),_:2},1032,["onClick"]),[[g,F(N.UPDATE,L.RESULT)&&ce(e.uid)]])])])]))),128)),w.value?(u(),Re(M(X),{key:0,onClose:a[1]||(a[1]=e=>w.value=!1),contentWidth:"w-1/2"},{header:A(()=>[l("h3",null,[b("Search Panel for "),l("span",ct,y(f.value?.organism?.name),1)])]),body:A(()=>[l("form",{class:"",onSubmit:P(e=>({}),["prevent"])},[l("div",pt,[l("label",mt,[p(l("input",{"onUpdate:modelValue":a[0]||(a[0]=e=>E.value=e),onInput:te,class:"form-input mt-1 block w-full",placeholder:"Begin typing..."},null,544),[[W,E.value]])]),l("div",_t,[l("table",yt,[(u(!0),i(c,null,m(Y.value,e=>(u(),i("tr",{key:e.uid},[l("td",ht,[l("div",vt,y(e.name),1)]),l("td",ft,[l("div",xt,y(e.antibiotics?.map(t=>t.name)?.join(", ")),1)]),l("td",bt,[l("button",{type:"button",onClick:t=>se(e),class:"px-2 py-1 border-sky-800 border text-sky-800 rounded-sm transition duration-300 hover:bg-sky-800 hover:text-white focus:outline-none"}," Appy Panel ",8,gt)])]))),128)),C.value?(u(),i("tr",At,[...Rt])):G("",!0),!C.value&&Y.value.length===0?(u(),i("tr",wt,[...St])):G("",!0)])])])],32)]),_:1})):G("",!0)],64)}}}),Yt=Ce(Vt,[["__file","/home/aurthurm/Documents/Development/felicity/felicity-lims/webapp/views/sample/_id/results/ASTResults.vue"]]);export{Yt as default};
