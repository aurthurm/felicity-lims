const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/FelDataTable-BRszqkhZ.js","assets/index-v7Q387fb.js","assets/index-c4lX_LAY.css"])))=>i.map(i=>d[i]);
import{f as Z,i as $,a0 as ue,aq as fe,a7 as f,ad as me,a5 as ge,a1 as pe,a6 as be,a8 as J,_ as ye,r as X,aa as j,c as m,o as l,A as e,C as N,E as P,F as c,H as E,L as a,D as x,J as T,K as q,P as k,a as V,N as u,Q as w,a9 as ve,a2 as A}from"./index-v7Q387fb.js";import{u as xe}from"./billing-BJXnGQ6y.js";import{g as _e,C as he,h as we}from"./billing.mutations-BnVxQIQJ.js";import{I as Ce,l as Be}from"./billing.queries-DcwlyfmJ.js";import{c as Te,a as L,d as ke,u as Ve,b as O}from"./index.esm-D-THTBXR.js";function Ae(){const{withClientQuery:C}=Z(),{swalConfirm:s,toastSuccess:i,toastError:o}=$();return{downloadInvoice:async p=>{try{if((await s("You want to download this invoice","Are you sure?")).isConfirmed){const r=await C(Ce,{billUid:p},"billInvoiceCreate","network-only");if(r){const b=document.createElement("a");b.href=`data:application/pdf;base64,${r}`,b.setAttribute("download","invoice-report.pdf"),b.click(),i("Invoice downloaded successfully")}}}catch(d){o(`Failed to download invoice: ${d instanceof Error?d.message:"Unknown error"}`)}}}}const De=ue({__name:"BillDetail",props:{customerUid:{type:String,required:!0},testBill:{type:Object,required:!0}},setup(C,{expose:s}){s();const i=pe(()=>be(()=>import("./FelDataTable-BRszqkhZ.js"),__vite__mapDeps([0,1,2]))),o=C,{toastSuccess:_}=$(),{withClientMutation:p,withClientQuery:d}=Z(),r=xe(),{transactions:b,fetchingTransactions:D}=fe(r),M=f(["cash","medical-aid","e-payment"]),t=f(!1);me(()=>{g(o.testBill)}),ge(()=>o.testBill,n=>{n?.uid&&(console.log("testBill changed",n.uid),g(n))},{deep:!0});const g=n=>{S.value=[],r.fetchBillTransactions(n.uid),R(n.uid)},S=f([]),R=async n=>{const v=await d(Be,{uid:n},"ordersByBillUid");S.value=v};function ee(n,v){let F=[];return n.forEach(I=>F.push(I.name)),v.forEach(I=>F.push(I.name)),F.join(", ")}const Y=Te({testBillUid:L().required(),kind:L().required(),amount:ke().required(),notes:L()}),{handleSubmit:K,errors:se,setFieldValue:h}=Ve({validationSchema:Y,initialValues:{testBillUid:o.testBill?.uid}}),{value:oe}=O("kind"),{value:te}=O("amount"),{value:ne}=O("notes"),y=f(!1),ie=K(n=>{y.value=!0,Q(n)}),ae=()=>{o.testBill?.uid&&(h("testBillUid",o.testBill?.uid),h("kind","cash"),h("amount",Math.ceil(Number((o.testBill?.totalCharged-o.testBill?.totalPaid).toFixed(2)))),h("notes",""),t.value=!0)},Q=n=>{p(_e,{payload:n},"createTestBillTransaction").then(v=>{r.addTransaction(v),y.value=!1,t.value=!1,_("Transaction added.")})},U=f(!1),B=f({}),re=()=>{y.value=!0,p(he,{uid:B.value.uid,notes:B.value.notes},"confirmTestBillTransaction").then(n=>{r.updateTransaction(n),y.value=!1,U.value=!1,_("Transaction confirmed.")})},le=f([{name:"Kind",value:"kind",sortable:!0,sortBy:"asc",defaultSort:!0,showInToggler:!1,hidden:!1},{name:"Amount",value:"amount",sortable:!1,sortBy:"asc",hidden:!1},{name:"Success",value:"isSuccess",sortable:!1,sortBy:"asc",hidden:!1},{name:"Notes",value:"notes",sortable:!1,sortBy:"asc",hidden:!1},{name:"Message",value:"message",sortable:!1,sortBy:"asc",hidden:!1},{name:"Processed",value:"processed",sortable:!1,sortBy:"asc",hidden:!1,customRender:function(n,v){return J("span",{innerHTML:n.processed?"Yes":"Pending confirmation"},[])}},{name:"Action",sortable:!1,hidden:!1,customRender:(n,v)=>{if(!n.processed)return J("button",{onClick(){U.value=!0,B.value=n},type:"button",class:"bg-primary text-primary-foreground py-1 px-2 rounded-sm leading-none"},"confirm")}}]),W=f(!1),H=f({code:""}),de=()=>{W.value=!0},ce=()=>{y.value=!0,p(we,{payload:{voucherCode:H.value?.code,testBillUid:o.testBill?.uid,customerUid:o.customerUid}},"applyVoucher").then(n=>y.value=!1)},{downloadInvoice:z}=Ae(),G={DataTable:i,props:o,toastSuccess:_,withClientMutation:p,withClientQuery:d,billingStore:r,transactions:b,fetchingTransactions:D,kinds:M,showTransactionModal:t,selectTestBill:g,orders:S,getOrders:R,profileAnalysesText:ee,transactionSchema:Y,handleSubmit:K,errors:se,setFieldValue:h,kind:oe,amount:te,notes:ne,processing:y,submitTransactionForm:ie,newTransaction:ae,addTransaction:Q,showConfirmTransactionModal:U,confirmTransaction:B,submitConfirmTransaction:re,tableColumns:le,showVoucherModal:W,voucherCodeForm:H,applyVoucher:de,submitVoucherCodeForm:ce,downloadInvoice:z,invoice:async n=>await z(n.uid)};return Object.defineProperty(G,"__isScriptSetup",{enumerable:!1,value:!0}),G}}),Me={class:"space-y-6"},Se={initial:{opacity:0,y:-100},enter:{opacity:1,y:0,scale:1},variants:{custom:{scale:2}},delay:400,class:"col-span-9 space-y-6"},Ue={class:"bg-background rounded-lg shadow-sm p-6 space-y-4"},Fe={class:"flex justify-between items-center"},Ie={class:"text-lg font-semibold text-foreground"},je={class:"grid grid-cols-3 gap-8"},Ne={class:"space-y-4"},Pe={class:"flex justify-between items-center"},Ee={class:"text-sm text-foreground"},qe={class:"flex justify-between items-center"},Le={class:"text-sm text-foreground"},Oe={class:"space-y-4"},Re={class:"flex justify-between items-center"},Ye={class:"text-sm text-foreground"},Ke={class:"flex justify-between items-center"},Qe={class:"text-sm text-foreground"},We={class:"space-y-4"},He={class:"flex justify-between items-center"},ze={class:"text-sm text-foreground"},Ge={class:"space-y-4"},Je={class:"flex justify-between items-center"},Xe={class:"bg-background rounded-lg shadow-sm p-6 space-y-4"},Ze={class:"font-semibold text-foreground"},$e={class:"text-muted-foreground"},es={class:"ml-2 text-primary"},ss={class:"space-y-4"},os={class:"flex justify-between items-center"},ts={class:"space-x-4"},ns={class:"bg-background rounded-lg shadow-sm p-6"},is={class:"space-y-6 p-6"},as={class:"grid grid-cols-2 gap-6"},rs={class:"space-y-2"},ls=["disabled"],ds=["value"],cs={class:"text-sm text-destructive"},us={class:"space-y-2"},fs=["disabled"],ms={class:"space-y-2"},gs=["disabled"],ps={class:"flex justify-end"},bs={class:"space-y-6 p-6"},ys={class:"text-lg font-medium text-foreground"},vs={class:"space-y-2"},xs=["disabled"],_s={class:"flex justify-end"},hs={class:"space-y-6 p-6"},ws={class:"space-y-2"},Cs=["disabled"],Bs={class:"flex justify-end"};function Ts(C,s,i,o,_,p){const d=X("fel-button"),r=X("fel-modal"),b=j("motion-slide-top"),D=j("motion-slide-right"),M=j("motion");return l(),m(T,null,[e("div",Me,[c((l(),m("section",Se,[c((l(),m("div",Ue,[e("div",Fe,[e("h4",Ie,a(i.testBill.billId?.toLocaleUpperCase()),1)]),e("div",je,[e("div",Ne,[e("div",Pe,[s[9]||(s[9]=e("span",{class:"text-sm font-medium text-foreground"},"Active:",-1)),e("span",Ee,a(i.testBill.isActive?"Yes":"No"),1)]),e("div",qe,[s[10]||(s[10]=e("span",{class:"text-sm font-medium text-foreground"},"Confirmed:",-1)),e("span",Le,a(i.testBill?.toConfirm?"No":"Yes"),1)])]),e("div",Oe,[e("div",Re,[s[11]||(s[11]=e("span",{class:"text-sm font-medium text-foreground"},"Total Charged:",-1)),e("span",Ye,a(i.testBill?.totalCharged),1)]),e("div",Ke,[s[12]||(s[12]=e("span",{class:"text-sm font-medium text-foreground"},"Total Paid:",-1)),e("span",Qe,a(i.testBill?.totalPaid),1)])]),e("div",We,[e("div",He,[s[13]||(s[13]=e("span",{class:"text-sm font-medium text-foreground"},"Partial:",-1)),e("span",ze,a(i.testBill?.totalPaid<i.testBill?.totalCharged?"Yes":"No"),1)])])])])),[[b]]),e("div",Ge,[e("div",Je,[s[14]||(s[14]=e("h4",{class:"text-lg font-semibold text-foreground"},"Order Items",-1)),e("button",{class:"px-4 py-2 bg-primary text-primary-foreground rounded-md hover:bg-primary/90 transition-colors duration-200 focus:outline-none focus:ring-2 focus:ring-primary/50",onClick:s[0]||(s[0]=x(t=>o.invoice(i.testBill),["prevent"]))}," Invoice ")]),e("ul",Xe,[(l(!0),m(T,null,q(o.orders,t=>(l(),m("li",{class:"space-y-2",key:t.uid},[e("div",Ze,a(t?.requestId)+" ("+a(t?.clientRequestId)+")",1),(l(!0),m(T,null,q(t.samples,g=>c((l(),m("div",{class:"space-y-1 pl-4",key:g.uid},[e("span",$e,a(g.sampleId),1),s[15]||(s[15]=k(" â‡’ ",-1)),e("span",es,a(o.profileAnalysesText(g.profiles??[],g.analyses??[])),1)])),[[D]])),128))]))),128))])]),e("div",ss,[e("div",os,[s[16]||(s[16]=e("h4",{class:"text-lg font-semibold text-foreground"},"Transactions",-1)),e("div",ts,[c(e("button",{class:"px-4 py-2 bg-primary text-primary-foreground rounded-md hover:bg-primary/90 transition-colors duration-200 focus:outline-none focus:ring-2 focus:ring-primary/50",onClick:x(o.newTransaction,["prevent"])}," Add Transaction ",512),[[E,i.testBill.isActive]]),c(e("button",{class:"px-4 py-2 bg-primary text-primary-foreground rounded-md hover:bg-primary/90 transition-colors duration-200 focus:outline-none focus:ring-2 focus:ring-primary/50",onClick:x(o.applyVoucher,["prevent"])}," Apply Voucher ",512),[[E,i.testBill.isActive]])])]),e("div",ns,[V(o.DataTable,{columns:o.tableColumns,data:o.transactions,toggleColumns:!1,loading:o.fetchingTransactions,paginable:!1,searchable:!1,filterable:!1,selectable:!1},{footer:u(()=>[...s[17]||(s[17]=[])]),_:1},8,["columns","data","loading"])])])])),[[E,i.testBill.uid],[M]])]),o.showTransactionModal?(l(),N(r,{key:0,onClose:s[4]||(s[4]=t=>o.showTransactionModal=!1),contentWidth:"w-3/6",class:"bg-background"},{header:u(()=>[...s[18]||(s[18]=[e("h3",{class:"text-xl font-semibold text-foreground"},"Transaction Form",-1)])]),body:u(()=>[e("form",is,[e("div",as,[e("label",rs,[s[20]||(s[20]=e("span",{class:"text-sm font-medium text-foreground"},"Kind of payment",-1)),c(e("select",{class:w(["w-full rounded-md border border-input bg-background px-3 py-2 text-sm ring-offset-background focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2",{"border-destructive":o.errors.kind}]),"onUpdate:modelValue":s[1]||(s[1]=t=>o.kind=t),disabled:o.processing},[s[19]||(s[19]=e("option",null,null,-1)),(l(!0),m(T,null,q(o.kinds,t=>(l(),m("option",{key:t,value:t},a(t),9,ds))),128))],10,ls),[[ve,o.kind]]),e("div",cs,a(o.errors.gender),1)]),e("label",us,[s[21]||(s[21]=e("span",{class:"text-sm font-medium text-foreground"},"Amount",-1)),c(e("input",{class:w(["w-full rounded-md border border-input bg-background px-3 py-2 text-sm ring-offset-background focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2",{"border-destructive":o.errors.amount}]),type:"number","onUpdate:modelValue":s[2]||(s[2]=t=>o.amount=t),disabled:o.processing},null,10,fs),[[A,o.amount]])])]),e("label",ms,[s[22]||(s[22]=e("span",{class:"text-sm font-medium text-foreground"},"Notes",-1)),c(e("input",{class:w(["w-full rounded-md border border-input bg-background px-3 py-2 text-sm ring-offset-background focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2",{"border-destructive":o.errors.notes}]),"onUpdate:modelValue":s[3]||(s[3]=t=>o.notes=t),disabled:o.processing},null,10,gs),[[A,o.notes]])]),e("div",ps,[V(d,{color:"primary",type:"submit",loading:o.processing,onClick:x(o.submitTransactionForm,["prevent"])},{default:u(()=>[...s[23]||(s[23]=[k(" Save Transaction ",-1)])]),_:1},8,["loading","onClick"])])])]),_:1})):P("",!0),o.showConfirmTransactionModal?(l(),N(r,{key:1,onClose:s[6]||(s[6]=t=>o.showConfirmTransactionModal=!1),contentWidth:"w-3/6",class:"bg-background"},{header:u(()=>[...s[24]||(s[24]=[e("h3",{class:"text-xl font-semibold text-foreground"},"Confirm Transaction",-1)])]),body:u(()=>[e("form",bs,[e("h4",ys,a(o.kind)+" Transaction",1),e("label",vs,[s[25]||(s[25]=e("span",{class:"text-sm font-medium text-foreground"},"Notes",-1)),c(e("input",{class:w(["w-full rounded-md border border-input bg-background px-3 py-2 text-sm ring-offset-background focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2",{"border-destructive":o.errors.notes}]),"onUpdate:modelValue":s[5]||(s[5]=t=>o.confirmTransaction.notes=t),disabled:o.processing},null,10,xs),[[A,o.confirmTransaction.notes]])]),e("div",_s,[V(d,{color:"primary",type:"submit",loading:o.processing,onClick:x(o.submitConfirmTransaction,["prevent"])},{default:u(()=>[...s[26]||(s[26]=[k(" Confirm Transaction ",-1)])]),_:1},8,["loading"])])])]),_:1})):P("",!0),o.showVoucherModal?(l(),N(r,{key:2,onClose:s[8]||(s[8]=t=>o.showVoucherModal=!1),contentWidth:"w-1/5",class:"bg-background"},{header:u(()=>[...s[27]||(s[27]=[e("h3",{class:"text-xl font-semibold text-foreground"},"Apply Voucher Code",-1)])]),body:u(()=>[e("form",hs,[e("label",ws,[s[28]||(s[28]=e("span",{class:"text-sm font-medium text-foreground"},"Voucher Code",-1)),c(e("input",{class:w(["w-full rounded-md border border-input bg-background px-3 py-2 text-sm ring-offset-background focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2",{"border-destructive":!o.voucherCodeForm.code}]),type:"text","onUpdate:modelValue":s[7]||(s[7]=t=>o.voucherCodeForm.code=t),disabled:o.processing},null,10,Cs),[[A,o.voucherCodeForm.code]])]),e("div",Bs,[V(d,{color:"primary",type:"submit",loading:o.processing,onClick:x(o.submitVoucherCodeForm,["prevent"])},{default:u(()=>[...s[29]||(s[29]=[k(" Apply Voucher ",-1)])]),_:1},8,["loading"])])])]),_:1})):P("",!0)],64)}const Us=ye(De,[["render",Ts],["__scopeId","data-v-3a43e177"],["__file","/home/administrator/Documents/Development/beak-insights/felicity/felicity-lims/webapp/components/billing/BillDetail.vue"]]);export{Us as default};
