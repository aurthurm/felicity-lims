import{f as ee,j as se,S as we,u as ke,ah as G,a0 as f,i as Ce,a1 as J,r as Y,aj as K,o as a,c as d,N as s,C as u,a5 as i,a as C,F as T,E as D,a3 as v,H as l,D as W,A as g,M as F,L as c,y as H,ac as O,a2 as Te,X as N,K as z,Z as Be,$ as Ae,_ as Ve}from"./index-54016222.js";import{I as Se,u as Ue,g as Ie,C as je,h as Pe}from"./billing-395bc348.js";import{p as De}from"./index-f9df72b1.js";import{c as Fe,a as Q,b as Ne,u as Me,e as X}from"./array-7d74d738.js";function $e(){const{withClientQuery:M}=ee(),{swalConfirm:$,toastSuccess:B,toastError:A}=se();return{downloadInvoice:async m=>{try{if((await $("You want to download this invoice","Are you sure?")).isConfirmed){const y=await M(Se,{billUid:m},"billInvoiceCreate","network-only");if(y){const _=document.createElement("a");_.href=`data:application/pdf;base64,${y}`,_.setAttribute("download","invoice-report.pdf"),_.click(),B("Invoice downloaded successfully")}}}catch(b){A(`Failed to download invoice: ${b instanceof Error?b.message:"Unknown error"}`)}}}}const Ee={class:"space-y-6"},Re={class:"grid grid-cols-12 gap-6"},Le={initial:{opacity:0,y:100},enter:{opacity:1,y:0,scale:1},variants:{custom:{scale:2}},delay:400,class:"col-span-3 overflow-y-auto overscroll-contain billing-scroll"},qe={key:0,class:"py-4 text-center bg-background w-full mb-2 rounded-lg shadow-sm border border-border"},Ye={key:1},Ke={class:"space-y-2"},We=["onClick"],He={class:"space-y-1"},Oe={class:"font-semibold text-foreground"},ze={class:"text-sm text-muted-foreground"},Qe={initial:{opacity:0,y:-100},enter:{opacity:1,y:0,scale:1},variants:{custom:{scale:2}},delay:400,class:"col-span-9 space-y-6"},Xe={class:"bg-background rounded-lg shadow-sm p-6 space-y-4"},Ze={class:"flex justify-between items-center"},Ge={class:"text-lg font-semibold text-foreground"},Je={class:"grid grid-cols-3 gap-8"},es={class:"space-y-4"},ss={class:"flex justify-between items-center"},ts={class:"text-sm text-foreground"},os={class:"flex justify-between items-center"},ns={class:"text-sm text-foreground"},as={class:"space-y-4"},is={class:"flex justify-between items-center"},ls={class:"text-sm text-foreground"},rs={class:"flex justify-between items-center"},ds={class:"text-sm text-foreground"},us={class:"space-y-4"},cs={class:"flex justify-between items-center"},fs={class:"text-sm text-foreground"},ms={class:"space-y-4"},ps={class:"flex justify-between items-center"},vs={class:"bg-background rounded-lg shadow-sm p-6 space-y-4"},gs={class:"font-semibold text-foreground"},bs={class:"text-muted-foreground"},ys={class:"ml-2 text-primary"},_s={class:"space-y-4"},xs={class:"flex justify-between items-center"},hs={class:"space-x-4"},ws={class:"bg-background rounded-lg shadow-sm p-6"},ks={class:"space-y-6 p-6"},Cs={class:"grid grid-cols-2 gap-6"},Ts={class:"space-y-2"},Bs=["disabled"],As=["value"],Vs={class:"text-sm text-destructive"},Ss={class:"space-y-2"},Us=["disabled"],Is={class:"space-y-2"},js=["disabled"],Ps={class:"flex justify-end"},Ds={class:"space-y-6 p-6"},Fs={class:"text-lg font-medium text-foreground"},Ns={class:"space-y-2"},Ms=["disabled"],$s={class:"flex justify-end"},Es={class:"space-y-6 p-6"},Rs={class:"space-y-2"},Ls=["disabled"],qs={class:"flex justify-end"},Ys=we({__name:"PatientBill",props:{patientUid:String},setup(M){const $=Be(()=>Ae(()=>import("./FelDataTable-2adf0c3f.js"),["assets/FelDataTable-2adf0c3f.js","assets/index-54016222.js","assets/index-a1ed10d8.css"])),B=M,{toastSuccess:A}=se(),{withClientMutation:V}=ee(),m=Ue(),b=ke(),{bills:y,fetchingBills:_,transactions:te,fetchingTransactions:oe}=G(m),{analysisRequests:ne}=G(b);m.fetchBillsForPatient(B?.patientUid);const ae=f(["cash","medical-aid","e-payment"]),S=f(!1),n=f({}),ie=o=>{n.value={...o},m.fetchBillTransactions(o.uid)},le=Ce(()=>{const o=n?.value?.orders?.map(e=>e.uid)??[];return ne?.value?.filter(e=>o.includes(e.uid))});function re(o,e){let w=[];return o.forEach(p=>w.push(p.name)),e.forEach(p=>w.push(p.name)),w.join(", ")}const de=Fe({testBillUid:Q().required(),kind:Q().required(),amount:Ne().required(),notes:Q()}),{handleSubmit:ue,errors:x,setFieldValue:U}=Me({validationSchema:de,initialValues:{testBillUid:n.value?.uid}}),{value:I}=X("kind"),{value:E}=X("amount"),{value:R}=X("notes"),r=f(!1),ce=ue(o=>{r.value=!0,me(o)}),fe=()=>{U("testBillUid",n.value?.uid),U("kind","cash"),U("amount",Math.ceil(Number((n?.value?.totalCharged-n?.value?.totalPaid).toFixed(2)))),U("notes",""),S.value=!0},me=o=>{V(Ie,{payload:o},"createTestBillTransaction").then(e=>{m.addTransaction(e),r.value=!1,S.value=!1,A("Transaction added.")})},j=f(!1),h=f({}),pe=()=>{r.value=!0,V(je,{uid:h.value.uid,notes:h.value.notes},"confirmTestBillTransaction").then(o=>{m.updateTransaction(o),r.value=!1,j.value=!1,A("Transaction confirmed.")})},ve=f([{name:"Kind",value:"kind",sortable:!0,sortBy:"asc",defaultSort:!0,showInToggler:!1,hidden:!1},{name:"Amount",value:"amount",sortable:!1,sortBy:"asc",hidden:!1},{name:"Success",value:"isSuccess",sortable:!1,sortBy:"asc",hidden:!1},{name:"Notes",value:"notes",sortable:!1,sortBy:"asc",hidden:!1},{name:"Message",value:"message",sortable:!1,sortBy:"asc",hidden:!1},{name:"Processed",value:"processed",sortable:!1,sortBy:"asc",hidden:!1,customRender:function(o,e){return J("span",{innerHTML:o.processed?"Yes":"Pending confirmation"},[])}},{name:"Action",sortable:!1,hidden:!1,customRender:(o,e)=>{if(!o.processed)return J("button",{onClick(){j.value=!0,h.value=o},type:"button",class:"bg-primary text-primary-foreground py-1 px-2 rounded-sm leading-none"},"confirm")}}]),L=f(!1),P=f({code:""}),ge=()=>{L.value=!0},be=()=>{r.value=!0,V(Pe,{payload:{voucherCode:P.value?.code,testBillUid:n.value?.uid,customerUid:B.patientUid}},"applyVoucher").then(o=>r.value=!1)},{downloadInvoice:ye}=$e(),_e=async o=>await ye(o.uid);return(o,e)=>{const w=Y("fel-loader"),p=Y("fel-button"),q=Y("fel-modal"),Z=K("motion"),xe=K("motion-slide-top"),he=K("motion-slide-right");return a(),d(T,null,[s("div",Ee,[s("div",Re,[u((a(),d("section",Le,[i(_)?(a(),d("div",qe,[C(w,{message:"Fetching bills ..."})])):(a(),d("div",Ye,[s("ul",Ke,[(a(!0),d(T,null,D(i(y),t=>(a(),d("li",{key:t.uid,class:v(["bg-background w-full p-3 rounded-lg shadow-sm border border-border transition-all duration-200 hover:shadow-md",{"border-primary bg-primary/5":t.uid===n.value.uid}]),onClick:k=>ie(t)},[s("div",He,[s("div",Oe," Bill "+l(t.billId?.toLocaleUpperCase()),1),s("div",ze,l(i(De)(t.createdAt)),1)])],10,We))),128))])]))])),[[Z]]),u((a(),d("section",Qe,[u((a(),d("div",Xe,[s("div",Ze,[s("h4",Ge,l(n.value.billId?.toLocaleUpperCase()),1)]),s("div",Je,[s("div",es,[s("div",ss,[e[9]||(e[9]=s("span",{class:"text-sm font-medium text-foreground"},"Active:",-1)),s("span",ts,l(n.value.isActive?"Yes":"No"),1)]),s("div",os,[e[10]||(e[10]=s("span",{class:"text-sm font-medium text-foreground"},"Confirmed:",-1)),s("span",ns,l(n.value?.toConfirm?"No":"Yes"),1)])]),s("div",as,[s("div",is,[e[11]||(e[11]=s("span",{class:"text-sm font-medium text-foreground"},"Total Charged:",-1)),s("span",ls,l(n.value?.totalCharged),1)]),s("div",rs,[e[12]||(e[12]=s("span",{class:"text-sm font-medium text-foreground"},"Total Paid:",-1)),s("span",ds,l(n.value?.totalPaid),1)])]),s("div",us,[s("div",cs,[e[13]||(e[13]=s("span",{class:"text-sm font-medium text-foreground"},"Partial:",-1)),s("span",fs,l(n.value?.totalPaid<n.value?.totalCharged?"Yes":"No"),1)])])])])),[[xe]]),s("div",ms,[s("div",ps,[e[14]||(e[14]=s("h4",{class:"text-lg font-semibold text-foreground"},"Order Items",-1)),s("button",{class:"px-4 py-2 bg-primary text-primary-foreground rounded-md hover:bg-primary/90 transition-colors duration-200 focus:outline-none focus:ring-2 focus:ring-primary/50",onClick:e[0]||(e[0]=g(t=>_e(n.value),["prevent"]))}," Invoice ")]),s("ul",vs,[(a(!0),d(T,null,D(le.value,t=>(a(),d("li",{class:"space-y-2",key:t.uid},[s("div",gs,l(t?.requestId)+" ("+l(t?.clientRequestId)+")",1),(a(!0),d(T,null,D(t.samples,k=>u((a(),d("div",{class:"space-y-1 pl-4",key:k.uid},[s("span",bs,l(k.sampleId),1),e[15]||(e[15]=F(" â‡’ ")),s("span",ys,l(re(k.profiles??[],k.analyses??[])),1)])),[[he]])),128))]))),128))])]),s("div",_s,[s("div",xs,[e[16]||(e[16]=s("h4",{class:"text-lg font-semibold text-foreground"},"Transactions",-1)),s("div",hs,[u(s("button",{class:"px-4 py-2 bg-primary text-primary-foreground rounded-md hover:bg-primary/90 transition-colors duration-200 focus:outline-none focus:ring-2 focus:ring-primary/50",onClick:g(fe,["prevent"])}," Add Transaction ",512),[[W,n.value.isActive]]),u(s("button",{class:"px-4 py-2 bg-primary text-primary-foreground rounded-md hover:bg-primary/90 transition-colors duration-200 focus:outline-none focus:ring-2 focus:ring-primary/50",onClick:g(ge,["prevent"])}," Apply Voucher ",512),[[W,n.value.isActive]])])]),s("div",ws,[C(i($),{columns:ve.value,data:i(te),toggleColumns:!1,loading:i(oe),paginable:!1,searchable:!1,filterable:!1,selectable:!1},{footer:c(()=>e[17]||(e[17]=[])),_:1},8,["columns","data","loading"])])])])),[[W,i(y)?.length>0&&n.value.uid],[Z]])])]),S.value?(a(),H(q,{key:0,onClose:e[4]||(e[4]=t=>S.value=!1),contentWidth:"w-3/6",class:"bg-background"},{header:c(()=>e[18]||(e[18]=[s("h3",{class:"text-xl font-semibold text-foreground"},"Transaction Form",-1)])),body:c(()=>[s("form",ks,[s("div",Cs,[s("label",Ts,[e[20]||(e[20]=s("span",{class:"text-sm font-medium text-foreground"},"Kind of payment",-1)),u(s("select",{class:v(["w-full rounded-md border border-input bg-background px-3 py-2 text-sm ring-offset-background focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2",{"border-destructive":i(x).kind}]),"onUpdate:modelValue":e[1]||(e[1]=t=>O(I)?I.value=t:null),disabled:r.value},[e[19]||(e[19]=s("option",null,null,-1)),(a(!0),d(T,null,D(ae.value,t=>(a(),d("option",{key:t,value:t},l(t),9,As))),128))],10,Bs),[[Te,i(I)]]),s("div",Vs,l(i(x).gender),1)]),s("label",Ss,[e[21]||(e[21]=s("span",{class:"text-sm font-medium text-foreground"},"Amount",-1)),u(s("input",{class:v(["w-full rounded-md border border-input bg-background px-3 py-2 text-sm ring-offset-background focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2",{"border-destructive":i(x).amount}]),type:"number","onUpdate:modelValue":e[2]||(e[2]=t=>O(E)?E.value=t:null),disabled:r.value},null,10,Us),[[N,i(E)]])])]),s("label",Is,[e[22]||(e[22]=s("span",{class:"text-sm font-medium text-foreground"},"Notes",-1)),u(s("input",{class:v(["w-full rounded-md border border-input bg-background px-3 py-2 text-sm ring-offset-background focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2",{"border-destructive":i(x).notes}]),"onUpdate:modelValue":e[3]||(e[3]=t=>O(R)?R.value=t:null),disabled:r.value},null,10,js),[[N,i(R)]])]),s("div",Ps,[C(p,{color:"primary",type:"submit",loading:r.value,onClick:g(i(ce),["prevent"])},{default:c(()=>e[23]||(e[23]=[F(" Save Transaction ")])),_:1},8,["loading","onClick"])])])]),_:1})):z("",!0),j.value?(a(),H(q,{key:1,onClose:e[6]||(e[6]=t=>j.value=!1),contentWidth:"w-3/6",class:"bg-background"},{header:c(()=>e[24]||(e[24]=[s("h3",{class:"text-xl font-semibold text-foreground"},"Confirm Transaction",-1)])),body:c(()=>[s("form",Ds,[s("h4",Fs,l(i(I))+" Transaction",1),s("label",Ns,[e[25]||(e[25]=s("span",{class:"text-sm font-medium text-foreground"},"Notes",-1)),u(s("input",{class:v(["w-full rounded-md border border-input bg-background px-3 py-2 text-sm ring-offset-background focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2",{"border-destructive":i(x).notes}]),"onUpdate:modelValue":e[5]||(e[5]=t=>h.value.notes=t),disabled:r.value},null,10,Ms),[[N,h.value.notes]])]),s("div",$s,[C(p,{color:"primary",type:"submit",loading:r.value,onClick:g(pe,["prevent"])},{default:c(()=>e[26]||(e[26]=[F(" Confirm Transaction ")])),_:1},8,["loading"])])])]),_:1})):z("",!0),L.value?(a(),H(q,{key:2,onClose:e[8]||(e[8]=t=>L.value=!1),contentWidth:"w-1/5",class:"bg-background"},{header:c(()=>e[27]||(e[27]=[s("h3",{class:"text-xl font-semibold text-foreground"},"Apply Voucher Code",-1)])),body:c(()=>[s("form",Es,[s("label",Rs,[e[28]||(e[28]=s("span",{class:"text-sm font-medium text-foreground"},"Voucher Code",-1)),u(s("input",{class:v(["w-full rounded-md border border-input bg-background px-3 py-2 text-sm ring-offset-background focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2",{"border-destructive":!P.value.code}]),type:"text","onUpdate:modelValue":e[7]||(e[7]=t=>P.value.code=t),disabled:r.value},null,10,Ls),[[N,P.value.code]])]),s("div",qs,[C(p,{color:"primary",type:"submit",loading:r.value,onClick:g(be,["prevent"])},{default:c(()=>e[29]||(e[29]=[F(" Apply Voucher ")])),_:1},8,["loading"])])])]),_:1})):z("",!0)],64)}}});const zs=Ve(Ys,[["__scopeId","data-v-afb0e1b5"],["__file","/Users/admin/Documents/Development/felicity/felicity-lims/webapp/views/patient/_id/PatientBill.vue"]]);export{zs as default};
