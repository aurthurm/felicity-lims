import{a0 as I,f as T,a7 as a,h as U,a5 as k,ad as V,_ as j,r as D,c as n,o as l,A as e,F as y,a2 as E,a9 as M,P as S,a3 as L,a as O,L as c,E as A,J as B,K as F}from"./index-v7Q387fb.js";import{c as Q}from"./inventory.queries-Cv6dYn2a.js";const q=I({__name:"Inventory",setup(N,{expose:t}){t();const{withClientQuery:h}=T(),r=a(!1),u=a(null),x=a([]),f=a(""),o=a(!1),p=a(!1),g=a("100"),b=U(()=>{let s=x.value;return p.value?s=s.filter(i=>i.reorderNow):o.value&&(s=s.filter(i=>i.lowStock||i.reorderNow)),s}),K=()=>{if(b.value.length===0)return;const i=[["product_name","current_stock","minimum_level","maximum_level","reorder_point","reorder_quantity","low_stock","reorder_now"].join(",")];b.value.forEach(d=>{const R=[d.productName,d.currentStock,d.minimumLevel,d.maximumLevel,d.reorderPoint,d.reorderQuantity,d.lowStock,d.reorderNow].map(C=>`"${String(C).replace(/"/g,'""')}"`);i.push(R.join(","))});const P=new Blob([i.join(`
`)],{type:"text/csv;charset=utf-8;"}),v=document.createElement("a");v.href=URL.createObjectURL(P),v.download=`inventory-kpis-${new Date().toISOString().slice(0,10)}.csv`,v.click(),URL.revokeObjectURL(v.href)},_=async()=>{r.value=!0,u.value=null;try{const s=await h(Q,{text:f.value||void 0,limit:g.value==="all"?void 0:Number(g.value)},"inventoryKpis","network-only");Array.isArray(s)?x.value=s:(x.value=[],u.value="Invalid inventory KPI data received")}catch(s){const i=s instanceof Error?s.message:"Failed to load inventory KPIs";u.value=i}finally{r.value=!1}};let m=null;k([f,g],()=>{m&&clearTimeout(m),m=setTimeout(()=>{_()},300)}),k([o,p],()=>{p.value&&(o.value=!1)}),V(()=>{_()});const w={withClientQuery:h,loading:r,error:u,kpis:x,filterText:f,showLowStock:o,showReorderNow:p,limit:g,filteredKpis:b,exportCsv:K,fetchKpis:_,get fetchTimer(){return m},set fetchTimer(s){m=s}};return Object.defineProperty(w,"__isScriptSetup",{enumerable:!1,value:!0}),w}}),G={class:"mt-4 space-y-4"},J={class:"flex flex-wrap items-center gap-3"},z={class:"flex items-center gap-2"},H={class:"flex items-center gap-2"},W={class:"flex items-center gap-2 text-sm text-foreground"},X={class:"flex items-center gap-2 text-sm text-foreground"},Y=["disabled"],Z={key:0,class:"text-start my-4"},$={key:1,class:"text-sm text-destructive"},ee={key:2,class:"overflow-x-auto border border-border rounded-lg"},te={class:"min-w-full divide-y divide-border"},oe={class:"divide-y divide-border"},re={class:"px-4 py-3 text-sm text-foreground"},se={class:"px-4 py-3 text-sm text-right text-foreground"},ne={class:"px-4 py-3 text-sm text-right text-foreground"},le={class:"px-4 py-3 text-sm text-right text-foreground"},ie={class:"px-4 py-3 text-sm text-right text-foreground"},de={class:"px-4 py-3 text-sm text-right text-foreground"},ae={class:"px-4 py-3 text-sm"},ce={key:0,class:"inline-flex items-center rounded-full bg-destructive/10 text-destructive px-2 py-0.5 text-xs font-semibold"},ue={key:1,class:"inline-flex items-center rounded-full bg-warning/10 text-warning px-2 py-0.5 text-xs font-semibold"},xe={key:2,class:"inline-flex items-center rounded-full bg-emerald-50 text-emerald-600 px-2 py-0.5 text-xs font-semibold"},fe={key:0};function me(N,t,h,r,u,x){const f=D("fel-loader");return l(),n("div",G,[e("div",J,[e("div",z,[t[4]||(t[4]=e("label",{class:"text-sm font-medium text-foreground"},"Search",-1)),y(e("input",{"onUpdate:modelValue":t[0]||(t[0]=o=>r.filterText=o),type:"text",placeholder:"Product name",class:"px-3 py-2 border border-input bg-background text-foreground rounded-lg focus:outline-none focus:ring-2 focus:ring-ring"},null,512),[[E,r.filterText]])]),e("div",H,[t[6]||(t[6]=e("label",{class:"text-sm font-medium text-foreground"},"Limit",-1)),y(e("select",{"onUpdate:modelValue":t[1]||(t[1]=o=>r.limit=o),class:"px-3 py-2 border border-input bg-background text-foreground rounded-lg focus:outline-none focus:ring-2 focus:ring-ring"},[...t[5]||(t[5]=[e("option",{value:"50"},"50",-1),e("option",{value:"100"},"100",-1),e("option",{value:"200"},"200",-1),e("option",{value:"all"},"All",-1)])],512),[[M,r.limit]])]),e("label",W,[y(e("input",{"onUpdate:modelValue":t[2]||(t[2]=o=>r.showLowStock=o),type:"checkbox",class:"h-4 w-4"},null,512),[[L,r.showLowStock]]),t[7]||(t[7]=S(" Low stock ",-1))]),e("label",X,[y(e("input",{"onUpdate:modelValue":t[3]||(t[3]=o=>r.showReorderNow=o),type:"checkbox",class:"h-4 w-4"},null,512),[[L,r.showReorderNow]]),t[8]||(t[8]=S(" Reorder now ",-1))]),e("button",{type:"button",class:"ml-auto px-3 py-2 text-sm font-medium rounded-lg border border-input bg-background text-foreground hover:bg-muted transition-colors focus:outline-none focus:ring-2 focus:ring-ring",disabled:r.filteredKpis.length===0,onClick:r.exportCsv}," Export CSV ",8,Y)]),r.loading?(l(),n("div",Z,[O(f,{message:"Fetching inventory KPIs..."})])):r.error?(l(),n("div",$,c(r.error),1)):(l(),n("div",ee,[e("table",te,[t[10]||(t[10]=e("thead",{class:"bg-muted"},[e("tr",null,[e("th",{class:"px-4 py-3 text-left text-xs font-semibold text-muted-foreground"},"Product"),e("th",{class:"px-4 py-3 text-right text-xs font-semibold text-muted-foreground"},"Current"),e("th",{class:"px-4 py-3 text-right text-xs font-semibold text-muted-foreground"},"Min"),e("th",{class:"px-4 py-3 text-right text-xs font-semibold text-muted-foreground"},"Max"),e("th",{class:"px-4 py-3 text-right text-xs font-semibold text-muted-foreground"},"Reorder Point"),e("th",{class:"px-4 py-3 text-right text-xs font-semibold text-muted-foreground"},"ROQ"),e("th",{class:"px-4 py-3 text-left text-xs font-semibold text-muted-foreground"},"Status")])],-1)),e("tbody",oe,[(l(!0),n(B,null,F(r.filteredKpis,o=>(l(),n("tr",{key:o.productUid},[e("td",re,c(o.productName),1),e("td",se,c(o.currentStock),1),e("td",ne,c(o.minimumLevel),1),e("td",le,c(o.maximumLevel),1),e("td",ie,c(o.reorderPoint),1),e("td",de,c(o.reorderQuantity),1),e("td",ae,[o.reorderNow?(l(),n("span",ce," Reorder now ")):o.lowStock?(l(),n("span",ue," Low stock ")):(l(),n("span",xe," OK "))])]))),128)),r.filteredKpis.length===0?(l(),n("tr",fe,[...t[9]||(t[9]=[e("td",{colspan:"7",class:"px-4 py-6 text-center text-sm text-muted-foreground"}," No KPI records found. ",-1)])])):A("",!0)])])]))])}const ve=j(q,[["render",me],["__file","/home/administrator/Documents/Development/beak-insights/felicity/felicity-lims/webapp/views/dashboard/Inventory.vue"]]);export{ve as default};
