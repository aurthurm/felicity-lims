import{P as R,e as O,Z as r,aa as K,h as q,o as l,c as n,b as s,J as g,E as u,F as J,D as Q,a1 as Y,a0 as B,L as Z,_ as X}from"./index-e1b11e1a.js";import{m as I,D as ee,n as te,o as se}from"./grind.queries-1a91591d.js";import{M as U}from"./schema-f3233b53.js";const oe={class:"flex justify-between items-start"},le={class:"w-3/4 pr-4"},ne={key:0,class:"py-6 text-center text-gray-500 bg-gray-50 rounded-lg border border-dashed border-gray-300"},ae={key:1,class:"mb-3 p-3 bg-red-50 text-red-700 rounded-md"},re={key:2,class:"space-y-2"},ie={class:"file-icon mr-3 text-blue-500 flex-shrink-0"},de={key:0,xmlns:"http://www.w3.org/2000/svg",class:"h-6 w-6",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},ue={key:1,xmlns:"http://www.w3.org/2000/svg",class:"h-6 w-6",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},ce={key:2,xmlns:"http://www.w3.org/2000/svg",class:"h-6 w-6",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},ve={key:3,xmlns:"http://www.w3.org/2000/svg",class:"h-6 w-6",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},pe={key:4,xmlns:"http://www.w3.org/2000/svg",class:"h-6 w-6",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},he={class:"flex-grow min-w-0 mr-3"},ge=["title"],me={class:"text-sm text-gray-500 flex items-center gap-2"},we={class:"flex gap-2 flex-shrink-0"},fe=["onClick"],xe=["onClick","disabled"],ke={key:0,class:"animate-spin h-5 w-5",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24"},ye={key:1,xmlns:"http://www.w3.org/2000/svg",class:"h-5 w-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},_e={class:"file-upload-container"},be={class:"file-input-button"},Ce={key:1,class:"file-preview"},Me={key:0,class:"image-preview mb-3"},De=["src"],Fe={key:1,class:"file-icon w-16 h-16 mx-auto mb-3 text-blue-500"},Be={class:"file-info mb-4 text-center"},Ue={class:"font-medium text-gray-800"},Ve={class:"text-sm text-gray-500"},ze={class:"flex justify-center gap-3"},je=["disabled"],Ee={key:0},Le={key:1},Ae={key:2,class:"mt-3 text-red-500 text-center"},Ge={key:2,class:"upload-success"},He=R({__name:"ErrandFile",props:{errandUid:{type:String,required:!0}},setup(V){const _=V,{withClientMutation:b,withClientQuery:C}=O(),m=r(null),w=r(null);K(()=>{z()});const c=r(!1),a=r(null),v=r(null),f=r(!1),d=r(null),p=r(!1),i=r([]),z=()=>{C(I,{target:U.Errand,targetUid:_.errandUid},"grindMediaByTarget").then(t=>{t&&(i.value=t)})},j=t=>{b(se,{payload:t},"createGrindMedia").then(e=>{e&&(i.value=[e,...i.value])})},E=t=>{m.value=t,w.value=null,b(ee,{uid:t},"deleteGrindMedia").then(e=>{e&&(i.value=i.value.filter(o=>o.uid!==t))}).catch(e=>{w.value=e?.message||"Failed to delete file"}).finally(()=>{m.value=null})},L=t=>{const e=parseInt(t);return e<1024?`${e} B`:e<1024*1024?`${(e/1024).toFixed(1)} KB`:`${(e/(1024*1024)).toFixed(1)} MB`},x=t=>{const{mimetype:e,filename:o}=t;return e?.startsWith("image/")?"image":e?.includes("pdf")||o.endsWith(".pdf")?"pdf":e?.includes("word")||o.endsWith(".doc")||o.endsWith(".docx")?"doc":e?.includes("sheet")||o.endsWith(".xls")||o.endsWith(".xlsx")?"excel":"file"},A=t=>{try{C(te,{uid:t.uid},"downloadGrindMediaFile").then(e=>{const o=atob(e.content),k=new Uint8Array(o.length);for(let y=0;y<o.length;y++)k[y]=o.charCodeAt(y);const P=new Blob([k],{type:e.mimetype}),F=URL.createObjectURL(P),h=document.createElement("a");h.href=F,h.download=e.filename,document.body.appendChild(h),h.click(),setTimeout(()=>{document.body.removeChild(h),URL.revokeObjectURL(F)},0)})}catch(e){console.error("Error downloading file:",e)}},M=t=>{if(d.value=null,a.value=t,t.type.startsWith("image/")){const e=new FileReader;e.onload=o=>{v.value=o.target?.result},e.readAsDataURL(t)}else v.value=null},G=async()=>{if(a.value){f.value=!0,d.value=null;try{const t=await j({file:a.value,target:U.Errand,targetUid:_.errandUid});t?.error?d.value=t.error.message:p.value=!0}catch(t){d.value=t instanceof Error?t.message:"Upload failed"}finally{f.value=!1}}},H=t=>{const e=t.target;e.files&&e.files.length>0&&M(e.files[0])},S=t=>{t.preventDefault(),t.stopPropagation(),c.value=!0},$=t=>{t.preventDefault(),t.stopPropagation(),c.value=!1},T=t=>{t.preventDefault(),t.stopPropagation(),c.value=!0},W=t=>{t.preventDefault(),t.stopPropagation(),c.value=!1,t.dataTransfer&&t.dataTransfer.files.length>0&&M(t.dataTransfer.files[0])},D=()=>{a.value=null,v.value=null,p.value=!1,d.value=null},N=q(()=>{if(!a.value)return"";const t=a.value.size;return t<1024?`${t} B`:t<1024*1024?`${(t/1024).toFixed(1)} KB`:`${(t/(1024*1024)).toFixed(1)} MB`});return(t,e)=>(l(),n("div",oe,[s("div",le,[e[9]||(e[9]=s("h3",{class:"text-lg font-medium mb-3"},"Uploaded Files",-1)),i.value.length===0?(l(),n("div",ne," No files uploaded yet ")):g("",!0),w.value?(l(),n("div",ae,u(w.value),1)):g("",!0),i.value.length>0?(l(),n("ul",re,[(l(!0),n(J,null,Q(i.value,o=>(l(),n("li",{key:o.uid,class:"p-3 border rounded-md flex items-center hover:bg-gray-50 transition-colors"},[s("div",ie,[x(o)==="image"?(l(),n("svg",de,[...e[0]||(e[0]=[s("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M4 16l4.586-4.586a2 2 0 012.828 0L16 16m-2-2l1.586-1.586a2 2 0 012.828 0L20 14m-6-6h.01M6 20h12a2 2 0 002-2V6a2 2 0 00-2-2H6a2 2 0 00-2 2v12a2 2 0 002 2z"},null,-1)])])):x(o)==="pdf"?(l(),n("svg",ue,[...e[1]||(e[1]=[s("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M7 21h10a2 2 0 002-2V9.414a1 1 0 00-.293-.707l-5.414-5.414A1 1 0 0012.586 3H7a2 2 0 00-2 2v14a2 2 0 002 2z"},null,-1)])])):x(o)==="doc"?(l(),n("svg",ce,[...e[2]||(e[2]=[s("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"},null,-1)])])):x(o)==="excel"?(l(),n("svg",ve,[...e[3]||(e[3]=[s("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M9 17v-2m3 2v-4m3 4v-6m2 10H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"},null,-1)])])):(l(),n("svg",pe,[...e[4]||(e[4]=[s("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"},null,-1)])]))]),s("div",he,[s("div",{class:"font-medium text-gray-800 truncate",title:o.filename},u(o.originalName),9,ge),s("div",me,[s("span",null,u(L(o.size)),1),e[5]||(e[5]=s("span",{class:"h-1 w-1 rounded-full bg-gray-300"},null,-1)),s("span",null,u(o.mimetype),1)])]),s("div",we,[s("button",{onClick:k=>A(o),class:"p-2 text-blue-600 hover:bg-blue-50 rounded transition-colors",title:"Download file"},[...e[6]||(e[6]=[s("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-5 w-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[s("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M4 16v1a3 3 0 003 3h10a3 3 0 003-3v-1m-4-4l-4 4m0 0l-4-4m4 4V4"})],-1)])],8,fe),s("button",{onClick:k=>E(o.uid),class:"p-2 text-red-600 hover:bg-red-50 rounded transition-colors",title:"Delete file",disabled:m.value===o.uid},[m.value===o.uid?(l(),n("svg",ke,[...e[7]||(e[7]=[s("circle",{class:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor","stroke-width":"4"},null,-1),s("path",{class:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"},null,-1)])])):(l(),n("svg",ye,[...e[8]||(e[8]=[s("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"},null,-1)])]))],8,xe)])]))),128))])):g("",!0)]),s("div",_e,[!a.value&&!p.value?(l(),n("div",{key:0,class:Y(["upload-area",{dragging:c.value}]),onDragenter:S,onDragleave:$,onDragover:T,onDrop:W},[e[11]||(e[11]=B('<div class="w-16 h-16 mb-2 mx-auto text-gray-400" data-v-334d1478><svg xmlns="http://www.w3.org/2000/svg" class="w-full h-full" fill="none" viewBox="0 0 24 24" stroke="currentColor" data-v-334d1478><path stroke-linecap="round" stroke-linejoin="round" stroke-width="1" d="M5 8h14M5 8a2 2 0 110-4h14a2 2 0 110 4M5 8v10a2 2 0 002 2h10a2 2 0 002-2V8m-9 4h4" data-v-334d1478></path></svg></div><p class="text-center text-gray-500 mb-2" data-v-334d1478>Drag and drop file here</p><p class="text-center text-gray-400 text-sm mb-3" data-v-334d1478>or</p>',3)),s("label",be,[e[10]||(e[10]=Z(" Browse Files ")),s("input",{type:"file",class:"hidden",onChange:H},null,32)])],34)):a.value&&!p.value?(l(),n("div",Ce,[v.value?(l(),n("div",Me,[s("img",{src:v.value,alt:"File preview",class:"rounded-md max-h-64 max-w-full"},null,8,De)])):(l(),n("div",Fe,e[12]||(e[12]=[s("svg",{xmlns:"http://www.w3.org/2000/svg",class:"w-full h-full",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[s("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"1",d:"M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"})],-1)]))),s("div",Be,[s("p",Ue,u(a.value.name),1),s("p",Ve,u(N.value),1)]),s("div",ze,[s("button",{onClick:D,class:"cancel-button"}," Cancel "),s("button",{onClick:G,class:"upload-button",disabled:f.value},[f.value?(l(),n("span",Ee,"Uploading...")):(l(),n("span",Le,"Upload"))],8,je)]),d.value?(l(),n("div",Ae,u(d.value),1)):g("",!0)])):p.value?(l(),n("div",Ge,[e[13]||(e[13]=B('<div class="success-icon w-16 h-16 mx-auto mb-3 text-green-500" data-v-334d1478><svg xmlns="http://www.w3.org/2000/svg" class="w-full h-full" fill="none" viewBox="0 0 24 24" stroke="currentColor" data-v-334d1478><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7" data-v-334d1478></path></svg></div><p class="text-center text-gray-800 font-medium mb-2" data-v-334d1478>Upload Successful</p><p class="text-center text-gray-500 text-sm mb-4" data-v-334d1478>Your file has been uploaded successfully</p>',3)),s("button",{onClick:D,class:"upload-new-button"}," Upload Another File ")])):g("",!0)])]))}});const We=X(He,[["__scopeId","data-v-334d1478"],["__file","/home/aurthurm/Documents/Development/felicity/felicity-lims/webapp/views/grind/_id/ErrandFile.vue"]]);export{We as default};
