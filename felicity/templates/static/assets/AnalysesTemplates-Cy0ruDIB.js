import{a0 as se,f as oe,a7 as x,g as ne,h as V,i as re,_ as ae,r as w,c as a,o as r,A as e,C as le,E as y,a as _,N as g,P as D,J as h,K as A,Q as ie,D as U,L as m,F as S,a3 as de,a2 as q,a9 as ce}from"./index-DApeomWQ.js";import{c as me,f as ue,a as F,u as pe,b as E}from"./index.esm-Cx9agkcQ.js";import{m as fe,n as ge}from"./analyses.mutations-Bu696l9I.js";import{u as ye}from"./setup-HNpvekU2.js";import{u as xe}from"./analysis-BTUsl5OO.js";const ve=se({__name:"AnalysesTemplates",setup(O,{expose:t}){t();const u=xe(),s=ye(),{withClientMutation:k}=oe(),{toastSuccess:T}=re();let p=x(!1),v=x("");const b=x(!0),f=x(null),o=x(!1),i=x(!1);let d=ne({});const I=V(()=>s.getDepartments);u.fetchAnalysesServices({}),u.fetchAnalysesTemplates();const C=V(()=>u.getAnalysesServices),J=V(()=>u.getAnalysesTemplates),N=me({name:F().trim().required("Template name is required"),description:F().trim().nullable(),departmentUid:F().trim().nullable(),active:ue().default(!0)}),{handleSubmit:j,resetForm:B,setValues:L}=pe({validationSchema:N,initialValues:{name:"",description:"",departmentUid:"",active:!0}}),{value:K,errorMessage:Q}=E("name"),{value:R,errorMessage:Y}=E("description"),{value:G,errorMessage:H}=E("departmentUid"),{value:W}=E("active");function z(n){return k(fe,{payload:{name:n.name,description:n.description,departmentUid:n.departmentUid}},"createAnalysisTemplate").then(c=>{u.addAnalysisTemplate(c),T("Template created successfully")})}function M(n){if(!f.value)return Promise.resolve();const c=d.analyses?.map(l=>l.uid)??[];return k(ge,{uid:f.value,payload:{name:n.name,description:n.description,departmentUid:n.departmentUid,services:c}},"updateAnalysisTemplate").then(l=>{u.updateAnalysesTemplate(l),T("Template updated successfully")})}function X(n){Object.assign(d,{...n}),f.value=n.uid??null,C.value?.forEach(c=>{c[1].forEach(l=>{l.checked=!1,n.analyses?.some(te=>te.uid===l.uid)&&(l.checked=!0)})})}async function Z(){const n=[];C.value?.forEach(c=>{c[1].forEach(l=>{l.checked&&n.push(l)})}),d.analyses=n,i.value=!0;try{await M({name:d.name??"",description:d.description??null,departmentUid:d.departmentUid??null})}finally{i.value=!1}}function $(n,c){if(b.value=n,p.value=!0,v.value=(n?"CREATE":"EDIT")+" ANALYSES TEMPLATE",n)f.value=null,B({values:{name:"",description:"",departmentUid:"",active:!0}});else{const l=c??d;f.value=l?.uid??null,L({name:l?.name??"",description:l?.description??"",departmentUid:l?.departmentUid??"",active:l?.active??!0})}}const ee=j(async n=>{const c={name:n.name,description:n.description??null,departmentUid:n.departmentUid?n.departmentUid:null};o.value=!0;try{b.value===!0?await z(c):await M(c),p.value=!1}finally{o.value=!1}}),P={analysisStore:u,setupStore:s,withClientMutation:k,toastSuccess:T,get showModal(){return p},set showModal(n){p=n},get formTitle(){return v},set formTitle(n){v=n},formAction:b,currentUid:f,formSaving:o,templateUpdating:i,get analysisTemplate(){return d},set analysisTemplate(n){d=n},departments:I,analysesServices:C,analysesTemplates:J,templateSchema:N,handleSubmit:j,resetForm:B,setValues:L,name:K,nameError:Q,description:R,descriptionError:Y,departmentUid:G,departmentError:H,active:W,addAnalysisTemplate:z,editAnalysisTemplate:M,select:X,updateTemplate:Z,FormManager:$,saveForm:ee};return Object.defineProperty(P,"__isScriptSetup",{enumerable:!1,value:!0}),P}}),be={class:"space-y-6"},_e={class:"grid grid-cols-12 gap-6"},he={class:"col-span-3"},ke={class:"rounded-lg border border-border bg-card"},Te={class:"overflow-y-auto max-h-[540px] p-2"},we={class:"space-y-1"},Ae=["onClick"],Ue={class:"flex items-center justify-between"},Se={class:"text-sm font-medium"},Ee={key:0,class:"text-xs text-muted-foreground"},Ce={key:0,class:"text-xs text-muted-foreground mt-1 line-clamp-2"},Me={key:0,class:"col-span-9"},Ve={class:"space-y-6"},De={class:"rounded-lg border border-border bg-card p-6"},Fe={class:"flex items-center justify-between"},Ne={class:"space-y-1"},je={class:"text-xl font-semibold text-foreground"},Be={key:0,class:"text-sm text-muted-foreground"},Le={class:"flex items-center space-x-2"},ze={class:"rounded-lg border border-border bg-card flex flex-col min-h-0"},Pe={class:"flex items-center justify-between gap-4 px-4 py-3 border-b border-border bg-muted/30 shrink-0"},qe={class:"overflow-y-auto overscroll-contain flex-1 min-h-[200px] max-h-[420px] p-4"},Oe={class:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-3"},Ie={class:"text-sm truncate"},Je={class:"space-y-0.5 py-1"},Ke=["onClick"],Qe=["id","onUpdate:modelValue"],Re=["for"],Ye={key:1,class:"col-span-9"},Ge={class:"text-xl font-semibold text-foreground"},He={class:"space-y-4"},We={class:"space-y-2"},Xe={key:0,class:"text-sm text-destructive"},Ze={class:"space-y-2"},$e=["value"],et={key:0,class:"text-sm text-destructive"},tt={class:"space-y-2"},st={key:0,class:"text-sm text-destructive"},ot={class:"pt-4"};function nt(O,t,u,s,k,T){const p=w("fel-button"),v=w("fel-heading"),b=w("fel-accordion"),f=w("fel-modal");return r(),a(h,null,[e("div",be,[_(v,{title:"Analyses Templates"},{default:g(()=>[_(p,{onClick:t[0]||(t[0]=o=>s.FormManager(!0))},{default:g(()=>[...t[10]||(t[10]=[D("Add Analyses Template",-1)])]),_:1})]),_:1}),e("div",_e,[e("section",he,[e("div",ke,[t[11]||(t[11]=e("div",{class:"p-4 border-b border-border"},[e("h3",{class:"text-sm font-medium text-muted-foreground"},"Templates")],-1)),e("div",Te,[e("ul",we,[(r(!0),a(h,null,A(s.analysesTemplates,o=>(r(),a("li",{key:o.uid,onClick:U(i=>s.select(o),["prevent","stop"]),class:ie(["rounded-md p-2 cursor-pointer transition-colors duration-200 border-l-4",o?.uid===s.analysisTemplate?.uid?"border-l-primary bg-primary/10 text-primary font-medium":"border-l-transparent hover:bg-accent/50 hover:border-l-primary/30"])},[e("div",Ue,[e("span",Se,m(o?.name),1),o?.department?.name?(r(),a("span",Ee,m(o?.department?.name),1)):y("",!0)]),o?.description?(r(),a("p",Ce,m(o?.description),1)):y("",!0)],10,Ae))),128))])])])]),s.analysisTemplate?.uid!==void 0?(r(),a("section",Me,[e("div",Ve,[e("div",De,[e("div",Fe,[e("div",Ne,[e("h2",je,m(s.analysisTemplate?.name),1),s.analysisTemplate?.description?(r(),a("p",Be,m(s.analysisTemplate?.description),1)):y("",!0)]),e("div",Le,[e("button",{onClick:t[1]||(t[1]=o=>s.FormManager(!1,s.analysisTemplate)),class:"inline-flex items-center justify-center h-9 w-9 rounded-md border border-input bg-background text-foreground hover:bg-accent hover:text-accent-foreground transition-colors focus:outline-none focus:ring-2 focus:ring-ring"},[...t[12]||(t[12]=[e("svg",{class:"w-4 h-4",viewBox:"0 0 20 20"},[e("path",{d:"M13.586 3.586a2 2 0 112.828 2.828l-.793.793-2.828-2.828.793-.793zM11.379 5.793L3 14.172V17h2.828l8.38-8.379-2.83-2.828z"})],-1)])])])])]),e("div",ze,[e("div",Pe,[t[14]||(t[14]=e("h3",{class:"text-sm font-medium text-foreground"},"Analyses in template",-1)),_(p,{type:"button",loading:s.templateUpdating,onClick:t[2]||(t[2]=o=>s.updateTemplate())},{default:g(()=>[...t[13]||(t[13]=[e("span",{class:"inline-flex items-center gap-2"},[e("svg",{class:"w-4 h-4 shrink-0",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M5 13l4 4L19 7"})]),D(" Update Template ")],-1)])]),_:1},8,["loading"])]),e("div",qe,[e("div",Oe,[(r(!0),a(h,null,A(s.analysesServices,o=>(r(),a("div",{key:o[0],class:"min-w-0"},[_(b,{compact:""},{title:g(()=>[e("span",Ie,m(o[0]),1)]),body:g(()=>[e("ul",Je,[(r(!0),a(h,null,A(o[1],i=>(r(),a("li",{key:i?.uid,class:"flex items-center gap-2 py-1.5 px-2 rounded-md hover:bg-accent/50 transition-colors cursor-pointer",onClick:d=>i.checked=!i.checked},[S(e("input",{type:"checkbox",id:`toggle-${i?.uid}`,class:"h-4 w-4 rounded border-input text-primary focus:ring-ring shrink-0 cursor-pointer","onUpdate:modelValue":d=>i.checked=d,onClick:t[3]||(t[3]=U(()=>{},["stop"]))},null,8,Qe),[[de,i.checked]]),e("label",{for:`toggle-${i?.uid}`,class:"text-sm text-foreground cursor-pointer truncate flex-1 min-w-0",onClick:t[4]||(t[4]=U(()=>{},["stop"]))},m(i?.name),9,Re)],8,Ke))),128))])]),_:2},1024)]))),128))])])])])])):(r(),a("section",Ye,[...t[15]||(t[15]=[e("div",{class:"rounded-lg border border-border bg-card p-6 flex flex-col items-center justify-center space-y-4 min-h-[400px]"},[e("div",{class:"text-4xl text-muted-foreground"},"ðŸ“‹"),e("h3",{class:"text-lg font-medium text-foreground"},"No Template Selected"),e("p",{class:"text-sm text-muted-foreground"},"Select a template from the list to view its details")],-1)])]))])]),s.showModal?(r(),le(f,{key:0,onClose:t[9]||(t[9]=o=>s.showModal=!1)},{header:g(()=>[e("h3",Ge,m(s.formTitle),1)]),body:g(()=>[e("form",{onSubmit:t[8]||(t[8]=U((...o)=>s.saveForm&&s.saveForm(...o),["prevent"])),class:"p-6 space-y-6"},[e("div",He,[e("label",We,[t[16]||(t[16]=e("span",{class:"text-sm font-medium text-muted-foreground"},"Template Name",-1)),S(e("input",{"onUpdate:modelValue":t[5]||(t[5]=o=>s.name=o),type:"text",class:"w-full px-3 py-2 border border-input bg-background text-foreground rounded-lg focus:outline-none focus:ring-2 focus:ring-ring placeholder:text-muted-foreground",placeholder:"Enter template name"},null,512),[[q,s.name]]),s.nameError?(r(),a("p",Xe,m(s.nameError),1)):y("",!0)]),e("label",Ze,[t[18]||(t[18]=e("span",{class:"text-sm font-medium text-muted-foreground"},"Department",-1)),S(e("select",{"onUpdate:modelValue":t[6]||(t[6]=o=>s.departmentUid=o),class:"w-full px-3 py-2 border border-input bg-background text-foreground rounded-lg focus:outline-none focus:ring-2 focus:ring-ring"},[t[17]||(t[17]=e("option",{value:""},"Select department",-1)),(r(!0),a(h,null,A(s.departments,o=>(r(),a("option",{key:o.uid,value:o.uid},m(o.name),9,$e))),128))],512),[[ce,s.departmentUid]]),s.departmentError?(r(),a("p",et,m(s.departmentError),1)):y("",!0)]),e("label",tt,[t[19]||(t[19]=e("span",{class:"text-sm font-medium text-muted-foreground"},"Description",-1)),S(e("textarea",{"onUpdate:modelValue":t[7]||(t[7]=o=>s.description=o),rows:"3",class:"w-full px-3 py-2 border border-input bg-background text-foreground rounded-lg focus:outline-none focus:ring-2 focus:ring-ring placeholder:text-muted-foreground resize-none",placeholder:"Enter template description"},null,512),[[q,s.description]]),s.descriptionError?(r(),a("p",st,m(s.descriptionError),1)):y("",!0)])]),e("div",ot,[_(p,{type:"submit",class:"w-full",loading:s.formSaving},{default:g(()=>[...t[20]||(t[20]=[D(" Save Changes ",-1)])]),_:1},8,["loading"])])],32)]),_:1})):y("",!0)],64)}const ct=ae(ve,[["render",nt],["__file","/home/administrator/Documents/Development/beak-insights/felicity/felicity-lims/webapp/views/admin/analyses/AnalysesTemplates.vue"]]);export{ct as default};
