import{P as G,e as P,Z as i,aa as N,h as K,o as a,c as l,b as t,J as g,E as u,F as R,D as q,a1 as J,L as O,a0 as D,aT as Q,aU as Y,_ as Z}from"./index-fa13e788.js";import{l as X,D as I,m as ee}from"./grind.queries-2a7b3de7.js";import{M}from"./schema-f3233b53.js";const n=h=>(Q("data-v-334d1478"),h=h(),Y(),h),te={class:"flex justify-between items-start"},se={class:"w-3/4 pr-4"},oe=n(()=>t("h3",{class:"text-lg font-medium mb-3"},"Uploaded Files",-1)),ae={key:0,class:"py-6 text-center text-gray-500 bg-gray-50 rounded-lg border border-dashed border-gray-300"},le={key:1,class:"mb-3 p-3 bg-red-50 text-red-700 rounded-md"},ne={key:2,class:"space-y-2"},re={class:"file-icon mr-3 text-blue-500 flex-shrink-0"},ie={key:0,xmlns:"http://www.w3.org/2000/svg",class:"h-6 w-6",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},de=n(()=>t("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M4 16l4.586-4.586a2 2 0 012.828 0L16 16m-2-2l1.586-1.586a2 2 0 012.828 0L20 14m-6-6h.01M6 20h12a2 2 0 002-2V6a2 2 0 00-2-2H6a2 2 0 00-2 2v12a2 2 0 002 2z"},null,-1)),ce=[de],ue={key:1,xmlns:"http://www.w3.org/2000/svg",class:"h-6 w-6",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},he=n(()=>t("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M7 21h10a2 2 0 002-2V9.414a1 1 0 00-.293-.707l-5.414-5.414A1 1 0 0012.586 3H7a2 2 0 00-2 2v14a2 2 0 002 2z"},null,-1)),ve=[he],pe={key:2,xmlns:"http://www.w3.org/2000/svg",class:"h-6 w-6",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},_e=n(()=>t("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"},null,-1)),ge=[_e],we={key:3,xmlns:"http://www.w3.org/2000/svg",class:"h-6 w-6",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},fe=n(()=>t("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M9 17v-2m3 2v-4m3 4v-6m2 10H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"},null,-1)),me=[fe],xe={key:4,xmlns:"http://www.w3.org/2000/svg",class:"h-6 w-6",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},ke=n(()=>t("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"},null,-1)),ye=[ke],be={class:"flex-grow min-w-0 mr-3"},Ce=["title"],Me={class:"text-sm text-gray-500 flex items-center gap-2"},De=n(()=>t("span",{class:"h-1 w-1 rounded-full bg-gray-300"},null,-1)),Fe={class:"flex gap-2 flex-shrink-0"},Be=["onClick"],Ve=n(()=>t("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-5 w-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M4 16v1a3 3 0 003 3h10a3 3 0 003-3v-1m-4-4l-4 4m0 0l-4-4m4 4V4"})],-1)),Ue=[Ve],ze=["onClick","disabled"],je={key:0,class:"animate-spin h-5 w-5",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24"},Ee=n(()=>t("circle",{class:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor","stroke-width":"4"},null,-1)),Se=n(()=>t("path",{class:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"},null,-1)),$e=[Ee,Se],He={key:1,xmlns:"http://www.w3.org/2000/svg",class:"h-5 w-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},Le=n(()=>t("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"},null,-1)),Ae=[Le],Te={class:"file-upload-container"},We=D('<div class="w-16 h-16 mb-2 mx-auto text-gray-400" data-v-334d1478><svg xmlns="http://www.w3.org/2000/svg" class="w-full h-full" fill="none" viewBox="0 0 24 24" stroke="currentColor" data-v-334d1478><path stroke-linecap="round" stroke-linejoin="round" stroke-width="1" d="M5 8h14M5 8a2 2 0 110-4h14a2 2 0 110 4M5 8v10a2 2 0 002 2h10a2 2 0 002-2V8m-9 4h4" data-v-334d1478></path></svg></div><p class="text-center text-gray-500 mb-2" data-v-334d1478>Drag and drop file here</p><p class="text-center text-gray-400 text-sm mb-3" data-v-334d1478>or</p>',3),Ge={class:"file-input-button"},Pe={key:1,class:"file-preview"},Ne={key:0,class:"image-preview mb-3"},Ke=["src"],Re={key:1,class:"file-icon w-16 h-16 mx-auto mb-3 text-blue-500"},qe=n(()=>t("svg",{xmlns:"http://www.w3.org/2000/svg",class:"w-full h-full",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"1",d:"M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"})],-1)),Je=[qe],Oe={class:"file-info mb-4 text-center"},Qe={class:"font-medium text-gray-800"},Ye={class:"text-sm text-gray-500"},Ze={class:"flex justify-center gap-3"},Xe=["disabled"],Ie={key:0},et={key:1},tt={key:2,class:"mt-3 text-red-500 text-center"},st={key:2,class:"upload-success"},ot=D('<div class="success-icon w-16 h-16 mx-auto mb-3 text-green-500" data-v-334d1478><svg xmlns="http://www.w3.org/2000/svg" class="w-full h-full" fill="none" viewBox="0 0 24 24" stroke="currentColor" data-v-334d1478><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7" data-v-334d1478></path></svg></div><p class="text-center text-gray-800 font-medium mb-2" data-v-334d1478>Upload Successful</p><p class="text-center text-gray-500 text-sm mb-4" data-v-334d1478>Your file has been uploaded successfully</p>',3),at=G({__name:"ErrandFile",props:{errandUid:{type:String,required:!0}},setup(h){const k=h,{withClientMutation:y,withClientQuery:F}=P(),w=i(null),f=i(null);N(()=>{B()});const v=i(!1),r=i(null),p=i(null),m=i(!1),c=i(null),_=i(!1),d=i([]),B=()=>{F(X,{target:M.Errand,targetUid:k.errandUid},"grindMediaByTarget").then(e=>{e&&(d.value=e)})},V=e=>{y(ee,{payload:e},"createGrindMedia").then(s=>{s&&(d.value=[s,...d.value])})},U=e=>{w.value=e,f.value=null,y(I,{uid:e},"deleteGrindMedia").then(s=>{s&&(d.value=d.value.filter(o=>o.uid!==e))}).catch(s=>{f.value=s?.message||"Failed to delete file"}).finally(()=>{w.value=null})},z=e=>{const s=parseInt(e);return s<1024?`${s} B`:s<1024*1024?`${(s/1024).toFixed(1)} KB`:`${(s/(1024*1024)).toFixed(1)} MB`},x=e=>{const{mimetype:s,filename:o}=e;return s?.startsWith("image/")?"image":s?.includes("pdf")||o.endsWith(".pdf")?"pdf":s?.includes("word")||o.endsWith(".doc")||o.endsWith(".docx")?"doc":s?.includes("sheet")||o.endsWith(".xls")||o.endsWith(".xlsx")?"excel":"file"},j=e=>{window.open(`/${e.path}`,"_blank")},b=e=>{if(c.value=null,r.value=e,e.type.startsWith("image/")){const s=new FileReader;s.onload=o=>{p.value=o.target?.result},s.readAsDataURL(e)}else p.value=null},E=async()=>{if(r.value){m.value=!0,c.value=null;try{const e=await V({file:r.value,target:M.Errand,targetUid:k.errandUid});e?.error?c.value=e.error.message:_.value=!0}catch(e){c.value=e instanceof Error?e.message:"Upload failed"}finally{m.value=!1}}},S=e=>{const s=e.target;s.files&&s.files.length>0&&b(s.files[0])},$=e=>{e.preventDefault(),e.stopPropagation(),v.value=!0},H=e=>{e.preventDefault(),e.stopPropagation(),v.value=!1},L=e=>{e.preventDefault(),e.stopPropagation(),v.value=!0},A=e=>{e.preventDefault(),e.stopPropagation(),v.value=!1,e.dataTransfer&&e.dataTransfer.files.length>0&&b(e.dataTransfer.files[0])},C=()=>{r.value=null,p.value=null,_.value=!1,c.value=null},T=K(()=>{if(!r.value)return"";const e=r.value.size;return e<1024?`${e} B`:e<1024*1024?`${(e/1024).toFixed(1)} KB`:`${(e/(1024*1024)).toFixed(1)} MB`});return(e,s)=>(a(),l("div",te,[t("div",se,[oe,d.value.length===0?(a(),l("div",ae," No files uploaded yet ")):g("",!0),f.value?(a(),l("div",le,u(f.value),1)):g("",!0),d.value.length>0?(a(),l("ul",ne,[(a(!0),l(R,null,q(d.value,o=>(a(),l("li",{key:o.uid,class:"p-3 border rounded-md flex items-center hover:bg-gray-50 transition-colors"},[t("div",re,[x(o)==="image"?(a(),l("svg",ie,[...ce])):x(o)==="pdf"?(a(),l("svg",ue,[...ve])):x(o)==="doc"?(a(),l("svg",pe,[...ge])):x(o)==="excel"?(a(),l("svg",we,[...me])):(a(),l("svg",xe,[...ye]))]),t("div",be,[t("div",{class:"font-medium text-gray-800 truncate",title:o.filename},u(o.filename),9,Ce),t("div",Me,[t("span",null,u(z(o.size)),1),De,t("span",null,u(o.mimetype),1)])]),t("div",Fe,[t("button",{onClick:W=>j(o),class:"p-2 text-blue-600 hover:bg-blue-50 rounded transition-colors",title:"Download file"},[...Ue],8,Be),t("button",{onClick:W=>U(o.uid),class:"p-2 text-red-600 hover:bg-red-50 rounded transition-colors",title:"Delete file",disabled:w.value===o.uid},[w.value===o.uid?(a(),l("svg",je,[...$e])):(a(),l("svg",He,[...Ae]))],8,ze)])]))),128))])):g("",!0)]),t("div",Te,[!r.value&&!_.value?(a(),l("div",{key:0,class:J(["upload-area",{dragging:v.value}]),onDragenter:$,onDragleave:H,onDragover:L,onDrop:A},[We,t("label",Ge,[O(" Browse Files "),t("input",{type:"file",class:"hidden",onChange:S},null,32)])],34)):r.value&&!_.value?(a(),l("div",Pe,[p.value?(a(),l("div",Ne,[t("img",{src:p.value,alt:"File preview",class:"rounded-md max-h-64 max-w-full"},null,8,Ke)])):(a(),l("div",Re,[...Je])),t("div",Oe,[t("p",Qe,u(r.value.name),1),t("p",Ye,u(T.value),1)]),t("div",Ze,[t("button",{onClick:C,class:"cancel-button"}," Cancel "),t("button",{onClick:E,class:"upload-button",disabled:m.value},[m.value?(a(),l("span",Ie,"Uploading...")):(a(),l("span",et,"Upload"))],8,Xe)]),c.value?(a(),l("div",tt,u(c.value),1)):g("",!0)])):_.value?(a(),l("div",st,[ot,t("button",{onClick:C,class:"upload-new-button"}," Upload Another File ")])):g("",!0)])]))}});const it=Z(at,[["__scopeId","data-v-334d1478"],["__file","/home/aurthurm/Documents/Development/felicity/felicity-lims/webapp/views/grind/_id/ErrandFile.vue"]]);export{it as default};
