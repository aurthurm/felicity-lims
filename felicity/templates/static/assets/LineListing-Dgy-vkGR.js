import{Y as M,aO as V,a0 as F,av as Y,ah as B,aP as P,_ as U,r as u,c as p,o as l,z as t,A as D,C as k,a as s,K as d,M as n,F as E,H as S,I as m,N as A,B as G,D as b,aG as v,al as T}from"./index-OdhKCqIc.js";import{u as N}from"./analysis-PB9AMevg.js";import{f as j}from"./index-CXV6PIcj.js";import{E as q,a as z,b as I,c as O,d as K}from"./EmptyTitle-aCQRDpx3.js";import{S as J}from"./Spinner-Bl8RfjFA.js";const Q=M({__name:"LineListing",setup(R,{expose:e}){e();const _=N(),{reports:r,fetchReports:w,generateReport:C,deleteReport:g}=V(),a=F(!1),f=F(!1),x=Y({listingForm:{report_type:"",analyses_uids:[],sample_states:[],date_column:"",period_start:"",period_end:""}});B(async()=>{a.value=!0,_.fetchAnalysesServices({first:void 0,after:"",text:"",sortBy:["name"]}),await w().finally(()=>{a.value=!1})});const c={analysisStore:_,reports:r,fetchReports:w,generateReport:C,deleteReport:g,isLoading:a,showForm:f,state:x,saveListingForm:()=>{C({...x.listingForm}),f.value=!1},downloadReport:y=>{const o=document.createElement("a");o.download=y.report_type+"-"+y.crated_at,o.href=P+"/"+y.location,document.body.appendChild(o),o.click(),document.body.removeChild(o)},get formatDate(){return j},get Empty(){return K},get EmptyContent(){return O},get EmptyDescription(){return I},get EmptyHeader(){return z},get EmptyTitle(){return q},get Spinner(){return J}};return Object.defineProperty(c,"__isScriptSetup",{enumerable:!1,value:!0}),c}}),W={class:"mt-4"},X={class:"flex justify-between items-center mb-4"},Z={key:0,class:"text-center py-4"},h={class:"inline-flex items-center gap-2"},$={key:2,class:"overflow-x-auto"},ee=["onClick"],te=["onClick"],oe={class:"grid grid-cols-3 gap-4"},re=["value"],se={class:"grid grid-cols-3 gap-4"},de={class:"flex justify-end space-x-2"},ne=["disabled"];function ae(R,e,_,r,w,C){const g=u("Checkbox"),a=u("TableHead"),f=u("TableRow"),x=u("TableHeader"),i=u("TableCell"),L=u("TableBody"),c=u("Table"),y=u("Modal");return l(),p("div",W,[t("div",X,[e[9]||(e[9]=t("h1",{class:"text-xl text-foreground font-semibold"},"Line Listing Reports",-1)),t("button",{class:"bg-primary text-primary-foreground px-4 py-2 rounded-md hover:bg-primary/90",onClick:e[0]||(e[0]=o=>r.showForm=!0)}," Generate Report ")]),r.isLoading?(l(),p("div",Z,[t("span",h,[s(r.Spinner,{class:"size-4"}),e[10]||(e[10]=t("span",{class:"text-sm"},"Loading reports...",-1))])])):r.reports?.length?(l(),p("div",$,[s(c,{class:"min-w-full bg-background shadow rounded-sm border border-foreground"},{default:d(()=>[s(x,null,{default:d(()=>[s(f,null,{default:d(()=>[s(a,{class:"px-4 py-2 border-b border-foreground text-left text-foreground"},{default:d(()=>[s(g)]),_:1}),s(a,{class:"px-4 py-2 border-b border-foreground text-left text-foreground"},{default:d(()=>[...e[13]||(e[13]=[n(" Report Type ",-1)])]),_:1}),s(a,{class:"px-4 py-2 border-b border-foreground text-left text-foreground"},{default:d(()=>[...e[14]||(e[14]=[n(" Generated By ",-1)])]),_:1}),s(a,{class:"px-4 py-2 border-b border-foreground text-left text-foreground"},{default:d(()=>[...e[15]||(e[15]=[n(" Date Generated ",-1)])]),_:1}),s(a,{class:"px-4 py-2 border-b border-foreground text-left text-foreground"},{default:d(()=>[...e[16]||(e[16]=[n(" Period Start ",-1)])]),_:1}),s(a,{class:"px-4 py-2 border-b border-foreground text-left text-foreground"},{default:d(()=>[...e[17]||(e[17]=[n(" Period End ",-1)])]),_:1}),s(a,{class:"px-4 py-2 border-b border-foreground text-left text-foreground"},{default:d(()=>[...e[18]||(e[18]=[n(" Status ",-1)])]),_:1}),s(a,{class:"px-4 py-2 border-b border-foreground"})]),_:1})]),_:1}),s(L,null,{default:d(()=>[(l(!0),p(E,null,S(r.reports,o=>(l(),D(f,{key:o.uid,class:"hover:bg-accent/50"},{default:d(()=>[s(i,{class:"px-4 py-2 border-b border-foreground"},{default:d(()=>[s(g)]),_:1}),s(i,{class:"px-4 py-2 border-b border-foreground text-primary"},{default:d(()=>[n(m(o.report_type),1)]),_:2},1024),s(i,{class:"px-4 py-2 border-b border-foreground text-primary"},{default:d(()=>[n(m(o?.created_by?.first_name)+" "+m(o?.created_by?.last_name),1)]),_:2},1024),s(i,{class:"px-4 py-2 border-b border-foreground text-primary"},{default:d(()=>[n(m(r.formatDate(o?.created_at,"YYYY-MM-DD HH:mm")),1)]),_:2},1024),s(i,{class:"px-4 py-2 border-b border-foreground text-primary"},{default:d(()=>[n(m(r.formatDate(o?.period_start,"YYYY-MM-DD HH:mm")),1)]),_:2},1024),s(i,{class:"px-4 py-2 border-b border-foreground text-primary"},{default:d(()=>[n(m(r.formatDate(o?.period_end,"YYYY-MM-DD HH:mm")),1)]),_:2},1024),s(i,{class:"px-4 py-2 border-b border-foreground"},{default:d(()=>[t("span",{class:A([{"bg-success/10 text-success":o?.status?.toLocaleLowerCase()==="ready","bg-warning/10 text-warning":o?.status?.toLocaleLowerCase()==="processing","bg-destructive/10 text-destructive":o?.status?.toLocaleLowerCase()==="failed"},"px-2 py-1 rounded-full text-sm"])},m(o?.status),3)]),_:2},1024),s(i,{class:"px-4 py-2 border-b border-foreground text-right space-x-2"},{default:d(()=>[o.status?.toLowerCase()==="ready"?(l(),p("button",{key:0,class:"px-3 py-1 border border-primary text-primary rounded-md hover:bg-primary hover:text-primary-foreground",onClick:H=>r.downloadReport(o)}," Download ",8,ee)):k("",!0),["ready","failed","pending"].includes(o.status?.toLowerCase()??"")?(l(),p("button",{key:1,class:"px-3 py-1 border border-destructive text-destructive rounded-md hover:bg-destructive hover:text-destructive-foreground",onClick:H=>r.deleteReport(o)}," Delete ",8,te)):k("",!0)]),_:2},1024)]),_:2},1024))),128))]),_:1})]),_:1})])):(l(),D(r.Empty,{key:1,class:"py-6"},{default:d(()=>[s(r.EmptyContent,null,{default:d(()=>[s(r.EmptyHeader,null,{default:d(()=>[s(r.EmptyTitle,null,{default:d(()=>[...e[11]||(e[11]=[n("No reports yet",-1)])]),_:1}),s(r.EmptyDescription,null,{default:d(()=>[...e[12]||(e[12]=[n("Once a download request has been made, your reports will appear here.",-1)])]),_:1})]),_:1})]),_:1})]),_:1})),r.showForm?(l(),D(y,{key:3,onClose:e[8]||(e[8]=o=>r.showForm=!1),"content-width":"w-3/4"},{header:d(()=>[...e[19]||(e[19]=[t("h3",{class:"text-lg font-semibold text-foreground"},"Generate Line Listing Report",-1)])]),body:d(()=>[t("form",{onSubmit:G(r.saveListingForm,["prevent"]),class:"space-y-4"},[t("div",oe,[t("div",null,[e[21]||(e[21]=t("label",{class:"block text-sm font-medium text-foreground mb-1"},"Report Type",-1)),b(t("select",{"onUpdate:modelValue":e[1]||(e[1]=o=>r.state.listingForm.report_type=o),class:"w-full px-3 py-2 border border-input rounded-md"},[...e[20]||(e[20]=[t("option",{value:"line_listing"},"Line Listing",-1)])],512),[[v,r.state.listingForm.report_type]])]),t("div",null,[e[22]||(e[22]=t("label",{class:"block text-sm font-medium text-foreground mb-1"},"Analyses",-1)),b(t("select",{"onUpdate:modelValue":e[2]||(e[2]=o=>r.state.listingForm.analyses_uids=o),class:"w-full px-3 py-2 border border-input rounded-md",multiple:""},[(l(!0),p(E,null,S(r.analysisStore.analysesServices,o=>(l(),p("option",{key:o.uid,value:o.uid},m(o.name),9,re))),128))],512),[[v,r.state.listingForm.analyses_uids]])]),t("div",null,[e[24]||(e[24]=t("label",{class:"block text-sm font-medium text-foreground mb-1"},"States",-1)),b(t("select",{"onUpdate:modelValue":e[3]||(e[3]=o=>r.state.listingForm.sample_states=o),class:"w-full px-3 py-2 border border-input rounded-md",multiple:""},[...e[23]||(e[23]=[t("option",{value:"published"},"Published",-1),t("option",{value:"verified"},"Verified",-1),t("option",{value:"to_be_verified"},"To Be Verified",-1),t("option",{value:"received"},"Received",-1),t("option",{value:"cancelled"},"Cancelled",-1),t("option",{value:"rejected"},"Rejected",-1),t("option",{value:"invalidated"},"Invalidated",-1),t("option",{value:"due"},"Due",-1)])],512),[[v,r.state.listingForm.sample_states]])])]),t("div",se,[t("div",null,[e[26]||(e[26]=t("label",{class:"block text-sm font-medium text-foreground mb-1"},"Period Date Criteria",-1)),b(t("select",{"onUpdate:modelValue":e[4]||(e[4]=o=>r.state.listingForm.date_column=o),class:"w-full px-3 py-2 border border-input rounded-md"},[...e[25]||(e[25]=[t("option",{value:"created_at"},"Created Date",-1),t("option",{value:"date_published"},"Published Date",-1),t("option",{value:"date_submitted"},"Submission Date",-1),t("option",{value:"date_verified"},"Verified Date",-1),t("option",{value:"date_cancelled"},"Cancellation Date",-1),t("option",{value:"date_invalidated"},"Invalidation Date",-1)])],512),[[v,r.state.listingForm.date_column]])]),t("div",null,[e[27]||(e[27]=t("label",{class:"block text-sm font-medium text-foreground mb-1"},"Period Start",-1)),b(t("input",{"onUpdate:modelValue":e[5]||(e[5]=o=>r.state.listingForm.period_start=o),type:"datetime-local",class:"w-full px-3 py-2 border border-input rounded-md",required:""},null,512),[[T,r.state.listingForm.period_start]])]),t("div",null,[e[28]||(e[28]=t("label",{class:"block text-sm font-medium text-foreground mb-1"},"Period End",-1)),b(t("input",{"onUpdate:modelValue":e[6]||(e[6]=o=>r.state.listingForm.period_end=o),type:"datetime-local",class:"w-full px-3 py-2 border border-input rounded-md",required:""},null,512),[[T,r.state.listingForm.period_end]])])]),t("div",de,[t("button",{type:"button",class:"px-4 py-2 border border-input rounded-md hover:bg-accent",onClick:e[7]||(e[7]=o=>r.showForm=!1)}," Cancel "),t("button",{type:"submit",class:"px-4 py-2 bg-primary text-primary-foreground rounded-md hover:bg-primary/90",disabled:r.isLoading}," Generate ",8,ne)])],32)]),_:1})):k("",!0)])}const be=U(Q,[["render",ae],["__file","/home/administrator/Documents/Development/beak-insights/felicity/felicity-lims/webapp/views/dashboard/LineListing.vue"]]);export{be as default};
