const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/TabsAside-D-rjYj_r.js","assets/index-OdhKCqIc.js","assets/index-DD18L2yL.css","assets/TabsTrigger-D8hXW_BI.js"])))=>i.map(i=>d[i]);
import{Y as X,a7 as q,a0 as F,an as Z,u as $,e as ee,a5 as le,a6 as ae,b2 as ne,b3 as te,a2 as oe,a3 as ie,b0 as re,_ as se,r as de,A as R,o as c,K as a,c as v,C as _,z as i,B as j,a as l,M as r,a4 as s,D as me,E as ue,F as ge,H as fe,I as be}from"./index-OdhKCqIc.js";import{u as ce}from"./user-DYsgscqA.js";import{u as Fe}from"./setup-BcFG_bXr.js";import{c as G,a as d,d as x,f as O,u as ye,F as ve}from"./index.esm-BfHj8iGm.js";import{I as Se}from"./Input-BEm5S0CJ.js";import{T as _e}from"./Textarea-T3VcJTEo.js";import{F as Le,a as Pe,b as xe}from"./FormMessage-CgXFMXx9.js";import{F as pe}from"./FormLabel-DxP9wnWS.js";import{S as we,a as Ce,b as Ie,c as Oe,d as ke}from"./SelectValue-Ds0cfAgl.js";import"./Label-CS46LzLb.js";import"./useNonce-B4v0IDPb.js";import"./chevron-down-Dqf-ptA3.js";import"./useFocusGuards-Bjb6OG0k.js";import"./PopperContent-BfyCnGUj.js";const p="__none__",Be=X({name:"OrganisationView",__name:"Organisation",setup(Y,{expose:n}){n();const k=le(()=>ae(()=>import("./TabsAside-D-rjYj_r.js"),__vite__mapDeps([0,1,2,3]))),{toastSuccess:e}=ee(),L=ce(),y=Fe();y.fetchOrganization();const u=q(()=>y.getOrganization),o=F(null),g=F(null),B=G({name:d().required("Organization name is required"),tagLine:d().nullable(),email:d().nullable(),emailCc:d().nullable(),mobilePhone:d().nullable(),businessPhone:d().nullable(),address:d().nullable(),banking:d().nullable(),qualityStatement:d().nullable()}),M=G({passwordLifetime:x().min(0,"Must be 0 or greater").nullable(),inactivityLogOut:x().min(0,"Must be 0 or greater").nullable(),allowBilling:O().nullable(),allowAutoBilling:O().nullable(),processBilledOnly:O().nullable(),minPaymentStatus:d().nullable(),minPartialPerentage:x().min(0,"Must be 0 or greater").nullable(),currency:d().nullable(),paymentTermsDays:x().min(0,"Must be 0 or greater").nullable()}),T={name:"",tagLine:"",email:"",emailCc:"",mobilePhone:"",businessPhone:"",address:"",banking:"",qualityStatement:""},h={passwordLifetime:null,inactivityLogOut:null,allowBilling:!1,allowAutoBilling:!1,processBilledOnly:!1,minPaymentStatus:p,minPartialPerentage:null,currency:"",paymentTermsDays:null},E=B.concat(M),{setValues:U,values:w}=ye({validationSchema:E,initialValues:{...T,...h}});Z(()=>[u.value?.uid,u.value?.settings],()=>{const t=u.value;o.value=t?.uid??null,g.value=t?.settings?.uid??null,U({name:t?.name??"",tagLine:t?.tagLine??"",email:t?.email??"",emailCc:t?.emailCc??"",mobilePhone:t?.mobilePhone??"",businessPhone:t?.businessPhone??"",address:t?.address??"",banking:t?.banking??"",qualityStatement:t?.qualityStatement??"",passwordLifetime:t?.settings?.passwordLifetime??null,inactivityLogOut:t?.settings?.inactivityLogOut??null,allowBilling:t?.settings?.allowBilling??!1,allowAutoBilling:t?.settings?.allowAutoBilling??!1,processBilledOnly:t?.settings?.processBilledOnly??!1,minPaymentStatus:t?.settings?.minPaymentStatus??p,minPartialPerentage:t?.settings?.minPartialPerentage??null,currency:t?.settings?.currency??"",paymentTermsDays:t?.settings?.paymentTermsDays??null},!1)},{immediate:!0});const{withClientMutation:C}=$();let f=F(!1);async function z(t){if(f.value=!0,!o.value){f.value=!1;return}try{const m={name:t.name,tagLine:t.tagLine,email:t.email,emailCc:t.emailCc,mobilePhone:t.mobilePhone,businessPhone:t.businessPhone,address:t.address,banking:t.banking,qualityStatement:t.qualityStatement},b=await C(ne,{uid:o.value,payload:m},"updateOrganization");y.updateOrganization(b),e("Organization information updated")}finally{f.value=!1}}async function A(t){if(f.value=!0,!g.value){f.value=!1;return}try{const m={passwordLifetime:t.passwordLifetime,inactivityLogOut:t.inactivityLogOut,allowBilling:t.allowBilling,allowAutoBilling:t.allowAutoBilling,processBilledOnly:t.processBilledOnly,minPaymentStatus:t.minPaymentStatus===p?null:t.minPaymentStatus,minPartialPerentage:t.minPartialPerentage,currency:t.currency,paymentTermsDays:t.paymentTermsDays},b=await C(te,{uid:g.value,payload:m},"updateOrganizationSetting");y.updateOrganizationSetting(b),e("Organization settings updated")}finally{f.value=!1}}const Q=()=>z(w),H=()=>A(w);L.fetchUsers({});const K=q(()=>L.getUsers),V=F("general-info"),J=[{id:"general-info",label:"Information",icon:"fas fa-chart-bar"},{id:"other-settings",label:"Other",icon:"fas fa-user-clock"},{id:"logo-upload",label:"Logo",icon:"fas fa-image"}],S=F(null),I=F(null);let P=F(!1);const D={TabsAside:k,toastSuccess:e,userStore:L,setupStore:y,EMPTY_SELECT_VALUE:p,laboratory:u,orgUid:o,settingUid:g,orgSchema:B,settingSchema:M,defaultOrgValues:T,defaultSettingValues:h,formSchema:E,setValues:U,values:w,withClientMutation:C,get processing(){return f},set processing(t){f=t},onOrganizationSubmit:z,onSettingsSubmit:A,saveOrganizationForm:Q,saveSettingForm:H,users:K,currentTab:V,items:J,logoFile:S,logoPreview:I,get logoUploading(){return P},set logoUploading(t){P=t},handleLogoFileSelect:t=>{const m=t.target;if(m.files&&m.files[0]){const b=m.files[0];if(!b.type.match(/image\/png/)){e("Error: Only PNG files are allowed");return}if(b.size>5*1024*1024){e("Error: File size exceeds 5MB limit");return}S.value=b;const N=new FileReader;N.onload=W=>{I.value=W.target?.result},N.readAsDataURL(b)}},uploadLogo:async()=>{if(!S.value){e("Error: No file selected");return}P.value=!0;try{const t=new FormData;t.append("file",S.value);const m=await oe.post("setup/logo",t,{headers:{"Content-Type":"multipart/form-data"}});m.data.success?(e("Logo uploaded successfully"),S.value=null,I.value=null):e(`Error: ${m.data.message}`)}catch(t){e(`Error uploading logo: ${t instanceof Error?t.message:"Unknown error"}`)}finally{P.value=!1}},get PaymentStatus(){return re},get Button(){return ie},get Input(){return Se},get Textarea(){return _e},get FormControl(){return xe},get FormField(){return ve},get FormItem(){return Pe},get FormLabel(){return pe},get FormMessage(){return Le},get Select(){return ke},get SelectContent(){return Oe},get SelectItem(){return Ie},get SelectTrigger(){return Ce},get SelectValue(){return we}};return Object.defineProperty(D,"__isScriptSetup",{enumerable:!1,value:!0}),D}}),Me={key:0,class:"space-y-6"},Te={class:"grid grid-cols-2 gap-6"},he={key:1,class:"space-y-6"},Ee={class:"space-y-6"},Ue={class:"space-y-3"},ze={class:"block"},Ae=["disabled"],De={key:0,class:"space-y-3"},Ne={class:"flex items-center justify-center p-4 border border-border rounded-md bg-muted"},qe=["src"],Re={key:1,class:"text-sm text-muted-foreground"},je={key:2,class:"space-y-6"},Ge={class:"grid grid-cols-2 gap-6"},Ye={class:"grid grid-cols-2 gap-6"};function Qe(Y,n,k,e,L,y){const u=de("Checkbox");return c(),R(e.TabsAside,{title:"Settings",items:e.items,modelValue:e.currentTab,"onUpdate:modelValue":n[0]||(n[0]=o=>e.currentTab=o)},{default:a(()=>[e.currentTab==="general-info"?(c(),v("section",Me,[n[12]||(n[12]=i("h2",{class:"text-2xl font-semibold text-foreground"},"Organization Information",-1)),n[13]||(n[13]=i("hr",{class:"border-border"},null,-1)),i("form",{class:"space-y-6",onSubmit:j(e.saveOrganizationForm,["prevent"])},[i("div",Te,[l(e.FormField,{name:"name"},{default:a(({componentField:o})=>[l(e.FormItem,null,{default:a(()=>[l(e.FormLabel,null,{default:a(()=>[...n[1]||(n[1]=[r("Organization Name",-1)])]),_:1}),l(e.FormControl,null,{default:a(()=>[l(e.Input,s(o,{placeholder:"Name ...",disabled:e.processing}),null,16,["disabled"])]),_:2},1024),l(e.FormMessage)]),_:2},1024)]),_:1}),l(e.FormField,{name:"tagLine"},{default:a(({componentField:o})=>[l(e.FormItem,null,{default:a(()=>[l(e.FormLabel,null,{default:a(()=>[...n[2]||(n[2]=[r("Tag Line",-1)])]),_:1}),l(e.FormControl,null,{default:a(()=>[l(e.Input,s(o,{placeholder:"Tag Line ...",disabled:e.processing}),null,16,["disabled"])]),_:2},1024),l(e.FormMessage)]),_:2},1024)]),_:1}),l(e.FormField,{name:"email"},{default:a(({componentField:o})=>[l(e.FormItem,null,{default:a(()=>[l(e.FormLabel,null,{default:a(()=>[...n[3]||(n[3]=[r("Organization Email",-1)])]),_:1}),l(e.FormControl,null,{default:a(()=>[l(e.Input,s(o,{placeholder:"Name ...",disabled:e.processing}),null,16,["disabled"])]),_:2},1024),l(e.FormMessage)]),_:2},1024)]),_:1}),l(e.FormField,{name:"emailCc"},{default:a(({componentField:o})=>[l(e.FormItem,null,{default:a(()=>[l(e.FormLabel,null,{default:a(()=>[...n[4]||(n[4]=[r("CC Emails",-1)])]),_:1}),l(e.FormControl,null,{default:a(()=>[l(e.Input,s(o,{placeholder:"Name ...",disabled:e.processing}),null,16,["disabled"])]),_:2},1024),l(e.FormMessage)]),_:2},1024)]),_:1}),l(e.FormField,{name:"mobilePhone"},{default:a(({componentField:o})=>[l(e.FormItem,null,{default:a(()=>[l(e.FormLabel,null,{default:a(()=>[...n[5]||(n[5]=[r("Lab Mobile Phone",-1)])]),_:1}),l(e.FormControl,null,{default:a(()=>[l(e.Input,s(o,{placeholder:"Name ...",disabled:e.processing}),null,16,["disabled"])]),_:2},1024),l(e.FormMessage)]),_:2},1024)]),_:1}),l(e.FormField,{name:"businessPhone"},{default:a(({componentField:o})=>[l(e.FormItem,null,{default:a(()=>[l(e.FormLabel,null,{default:a(()=>[...n[6]||(n[6]=[r("Lab Business Phone",-1)])]),_:1}),l(e.FormControl,null,{default:a(()=>[l(e.Input,s(o,{placeholder:"Name ...",disabled:e.processing}),null,16,["disabled"])]),_:2},1024),l(e.FormMessage)]),_:2},1024)]),_:1}),l(e.FormField,{name:"address"},{default:a(({componentField:o})=>[l(e.FormItem,null,{default:a(()=>[l(e.FormLabel,null,{default:a(()=>[...n[7]||(n[7]=[r("Address",-1)])]),_:1}),l(e.FormControl,null,{default:a(()=>[l(e.Textarea,s(o,{placeholder:"Address ...",disabled:e.processing}),null,16,["disabled"])]),_:2},1024),l(e.FormMessage)]),_:2},1024)]),_:1}),l(e.FormField,{name:"banking"},{default:a(({componentField:o})=>[l(e.FormItem,null,{default:a(()=>[l(e.FormLabel,null,{default:a(()=>[...n[8]||(n[8]=[r("Banking Details",-1)])]),_:1}),l(e.FormControl,null,{default:a(()=>[l(e.Textarea,s(o,{placeholder:"Banking ...",disabled:e.processing}),null,16,["disabled"])]),_:2},1024),l(e.FormMessage)]),_:2},1024)]),_:1}),l(e.FormField,{name:"qualityStatement"},{default:a(({componentField:o})=>[l(e.FormItem,null,{default:a(()=>[l(e.FormLabel,null,{default:a(()=>[...n[9]||(n[9]=[r("Quality Statement",-1)])]),_:1}),l(e.FormControl,null,{default:a(()=>[l(e.Input,s(o,{placeholder:"Quality Statement ...",disabled:e.processing}),null,16,["disabled"])]),_:2},1024),l(e.FormMessage)]),_:2},1024)]),_:1})]),n[11]||(n[11]=i("hr",{class:"border-border"},null,-1)),l(e.Button,{type:"submit",disabled:e.processing},{default:a(()=>[...n[10]||(n[10]=[r("Update",-1)])]),_:1},8,["disabled"])],32)])):_("",!0),e.currentTab==="logo-upload"?(c(),v("section",he,[n[18]||(n[18]=i("h2",{class:"text-2xl font-semibold text-foreground"},"Organization Logo",-1)),n[19]||(n[19]=i("hr",{class:"border-border"},null,-1)),i("div",Ee,[i("div",Ue,[i("label",ze,[n[14]||(n[14]=i("span",{class:"text-sm font-medium text-foreground mb-2 block"},"Upload Logo (PNG only, max 5MB)",-1)),i("input",{type:"file",accept:".png,image/png",onChange:e.handleLogoFileSelect,disabled:e.logoUploading,class:"flex h-10 w-full rounded-md border border-input bg-background px-3 py-2 text-sm ring-offset-background file:border-0 file:bg-transparent file:text-sm file:font-medium file:text-foreground placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50"},null,40,Ae)])]),e.logoPreview?(c(),v("div",De,[n[15]||(n[15]=i("p",{class:"text-sm font-medium text-foreground"},"Preview:",-1)),i("div",Ne,[i("img",{src:e.logoPreview,alt:"Logo preview",class:"max-h-40 max-w-xs"},null,8,qe)])])):_("",!0),n[16]||(n[16]=i("div",{class:"space-y-2 text-sm text-muted-foreground"},[i("p",null,[i("strong",null,"Requirements:")]),i("ul",{class:"list-disc list-inside space-y-1"},[i("li",null,"File format: PNG only"),i("li",null,"Maximum size: 5MB"),i("li",null,"File will be saved as logo.png in assets/custom/")])],-1)),n[17]||(n[17]=i("hr",{class:"border-border"},null,-1)),me(i("button",{type:"button",onClick:e.uploadLogo,class:"inline-flex items-center justify-center rounded-md text-sm font-medium ring-offset-background transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 bg-primary text-primary-foreground hover:bg-primary/90 h-10 px-4 py-2"}," Upload Logo ",512),[[ue,!e.logoUploading&&e.logoFile]]),e.logoUploading?(c(),v("div",Re," Uploading... ")):_("",!0)])])):_("",!0),e.currentTab==="other-settings"?(c(),v("section",je,[n[34]||(n[34]=i("h2",{class:"text-2xl font-semibold text-foreground"},"Other Settings",-1)),n[35]||(n[35]=i("hr",{class:"border-border"},null,-1)),i("form",{class:"space-y-6",onSubmit:j(e.saveSettingForm,["prevent"])},[i("div",Ge,[l(e.FormField,{name:"passwordLifetime"},{default:a(({componentField:o})=>[l(e.FormItem,null,{default:a(()=>[l(e.FormLabel,null,{default:a(()=>[...n[20]||(n[20]=[r("Password Lifetime (days)",-1)])]),_:1}),l(e.FormControl,null,{default:a(()=>[l(e.Input,s(o,{type:"number",min:"0",placeholder:"Name ...",disabled:e.processing}),null,16,["disabled"])]),_:2},1024),l(e.FormMessage)]),_:2},1024)]),_:1}),l(e.FormField,{name:"inactivityLogOut"},{default:a(({componentField:o})=>[l(e.FormItem,null,{default:a(()=>[l(e.FormLabel,null,{default:a(()=>[...n[21]||(n[21]=[r("Inactivity Auto Logout (minutes)",-1)])]),_:1}),l(e.FormControl,null,{default:a(()=>[l(e.Input,s(o,{type:"number",min:"0",placeholder:"Name ...",disabled:e.processing}),null,16,["disabled"])]),_:2},1024),l(e.FormMessage)]),_:2},1024)]),_:1}),n[22]||(n[22]=i("div",{class:"col-span-1"},null,-1))]),n[32]||(n[32]=i("hr",{class:"border-border"},null,-1)),i("div",Ye,[l(e.FormField,{name:"allowBilling",type:"checkbox","checked-value":!0,"unchecked-value":!1},{default:a(({componentField:o})=>[l(e.FormItem,{class:"flex items-center space-x-2"},{default:a(()=>[l(e.FormControl,null,{default:a(()=>[l(u,s(o,{disabled:e.processing}),null,16,["disabled"])]),_:2},1024),l(e.FormLabel,null,{default:a(()=>[...n[23]||(n[23]=[r("Enable Sample Billing",-1)])]),_:1}),l(e.FormMessage)]),_:2},1024)]),_:1}),l(e.FormField,{name:"allowAutoBilling",type:"checkbox","checked-value":!0,"unchecked-value":!1},{default:a(({componentField:o})=>[l(e.FormItem,{class:"flex items-center space-x-2"},{default:a(()=>[l(e.FormControl,null,{default:a(()=>[l(u,s(o,{disabled:e.processing}),null,16,["disabled"])]),_:2},1024),l(e.FormLabel,null,{default:a(()=>[...n[24]||(n[24]=[r("Allow automatic billing on sample registration",-1)])]),_:1}),l(e.FormMessage)]),_:2},1024)]),_:1}),l(e.FormField,{name:"processBilledOnly",type:"checkbox","checked-value":!0,"unchecked-value":!1},{default:a(({componentField:o})=>[l(e.FormItem,{class:"flex items-center space-x-2"},{default:a(()=>[l(e.FormControl,null,{default:a(()=>[l(u,s(o,{disabled:e.processing}),null,16,["disabled"])]),_:2},1024),l(e.FormLabel,null,{default:a(()=>[...n[25]||(n[25]=[r("Only process billed analysis requests",-1)])]),_:1}),l(e.FormMessage)]),_:2},1024)]),_:1}),l(e.FormField,{name:"minPaymentStatus"},{default:a(({componentField:o})=>[l(e.FormItem,null,{default:a(()=>[l(e.FormLabel,null,{default:a(()=>[...n[26]||(n[26]=[r("Minimum Allowed Payment status",-1)])]),_:1}),l(e.FormControl,null,{default:a(()=>[l(e.Select,s(o,{disabled:e.processing}),{default:a(()=>[l(e.SelectTrigger,null,{default:a(()=>[l(e.SelectValue,{placeholder:"Select Payment Status"})]),_:1}),l(e.SelectContent,null,{default:a(()=>[l(e.SelectItem,{value:e.EMPTY_SELECT_VALUE},{default:a(()=>[...n[27]||(n[27]=[r("Select Payment Status",-1)])]),_:1}),(c(!0),v(ge,null,fe([e.PaymentStatus.Unpaid,e.PaymentStatus.Partial,e.PaymentStatus.Paid],g=>(c(),R(e.SelectItem,{key:g,value:g},{default:a(()=>[r(be(g),1)]),_:2},1032,["value"]))),128))]),_:1})]),_:1},16,["disabled"])]),_:2},1024),l(e.FormMessage)]),_:2},1024)]),_:1}),l(e.FormField,{name:"minPartialPerentage"},{default:a(({componentField:o})=>[l(e.FormItem,null,{default:a(()=>[l(e.FormLabel,null,{default:a(()=>[...n[28]||(n[28]=[r("Minimum Partial Percentage",-1)])]),_:1}),l(e.FormControl,null,{default:a(()=>[l(e.Input,s(o,{type:"number",min:"0.0",max:"1.0",step:"0.1",disabled:e.processing}),null,16,["disabled"])]),_:2},1024),l(e.FormMessage)]),_:2},1024)]),_:1}),l(e.FormField,{name:"currency"},{default:a(({componentField:o})=>[l(e.FormItem,null,{default:a(()=>[l(e.FormLabel,null,{default:a(()=>[...n[29]||(n[29]=[r("Currency",-1)])]),_:1}),l(e.FormControl,null,{default:a(()=>[l(e.Input,s(o,{type:"text",disabled:e.processing}),null,16,["disabled"])]),_:2},1024),l(e.FormMessage)]),_:2},1024)]),_:1}),l(e.FormField,{name:"paymentTermsDays"},{default:a(({componentField:o})=>[l(e.FormItem,null,{default:a(()=>[l(e.FormLabel,null,{default:a(()=>[...n[30]||(n[30]=[r("Payment Terms (Days)",-1)])]),_:1}),l(e.FormControl,null,{default:a(()=>[l(e.Input,s(o,{type:"number",min:"0",disabled:e.processing}),null,16,["disabled"])]),_:2},1024),l(e.FormMessage)]),_:2},1024)]),_:1})]),n[33]||(n[33]=i("hr",{class:"border-border"},null,-1)),l(e.Button,{type:"submit",disabled:e.processing},{default:a(()=>[...n[31]||(n[31]=[r("Update",-1)])]),_:1},8,["disabled"])],32)])):_("",!0)]),_:1},8,["modelValue"])}const sl=se(Be,[["render",Qe],["__file","/home/administrator/Documents/Development/beak-insights/felicity/felicity-lims/webapp/views/admin/laboratory/Organisation.vue"]]);export{sl as default};
