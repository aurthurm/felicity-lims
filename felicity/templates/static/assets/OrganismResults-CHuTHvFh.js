import{a0 as q,f as z,a7 as v,h as L,ad as J,g as K,U,_ as Q,r as j,c as m,o,A as t,C as b,E as x,N as c,P as f,J as D,K as N,L as k,a as I,F as M,a2 as T}from"./index-DApeomWQ.js";import{u as H}from"./analysis-DgQlUFGJ.js";import{G as W,A as X,S as Y,D as Z,a as $}from"./microbiology.mutations-DdKq3C1T.js";import"./analyses.mutations-Bu696l9I.js";const ee=q({__name:"OrganismResults",props:{sample:{type:Object,required:!0},analysisResults:{type:Object,required:!0}},setup(y,{expose:e}){e();const{withClientMutation:_,withClientQuery:s}=z(),i=v([]),h=v(!1),r=v(""),R=v([]),n=v(void 0),u=v(!1),l=L(()=>y.analysisResults[0]);J(()=>{s(W,{analysisResultUid:l.value.uid},"abxOrganismResultAll").then(a=>{a&&(i.value=a||[])}).finally(()=>C())});function V(){u.value=!0,_(X,{analysisResultUid:l.value.uid},"createAbxOrganismResult").then(a=>{a&&i.value.unshift(a)}).finally(()=>u.value=!1)}function B(a){u.value=!0,_(Y,{uid:a.uid,organismUid:a.organism?.uid??""},"saveAbxOrganismResult").then(d=>{if(d){const g=i.value.findIndex(p=>p.uid===a.uid);if(g>-1){const p=d.organism;i.value[g].organismUid=p?.uid,i.value[g].organism=p}}}).finally(()=>{u.value=!1,C()})}function P(a){u.value=!0,_(Z,{uid:a.uid},"removeAbxOrganismResult").then(d=>{if(d){const g=i.value.findIndex(p=>p.uid===d?.uid);g>-1&&i.value.splice(g,1)}}).finally(()=>{u.value=!1,C()})}function E(a){n.value=a,h.value=!0}function F(a){h.value=!1,i.value[n.value].organism=a,n.value=void 0,y.analysisResults[0].result=i.value?.map(d=>d.organism?.name).join(", ")}function G(){r.value.length<3||s($,{text:r.value,pageSize:25,sortBy:["name"]},"abxOrganismAll").then(a=>{R.value=a?.items})}const O=K({can_submit:!1,can_approve:!1});function C(){O.can_submit=!1,O.can_approve=!1;const a=i.value?.every(d=>d.organismUid!=null);l.value.status=="pending"&&a&&(O.can_submit=!0),l.value.status=="resulted"&&(O.can_approve=!0)}let{submitResults:A,approveResults:w}=H();const S={withClientMutation:_,withClientQuery:s,organismResults:i,showModal:h,searchOrgText:r,organisms:R,pickIndex:n,addingOrganism:u,analysisResult:l,addOrganism:V,saveOrgResult:B,removeOrgResult:P,pickOrganism:E,selectOrganism:F,searchOrganisms:G,state:O,resetAnalysesPermissions:C,get submitter_(){return A},set submitter_(a){A=a},get approver_(){return w},set approver_(a){w=a},submitResults:()=>A([{uid:l.value.uid,result:l.value.result??"",methodUid:"felicity_ast",laboratoryInstrumentUid:"felicity_ast"}],U.Sample,y.sample?.uid).then(()=>{}),approveResults:()=>w([l.value.uid],U.Sample,y.sample?.uid).then(()=>{})};return Object.defineProperty(S,"__isScriptSetup",{enumerable:!1,value:!0}),S}}),se={class:"space-y-6"},te={class:"bg-background rounded-lg shadow-sm"},ne={class:"p-6 space-y-6"},ae={class:"flex items-center justify-between"},oe={class:"overflow-x-auto"},ie={class:"w-full fel-table"},le={class:"px-4 py-2"},re={class:"text-sm text-foreground"},ue={class:"px-4 py-2"},de={key:0,class:"text-sm text-primary"},me={class:"px-4 py-2 text-right"},ce={class:"flex items-center justify-end space-x-2"},fe={class:"bg-background rounded-lg shadow-sm p-6 space-y-6"},ge={class:"flex items-center justify-between"},pe={class:"inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-primary text-primary-foreground"},ve={class:"space-y-4"},be={key:1,class:"text-sm text-muted-foreground"},xe={class:"flex justify-end space-x-4"},ye={class:"p-6 space-y-6"},_e={class:"flex items-center space-x-4"},Oe={class:"space-y-2"},ke=["onClick"];function he(y,e,_,s,i,h){const r=j("fel-button"),R=j("fel-modal");return o(),m("div",se,[t("div",te,[t("div",ne,[t("div",ae,[e[5]||(e[5]=t("h3",{class:"text-lg font-semibold text-foreground"},"Organisms",-1)),s.analysisResult.status=="pending"?(o(),b(r,{key:0,onClick:e[0]||(e[0]=n=>s.addOrganism()),disabled:s.addingOrganism,color:"primary"},{default:c(()=>[...e[4]||(e[4]=[f(" Add Organism ",-1)])]),_:1},8,["disabled"])):x("",!0)]),e[11]||(e[11]=t("div",{class:"border-t border-border"},null,-1)),t("div",oe,[t("table",ie,[e[10]||(e[10]=t("thead",null,[t("tr",{class:"border-b border-border bg-muted/50"},[t("th",{class:"px-4 py-2 text-left text-sm font-medium text-foreground"},"Isolate Number"),t("th",{class:"px-4 py-2 text-left text-sm font-medium text-foreground"},"Organism Name"),t("th",{class:"px-4 py-2"})])],-1)),t("tbody",null,[(o(!0),m(D,null,N(s.organismResults,(n,u)=>(o(),m("tr",{key:n?.uid,class:"border-b border-border hover:bg-muted/50 transition-colors duration-200"},[t("td",le,[t("span",re,"#"+k(n?.isolateNumber),1)]),t("td",ue,[n?.organism?(o(),m("span",de,k(n?.organism?.name),1)):(o(),b(r,{key:1,onClick:l=>s.pickOrganism(u),color:"outline"},{default:c(()=>[...e[6]||(e[6]=[f(" Pick Organism ",-1)])]),_:1},8,["onClick"]))]),t("td",me,[t("div",ce,[n?.organism&&!n?.organismUid?(o(),m(D,{key:0},[I(r,{onClick:l=>s.pickOrganism(u),color:"destructive"},{default:c(()=>[...e[7]||(e[7]=[f(" Change ",-1)])]),_:1},8,["onClick"]),I(r,{onClick:l=>s.saveOrgResult(n),color:"primary"},{default:c(()=>[...e[8]||(e[8]=[f(" Save ",-1)])]),_:1},8,["onClick"])],64)):x("",!0),s.analysisResult.status=="pending"&&s.organismResults.length>1?(o(),b(r,{key:1,onClick:l=>s.removeOrgResult(n),color:"destructive"},{default:c(()=>[...e[9]||(e[9]=[f(" Delete ",-1)])]),_:1},8,["onClick"])):x("",!0)])])]))),128))])])])])]),t("div",fe,[t("div",ge,[e[12]||(e[12]=t("h4",{class:"text-lg font-semibold text-foreground"},"Culture",-1)),t("span",pe,k(s.analysisResult.status),1)]),e[15]||(e[15]=t("div",{class:"border-t border-border"},null,-1)),t("div",ve,[s.analysisResult.status=="pending"?M((o(),m("textarea",{key:0,"onUpdate:modelValue":e[1]||(e[1]=n=>s.analysisResult.result=n),rows:"4",class:"w-full rounded-md border border-input bg-background px-3 py-2 text-sm ring-offset-background placeholder:text-muted-foreground focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50",placeholder:"Enter culture results..."},null,512)),[[T,s.analysisResult.result]]):(o(),m("p",be,k(s.analysisResult.result),1)),t("div",xe,[s.state.can_submit?(o(),b(r,{key:0,onClick:s.submitResults,color:"primary"},{default:c(()=>[...e[13]||(e[13]=[f(" Submit Results ",-1)])]),_:1})):x("",!0),s.state.can_approve?(o(),b(r,{key:1,onClick:s.approveResults,color:"primary"},{default:c(()=>[...e[14]||(e[14]=[f(" Approve Results ",-1)])]),_:1})):x("",!0)])])]),s.showModal?(o(),b(R,{key:0,onClose:e[3]||(e[3]=n=>s.showModal=!1)},{header:c(()=>[...e[16]||(e[16]=[t("h3",{class:"text-xl font-semibold text-foreground"},"Select Organism",-1)])]),body:c(()=>[t("div",ye,[t("div",_e,[M(t("input",{type:"text","onUpdate:modelValue":e[2]||(e[2]=n=>s.searchOrgText=n),onInput:s.searchOrganisms,placeholder:"Search organisms...",class:"flex-1 rounded-md border border-input bg-background px-3 py-2 text-sm ring-offset-background placeholder:text-muted-foreground focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2"},null,544),[[T,s.searchOrgText]])]),t("div",Oe,[(o(!0),m(D,null,N(s.organisms,n=>(o(),m("button",{key:n.uid,onClick:u=>s.selectOrganism(n),class:"w-full text-left px-4 py-2 text-sm text-foreground hover:bg-muted/50 rounded-md transition-colors duration-200"},k(n.name),9,ke))),128))])])]),_:1})):x("",!0)])}const Ue=Q(ee,[["render",he],["__file","/home/administrator/Documents/Development/beak-insights/felicity/felicity-lims/webapp/views/sample/_id/results/OrganismResults.vue"]]);export{Ue as default};
