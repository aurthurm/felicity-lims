import{a0 as q,f as J,a7 as d,ad as H,b7 as L,h as X,_ as Y,r as k,c as i,o as a,A as r,E as _,L as f,J as Z,K as $,C as ee,aQ as te,a as C,Q as oe,P as re}from"./index-Cdc6vSVw.js";import{g as ne,h as se,D as ae,i as ie}from"./grind.queries-DWTWVmgu.js";const le=q({__name:"ErrandFile",props:{errandUid:{type:String,required:!0}},setup(w,{expose:c}){c();const b=w,{withClientMutation:t,withClientQuery:x}=J(),y=d(null),p=d(null);H(()=>{E()});const u=d(!1),l=d(null),n=d(null),v=d(!1),g=d(null),F=d(!1),m=d([]),E=()=>{x(ne,{target:L.Errand,targetUid:b.errandUid},"grindMediaByTarget").then(e=>{e&&(m.value=e)})},M=e=>{t(se,{payload:e},"createGrindMedia").then(o=>{o&&(m.value=[o,...m.value])})},P=e=>{y.value=e,p.value=null,t(ae,{uid:e},"deleteGrindMedia").then(o=>{o&&(m.value=m.value.filter(s=>s.uid!==e))}).catch(o=>{p.value=o?.message||"Failed to delete file"}).finally(()=>{y.value=null})},T=e=>{const o=parseInt(e);return o<1024?`${o} B`:o<1024*1024?`${(o/1024).toFixed(1)} KB`:`${(o/(1024*1024)).toFixed(1)} MB`},G=e=>{const{mimetype:o,filename:s}=e;return o?.startsWith("image/")?"image":o?.includes("pdf")||s.endsWith(".pdf")?"pdf":o?.includes("word")||s.endsWith(".doc")||s.endsWith(".docx")?"doc":o?.includes("sheet")||s.endsWith(".xls")||s.endsWith(".xlsx")?"excel":"file"},I=e=>{try{x(ie,{uid:e.uid},"downloadGrindMediaFile").then(o=>{const s=atob(o.content),S=new Uint8Array(s.length);for(let D=0;D<s.length;D++)S[D]=s.charCodeAt(D);const Q=new Blob([S],{type:o.mimetype}),z=URL.createObjectURL(Q),h=document.createElement("a");h.href=z,h.download=o.filename,document.body.appendChild(h),h.click(),setTimeout(()=>{document.body.removeChild(h),URL.revokeObjectURL(z)},0)})}catch(o){console.error("Error downloading file:",o)}},U=e=>{if(g.value=null,l.value=e,e.type.startsWith("image/")){const o=new FileReader;o.onload=s=>{n.value=s.target?.result},o.readAsDataURL(e)}else n.value=null},W=async()=>{if(l.value){v.value=!0,g.value=null;try{const e=await M({file:l.value,target:L.Errand,targetUid:b.errandUid});e?.error?g.value=e.error.message:F.value=!0}catch(e){g.value=e instanceof Error?e.message:"Upload failed"}finally{v.value=!1}}},j=e=>{const o=e.target;o.files&&o.files.length>0&&U(o.files[0])},A=e=>{e.preventDefault(),e.stopPropagation(),u.value=!0},R=e=>{e.preventDefault(),e.stopPropagation(),u.value=!1},N=e=>{e.preventDefault(),e.stopPropagation(),u.value=!0},O=e=>{e.preventDefault(),e.stopPropagation(),u.value=!1,e.dataTransfer&&e.dataTransfer.files.length>0&&U(e.dataTransfer.files[0])},V=()=>{l.value=null,n.value=null,F.value=!1,g.value=null},K=X(()=>{if(!l.value)return"";const e=l.value.size;return e<1024?`${e} B`:e<1024*1024?`${(e/1024).toFixed(1)} KB`:`${(e/(1024*1024)).toFixed(1)} MB`}),B={props:b,withClientMutation:t,withClientQuery:x,isDeleting:y,deleteError:p,isDragging:u,file:l,filePreview:n,isUploading:v,uploadError:g,uploadSuccess:F,errandFiles:m,getFiles:E,uploadFile:M,deleteFile:P,formatFileSize:T,getFileIcon:G,downloadFile:I,handleFileSelect:U,handleUpload:W,onFileInputChange:j,onDragEnter:A,onDragLeave:R,onDragOver:N,onDrop:O,resetUpload:V,fileSize:K};return Object.defineProperty(B,"__isScriptSetup",{enumerable:!1,value:!0}),B}}),de={class:"bg-background rounded-lg shadow-sm border border-border p-6 space-y-6"},ce={class:"flex justify-between items-start"},ue={class:"w-3/4 pr-4 space-y-4"},fe={key:0,class:"py-6 text-center text-muted-foreground bg-background rounded-lg border border-dashed border-border"},ge={key:1,class:"p-3 bg-destructive/10 text-destructive rounded-md"},me={key:2,class:"space-y-2"},pe={class:"flex items-center space-x-3"},ve={class:"text-muted-foreground"},he={class:"text-sm font-medium text-foreground"},_e={class:"text-xs text-muted-foreground"},be={class:"flex items-center space-x-2"},xe=["onClick"],ye=["onClick","disabled"],De={class:"w-1/4 pl-4"},we={key:0,class:"space-y-2"},Fe={class:"text-sm text-muted-foreground"},Ue={key:1,class:"space-y-3"},ke=["src"],Ce={class:"text-sm"},Ee={class:"font-medium text-foreground"},Me={class:"text-muted-foreground"},Be={class:"flex justify-center space-x-2"},Se=["disabled"],ze={key:1,class:"text-sm text-destructive"};function Le(w,c,b,t,x,y){const p=k("DownloadIcon"),u=k("TrashIcon"),l=k("UploadIcon");return a(),i("div",de,[r("div",ce,[r("div",ue,[c[1]||(c[1]=r("h3",{class:"text-lg font-medium text-foreground"},"Uploaded Files",-1)),t.errandFiles.length===0?(a(),i("div",fe," No files uploaded yet ")):_("",!0),t.deleteError?(a(),i("div",ge,f(t.deleteError),1)):_("",!0),t.errandFiles.length>0?(a(),i("ul",me,[(a(!0),i(Z,null,$(t.errandFiles,n=>(a(),i("li",{key:n.uid,class:"flex items-center justify-between p-3 bg-muted rounded-md hover:bg-muted/80 transition-colors duration-200"},[r("div",pe,[r("span",ve,[(a(),ee(te(t.getFileIcon(n)),{class:"w-5 h-5"}))]),r("div",null,[r("p",he,f(n.filename),1),r("p",_e,f(t.formatFileSize(n.size)),1)])]),r("div",be,[r("button",{onClick:v=>t.downloadFile(n),class:"p-1 text-muted-foreground hover:text-foreground transition-colors duration-200",title:"Download file"},[C(p,{class:"w-5 h-5"})],8,xe),r("button",{onClick:v=>t.deleteFile(n.uid),class:"p-1 text-muted-foreground hover:text-destructive transition-colors duration-200",disabled:t.isDeleting===n.uid,title:"Delete file"},[C(u,{class:"w-5 h-5"})],8,ye)])]))),128))])):_("",!0)]),r("div",De,[r("div",{class:oe(["border-2 border-dashed border-border rounded-lg p-6 text-center",{"border-primary bg-primary/5":t.isDragging}]),onDragenter:t.onDragEnter,onDragleave:t.onDragLeave,onDragover:t.onDragOver,onDrop:t.onDrop},[r("input",{type:"file",class:"hidden",ref:"fileInput",onChange:t.onFileInputChange},null,544),t.file?(a(),i("div",Ue,[t.filePreview?(a(),i("img",{key:0,src:t.filePreview,class:"max-h-32 mx-auto rounded-md",alt:"File preview"},null,8,ke)):_("",!0),r("div",Ce,[r("p",Ee,f(t.file.name),1),r("p",Me,f(t.fileSize),1)]),r("div",Be,[r("button",{onClick:t.resetUpload,class:"px-3 py-1 text-sm font-medium text-foreground bg-background border border-border rounded-md shadow-sm hover:bg-muted focus:outline-none focus:ring-2 focus:ring-primary focus:ring-offset-2 transition-colors duration-200"}," Cancel "),r("button",{onClick:t.handleUpload,disabled:t.isUploading,class:"px-3 py-1 text-sm font-medium text-primary-foreground bg-primary border border-transparent rounded-md shadow-sm hover:bg-primary/90 focus:outline-none focus:ring-2 focus:ring-primary focus:ring-offset-2 transition-colors duration-200"},f(t.isUploading?"Uploading...":"Upload"),9,Se)]),t.uploadError?(a(),i("p",ze,f(t.uploadError),1)):_("",!0)])):(a(),i("div",we,[C(l,{class:"w-8 h-8 mx-auto text-muted-foreground"}),r("p",Fe,[c[2]||(c[2]=re(" Drag and drop a file here, or ",-1)),r("button",{onClick:c[0]||(c[0]=n=>w.$refs.fileInput.click()),class:"text-primary hover:text-primary/80 transition-colors duration-200"}," browse ")])]))],34)])])])}const Ge=Y(le,[["render",Le],["__scopeId","data-v-334d1478"],["__file","/home/aurthurm/Documents/Development/felicity/felicity-lims/webapp/views/grind/_id/ErrandFile.vue"]]);export{Ge as default};
