import{d as n,f as o}from"./index-DApeomWQ.js";import{G as a,S as l,a as h,b as f,c as u,d,e as y,f as P,g,h as v,i as A,j as p}from"./billing.queries-DvXlf0-X.js";const{withClientQuery:c}=o(),V=n("billing",{state:()=>({profilePrice:void 0,profileDiscount:void 0,fetchingPrice:!1,analysisPrice:void 0,analysisDiscount:void 0,fetchingDiscount:!1,vouchers:[],fetchingVouchers:!1,fetchingVoucher:!1,fetchingVoucherCodes:!1,bills:[],fetchingBills:!1,billPageInfo:void 0,transactions:[],fetchingTransactions:!1,profilePrices:new Map,analysisPrices:new Map,fetchingPrices:!1}),getters:{getVouchers:i=>i.vouchers,getProfilePrice:i=>i.profilePrice,getAnalysisPrice:i=>i.analysisPrice,getBills:i=>i.bills},actions:{async clear(){this.analysisPrice=void 0,this.analysisDiscount=void 0,this.profilePrice=void 0,this.profileDiscount=void 0},async fetchProfilePrice(i){if(i)try{this.fetchingPrice=!0;const s=await c(p,{profileUid:i},"priceForProfile");s&&(this.profilePrice=s)}catch{}finally{this.fetchingPrice=!1}},async fetchProfileDiscount(i){if(i)try{this.fetchingDiscount=!0;const s=await c(A,{profileUid:i},"discountForProfile");s&&(this.profileDiscount=s)}catch{}finally{this.fetchingDiscount=!1}},async fetchAnalysisPrice(i){if(i)try{this.fetchingPrice=!0;const s=await c(v,{analysisUid:i},"priceForAnalysis");s&&(this.analysisPrice=s)}catch{}finally{this.fetchingPrice=!1}},async fetchAnalysisDiscount(i){if(i)try{this.fetchingDiscount=!0;const s=await c(g,{analysisUid:i},"discountForAnalysis");s&&(this.analysisDiscount=s)}catch{}finally{this.fetchingDiscount=!1}},async fetchVouchers(){try{this.fetchingVouchers=!0;const i=await c(P,{},"voucherAll");i&&Array.isArray(i)&&(this.vouchers=i)}catch{}finally{this.fetchingVouchers=!1}},async fetchVoucherByUid(i){if(i)try{this.fetchingVoucher=!0;const s=await c(y,{uid:i},"voucherByUid");if(s&&typeof s=="object"&&"uid"in s){const e=s,t=this.vouchers?.findIndex(r=>r.uid===e.uid);t>-1?this.vouchers[t]=e:this.vouchers=[e,...this.vouchers]}}catch{}finally{this.fetchingVoucher=!1}},async fetchVoucherCodes(i){if(i)try{this.fetchingVoucherCodes=!0;const s=await c(d,{voucherUid:i},"voucherCodes");if(s&&Array.isArray(s)){const e=s,t=this.vouchers?.findIndex(r=>r.uid===i);t>-1&&(this.vouchers[t]={...this.vouchers[t],codes:e})}}catch{}finally{this.fetchingVoucherCodes=!1}},addVoucher(i){i?.uid&&(this.vouchers=[i,...this.vouchers])},updateVoucher(i){if(!i?.uid)return;const s=this.vouchers?.findIndex(e=>e.uid===i.uid);s>-1&&(this.vouchers[s]={...this.vouchers[s],...i})},addVoucherCode(i){if(!i?.uid||!i?.voucherUid)return;const s=this.vouchers?.findIndex(e=>e.uid===i.voucherUid);s>-1&&(this.vouchers[s]={...this.vouchers[s],codes:[i,...this.vouchers[s].codes||[]]})},updateVoucherCode(i){if(!i?.uid||!i?.voucherUid)return;const s=this.vouchers?.findIndex(e=>e.uid===i.voucherUid);if(s>-1){const e=this.vouchers[s].codes||[],t=e?.findIndex(r=>r.uid===i.uid);t>-1&&(e[t]={...e[t],...i},this.vouchers[s]={...this.vouchers[s],codes:e})}},async fetchBillsForPatient(i){if(i)try{this.fetchingBills=!0;const s=await c(u,{patientUid:i},"billsForPatient");s&&Array.isArray(s)&&(this.bills=s)}catch{}finally{this.fetchingBills=!1}},async fetchBillsForClient(i){if(i)try{this.fetchingBills=!0;const s=await c(f,{clientUid:i},"billsForClient");s&&Array.isArray(s)&&(this.bills=s)}catch{}finally{this.fetchingBills=!1}},async fetchBillTransactions(i){if(i)try{this.fetchingTransactions=!0,this.transactions=[];const s=await c(h,{billUid:i},"billTransactions");s&&Array.isArray(s)&&(this.transactions=s)}catch{}finally{this.fetchingTransactions=!1}},addTransaction(i){i?.uid&&(this.transactions=[i,...this.transactions])},updateTransaction(i){if(!i?.uid)return;const s=this.transactions?.findIndex(e=>e.uid===i.uid);s>-1&&(this.transactions[s]={...this.transactions[s],...i})},async searchBills(i){try{this.fetchingBills=!0;const s=await c(l,{pageSize:i.pageSize||50,afterCursor:i.afterCursor||void 0,beforeCursor:i.beforeCursor||void 0,text:i.text||void 0,isActive:i.isActive!==null&&i.isActive!==void 0?i.isActive:void 0,partial:i.partial!==null&&i.partial!==void 0?i.partial:void 0,clientUid:i.clientUid||void 0,sortBy:i.sortBy||["-uid"]},"searchBills");if(s&&typeof s=="object"&&"items"in s){const e=s.items??[];this.bills=e,this.billPageInfo={hasNextPage:s.pageInfo?.hasNextPage??!1,hasPreviousPage:s.pageInfo?.hasPreviousPage??!1,endCursor:s.pageInfo?.endCursor??null,startCursor:s.pageInfo?.startCursor??null,totalCount:s.totalCount??0}}}catch{}finally{this.fetchingBills=!1}},async fetchBatchPrices(i,s){if(!(!i.length&&!s.length))try{this.fetchingPrices=!0;const e=await c(a,{profileUids:i||[],analysisUids:s||[]},"pricesForBatch");if(e&&typeof e=="object"){const t=e;t.profilePrices&&Array.isArray(t.profilePrices)&&t.profilePrices.forEach(r=>{r.profileUid&&this.profilePrices.set(r.profileUid,r)}),t.analysisPrices&&Array.isArray(t.analysisPrices)&&t.analysisPrices.forEach(r=>{r.analysisUid&&this.analysisPrices.set(r.analysisUid,r)})}}catch{}finally{this.fetchingPrices=!1}},getPriceForProfile(i){return this.profilePrices.get(i)?.amount??null},getPriceForAnalysis(i){return this.analysisPrices.get(i)?.amount??null},clearPriceCache(){this.profilePrices.clear(),this.analysisPrices.clear()}}});export{V as u};
