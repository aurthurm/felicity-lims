const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/AnalysisSneak-Bh5Pme9f.js","assets/index-Daoe3XS9.js","assets/index-C7Rn7ES8.css","assets/ResultDetail-CPX1Ch8t.js"])))=>i.map(i=>d[i]);
import{a0 as ne,u as re,g as ae,a7 as W,a1 as X,a6 as Y,au as S,h as le,U as ie,_ as de,r as V,aa as ue,c as l,o as a,A as t,a as x,F as c,a3 as Z,J as g,K as k,Q as $,C as h,E as T,L as u,a9 as N,a2 as ce,H as w,N as _,P as U,D as E}from"./index-Daoe3XS9.js";import{u as fe}from"./analysis-COIZw9qf.js";import{p as me}from"./index-Cgdayxkn.js";import{s as be}from"./index-YWAiCrzl.js";import"./analyses.mutations-DmiK7cfK.js";const pe=ne({__name:"GenericResults",props:{sample:Object,analysisResults:Object,fetchingResults:Boolean},setup(y,{expose:e}){e();const I=X(()=>Y(()=>import("./AnalysisSneak-Bh5Pme9f.js"),__vite__mapDeps([0,1,2]))),s=X(()=>Y(()=>import("./ResultDetail-CPX1Ch8t.js"),__vite__mapDeps([3,1,2]))),D=re(),d=ae({can_submit:!1,can_cancel:!1,can_retract:!1,can_approve:!1,can_retest:!1,can_reinstate:!1,allChecked:!1});function R(){let n=[];return y.analysisResults?.forEach(i=>{i.checked&&n.push(i)}),n}function b(){let n=R(),i=[];return n?.forEach(p=>i.push({uid:p.uid,result:p.result,methodUid:p.methodUid,laboratoryInstrumentUid:p.laboratoryInstrumentUid})),i}function f(){const n=R();let i=[];return n?.forEach(p=>i.push(p.uid)),i}function P(n){G()?d.allChecked=!0:d.allChecked=!1,C()}function A(n){q(n)||(n.checked=!0,C())}function o(n){n.checked=!1,C()}async function r(){await y.analysisResults?.forEach(n=>d.allChecked?A(n):o(n)),C()}async function m(){await y.analysisResults?.forEach(n=>o(n)),C()}function G(){return y.analysisResults?.every(n=>n.checked===!0)||!1}function q(n){switch(n?.status){case"retracted":return!0;case"approved":return!0;case"cancelled":return y.sample?.status!=="received";default:return!1}}function z(n){n.editable=!0}function ee(n){return!["received","paired"].includes(y.sample?.status??"")||n.status!=="pending"?!1:n?.editable||S(n?.result)?(z(n),!0):!1}function te(n){switch(n?.status){case"retracted":return"bg-muted";case"approved":return n?.reportable===!1?"bg-destructive":"";default:return""}}function C(){d.can_cancel=!1,d.can_submit=!1,d.can_retract=!1,d.can_approve=!1,d.can_retest=!1,d.can_reinstate=!1;const n=R();n.length!==0&&(n.every(i=>i.status==="cancelled")&&(d.can_reinstate=!0),n.every(i=>i.status==="pending")&&(d.can_cancel=!0),n.every(i=>["pending"].includes(i.status??"")&&!S(i.result)&&!S(i.methodUid)&&!S(i.laboratoryInstrumentUid))&&(d.can_submit=!0),n.every(i=>i.status==="resulted")&&(d.can_retract=!0,d.can_approve=!0,d.can_retest=!0))}const v=async()=>{const n=le(()=>D.getSample);n.value&&D.fetchSampleStatus(n.value.uid)},se=(n,i)=>{let p=[];return n?.forEach(F=>p.push(F.name)),i?.forEach(F=>p.push(F.name)),p.join(", ")},H=W(!1),J=W(void 0),oe=n=>{H.value=!0,J.value=n};let{submitResults:j,cancelResults:B,reInstateResults:L,approveResults:O,retractResults:M,retestResults:K}=fe();const Q={AnalysisSneak:I,ResultDetail:s,sampleStore:D,state:d,getResultsChecked:R,prepareResults:b,getResultsUids:f,checkCheck:P,check:A,unCheck:o,toggleCheckAll:r,unCheckAll:m,areAllChecked:G,isDisabledRowCheckBox:q,editResult:z,isEditable:ee,getResultRowColor:te,resetAnalysesPermissions:C,_updateSample:v,profileAnalysesText:se,viewInfo:H,viewResultInfo:J,viewAnalysisInfo:oe,get submitter_(){return j},set submitter_(n){j=n},get canceller_(){return B},set canceller_(n){B=n},get reInstater_(){return L},set reInstater_(n){L=n},get approver_(){return O},set approver_(n){O=n},get retracter_(){return M},set retracter_(n){M=n},get retester_(){return K},set retester_(n){K=n},submitResults:()=>j(b(),ie.Sample,y.sample?.uid).then(()=>v()).finally(()=>m()),cancelResults:()=>B(f()).then(()=>v()).finally(()=>m()),reInstateResults:()=>L(f()).then(()=>v()).finally(()=>m()),approveResults:()=>O(f(),"sample",y.sample?.uid).then(()=>v()).finally(()=>m()),retractResults:()=>M(f()).then(()=>v()).finally(()=>m()),retestResults:()=>K(f()).then(()=>v()).finally(()=>m()),get parseDate(){return me},get shield(){return be}};return Object.defineProperty(Q,"__isScriptSetup",{enumerable:!1,value:!0}),Q}}),ye={class:"space-y-6"},xe={class:"rounded-lg border border-border bg-background shadow-sm"},ge={key:0,class:"p-6 text-center"},he={key:1,class:"overflow-x-auto"},_e={class:"w-full fel-table"},ve={class:"border-b border-border bg-muted/50"},ke={class:"px-4 py-3 text-left text-sm font-medium text-muted-foreground"},Re={class:"px-4 py-3 border-b border-border"},Ce={class:"flex items-center space-x-2"},we=["onUpdate:modelValue","onChange","disabled"],Ue={class:"px-4 py-3 border-b border-border"},Ee={class:"flex items-center space-x-2"},Ie=["onClick"],De={class:"font-medium"},Ae={class:"px-4 py-3 border-b border-border"},Se={key:0,class:"text-sm text-foreground"},Ve=["onUpdate:modelValue","onChange"],Te=["value"],Ne={class:"px-4 py-3 border-b border-border"},Pe={key:0,class:"text-sm text-foreground"},je=["onUpdate:modelValue","onChange"],Be=["value"],Le={class:"px-4 py-3 border-b border-border"},Oe={class:"text-sm text-foreground"},Me={class:"px-4 py-3 border-b border-border"},Ke={class:"text-sm text-foreground space-x-1"},Fe={class:"px-4 py-3 border-b border-border"},Ge={key:0,class:"text-sm text-foreground"},qe=["onUpdate:modelValue","onChange"],ze=["value"],He={class:"px-4 py-3 border-b border-border"},Je={key:0,class:"text-sm text-foreground"},Qe=["onUpdate:modelValue","onKeyup"],We=["onUpdate:modelValue","onChange"],Xe=["value"],Ye={class:"px-4 py-3 border-b border-border"},Ze={class:"text-sm"},$e={class:"px-4 py-3 border-b border-border"},et={class:"text-sm text-foreground"},tt={class:"px-4 py-3 border-b border-border"},st={class:"text-sm text-foreground"},ot={class:"px-4 py-3 border-b border-border"},nt={class:"text-sm text-foreground"},rt={class:"px-4 py-3 border-b border-border"},at={class:"px-4 py-3 border-b border-border"},lt={class:"text-sm"},it={class:"flex items-center space-x-4 pt-4"},dt={class:"space-y-6"};function ut(y,e,I,s,D,d){const R=V("fel-loader"),b=V("font-awesome-icon"),f=V("fel-button"),P=V("fel-drawer"),A=ue("motion-slide-right");return a(),l(g,null,[t("div",ye,[e[29]||(e[29]=t("div",{class:"border-t border-border my-4"},null,-1)),e[30]||(e[30]=t("h3",{class:"text-lg font-semibold text-foreground"},"Analyses/Results",-1)),e[31]||(e[31]=t("div",{class:"border-t border-border my-4"},null,-1)),t("div",xe,[I.fetchingResults?(a(),l("div",ge,[x(R,{message:"Fetching analytes ..."})])):(a(),l("div",he,[t("table",_e,[t("thead",null,[t("tr",ve,[t("th",ke,[c(t("input",{type:"checkbox",onChange:s.toggleCheckAll,"onUpdate:modelValue":e[0]||(e[0]=o=>s.state.allChecked=o),class:"rounded border-input text-primary focus:ring-primary"},null,544),[[Z,s.state.allChecked]])]),e[2]||(e[2]=t("th",{class:"px-4 py-3 text-left text-sm font-medium text-muted-foreground"},null,-1)),e[3]||(e[3]=t("th",{class:"px-4 py-3 text-left text-sm font-medium text-muted-foreground"},"Analysis",-1)),e[4]||(e[4]=t("th",{class:"px-4 py-3 text-left text-sm font-medium text-muted-foreground"},"Instrument",-1)),e[5]||(e[5]=t("th",{class:"px-4 py-3 text-left text-sm font-medium text-muted-foreground"},"Method",-1)),e[6]||(e[6]=t("th",{class:"px-4 py-3 text-left text-sm font-medium text-muted-foreground"},"Analyst",-1)),e[7]||(e[7]=t("th",{class:"px-4 py-3 text-left text-sm font-medium text-muted-foreground"},"Reviewer(s)",-1)),e[8]||(e[8]=t("th",{class:"px-4 py-3 text-left text-sm font-medium text-muted-foreground"},"Interim",-1)),e[9]||(e[9]=t("th",{class:"px-4 py-3 text-left text-sm font-medium text-muted-foreground"},"Result",-1)),e[10]||(e[10]=t("th",{class:"px-4 py-3 text-left text-sm font-medium text-muted-foreground"},"Retest",-1)),e[11]||(e[11]=t("th",{class:"px-4 py-3 text-left text-sm font-medium text-muted-foreground"},"Due Date",-1)),e[12]||(e[12]=t("th",{class:"px-4 py-3 text-left text-sm font-medium text-muted-foreground"},"Submitted",-1)),e[13]||(e[13]=t("th",{class:"px-4 py-3 text-left text-sm font-medium text-muted-foreground"},"Approved",-1)),e[14]||(e[14]=t("th",{class:"px-4 py-3 text-left text-sm font-medium text-muted-foreground"},"Status",-1)),e[15]||(e[15]=t("th",{class:"px-4 py-3 text-left text-sm font-medium text-muted-foreground"},"Reportable",-1)),e[16]||(e[16]=t("th",{class:"px-4 py-3"},null,-1))])]),t("tbody",null,[(a(!0),l(g,null,k(I.analysisResults,o=>c((a(),l("tr",{key:o.uid,class:$([s.getResultRowColor(o),"hover:bg-muted/50 transition-colors duration-200"])},[t("td",Re,[t("div",Ce,[c(t("input",{type:"checkbox","onUpdate:modelValue":r=>o.checked=r,onChange:r=>s.checkCheck(o),disabled:s.isDisabledRowCheckBox(o),class:"rounded border-input text-primary focus:ring-primary"},null,40,we),[[Z,o.checked]]),o.status==="pending"?(a(),h(b,{key:0,icon:"fa-question",class:"text-xs text-muted-foreground"})):T("",!0),o.status==="resulted"?(a(),h(b,{key:1,icon:"fa-question",class:"text-xs text-warning"})):T("",!0)])]),e[21]||(e[21]=t("td",{class:"px-4 py-3 border-b border-border"},null,-1)),t("td",Ue,[t("div",Ee,[t("button",{type:"button",onClick:r=>s.viewAnalysisInfo(o),class:"text-primary hover:text-primary/80 transition-colors"},[x(b,{icon:"fa-info-circle"})],8,Ie),t("span",De,u(o.analysis?.name),1)])]),t("td",Ae,[s.isEditable(o)?c((a(),l("select",{key:1,"onUpdate:modelValue":r=>o.laboratoryInstrumentUid=r,onChange:r=>s.check(o),class:"w-full rounded-md border border-input bg-background px-3 py-2 text-sm ring-offset-background focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2"},[e[17]||(e[17]=t("option",{value:""},null,-1)),(a(!0),l(g,null,k(o.analysis?.instruments,r=>(a(),l(g,{key:r.uid},[(a(!0),l(g,null,k(r.laboratoryInstruments,m=>(a(),l("option",{key:m.uid,value:m.uid},u(m.labName)+" â†’ ("+u(r?.name)+") ",9,Te))),128))],64))),128))],40,Ve)),[[N,o.laboratoryInstrumentUid]]):(a(),l("div",Se,u(o.laboratoryInstrument?.labName||"---"),1))]),t("td",Ne,[s.isEditable(o)?c((a(),l("select",{key:1,"onUpdate:modelValue":r=>o.methodUid=r,onChange:r=>s.check(o),class:"w-full rounded-md border border-input bg-background px-3 py-2 text-sm ring-offset-background focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2"},[e[18]||(e[18]=t("option",{value:""},null,-1)),(a(!0),l(g,null,k(o.analysis?.methods,r=>(a(),l("option",{key:r.uid,value:r.uid},u(r.name),9,Be))),128))],40,je)),[[N,o.methodUid]]):(a(),l("div",Pe,u(o.method?.name||"---"),1))]),t("td",Le,[t("span",Oe,u(`${o.submittedBy?.firstName??"--"} ${o.submittedBy?.lastName??"--"}`),1)]),t("td",Me,[t("div",Ke,[(a(!0),l(g,null,k(o.verifiedBy,r=>(a(),l("span",{key:r.uid},u(`${r?.firstName??"--"} ${r?.lastName??"--"},`),1))),128))])]),t("td",Fe,[!s.isEditable(o)||o?.analysis?.interims?.length===0?(a(),l("div",Ge," --- ")):c((a(),l("select",{key:1,"onUpdate:modelValue":r=>o.result=r,onChange:r=>s.check(o),class:"w-full rounded-md border border-input bg-background px-3 py-2 text-sm ring-offset-background focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2"},[e[19]||(e[19]=t("option",{value:""},null,-1)),(a(!0),l(g,null,k(o?.analysis?.interims,r=>(a(),l("option",{key:r.key,value:r.value},u(r.value),9,ze))),128))],40,qe)),[[N,o.result]])]),t("td",He,[s.isEditable(o)?o?.analysis?.resultOptions?.length===0?c((a(),l("input",{key:1,"onUpdate:modelValue":r=>o.result=r,onKeyup:r=>s.check(o),class:"w-full rounded-md border border-input bg-background px-3 py-2 text-sm ring-offset-background focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2"},null,40,Qe)),[[ce,o.result]]):c((a(),l("select",{key:2,"onUpdate:modelValue":r=>o.result=r,onChange:r=>s.check(o),class:"w-full rounded-md border border-input bg-background px-3 py-2 text-sm ring-offset-background focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2"},[e[20]||(e[20]=t("option",{value:""},null,-1)),(a(!0),l(g,null,k(o?.analysis?.resultOptions,r=>(a(),l("option",{key:r.optionKey,value:r.value},u(r.value),9,Xe))),128))],40,We)),[[N,o.result]]):(a(),l("div",Je,u(o?.result),1))]),t("td",Ye,[t("div",Ze,[o?.retest?(a(),h(b,{key:0,icon:"fa-check-circle",class:"text-success"})):(a(),h(b,{key:1,icon:"fa-times-circle",class:"text-destructive"}))])]),t("td",$e,[t("span",et,u(s.parseDate(o?.dueDate)),1)]),t("td",tt,[t("span",st,u(s.parseDate(o?.dateSubmitted)),1)]),t("td",ot,[t("span",nt,u(s.parseDate(o?.dateVerified)),1)]),t("td",rt,[t("span",{class:$(["inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium",{"bg-primary/10 text-primary":o.status==="pending","bg-warning/10 text-warning":o.status==="resulted","bg-success/10 text-success":o.status==="approved","bg-destructive/10 text-destructive":o.status==="cancelled"||o.status==="retracted"}])},u(o.status),3)]),t("td",at,[t("div",lt,[o?.reportable?(a(),h(b,{key:0,icon:"fa-thumbs-up",class:"text-success","aria-label":"Reportable"})):(a(),h(b,{key:1,icon:"fa-thumbs-down",class:"text-destructive","aria-label":"Not reportable"}))])]),e[22]||(e[22]=t("td",{class:"px-4 py-3 border-b border-border"},null,-1))],2)),[[A]])),128))])])]))]),t("div",it,[c(x(f,{key:"cancel",onClick:E(s.cancelResults,["prevent"]),color:"destructive"},{default:_(()=>[...e[23]||(e[23]=[U(" Cancel ",-1)])]),_:1},512),[[w,s.shield.hasRights(s.shield.actions.UPDATE,s.shield.objects.RESULT)&&s.state.can_cancel]]),c(x(f,{key:"reinstate",onClick:E(s.reInstateResults,["prevent"]),color:"warning"},{default:_(()=>[...e[24]||(e[24]=[U(" Re-Instate ",-1)])]),_:1},512),[[w,s.shield.hasRights(s.shield.actions.UPDATE,s.shield.objects.RESULT)&&s.state.can_reinstate]]),c(x(f,{key:"submit",onClick:E(s.submitResults,["prevent"]),color:"primary"},{default:_(()=>[...e[25]||(e[25]=[U(" Submit ",-1)])]),_:1},512),[[w,s.shield.hasRights(s.shield.actions.UPDATE,s.shield.objects.RESULT)&&s.state.can_submit]]),c(x(f,{key:"retract",onClick:E(s.retractResults,["prevent"]),color:"warning"},{default:_(()=>[...e[26]||(e[26]=[U(" Retract ",-1)])]),_:1},512),[[w,s.shield.hasRights(s.shield.actions.UPDATE,s.shield.objects.RESULT)&&s.state.can_retract]]),c(x(f,{key:"verify",onClick:E(s.approveResults,["prevent"]),color:"success"},{default:_(()=>[...e[27]||(e[27]=[U(" Verify ",-1)])]),_:1},512),[[w,s.shield.hasRights(s.shield.actions.UPDATE,s.shield.objects.RESULT)&&s.state.can_approve]]),c(x(f,{key:"retest",onClick:E(s.retestResults,["prevent"]),color:"warning"},{default:_(()=>[...e[28]||(e[28]=[U(" Retest ",-1)])]),_:1},512),[[w,s.shield.hasRights(s.shield.actions.UPDATE,s.shield.objects.RESULT)&&s.state.can_retest]])])]),x(P,{show:s.viewInfo,onClose:e[1]||(e[1]=o=>s.viewInfo=!1),"content-width":"w-2/4"},{header:_(()=>[...e[32]||(e[32]=[t("h3",{class:"text-lg font-semibold text-foreground"},"Result Information",-1)])]),body:_(()=>[t("div",dt,[s.viewResultInfo?.analysisUid?(a(),h(s.AnalysisSneak,{key:0,analysisUid:s.viewResultInfo?.analysisUid},null,8,["analysisUid"])):T("",!0),s.viewResultInfo?.uid?(a(),h(s.ResultDetail,{key:1,analysisResultesultUid:s.viewResultInfo?.uid},null,8,["analysisResultesultUid"])):T("",!0)])]),_:1},8,["show"])],64)}const kt=de(pe,[["render",ut],["__file","/home/administrator/Documents/Development/beak-insights/felicity/felicity-lims/webapp/views/sample/_id/results/GenericResults.vue"]]);export{kt as default};
