import{W as P,f as Q,a2 as p,i as H,a9 as J,h as W,r as S,o as a,c as r,O as s,z as v,M as u,N as c,L as g,F as w,H as N,J as x,a as j,D as $,Z as I,Q as V,_ as Z}from"./index-93739211.js";import{u as K}from"./analysis-cdcc3ff0.js";import{G as X,A as Y,S as ee,D as se,a as te}from"./microbiology.mutations-8d828444.js";import"./analyses.mutations-e3a0ff1f.js";const ne={class:"space-y-6"},ae={class:"bg-background rounded-lg shadow-sm"},oe={class:"p-6 space-y-6"},le={class:"flex items-center justify-between"},ie={class:"overflow-x-auto"},re={class:"w-full"},ue={class:"px-4 py-2"},de={class:"text-sm text-foreground"},me={class:"px-4 py-2"},ce={key:0,class:"text-sm text-primary"},fe={class:"px-4 py-2 text-right"},pe={class:"flex items-center justify-end space-x-2"},ve={class:"bg-background rounded-lg shadow-sm p-6 space-y-6"},ge={class:"flex items-center justify-between"},xe={class:"inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-primary text-primary-foreground"},be={class:"space-y-4"},ye={key:1,class:"text-sm text-muted-foreground"},_e={class:"flex justify-end space-x-4"},ke={class:"p-6 space-y-6"},Oe={class:"flex items-center space-x-4"},he={class:"space-y-2"},Ce=["onClick"],Ae=P({__name:"OrganismResults",props:{sample:{type:Object,required:!0},analysisResults:{type:Object,required:!0}},setup(b){const{withClientMutation:k,withClientQuery:R}=Q(),i=p([]),y=p(!1),_=p(""),D=p([]),O=p(void 0),m=p(!1),o=H(()=>b.analysisResults[0]);J(()=>{R(X,{analysisResultUid:o.value.uid},"abxOrganismResultAll").then(t=>{t&&(i.value=t||[])}).finally(()=>h())});function B(){m.value=!0,k(Y,{analysisResultUid:o.value.uid},"createAbxOrganismResult").then(t=>{t&&i.value.unshift(t)}).finally(()=>m.value=!1)}function M(t){m.value=!0,k(ee,{uid:t.uid,organismUid:t.organism?.uid??""},"saveAbxOrganismResult").then(e=>{if(e){const l=i.value.findIndex(d=>d.uid===t.uid);if(l>-1){const d=e.organism;i.value[l].organismUid=d?.uid,i.value[l].organism=d}}}).finally(()=>{m.value=!1,h()})}function T(t){m.value=!0,k(se,{uid:t.uid},"removeAbxOrganismResult").then(e=>{if(e){const l=i.value.findIndex(d=>d.uid===e?.uid);l>-1&&i.value.splice(l,1)}}).finally(()=>{m.value=!1,h()})}function U(t){O.value=t,y.value=!0}function z(t){y.value=!1,i.value[O.value].organism=t,O.value=void 0,b.analysisResults[0].result=i.value?.map(e=>e.organism?.name).join(", ")}function F(){_.value.length<3||R(te,{text:_.value,pageSize:25,sortBy:["name"]},"abxOrganismAll").then(t=>{D.value=t?.items})}const f=W({can_submit:!1,can_approve:!1});function h(){f.can_submit=!1,f.can_approve=!1;const t=i.value?.every(e=>e.organismUid!=null);o.value.status=="pending"&&t&&(f.can_submit=!0),o.value.status=="resulted"&&(f.can_approve=!0)}let{submitResults:G,approveResults:q}=K();const E=()=>G([{uid:o.value.uid,result:o.value.result??"",methodUid:"felicity_ast",laboratoryInstrumentUid:"felicity_ast"}],V.Sample,b.sample?.uid).then(()=>{}),L=()=>q([o.value.uid],V.Sample,b.sample?.uid).then(()=>{});return(t,e)=>{const l=S("fel-button"),d=S("fel-modal");return a(),r("div",ne,[s("div",ae,[s("div",oe,[s("div",le,[e[5]||(e[5]=s("h3",{class:"text-lg font-semibold text-foreground"},"Organisms",-1)),o.value.status=="pending"?(a(),v(l,{key:0,onClick:e[0]||(e[0]=n=>B()),disabled:m.value,color:"primary"},{default:u(()=>e[4]||(e[4]=[c(" Add Organism ")])),_:1},8,["disabled"])):g("",!0)]),e[11]||(e[11]=s("div",{class:"border-t border-border"},null,-1)),s("div",ie,[s("table",re,[e[10]||(e[10]=s("thead",null,[s("tr",{class:"border-b border-border bg-muted/50"},[s("th",{class:"px-4 py-2 text-left text-sm font-medium text-foreground"},"Isolate Number"),s("th",{class:"px-4 py-2 text-left text-sm font-medium text-foreground"},"Organism Name"),s("th",{class:"px-4 py-2"})])],-1)),s("tbody",null,[(a(!0),r(w,null,N(i.value,(n,C)=>(a(),r("tr",{key:n?.uid,class:"border-b border-border hover:bg-muted/50 transition-colors duration-200"},[s("td",ue,[s("span",de,"#"+x(n?.isolateNumber),1)]),s("td",me,[n?.organism?(a(),r("span",ce,x(n?.organism?.name),1)):(a(),v(l,{key:1,onClick:A=>U(C),color:"outline"},{default:u(()=>[...e[6]||(e[6]=[c(" Pick Organism ")])]),_:2},1032,["onClick"]))]),s("td",fe,[s("div",pe,[n?.organism&&!n?.organismUid?(a(),r(w,{key:0},[j(l,{onClick:A=>U(C),color:"destructive"},{default:u(()=>[...e[7]||(e[7]=[c(" Change ")])]),_:2},1032,["onClick"]),j(l,{onClick:A=>M(n),color:"primary"},{default:u(()=>[...e[8]||(e[8]=[c(" Save ")])]),_:2},1032,["onClick"])],64)):g("",!0),o.value.status=="pending"&&i.value.length>1?(a(),v(l,{key:1,onClick:A=>T(n),color:"destructive"},{default:u(()=>[...e[9]||(e[9]=[c(" Delete ")])]),_:2},1032,["onClick"])):g("",!0)])])]))),128))])])])])]),s("div",ve,[s("div",ge,[e[12]||(e[12]=s("h4",{class:"text-lg font-semibold text-foreground"},"Culture",-1)),s("span",xe,x(o.value.status),1)]),e[15]||(e[15]=s("div",{class:"border-t border-border"},null,-1)),s("div",be,[o.value.status=="pending"?$((a(),r("textarea",{key:0,"onUpdate:modelValue":e[1]||(e[1]=n=>o.value.result=n),rows:"4",class:"w-full rounded-md border border-input bg-background px-3 py-2 text-sm ring-offset-background placeholder:text-muted-foreground focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50",placeholder:"Enter culture results..."},null,512)),[[I,o.value.result]]):(a(),r("p",ye,x(o.value.result),1)),s("div",_e,[f.can_submit?(a(),v(l,{key:0,onClick:E,color:"primary"},{default:u(()=>e[13]||(e[13]=[c(" Submit Results ")])),_:1})):g("",!0),f.can_approve?(a(),v(l,{key:1,onClick:L,color:"primary"},{default:u(()=>e[14]||(e[14]=[c(" Approve Results ")])),_:1})):g("",!0)])])]),y.value?(a(),v(d,{key:0,onClose:e[3]||(e[3]=n=>y.value=!1)},{header:u(()=>e[16]||(e[16]=[s("h3",{class:"text-xl font-semibold text-foreground"},"Select Organism",-1)])),body:u(()=>[s("div",ke,[s("div",Oe,[$(s("input",{type:"text","onUpdate:modelValue":e[2]||(e[2]=n=>_.value=n),onInput:F,placeholder:"Search organisms...",class:"flex-1 rounded-md border border-input bg-background px-3 py-2 text-sm ring-offset-background placeholder:text-muted-foreground focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2"},null,544),[[I,_.value]])]),s("div",he,[(a(!0),r(w,null,N(D.value,n=>(a(),r("button",{key:n.uid,onClick:C=>z(n),class:"w-full text-left px-4 py-2 text-sm text-foreground hover:bg-muted/50 rounded-md transition-colors duration-200"},x(n.name),9,Ce))),128))])])]),_:1})):g("",!0)])}}}),Se=Z(Ae,[["__file","/home/aurthurm/Documents/Development/felicity/felicity-lims/webapp/views/sample/_id/results/OrganismResults.vue"]]);export{Se as default};
