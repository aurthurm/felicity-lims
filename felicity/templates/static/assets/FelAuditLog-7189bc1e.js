import{e as T,d as O,P as E,t as V,ai as C,h as P,$ as R,o as a,c as d,a2 as l,a as j,A as z,F as b,D as y,b as i,E as c,L,a5 as m,X as J,Y as G,_ as I}from"./index-fa13e788.js";import{u as M}from"./user-c399b7d7.js";import{d as Q}from"./_queries-fa6c96fd.js";const{withClientQuery:X}=T(),Y=O("auditlog",{state:()=>({auditLogs:[],fetchingAudits:!1}),getters:{getAuditLogs:_=>_.auditLogs},actions:{async fetchAuditLogs(_){this.fetchingAudits=!0,await X(Q,_,"auditLogsFilter").then(p=>{this.fetchingAudits=!1,this.auditLogs=p?.map(r=>(r.stateAfter=typeof r?.stateAfter=="string"?JSON.parse(r?.stateAfter):r?.stateAfter,r.stateBefore=typeof r?.stateBefore=="string"?JSON.parse(r?.stateBefore):r?.stateBefore,r))}).catch(p=>this.fetchingAudits=!1)},async restLogs(){this.auditLogs=[]}}}),$={class:"relative mt-4"},q=i("div",{class:"border-r-2 border-gray-400 border-dotted absolute h-full top-0 z-0",style:{left:"7px"}},null,-1),H={key:0,class:"py-4 text-center"},K={key:1,initial:{opacity:0,y:100},enter:{opacity:1,y:0,scale:1},variants:{custom:{scale:2}},delay:200,class:"list-none m-0 p-0"},W={class:"flex items-center mb-1"},Z=i("div",{class:"bg-indigo-600 rounded-full h-4 w-4 border-gray-200 border-2 z-10"},null,-1),v={class:"ml-4 font-medium italic"},B={class:"ml-12 w-100"},k={class:"col-span-1"},A={class:"text-sm text-gray-600 italic"},tt={class:"col-span-3"},et={class:"text-muted text-xs text-orange-600"},st={class:"text-muted text-xs text-sky-800"},it=E({__name:"FelAuditLog",props:{targetUid:String,targetType:String},setup(_){const p=J(()=>G(()=>import("./FelLoadingMessage-c4848162.js"),["assets/FelLoadingMessage-c4848162.js","assets/index-fa13e788.js","assets/index-ccc6a521.css"])),r=_,{targetType:x,targetUid:S}=V(r),h=M(),g=Y();g.restLogs();const{auditLogs:w,fetchingAudits:D}=C(g);h.fetchUsers({}),g.fetchAuditLogs({targetType:x?.value,targetUid:S?.value});let U=P(()=>h.getUsers);function n(o){const u=U?.value?.find(f=>f.uid?.toString()===o?.toString());return u?u.userName:""}function N(o){return o===1?"created":o===2?"updated":o===3?"deleted":""}function F(o){let u=new Set;return Object.entries(o?.stateBefore)?.map(([f,e])=>{Object.entries(o?.stateAfter)?.map(([t,s])=>{f===t&&e!==s&&(t&&t==="updated_by_uid"&&(t="updated_by",e=n(e),s=n(s)),t&&t==="submitted_by_uid"&&(t="submitted_by",e=n(e),s=n(s)),t&&t==="verified_by_uid"&&(t="verified_by",e=n(e),s=n(s)),t&&t==="updated_at"&&(t="updated_on",e=m(e),s=m(s)),t&&t==="cancelled_by_uid"&&(t="cancelled_by",e=n(e),s=n(s)),t&&t==="received_by_uid"&&(t="received_by",e=n(e),s=n(s)),u.add({key:t,old:e?.length>0?e:"None",new:s?.toString()?.length>0?s:"None"}))})}),u}return(o,u)=>{const f=R("motion");return a(),d("div",$,[q,l(D)?(a(),d("div",H,[j(l(p),{message:"Fetching audit logs ..."})])):z((a(),d("ul",K,[(a(!0),d(b,null,y(l(w),e=>(a(),d("li",{key:e.uid,class:"mb-2"},[i("div",W,[Z,i("div",v,[i("span",null,c(n(e?.userUid))+" "+c(N(e?.action))+" "+c(e?.targetType),1),L(" on "),i("span",null,c(l(m)(e?.stateAfter?.updated_at)),1)])]),i("div",B,[(a(!0),d(b,null,y(F(e),t=>(a(),d("div",{key:t.key,class:"grid grid-cols-4"},[i("span",k,[i("span",A,c(t?.key),1)]),i("span",tt,[i("span",et,c(t?.old),1),L(" â†’ "),i("span",st,c(t?.new),1)])]))),128))])]))),128))])),[[f]])])}}}),at=I(it,[["__file","/home/aurthurm/Documents/Development/felicity/felicity-lims/webapp/components/audit/FelAuditLog.vue"]]);export{at as default};
