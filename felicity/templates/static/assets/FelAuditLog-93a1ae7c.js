import{f as D,d as E,S as J,t as T,ai as V,i as j,r as k,ak as C,o as p,c as g,N as t,a5 as x,a as q,C as z,F as S,E as N,M as v,H as _,_ as B}from"./index-9a11e11f.js";import{u as R}from"./user-373e7a59.js";import{d as G}from"./_queries-4ad3f050.js";import{p as L}from"./index-7eeb4507.js";const{withClientQuery:H}=D(),K=E("auditlog",{state:()=>({auditLogs:[],fetchingAudits:!1,error:null}),getters:{getAuditLogs:d=>d.auditLogs,isLoading:d=>d.fetchingAudits,hasError:d=>d.error!==null},actions:{async fetchAuditLogs(d){this.fetchingAudits=!0,this.error=null;try{const c=await H(G,d,"auditLogsFilter");c&&Array.isArray(c)?this.auditLogs=c.map(y=>{const l={...y};if(typeof l.stateAfter=="string")try{l.stateAfter=JSON.parse(l.stateAfter)}catch(m){console.error("Failed to parse stateAfter JSON:",m)}if(typeof l.stateBefore=="string")try{l.stateBefore=JSON.parse(l.stateBefore)}catch(m){console.error("Failed to parse stateBefore JSON:",m)}return l}):this.auditLogs=[]}catch(c){this.error=c instanceof Error?c.message:"Unknown error occurred",console.error("Error fetching audit logs:",c)}finally{this.fetchingAudits=!1}},resetLogs(){this.auditLogs=[],this.error=null}}}),M={class:"relative mt-4",role:"log","aria-label":"Audit log"},Q={key:0,class:"py-4 text-center"},I={key:1,initial:{opacity:0,y:100},enter:{opacity:1,y:0,scale:1},variants:{custom:{scale:2}},delay:200,class:"list-none m-0 p-0 space-y-4"},P={class:"flex items-center mb-2"},W={class:"ml-4 font-medium"},X={class:"text-foreground"},Y={class:"text-primary"},Z={class:"text-muted-foreground"},$={class:"ml-12 space-y-2"},ee={class:"col-span-1"},te={class:"text-sm text-muted-foreground"},se={class:"col-span-3 flex items-center gap-2"},re={class:"text-xs text-destructive line-through"},oe={class:"text-xs text-primary"},ie=J({__name:"FelAuditLog",props:{targetUid:{type:String,required:!1,default:void 0},targetType:{type:String,required:!1,default:void 0}},setup(d){const c=d,{targetType:y,targetUid:l}=T(c),m=R(),b=K();b.resetLogs();const{auditLogs:A,fetchingAudits:U}=V(b);m.fetchUsers({}),b.fetchAuditLogs({targetType:y?.value,targetUid:l?.value});const w=j(()=>m.getUsers);function o(u){const s=w.value?.find(h=>(h.uid||h.userUid)?.toString()===u?.toString());return s?.userName||s?.firstName||s?.lastName||""}function F(u){switch(u){case 1:return"created";case 2:return"updated";case 3:return"deleted";default:return""}}function O(u){const s=new Set;return Object.entries(u?.stateBefore||{}).forEach(([h,i])=>{Object.entries(u?.stateAfter||{}).forEach(([e,r])=>{if(h===e&&i!==r){let f=e,a=i,n=r;e==="updated_by_uid"?(f="updated_by",a=o(i),n=o(r)):e==="submitted_by_uid"?(f="submitted_by",a=o(i),n=o(r)):e==="verified_by_uid"?(f="verified_by",a=o(i),n=o(r)):e==="updated_at"?(f="updated_on",a=L(i),n=L(r)):e==="cancelled_by_uid"?(f="cancelled_by",a=o(i),n=o(r)):e==="received_by_uid"&&(f="received_by",a=o(i),n=o(r)),s.add({key:f,old:a!=null&&typeof a=="object"?JSON.stringify(a):String(a||"None"),new:n!=null&&typeof n=="object"?JSON.stringify(n):String(n||"None")})}})}),Array.from(s)}return(u,s)=>{const h=k("fel-loader"),i=C("motion");return p(),g("div",M,[s[2]||(s[2]=t("div",{class:"border-r-2 border-border border-dotted absolute h-full top-0 z-0",style:{left:"7px"},"aria-hidden":"true"},null,-1)),x(U)?(p(),g("div",Q,[q(h,{message:"Fetching audit logs ..."})])):z((p(),g("ul",I,[(p(!0),g(S,null,N(x(A),e=>(p(),g("li",{key:e.uid,class:"relative"},[t("div",P,[s[0]||(s[0]=t("div",{class:"bg-accent rounded-full h-4 w-4 border-border border-2 z-10","aria-hidden":"true"},null,-1)),t("div",W,[t("span",X,[v(_(o(e?.userUid))+" ",1),t("span",Y,_(F(e?.action)),1),v(" "+_(e?.targetType),1)]),t("span",Z," on "+_(x(L)(e?.stateAfter?.updated_at)),1)])]),t("div",$,[(p(!0),g(S,null,N(O(e),r=>(p(),g("div",{key:r.key,class:"grid grid-cols-4 gap-2 items-center"},[t("span",ee,[t("span",te,_(r?.key),1)]),t("span",se,[t("span",re,_(r?.old),1),s[1]||(s[1]=t("span",{class:"text-xs text-muted-foreground","aria-hidden":"true"},"â†’",-1)),t("span",oe,_(r?.new),1)])]))),128))])]))),128))])),[[i]])])}}}),le=B(ie,[["__file","/home/aurthurm/Documents/Development/felicity/felicity-lims/webapp/components/audit/FelAuditLog.vue"]]);export{le as default};
