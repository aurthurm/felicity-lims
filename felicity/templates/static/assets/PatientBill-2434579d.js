import{S as Z,bj as Ce,M as se,d as Te,bk as Be,W as Ae,s as ee,r as _,x as Ie,ay as te,z as Y,o as i,c as r,b as e,e as u,f as o,g as B,F as A,E as U,I as b,t as d,aG as Se,P as q,w as y,C as D,B as m,A as W,i as H,as as Ve,v as E,D as z,j as F,_ as R,ap as Pe,G as Ne,H as Le,k as Ue}from"./index-53659ec0.js";import{A as De,C as Ee,a as Fe}from"./billing.mutations-192c755c.js";import{c as Re,a as G,d as Me,u as Oe,b as K}from"./array-acbc0ce2.js";function je(){const{withClientQuery:p}=se();return{downloadInvoice:async x=>{try{await Z.fire({title:"Are you sure?",text:"You want to download this invoice",icon:"warning",showCancelButton:!0,confirmButtonColor:"#3085d6",cancelButtonColor:"#d33",confirmButtonText:"Yes, download now!",cancelButtonText:"No, do not download!"}).then(async h=>{h.isConfirmed&&(p(Ce,{billUid:x},"billInvoiceCreate","network-only").then(I=>{const v=document.createElement("a");v.href=`data:application/pdf;base64,${I}`,v.setAttribute("download","invoice-report.pdf"),v.click()}),await Z.fire("Its Happening!","Downloading .....","success").then(I=>{}))})}catch{}}}}const a=p=>(Ne("data-v-afb0e1b5"),p=p(),Le(),p),$e={class:"mt-4"},Ye=a(()=>e("h4",{class:"text-sm text-gray-800 font-bold"},"Patient's Order Bills",-1)),qe=a(()=>e("hr",null,null,-1)),We={class:"grid grid-cols-12 gap-4 mt-2"},He={initial:{opacity:0,y:100},enter:{opacity:1,y:0,scale:1},variants:{custom:{scale:2}},delay:400,class:"col-span-3 overflow-y-scroll overscroll-contain billing-scroll"},ze={key:0,class:"py-4 text-center bg-white w-full mb-1 rounded-sm shadow border"},Ge={key:1},Ke=["onClick"],Qe={class:"flex-grow p-1"},Je={class:"font-semibold text-gray-800"},Xe={class:"text-sm text-gray-400"},Ze={initial:{opacity:0,y:-100},enter:{opacity:1,y:0,scale:1},variants:{custom:{scale:2}},delay:400,class:"col-span-9"},et={class:"bg-white rounded-sm shadow-sm hover:shadow-xs duration-500 px-4 sm:px-6 md:px-2 py-4"},tt={class:"flex justify-between items-center"},st={class:"text-gray-800 text-l font-bold"},ot=a(()=>e("hr",null,null,-1)),at={class:"grid grid-cols-3 gap-x-8"},nt={class:"col-span-1"},lt={class:"flex justify-between items-center mt-2"},it=a(()=>e("span",{class:"text-gray-800 text-sm font-semibold"},"Active:",-1)),dt={class:"text-gray-600 text-sm md:text-md"},ct={class:"flex justify-between items-center mt-2"},rt=a(()=>e("span",{class:"text-gray-800 text-sm font-semibold"},"Confirmed:",-1)),ut={class:"text-gray-600 text-sm md:text-md"},mt={class:"col-span-1"},_t={class:"flex justify-between items-center mt-2"},pt=a(()=>e("span",{class:"text-gray-800 text-sm font-semibold"},"Total Charged:",-1)),ht={class:"text-gray-600 text-sm md:text-md"},vt={class:"flex justify-between items-center mt-2"},ft=a(()=>e("span",{class:"text-gray-800 text-sm font-semibold"},"Total Paid:",-1)),bt={class:"text-gray-600 text-sm md:text-md"},yt={class:"col-span-1"},xt={class:"flex justify-between items-center mt-2"},gt=a(()=>e("span",{class:"text-gray-800 text-sm font-semibold"},"Partial:",-1)),wt={class:"text-gray-600 text-sm md:text-md"},kt={class:"mt-4"},Ct={class:"flex justify-between items-center"},Tt=a(()=>e("h4",{class:"text-gray-800 text-l font-semibold"},"Order Items",-1)),Bt=a(()=>e("hr",null,null,-1)),At={class:"mt-4 bg-white rounded-sm shadow-sm hover:shadow-xs duration-500 px-4 sm:px-6 md:px-2 py-4"},It={class:"text-gray-400"},St={class:"ml-2 text-md leading-5 text-sky-600"},Vt={class:"mt-4"},Pt={class:"flex justify-between items-center"},Nt=a(()=>e("h4",{class:"text-gray-800 text-l font-semibold"},"Transactions",-1)),Lt=a(()=>e("hr",null,null,-1)),Ut={class:"mt-4 bg-white rounded-sm shadow-sm hover:shadow-xs duration-500 px-4 sm:px-6 md:px-2 py-4"},Dt=a(()=>e("h3",null,"Transaction Form",-1)),Et={class:"grid grid-cols-2 gap-x-4 mb-4"},Ft={class:"whitespace-nowrap mb-2 w-full"},Rt=a(()=>e("span",{class:"text-gray-700 w-4/12"},"Kind of payment",-1)),Mt={class:"w-full"},Ot=["disabled"],jt=a(()=>e("option",null,null,-1)),$t=["value"],Yt={class:"text-orange-600 w-4/12"},qt={class:"block col-span-1 mb-2"},Wt=a(()=>e("span",{class:"text-gray-700"},"Amount",-1)),Ht=["disabled"],zt={class:"grid grid-cols-4 gap-x-4 mb-4"},Gt={class:"block col-span-4 mb-2"},Kt=a(()=>e("span",{class:"text-gray-700"},"Notes",-1)),Qt=["disabled"],Jt=a(()=>e("hr",{class:"mb-4"},null,-1)),Xt=a(()=>e("h3",null,"Confirm Tranaction",-1)),Zt={class:"grid grid-cols-4 gap-x-4 mb-4"},es={class:"block col-span-4 mb-2"},ts=a(()=>e("span",{class:"text-gray-700"},"Notes",-1)),ss=["disabled"],os=a(()=>e("hr",{class:"mb-4"},null,-1)),as=a(()=>e("h3",null,"Apply Voucher Code Form",-1)),ns={class:"grid grid-cols-2 gap-x-4 mb-4"},ls={class:"block col-span-2 mb-2"},is=a(()=>e("span",{class:"text-gray-700"},"Voucher Code:",-1)),ds=["disabled"],cs=a(()=>e("hr",{class:"mb-4"},null,-1)),rs=Te({__name:"PatientBill",props:{patientUid:String},setup(p){const Q=F(()=>R(()=>import("./FelLoadingMessage-95452cc5.js"),["assets/FelLoadingMessage-95452cc5.js","assets/index-53659ec0.js","assets/index-5e1ff226.css"])),x=F(()=>R(()=>import("./FelModal-48146e4b.js"),["assets/FelModal-48146e4b.js","assets/index-53659ec0.js","assets/index-5e1ff226.css","assets/FelModal-780aeea9.css"])),h=F(()=>R(()=>import("./FelButton-29967816.js"),["assets/FelButton-29967816.js","assets/index-53659ec0.js","assets/index-5e1ff226.css"])),I=F(()=>R(()=>import("./FelDataTable-819875c0.js"),["assets/FelDataTable-819875c0.js","assets/index-53659ec0.js","assets/index-5e1ff226.css"])),v=p,{toastSuccess:J}=Pe(),{withClientMutation:M}=se(),g=Be(),oe=Ae(),{bills:X,fetchingBills:ae,transactions:ne,fetchingTransactions:le}=ee(g),{analysisRequests:ie}=ee(oe);g.fetchBillsForPatient(v?.patientUid);const de=_(["cash","medical-aid","e-payment"]),S=_(!1),l=_({}),ce=n=>{l.value={...n},g.fetchBillTransactions(n.uid)},re=Ie(()=>{const n=l?.value?.orders?.map(t=>t.uid)??[];return ie?.value?.filter(t=>n.includes(t.uid))});function ue(n,t){let f=[];return n.forEach(C=>f.push(C.name)),t.forEach(C=>f.push(C.name)),f.join(", ")}const me=Re({testBillUid:G().required(),kind:G().required(),amount:Me().required(),notes:G()}),{handleSubmit:_e,errors:w,setFieldValue:V}=Oe({validationSchema:me,initialValues:{testBillUid:l.value?.uid}}),{value:P}=K("kind"),{value:O}=K("amount"),{value:j}=K("notes"),c=_(!1),pe=_e(n=>{c.value=!0,ve(n)}),he=()=>{V("testBillUid",l.value?.uid),V("kind","cash"),V("amount",Math.ceil(Number((l?.value?.totalCharged-l?.value?.totalPaid).toFixed(2)))),V("notes",""),S.value=!0},ve=n=>{M(De,{payload:n},"createTestBillTransaction").then(t=>{g.addTransaction(t),c.value=!1,S.value=!1,J("Transaction added.")})},N=_(!1),k=_({}),fe=()=>{c.value=!0,M(Ee,{uid:k.value.uid,notes:k.value.notes},"confirmTestBillTransaction").then(n=>{g.updateTransaction(n),c.value=!1,N.value=!1,J("Transaction confirmed.")})},be=_([{name:"Kind",value:"kind",sortable:!0,sortBy:"asc",defaultSort:!0,showInToggler:!1,hidden:!1},{name:"Amount",value:"amount",sortable:!1,sortBy:"asc",hidden:!1},{name:"Success",value:"isSuccess",sortable:!1,sortBy:"asc",hidden:!1},{name:"Notes",value:"notes",sortable:!1,sortBy:"asc",hidden:!1},{name:"Message",value:"message",sortable:!1,sortBy:"asc",hidden:!1},{name:"Processed",value:"processed",sortable:!1,sortBy:"asc",hidden:!1,customRender:function(n,t){return te("span",{innerHTML:n.processed?"Yes":"Pending confirmation"},[])}},{name:"Action",sortable:!1,hidden:!1,customRender:(n,t)=>{if(!n.processed)return te("button",{onClick(){N.value=!0,k.value=n},type:"button",class:"bg-sky-800 text-white py-1 px-2 rounded-sm leading-none"},"confirm")}}]),$=_(!1),L=_({code:""}),ye=()=>{$.value=!0},xe=()=>{c.value=!0,M(Fe,{payload:{voucherCode:L.value?.code,testBillUid:l.value?.uid,customerUid:v.patientUid}},"applyVoucher").then(n=>c.value=!1)},{downloadInvoice:ge}=je(),we=async n=>await ge(n.uid);return(n,t)=>{const f=Y("motion"),C=Y("motion-slide-top"),ke=Y("motion-slide-right");return i(),r(A,null,[e("div",$e,[Ye,qe,e("div",We,[u((i(),r("section",He,[o(ae)?(i(),r("div",ze,[B(o(Q),{message:"Fetching bills ..."})])):(i(),r("div",Ge,[e("ul",null,[(i(!0),r(A,null,U(o(X),s=>(i(),r("li",{key:s.uid,class:b(["bg-white w-full flex items-center p-1 mb-1 rounded-sm shadow border",{"border-sky-800 bg-emerald-200":s.uid===l.value.uid}]),onClick:T=>ce(s)},[e("div",Qe,[e("div",Je,[e("div",null,d(s.billId?.toLocaleUpperCase()),1),e("div",Xe,d(o(Se)(s.createdAt)),1)])])],10,Ke))),128))])]))])),[[f]]),u((i(),r("section",Ze,[u((i(),r("div",et,[e("div",tt,[e("h4",st,d(l.value.billId?.toLocaleUpperCase()),1)]),ot,e("section",at,[e("div",nt,[e("div",lt,[it,e("span",dt,d(l.value.isActive?"Yes":"No"),1)]),e("div",ct,[rt,e("span",ut,d(l.value?.toConfirm?"No":"Yes"),1)])]),e("div",mt,[e("div",_t,[pt,e("span",ht,d(l.value?.totalCharged),1)]),e("div",vt,[ft,e("span",bt,d(l.value?.totalPaid),1)])]),e("div",yt,[e("div",xt,[gt,e("span",wt,d(l.value?.totalPaid<l.value?.totalCharged?"Yes":"No"),1)])])])])),[[C]]),e("div",kt,[e("div",Ct,[Tt,e("button",{class:"ml-4 px-2 py-1 mr-2 border-sky-800 border text-sky-800 rounded-sm transition duration-300 hover:bg-sky-800 hover:text-white focus:outline-none",onClick:t[0]||(t[0]=y(s=>we(l.value),["prevent"]))}," Invoice ")]),Bt,e("ul",At,[(i(!0),r(A,null,U(re.value,s=>(i(),r("li",{class:"font-semibold",key:s.uid},[e("div",null,d(s?.requestId)+" ("+d(s?.clientRequestId)+")",1),(i(!0),r(A,null,U(s.samples,T=>u((i(),r("div",{class:"ml-4 text-sm",key:T.uid},[e("span",It,d(T.sampleId),1),D(" â‡’ "),e("span",St,d(ue(T.profiles??[],T.analyses??[])),1)])),[[ke]])),128))]))),128))])]),e("div",Vt,[e("div",Pt,[Nt,e("div",null,[u(e("button",{class:"px-2 py-1 mr-2 border-sky-800 border text-sky-800 rounded-sm transition duration-300 hover:bg-sky-800 hover:text-white focus:outline-none",onClick:y(he,["prevent"])}," Add Transaction ",512),[[q,l.value.isActive]]),u(e("button",{class:"ml-4 px-2 py-1 mr-2 border-sky-800 border text-sky-800 rounded-sm transition duration-300 hover:bg-sky-800 hover:text-white focus:outline-none",onClick:y(ye,["prevent"])}," Apply Voucher ",512),[[q,l.value.isActive]])])]),Lt,e("div",Ut,[B(o(I),{columns:be.value,data:o(ne),toggleColumns:!1,loading:o(le),paginable:!1,searchable:!1,filterable:!1,selectable:!1},{footer:m(()=>[]),_:1},8,["columns","data","loading"])])])])),[[q,o(X)?.length>0&&l.value.uid],[f]])])]),S.value?(i(),W(o(x),{key:0,onClose:t[4]||(t[4]=s=>S.value=!1),contentWidth:"w-3/6"},{header:m(()=>[Dt]),body:m(()=>[e("form",null,[e("div",Et,[e("label",Ft,[Rt,e("div",Mt,[u(e("select",{class:b(["form-select mt-1 w-full",{"border-red-500 animate-pulse":o(w).kind}]),"onUpdate:modelValue":t[1]||(t[1]=s=>H(P)?P.value=s:null),disabled:c.value},[jt,(i(!0),r(A,null,U(de.value,s=>(i(),r("option",{key:s,value:s},d(s),9,$t))),128))],10,Ot),[[Ve,o(P)]]),e("div",Yt,d(o(w).gender),1)])]),e("label",qt,[Wt,u(e("input",{class:b(["form-input mt-1 block w-full",{"border-red-500 animate-pulse":o(w).amount}]),type:"number","onUpdate:modelValue":t[2]||(t[2]=s=>H(O)?O.value=s:null),disabled:c.value},null,10,Ht),[[E,o(O)]])])]),e("div",zt,[e("label",Gt,[Kt,u(e("input",{class:b(["form-input mt-1 block w-full",{"border-red-500 animate-pulse":o(w).notes}]),"onUpdate:modelValue":t[3]||(t[3]=s=>H(j)?j.value=s:null),disabled:c.value},null,10,Qt),[[E,o(j)]])])]),Jt,B(o(h),{color:"sky-800",type:"submit",loading:c.value,onClick:y(o(pe),["prevent"])},{default:m(()=>[D(" Save Transaction ")]),_:1},8,["loading","onClick"])])]),_:1})):z("",!0),N.value?(i(),W(o(x),{key:1,onClose:t[6]||(t[6]=s=>N.value=!1),contentWidth:"w-3/6"},{header:m(()=>[Xt]),body:m(()=>[e("form",null,[e("h4",null,d(o(P))+" Transaction ",1),e("div",Zt,[e("label",es,[ts,u(e("input",{class:b(["form-input mt-1 block w-full",{"border-red-500 animate-pulse":o(w).notes}]),"onUpdate:modelValue":t[5]||(t[5]=s=>k.value.notes=s),disabled:c.value},null,10,ss),[[E,k.value.notes]])])]),os,B(o(h),{color:"sky-800",type:"submit",loading:c.value,onClick:y(fe,["prevent"])},{default:m(()=>[D(" Confirm Transaction ")]),_:1},8,["loading"])])]),_:1})):z("",!0),$.value?(i(),W(o(x),{key:2,onClose:t[8]||(t[8]=s=>$.value=!1),contentWidth:"w-1/5"},{header:m(()=>[as]),body:m(()=>[e("form",null,[e("div",ns,[e("label",ls,[is,u(e("input",{class:b(["form-input mt-1 block w-full",{"border-red-500 animate-pulse":!L.value.code}]),type:"text","onUpdate:modelValue":t[7]||(t[7]=s=>L.value.code=s),disabled:c.value},null,10,ds),[[E,L.value.code]])])]),cs,B(o(h),{color:"sky-800",type:"submit",loading:c.value,onClick:y(xe,["prevent"])},{default:m(()=>[D(" Apply Voucher ")]),_:1},8,["loading"])])]),_:1})):z("",!0)],64)}}});const ps=Ue(rs,[["__scopeId","data-v-afb0e1b5"],["__file","/home/aurthurm/Documents/Development/felicity/felicity-lims/webapp/views/patient/_id/PatientBill.vue"]]);export{ps as default};
