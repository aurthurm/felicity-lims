import{S as ie,u as re,V as de,f as ue,i as x,h as N,a0 as H,r as B,o as a,c as i,N as t,K as d,a as U,a5 as o,ad as g,C as c,a2 as v,F as b,E as S,H as r,X as E,A as q,M as F,j as ce,_ as me}from"./index-0c222abb.js";import pe from"./vue-multiselect.esm-9327845c.js";import{u as fe}from"./patient-299b1832.js";import{u as ye}from"./analysis-8752c99a.js";import{u as xe}from"./client-356e4761.js";import{A as ge}from"./analyses.mutations-5f97547d.js";import{c as $,a as j,b as Y,d as ve,u as be,e as p}from"./array-a7430df3.js";import{f as Se}from"./index-821b8b6e.js";/* empty css                                                                 */import"./location-be2b8c5f.js";const Ce={class:"space-y-6"},_e={class:"space-y-4"},ke={class:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4"},he={class:"flex flex-col space-y-2"},Ae={class:"flex flex-col space-y-2"},Ve=["value"],we={class:"text-sm text-destructive"},De={class:"flex flex-col space-y-2"},Re={class:"text-sm text-destructive"},Ue={class:"flex flex-col space-y-2"},qe={class:"text-sm text-destructive"},Pe={class:"flex flex-col space-y-2"},Te={class:"text-sm text-destructive"},Ie={id:"samples",class:"space-y-4"},Me={class:"flex justify-between items-center"},Ne={class:"flex items-center gap-4"},He={class:"text-sm text-destructive"},Be={class:"flex justify-between items-center mb-4"},Ee={class:"text-md font-medium text-foreground"},Fe=["onClick"],$e={class:"grid grid-cols-1 lg:grid-cols-2 xl:grid-cols-3 gap-4"},je={class:"flex flex-col space-y-2"},Ye=["onUpdate:modelValue"],Le=["value"],Ge={class:"flex flex-col space-y-2"},Ke={class:"flex flex-col space-y-2 lg:col-span-1 xl:col-span-1"},Xe=["onUpdate:modelValue"],ze=["value"],Je={class:"flex flex-col space-y-2 lg:col-span-1 xl:col-span-1"},Oe=["onUpdate:modelValue"],Qe=["value"],We={class:"flex flex-col space-y-2 xl:col-span-1"},Ze={class:"p-3 bg-muted/50 rounded-md text-sm space-y-1"},et={class:"text-xs text-muted-foreground"},tt={class:"text-xs text-muted-foreground"},st={key:0,class:"text-xs text-destructive"},lt={key:0,class:"text-center py-8 text-muted-foreground"},ot={class:"flex justify-end pt-4"},nt={key:0,type:"submit",class:"px-6 py-2 bg-primary text-primary-foreground rounded-md hover:bg-primary/90 transition-colors duration-200 focus:outline-none focus:ring-2 focus:ring-primary/50"},at={key:1,class:"py-4 text-center"},it=ie({__name:"SamplesAdd",setup(rt){const _=re(),L=fe(),C=ye(),P=xe(),G=de(),{withClientMutation:K}=ue(),{swalError:T}=ce();let k=x(()=>L.getPatient),X=N({first:void 0,after:"",text:"",sortBy:["name"],contacts:!0});P.fetchClients(X);const z=x(()=>P.getClients),J=H(null),O=n=>{J.value=n};_.fetchSampleTypes();const Q=x(()=>_.getSampleTypes);let W=N({first:void 0,after:"",text:"",sortBy:["name"]});C.fetchAnalysesServices(W);const Z=x(()=>{const n=C.getAnalysesServicesSimple;let e=new Set;return n.forEach((u,M)=>{u.profiles?.length===0&&e.add(u)}),[...e]});C.fetchAnalysesProfiles();const ee=x(()=>C.getAnalysesProfiles),h=H(!1),te=new Date,se=$({clientRequestId:j().required("Client Request ID is Required"),clinicalData:j().nullable(),client:$().required("Client is Required"),clientContactUid:Y().required("Client Contact is Required"),samples:ve().required().min(1,"Add at least 1 sample"),priority:Y()}),{handleSubmit:le,errors:f}=be({validationSchema:se,initialValues:{priority:0,client:k?.value?.client,samples:[]}}),{value:A}=p("clientRequestId"),{value:V}=p("clinicalData"),{value:y}=p("client"),{value:w}=p("clientContactUid"),{value:D}=p("priority"),{value:m}=p("samples"),I=le(n=>{h.value=!0;for(let e of n.samples||[]){if(typeof e?.sampleType!="string"){T("Samples must have sample types");return}if(e?.analyses?.length<=0&&e?.profiles?.length<=0){T("Samples must have either profiles/analyses or both");return}}oe(n)});function oe(n){const e={patientUid:k.value?.uid,clientRequestId:n.clientRequestId,clinicalData:n.clinicalData,clientUid:y?.value?.uid,clientContactUid:n.clientContactUid,samples:n.samples?.map(u=>({...u,dateCollected:Se(u.dateCollected,"YYYY-MM-DD HH:mm")}))};K(ge,{payload:e},"createAnalysisRequest").then(u=>{_.addAnalysisRequest(u),G.push({name:"patient-detail",params:{patientUid:k.value?.uid}})}).finally(()=>{h.value=!1})}function ne(){const n={sampleType:{},dateCollected:"",profiles:[],analyses:[]};m.value.push(n)}function ae(n){m.value.splice(n,1)}return(n,e)=>{const u=B("VueDatePicker"),M=B("fel-loader");return a(),i("div",Ce,[e[29]||(e[29]=t("h5",{class:"text-xl font-semibold text-foreground mb-4"},"Add Analysis Request",-1)),t("form",{action:"post",class:"p-6 bg-background rounded-lg shadow-sm space-y-6",onSubmit:e[6]||(e[6]=q((...s)=>o(I)&&o(I)(...s),["prevent"]))},[t("div",_e,[d(" Client, Contact, and Priority - Same Row "),t("div",ke,[t("label",he,[e[7]||(e[7]=t("span",{class:"text-sm font-medium text-foreground"},"Client",-1)),U(o(pe),{class:"w-full",placeholder:"Select a Client",modelValue:o(y),"onUpdate:modelValue":e[0]||(e[0]=s=>g(y)?y.value=s:null),options:z.value,searchable:!0,label:"name","track-by":"uid",onSelect:O},null,8,["modelValue","options"])]),t("label",Ae,[e[9]||(e[9]=t("span",{class:"text-sm font-medium text-foreground"},"Client Contact",-1)),c(t("select",{name:"clientContacts",id:"clientContacts","onUpdate:modelValue":e[1]||(e[1]=s=>g(w)?w.value=s:null),class:"w-full px-3 py-2 bg-background border border-border rounded-md focus:outline-none focus:ring-2 focus:ring-primary/50","aria-label":"Select client contact"},[e[8]||(e[8]=t("option",{value:""},null,-1)),(a(!0),i(b,null,S(o(y)?.contacts,s=>(a(),i("option",{key:s.uid,value:s.uid},r(s.firstName)+" "+r(s.lastName),9,Ve))),128))],512),[[v,o(w)]]),t("div",we,r(o(f).clientContactUid),1)]),t("label",De,[e[11]||(e[11]=t("span",{class:"text-sm font-medium text-foreground"},"Priority",-1)),c(t("select",{name:"priority",id:"priority","onUpdate:modelValue":e[2]||(e[2]=s=>g(D)?D.value=s:null),class:"w-full px-3 py-2 bg-background border border-border rounded-md focus:outline-none focus:ring-2 focus:ring-primary/50","aria-label":"Select priority level"},e[10]||(e[10]=[t("option",{value:"0"},"Low",-1),t("option",{value:"1"},"Medium",-1),t("option",{value:"2"},"High",-1)]),512),[[v,o(D)]]),t("div",Re,r(o(f).priority),1)])]),t("label",Ue,[e[12]||(e[12]=t("span",{class:"text-sm font-medium text-foreground"},"Client Request ID",-1)),c(t("input",{class:"w-full px-3 py-2 bg-background border border-border rounded-md focus:outline-none focus:ring-2 focus:ring-primary/50","onUpdate:modelValue":e[3]||(e[3]=s=>g(A)?A.value=s:null),placeholder:"CRID ..."},null,512),[[E,o(A)]]),t("div",qe,r(o(f).clientRequestId),1)]),t("label",Pe,[e[13]||(e[13]=t("span",{class:"text-sm font-medium text-foreground"},"Clinical Data",-1)),c(t("textarea",{class:"w-full px-3 py-2 bg-background border border-border rounded-md focus:outline-none focus:ring-2 focus:ring-primary/50","onUpdate:modelValue":e[4]||(e[4]=s=>g(V)?V.value=s:null),placeholder:"Clinical Data ..."},null,512),[[E,o(V)]]),t("div",Te,r(o(f).clinicalData),1)])]),t("section",Ie,[t("div",Me,[e[14]||(e[14]=t("h5",{class:"text-lg font-semibold text-foreground"},"Samples",-1)),t("div",Ne,[t("span",He,r(o(f).samples),1),o(m)?.length!==20?(a(),i("button",{key:0,onClick:e[5]||(e[5]=q(s=>ne(),["prevent"])),class:"px-4 py-2 bg-primary text-primary-foreground rounded-md hover:bg-primary/90 transition-colors duration-200 focus:outline-none focus:ring-2 focus:ring-primary/50"}," Add Sample ")):d("v-if",!0)])]),(a(!0),i(b,null,S(o(m),(s,R)=>(a(),i("div",{key:R,class:"p-4 border border-border rounded-lg bg-background/50"},[d(" Sample Header "),t("div",Be,[t("h6",Ee,"Sample "+r(R+1),1),t("button",{onClick:q(l=>ae(R),["prevent"]),class:"px-3 py-1 bg-destructive text-destructive-foreground rounded-md hover:bg-destructive/90 transition-colors duration-200 focus:outline-none focus:ring-2 focus:ring-destructive/50 text-sm"}," Remove ",8,Fe)]),d(" Sample Content Grid "),t("div",$e,[d(" Row 1: Sample Type and Date "),t("label",je,[e[16]||(e[16]=t("span",{class:"text-sm font-medium text-foreground"},"Sample Type",-1)),c(t("select",{name:"sampleTypes",id:"sampleTypes","onUpdate:modelValue":l=>s.sampleType=l,class:"w-full px-3 py-2 bg-background border border-border rounded-md focus:outline-none focus:ring-2 focus:ring-primary/50","aria-label":"Select sample type"},[e[15]||(e[15]=t("option",{value:""},null,-1)),(a(!0),i(b,null,S(Q.value,l=>(a(),i("option",{key:l.uid,value:l.uid},r(l.name),9,Le))),128))],8,Ye),[[v,s.sampleType]])]),t("label",Ge,[e[17]||(e[17]=t("span",{class:"text-sm font-medium text-foreground"},"Date Collected",-1)),U(u,{class:"w-full",modelValue:s.dateCollected,"onUpdate:modelValue":l=>s.dateCollected=l,"max-date":o(te),"time-picker-inline":""},null,8,["modelValue","onUpdate:modelValue","max-date"])]),d(" Spacer for grid alignment "),e[27]||(e[27]=t("div",{class:"hidden xl:block"},null,-1)),d(" Row 2: Analysis Profiles and Services "),t("label",Ke,[e[19]||(e[19]=t("span",{class:"text-sm font-medium text-foreground"},"Analysis Profiles",-1)),c(t("select",{name:"analysisProfiles",id:"analysisProfiles","onUpdate:modelValue":l=>s.profiles=l,class:"w-full px-3 py-2 bg-background border border-border rounded-md focus:outline-none focus:ring-2 focus:ring-primary/50 min-h-[100px]",multiple:"","aria-label":"Select analysis profiles"},[e[18]||(e[18]=t("option",{value:""},null,-1)),(a(!0),i(b,null,S(ee.value,l=>(a(),i("option",{key:l.uid,value:l.uid},r(l.name),9,ze))),128))],8,Xe),[[v,s.profiles]]),e[20]||(e[20]=t("small",{class:"text-xs text-muted-foreground"},"Hold Ctrl/Cmd to select multiple",-1))]),t("label",Je,[e[22]||(e[22]=t("span",{class:"text-sm font-medium text-foreground"},"Analysis Services",-1)),c(t("select",{name:"analysesServices",id:"analysesServices","onUpdate:modelValue":l=>s.analyses=l,class:"w-full px-3 py-2 bg-background border border-border rounded-md focus:outline-none focus:ring-2 focus:ring-primary/50 min-h-[100px]",multiple:"","aria-label":"Select analysis services"},[e[21]||(e[21]=t("option",{value:""},null,-1)),(a(!0),i(b,null,S(Z.value,l=>(a(),i("option",{key:l.uid,value:l.uid},r(l.name),9,Qe))),128))],8,Oe),[[v,s.analyses]]),e[23]||(e[23]=t("small",{class:"text-xs text-muted-foreground"},"Hold Ctrl/Cmd to select multiple",-1))]),d(" Selected Items Summary (optional) "),t("div",We,[e[26]||(e[26]=t("span",{class:"text-sm font-medium text-foreground"},"Selection Summary",-1)),t("div",Ze,[t("div",et,[e[24]||(e[24]=t("strong",null,"Profiles:",-1)),F(" "+r(s.profiles?.length||0)+" selected ",1)]),t("div",tt,[e[25]||(e[25]=t("strong",null,"Services:",-1)),F(" "+r(s.analyses?.length||0)+" selected ",1)]),s.profiles?.length===0&&s.analyses?.length===0?(a(),i("div",st," ⚠️ Select profiles or services ")):d("v-if",!0)])])])]))),128)),d(" Empty state when no samples "),!o(m)||o(m).length===0?(a(),i("div",lt,e[28]||(e[28]=[t("p",{class:"text-sm"},'No samples added yet. Click "Add Sample" to get started.',-1)]))):d("v-if",!0)]),t("div",ot,[h.value?(a(),i("div",at,[U(M,{message:"Adding Samples ..."})])):(a(),i("button",nt," Save Sample(s) "))])],32)])}}}),bt=me(it,[["__file","/home/aurthurm/Documents/Development/felicity/felicity-lims/webapp/views/sample/SamplesAdd.vue"]]);export{bt as default};
