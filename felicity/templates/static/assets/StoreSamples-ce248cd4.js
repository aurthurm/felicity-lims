import{P as F,aa as T,R as P,h as x,o as l,c as i,b as s,F as _,D as h,x as R,a2 as o,E as r,J as f,z as B,A as w,a4 as L,C as q,a as $,am as J,X as O,an as W,Y as z,_ as X}from"./index-e1b11e1a.js";import{u as Y}from"./samples-638c9b20.js";import{u as j,a as G}from"./storage-1e37cd2c.js";import{c as H,e as K,u as Q,b as Z}from"./array-81ccc855.js";import"./analyses.mutations-53bc24e5.js";import"./storage.mutations-05515c2a.js";const M={class:"grid grid-cols-12 gap-4 min-h-full bg-white"},ee={className:"col-span-2 pt-4 pl-4 bg-sky-200"},se={className:"col-span-7 pt-4"},te={class:"mb-2"},oe={key:0},ae={class:"grid grid-cols-2 mt-2"},le={class:"col-span-1"},ne={class:"flex"},ie={class:"text-gray-600 text-md"},re={class:"flex"},de={class:"text-gray-600 text-md"},me={key:0,class:"ml-2 text-gray-600 text-md italic bg-slate-400 px-1 rounded-sm"},pe={class:"col-span-1"},ce={class:"flex"},ue={class:"text-gray-600 text-md"},ge={class:"flex mt-2"},ve={class:"text-gray-600 text-md mr-2"},_e={key:1},fe={class:"col-span-1"},Se={class:"col-span-1"},he={class:"col-span-10"},ye=["onUpdate:modelValue"],be=["value"],xe=["onClick"],we={key:0,type:"submit",class:"px-2 py-1 mt-4 border-orange-600 border text-orange-600 rounded-sm transition duration-300 hover:bg-orange-600 hover:text-white focus:outline-none"},Ce=F({__name:"StoreSamples",setup(Ue){const C=O(()=>z(()=>import("./FelTreeItem-b4a60fbd.js"),["assets/FelTreeItem-b4a60fbd.js","assets/index-e1b11e1a.js","assets/index-78b87750.css","assets/storage-1e37cd2c.js"])),{treeData:U,tags:S,activeTree:v,resetActiveTree:k}=j();k();const u=G(),{storeSamples:D}=Y();let g=JSON.parse(window.history.state.samples),p=[];const I=a=>{p=[],m.value.forEach(e=>{e.sampleUid&&p.push(e.sampleUid?.toString())})};T(()=>u.fetchStorageTree()),P(()=>v.value,(a,e)=>{a.tag==="storage-container"&&(u.fetchStorageContainer(a.uid),m.value=[])},{deep:!0});const n=x(()=>u.getStorageContainer),N=x(()=>{const a=u.getStorageContainer;return(a?.slots??0)-(a?.storedCount??0)}),y=()=>{g=[...g,...n.value?.samples??[]],m.value=[],W(n.value?.cols??1,n.value?.rows??1,!n.value?.grid,n.value?.rowWise??!1).map(e=>({...e,storageContainerUid:n.value?.uid})).forEach(e=>{const t=g.filter(c=>c.storageSlotIndex===e.storageSlotIndex&&c.storageContainerUid===e.storageContainerUid);t.length>0&&(e={...e,sampleUid:t[0].uid},p.push(e.sampleUid.toString())),m.value.push({sampleUid:void 0,...e})})},A=H({samples:K().required().min(1,"Select At least one sample")}),{handleSubmit:E,errors:ke}=Q({validationSchema:A,initialValues:{priority:0,samples:n.value?.samples??[]}}),{value:m}=Z("samples"),V=a=>{m.value=m.value.map(e=>(e.sampleUid===a&&(e={...e,sampleUid:void 0}),e)),p=p.filter(e=>+e!==a)},b=E(async a=>{const e=a.samples.filter(t=>t.sampleUid);await D(e).then(async t=>{await u.fetchStorageContainer(e[0].storageContainerUid),y()})});return(a,e)=>(l(),i(_,null,[e[11]||(e[11]=s("h4",null,"Store Samples",-1)),s("div",M,[s("div",ee,[s("ul",null,[(l(!0),i(_,null,h(o(U),(t,c)=>(l(),R(o(C),{tree:t,key:c},null,8,["tree"]))),128))])]),s("div",se,[s("div",te,[o(v).tag===o(S).storageContainer?(l(),i("div",oe,[s("div",ae,[s("div",le,[s("div",ne,[e[2]||(e[2]=s("span",{class:"text-gray-600 text-md font-bold w-52"},"Name:",-1)),s("span",ie,r(n.value?.name),1)]),s("div",re,[e[3]||(e[3]=s("span",{class:"text-gray-600 text-md font-bold w-52"},"Layout:",-1)),s("span",de,r(n.value?.grid?"grid":"column"),1),n.value?.grid?(l(),i("span",me,r(n.value?.rowWise?"by-row":"by-column"),1)):f("",!0)])]),s("div",pe,[s("div",ce,[e[4]||(e[4]=s("span",{class:"text-gray-600 text-md font-bold w-52"},"Slots:",-1)),s("span",ue,r(n.value?.slots),1)]),s("div",ge,[e[5]||(e[5]=s("span",{class:"text-gray-600 text-md font-bold w-52"},"Empty Slots:",-1)),s("span",ve,r(N.value),1)])])])])):(l(),i("div",_e,"Please select a storage container"))]),e[9]||(e[9]=s("hr",null,null,-1)),o(v).tag===o(S).storageContainer?(l(),i("button",{key:0,class:"border border-sky-800 bg-sky-800 text-white rounded-sm mt-2 px-4 py-1 transition-colors duration-500 ease select-none hover:bg-sky-800 focus:outline-none focus:shadow-outline",onClick:e[0]||(e[0]=t=>y())}," Reset Slots ")):f("",!0),s("form",{action:"post",class:"p-4 mb-8 bg-white",onSubmit:e[1]||(e[1]=B((...t)=>o(b)&&o(b)(...t),["prevent"]))},[e[7]||(e[7]=s("div",{class:"grid grid-cols-12 mb-4"},[s("div",{class:"col-span-1 font-semibold"},"Position"),s("div",{class:"col-span-1 font-semibold"},"Label"),s("div",{class:"col-span-10 font-semibold"},"Sample")],-1)),(l(!0),i(_,null,h(o(m),(t,c)=>(l(),i("div",{class:"mt-2 grid grid-cols-12",key:c},[e[6]||(e[6]=s("div",{class:"col-span-12 mb-2"},[s("hr")],-1)),s("div",fe,r(t.storageSlotIndex),1),s("div",Se,r(t.storageSlot),1),s("label",he,[w(s("select",{name:"sampleUid",id:"sampleUid","onUpdate:modelValue":d=>t.sampleUid=d,class:"form-input w-64 h-8 p-0",onChange:I},[(l(!0),i(_,null,h(o(g),d=>w((l(),i("option",{key:d.uid,value:d.uid},r(d?.sampleId)+" ❲"+r(d?.analysisRequest?.clientRequestId)+"❳ ",9,be)),[[q,!o(p).includes(d.uid.toString())]])),128))],40,ye),[[L,t.sampleUid]]),t.sampleUid?(l(),i("span",{key:0,class:"ml-2 text-red-500",onClick:d=>V(t.sampleUid)},[$(o(J),{icon:"ban"})],8,xe)):f("",!0)])]))),128)),e[8]||(e[8]=s("hr",{class:"mt-8"},null,-1)),o(v).tag===o(S).storageContainer&&o(g)?.length>0?(l(),i("button",we," Store Samples ")):f("",!0)],32)]),e[10]||(e[10]=s("div",{className:"col-span-3 p-2"},null,-1))])],64))}}),Fe=X(Ce,[["__file","/home/aurthurm/Documents/Development/felicity/felicity-lims/webapp/views/sample/StoreSamples.vue"]]);export{Fe as default};
