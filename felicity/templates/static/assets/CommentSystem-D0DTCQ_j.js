import{Y as w,u as j,a0 as g,_ as D,c as l,o as i,D as F,z as r,al as O,N as R,C as h,M as x,I as _,ah as L,r as P,a as y,F as T,H as B,A as E,K as v}from"./index-OdhKCqIc.js";import{q as H,r as I,s as G}from"./grind.queries-D_H4x9UG.js";import{S as N}from"./Spinner-Bl8RfjFA.js";import{E as z,a as M,b as V,c as Q,d as K}from"./EmptyTitle-aCQRDpx3.js";import{A as W,a as Y,b as J}from"./index-DVOOl0Kv.js";const X=w({__name:"CommentForm",props:{errandUid:{type:String,required:!0},parentDiscussion:{type:Object,required:!1,default:void 0},isReply:{type:Boolean,required:!1,default:!1}},emits:["commentAdded","cancelReply"],setup(f,{expose:n,emit:t}){n();const e=f,s=t,{withClientMutation:d}=j(),o=g("");function a(){o.value.trim()&&d(H,{payload:{comment:o.value,errandUid:e.errandUid,parentUid:e.parentDiscussion?.uid}},"createGrindErrandDiscussion").then(()=>{o.value="",s("commentAdded")})}function c(){s("cancelReply")}const m={props:e,emit:s,withClientMutation:d,comment:o,addDiscussion:a,cancelReply:c};return Object.defineProperty(m,"__isScriptSetup",{enumerable:!1,value:!0}),m}}),Z=["aria-label"],$=["rows","placeholder","aria-label"],ee={class:"flex items-center justify-end mt-2 gap-2"},te=["aria-label"],ne={key:0,class:"flex items-center gap-2"};function ie(f,n,t,e,s,d){return i(),l("div",{class:"mb-4",role:"form","aria-label":t.isReply?"Reply form":"Comment form"},[F(r("textarea",{"onUpdate:modelValue":n[0]||(n[0]=o=>e.comment=o),rows:t.isReply?2:3,class:R(["w-full px-3 py-2 border border-input bg-background rounded-md shadow-sm text-foreground placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:border-primary transition-colors",{"text-sm":t.isReply}]),placeholder:t.isReply?"Write a reply...":"Add a comment...","aria-label":t.isReply?"Reply text":"Comment text"},null,10,$),[[O,e.comment]]),r("div",ee,[t.isReply?(i(),l("button",{key:0,onClick:e.cancelReply,class:"px-2 py-1 border border-input bg-background text-foreground rounded-md hover:bg-accent hover:text-accent-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 transition-colors text-sm","aria-label":"Cancel reply"}," Cancel ")):h("",!0),r("button",{onClick:e.addDiscussion,class:R(["inline-flex items-center justify-center rounded-md text-sm font-medium transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:opacity-50 disabled:pointer-events-none border border-input bg-accent text-accent-foreground hover:bg-primary hover:text-primary-foreground h-9 px-4 py-2",{"text-sm px-2 py-1":t.isReply}]),"aria-label":t.isReply?"Submit reply":"Submit comment"},[t.isReply?h("",!0):(i(),l("div",ne,[...n[1]||(n[1]=[r("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-5 w-5",viewBox:"0 0 20 20",fill:"currentColor","aria-hidden":"true"},[r("path",{"fill-rule":"evenodd",d:"M7.707 3.293a1 1 0 010 1.414L5.414 7H11a7 7 0 017 7v2a1 1 0 11-2 0v-2a5 5 0 00-5-5H5.414l2.293 2.293a1 1 0 11-1.414 1.414l-4-4a1 1 0 010-1.414l4-4a1 1 0 011.414 0z","clip-rule":"evenodd"})],-1)])])),x(" "+_(t.isReply?"Reply":"Comment"),1)],10,te)])],8,Z)}const q=D(X,[["render",ie],["__file","/home/administrator/Documents/Development/beak-insights/felicity/felicity-lims/webapp/components/grind/CommentForm.vue"]]),se=w({__name:"CommentItem",props:{discussion:{type:Object,required:!0},errandUid:{type:String,required:!0}},emits:["reply","edit"],setup(f,{expose:n,emit:t}){n();const e=f,s=t,{withClientQuery:d}=j(),o=g([]),a=g(!1),c=g(!1),m=g(!1);L(()=>{e.discussion.subdiscussions?.length&&p()});function p(){a.value=!0,d(I,{parentUid:e.discussion.uid},"grindErrandDiscussionsByParent").then(u=>{u&&typeof u=="object"&&"grindErrandDiscussionsByParent"in u&&(o.value=u.grindErrandDiscussionsByParent),a.value=!1})}function k(){c.value=!c.value,c.value&&o.value.length===0&&p()}function A(){s("reply",e.discussion)}function S(){s("edit",e.discussion)}function U(){m.value=!1,p()}const C={props:e,emit:s,withClientQuery:d,replies:o,isLoading:a,showReplies:c,showReplyForm:m,fetchReplies:p,toggleReplies:k,handleReply:A,handleEdit:S,handleCommentAdded:U,CommentForm:q,get Spinner(){return N}};return Object.defineProperty(C,"__isScriptSetup",{enumerable:!1,value:!0}),C}}),oe=["aria-label"],re={class:"flex items-start gap-3"},le={class:"shrink-0"},de={class:"w-10 h-10 rounded-full bg-muted flex items-center justify-center text-muted-foreground"},ae={class:"grow"},ce={class:"flex items-center justify-between mb-1"},me={class:"flex items-center gap-2"},ue={class:"font-medium text-foreground"},fe={class:"text-sm text-muted-foreground"},ye={class:"flex items-center gap-2"},pe={class:"text-foreground whitespace-pre-wrap"},ge={key:0,class:"mt-2"},_e=["aria-expanded","aria-label"],ve={key:0,class:"mt-4 ml-8"},be={key:0,class:"flex items-center justify-center py-4"},he={class:"inline-flex items-center gap-2"},Ce={key:0,class:"text-sm text-muted-foreground py-2"},xe={key:1,class:"mt-4 ml-8"};function Ee(f,n,t,e,s,d){const o=P("CommentItem",!0);return i(),l("div",{class:"mb-4 p-4 border border-input bg-background rounded-lg shadow-sm",role:"article","aria-label":`Comment by ${t.discussion.createdBy?.firstName||"User"}`},[r("div",re,[r("div",le,[r("div",de,_(t.discussion.createdBy?.firstName?.[0]||"U"),1)]),r("div",ae,[r("div",ce,[r("div",me,[r("span",ue,_(t.discussion.createdBy?.firstName)+" "+_(t.discussion.createdBy?.lastName),1),r("span",fe,_(t.discussion.createdAt?new Date(t.discussion.createdAt).toLocaleString():""),1)]),r("div",ye,[r("button",{onClick:e.handleReply,class:"text-sm text-muted-foreground hover:text-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 rounded-md px-2 py-1 transition-colors","aria-label":"Reply to comment"}," Reply "),t.discussion.canEdit?(i(),l("button",{key:0,onClick:e.handleEdit,class:"text-sm text-muted-foreground hover:text-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 rounded-md px-2 py-1 transition-colors","aria-label":"Edit comment"}," Edit ")):h("",!0)])]),r("p",pe,_(t.discussion.comment),1),t.discussion.subdiscussions?.length?(i(),l("div",ge,[r("button",{onClick:e.toggleReplies,class:"text-sm text-muted-foreground hover:text-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 rounded-md px-2 py-1 transition-colors","aria-expanded":e.showReplies,"aria-label":`${e.showReplies?"Hide":"Show"} ${t.discussion.subdiscussions.length} ${t.discussion.subdiscussions.length===1?"reply":"replies"}`},_(t.discussion.subdiscussions.length)+" "+_(t.discussion.subdiscussions.length===1?"reply":"replies"),9,_e)])):h("",!0)])]),e.showReplies?(i(),l("div",ve,[e.isLoading?(i(),l("div",be,[r("span",he,[y(e.Spinner,{class:"size-3"}),n[1]||(n[1]=r("span",{class:"text-xs"},"Loading replies...",-1))])])):(i(),l(T,{key:1},[e.replies.length===0?(i(),l("div",Ce," No replies yet ")):(i(!0),l(T,{key:1},B(e.replies,a=>(i(),E(o,{key:a.uid,discussion:a,"errand-uid":t.errandUid,onReply:e.handleReply,onEdit:e.handleEdit},null,8,["discussion","errand-uid"]))),128))],64))])):h("",!0),e.showReplyForm?(i(),l("div",xe,[y(e.CommentForm,{"errand-uid":t.errandUid,"parent-discussion":t.discussion,"is-reply":!0,onCommentAdded:e.handleCommentAdded,onCancelReply:n[0]||(n[0]=a=>e.showReplyForm=!1)},null,8,["errand-uid","parent-discussion"])])):h("",!0)],8,oe)}const Re=D(se,[["render",Ee],["__file","/home/administrator/Documents/Development/beak-insights/felicity/felicity-lims/webapp/components/grind/CommentItem.vue"]]),we=w({__name:"CommentList",props:{comments:{type:Array,required:!0},replyingTo:{type:[Object,null],required:!0,default:null},editingComment:{type:[Object,null],required:!0,default:null},level:{type:Number,required:!0,default:0},errandUid:{type:String,required:!0}},emits:["setReplyingTo","setEditingComment","commentAdded","commentUpdated"],setup(f,{expose:n,emit:t}){n();const e=f,s=t;function d(p){s("setReplyingTo",p)}function o(p){s("setEditingComment",p)}function a(){s("commentAdded")}function c(){s("commentUpdated")}const m={props:e,emit:s,handleSetReplyingTo:d,handleSetEditingComment:o,handleCommentAdded:a,handleCommentUpdated:c,CommentItem:Re};return Object.defineProperty(m,"__isScriptSetup",{enumerable:!1,value:!0}),m}}),De=["aria-label"];function ke(f,n,t,e,s,d){return i(),l("div",{class:R(`space-y-${t.level===0?"6":"4"}`),role:"list","aria-label":`${t.level===0?"Top-level comments":"Nested comments"}`},[(i(!0),l(T,null,B(t.comments,o=>(i(),l("div",{key:o.uid,class:R(t.level===0?"border-b border-border pb-4":""),role:"listitem"},[y(e.CommentItem,{discussion:o,"errand-uid":t.errandUid,onReply:e.handleSetReplyingTo,onEdit:e.handleSetEditingComment,onCommentAdded:e.handleCommentAdded,onCommentUpdated:e.handleCommentUpdated},null,8,["discussion","errand-uid"])],2))),128))],10,De)}const Ae=D(we,[["render",ke],["__file","/home/administrator/Documents/Development/beak-insights/felicity/felicity-lims/webapp/components/grind/CommentList.vue"]]),Se=w({__name:"CommentSystem",props:{errandUid:{type:String,required:!0}},setup(f,{expose:n}){n();const t=f,{withClientQuery:e}=j(),s=g([]),d=g(null),o=g(null),a=g(!1),c=g(null);L(()=>{m()});async function m(u="cache-first"){a.value=!0,c.value=null;try{const b=await e(G,{errandUid:t.errandUid},"grindErrandDiscussions",u);b&&typeof b=="object"&&"grindErrandDiscussions"in b?s.value=b.grindErrandDiscussions:c.value="Failed to load discussions"}catch(b){c.value=b instanceof Error?b.message:"An error occurred while loading discussions"}finally{a.value=!1}}function p(){return s.value.filter(u=>!u.parentUid)}function k(){m("network-only"),d.value=null}function A(){m("network-only"),o.value=null}function S(u){d.value=u}function U(u){o.value=u}const C={props:t,withClientQuery:e,discussions:s,replyingTo:d,editingComment:o,isLoading:a,error:c,getDiscussions:m,getTopLevelComments:p,handleCommentAdded:k,handleCommentUpdated:A,setReplyingTo:S,setEditingComment:U,CommentForm:q,CommentList:Ae,get Empty(){return K},get EmptyContent(){return Q},get EmptyDescription(){return V},get EmptyHeader(){return M},get EmptyTitle(){return z},get Alert(){return J},get AlertDescription(){return Y},get AlertTitle(){return W},get Spinner(){return N}};return Object.defineProperty(C,"__isScriptSetup",{enumerable:!1,value:!0}),C}}),Ue={role:"region","aria-label":"Comments section"},Te={key:0,class:"flex items-center justify-center py-4"},je={class:"inline-flex items-center gap-2"},Le={key:2};function Be(f,n,t,e,s,d){return i(),l("div",Ue,[e.isLoading?(i(),l("div",Te,[r("span",je,[y(e.Spinner,{class:"size-3"}),n[0]||(n[0]=r("span",{class:"text-xs"},"Loading comments...",-1))])])):e.error?(i(),E(e.Alert,{key:1,variant:"destructive"},{default:v(()=>[y(e.AlertTitle,null,{default:v(()=>[...n[1]||(n[1]=[x("Error",-1)])]),_:1}),y(e.AlertDescription,null,{default:v(()=>[x(_(e.error),1)]),_:1})]),_:1})):(i(),l("div",Le,[y(e.CommentForm,{"errand-uid":t.errandUid,onCommentAdded:e.handleCommentAdded},null,8,["errand-uid"]),e.getTopLevelComments().length>0?(i(),E(e.CommentList,{key:0,comments:e.getTopLevelComments(),"replying-to":e.replyingTo,"editing-comment":e.editingComment,"errand-uid":t.errandUid,level:0,onSetReplyingTo:e.setReplyingTo,onSetEditingComment:e.setEditingComment,onCommentAdded:e.handleCommentAdded,onCommentUpdated:e.handleCommentUpdated},null,8,["comments","replying-to","editing-comment","errand-uid"])):(i(),E(e.Empty,{key:1,class:"py-8"},{default:v(()=>[y(e.EmptyContent,null,{default:v(()=>[y(e.EmptyHeader,null,{default:v(()=>[y(e.EmptyTitle,null,{default:v(()=>[...n[2]||(n[2]=[x("No comments yet",-1)])]),_:1}),y(e.EmptyDescription,null,{default:v(()=>[...n[3]||(n[3]=[x("Be the first to comment!",-1)])]),_:1})]),_:1})]),_:1})]),_:1}))]))])}const He=D(Se,[["render",Be],["__file","/home/administrator/Documents/Development/beak-insights/felicity/felicity-lims/webapp/components/grind/CommentSystem.vue"]]);export{He as default};
