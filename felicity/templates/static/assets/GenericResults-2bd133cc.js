import{V as ge,u as ve,h as _e,a1 as G,r as T,al as he,o as r,c as a,O as t,a as c,D as i,Z as K,F as f,H as y,a4 as q,z as p,L as N,J as d,a3 as $,Y as ke,a6 as D,E as k,M as b,N as R,C,$ as z,a0 as H,an as J,i as Re,_ as Ce}from"./index-0a787601.js";import{u as Ue}from"./analysis-5260beee.js";import{p as O}from"./index-b3a36a14.js";import{h as U,o as w,a as E}from"./constants-89009445.js";import"./analyses.mutations-7648569c.js";const we={class:"space-y-6"},Ee={class:"rounded-lg border border-border bg-background shadow-sm"},Ve={key:0,class:"p-6 text-center"},Se={key:1,class:"overflow-x-auto"},Ae={class:"w-full"},De={class:"border-b border-border bg-muted/50"},Ie={class:"px-4 py-3 text-left text-sm font-medium text-muted-foreground"},Te={class:"px-4 py-3 border-b border-border"},Ne={class:"flex items-center space-x-2"},$e=["onUpdate:modelValue","onChange","disabled"],Le={class:"px-4 py-3 border-b border-border"},Pe={class:"flex items-center space-x-2"},Be=["onClick"],Oe={class:"font-medium"},Me={class:"px-4 py-3 border-b border-border"},je={key:0,class:"text-sm text-foreground"},Fe=["onUpdate:modelValue","onChange"],Ge=["value"],Ke={class:"px-4 py-3 border-b border-border"},qe={key:0,class:"text-sm text-foreground"},ze=["onUpdate:modelValue","onChange"],He=["value"],Je={class:"px-4 py-3 border-b border-border"},We={class:"text-sm text-foreground"},Ye={class:"px-4 py-3 border-b border-border"},Ze={class:"text-sm text-foreground space-x-1"},Qe={class:"px-4 py-3 border-b border-border"},Xe={key:0,class:"text-sm text-foreground"},et=["onUpdate:modelValue","onChange"],tt=["value"],st={class:"px-4 py-3 border-b border-border"},ot={key:0,class:"text-sm text-foreground"},nt=["onUpdate:modelValue","onKeyup"],rt=["onUpdate:modelValue","onChange"],at=["value"],lt={class:"px-4 py-3 border-b border-border"},dt={class:"text-sm"},it={class:"px-4 py-3 border-b border-border"},ut={class:"text-sm text-foreground"},ct={class:"px-4 py-3 border-b border-border"},ft={class:"text-sm text-foreground"},mt={class:"px-4 py-3 border-b border-border"},pt={class:"text-sm text-foreground"},bt={class:"px-4 py-3 border-b border-border"},xt={class:"px-4 py-3 border-b border-border"},yt={class:"text-sm"},gt={class:"flex items-center space-x-4 pt-4"},vt={class:"space-y-6"},_t=ge({__name:"GenericResults",props:{sample:Object,analysisResults:Object,fetchingResults:Boolean},setup(u){const W=z(()=>H(()=>import("./AnalysisSneak-0ffeb86d.js"),["assets/AnalysisSneak-0ffeb86d.js","assets/index-0a787601.js","assets/index-8412b2a5.css"])),Y=z(()=>H(()=>import("./ResultDetail-26f64521.js"),["assets/ResultDetail-26f64521.js","assets/index-0a787601.js","assets/index-8412b2a5.css"])),M=ve(),l=_e({can_submit:!1,can_cancel:!1,can_retract:!1,can_approve:!1,can_retest:!1,can_reinstate:!1,allChecked:!1});function L(){let o=[];return u.analysisResults?.forEach(e=>{e.checked&&o.push(e)}),o}function Z(){let o=L(),e=[];return o?.forEach(m=>e.push({uid:m.uid,result:m.result,methodUid:m.methodUid,laboratoryInstrumentUid:m.laboratoryInstrumentUid})),e}function V(){const o=L();let e=[];return o?.forEach(m=>e.push(m.uid)),e}function Q(o){ee()?l.allChecked=!0:l.allChecked=!1,S()}function g(o){F(o)||(o.checked=!0,S())}function j(o){o.checked=!1,S()}async function X(){await u.analysisResults?.forEach(o=>l.allChecked?g(o):j(o)),S()}async function v(){await u.analysisResults?.forEach(o=>j(o)),S()}function ee(){return u.analysisResults?.every(o=>o.checked===!0)||!1}function F(o){switch(o?.status){case"retracted":return!0;case"approved":return!0;case"cancelled":return u.sample?.status!=="received";default:return!1}}function te(o){o.editable=!0}function I(o){return!["received","paired"].includes(u.sample?.status??"")||o.status!=="pending"?!1:o?.editable||J(o?.result)?(te(o),!0):!1}function se(o){switch(o?.status){case"retracted":return"bg-muted";case"aproved":return o?.reportable===!1?"bg-destructive":"";default:return""}}function S(){l.can_cancel=!1,l.can_submit=!1,l.can_retract=!1,l.can_approve=!1,l.can_retest=!1,l.can_reinstate=!1;const o=L();o.length!==0&&(o.every(e=>e.status==="cancelled")&&(l.can_reinstate=!0),o.every(e=>e.status==="pending")&&(l.can_cancel=!0),o.every(e=>["pending"].includes(e.status??"")&&!J(e.result))&&(l.can_submit=!0),o.every(e=>e.status==="resulted")&&(l.can_retract=!0,l.can_approve=!0,l.can_retest=!0))}const _=async()=>{const o=Re(()=>M.getSample);o.value&&M.fetchSampleStatus(o?.uid)},P=G(!1),A=G(void 0),oe=o=>{P.value=!0,A.value=o};let{submitResults:ne,cancelResults:re,reInstateResults:ae,approveResults:le,retractResults:de,retestResults:ie}=Ue();const ue=()=>ne(Z(),"sample",u.sample?.uid).then(()=>_()).finally(()=>v()),ce=()=>re(V()).then(()=>_()).finally(()=>v()),fe=()=>ae(V()).then(()=>_()).finally(()=>v()),me=()=>le(V(),"sample",u.sample?.uid).then(()=>_()).finally(()=>v()),pe=()=>de(V()).then(()=>_()).finally(()=>v()),be=()=>ie(V()).then(()=>_()).finally(()=>v());return(o,e)=>{const m=T("fel-loader"),x=T("font-awesome-icon"),h=T("fel-button"),xe=T("fel-drawer"),ye=he("motion-slide-right");return r(),a(f,null,[t("div",we,[e[29]||(e[29]=t("div",{class:"border-t border-border my-4"},null,-1)),e[30]||(e[30]=t("h3",{class:"text-lg font-semibold text-foreground"},"Analyses/Results",-1)),e[31]||(e[31]=t("div",{class:"border-t border-border my-4"},null,-1)),t("div",Ee,[u.fetchingResults?(r(),a("div",Ve,[c(m,{message:"Fetching analytes ..."})])):(r(),a("div",Se,[t("table",Ae,[t("thead",null,[t("tr",De,[t("th",Ie,[i(t("input",{type:"checkbox",onChange:X,"onUpdate:modelValue":e[0]||(e[0]=s=>l.allChecked=s),class:"rounded border-input text-primary focus:ring-primary"},null,544),[[K,l.allChecked]])]),e[2]||(e[2]=t("th",{class:"px-4 py-3 text-left text-sm font-medium text-muted-foreground"},null,-1)),e[3]||(e[3]=t("th",{class:"px-4 py-3 text-left text-sm font-medium text-muted-foreground"},"Analysis",-1)),e[4]||(e[4]=t("th",{class:"px-4 py-3 text-left text-sm font-medium text-muted-foreground"},"Instrument",-1)),e[5]||(e[5]=t("th",{class:"px-4 py-3 text-left text-sm font-medium text-muted-foreground"},"Method",-1)),e[6]||(e[6]=t("th",{class:"px-4 py-3 text-left text-sm font-medium text-muted-foreground"},"Analyst",-1)),e[7]||(e[7]=t("th",{class:"px-4 py-3 text-left text-sm font-medium text-muted-foreground"},"Reviewer(s)",-1)),e[8]||(e[8]=t("th",{class:"px-4 py-3 text-left text-sm font-medium text-muted-foreground"},"Interim",-1)),e[9]||(e[9]=t("th",{class:"px-4 py-3 text-left text-sm font-medium text-muted-foreground"},"Result",-1)),e[10]||(e[10]=t("th",{class:"px-4 py-3 text-left text-sm font-medium text-muted-foreground"},"Retest",-1)),e[11]||(e[11]=t("th",{class:"px-4 py-3 text-left text-sm font-medium text-muted-foreground"},"Due Date",-1)),e[12]||(e[12]=t("th",{class:"px-4 py-3 text-left text-sm font-medium text-muted-foreground"},"Submitted",-1)),e[13]||(e[13]=t("th",{class:"px-4 py-3 text-left text-sm font-medium text-muted-foreground"},"Approved",-1)),e[14]||(e[14]=t("th",{class:"px-4 py-3 text-left text-sm font-medium text-muted-foreground"},"Status",-1)),e[15]||(e[15]=t("th",{class:"px-4 py-3 text-left text-sm font-medium text-muted-foreground"},"Reportable",-1)),e[16]||(e[16]=t("th",{class:"px-4 py-3"},null,-1))])]),t("tbody",null,[(r(!0),a(f,null,y(u.analysisResults,s=>i((r(),a("tr",{key:s.uid,class:q([se(s),"hover:bg-muted/50 transition-colors duration-200"])},[t("td",Te,[t("div",Ne,[i(t("input",{type:"checkbox","onUpdate:modelValue":n=>s.checked=n,onChange:n=>Q(),disabled:F(s),class:"rounded border-input text-primary focus:ring-primary"},null,40,$e),[[K,s.checked]]),s.status==="pending"?(r(),p(x,{key:0,icon:"fa-question",class:"text-xs text-muted-foreground"})):N("v-if",!0),s.status==="resulted"?(r(),p(x,{key:1,icon:"fa-question",class:"text-xs text-warning"})):N("v-if",!0)])]),e[21]||(e[21]=t("td",{class:"px-4 py-3 border-b border-border"},null,-1)),t("td",Le,[t("div",Pe,[t("button",{type:"button",onClick:n=>oe(s),class:"text-primary hover:text-primary/80 transition-colors"},[c(x,{icon:"fa-info-circle"})],8,Be),t("span",Oe,d(s.analysis?.name),1)])]),t("td",Me,[I(s)?i((r(),a("select",{key:1,"onUpdate:modelValue":n=>s.laboratoryInstrumentUid=n,onChange:n=>g(s),class:"w-full rounded-md border border-input bg-background px-3 py-2 text-sm ring-offset-background focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2"},[e[17]||(e[17]=t("option",{value:""},null,-1)),(r(!0),a(f,null,y(s.analysis?.instruments,n=>(r(),a(f,{key:n.uid},[(r(!0),a(f,null,y(n.laboratoryInstruments,B=>(r(),a("option",{key:B.uid,value:B.uid},d(B.labName)+" â†’ ("+d(n?.name)+") ",9,Ge))),128))],64))),128))],40,Fe)),[[$,s.laboratoryInstrumentUid]]):(r(),a("div",je,d(s.laboratoryInstrument?.labName||"---"),1))]),t("td",Ke,[I(s)?i((r(),a("select",{key:1,"onUpdate:modelValue":n=>s.methodUid=n,onChange:n=>g(s),class:"w-full rounded-md border border-input bg-background px-3 py-2 text-sm ring-offset-background focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2"},[e[18]||(e[18]=t("option",{value:""},null,-1)),(r(!0),a(f,null,y(s.analysis?.methods,n=>(r(),a("option",{key:n.uid,value:n.uid},d(n.name),9,He))),128))],40,ze)),[[$,s.methodUid]]):(r(),a("div",qe,d(s.method?.name||"---"),1))]),t("td",Je,[t("span",We,d(`${s.submittedBy?.firstName??"--"} ${s.submittedBy?.lastName??"--"}`),1)]),t("td",Ye,[t("div",Ze,[(r(!0),a(f,null,y(s.verifiedBy,n=>(r(),a("span",{key:n.firstName},d(`${n?.firstName??"--"} ${n?.lastName??"--"},`),1))),128))])]),t("td",Qe,[!I(s)||s?.analysis?.interims?.length===0?(r(),a("div",Xe," --- ")):i((r(),a("select",{key:1,"onUpdate:modelValue":n=>s.result=n,onChange:n=>g(s),class:"w-full rounded-md border border-input bg-background px-3 py-2 text-sm ring-offset-background focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2"},[e[19]||(e[19]=t("option",{value:""},null,-1)),(r(!0),a(f,null,y(s?.analysis?.interims,n=>(r(),a("option",{key:n.key,value:n.value},d(n.value),9,tt))),128))],40,et)),[[$,s.result]])]),t("td",st,[I(s)?s?.analysis?.resultOptions?.length===0?i((r(),a("input",{key:1,"onUpdate:modelValue":n=>s.result=n,onKeyup:n=>g(s),class:"w-full rounded-md border border-input bg-background px-3 py-2 text-sm ring-offset-background focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2"},null,40,nt)),[[ke,s.result]]):i((r(),a("select",{key:2,"onUpdate:modelValue":n=>s.result=n,onChange:n=>g(s),class:"w-full rounded-md border border-input bg-background px-3 py-2 text-sm ring-offset-background focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2"},[e[20]||(e[20]=t("option",{value:""},null,-1)),(r(!0),a(f,null,y(s?.analysis?.resultOptions,n=>(r(),a("option",{key:n.optionKey,value:n.value},d(n.value),9,at))),128))],40,rt)),[[$,s.result]]):(r(),a("div",ot,d(s?.result),1))]),t("td",lt,[t("div",dt,[s?.retest?(r(),p(x,{key:0,icon:"fa-check-circle",class:"text-success"})):(r(),p(x,{key:1,icon:"fa-times-circle",class:"text-destructive"}))])]),t("td",it,[t("span",ut,d(D(O)(s?.dueDate)),1)]),t("td",ct,[t("span",ft,d(D(O)(s?.dateSubmitted)),1)]),t("td",mt,[t("span",pt,d(D(O)(s?.dateVerified)),1)]),t("td",bt,[t("span",{class:q(["inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium",{"bg-primary/10 text-primary":s.status==="pending","bg-warning/10 text-warning":s.status==="resulted","bg-success/10 text-success":s.status==="approved","bg-destructive/10 text-destructive":s.status==="cancelled"||s.status==="retracted"}])},d(s.status),3)]),t("td",xt,[t("div",yt,[s?.reportable?(r(),p(x,{key:0,icon:"fa-thumbs-up",class:"text-success","aria-label":"Reportable"})):(r(),p(x,{key:1,icon:"fa-thumbs-down",class:"text-destructive","aria-label":"Not reportable"}))])]),e[22]||(e[22]=t("td",{class:"px-4 py-3 border-b border-border"},null,-1))],2)),[[ye]])),128))])])]))]),t("div",gt,[i(c(h,{key:"cancel",onClick:C(ce,["prevent"]),color:"destructive"},{default:b(()=>e[23]||(e[23]=[R(" Cancel ")])),_:1},512),[[k,U(E.UPDATE,w.RESULT)&&l.can_cancel]]),i(c(h,{key:"reinstate",onClick:C(fe,["prevent"]),color:"warning"},{default:b(()=>e[24]||(e[24]=[R(" Re-Instate ")])),_:1},512),[[k,U(E.UPDATE,w.RESULT)&&l.can_reinstate]]),i(c(h,{key:"submit",onClick:C(ue,["prevent"]),color:"primary"},{default:b(()=>e[25]||(e[25]=[R(" Submit ")])),_:1},512),[[k,U(E.UPDATE,w.RESULT)&&l.can_submit]]),i(c(h,{key:"retract",onClick:C(pe,["prevent"]),color:"warning"},{default:b(()=>e[26]||(e[26]=[R(" Retract ")])),_:1},512),[[k,U(E.UPDATE,w.RESULT)&&l.can_retract]]),i(c(h,{key:"verify",onClick:C(me,["prevent"]),color:"success"},{default:b(()=>e[27]||(e[27]=[R(" Verify ")])),_:1},512),[[k,U(E.UPDATE,w.RESULT)&&l.can_approve]]),i(c(h,{key:"retest",onClick:C(be,["prevent"]),color:"warning"},{default:b(()=>e[28]||(e[28]=[R(" Retest ")])),_:1},512),[[k,U(E.UPDATE,w.RESULT)&&l.can_retest]])])]),c(xe,{show:P.value,onClose:e[1]||(e[1]=s=>P.value=!1),"content-width":"w-2/4"},{header:b(()=>e[32]||(e[32]=[t("h3",{class:"text-lg font-semibold text-foreground"},"Result Information",-1)])),body:b(()=>[t("div",vt,[A.value?.analysisUid?(r(),p(D(W),{key:0,analysisUid:A.value?.analysisUid},null,8,["analysisUid"])):N("v-if",!0),A.value?.uid?(r(),p(D(Y),{key:1,analysisResultesultUid:A.value?.uid},null,8,["analysisResultesultUid"])):N("v-if",!0)])]),_:1},8,["show"])],64)}}}),wt=Ce(_t,[["__file","/home/aurthurm/Documents/Development/felicity/felicity-lims/webapp/views/sample/_id/results/GenericResults.vue"]]);export{wt as default};
