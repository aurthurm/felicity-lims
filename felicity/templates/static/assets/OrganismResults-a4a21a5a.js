import{d as Y,I as Z,r as c,p as ee,q as te,n as se,o,c as l,b as e,y as m,F as w,C as E,t as p,e as h,v as I,L as T,g as V,A as _,B as j,w as B,f as O,z as ae,j as N,_ as P,k as ne}from"./index-68ba4247.js";import{h as $,o as L,a as M}from"./constants-f66990fb.js";import{u as oe}from"./analysis-f7346aff.js";import{a9 as ie,aa as le,ab as re,ac as ue,k as de}from"./microbiology.mutations-f934cb5e.js";import"./analyses.mutations-8ad48d10.js";const ce={class:"flex justify-between items-center"},me=e("span",{class:"font-bold"},"Organisms",-1),pe=["disabled"],ve=e("hr",{class:"mt-1"},null,-1),be={class:"overflow-x-auto mt-2"},he={class:"align-middle inline-block min-w-full shadow overflow-hidden bg-white shadow-dashboard px-2 pt-1 rounded-bl-lg rounded-br-lg"},_e={class:"min-w-full"},ge=e("thead",null,[e("tr",null,[e("th",{class:"px-1 py-1 border-b-2 border-gray-300 text-left text-sm leading-4 text-gray-800 tracking-wider"},"Isolate Number"),e("th",{class:"px-1 py-1 border-b-2 border-gray-300 text-left text-sm leading-4 text-gray-800 tracking-wider"},"Organism Name"),e("th",{class:"px-1 py-1 border-b-2 border-gray-300"})])],-1),fe={class:"bg-white"},ye={class:"px-1 py-1 whitespace-no-wrap border-b border-gray-500"},xe={class:"text-sm leading-5 text-gray-800"},ke={class:"px-1 py-1 whitespace-no-wrap border-b border-gray-500"},we={key:0,class:"text-sm leading-5 text-sky-800"},Oe=["onClick"],Ae={class:"px-1 py-1 whitespace-no-wrap text-right border-b border-gray-500 text-sm leading-5"},Ce={key:0},Re=["onClick"],Ue=["onClick"],De={key:1},Se=["onClick"],Ee={class:"mt-4"},Ie={class:"flex justify-start items-center"},Te=e("h4",{class:"font-semibold text-l flex-1 mb-2"},"Culture",-1),Ve={type:"button",class:"bg-sky-800 text-white ml-4 px-2 py-1 rounded-sm leading-none"},je=e("hr",null,null,-1),Be={key:1,class:"py-2 w-full leading italic bg-slate-50 p-2"},Ne={class:"mt-2"},Pe=e("h3",null,"Search Organism",-1),$e={class:""},Le={class:"w-full"},Me={class:"block mb-4"},Fe={class:"border p-2 h-64 overflow-y-auto"},qe={class:"w-full"},ze={class:"px-1 py-1 whitespace-no-wrap border-b border-gray-500"},Ge={class:"text-sm leading-5 text-gray-800"},Qe={class:"px-1 py-1 whitespace-no-wrap text-right border-b border-gray-500 text-sm leading-5"},We=["onClick"],He=Y({__name:"OrganismResults",props:{sample:{type:Object,required:!0},analysisResults:{type:Object,required:!0}},setup(g){const F=N(()=>P(()=>import("./index-68ba4247.js").then(s=>s.bs),["assets/index-68ba4247.js","assets/index-d6482eee.css"])),A=N(()=>P(()=>import("./FelButton-60e4fad2.js"),["assets/FelButton-60e4fad2.js","assets/index-68ba4247.js","assets/index-d6482eee.css"])),{withClientMutation:f,withClientQuery:C}=Z(),i=c([]),v=c(!1),b=c(""),R=c([]),y=c(void 0),u=c(!1),{sample:U,analysisResults:D}=g,n=ee(()=>D[0]);te(()=>{C(ie,{analysisResultUid:n.value.uid},"abxOrganismResultAll").then(s=>{s&&(i.value=s||[])}).finally(()=>x())});function q(){u.value=!0,f(le,{analysisResultUid:n.value.uid},"createAbxOrganismResult").then(s=>{s&&i.value.unshift(s)}).finally(()=>u.value=!1)}function z(s){u.value=!0,f(re,{uid:s.uid,organismUid:s.organism.uid},"saveAbxOrganismResult").then(a=>{if(a){const t=i.value.findIndex(r=>r.uid===s.uid);if(t>-1){const r=a.organism;i.value[t].organismUid=r?.uid,i.value[t].organism=r}}}).finally(()=>{u.value=!1,x()})}function G(s){u.value=!0,f(ue,{uid:s.uid},"removeAbxOrganismResult").then(a=>{if(a){const t=i.value.findIndex(r=>r.uid===a?.uid);t>-1&&i.value.splice(t,1)}}).finally(()=>{u.value=!1,x()})}function S(s){y.value=s,v.value=!0}function Q(s){v.value=!1,i.value[y.value].organism=s,y.value=void 0,D[0].result=i.value?.map(a=>a.organism?.name).join(", ")}function W(){b.value.length<3||C(de,{text:b.value,pageSize:25,sortBy:["name"]},"abxOrganismAll").then(s=>{R.value=s?.items})}const d=se({can_submit:!1,can_approve:!1});function x(){d.can_submit=!1,d.can_approve=!1;const s=i.value?.every(a=>a.organismUid!=null);n.value.status=="pending"&&s&&(d.can_submit=!0),n.value.status=="resulted"&&(d.can_approve=!0)}let{submitResults:H,approveResults:J}=oe();const K=()=>H([{uid:n.value.uid,result:n.value.result,methodUid:"felicity_ast",laboratoryInstrumentUid:"felicity_ast"}],"sample",U?.uid).then(()=>{}),X=()=>J([n.value.uid],"sample",U?.uid).then(()=>{});return(s,a)=>(o(),l(w,null,[e("h3",ce,[me,n.value.status=="pending"?(o(),l("button",{key:0,onClick:a[0]||(a[0]=t=>q()),class:"ml-2 px-2 py-1 border-sky-800 border text-sky-800 rounded-sm transition duration-300 hover:bg-sky-800 hover:text-white focus:outline-none",disabled:u.value}," add organism ",8,pe)):m("v-if",!0)]),ve,e("div",be,[e("div",he,[e("table",_e,[ge,e("tbody",fe,[(o(!0),l(w,null,E(i.value,(t,r)=>(o(),l("tr",{key:t?.uid},[e("td",ye,[e("div",xe,"#"+p(t?.isolateNumber),1)]),e("td",ke,[t?.organism?(o(),l("div",we,p(t?.organism?.name),1)):(o(),l("button",{key:1,class:"px-2 border-sky-800 border text-sky-800 rounded-sm transition duration-300 hover:bg-sky-800 hover:text-white focus:outline-none",onClick:k=>S(r)}," pick organism ",8,Oe))]),e("td",Ae,[t?.organism&&!t?.organismUid?(o(),l("span",Ce,[e("button",{class:"px-2 py-1 border-orange-800 border text-orange-800 rounded-sm transition duration-300 hover:bg-orange-800 hover:text-white focus:outline-none",onClick:k=>S(r)}," change ",8,Re),e("button",{class:"ml-2 px-2 py-1 border-sky-800 border text-sky-800 rounded-sm transition duration-300 hover:bg-sky-800 hover:text-white focus:outline-none",onClick:k=>z(t)}," save ",8,Ue)])):m("v-if",!0),n.value.status=="pending"&&i.value.length>1?(o(),l("span",De,[e("button",{class:"px-2 py-1 border-orange-800 border text-orange-800 rounded-sm transition duration-300 hover:bg-orange-800 hover:text-white focus:outline-none",onClick:k=>G(t)}," delete ",8,Se)])):m("v-if",!0)])]))),128))])])])]),e("div",Ee,[e("div",Ie,[Te,e("button",Ve,p(n.value.status),1)]),je,n.value.status=="pending"?h((o(),l("textarea",{key:0,name:"culture",id:"culture",class:"mt-2 p-2 w-full",rows:"2","onUpdate:modelValue":a[1]||(a[1]=t=>n.value.result=t)},null,512)),[[I,n.value.result]]):(o(),l("p",Be,p(n.value.result),1))]),e("div",Ne,[m(" Submit and Verify Section "),h(V(O(A),{key:"submit",onClick:B(K,["prevent"]),color:"orange-600"},{default:_(()=>[j("Submit culture")]),_:1},512),[[T,$(M.UPDATE,L.RESULT)&&d.can_submit&&g.sample.status!="submitting"]]),h(V(O(A),{key:"approve",onClick:B(X,["prevent"]),color:"orange-600"},{default:_(()=>[j("Approve culture")]),_:1},512),[[T,$(M.UPDATE,L.RESULT)&&d.can_approve&&g.sample.status!="approving"]])]),m(" Panel Form Modal "),v.value?(o(),ae(O(F),{key:0,onClose:a[3]||(a[3]=t=>v.value=!1),contentWidth:"w-1/2"},{header:_(()=>[Pe]),body:_(()=>[e("form",$e,[e("div",Le,[e("label",Me,[h(e("input",{"onUpdate:modelValue":a[2]||(a[2]=t=>b.value=t),onInput:W,class:"form-input mt-1 block w-full",placeholder:"Search organisms..."},null,544),[[I,b.value]])]),e("div",Fe,[e("table",qe,[(o(!0),l(w,null,E(R.value,t=>(o(),l("tr",{key:t.uid},[e("td",ze,[e("div",Ge,p(t.name),1)]),e("td",Qe,[e("button",{onClick:r=>Q(t),class:"px-2 py-1 border-sky-800 border text-sky-800 rounded-sm transition duration-300 hover:bg-sky-800 hover:text-white focus:outline-none"}," pick ",8,We)])]))),128))])])])])]),_:1})):m("v-if",!0)],64))}}),et=ne(He,[["__file","/home/aurthurm/Documents/Development/felicity/felicity-lims/webapp/views/sample/_id/results/OrganismResults.vue"]]);export{et as default};
