import{V as R,f as U,a1 as p,o as t,c as i,D as N,Y as j,O as s,a4 as w,L as u,N as q,J as v,_ as k,a8 as $,r as T,F as h,H as A,z as S,a as E}from"./index-0a787601.js";import{q as F,r as G,s as V}from"./grind.queries-ac8df6fa.js";const I=["aria-label"],M=["rows","placeholder","aria-label"],O={class:"flex items-center justify-end mt-2 gap-2"},H=["aria-label"],P={key:0,class:"flex items-center gap-2"},z=R({__name:"CommentForm",props:{errandUid:{type:String,required:!0},parentDiscussion:{type:Object,required:!1,default:void 0},isReply:{type:Boolean,required:!1,default:!1}},emits:["commentAdded","cancelReply"],setup(g,{emit:y}){const d=g,m=y,{withClientMutation:f}=U(),l=p("");function c(){l.value.trim()&&f(F,{payload:{comment:l.value,errandUid:d.errandUid,parentUid:d.parentDiscussion?.uid}},"createGrindErrandDiscussion").then(()=>{l.value="",m("commentAdded")})}function n(){m("cancelReply")}return(o,a)=>(t(),i("div",{class:"mb-4",role:"form","aria-label":o.isReply?"Reply form":"Comment form"},[N(s("textarea",{"onUpdate:modelValue":a[0]||(a[0]=b=>l.value=b),rows:o.isReply?2:3,class:w(["w-full px-3 py-2 border border-input bg-background rounded-md shadow-sm text-foreground placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:border-primary transition-colors",{"text-sm":o.isReply}]),placeholder:o.isReply?"Write a reply...":"Add a comment...","aria-label":o.isReply?"Reply text":"Comment text"},null,10,M),[[j,l.value]]),s("div",O,[o.isReply?(t(),i("button",{key:0,onClick:n,class:"px-2 py-1 border border-input bg-background text-foreground rounded-md hover:bg-accent hover:text-accent-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 transition-colors text-sm","aria-label":"Cancel reply"}," Cancel ")):u("v-if",!0),s("button",{onClick:c,class:w(["inline-flex items-center justify-center rounded-md text-sm font-medium transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:opacity-50 disabled:pointer-events-none border border-input bg-accent text-accent-foreground hover:bg-primary hover:text-primary-foreground h-9 px-4 py-2",{"text-sm px-2 py-1":o.isReply}]),"aria-label":o.isReply?"Submit reply":"Submit comment"},[o.isReply?u("v-if",!0):(t(),i("div",P,a[1]||(a[1]=[s("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-5 w-5",viewBox:"0 0 20 20",fill:"currentColor","aria-hidden":"true"},[s("path",{"fill-rule":"evenodd",d:"M7.707 3.293a1 1 0 010 1.414L5.414 7H11a7 7 0 017 7v2a1 1 0 11-2 0v-2a5 5 0 00-5-5H5.414l2.293 2.293a1 1 0 11-1.414 1.414l-4-4a1 1 0 010-1.414l4-4a1 1 0 011.414 0z","clip-rule":"evenodd"})],-1)]))),q(" "+v(o.isReply?"Reply":"Comment"),1)],10,H)])],8,I))}}),B=k(z,[["__file","/home/aurthurm/Documents/Development/felicity/felicity-lims/webapp/components/grind/CommentForm.vue"]]),Q=["aria-label"],J={class:"flex items-start gap-3"},W={class:"flex-shrink-0"},Y={class:"w-10 h-10 rounded-full bg-muted flex items-center justify-center text-muted-foreground"},K={class:"flex-grow"},X={class:"flex items-center justify-between mb-1"},Z={class:"flex items-center gap-2"},ee={class:"font-medium text-foreground"},ne={class:"text-sm text-muted-foreground"},se={class:"flex items-center gap-2"},te={class:"text-foreground whitespace-pre-wrap"},ie={key:0,class:"mt-2"},oe=["aria-expanded","aria-label"],re={key:0,class:"mt-4 ml-8"},le={key:0,class:"flex items-center justify-center py-4"},de={key:0,class:"text-sm text-muted-foreground py-2"},ae={key:1,class:"mt-4 ml-8"},ue=R({__name:"CommentItem",props:{discussion:{type:Object,required:!0},errandUid:{type:String,required:!0}},emits:["reply","edit"],setup(g,{emit:y}){const d=g,m=y,{withClientQuery:f}=U(),l=p([]),c=p(!1),n=p(!1),o=p(!1);$(()=>{d.discussion.subdiscussions?.length&&a()});function a(){c.value=!0,f(G,{parentUid:d.discussion.uid},"grindErrandDiscussionsByParent").then(e=>{e&&typeof e=="object"&&"grindErrandDiscussionsByParent"in e&&(l.value=e.grindErrandDiscussionsByParent),c.value=!1})}function b(){n.value=!n.value,n.value&&l.value.length===0&&a()}function C(){m("reply",d.discussion)}function _(){m("edit",d.discussion)}function x(){o.value=!1,a()}return(e,r)=>{const L=T("CommentItem",!0);return t(),i("div",{class:"mb-4 p-4 border border-input bg-background rounded-lg shadow-sm",role:"article","aria-label":`Comment by ${e.discussion.createdBy?.firstName||"User"}`},[s("div",J,[s("div",W,[s("div",Y,v(e.discussion.createdBy?.firstName?.[0]||"U"),1)]),s("div",K,[s("div",X,[s("div",Z,[s("span",ee,v(e.discussion.createdBy?.firstName)+" "+v(e.discussion.createdBy?.lastName),1),s("span",ne,v(e.discussion.createdAt?new Date(e.discussion.createdAt).toLocaleString():""),1)]),s("div",se,[s("button",{onClick:C,class:"text-sm text-muted-foreground hover:text-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 rounded-md px-2 py-1 transition-colors","aria-label":"Reply to comment"}," Reply "),e.discussion.canEdit?(t(),i("button",{key:0,onClick:_,class:"text-sm text-muted-foreground hover:text-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 rounded-md px-2 py-1 transition-colors","aria-label":"Edit comment"}," Edit ")):u("v-if",!0)])]),s("p",te,v(e.discussion.comment),1),e.discussion.subdiscussions?.length?(t(),i("div",ie,[s("button",{onClick:b,class:"text-sm text-muted-foreground hover:text-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 rounded-md px-2 py-1 transition-colors","aria-expanded":n.value,"aria-label":`${n.value?"Hide":"Show"} ${e.discussion.subdiscussions.length} ${e.discussion.subdiscussions.length===1?"reply":"replies"}`},v(e.discussion.subdiscussions.length)+" "+v(e.discussion.subdiscussions.length===1?"reply":"replies"),9,oe)])):u("v-if",!0)])]),n.value?(t(),i("div",re,[c.value?(t(),i("div",le,r[1]||(r[1]=[s("div",{class:"animate-spin rounded-full h-6 w-6 border-2 border-primary border-t-transparent",role:"status","aria-label":"Loading replies"},null,-1)]))):(t(),i(h,{key:1},[l.value.length===0?(t(),i("div",de," No replies yet ")):(t(!0),i(h,{key:1},A(l.value,D=>(t(),S(L,{key:D.uid,discussion:D,"errand-uid":e.errandUid,onReply:C,onEdit:_},null,8,["discussion","errand-uid"]))),128))],64))])):u("v-if",!0),o.value?(t(),i("div",ae,[E(B,{"errand-uid":e.errandUid,"parent-discussion":e.discussion,"is-reply":!0,onCommentAdded:x,onCancelReply:r[0]||(r[0]=D=>o.value=!1)},null,8,["errand-uid","parent-discussion"])])):u("v-if",!0)],8,Q)}}}),ce=k(ue,[["__file","/home/aurthurm/Documents/Development/felicity/felicity-lims/webapp/components/grind/CommentItem.vue"]]),me=["aria-label"],pe=R({__name:"CommentList",props:{comments:{type:Array,required:!0},replyingTo:{type:[Object,null],required:!0,default:null},editingComment:{type:[Object,null],required:!0,default:null},level:{type:Number,required:!0,default:0},errandUid:{type:String,required:!0}},emits:["setReplyingTo","setEditingComment","commentAdded","commentUpdated"],setup(g,{emit:y}){const d=y;function m(n){d("setReplyingTo",n)}function f(n){d("setEditingComment",n)}function l(){d("commentAdded")}function c(){d("commentUpdated")}return(n,o)=>(t(),i("div",{class:w(`space-y-${n.level===0?"6":"4"}`),role:"list","aria-label":`${n.level===0?"Top-level comments":"Nested comments"}`},[(t(!0),i(h,null,A(n.comments,a=>(t(),i("div",{key:a.uid,class:w(n.level===0?"border-b border-border pb-4":""),role:"listitem"},[E(ce,{discussion:a,"errand-uid":n.errandUid,onReply:m,onEdit:f,onCommentAdded:l,onCommentUpdated:c},null,8,["discussion","errand-uid"])],2))),128))],10,me))}}),fe=k(pe,[["__file","/home/aurthurm/Documents/Development/felicity/felicity-lims/webapp/components/grind/CommentList.vue"]]),ve={role:"region","aria-label":"Comments section"},ye={key:0,class:"flex items-center justify-center py-4"},ge={class:"p-4 border border-destructive bg-destructive/10 text-destructive rounded-md",role:"alert"},be=R({__name:"CommentSystem",props:{errandUid:{type:String,required:!0}},setup(g){const y=g,{withClientQuery:d}=U(),m=p([]),f=p(null),l=p(null),c=p(!1),n=p(null);$(()=>{o()});async function o(e="cache-first"){c.value=!0,n.value=null;try{const r=await d(V,{errandUid:y.errandUid},"grindErrandDiscussions",e);r&&typeof r=="object"&&"grindErrandDiscussions"in r?m.value=r.grindErrandDiscussions:n.value="Failed to load discussions"}catch(r){n.value=r instanceof Error?r.message:"An error occurred while loading discussions"}finally{c.value=!1}}function a(){return m.value.filter(e=>!e.parentUid)}function b(){o("network-only"),f.value=null}function C(){o("network-only"),l.value=null}function _(e){f.value=e}function x(e){l.value=e}return(e,r)=>(t(),i("div",ve,[u(" Loading state "),c.value?(t(),i("div",ye,r[0]||(r[0]=[s("div",{class:"animate-spin rounded-full h-6 w-6 border-2 border-primary border-t-transparent",role:"status","aria-label":"Loading comments"},null,-1)]))):n.value?(t(),i(h,{key:1},[u(" Error state "),s("div",ge,v(n.value),1)],2112)):(t(),i(h,{key:2},[u(" Content "),s("div",null,[u(" Main comment input "),E(B,{"errand-uid":e.errandUid,onCommentAdded:b},null,8,["errand-uid"]),u(" Comments and replies "),a().length>0?(t(),S(fe,{key:0,comments:a(),"replying-to":f.value,"editing-comment":l.value,"errand-uid":e.errandUid,level:0,onSetReplyingTo:_,onSetEditingComment:x,onCommentAdded:b,onCommentUpdated:C},null,8,["comments","replying-to","editing-comment","errand-uid"])):(t(),i(h,{key:1},[u(" Empty state "),r[1]||(r[1]=s("div",{class:"text-center py-8 text-muted-foreground"},[s("p",null,"No comments yet. Be the first to comment!")],-1))],2112))])],2112))]))}}),_e=k(be,[["__file","/home/aurthurm/Documents/Development/felicity/felicity-lims/webapp/components/grind/CommentSystem.vue"]]);export{_e as default};
