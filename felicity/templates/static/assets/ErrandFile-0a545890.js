import{P as G,e as P,Z as r,aa as T,h as N,o,c as n,b as s,J as h,E as u,F as K,D as R,a1 as q,a0 as b,L as J,_ as O}from"./index-f86d8273.js";import{l as Q,D as Y,m as Z}from"./grind.queries-12f686e0.js";import{M as C}from"./schema-f3233b53.js";const X={class:"flex justify-between items-start"},I={class:"w-3/4 pr-4"},ee={key:0,class:"py-6 text-center text-gray-500 bg-gray-50 rounded-lg border border-dashed border-gray-300"},te={key:1,class:"mb-3 p-3 bg-red-50 text-red-700 rounded-md"},se={key:2,class:"space-y-2"},le={class:"file-icon mr-3 text-blue-500 flex-shrink-0"},oe={key:0,xmlns:"http://www.w3.org/2000/svg",class:"h-6 w-6",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},ne={key:1,xmlns:"http://www.w3.org/2000/svg",class:"h-6 w-6",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},ae={key:2,xmlns:"http://www.w3.org/2000/svg",class:"h-6 w-6",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},re={key:3,xmlns:"http://www.w3.org/2000/svg",class:"h-6 w-6",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},ie={key:4,xmlns:"http://www.w3.org/2000/svg",class:"h-6 w-6",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},de={class:"flex-grow min-w-0 mr-3"},ue=["title"],ce={class:"text-sm text-gray-500 flex items-center gap-2"},ve={class:"flex gap-2 flex-shrink-0"},pe=["onClick"],he=["onClick","disabled"],ge={key:0,class:"animate-spin h-5 w-5",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24"},fe={key:1,xmlns:"http://www.w3.org/2000/svg",class:"h-5 w-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},we={class:"file-upload-container"},me={class:"file-input-button"},xe={key:1,class:"file-preview"},ke={key:0,class:"image-preview mb-3"},_e=["src"],ye={key:1,class:"file-icon w-16 h-16 mx-auto mb-3 text-blue-500"},be={class:"file-info mb-4 text-center"},Ce={class:"font-medium text-gray-800"},Me={class:"text-sm text-gray-500"},De={class:"flex justify-center gap-3"},Fe=["disabled"],Be={key:0},Ve={key:1},Ue={key:2,class:"mt-3 text-red-500 text-center"},ze={key:2,class:"upload-success"},je=G({__name:"ErrandFile",props:{errandUid:{type:String,required:!0}},setup(M){const x=M,{withClientMutation:k,withClientQuery:D}=P(),g=r(null),f=r(null);T(()=>{F()});const c=r(!1),a=r(null),v=r(null),w=r(!1),d=r(null),p=r(!1),i=r([]),F=()=>{D(Q,{target:C.Errand,targetUid:x.errandUid},"grindMediaByTarget").then(t=>{t&&(i.value=t)})},B=t=>{k(Z,{payload:t},"createGrindMedia").then(e=>{e&&(i.value=[e,...i.value])})},V=t=>{g.value=t,f.value=null,k(Y,{uid:t},"deleteGrindMedia").then(e=>{e&&(i.value=i.value.filter(l=>l.uid!==t))}).catch(e=>{f.value=e?.message||"Failed to delete file"}).finally(()=>{g.value=null})},U=t=>{const e=parseInt(t);return e<1024?`${e} B`:e<1024*1024?`${(e/1024).toFixed(1)} KB`:`${(e/(1024*1024)).toFixed(1)} MB`},m=t=>{const{mimetype:e,filename:l}=t;return e?.startsWith("image/")?"image":e?.includes("pdf")||l.endsWith(".pdf")?"pdf":e?.includes("word")||l.endsWith(".doc")||l.endsWith(".docx")?"doc":e?.includes("sheet")||l.endsWith(".xls")||l.endsWith(".xlsx")?"excel":"file"},z=t=>{window.open(`/${t.path}`,"_blank")},_=t=>{if(d.value=null,a.value=t,t.type.startsWith("image/")){const e=new FileReader;e.onload=l=>{v.value=l.target?.result},e.readAsDataURL(t)}else v.value=null},j=async()=>{if(a.value){w.value=!0,d.value=null;try{const t=await B({file:a.value,target:C.Errand,targetUid:x.errandUid});t?.error?d.value=t.error.message:p.value=!0}catch(t){d.value=t instanceof Error?t.message:"Upload failed"}finally{w.value=!1}}},E=t=>{const e=t.target;e.files&&e.files.length>0&&_(e.files[0])},$=t=>{t.preventDefault(),t.stopPropagation(),c.value=!0},H=t=>{t.preventDefault(),t.stopPropagation(),c.value=!1},L=t=>{t.preventDefault(),t.stopPropagation(),c.value=!0},S=t=>{t.preventDefault(),t.stopPropagation(),c.value=!1,t.dataTransfer&&t.dataTransfer.files.length>0&&_(t.dataTransfer.files[0])},y=()=>{a.value=null,v.value=null,p.value=!1,d.value=null},A=N(()=>{if(!a.value)return"";const t=a.value.size;return t<1024?`${t} B`:t<1024*1024?`${(t/1024).toFixed(1)} KB`:`${(t/(1024*1024)).toFixed(1)} MB`});return(t,e)=>(o(),n("div",X,[s("div",I,[e[9]||(e[9]=s("h3",{class:"text-lg font-medium mb-3"},"Uploaded Files",-1)),i.value.length===0?(o(),n("div",ee," No files uploaded yet ")):h("",!0),f.value?(o(),n("div",te,u(f.value),1)):h("",!0),i.value.length>0?(o(),n("ul",se,[(o(!0),n(K,null,R(i.value,l=>(o(),n("li",{key:l.uid,class:"p-3 border rounded-md flex items-center hover:bg-gray-50 transition-colors"},[s("div",le,[m(l)==="image"?(o(),n("svg",oe,[...e[0]||(e[0]=[s("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M4 16l4.586-4.586a2 2 0 012.828 0L16 16m-2-2l1.586-1.586a2 2 0 012.828 0L20 14m-6-6h.01M6 20h12a2 2 0 002-2V6a2 2 0 00-2-2H6a2 2 0 00-2 2v12a2 2 0 002 2z"},null,-1)])])):m(l)==="pdf"?(o(),n("svg",ne,[...e[1]||(e[1]=[s("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M7 21h10a2 2 0 002-2V9.414a1 1 0 00-.293-.707l-5.414-5.414A1 1 0 0012.586 3H7a2 2 0 00-2 2v14a2 2 0 002 2z"},null,-1)])])):m(l)==="doc"?(o(),n("svg",ae,[...e[2]||(e[2]=[s("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"},null,-1)])])):m(l)==="excel"?(o(),n("svg",re,[...e[3]||(e[3]=[s("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M9 17v-2m3 2v-4m3 4v-6m2 10H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"},null,-1)])])):(o(),n("svg",ie,[...e[4]||(e[4]=[s("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"},null,-1)])]))]),s("div",de,[s("div",{class:"font-medium text-gray-800 truncate",title:l.filename},u(l.filename),9,ue),s("div",ce,[s("span",null,u(U(l.size)),1),e[5]||(e[5]=s("span",{class:"h-1 w-1 rounded-full bg-gray-300"},null,-1)),s("span",null,u(l.mimetype),1)])]),s("div",ve,[s("button",{onClick:W=>z(l),class:"p-2 text-blue-600 hover:bg-blue-50 rounded transition-colors",title:"Download file"},[...e[6]||(e[6]=[s("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-5 w-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[s("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M4 16v1a3 3 0 003 3h10a3 3 0 003-3v-1m-4-4l-4 4m0 0l-4-4m4 4V4"})],-1)])],8,pe),s("button",{onClick:W=>V(l.uid),class:"p-2 text-red-600 hover:bg-red-50 rounded transition-colors",title:"Delete file",disabled:g.value===l.uid},[g.value===l.uid?(o(),n("svg",ge,[...e[7]||(e[7]=[s("circle",{class:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor","stroke-width":"4"},null,-1),s("path",{class:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"},null,-1)])])):(o(),n("svg",fe,[...e[8]||(e[8]=[s("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"},null,-1)])]))],8,he)])]))),128))])):h("",!0)]),s("div",we,[!a.value&&!p.value?(o(),n("div",{key:0,class:q(["upload-area",{dragging:c.value}]),onDragenter:$,onDragleave:H,onDragover:L,onDrop:S},[e[11]||(e[11]=b('<div class="w-16 h-16 mb-2 mx-auto text-gray-400" data-v-334d1478><svg xmlns="http://www.w3.org/2000/svg" class="w-full h-full" fill="none" viewBox="0 0 24 24" stroke="currentColor" data-v-334d1478><path stroke-linecap="round" stroke-linejoin="round" stroke-width="1" d="M5 8h14M5 8a2 2 0 110-4h14a2 2 0 110 4M5 8v10a2 2 0 002 2h10a2 2 0 002-2V8m-9 4h4" data-v-334d1478></path></svg></div><p class="text-center text-gray-500 mb-2" data-v-334d1478>Drag and drop file here</p><p class="text-center text-gray-400 text-sm mb-3" data-v-334d1478>or</p>',3)),s("label",me,[e[10]||(e[10]=J(" Browse Files ")),s("input",{type:"file",class:"hidden",onChange:E},null,32)])],34)):a.value&&!p.value?(o(),n("div",xe,[v.value?(o(),n("div",ke,[s("img",{src:v.value,alt:"File preview",class:"rounded-md max-h-64 max-w-full"},null,8,_e)])):(o(),n("div",ye,e[12]||(e[12]=[s("svg",{xmlns:"http://www.w3.org/2000/svg",class:"w-full h-full",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[s("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"1",d:"M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"})],-1)]))),s("div",be,[s("p",Ce,u(a.value.name),1),s("p",Me,u(A.value),1)]),s("div",De,[s("button",{onClick:y,class:"cancel-button"}," Cancel "),s("button",{onClick:j,class:"upload-button",disabled:w.value},[w.value?(o(),n("span",Be,"Uploading...")):(o(),n("span",Ve,"Upload"))],8,Fe)]),d.value?(o(),n("div",Ue,u(d.value),1)):h("",!0)])):p.value?(o(),n("div",ze,[e[13]||(e[13]=b('<div class="success-icon w-16 h-16 mx-auto mb-3 text-green-500" data-v-334d1478><svg xmlns="http://www.w3.org/2000/svg" class="w-full h-full" fill="none" viewBox="0 0 24 24" stroke="currentColor" data-v-334d1478><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7" data-v-334d1478></path></svg></div><p class="text-center text-gray-800 font-medium mb-2" data-v-334d1478>Upload Successful</p><p class="text-center text-gray-500 text-sm mb-4" data-v-334d1478>Your file has been uploaded successfully</p>',3)),s("button",{onClick:y,class:"upload-new-button"}," Upload Another File ")])):h("",!0)])]))}});const Le=O(je,[["__scopeId","data-v-334d1478"],["__file","/home/aurthurm/Documents/Development/felicity/felicity-lims/webapp/views/grind/_id/ErrandFile.vue"]]);export{Le as default};
