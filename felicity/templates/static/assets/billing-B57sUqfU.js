import{d as c,f as n}from"./index-CNAOKjig.js";import{G as l,S as a,a as h,b as f,c as u,d,e as v,f as y,g,h as P,i as p,j as I}from"./billing.queries-DCoxOTaV.js";const{withClientQuery:o}=n(),B=c("billing",{state:()=>({profilePrice:void 0,profileDiscount:void 0,fetchingPrice:!1,analysisPrice:void 0,analysisDiscount:void 0,fetchingDiscount:!1,vouchers:[],fetchingVouchers:!1,fetchingVoucher:!1,fetchingVoucherCodes:!1,bills:[],fetchingBills:!1,billPageInfo:void 0,transactions:[],fetchingTransactions:!1,profilePrices:new Map,analysisPrices:new Map,fetchingPrices:!1}),getters:{getVouchers:i=>i.vouchers,getProfilePrice:i=>i.profilePrice,getAnalysisPrice:i=>i.analysisPrice,getBills:i=>i.bills},actions:{async clear(){this.analysisPrice=void 0,this.analysisDiscount=void 0,this.profilePrice=void 0,this.profileDiscount=void 0},async fetchProfilePrice(i){if(!i){console.error("Invalid profile UID provided to fetchProfilePrice");return}try{this.fetchingPrice=!0;const e=await o(I,{profileUid:i},"priceForProfile");e?this.profilePrice=e:console.error("Invalid profile price data received:",e)}catch(e){console.error("Error fetching profile price:",e)}finally{this.fetchingPrice=!1}},async fetchProfileDiscount(i){if(!i){console.error("Invalid profile UID provided to fetchProfileDiscount");return}try{this.fetchingDiscount=!0;const e=await o(p,{profileUid:i},"discountForProfile");e?this.profileDiscount=e:console.error("Invalid profile discount data received:",e)}catch(e){console.error("Error fetching profile discount:",e)}finally{this.fetchingDiscount=!1}},async fetchAnalysisPrice(i){if(!i){console.error("Invalid analysis UID provided to fetchAnalysisPrice");return}try{this.fetchingPrice=!0;const e=await o(P,{analysisUid:i},"priceForAnalysis");e?this.analysisPrice=e:console.error("Invalid analysis price data received:",e)}catch(e){console.error("Error fetching analysis price:",e)}finally{this.fetchingPrice=!1}},async fetchAnalysisDiscount(i){if(!i){console.error("Invalid analysis UID provided to fetchAnalysisDiscount");return}try{this.fetchingDiscount=!0;const e=await o(g,{analysisUid:i},"discountForAnalysis");e?this.analysisDiscount=e:console.error("Invalid analysis discount data received:",e)}catch(e){console.error("Error fetching analysis discount:",e)}finally{this.fetchingDiscount=!1}},async fetchVouchers(){try{this.fetchingVouchers=!0;const i=await o(y,{},"voucherAll");i&&Array.isArray(i)?this.vouchers=i:console.error("Invalid vouchers data received:",i)}catch(i){console.error("Error fetching vouchers:",i)}finally{this.fetchingVouchers=!1}},async fetchVoucherByUid(i){if(!i){console.error("Invalid voucher UID provided to fetchVoucherByUid");return}try{this.fetchingVoucher=!0;const e=await o(v,{uid:i},"voucherByUid");if(e&&typeof e=="object"&&"uid"in e){const r=e,s=this.vouchers?.findIndex(t=>t.uid===r.uid);s>-1?this.vouchers[s]=r:this.vouchers=[r,...this.vouchers]}else console.error("Invalid voucher data received:",e)}catch(e){console.error("Error fetching voucher by UID:",e)}finally{this.fetchingVoucher=!1}},async fetchVoucherCodes(i){if(!i){console.error("Invalid voucher UID provided to fetchVoucherCodes");return}try{this.fetchingVoucherCodes=!0;const e=await o(d,{voucherUid:i},"voucherCodes");if(e&&Array.isArray(e)){const r=e,s=this.vouchers?.findIndex(t=>t.uid===i);s>-1&&(this.vouchers[s]={...this.vouchers[s],codes:r})}else console.error("Invalid voucher codes data received:",e)}catch(e){console.error("Error fetching voucher codes:",e)}finally{this.fetchingVoucherCodes=!1}},addVoucher(i){if(!i?.uid){console.error("Invalid voucher payload:",i);return}this.vouchers=[i,...this.vouchers]},updateVoucher(i){if(!i?.uid){console.error("Invalid voucher payload:",i);return}const e=this.vouchers?.findIndex(r=>r.uid===i.uid);e>-1&&(this.vouchers[e]={...this.vouchers[e],...i})},addVoucherCode(i){if(!i?.uid||!i?.voucherUid){console.error("Invalid voucher code payload:",i);return}const e=this.vouchers?.findIndex(r=>r.uid===i.voucherUid);e>-1&&(this.vouchers[e]={...this.vouchers[e],codes:[i,...this.vouchers[e].codes||[]]})},updateVoucherCode(i){if(!i?.uid||!i?.voucherUid){console.error("Invalid voucher code payload:",i);return}const e=this.vouchers?.findIndex(r=>r.uid===i.voucherUid);if(e>-1){const r=this.vouchers[e].codes||[],s=r?.findIndex(t=>t.uid===i.uid);s>-1&&(r[s]={...r[s],...i},this.vouchers[e]={...this.vouchers[e],codes:r})}},async fetchBillsForPatient(i){if(!i){console.error("Invalid patient UID provided to fetchBillsForPatient");return}try{this.fetchingBills=!0;const e=await o(u,{patientUid:i},"billsForPatient");e&&Array.isArray(e)?this.bills=e:console.error("Invalid bills data received:",e)}catch(e){console.error("Error fetching bills for patient:",e)}finally{this.fetchingBills=!1}},async fetchBillsForClient(i){if(!i){console.error("Invalid client UID provided to fetchBillsForClient");return}try{this.fetchingBills=!0;const e=await o(f,{clientUid:i},"billsForClient");e&&Array.isArray(e)?this.bills=e:console.error("Invalid bills data received:",e)}catch(e){console.error("Error fetching bills for client:",e)}finally{this.fetchingBills=!1}},async fetchBillTransactions(i){if(!i){console.error("Invalid bill UID provided to fetchBillTransactions");return}try{this.fetchingTransactions=!0,this.transactions=[];const e=await o(h,{billUid:i},"billTransactions");e&&Array.isArray(e)?this.transactions=e:console.error("Invalid bill transactions data received:",e)}catch(e){console.error("Error fetching bill transactions:",e)}finally{this.fetchingTransactions=!1}},addTransaction(i){if(!i?.uid){console.error("Invalid transaction payload:",i);return}this.transactions=[i,...this.transactions]},updateTransaction(i){if(!i?.uid){console.error("Invalid transaction payload:",i);return}const e=this.transactions?.findIndex(r=>r.uid===i.uid);e>-1&&(this.transactions[e]={...this.transactions[e],...i})},async searchBills(i){try{this.fetchingBills=!0;const e=await o(a,{pageSize:i.pageSize||50,afterCursor:i.afterCursor||void 0,beforeCursor:i.beforeCursor||void 0,text:i.text||void 0,isActive:i.isActive!==null&&i.isActive!==void 0?i.isActive:void 0,partial:i.partial!==null&&i.partial!==void 0?i.partial:void 0,clientUid:i.clientUid||void 0,sortBy:i.sortBy||["-uid"]},"searchBills");if(e&&typeof e=="object"&&"items"in e){const r=e.items??[];this.bills=r,this.billPageInfo={hasNextPage:e.pageInfo?.hasNextPage??!1,hasPreviousPage:e.pageInfo?.hasPreviousPage??!1,endCursor:e.pageInfo?.endCursor??null,startCursor:e.pageInfo?.startCursor??null,totalCount:e.totalCount??0}}else console.error("Invalid bills data received:",e)}catch(e){console.error("Error searching bills:",e)}finally{this.fetchingBills=!1}},async fetchBatchPrices(i,e){if(!(!i.length&&!e.length))try{this.fetchingPrices=!0;const r=await o(l,{profileUids:i||[],analysisUids:e||[]},"pricesForBatch");if(r&&typeof r=="object"){const s=r;s.profilePrices&&Array.isArray(s.profilePrices)&&s.profilePrices.forEach(t=>{t.profileUid&&this.profilePrices.set(t.profileUid,t)}),s.analysisPrices&&Array.isArray(s.analysisPrices)&&s.analysisPrices.forEach(t=>{t.analysisUid&&this.analysisPrices.set(t.analysisUid,t)})}else console.error("Invalid batch prices data received:",r)}catch(r){console.error("Error fetching batch prices:",r)}finally{this.fetchingPrices=!1}},getPriceForProfile(i){return this.profilePrices.get(i)?.amount??null},getPriceForAnalysis(i){return this.analysisPrices.get(i)?.amount??null},clearPriceCache(){this.profilePrices.clear(),this.analysisPrices.clear()}}});export{B as u};
