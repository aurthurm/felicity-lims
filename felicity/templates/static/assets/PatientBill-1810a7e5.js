import{S as H,bf as ve,O as J,d as fe,bg as be,X as ye,s as W,r as p,D as xe,n as E,o as l,c as d,b as e,e as r,f as a,g as K,F as b,p as A,y,t as c,aH as ge,E as L,w as x,H as we,G as g,q as z,i as N,at as ke,v as F,x as G,j as O,_ as j,I as Ce,J as Be,k as Te}from"./index-73e47413.js";import{A as Ie,a as Ae}from"./billing.mutations-a4aa1084.js";import{c as Se,a as R,d as Ve,u as Pe,b as M}from"./array-a321fe90.js";function Ue(){const{withClientQuery:u}=J();return{downloadInvoice:async w=>{try{await H.fire({title:"Are you sure?",text:"You want to download this invoice",icon:"warning",showCancelButton:!0,confirmButtonColor:"#3085d6",cancelButtonColor:"#d33",confirmButtonText:"Yes, download now!",cancelButtonText:"No, do not download!"}).then(async k=>{k.isConfirmed&&(u(ve,{billUid:w},"billInvoiceCreate","network-only").then(h=>{const m=document.createElement("a");m.href=`data:application/pdf;base64,${h}`,m.setAttribute("download","invoice-report.pdf"),m.click()}),await H.fire("Its Happening!","Downloading .....","success").then(h=>{}))})}catch{}}}}const o=u=>(Ce("data-v-afb0e1b5"),u=u(),Be(),u),De={class:"mt-4"},Ee=o(()=>e("h4",{class:"text-sm text-gray-800 font-bold"},"Patient's Order Bills",-1)),Le=o(()=>e("hr",null,null,-1)),Ne={class:"grid grid-cols-12 gap-4 mt-2"},Fe={initial:{opacity:0,y:100},enter:{opacity:1,y:0,scale:1},variants:{custom:{scale:2}},delay:400,class:"col-span-3 overflow-y-scroll overscroll-contain billing-scroll"},Oe={key:0,class:"py-4 text-center bg-white w-full mb-1 rounded-sm shadow border"},je={key:1},Re=["onClick"],Me={class:"flex-grow p-1"},qe={class:"font-semibold text-gray-800"},$e={class:"text-sm text-gray-400"},Ye={initial:{opacity:0,y:-100},enter:{opacity:1,y:0,scale:1},variants:{custom:{scale:2}},delay:400,class:"col-span-9"},He={class:"bg-white rounded-sm shadow-sm hover:shadow-xs duration-500 px-4 sm:px-6 md:px-2 py-4"},We={class:"flex justify-between items-center"},Ke={class:"text-gray-800 text-l font-bold"},ze=o(()=>e("hr",null,null,-1)),Ge={class:"grid grid-cols-3 gap-x-8"},Je={class:"col-span-1"},Qe={class:"flex justify-between items-center mt-2"},Xe=o(()=>e("span",{class:"text-gray-800 text-sm font-semibold"},"Active:",-1)),Ze={class:"text-gray-600 text-sm md:text-md"},et={class:"flex justify-between items-center mt-2"},tt=o(()=>e("span",{class:"text-gray-800 text-sm font-semibold"},"Confirmed:",-1)),st={class:"text-gray-600 text-sm md:text-md"},ot={class:"col-span-1"},nt={class:"flex justify-between items-center mt-2"},at=o(()=>e("span",{class:"text-gray-800 text-sm font-semibold"},"Total Charged:",-1)),lt={class:"text-gray-600 text-sm md:text-md"},it={class:"flex justify-between items-center mt-2"},dt=o(()=>e("span",{class:"text-gray-800 text-sm font-semibold"},"Total Paid:",-1)),ct={class:"text-gray-600 text-sm md:text-md"},rt={class:"col-span-1"},ut={class:"flex justify-between items-center mt-2"},mt=o(()=>e("span",{class:"text-gray-800 text-sm font-semibold"},"Partial:",-1)),_t={class:"text-gray-600 text-sm md:text-md"},pt={class:"mt-4"},ht={class:"flex justify-between items-center"},vt=o(()=>e("h4",{class:"text-gray-800 text-l font-semibold"},"Order Items",-1)),ft=o(()=>e("hr",null,null,-1)),bt={class:"mt-4 bg-white rounded-sm shadow-sm hover:shadow-xs duration-500 px-4 sm:px-6 md:px-2 py-4"},yt={class:"text-gray-400"},xt={class:"ml-2 text-md leading-5 text-sky-600"},gt={class:"mt-4"},wt={class:"flex justify-between items-center"},kt=o(()=>e("h4",{class:"text-gray-800 text-l font-semibold"},"Transactions",-1)),Ct=o(()=>e("hr",null,null,-1)),Bt={class:"mt-4 bg-white rounded-sm shadow-sm hover:shadow-xs duration-500 px-4 sm:px-6 md:px-2 py-4"},Tt=o(()=>e("h3",null,"Transaction Form",-1)),It={class:"grid grid-cols-2 gap-x-4 mb-4"},At={class:"whitespace-nowrap mb-2 w-full"},St=o(()=>e("span",{class:"text-gray-700 w-4/12"},"Kind of payment",-1)),Vt={class:"w-full"},Pt=o(()=>e("option",null,null,-1)),Ut=["value"],Dt={class:"text-orange-600 w-4/12"},Et={class:"block col-span-1 mb-2"},Lt=o(()=>e("span",{class:"text-gray-700"},"Amount",-1)),Nt={class:"grid grid-cols-4 gap-x-4 mb-4"},Ft={class:"block col-span-4 mb-2"},Ot=o(()=>e("span",{class:"text-gray-700"},"Notes",-1)),jt=o(()=>e("hr",null,null,-1)),Rt=o(()=>e("h3",null,"Apply Voucher Code Form",-1)),Mt={class:"grid grid-cols-2 gap-x-4 mb-4"},qt={class:"block col-span-2 mb-2"},$t=o(()=>e("span",{class:"text-gray-700"},"Voucher Code:",-1)),Yt=o(()=>e("hr",null,null,-1)),Ht=fe({__name:"PatientBill",props:{patientUid:String},setup(u){const q=O(()=>j(()=>import("./FelLoadingMessage-33c22254.js"),["assets/FelLoadingMessage-33c22254.js","assets/index-73e47413.js","assets/index-227a7d92.css"])),w=O(()=>j(()=>import("./FelModal-344bef25.js"),["assets/FelModal-344bef25.js","assets/index-73e47413.js","assets/index-227a7d92.css","assets/FelModal-a7d23795.css"])),k=O(()=>j(()=>import("./FelDataTable-43b88da9.js"),["assets/FelDataTable-43b88da9.js","assets/index-73e47413.js","assets/index-227a7d92.css"])),h=u,{withClientMutation:m}=J(),C=be(),Q=ye(),{bills:$,fetchingBills:X,transactions:Z,fetchingTransactions:ee}=W(C),{analysisRequests:te}=W(Q);C.fetchBillsForPatient(h?.patientUid);const se=p(["cash","medical-aid","e-payment"]),S=p(!1),n=p({}),oe=i=>{n.value={...i},C.fetchBillTransactions(i.uid)},ne=xe(()=>{const i=n?.value?.orders?.map(s=>s.uid)??[];return te?.value?.filter(s=>i.includes(s.uid))});function ae(i,s){let _=[];return i.forEach(v=>_.push(v.name)),s.forEach(v=>_.push(v.name)),_.join(", ")}const le=Se({testBillUid:R().required(),kind:R().required(),amount:Ve().required(),notes:R().nullable()}),{handleSubmit:ie,errors:B,setFieldValue:T}=Pe({validationSchema:le,initialValues:{testBillUid:n.value?.uid}}),{value:V}=M("kind"),{value:P}=M("amount"),{value:U}=M("notes"),Y=ie(i=>ce(i)),de=()=>{T("testBillUid",n.value?.uid),T("kind","cash"),T("amount",+n?.value?.totalCharged-+n?.value?.totalPaid),T("notes",""),S.value=!0},ce=i=>{m(Ie,{payload:i},"createTestBillTransaction").then(s=>C.addTransaction(s))},re=p([{name:"Kind",value:"kind",sortable:!0,sortBy:"asc",defaultSort:!0,showInToggler:!1,hidden:!1},{name:"Amount",value:"amount",sortable:!1,sortBy:"asc",hidden:!1},{name:"Success",value:"isSuccess",sortable:!1,sortBy:"asc",hidden:!1},{name:"Notes",value:"notes",sortable:!1,sortBy:"asc",hidden:!1},{name:"Message",value:"message",sortable:!1,sortBy:"asc",hidden:!1},{name:"Processed",value:"processed",sortable:!1,sortBy:"asc",hidden:!1}]),D=p(!1),I=p({code:""}),ue=()=>{D.value=!0},me=()=>{m(Ae,{payload:{voucherCode:I.value?.code,testBillUid:n.value?.uid,customerUid:h.patientUid}},"applyVoucher").then(i=>{})},{downloadInvoice:_e}=Ue(),pe=async i=>await _e(i.uid);return(i,s)=>{const _=E("motion"),v=E("motion-slide-top"),he=E("motion-slide-right");return l(),d(b,null,[e("div",De,[Ee,Le,e("div",Ne,[r((l(),d("section",Fe,[a(X)?(l(),d("div",Oe,[K(a(q),{message:"Fetching bills ..."})])):(l(),d("div",je,[e("ul",null,[(l(!0),d(b,null,A(a($),t=>(l(),d("li",{key:t.uid,class:y(["bg-white w-full flex items-center p-1 mb-1 rounded-sm shadow border",{"border-sky-800 bg-emerald-200":t.uid===n.value.uid}]),onClick:f=>oe(t)},[e("div",Me,[e("div",qe,[e("div",null,c(t.billId?.toLocaleUpperCase()),1),e("div",$e,c(a(ge)(t.createdAt)),1)])])],10,Re))),128))])]))])),[[_]]),r((l(),d("section",Ye,[r((l(),d("div",He,[e("div",We,[e("h4",Ke,c(n.value.billId?.toLocaleUpperCase()),1)]),ze,e("section",Ge,[e("div",Je,[e("div",Qe,[Xe,e("span",Ze,c(n.value.isActive?"Yes":"No"),1)]),e("div",et,[tt,e("span",st,c(n.value?.toConfirm?"No":"Yes"),1)])]),e("div",ot,[e("div",nt,[at,e("span",lt,c(n.value?.totalCharged),1)]),e("div",it,[dt,e("span",ct,c(n.value?.totalPaid),1)])]),e("div",rt,[e("div",ut,[mt,e("span",_t,c(n.value?.totalPaid<n.value?.totalCharged?"Yes":"No"),1)])])])])),[[v]]),e("div",pt,[e("div",ht,[vt,e("button",{class:"ml-4 px-2 py-1 mr-2 border-sky-800 border text-sky-800 rounded-sm transition duration-300 hover:bg-sky-800 hover:text-white focus:outline-none",onClick:s[0]||(s[0]=x(t=>pe(n.value),["prevent"]))}," Invoice ")]),ft,e("ul",bt,[(l(!0),d(b,null,A(ne.value,t=>(l(),d("li",{class:"font-semibold",key:t.uid},[e("div",null,c(t?.requestId)+" ("+c(t?.clientRequestId)+")",1),(l(!0),d(b,null,A(t.samples,f=>r((l(),d("div",{class:"ml-4 text-sm",key:f.uid},[e("span",yt,c(f.sampleId),1),we(" â‡’ "),e("span",xt,c(ae(f.profiles??[],f.analyses??[])),1)])),[[he]])),128))]))),128))])]),e("div",gt,[e("div",wt,[kt,e("div",null,[r(e("button",{class:"px-2 py-1 mr-2 border-sky-800 border text-sky-800 rounded-sm transition duration-300 hover:bg-sky-800 hover:text-white focus:outline-none",onClick:x(de,["prevent"])}," Add Transaction ",512),[[L,n.value.isActive]]),r(e("button",{class:"ml-4 px-2 py-1 mr-2 border-sky-800 border text-sky-800 rounded-sm transition duration-300 hover:bg-sky-800 hover:text-white focus:outline-none",onClick:x(ue,["prevent"])}," Apply Voucher ",512),[[L,n.value.isActive]])])]),Ct,e("div",Bt,[K(a(k),{columns:re.value,data:a(Z),toggleColumns:!1,loading:a(ee),paginable:!1,searchable:!1,filterable:!1,selectable:!1},{footer:g(()=>[]),_:1},8,["columns","data","loading"])])])])),[[L,a($)?.length>0&&n.value.uid],[_]])])]),S.value?(l(),z(a(w),{key:0,onClose:s[5]||(s[5]=t=>S.value=!1),contentWidth:"w-3/6"},{header:g(()=>[Tt]),body:g(()=>[e("form",null,[e("div",It,[e("label",At,[St,e("div",Vt,[r(e("select",{class:y(["form-select mt-1 w-full",{"border-red-500 animate-pulse":a(B).kind}]),"onUpdate:modelValue":s[1]||(s[1]=t=>N(V)?V.value=t:null)},[Pt,(l(!0),d(b,null,A(se.value,t=>(l(),d("option",{key:t,value:t},c(t),9,Ut))),128))],2),[[ke,a(V)]]),e("div",Dt,c(a(B).gender),1)])]),e("label",Et,[Lt,r(e("input",{class:y(["form-input mt-1 block w-full",{"border-red-500 animate-pulse":a(B).amount}]),type:"number","onUpdate:modelValue":s[2]||(s[2]=t=>N(P)?P.value=t:null)},null,2),[[F,a(P)]])])]),e("div",Nt,[e("label",Ft,[Ot,r(e("input",{class:y(["form-input mt-1 block w-full",{"border-red-500 animate-pulse":a(B).notes}]),type:"number",min:"1","onUpdate:modelValue":s[3]||(s[3]=t=>N(U)?U.value=t:null)},null,2),[[F,a(U)]])])]),jt,e("button",{type:"submit",class:"-mb-4 border border-sky-800 bg-sky-800 text-white rounded-sm px-2 py-1 mt-2 transition-colors duration-500 ease select-none hover:bg-sky-800 focus:outline-none focus:shadow-outline",onClick:s[4]||(s[4]=x((...t)=>a(Y)&&a(Y)(...t),["prevent"]))}," Save Transaction ")])]),_:1})):G("",!0),D.value?(l(),z(a(w),{key:1,onClose:s[7]||(s[7]=t=>D.value=!1),contentWidth:"w-1/5"},{header:g(()=>[Rt]),body:g(()=>[e("form",null,[e("div",Mt,[e("label",qt,[$t,r(e("input",{class:y(["form-input mt-1 block w-full",{"border-red-500 animate-pulse":!I.value.code}]),type:"text","onUpdate:modelValue":s[6]||(s[6]=t=>I.value.code=t)},null,2),[[F,I.value.code]])])]),Yt,e("button",{type:"submit",class:"-mb-4 border border-sky-800 bg-sky-800 text-white rounded-sm px-2 py-1 mt-2 transition-colors duration-500 ease select-none hover:bg-sky-800 focus:outline-none focus:shadow-outline",onClick:x(me,["prevent"])}," Apply Voucher ")])]),_:1})):G("",!0)],64)}}});const Gt=Te(Ht,[["__scopeId","data-v-afb0e1b5"],["__file","/home/aurthurm/Documents/Development/felicity/felicity-lims/webapp/views/patient/_id/PatientBill.vue"]]);export{Gt as default};
