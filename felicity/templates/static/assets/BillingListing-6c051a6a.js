import{W as z,am as M,a2 as d,a3 as l,h as U,a9 as O,i as V,r as j,o as x,c as W,O as o,a as C,a7 as r,M as _,z as Y,L as q,F as G,a0 as B,a1 as y,_ as H}from"./index-5d85e9da.js";import{u as J}from"./billing-87301a8c.js";import"./billing.queries-223b5d80.js";const K={class:"space-y-6"},Q={class:"rounded-lg border border-border bg-card shadow-sm p-4"},X={class:"grid grid-cols-1 md:grid-cols-2 gap-4"},Z=["value"],ee=["value"],te={class:"rounded-lg border border-border bg-card shadow-sm p-6"},ae=z({__name:"BillingListing",setup(se){const A=B(()=>y(()=>import("./FelDataTable-f331e430.js"),["assets/FelDataTable-f331e430.js","assets/index-5d85e9da.js","assets/index-8a6751fe.css"])),w=B(()=>y(()=>import("./BillDetail-e44044b2.js"),["assets/BillDetail-e44044b2.js","assets/index-5d85e9da.js","assets/index-8a6751fe.css","assets/billing-87301a8c.js","assets/billing.queries-223b5d80.js","assets/billing.mutations-d73a0197.js","assets/array-5c68cccc.js","assets/BillDetail-3550c9fc.css"])),g=J(),{bills:v,billPageInfo:c,fetchingBills:P}=M(g),f=d(!1),i=d(void 0);function $(e){return{pending:"bg-yellow-100 text-yellow-800",received:"bg-blue-100 text-blue-800",approved:"bg-green-100 text-green-800",published:"bg-purple-100 text-purple-800",rejected:"bg-red-100 text-red-800",cancelled:"bg-gray-100 text-gray-800"}[e?.toLowerCase()]||"bg-gray-100 text-gray-800"}function S(e){i.value=e,f.value=!0}function D(){f.value=!1,i.value=void 0}const I=d([{name:"UID",value:"uid",sortable:!0,sortBy:"asc",defaultSort:!0,showInToggler:!1,hidden:!0},{name:"Bill #",value:"billId",sortable:!1,hidden:!1,customRender:function(e,a){return l("button",{onClick:()=>S(e),type:"button",class:"px-2 py-1 font-semibold rounded-md hover:underline transition-colors duration-200 text-left cursor-pointer"},e?.billId||"—")}},{name:"Client",value:"client.name",sortable:!1,hidden:!1},{name:"Patient",value:"",sortable:!1,hidden:!1,customRender:function(e,a){if(!e?.orders||e.orders.length===0)return l("span","—");const s=e.orders[0]?.patient;if(!s)return l("span","—");const n=`${s?.firstName||""} ${s?.lastName||""}`.trim(),p=s?.gender?` (${s.gender})`:"";return l("span",`${n}${p}`)}},{name:"Samples",value:"",sortable:!1,hidden:!1,customRender:function(e,a){if(!e?.orders||e.orders.length===0)return l("span","—");const s=[];return e.orders.forEach((n,p)=>{n.samples&&n.samples.length>0&&n.samples.forEach((m,E)=>{const L=$(m?.status);s.push(l("div",{key:`${p}-${E}`,class:"mb-2"},[l("span",{class:"font-mono text-sm"},m?.sampleId||"—"),l("span",{class:"mx-2"},"•"),l("span",{class:`text-xs px-2 py-1 rounded ${L}`},m?.status||"—")]))})}),l("div",s.length>0?s:l("span","—"))}},{name:"Amount Charged",value:"totalCharged",sortable:!1,hidden:!1,customRender:function(e,a){return l("span",`$${parseFloat(e?.totalCharged||0).toFixed(2)}`)}},{name:"Amount Paid",value:"totalPaid",sortable:!1,hidden:!1,customRender:function(e,a){return l("span",`$${parseFloat(e?.totalPaid||0).toFixed(2)}`)}},{name:"Balance",value:"",sortable:!1,hidden:!1,customRender:function(e,a){const s=parseFloat(e?.totalCharged||0)-parseFloat(e?.totalPaid||0),n=s>0?"text-red-600":"text-green-600";return l("span",{class:n},`$${s.toFixed(2)}`)}},{name:"Partial",value:"partial",sortable:!1,hidden:!1,customRender:function(e,a){const s=e?.partial?"Yes":"No",n=e?.partial?"bg-orange-100 text-orange-800":"bg-green-100 text-green-800";return l("span",{class:`px-2 py-1 rounded text-sm font-medium ${n}`},s)}},{name:"Status",value:"isActive",sortable:!1,hidden:!1,customRender:function(e,a){const s=e?.isActive?"Active":"Inactive",n=e?.isActive?"bg-green-100 text-green-800":"bg-gray-100 text-gray-800";return l("span",{class:`px-2 py-1 rounded text-sm font-medium ${n}`},s)}},{name:"Date",value:"createdAt",sortable:!1,hidden:!1,customRender:function(e,a){return l("span",new Date(e?.createdAt).toLocaleDateString())}}]);let t=U({pageSize:50,afterCursor:"",beforeCursor:"",text:"",isActive:null,partial:null,clientUid:"",sortBy:["-uid"],filterAction:!1});const b=d(null),h=d(null);O(()=>{u()});async function u(){await g.searchBills({pageSize:t.pageSize,afterCursor:t.afterCursor||void 0,beforeCursor:t.beforeCursor||void 0,text:t.text||void 0,isActive:t.isActive!==null?t.isActive:void 0,partial:t.partial!==null?t.partial:void 0,clientUid:t.clientUid||void 0,sortBy:t.sortBy})}function R(e){e==="all"?t.partial=null:e==="partial"?t.partial=!0:e==="complete"&&(t.partial=!1),t.afterCursor="",t.beforeCursor="",t.filterAction=!0,b.value=e,u()}function F(e){e==="all"?t.isActive=null:e==="active"?t.isActive=!0:e==="inactive"&&(t.isActive=!1),t.afterCursor="",t.beforeCursor="",t.filterAction=!0,h.value=e,u()}function N(e){t.pageSize=100,t.afterCursor="",t.beforeCursor="",t.text=e.filterText,t.filterAction=!0,u()}function T(e){t.pageSize=e.fetchCount,t.afterCursor=c?.value?.endCursor??"",t.beforeCursor="",t.text=e.filterText,t.filterAction=!1,u()}const k=V(()=>`${v?.value?.length} of ${c?.value?.totalCount??0} bills`);return(e,a)=>{const s=j("fel-drawer");return x(),W(G,null,[o("div",K,[o("div",Q,[o("div",X,[o("div",null,[a[3]||(a[3]=o("label",{class:"block text-sm font-medium text-foreground mb-2"},"Billing Type",-1)),o("select",{value:b.value,onChange:a[0]||(a[0]=n=>R(n.target.value)),class:"w-full px-3 py-2 border border-border rounded-md focus:outline-none focus:ring-2 focus:ring-primary"},a[2]||(a[2]=[o("option",{value:"all"},"All Types",-1),o("option",{value:"complete"},"Complete Bills",-1),o("option",{value:"partial"},"Partial Bills",-1)]),40,Z)]),o("div",null,[a[5]||(a[5]=o("label",{class:"block text-sm font-medium text-foreground mb-2"},"Bill Status",-1)),o("select",{value:h.value,onChange:a[1]||(a[1]=n=>F(n.target.value)),class:"w-full px-3 py-2 border border-border rounded-md focus:outline-none focus:ring-2 focus:ring-primary"},a[4]||(a[4]=[o("option",{value:"all"},"All Status",-1),o("option",{value:"active"},"Active",-1),o("option",{value:"inactive"},"Inactive",-1)]),40,ee)])])]),o("div",te,[C(r(A),{columns:I.value,data:r(v),toggleColumns:!0,loading:r(P),paginable:!0,pageMeta:{fetchCount:r(t).pageSize,hasNextPage:r(c)?.hasNextPage,countNone:k.value},searchable:!0,filterable:!1,onOnSearch:N,onOnPaginate:T,selectable:!1},null,8,["columns","data","loading","pageMeta"])])]),C(s,{show:f.value,onClose:D,"content-width":"w-2/4"},{header:_(()=>a[6]||(a[6]=[o("span",null,"Bill Details",-1)])),body:_(()=>[i.value?(x(),Y(r(w),{key:0,customerUid:i.value?.patientUid??"",testBill:i.value},null,8,["customerUid","testBill"])):q("",!0)]),_:1},8,["show"])],64)}}}),re=H(ae,[["__file","/home/aurthurm/Documents/Development/felicity/felicity-lims/webapp/views/billing/BillingListing.vue"]]);export{re as default};
