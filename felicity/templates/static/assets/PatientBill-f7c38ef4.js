import{e as te,S as Z,P as ke,u as Ce,ai as G,Z as m,h as Te,a3 as ee,$ as Y,o as a,c as r,b as t,A as u,a2 as o,a as C,F as T,D,a1 as b,E as i,a5 as Be,C as q,z as y,L as U,K as c,x as O,a7 as K,a4 as Ve,V as F,J as W,X as N,Y as E,i as Ae,_ as Ie}from"./index-66877f9a.js";import{I as Pe,u as Se,g as De,C as Ue,h as Fe}from"./billing-3ae57688.js";import{c as Ne,a as z,d as Ee,u as Le,b as H}from"./array-08c0d647.js";function Me(){const{withClientQuery:L}=te();return{downloadInvoice:async x=>{try{await Z.fire({title:"Are you sure?",text:"You want to download this invoice",icon:"warning",showCancelButton:!0,confirmButtonColor:"#3085d6",cancelButtonColor:"#d33",confirmButtonText:"Yes, download now!",cancelButtonText:"No, do not download!"}).then(async p=>{p.isConfirmed&&(L(Pe,{billUid:x},"billInvoiceCreate","network-only").then(B=>{const v=document.createElement("a");v.href=`data:application/pdf;base64,${B}`,v.setAttribute("download","invoice-report.pdf"),v.click()}),await Z.fire("Its Happening!","Downloading .....","success").then(B=>{}))})}catch{}}}}const Re={class:"mt-4"},je={class:"grid grid-cols-12 gap-4 mt-2"},$e={initial:{opacity:0,y:100},enter:{opacity:1,y:0,scale:1},variants:{custom:{scale:2}},delay:400,class:"col-span-3 overflow-y-scroll overscroll-contain billing-scroll"},Ye={key:0,class:"py-4 text-center bg-white w-full mb-1 rounded-sm shadow border"},qe={key:1},Oe=["onClick"],Ke={class:"flex-grow p-1"},We={class:"font-semibold text-gray-800"},ze={class:"text-sm text-gray-400"},He={initial:{opacity:0,y:-100},enter:{opacity:1,y:0,scale:1},variants:{custom:{scale:2}},delay:400,class:"col-span-9"},Je={class:"bg-white rounded-sm shadow-sm hover:shadow-xs duration-500 px-4 sm:px-6 md:px-2 py-4"},Qe={class:"flex justify-between items-center"},Xe={class:"text-gray-800 text-l font-bold"},Ze={class:"grid grid-cols-3 gap-x-8"},Ge={class:"col-span-1"},et={class:"flex justify-between items-center mt-2"},tt={class:"text-gray-600 text-sm md:text-md"},st={class:"flex justify-between items-center mt-2"},ot={class:"text-gray-600 text-sm md:text-md"},lt={class:"col-span-1"},nt={class:"flex justify-between items-center mt-2"},at={class:"text-gray-600 text-sm md:text-md"},it={class:"flex justify-between items-center mt-2"},dt={class:"text-gray-600 text-sm md:text-md"},rt={class:"col-span-1"},ut={class:"flex justify-between items-center mt-2"},ct={class:"text-gray-600 text-sm md:text-md"},mt={class:"mt-4"},pt={class:"flex justify-between items-center"},vt={class:"mt-4 bg-white rounded-sm shadow-sm hover:shadow-xs duration-500 px-4 sm:px-6 md:px-2 py-4"},ft={class:"text-gray-400"},bt={class:"ml-2 text-md leading-5 text-sky-600"},yt={class:"mt-4"},xt={class:"flex justify-between items-center"},gt={class:"mt-4 bg-white rounded-sm shadow-sm hover:shadow-xs duration-500 px-4 sm:px-6 md:px-2 py-4"},_t={class:"grid grid-cols-2 gap-x-4 mb-4"},ht={class:"whitespace-nowrap mb-2 w-full"},wt={class:"w-full"},kt=["disabled"],Ct=["value"],Tt={class:"text-orange-600 w-4/12"},Bt={class:"block col-span-1 mb-2"},Vt=["disabled"],At={class:"grid grid-cols-4 gap-x-4 mb-4"},It={class:"block col-span-4 mb-2"},Pt=["disabled"],St={class:"grid grid-cols-4 gap-x-4 mb-4"},Dt={class:"block col-span-4 mb-2"},Ut=["disabled"],Ft={class:"grid grid-cols-2 gap-x-4 mb-4"},Nt={class:"block col-span-2 mb-2"},Et=["disabled"],Lt=ke({__name:"PatientBill",props:{patientUid:String},setup(L){const J=N(()=>E(()=>import("./FelLoadingMessage-da26a10d.js"),["assets/FelLoadingMessage-da26a10d.js","assets/index-66877f9a.js","assets/index-78b87750.css"])),x=N(()=>E(()=>import("./index-66877f9a.js").then(l=>l.cN),["assets/index-66877f9a.js","assets/index-78b87750.css"])),p=N(()=>E(()=>import("./FelButton-7e9d8309.js"),["assets/FelButton-7e9d8309.js","assets/index-66877f9a.js","assets/index-78b87750.css"])),B=N(()=>E(()=>import("./FelDataTable-b2644bbd.js"),["assets/FelDataTable-b2644bbd.js","assets/index-66877f9a.js","assets/index-78b87750.css"])),v=L,{toastSuccess:Q}=Ae(),{withClientMutation:M}=te(),g=Se(),se=Ce(),{bills:X,fetchingBills:oe,transactions:le,fetchingTransactions:ne}=G(g),{analysisRequests:ae}=G(se);g.fetchBillsForPatient(v?.patientUid);const ie=m(["cash","medical-aid","e-payment"]),V=m(!1),n=m({}),de=l=>{n.value={...l},g.fetchBillTransactions(l.uid)},re=Te(()=>{const l=n?.value?.orders?.map(e=>e.uid)??[];return ae?.value?.filter(e=>l.includes(e.uid))});function ue(l,e){let f=[];return l.forEach(w=>f.push(w.name)),e.forEach(w=>f.push(w.name)),f.join(", ")}const ce=Ne({testBillUid:z().required(),kind:z().required(),amount:Ee().required(),notes:z()}),{handleSubmit:me,errors:_,setFieldValue:A}=Le({validationSchema:ce,initialValues:{testBillUid:n.value?.uid}}),{value:I}=H("kind"),{value:R}=H("amount"),{value:j}=H("notes"),d=m(!1),pe=me(l=>{d.value=!0,fe(l)}),ve=()=>{A("testBillUid",n.value?.uid),A("kind","cash"),A("amount",Math.ceil(Number((n?.value?.totalCharged-n?.value?.totalPaid).toFixed(2)))),A("notes",""),V.value=!0},fe=l=>{M(De,{payload:l},"createTestBillTransaction").then(e=>{g.addTransaction(e),d.value=!1,V.value=!1,Q("Transaction added.")})},P=m(!1),h=m({}),be=()=>{d.value=!0,M(Ue,{uid:h.value.uid,notes:h.value.notes},"confirmTestBillTransaction").then(l=>{g.updateTransaction(l),d.value=!1,P.value=!1,Q("Transaction confirmed.")})},ye=m([{name:"Kind",value:"kind",sortable:!0,sortBy:"asc",defaultSort:!0,showInToggler:!1,hidden:!1},{name:"Amount",value:"amount",sortable:!1,sortBy:"asc",hidden:!1},{name:"Success",value:"isSuccess",sortable:!1,sortBy:"asc",hidden:!1},{name:"Notes",value:"notes",sortable:!1,sortBy:"asc",hidden:!1},{name:"Message",value:"message",sortable:!1,sortBy:"asc",hidden:!1},{name:"Processed",value:"processed",sortable:!1,sortBy:"asc",hidden:!1,customRender:function(l,e){return ee("span",{innerHTML:l.processed?"Yes":"Pending confirmation"},[])}},{name:"Action",sortable:!1,hidden:!1,customRender:(l,e)=>{if(!l.processed)return ee("button",{onClick(){P.value=!0,h.value=l},type:"button",class:"bg-sky-800 text-white py-1 px-2 rounded-sm leading-none"},"confirm")}}]),$=m(!1),S=m({code:""}),xe=()=>{$.value=!0},ge=()=>{d.value=!0,M(Fe,{payload:{voucherCode:S.value?.code,testBillUid:n.value?.uid,customerUid:v.patientUid}},"applyVoucher").then(l=>d.value=!1)},{downloadInvoice:_e}=Me(),he=async l=>await _e(l.uid);return(l,e)=>{const f=Y("motion"),w=Y("motion-slide-top"),we=Y("motion-slide-right");return a(),r(T,null,[t("div",Re,[e[21]||(e[21]=t("h4",{class:"text-sm text-gray-800 font-bold"},"Patient's Order Bills",-1)),e[22]||(e[22]=t("hr",null,null,-1)),t("div",je,[u((a(),r("section",$e,[o(oe)?(a(),r("div",Ye,[C(o(J),{message:"Fetching bills ..."})])):(a(),r("div",qe,[t("ul",null,[(a(!0),r(T,null,D(o(X),s=>(a(),r("li",{key:s.uid,class:b(["bg-white w-full flex items-center p-1 mb-1 rounded-sm shadow border",{"border-sky-800 bg-emerald-200":s.uid===n.value.uid}]),onClick:k=>de(s)},[t("div",Ke,[t("div",We,[t("div",null,i(s.billId?.toLocaleUpperCase()),1),t("div",ze,i(o(Be)(s.createdAt)),1)])])],10,Oe))),128))])]))])),[[f]]),u((a(),r("section",He,[u((a(),r("div",Je,[t("div",Qe,[t("h4",Xe,i(n.value.billId?.toLocaleUpperCase()),1)]),e[14]||(e[14]=t("hr",null,null,-1)),t("section",Ze,[t("div",Ge,[t("div",et,[e[9]||(e[9]=t("span",{class:"text-gray-800 text-sm font-semibold"},"Active:",-1)),t("span",tt,i(n.value.isActive?"Yes":"No"),1)]),t("div",st,[e[10]||(e[10]=t("span",{class:"text-gray-800 text-sm font-semibold"},"Confirmed:",-1)),t("span",ot,i(n.value?.toConfirm?"No":"Yes"),1)])]),t("div",lt,[t("div",nt,[e[11]||(e[11]=t("span",{class:"text-gray-800 text-sm font-semibold"},"Total Charged:",-1)),t("span",at,i(n.value?.totalCharged),1)]),t("div",it,[e[12]||(e[12]=t("span",{class:"text-gray-800 text-sm font-semibold"},"Total Paid:",-1)),t("span",dt,i(n.value?.totalPaid),1)])]),t("div",rt,[t("div",ut,[e[13]||(e[13]=t("span",{class:"text-gray-800 text-sm font-semibold"},"Partial:",-1)),t("span",ct,i(n.value?.totalPaid<n.value?.totalCharged?"Yes":"No"),1)])])])])),[[w]]),t("div",mt,[t("div",pt,[e[15]||(e[15]=t("h4",{class:"text-gray-800 text-l font-semibold"},"Order Items",-1)),t("button",{class:"ml-4 px-2 py-1 mr-2 border-sky-800 border text-sky-800 rounded-sm transition duration-300 hover:bg-sky-800 hover:text-white focus:outline-none",onClick:e[0]||(e[0]=y(s=>he(n.value),["prevent"]))}," Invoice ")]),e[17]||(e[17]=t("hr",null,null,-1)),t("ul",vt,[(a(!0),r(T,null,D(re.value,s=>(a(),r("li",{class:"font-semibold",key:s.uid},[t("div",null,i(s?.requestId)+" ("+i(s?.clientRequestId)+")",1),(a(!0),r(T,null,D(s.samples,k=>u((a(),r("div",{class:"ml-4 text-sm",key:k.uid},[t("span",ft,i(k.sampleId),1),e[16]||(e[16]=U(" â‡’ ")),t("span",bt,i(ue(k.profiles??[],k.analyses??[])),1)])),[[we]])),128))]))),128))])]),t("div",yt,[t("div",xt,[e[18]||(e[18]=t("h4",{class:"text-gray-800 text-l font-semibold"},"Transactions",-1)),t("div",null,[u(t("button",{class:"px-2 py-1 mr-2 border-sky-800 border text-sky-800 rounded-sm transition duration-300 hover:bg-sky-800 hover:text-white focus:outline-none",onClick:y(ve,["prevent"])}," Add Transaction ",512),[[q,n.value.isActive]]),u(t("button",{class:"ml-4 px-2 py-1 mr-2 border-sky-800 border text-sky-800 rounded-sm transition duration-300 hover:bg-sky-800 hover:text-white focus:outline-none",onClick:y(xe,["prevent"])}," Apply Voucher ",512),[[q,n.value.isActive]])])]),e[20]||(e[20]=t("hr",null,null,-1)),t("div",gt,[C(o(B),{columns:ye.value,data:o(le),toggleColumns:!1,loading:o(ne),paginable:!1,searchable:!1,filterable:!1,selectable:!1},{footer:c(()=>e[19]||(e[19]=[])),_:1},8,["columns","data","loading"])])])])),[[q,o(X)?.length>0&&n.value.uid],[f]])])]),V.value?(a(),O(o(x),{key:0,onClose:e[4]||(e[4]=s=>V.value=!1),contentWidth:"w-3/6"},{header:c(()=>e[23]||(e[23]=[t("h3",null,"Transaction Form",-1)])),body:c(()=>[t("form",null,[t("div",_t,[t("label",ht,[e[25]||(e[25]=t("span",{class:"text-gray-700 w-4/12"},"Kind of payment",-1)),t("div",wt,[u(t("select",{class:b(["form-select mt-1 w-full",{"border-red-500 animate-pulse":o(_).kind}]),"onUpdate:modelValue":e[1]||(e[1]=s=>K(I)?I.value=s:null),disabled:d.value},[e[24]||(e[24]=t("option",null,null,-1)),(a(!0),r(T,null,D(ie.value,s=>(a(),r("option",{key:s,value:s},i(s),9,Ct))),128))],10,kt),[[Ve,o(I)]]),t("div",Tt,i(o(_).gender),1)])]),t("label",Bt,[e[26]||(e[26]=t("span",{class:"text-gray-700"},"Amount",-1)),u(t("input",{class:b(["form-input mt-1 block w-full",{"border-red-500 animate-pulse":o(_).amount}]),type:"number","onUpdate:modelValue":e[2]||(e[2]=s=>K(R)?R.value=s:null),disabled:d.value},null,10,Vt),[[F,o(R)]])])]),t("div",At,[t("label",It,[e[27]||(e[27]=t("span",{class:"text-gray-700"},"Notes",-1)),u(t("input",{class:b(["form-input mt-1 block w-full",{"border-red-500 animate-pulse":o(_).notes}]),"onUpdate:modelValue":e[3]||(e[3]=s=>K(j)?j.value=s:null),disabled:d.value},null,10,Pt),[[F,o(j)]])])]),e[29]||(e[29]=t("hr",{class:"mb-4"},null,-1)),C(o(p),{color:"sky-800",type:"submit",loading:d.value,onClick:y(o(pe),["prevent"])},{default:c(()=>e[28]||(e[28]=[U(" Save Transaction ")])),_:1},8,["loading","onClick"])])]),_:1})):W("",!0),P.value?(a(),O(o(x),{key:1,onClose:e[6]||(e[6]=s=>P.value=!1),contentWidth:"w-3/6"},{header:c(()=>e[30]||(e[30]=[t("h3",null,"Confirm Tranaction",-1)])),body:c(()=>[t("form",null,[t("h4",null,i(o(I))+" Transaction ",1),t("div",St,[t("label",Dt,[e[31]||(e[31]=t("span",{class:"text-gray-700"},"Notes",-1)),u(t("input",{class:b(["form-input mt-1 block w-full",{"border-red-500 animate-pulse":o(_).notes}]),"onUpdate:modelValue":e[5]||(e[5]=s=>h.value.notes=s),disabled:d.value},null,10,Ut),[[F,h.value.notes]])])]),e[33]||(e[33]=t("hr",{class:"mb-4"},null,-1)),C(o(p),{color:"sky-800",type:"submit",loading:d.value,onClick:y(be,["prevent"])},{default:c(()=>e[32]||(e[32]=[U(" Confirm Transaction ")])),_:1},8,["loading"])])]),_:1})):W("",!0),$.value?(a(),O(o(x),{key:2,onClose:e[8]||(e[8]=s=>$.value=!1),contentWidth:"w-1/5"},{header:c(()=>e[34]||(e[34]=[t("h3",null,"Apply Voucher Code Form",-1)])),body:c(()=>[t("form",null,[t("div",Ft,[t("label",Nt,[e[35]||(e[35]=t("span",{class:"text-gray-700"},"Voucher Code:",-1)),u(t("input",{class:b(["form-input mt-1 block w-full",{"border-red-500 animate-pulse":!S.value.code}]),type:"text","onUpdate:modelValue":e[7]||(e[7]=s=>S.value.code=s),disabled:d.value},null,10,Et),[[F,S.value.code]])])]),e[37]||(e[37]=t("hr",{class:"mb-4"},null,-1)),C(o(p),{color:"sky-800",type:"submit",loading:d.value,onClick:y(ge,["prevent"])},{default:c(()=>e[36]||(e[36]=[U(" Apply Voucher ")])),_:1},8,["loading"])])]),_:1})):W("",!0)],64)}}});const $t=Ie(Lt,[["__scopeId","data-v-afb0e1b5"],["__file","/home/aurthurm/Documents/Development/felicity/felicity-lims/webapp/views/patient/_id/PatientBill.vue"]]);export{$t as default};
