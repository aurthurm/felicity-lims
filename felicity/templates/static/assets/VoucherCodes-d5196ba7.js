import{P as j,e as z,ai as O,h as W,aa as J,R as K,Z as X,r as Y,o as n,c,b as o,a2 as i,a as V,F as k,D as Z,E as g,x as G,K as w,A as _,a1 as U,a7 as m,V as A,W as H,z as Q,J as ee,X as L,Y as D,_ as oe}from"./index-03a7f0eb.js";import{u as se,e as te,f as ie}from"./billing-3011b479.js";import{c as de,a as h,d as le,g as ae,u as re,b as u}from"./array-9b204d8d.js";const ne={class:"mt-4"},ue={key:0},ce={key:1},me={class:"grid grid-cols-5 gap-2 mt-2"},he={class:"font-semibold text-gray-800 flex justify-between items-center"},pe={class:"text-sm text-gray-500 flex-grow text-right"},ve=["onClick"],fe={class:"grid grid-cols-2 gap-x-4 mb-4"},be={class:"block col-span-1 mb-2"},ge={class:"block col-span-1 mb-2"},_e={class:"grid grid-cols-2 gap-x-4 mb-4"},ye={class:"block col-span-1 mb-2"},xe=j({__name:"VoucherCodes",props:{voucherUid:String},setup(F){const S=L(()=>D(()=>import("./FelLoadingMessage-343c7df3.js"),["assets/FelLoadingMessage-343c7df3.js","assets/index-03a7f0eb.js","assets/index-81d3252e.css"])),E=L(()=>D(()=>import("./index-03a7f0eb.js").then(s=>s.cN),["assets/index-03a7f0eb.js","assets/index-81d3252e.css"])),a=F,{withClientMutation:y}=z();let r=se();const{fetchingVoucherCodes:M}=O(r),R=W(()=>{const s=r.getVouchers,e=s?.findIndex(b=>b.uid===a.voucherUid);return e>-1?s[e]?.codes:[]});J(()=>r.fetchVoucherCodes(a.voucherUid)),K(()=>a.voucherUid,s=>{r.fetchVoucherCodes(a.voucherUid)});let l=X(!1);const q=de({uid:h().nullable(),voucherUid:h().required(),code:h().required("Code is Required"),usageLimit:le().required("Usage Limit is Required"),used:h().nullable(),isActive:ae().default(!0)}),{handleSubmit:B,errors:x,setFieldValue:d}=re({validationSchema:q,initialValues:{isActive:!0,voucherUid:a.voucherUid}}),{value:I}=u("uid");u("voucherUid");const{value:p}=u("code"),{value:v}=u("usageLimit");u("used");const{value:f}=u("isActive"),C=B(s=>{s.uid||P(s),s.uid&&T(s)});let $=s=>{d("uid",s.uid),d("code",s.code),d("usageLimit",s.usageLimit),d("used",s.used),d("isActive",s.isActive),l.value=!0};const N=()=>{d("uid",void 0),d("voucherUid",a.voucherUid),d("code",void 0),d("usageLimit",void 0),d("used",void 0),d("isActive",!0),l.value=!0},P=s=>{delete s.uid,y(te,{payload:s},"createVoucherCode").then(e=>r.addVoucherCode(e)).finally(()=>l.value=!1)},T=s=>{delete s.uid,delete s.used,y(ie,{uid:I?.value,payload:s},"updateVoucherCode").then(e=>r.updateVoucherCode(e)).finally(()=>l.value=!1)};return(s,e)=>{const b=Y("font-awesome-icon");return n(),c(k,null,[o("div",ne,[i(M)?(n(),c("div",ue,[V(i(S),{message:"Fetching voucher codes ..."})])):(n(),c("section",ce,[o("div",{class:"flex justify-between"},[e[5]||(e[5]=o("h4",{class:"text-gray-800 text-l font-semibold"},"Voucher Codes",-1)),o("button",{class:"px-4 my-2 p-1 text-sm border-sky-800 border text-dark-700 transition-colors duration-150 rounded-sm focus:outline-none hover:bg-sky-800 hover:text-gray-100",onClick:N}," Add Voucher Code ")]),e[6]||(e[6]=o("hr",null,null,-1)),o("div",me,[(n(!0),c(k,null,Z(R.value,t=>(n(),c("div",{key:t.uid,class:"col-span-1 bg-white rounded-sm shadow-sm hover:shadow-md duration-500 px-2 py-2"},[o("div",he,[o("h5",null,g(t.code),1),o("div",pe,g(t.used)+" of "+g(t.usageLimit),1),o("a",{class:"ml-2 pl-2 text-gray-400 border-l-2 border-l-gray-400",onClick:Ce=>i($)(t)},[V(b,{class:"text-xs hover:text-gray-800",icon:"pen"})],8,ve)])]))),128))])]))]),i(l)?(n(),G(i(E),{key:0,onClose:e[4]||(e[4]=t=>m(l)?l.value=!1:l=!1),contentWidth:"w-3/6"},{header:w(()=>e[7]||(e[7]=[o("h3",null,"Voucher Code Form",-1)])),body:w(()=>[o("form",null,[o("div",fe,[o("label",be,[e[8]||(e[8]=o("span",{class:"text-gray-700"},"Voucher Code",-1)),_(o("input",{class:U(["form-input mt-1 block w-full",{"border-red-500 animate-pulse":i(x).code}]),type:"text","onUpdate:modelValue":e[0]||(e[0]=t=>m(p)?p.value=t:null),placeholder:"Code ..."},null,2),[[A,i(p)]])]),o("label",ge,[e[9]||(e[9]=o("span",{class:"text-gray-700"},"Usage Limit",-1)),_(o("input",{class:U(["form-input mt-1 block w-full",{"border-red-500 animate-pulse":i(x).usageLimit}]),type:"number",min:"1","onUpdate:modelValue":e[1]||(e[1]=t=>m(v)?v.value=t:null)},null,2),[[A,i(v)]])])]),o("div",_e,[o("label",ye,[e[10]||(e[10]=o("span",{class:"text-gray-700"},"Is Active",-1)),_(o("input",{class:"form-checkbox ml-4",type:"checkbox","onUpdate:modelValue":e[2]||(e[2]=t=>m(f)?f.value=t:null),checked:""},null,512),[[H,i(f)]])])]),e[11]||(e[11]=o("hr",null,null,-1)),o("button",{type:"submit",class:"-mb-4 border border-sky-800 bg-sky-800 text-white rounded-sm px-2 py-1 mt-2 transition-colors duration-500 ease select-none hover:bg-sky-800 focus:outline-none focus:shadow-outline",onClick:e[3]||(e[3]=Q((...t)=>i(C)&&i(C)(...t),["prevent"]))}," Save Voucher ")])]),_:1})):ee("",!0)],64)}}});const Ue=oe(xe,[["__scopeId","data-v-8e7b96f9"],["__file","/home/aurthurm/Documents/Development/felicity/felicity-lims/webapp/views/admin/billing/VoucherCodes.vue"]]);export{Ue as default};
