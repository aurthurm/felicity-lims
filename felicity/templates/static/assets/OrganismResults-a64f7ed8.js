import{P as X,e as Y,Z as m,h as Z,aa as H,f as ee,o,c as l,b as e,J as g,F as w,D as U,E as p,A as h,V as E,C as S,a as T,K as y,L as V,z as I,a2 as O,x as te,X as N,Y as P,_ as se}from"./index-f86d8273.js";import{h as $,o as j,a as B}from"./constants-bd793a40.js";import{u as ae}from"./analysis-fe501c80.js";import{G as ne,A as oe,S as ie,D as le,a as re}from"./microbiology.mutations-639b8f1d.js";import"./analyses.mutations-0a79566e.js";const ue={class:"flex justify-between items-center"},de=["disabled"],ce={class:"overflow-x-auto mt-2"},me={class:"align-middle inline-block min-w-full shadow overflow-hidden bg-white shadow-dashboard px-2 pt-1 rounded-bl-lg rounded-br-lg"},pe={class:"min-w-full"},ve={class:"bg-white"},be={class:"px-1 py-1 whitespace-no-wrap border-b border-gray-500"},ge={class:"text-sm leading-5 text-gray-800"},he={class:"px-1 py-1 whitespace-no-wrap border-b border-gray-500"},ye={key:0,class:"text-sm leading-5 text-sky-800"},fe=["onClick"],xe={class:"px-1 py-1 whitespace-no-wrap text-right border-b border-gray-500 text-sm leading-5"},_e={key:0},ke=["onClick"],we=["onClick"],Oe={key:1},Ae=["onClick"],Ce={class:"mt-4"},Re={class:"flex justify-start items-center"},De={type:"button",class:"bg-sky-800 text-white ml-4 px-2 py-1 rounded-sm leading-none"},Ue={key:1,class:"py-2 w-full leading italic bg-slate-50 p-2"},Ee={class:"mt-2"},Se={class:""},Te={class:"w-full"},Ve={class:"block mb-4"},Ie={class:"border p-2 h-64 overflow-y-auto"},Ne={class:"w-full"},Pe={class:"px-1 py-1 whitespace-no-wrap border-b border-gray-500"},$e={class:"text-sm leading-5 text-gray-800"},je={class:"px-1 py-1 whitespace-no-wrap text-right border-b border-gray-500 text-sm leading-5"},Be=["onClick"],Le=X({__name:"OrganismResults",props:{sample:{type:Object,required:!0},analysisResults:{type:Object,required:!0}},setup(d){const L=N(()=>P(()=>import("./index-f86d8273.js").then(a=>a.cN),["assets/index-f86d8273.js","assets/index-ba19faea.css"])),A=N(()=>P(()=>import("./FelButton-e12f0980.js"),["assets/FelButton-e12f0980.js","assets/index-f86d8273.js","assets/index-ba19faea.css"])),{withClientMutation:f,withClientQuery:C}=Y(),i=m([]),v=m(!1),b=m(""),R=m([]),x=m(void 0),u=m(!1),n=Z(()=>d.analysisResults[0]);H(()=>{C(ne,{analysisResultUid:n.value.uid},"abxOrganismResultAll").then(a=>{a&&(i.value=a||[])}).finally(()=>_())});function M(){u.value=!0,f(oe,{analysisResultUid:n.value.uid},"createAbxOrganismResult").then(a=>{a&&i.value.unshift(a)}).finally(()=>u.value=!1)}function F(a){u.value=!0,f(ie,{uid:a.uid,organismUid:a.organism.uid},"saveAbxOrganismResult").then(t=>{if(t){const s=i.value.findIndex(r=>r.uid===a.uid);if(s>-1){const r=t.organism;i.value[s].organismUid=r?.uid,i.value[s].organism=r}}}).finally(()=>{u.value=!1,_()})}function z(a){u.value=!0,f(le,{uid:a.uid},"removeAbxOrganismResult").then(t=>{if(t){const s=i.value.findIndex(r=>r.uid===t?.uid);s>-1&&i.value.splice(s,1)}}).finally(()=>{u.value=!1,_()})}function D(a){x.value=a,v.value=!0}function G(a){v.value=!1,i.value[x.value].organism=a,x.value=void 0,d.analysisResults[0].result=i.value?.map(t=>t.organism?.name).join(", ")}function q(){b.value.length<3||C(re,{text:b.value,pageSize:25,sortBy:["name"]},"abxOrganismAll").then(a=>{R.value=a?.items})}const c=ee({can_submit:!1,can_approve:!1});function _(){c.can_submit=!1,c.can_approve=!1;const a=i.value?.every(t=>t.organismUid!=null);n.value.status=="pending"&&a&&(c.can_submit=!0),n.value.status=="resulted"&&(c.can_approve=!0)}let{submitResults:J,approveResults:K}=ae();const Q=()=>J([{uid:n.value.uid,result:n.value.result,methodUid:"felicity_ast",laboratoryInstrumentUid:"felicity_ast"}],"sample",d.sample?.uid).then(()=>{}),W=()=>K([n.value.uid],"sample",d.sample?.uid).then(()=>{});return(a,t)=>(o(),l(w,null,[e("h3",ue,[t[4]||(t[4]=e("span",{class:"font-bold"},"Organisms",-1)),n.value.status=="pending"?(o(),l("button",{key:0,onClick:t[0]||(t[0]=s=>M()),class:"ml-2 px-2 py-1 border-sky-800 border text-sky-800 rounded-sm transition duration-300 hover:bg-sky-800 hover:text-white focus:outline-none",disabled:u.value}," add organism ",8,de)):g("",!0)]),t[11]||(t[11]=e("hr",{class:"mt-1"},null,-1)),e("div",ce,[e("div",me,[e("table",pe,[t[5]||(t[5]=e("thead",null,[e("tr",null,[e("th",{class:"px-1 py-1 border-b-2 border-gray-300 text-left text-sm leading-4 text-gray-800 tracking-wider"},"Isolate Number"),e("th",{class:"px-1 py-1 border-b-2 border-gray-300 text-left text-sm leading-4 text-gray-800 tracking-wider"},"Organism Name"),e("th",{class:"px-1 py-1 border-b-2 border-gray-300"})])],-1)),e("tbody",ve,[(o(!0),l(w,null,U(i.value,(s,r)=>(o(),l("tr",{key:s?.uid},[e("td",be,[e("div",ge,"#"+p(s?.isolateNumber),1)]),e("td",he,[s?.organism?(o(),l("div",ye,p(s?.organism?.name),1)):(o(),l("button",{key:1,class:"px-2 border-sky-800 border text-sky-800 rounded-sm transition duration-300 hover:bg-sky-800 hover:text-white focus:outline-none",onClick:k=>D(r)}," pick organism ",8,fe))]),e("td",xe,[s?.organism&&!s?.organismUid?(o(),l("span",_e,[e("button",{class:"px-2 py-1 border-orange-800 border text-orange-800 rounded-sm transition duration-300 hover:bg-orange-800 hover:text-white focus:outline-none",onClick:k=>D(r)}," change ",8,ke),e("button",{class:"ml-2 px-2 py-1 border-sky-800 border text-sky-800 rounded-sm transition duration-300 hover:bg-sky-800 hover:text-white focus:outline-none",onClick:k=>F(s)}," save ",8,we)])):g("",!0),n.value.status=="pending"&&i.value.length>1?(o(),l("span",Oe,[e("button",{class:"px-2 py-1 border-orange-800 border text-orange-800 rounded-sm transition duration-300 hover:bg-orange-800 hover:text-white focus:outline-none",onClick:k=>z(s)}," delete ",8,Ae)])):g("",!0)])]))),128))])])])]),e("div",Ce,[e("div",Re,[t[6]||(t[6]=e("h4",{class:"font-semibold text-l flex-1 mb-2"},"Culture",-1)),e("button",De,p(n.value.status),1)]),t[7]||(t[7]=e("hr",null,null,-1)),n.value.status=="pending"?h((o(),l("textarea",{key:0,name:"culture",id:"culture",class:"mt-2 p-2 w-full",rows:"2","onUpdate:modelValue":t[1]||(t[1]=s=>n.value.result=s)},null,512)),[[E,n.value.result]]):(o(),l("p",Ue,p(n.value.result),1))]),e("div",Ee,[h(T(O(A),{key:"submit",onClick:I(Q,["prevent"]),color:"orange-600"},{default:y(()=>t[8]||(t[8]=[V("Submit culture")])),_:1},512),[[S,$(B.UPDATE,j.RESULT)&&c.can_submit&&d.sample.status!="submitting"]]),h(T(O(A),{key:"approve",onClick:I(W,["prevent"]),color:"orange-600"},{default:y(()=>t[9]||(t[9]=[V("Approve culture")])),_:1},512),[[S,$(B.UPDATE,j.RESULT)&&c.can_approve&&d.sample.status!="approving"]])]),v.value?(o(),te(O(L),{key:0,onClose:t[3]||(t[3]=s=>v.value=!1),contentWidth:"w-1/2"},{header:y(()=>t[10]||(t[10]=[e("h3",null,"Search Organism",-1)])),body:y(()=>[e("form",Se,[e("div",Te,[e("label",Ve,[h(e("input",{"onUpdate:modelValue":t[2]||(t[2]=s=>b.value=s),onInput:q,class:"form-input mt-1 block w-full",placeholder:"Search organisms..."},null,544),[[E,b.value]])]),e("div",Ie,[e("table",Ne,[(o(!0),l(w,null,U(R.value,s=>(o(),l("tr",{key:s.uid},[e("td",Pe,[e("div",$e,p(s.name),1)]),e("td",je,[e("button",{onClick:r=>G(s),class:"px-2 py-1 border-sky-800 border text-sky-800 rounded-sm transition duration-300 hover:bg-sky-800 hover:text-white focus:outline-none"}," pick ",8,Be)])]))),128))])])])])]),_:1})):g("",!0)],64))}}),Je=se(Le,[["__file","/home/aurthurm/Documents/Development/felicity/felicity-lims/webapp/views/sample/_id/results/OrganismResults.vue"]]);export{Je as default};
