# ==================================================================================
# Reflex V2 GraphQL Operations
# Simplified schema with 4 entity types: Trigger → Decision → Rule → Action
# ==================================================================================

# Query: Fetch reflex rule with V2 schema
query getReflexRuleByUidV2($uid: String!) {
  reflexRuleByUidV2(uid: $uid) {
    uid
    name
    description
    isActive
    priority
    reflexTriggers {
      uid
      level
      description
      sampleTypeUid
      sampleType {
        uid
        name
      }
      analyses {
        uid
        name
        resultOptions {
          optionKey
          value
        }
      }
      decisions {
        uid
        description
        priority
        ruleGroups {
          uid
          description
          priority
          rules {
            uid
            analysisUid
            analysis {
              uid
              name
              resultOptions {
                optionKey
                value
              }
            }
            operator
            value
            priority
          }
        }
        addAnalyses {
          uid
          analysisUid
          analysis {
            uid
            name
          }
          count
        }
        finalizeAnalyses {
          uid
          analysisUid
          analysis {
            uid
            name
          }
          value
        }
      }
    }
    createdBy {
      uid
      firstName
      lastName
    }
    createdAt
    updatedBy {
      uid
      firstName
      lastName
    }
    updatedAt
  }
}

# Query: Fetch all reflex triggers (optional filter by rule)
query getAllReflexTriggers($reflexRuleUid: String) {
  reflexTriggerAll(reflexRuleUid: $reflexRuleUid) {
    uid
    reflexRuleUid
    level
    description
    sampleTypeUid
    analyses {
      uid
      name
    }
    decisions {
      uid
      description
      priority
    }
  }
}

# Mutation: Create reflex decision with nested rule groups and actions
mutation createReflexDecisionV2($payload: ReflexDecisionInputV2!) {
  createReflexDecisionV2(payload: $payload) {
    ... on ReflexDecisionTypeV2 {
      uid
      reflexTriggerUid
      description
      priority
      ruleGroups {
        uid
        description
        priority
        rules {
          uid
          analysisUid
          operator
          value
          priority
        }
      }
      addAnalyses {
        uid
        analysisUid
        count
      }
      finalizeAnalyses {
        uid
        analysisUid
        value
      }
    }
    ... on OperationError {
      __typename
      error
      suggestion
    }
  }
}

# Mutation: Update reflex decision
mutation updateReflexDecisionV2($uid: String!, $payload: ReflexDecisionInputV2!) {
  updateReflexDecisionV2(uid: $uid, payload: $payload) {
    ... on ReflexDecisionTypeV2 {
      uid
      reflexTriggerUid
      description
      priority
      ruleGroups {
        uid
        description
        priority
        rules {
          uid
          analysisUid
          operator
          value
          priority
        }
      }
      addAnalyses {
        uid
        analysisUid
        count
      }
      finalizeAnalyses {
        uid
        analysisUid
        value
      }
    }
    ... on OperationError {
      __typename
      error
      suggestion
    }
  }
}

# Mutation: Create reflex trigger
mutation createReflexTrigger($payload: ReflexTriggerInput!) {
  createReflexTrigger(payload: $payload) {
    ... on ReflexTriggerType {
      uid
      reflexRuleUid
      level
      description
      sampleTypeUid
      analyses {
        uid
        name
      }
    }
    ... on OperationError {
      __typename
      error
      suggestion
    }
  }
}

# Mutation: Update reflex trigger
mutation updateReflexTrigger($uid: String!, $payload: ReflexTriggerInput!) {
  updateReflexTrigger(uid: $uid, payload: $payload) {
    ... on ReflexTriggerType {
      uid
      reflexRuleUid
      level
      description
      sampleTypeUid
      analyses {
        uid
        name
      }
    }
    ... on OperationError {
      __typename
      error
      suggestion
    }
  }
}

# Mutation: Delete reflex trigger
mutation deleteReflexTrigger($uid: String!) {
  deleteReflexTrigger(uid: $uid) {
    ... on DeletedItem {
      uid
    }
    ... on OperationError {
      __typename
      error
      suggestion
    }
  }
}

# Mutation: Delete reflex decision
mutation deleteReflexDecision($uid: String!) {
  deleteReflexDecision(uid: $uid) {
    ... on DeletedItem {
      uid
    }
    ... on OperationError {
      __typename
      error
      suggestion
    }
  }
}
